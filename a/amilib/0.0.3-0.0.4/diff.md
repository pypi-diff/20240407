# Comparing `tmp/amilib-0.0.3.tar.gz` & `tmp/amilib-0.0.4.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "dist/amilib-0.0.3.tar", last modified: Sat Apr  6 21:41:47 2024, max compression
+gzip compressed data, was "dist/amilib-0.0.4.tar", last modified: Sat Apr  6 22:07:31 2024, max compression
```

## Comparing `amilib-0.0.3.tar` & `amilib-0.0.4.tar`

### file list

```diff
@@ -1,47 +1,47 @@
-drwxr-xr-x   0 pm286      (503) staff       (20)        0 2024-04-06 21:41:47.546737 amilib-0.0.3/
--rw-r--r--   0 pm286      (503) staff       (20)    11357 2024-03-27 16:20:01.000000 amilib-0.0.3/LICENSE
--rw-r--r--   0 pm286      (503) staff       (20)      816 2024-04-06 21:41:47.546597 amilib-0.0.3/PKG-INFO
--rw-r--r--   0 pm286      (503) staff       (20)       76 2024-03-27 16:22:55.000000 amilib-0.0.3/README.md
-drwxr-xr-x   0 pm286      (503) staff       (20)        0 2024-04-06 21:41:47.544272 amilib-0.0.3/amilib/
--rw-r--r--   0 pm286      (503) staff       (20)        0 2024-03-27 18:27:17.000000 amilib-0.0.3/amilib/__init__.py
--rw-r--r--   0 pm286      (503) staff       (20)     5184 2024-04-06 18:35:06.000000 amilib-0.0.3/amilib/ami_bib.py
--rw-r--r--   0 pm286      (503) staff       (20)      561 2024-04-06 18:33:33.000000 amilib-0.0.3/amilib/ami_csv.py
--rw-r--r--   0 pm286      (503) staff       (20)   163985 2024-04-06 18:18:47.000000 amilib-0.0.3/amilib/ami_html.py
--rw-r--r--   0 pm286      (503) staff       (20)    16455 2024-04-06 16:22:07.000000 amilib-0.0.3/amilib/ami_integrate.py
--rw-r--r--   0 pm286      (503) staff       (20)     8541 2024-04-06 18:33:33.000000 amilib-0.0.3/amilib/ami_nlp.py
--rw-r--r--   0 pm286      (503) staff       (20)    81920 2024-04-06 16:22:07.000000 amilib-0.0.3/amilib/ami_pdf_libs.py
--rw-r--r--   0 pm286      (503) staff       (20)     4976 2024-04-06 16:22:07.000000 amilib-0.0.3/amilib/ami_svg.py
--rw-r--r--   0 pm286      (503) staff       (20)    10704 2024-04-06 18:35:06.000000 amilib-0.0.3/amilib/ami_util.py
--rw-r--r--   0 pm286      (503) staff       (20)     8473 2024-04-06 18:35:06.000000 amilib-0.0.3/amilib/amidriver.py
--rw-r--r--   0 pm286      (503) staff       (20)    49216 2024-04-06 21:40:46.000000 amilib-0.0.3/amilib/amix.py
--rw-r--r--   0 pm286      (503) staff       (20)    19771 2024-04-06 18:33:33.000000 amilib-0.0.3/amilib/bbox.py
--rw-r--r--   0 pm286      (503) staff       (20)    14121 2024-04-06 18:33:33.000000 amilib-0.0.3/amilib/file_lib.py
--rw-r--r--   0 pm286      (503) staff       (20)     3838 2024-04-06 18:33:33.000000 amilib-0.0.3/amilib/html_args.py
--rw-r--r--   0 pm286      (503) staff       (20)    16556 2024-04-06 16:22:07.000000 amilib-0.0.3/amilib/html_generator.py
--rw-r--r--   0 pm286      (503) staff       (20)    48180 2024-04-06 18:33:33.000000 amilib-0.0.3/amilib/html_marker.py
--rw-r--r--   0 pm286      (503) staff       (20)    27194 2024-04-06 16:22:07.000000 amilib-0.0.3/amilib/pdf_args.py
--rw-r--r--   0 pm286      (503) staff       (20)    36799 2024-04-06 16:22:07.000000 amilib-0.0.3/amilib/util.py
--rw-r--r--   0 pm286      (503) staff       (20)    33727 2024-04-06 18:33:33.000000 amilib-0.0.3/amilib/wikimedia.py
--rw-r--r--   0 pm286      (503) staff       (20)    54498 2024-04-06 18:33:33.000000 amilib-0.0.3/amilib/xml_lib.py
-drwxr-xr-x   0 pm286      (503) staff       (20)        0 2024-04-06 21:41:47.545067 amilib-0.0.3/amilib.egg-info/
--rw-r--r--   0 pm286      (503) staff       (20)      816 2024-04-06 21:41:47.000000 amilib-0.0.3/amilib.egg-info/PKG-INFO
--rw-r--r--   0 pm286      (503) staff       (20)      822 2024-04-06 21:41:47.000000 amilib-0.0.3/amilib.egg-info/SOURCES.txt
--rw-r--r--   0 pm286      (503) staff       (20)        1 2024-04-06 21:41:47.000000 amilib-0.0.3/amilib.egg-info/dependency_links.txt
--rw-r--r--   0 pm286      (503) staff       (20)       44 2024-04-06 21:41:47.000000 amilib-0.0.3/amilib.egg-info/entry_points.txt
--rw-r--r--   0 pm286      (503) staff       (20)        1 2024-04-06 21:41:47.000000 amilib-0.0.3/amilib.egg-info/not-zip-safe
--rw-r--r--   0 pm286      (503) staff       (20)      125 2024-04-06 21:41:47.000000 amilib-0.0.3/amilib.egg-info/requires.txt
--rw-r--r--   0 pm286      (503) staff       (20)        7 2024-04-06 21:41:47.000000 amilib-0.0.3/amilib.egg-info/top_level.txt
--rw-r--r--   0 pm286      (503) staff       (20)       38 2024-04-06 21:41:47.546785 amilib-0.0.3/setup.cfg
--rw-r--r--   0 pm286      (503) staff       (20)     1651 2024-04-06 21:41:08.000000 amilib-0.0.3/setup.py
-drwxr-xr-x   0 pm286      (503) staff       (20)        0 2024-04-06 21:41:47.546433 amilib-0.0.3/test/
--rw-r--r--   0 pm286      (503) staff       (20)     4200 2024-04-06 18:38:39.000000 amilib-0.0.3/test/test_all.py
--rw-r--r--   0 pm286      (503) staff       (20)     2460 2024-04-04 15:27:40.000000 amilib-0.0.3/test/test_file.py
--rw-r--r--   0 pm286      (503) staff       (20)    38266 2024-04-05 10:07:06.000000 amilib-0.0.3/test/test_headless.py
--rw-r--r--   0 pm286      (503) staff       (20)   121225 2024-04-06 16:22:07.000000 amilib-0.0.3/test/test_html.py
--rw-r--r--   0 pm286      (503) staff       (20)      733 2024-04-05 09:30:56.000000 amilib-0.0.3/test/test_nlp.py
--rw-r--r--   0 pm286      (503) staff       (20)    80007 2024-04-06 16:22:07.000000 amilib-0.0.3/test/test_pdf.py
--rw-r--r--   0 pm286      (503) staff       (20)      957 2024-04-05 09:40:39.000000 amilib-0.0.3/test/test_stat.py
--rw-r--r--   0 pm286      (503) staff       (20)     1065 2024-04-01 09:44:34.000000 amilib-0.0.3/test/test_svg.py
--rw-r--r--   0 pm286      (503) staff       (20)    10324 2024-04-02 21:34:31.000000 amilib-0.0.3/test/test_util.py
--rw-r--r--   0 pm286      (503) staff       (20)    35765 2024-04-06 16:22:07.000000 amilib-0.0.3/test/test_wikidata.py
--rw-r--r--   0 pm286      (503) staff       (20)     4787 2024-04-05 09:18:11.000000 amilib-0.0.3/test/test_xml.py
+drwxr-xr-x   0 pm286      (503) staff       (20)        0 2024-04-06 22:07:31.048264 amilib-0.0.4/
+-rw-r--r--   0 pm286      (503) staff       (20)    11357 2024-03-27 16:20:01.000000 amilib-0.0.4/LICENSE
+-rw-r--r--   0 pm286      (503) staff       (20)      816 2024-04-06 22:07:31.048133 amilib-0.0.4/PKG-INFO
+-rw-r--r--   0 pm286      (503) staff       (20)       76 2024-03-27 16:22:55.000000 amilib-0.0.4/README.md
+drwxr-xr-x   0 pm286      (503) staff       (20)        0 2024-04-06 22:07:31.045655 amilib-0.0.4/amilib/
+-rw-r--r--   0 pm286      (503) staff       (20)        0 2024-03-27 18:27:17.000000 amilib-0.0.4/amilib/__init__.py
+-rw-r--r--   0 pm286      (503) staff       (20)     5185 2024-04-06 21:49:19.000000 amilib-0.0.4/amilib/ami_bib.py
+-rw-r--r--   0 pm286      (503) staff       (20)      539 2024-04-06 21:53:37.000000 amilib-0.0.4/amilib/ami_csv.py
+-rw-r--r--   0 pm286      (503) staff       (20)   164257 2024-04-06 21:53:37.000000 amilib-0.0.4/amilib/ami_html.py
+-rw-r--r--   0 pm286      (503) staff       (20)    16455 2024-04-06 16:22:07.000000 amilib-0.0.4/amilib/ami_integrate.py
+-rw-r--r--   0 pm286      (503) staff       (20)     8541 2024-04-06 18:33:33.000000 amilib-0.0.4/amilib/ami_nlp.py
+-rw-r--r--   0 pm286      (503) staff       (20)    81920 2024-04-06 16:22:07.000000 amilib-0.0.4/amilib/ami_pdf_libs.py
+-rw-r--r--   0 pm286      (503) staff       (20)     4976 2024-04-06 16:22:07.000000 amilib-0.0.4/amilib/ami_svg.py
+-rw-r--r--   0 pm286      (503) staff       (20)    10712 2024-04-06 22:00:19.000000 amilib-0.0.4/amilib/ami_util.py
+-rw-r--r--   0 pm286      (503) staff       (20)     8473 2024-04-06 18:35:06.000000 amilib-0.0.4/amilib/amidriver.py
+-rw-r--r--   0 pm286      (503) staff       (20)    49641 2024-04-06 22:07:17.000000 amilib-0.0.4/amilib/amix.py
+-rw-r--r--   0 pm286      (503) staff       (20)    19772 2024-04-06 22:00:19.000000 amilib-0.0.4/amilib/bbox.py
+-rw-r--r--   0 pm286      (503) staff       (20)    14214 2024-04-06 22:00:19.000000 amilib-0.0.4/amilib/file_lib.py
+-rw-r--r--   0 pm286      (503) staff       (20)     3862 2024-04-06 22:00:19.000000 amilib-0.0.4/amilib/html_args.py
+-rw-r--r--   0 pm286      (503) staff       (20)    16530 2024-04-06 22:00:19.000000 amilib-0.0.4/amilib/html_generator.py
+-rw-r--r--   0 pm286      (503) staff       (20)    48363 2024-04-06 21:49:20.000000 amilib-0.0.4/amilib/html_marker.py
+-rw-r--r--   0 pm286      (503) staff       (20)    27194 2024-04-06 16:22:07.000000 amilib-0.0.4/amilib/pdf_args.py
+-rw-r--r--   0 pm286      (503) staff       (20)    36787 2024-04-06 22:00:19.000000 amilib-0.0.4/amilib/util.py
+-rw-r--r--   0 pm286      (503) staff       (20)    33687 2024-04-06 22:00:19.000000 amilib-0.0.4/amilib/wikimedia.py
+-rw-r--r--   0 pm286      (503) staff       (20)    54483 2024-04-06 22:00:19.000000 amilib-0.0.4/amilib/xml_lib.py
+drwxr-xr-x   0 pm286      (503) staff       (20)        0 2024-04-06 22:07:31.046512 amilib-0.0.4/amilib.egg-info/
+-rw-r--r--   0 pm286      (503) staff       (20)      816 2024-04-06 22:07:30.000000 amilib-0.0.4/amilib.egg-info/PKG-INFO
+-rw-r--r--   0 pm286      (503) staff       (20)      822 2024-04-06 22:07:30.000000 amilib-0.0.4/amilib.egg-info/SOURCES.txt
+-rw-r--r--   0 pm286      (503) staff       (20)        1 2024-04-06 22:07:30.000000 amilib-0.0.4/amilib.egg-info/dependency_links.txt
+-rw-r--r--   0 pm286      (503) staff       (20)       44 2024-04-06 22:07:30.000000 amilib-0.0.4/amilib.egg-info/entry_points.txt
+-rw-r--r--   0 pm286      (503) staff       (20)        1 2024-04-06 21:41:47.000000 amilib-0.0.4/amilib.egg-info/not-zip-safe
+-rw-r--r--   0 pm286      (503) staff       (20)      125 2024-04-06 22:07:30.000000 amilib-0.0.4/amilib.egg-info/requires.txt
+-rw-r--r--   0 pm286      (503) staff       (20)        7 2024-04-06 22:07:30.000000 amilib-0.0.4/amilib.egg-info/top_level.txt
+-rw-r--r--   0 pm286      (503) staff       (20)       38 2024-04-06 22:07:31.048306 amilib-0.0.4/setup.cfg
+-rw-r--r--   0 pm286      (503) staff       (20)     1651 2024-04-06 22:07:18.000000 amilib-0.0.4/setup.py
+drwxr-xr-x   0 pm286      (503) staff       (20)        0 2024-04-06 22:07:31.047969 amilib-0.0.4/test/
+-rw-r--r--   0 pm286      (503) staff       (20)     4200 2024-04-06 18:38:39.000000 amilib-0.0.4/test/test_all.py
+-rw-r--r--   0 pm286      (503) staff       (20)     2460 2024-04-04 15:27:40.000000 amilib-0.0.4/test/test_file.py
+-rw-r--r--   0 pm286      (503) staff       (20)    38266 2024-04-05 10:07:06.000000 amilib-0.0.4/test/test_headless.py
+-rw-r--r--   0 pm286      (503) staff       (20)   121225 2024-04-06 16:22:07.000000 amilib-0.0.4/test/test_html.py
+-rw-r--r--   0 pm286      (503) staff       (20)      733 2024-04-05 09:30:56.000000 amilib-0.0.4/test/test_nlp.py
+-rw-r--r--   0 pm286      (503) staff       (20)    80084 2024-04-06 22:07:18.000000 amilib-0.0.4/test/test_pdf.py
+-rw-r--r--   0 pm286      (503) staff       (20)      957 2024-04-05 09:40:39.000000 amilib-0.0.4/test/test_stat.py
+-rw-r--r--   0 pm286      (503) staff       (20)     1065 2024-04-01 09:44:34.000000 amilib-0.0.4/test/test_svg.py
+-rw-r--r--   0 pm286      (503) staff       (20)    10324 2024-04-02 21:34:31.000000 amilib-0.0.4/test/test_util.py
+-rw-r--r--   0 pm286      (503) staff       (20)    35765 2024-04-06 16:22:07.000000 amilib-0.0.4/test/test_wikidata.py
+-rw-r--r--   0 pm286      (503) staff       (20)     4787 2024-04-05 09:18:11.000000 amilib-0.0.4/test/test_xml.py
```

### Comparing `amilib-0.0.3/LICENSE` & `amilib-0.0.4/LICENSE`

 * *Files identical despite different names*

### Comparing `amilib-0.0.3/PKG-INFO` & `amilib-0.0.4/PKG-INFO`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: amilib
-Version: 0.0.3
+Version: 0.0.4
 Summary: document download, cleaning, managemenr
 Home-page: https://github.com/petermr/amilib
 Author: Peter Murray-Rust
 Author-email: petermurrayrust@googlemail.com
 License: Apache2
 Keywords: text and data mining
 Classifier: Development Status :: 3 - Alpha
```

### Comparing `amilib-0.0.3/amilib/ami_bib.py` & `amilib-0.0.4/amilib/ami_bib.py`

 * *Files 0% similar despite different names*

```diff
@@ -5,14 +5,15 @@
 import lxml.etree
 import re
 # local
 from amilib.util import Util
 
 logger = logging.getLogger(__file__)
 
+
 class Reference:
     SINGLE_REF_REC = re.compile(r"""
                     (?P<pre>.*)   # leading string without bracket
                     \(            # bracket
                     (?P<body>
                     (?:[A-Z]|de|d')
                     .*(?:20|19)\d\d[a-z,]*  # body starts uppcase and ends with date (without brackets)
```

### Comparing `amilib-0.0.3/amilib/ami_csv.py` & `amilib-0.0.4/amilib/ami_csv.py`

 * *Files 27% similar despite different names*

```diff
@@ -1,22 +1,23 @@
 import csv
-from itertools import izip
+import logging
 
 logger = logging.getLogger(__file__)
 
+
 class AmiCSV:
 
-    def read_transpose_write(self, input, output):
-        a = izip(*csv.reader(open("input.csv", "rb")))
-        csv.writer(open("output.csv", "wb")).writerows(a)
+    def read_transpose_write(self, inputx, output):
+        a = zip(*csv.reader(open(inputx, "rb")))
+        csv.writer(open(output, "wb")).writerows(a)
 
     @classmethod
     def transpose(cls, a):
         """
         clever trick for transposing a 2-D array
         :param a: array
         :return: transposed array or None if bad arguments
         """
         if a is None or len(a.shape) != 2:
             return None
-        b = izip(*a)
-        return b
+        b = zip(*a)
+        return b
```

### Comparing `amilib-0.0.3/amilib/ami_html.py` & `amilib-0.0.4/amilib/ami_html.py`

 * *Files 0% similar despite different names*

```diff
@@ -1,10250 +1,10267 @@
 00000000: 2222 2253 7570 706f 7274 7320 7061 7273  """Supports pars
 00000010: 696e 672c 2065 6469 7469 6e67 2c20 6d61  ing, editing, ma
 00000020: 726b 7570 2c20 7265 7374 7275 6374 696e  rkup, restructin
 00000030: 6720 6f66 2048 544d 4c0a 5368 6f75 6c64  g of HTML.Should
 00000040: 2068 6176 6520 7265 6c61 7469 7665 6c79   have relatively
 00000050: 2066 6577 2064 6570 656e 6465 6e63 6965   few dependencie
-00000060: 7322 2222 0a69 6d70 6f72 7420 6172 6770  s""".import argp
-00000070: 6172 7365 0a69 6d70 6f72 7420 636f 7079  arse.import copy
-00000080: 0a69 6d70 6f72 7420 6c6f 6767 696e 670a  .import logging.
-00000090: 696d 706f 7274 2072 650a 696d 706f 7274  import re.import
-000000a0: 2073 7973 0a69 6d70 6f72 7420 7469 6d65   sys.import time
-000000b0: 0a66 726f 6d20 636f 6c6c 6563 7469 6f6e  .from collection
-000000c0: 7320 696d 706f 7274 2064 6566 6175 6c74  s import default
-000000d0: 6469 6374 2c20 436f 756e 7465 720a 6672  dict, Counter.fr
-000000e0: 6f6d 2065 6e75 6d20 696d 706f 7274 2045  om enum import E
-000000f0: 6e75 6d0a 6672 6f6d 2069 6f20 696d 706f  num.from io impo
-00000100: 7274 2053 7472 696e 6749 4f0a 6672 6f6d  rt StringIO.from
-00000110: 2070 6174 686c 6962 2069 6d70 6f72 7420   pathlib import 
-00000120: 5061 7468 0a66 726f 6d20 7070 7269 6e74  Path.from pprint
-00000130: 2069 6d70 6f72 7420 7070 7269 6e74 0a0a   import pprint..
-00000140: 696d 706f 7274 206e 756d 7079 2061 7320  import numpy as 
-00000150: 6e70 0a69 6d70 6f72 7420 6c78 6d6c 2e65  np.import lxml.e
-00000160: 7472 6565 2061 7320 4554 0a66 726f 6d20  tree as ET.from 
-00000170: 6c78 6d6c 2e65 7472 6565 2069 6d70 6f72  lxml.etree impor
-00000180: 7420 456c 656d 656e 742c 205f 456c 656d  t Element, _Elem
-00000190: 656e 742c 205f 456c 656d 656e 7454 7265  ent, _ElementTre
-000001a0: 650a 6672 6f6d 2073 6b6c 6561 726e 2e6c  e.from sklearn.l
-000001b0: 696e 6561 725f 6d6f 6465 6c20 696d 706f  inear_model impo
-000001c0: 7274 204c 696e 6561 7252 6567 7265 7373  rt LinearRegress
-000001d0: 696f 6e0a 0a23 206c 6f63 616c 0a66 726f  ion..# local.fro
-000001e0: 6d20 616d 696c 6962 2e62 626f 7820 696d  m amilib.bbox im
-000001f0: 706f 7274 2042 426f 780a 6672 6f6d 2061  port BBox.from a
-00000200: 6d69 6c69 622e 7574 696c 2069 6d70 6f72  milib.util impor
-00000210: 7420 5353 6372 6970 742c 2041 6273 7472  t SScript, Abstr
-00000220: 6163 7441 7267 732c 2055 7469 6c2c 2041  actArgs, Util, A
-00000230: 6d69 4c6f 6767 6572 0a66 726f 6d20 616d  miLogger.from am
-00000240: 696c 6962 2e78 6d6c 5f6c 6962 2069 6d70  ilib.xml_lib imp
-00000250: 6f72 7420 586d 6c4c 6962 2c20 4874 6d6c  ort XmlLib, Html
-00000260: 4c69 620a 0a23 206e 6f20 7472 792d 6361  Lib..# no try-ca
-00000270: 7463 6820 696d 706f 7274 730a 0a6c 6f67  tch imports..log
-00000280: 6765 7220 3d20 416d 694c 6f67 6765 722e  ger = AmiLogger.
-00000290: 6372 6561 7465 5f6e 616d 6564 5f6c 6f67  create_named_log
-000002a0: 6765 7228 5f5f 6669 6c65 5f5f 290a 0a23  ger(__file__)..#
-000002b0: 2048 544d 4c20 656c 656d 656e 7473 0a48   HTML elements.H
-000002c0: 5f48 544d 4c20 3d20 2268 746d 6c22 0a48  _HTML = "html".H
-000002d0: 5f48 4541 4420 3d20 2268 6561 6422 0a48  _HEAD = "head".H
-000002e0: 5f4d 4554 4120 3d20 226d 6574 6122 0a48  _META = "meta".H
-000002f0: 5f53 4352 4950 5420 3d20 2273 6372 6970  _SCRIPT = "scrip
-00000300: 7422 0a48 5f53 5459 4c45 203d 2022 7374  t".H_STYLE = "st
-00000310: 796c 6522 0a48 5f42 4f44 5920 3d20 2262  yle".H_BODY = "b
-00000320: 6f64 7922 0a48 5f54 4142 4c45 203d 2022  ody".H_TABLE = "
-00000330: 7461 626c 6522 0a48 5f54 4845 4144 203d  table".H_THEAD =
-00000340: 2022 7468 6561 6422 0a48 5f54 4954 4c45   "thead".H_TITLE
-00000350: 203d 2022 7469 746c 6522 0a48 5f54 424f   = "title".H_TBO
-00000360: 4459 203d 2022 7462 6f64 7922 0a48 5f54  DY = "tbody".H_T
-00000370: 5220 3d20 2274 7222 0a48 5f54 4820 3d20  R = "tr".H_TH = 
-00000380: 2274 6822 0a48 5f54 4420 3d20 2274 6422  "th".H_TD = "td"
-00000390: 0a48 5f44 4956 203d 2022 6469 7622 0a48  .H_DIV = "div".H
-000003a0: 5f53 5041 4e20 3d20 2273 7061 6e22 0a48  _SPAN = "span".H
-000003b0: 5f55 4c20 3d20 2275 6c22 0a48 5f4c 4920  _UL = "ul".H_LI 
-000003c0: 3d20 226c 6922 0a48 5f41 203d 2022 6122  = "li".H_A = "a"
-000003d0: 0a48 5f42 203d 2022 6222 0a48 5f50 203d  .H_B = "b".H_P =
-000003e0: 2022 7022 0a0a 5820 3d20 2278 220a 5920   "p"..X = "x".Y 
-000003f0: 3d20 2279 220a 5830 203d 2022 7830 220a  = "y".X0 = "x0".
-00000400: 5831 203d 2022 7831 220a 0a23 2048 544d  X1 = "x1"..# HTM
-00000410: 4c20 6174 7472 6962 7574 6573 0a41 5f43  L attributes.A_C
-00000420: 4c41 5353 203d 2022 636c 6173 7322 0a41  LASS = "class".A
-00000430: 5f48 5245 4620 3d20 2268 7265 6622 0a41  _HREF = "href".A
-00000440: 5f49 4420 3d20 2269 6422 0a41 5f4e 414d  _ID = "id".A_NAM
-00000450: 4520 3d20 226e 616d 6522 0a41 5f53 5459  E = "name".A_STY
-00000460: 4c45 203d 2022 7374 796c 6522 0a41 5f54  LE = "style".A_T
-00000470: 4552 4d20 3d20 2274 6572 6d22 0a41 5f54  ERM = "term".A_T
-00000480: 4954 4c45 203d 2022 7469 746c 6522 0a0a  ITLE = "title"..
-00000490: 585f 5052 4543 4544 494e 4720 3d20 2270  X_PRECEDING = "p
-000004a0: 7265 6365 6469 6e67 220a 0a23 2073 7479  receding"..# sty
-000004b0: 6c65 2062 756e 646c 650a 5354 594c 4520  le bundle.STYLE 
-000004c0: 3d20 2273 7479 6c65 220a 4954 414c 4943  = "style".ITALIC
-000004d0: 203d 2022 6974 616c 6963 220a 424f 4c44   = "italic".BOLD
-000004e0: 203d 2022 626f 6c64 220a 5449 4d45 5320   = "bold".TIMES 
-000004f0: 3d20 2274 696d 6573 220a 4341 4c49 4252  = "times".CALIBR
-00000500: 4920 3d20 2263 616c 6962 7269 220a 464f  I = "calibri".FO
-00000510: 4e54 5f46 414d 494c 4945 5320 3d20 5b54  NT_FAMILIES = [T
-00000520: 494d 4553 2c20 4341 4c49 4252 495d 0a0a  IMES, CALIBRI]..
-00000530: 2320 7374 796c 6520 6174 7472 6962 7574  # style attribut
-00000540: 6573 0a46 4f4e 545f 5349 5a45 203d 2022  es.FONT_SIZE = "
-00000550: 666f 6e74 2d73 697a 6522 0a46 4f4e 545f  font-size".FONT_
-00000560: 5354 594c 4520 3d20 2266 6f6e 742d 7374  STYLE = "font-st
-00000570: 796c 6522 0a46 4f4e 545f 5745 4947 4854  yle".FONT_WEIGHT
-00000580: 203d 2022 666f 6e74 2d77 6569 6768 7422   = "font-weight"
-00000590: 0a46 4f4e 545f 4641 4d49 4c59 203d 2022  .FONT_FAMILY = "
-000005a0: 666f 6e74 2d66 616d 696c 7922 0a46 4f4e  font-family".FON
-000005b0: 545f 464f 4e54 203d 2022 666f 6e74 220a  T_FONT = "font".
-000005c0: 464f 4e54 5f4e 414d 4520 3d20 2266 6f6e  FONT_NAME = "fon
-000005d0: 742d 6e61 6d65 220a 464f 4e54 5f53 5452  t-name".FONT_STR
-000005e0: 4554 4348 4544 203d 2022 666f 6e74 2d73  ETCHED = "font-s
-000005f0: 7472 6574 6368 6564 220a 4649 4c4c 203d  tretched".FILL =
-00000600: 2022 6669 6c6c 220a 5354 524f 4b45 203d   "fill".STROKE =
-00000610: 2022 7374 726f 6b65 220a 0a23 2063 6861   "stroke"..# cha
-00000620: 7261 6374 6572 2070 726f 7065 7274 6965  racter propertie
-00000630: 730a 505f 464f 4e54 4e41 4d45 203d 2022  s.P_FONTNAME = "
-00000640: 666f 6e74 6e61 6d65 220a 505f 4845 4947  fontname".P_HEIG
-00000650: 4854 203d 2022 6865 6967 6874 220a 505f  HT = "height".P_
-00000660: 5354 524f 4b49 4e47 5f43 4f4c 4f52 203d  STROKING_COLOR =
-00000670: 2022 7374 726f 6b69 6e67 5f63 6f6c 6f72   "stroking_color
-00000680: 220a 505f 4e4f 4e5f 5354 524f 4b49 4e47  ".P_NON_STROKING
-00000690: 5f43 4f4c 4f52 203d 2022 6e6f 6e5f 7374  _COLOR = "non_st
-000006a0: 726f 6b69 6e67 5f63 6f6c 6f72 220a 0a50  roking_color"..P
-000006b0: 5f58 3020 3d20 2278 3022 0a50 5f58 3120  _X0 = "x0".P_X1 
-000006c0: 3d20 2278 3122 0a50 5f59 3020 3d20 2279  = "x1".P_Y0 = "y
-000006d0: 3022 0a50 5f59 3120 3d20 2279 3122 0a50  0".P_Y1 = "y1".P
-000006e0: 5f54 4558 5420 3d20 2274 6578 7422 0a0a  _TEXT = "text"..
-000006f0: 2320 556e 7761 6e74 6564 2073 6563 7469  # Unwanted secti
-00000700: 6f6e 730a 555f 5850 4154 4820 3d20 2278  ons.U_XPATH = "x
-00000710: 7061 7468 220a 555f 5245 4745 5820 3d20  path".U_REGEX = 
-00000720: 2272 6567 6578 220a 0a53 5459 4c45 5320  "regex"..STYLES 
-00000730: 3d20 5b0a 2020 2020 464f 4e54 5f53 495a  = [.    FONT_SIZ
-00000740: 452c 0a20 2020 2046 4f4e 545f 5354 594c  E,.    FONT_STYL
-00000750: 452c 0a20 2020 2046 4f4e 545f 4641 4d49  E,.    FONT_FAMI
-00000760: 4c59 2c0a 2020 2020 464f 4e54 5f57 4549  LY,.    FONT_WEI
-00000770: 4748 542c 0a20 2020 2046 494c 4c2c 0a20  GHT,.    FILL,. 
-00000780: 2020 2053 5452 4f4b 452c 0a5d 0a0a 2320     STROKE,.]..# 
-00000790: 4353 530a 535f 424f 5244 4552 203d 2022  CSS.S_BORDER = "
-000007a0: 626f 7264 6572 220a 535f 504f 5349 5449  border".S_POSITI
-000007b0: 4f4e 203d 2022 706f 7369 7469 6f6e 220a  ON = "position".
-000007c0: 535f 5749 4454 4820 3d20 2277 6964 7468  S_WIDTH = "width
-000007d0: 220a 535f 5752 4954 494e 475f 4d4f 4445  ".S_WRITING_MODE
-000007e0: 203d 2022 7772 6974 696e 672d 6d6f 6465   = "writing-mode
-000007f0: 220a 0a5f 5554 4638 203d 2022 5554 462d  ".._UTF8 = "UTF-
-00000800: 3822 0a0a 0a43 4841 505f 544f 505f 5245  8"...CHAP_TOP_RE
-00000810: 4320 3d20 7265 2e63 6f6d 7069 6c65 2822  C = re.compile("
-00000820: 5f5f 4e4f 545f 5f59 4554 5f5f 494d 504c  __NOT__YET__IMPL
-00000830: 454d 454e 5445 445f 5f22 290a 5345 4354  EMENTED__").SECT
-00000840: 494f 4e53 5f44 4543 494d 414c 5f52 4543  IONS_DECIMAL_REC
-00000850: 203d 2072 652e 636f 6d70 696c 6528 225c   = re.compile("\
-00000860: 5c64 2b5c 5c2e 5c5c 642b 2422 290a 5355  \d+\\.\\d+$").SU
-00000870: 4253 4543 5453 5f44 4543 494d 414c 5f52  BSECTS_DECIMAL_R
-00000880: 4543 203d 2072 652e 636f 6d70 696c 6528  EC = re.compile(
-00000890: 225c 5c64 2b5c 5c2e 5c5c 642b 5c5c 2e5c  "\\d+\\.\\d+\\.\
-000008a0: 5c64 2b24 2229 0a0a 434c 4153 5352 4546  \d+$")..CLASSREF
-000008b0: 203d 2022 636c 6173 7372 6566 220a 0a53   = "classref"..S
-000008c0: 5459 4c45 5f58 5041 5448 203d 2022 2f68  TYLE_XPATH = "/h
-000008d0: 746d 6c2f 6865 6164 2f73 7479 6c65 220a  tml/head/style".
-000008e0: 0a22 2222 0a4e 4f54 452e 2074 6865 2075  .""".NOTE. the u
-000008f0: 7365 206f 6620 636c 6173 736e 616d 652c  se of classname,
-00000900: 2063 6c61 7373 7265 6620 616e 6420 7369   classref and si
-00000910: 6d69 6c61 7220 6973 2069 6e63 6f6e 7369  milar is inconsi
-00000920: 7374 656e 742e 2057 6520 7761 6e74 2074  stent. We want t
-00000930: 6f20 6861 7665 3a0a 7331 2020 746f 206d  o have:.s1  to m
-00000940: 6561 6e20 636c 6173 7320 6e61 6d65 2028  ean class name (
-00000950: 636c 6173 736e 616d 6529 0a2e 7331 2074  classname)..s1 t
-00000960: 6f20 6d65 616e 2061 2072 6566 6572 656e  o mean a referen
-00000970: 6365 2074 6f20 6120 636c 6173 736e 616d  ce to a classnam
-00000980: 6520 286f 6e6c 7920 7573 6564 2069 6e20  e (only used in 
-00000990: 3c73 7479 6c65 3e20 656c 656d 656e 7473  <style> elements
-000009a0: 2062 7574 2069 6e76 6f6c 7665 6420 696e   but involved in
-000009b0: 2063 6f6e 7665 7273 696f 6e73 0a22 2222   conversions."""
-000009c0: 0a0a 6c6f 6767 6572 203d 206c 6f67 6769  ..logger = loggi
-000009d0: 6e67 2e67 6574 4c6f 6767 6572 285f 5f66  ng.getLogger(__f
-000009e0: 696c 655f 5f29 0a0a 636c 6173 7320 416d  ile__)..class Am
-000009f0: 6953 7061 6e3a 0a20 2020 2064 6566 205f  iSpan:.    def _
-00000a00: 5f69 6e69 745f 5f28 7365 6c66 293a 0a20  _init__(self):. 
-00000a10: 2020 2020 2020 2073 656c 662e 7465 7874         self.text
-00000a20: 5f73 7479 6c65 203d 204e 6f6e 650a 2020  _style = None.  
-00000a30: 2020 2020 2020 7365 6c66 2e73 7472 696e        self.strin
-00000a40: 6720 3d20 2222 0a20 2020 2020 2020 2073  g = "".        s
-00000a50: 656c 662e 7878 203d 205b 5d0a 2020 2020  elf.xx = [].    
-00000a60: 2020 2020 7365 6c66 2e78 3020 3d20 4e6f      self.x0 = No
-00000a70: 6e65 0a20 2020 2020 2020 2073 656c 662e  ne.        self.
-00000a80: 7831 203d 204e 6f6e 650a 2020 2020 2020  x1 = None.      
-00000a90: 2020 7365 6c66 2e79 3020 3d20 4e6f 6e65    self.y0 = None
-00000aa0: 0a20 2020 2020 2020 2023 2073 656c 662e  .        # self.
-00000ab0: 6164 7620 3d20 4e6f 6e65 0a0a 2020 2020  adv = None..    
-00000ac0: 6465 6620 6372 6561 7465 5f61 6e64 5f61  def create_and_a
-00000ad0: 6464 5f74 6f28 7365 6c66 2c20 6469 7629  dd_to(self, div)
-00000ae0: 3a0a 2020 2020 2020 2020 6874 6d6c 5f73  :.        html_s
-00000af0: 7061 6e20 3d20 4e6f 6e65 0a20 2020 2020  pan = None.     
-00000b00: 2020 2069 6620 6469 7620 6973 206e 6f74     if div is not
-00000b10: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00000b20: 2020 2068 746d 6c5f 7370 616e 203d 2045     html_span = E
-00000b30: 542e 5375 6245 6c65 6d65 6e74 2864 6976  T.SubElement(div
-00000b40: 2c20 485f 5350 414e 290a 2020 2020 2020  , H_SPAN).      
-00000b50: 2020 2020 2020 6874 6d6c 5f73 7061 6e2e        html_span.
-00000b60: 7465 7874 203d 2073 656c 662e 7374 7269  text = self.stri
-00000b70: 6e67 0a20 2020 2020 2020 2020 2020 2048  ng.            H
-00000b80: 746d 6c53 7479 6c65 2e73 6574 5f73 7479  tmlStyle.set_sty
-00000b90: 6c65 2868 746d 6c5f 7370 616e 2c20 7365  le(html_span, se
-00000ba0: 6c66 2e74 6578 745f 7374 796c 652e 6372  lf.text_style.cr
-00000bb0: 6561 7465 5f63 7373 5f73 7472 696e 6728  eate_css_string(
-00000bc0: 2929 0a20 2020 2020 2020 2020 2020 2069  )).            i
-00000bd0: 6620 6c65 6e28 7365 6c66 2e78 7829 203e  f len(self.xx) >
-00000be0: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
-00000bf0: 2020 2020 6874 6d6c 5f73 7061 6e2e 6174      html_span.at
-00000c00: 7472 6962 5b58 5d20 3d20 7365 6c66 2e78  trib[X] = self.x
-00000c10: 785b 305d 0a20 2020 2020 2020 2020 2020  x[0].           
-00000c20: 2069 6620 7365 6c66 2e78 303a 0a20 2020   if self.x0:.   
-00000c30: 2020 2020 2020 2020 2020 2020 2068 746d               htm
-00000c40: 6c5f 7370 616e 2e61 7474 7269 625b 5830  l_span.attrib[X0
-00000c50: 5d20 3d20 7374 7228 7365 6c66 2e78 3029  ] = str(self.x0)
-00000c60: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00000c70: 7365 6c66 2e78 313a 0a20 2020 2020 2020  self.x1:.       
-00000c80: 2020 2020 2020 2020 2068 746d 6c5f 7370           html_sp
-00000c90: 616e 2e61 7474 7269 625b 5831 5d20 3d20  an.attrib[X1] = 
-00000ca0: 7374 7228 7365 6c66 2e78 3129 0a20 2020  str(self.x1).   
-00000cb0: 2020 2020 2020 2020 2068 746d 6c5f 7370           html_sp
-00000cc0: 616e 2e61 7474 7269 625b 595d 203d 2073  an.attrib[Y] = s
-00000cd0: 7472 2873 656c 662e 7930 290a 2020 2020  tr(self.y0).    
-00000ce0: 2020 2020 7265 7475 726e 2068 746d 6c5f      return html_
-00000cf0: 7370 616e 0a0a 0a23 2073 686f 756c 6420  span...# should 
-00000d00: 6d61 7962 6520 6265 2069 6e20 5044 460a  maybe be in PDF.
-00000d10: 636c 6173 7320 5061 6765 426f 783a 2020  class PageBox:  
-00000d20: 2320 6465 6669 6e65 6420 6279 2070 6466  # defined by pdf
-00000d30: 6d69 6e65 7220 4920 7468 696e 6b0a 0a20  miner I think.. 
-00000d40: 2020 2022 2222 0a3c 6272 3e3c 7370 616e     """.<br><span
-00000d50: 2073 7479 6c65 3d22 706f 7369 7469 6f6e   style="position
-00000d60: 3a61 6273 6f6c 7574 653b 2062 6f72 6465  :absolute; borde
-00000d70: 723a 2067 7261 7920 3170 7820 736f 6c69  r: gray 1px soli
-00000d80: 643b 206c 6566 743a 3070 783b 2074 6f70  d; left:0px; top
-00000d90: 3a39 3431 7078 3b20 7769 6474 683a 3539  :941px; width:59
-00000da0: 3570 783b 2068 6569 6768 743a 3834 3170  5px; height:841p
-00000db0: 783b 223e 3c2f 7370 616e 3e0a 3c64 6976  x;"></span>.<div
-00000dc0: 2073 7479 6c65 3d22 706f 7369 7469 6f6e   style="position
-00000dd0: 3a61 6273 6f6c 7574 653b 2074 6f70 3a39  :absolute; top:9
-00000de0: 3431 7078 3b22 3e3c 6120 6e61 6d65 3d22  41px;"><a name="
-00000df0: 3222 3e50 6167 6520 323c 2f61 3e3c 2f64  2">Page 2</a></d
-00000e00: 6976 3e0a 0a66 6f72 2049 5043 4320 746f  iv>..for IPCC to
-00000e10: 7028 5061 6765 3129 203d 2035 300a 746f  p(Page1) = 50.to
-00000e20: 7028 5061 6765 6e29 203d 2035 3020 2b20  p(Pagen) = 50 + 
-00000e30: 286e 202d 2031 2920 2a20 2838 3431 202b  (n - 1) * (841 +
-00000e40: 2034 3729 0a0a 2020 2020 2222 220a 0a20   47)..    """.. 
-00000e50: 2020 2064 6566 205f 5f69 6e69 745f 5f28     def __init__(
-00000e60: 7365 6c66 2c20 6373 735f 7374 796c 653d  self, css_style=
-00000e70: 4e6f 6e65 293a 0a20 2020 2020 2020 2073  None):.        s
-00000e80: 656c 662e 6373 735f 7374 796c 6520 3d20  elf.css_style = 
-00000e90: 6373 735f 7374 796c 650a 2020 2020 2020  css_style.      
-00000ea0: 2020 7365 6c66 2e62 626f 7820 3d20 4242    self.bbox = BB
-00000eb0: 6f78 2829 2020 2320 756e 696e 6974 6961  ox()  # uninitia
-00000ec0: 6c69 7365 640a 2020 2020 2020 2020 6966  lised.        if
-00000ed0: 2073 656c 662e 6373 735f 7374 796c 653a   self.css_style:
-00000ee0: 0a20 2020 2020 2020 2020 2020 2074 6f70  .            top
-00000ef0: 203d 2073 656c 662e 6373 735f 7374 796c   = self.css_styl
-00000f00: 652e 746f 700a 2020 2020 2020 2020 2020  e.top.          
-00000f10: 2020 6c65 6674 203d 2073 656c 662e 6373    left = self.cs
-00000f20: 735f 7374 796c 652e 6c65 6674 0a20 2020  s_style.left.   
-00000f30: 2020 2020 2020 2020 2077 6964 7468 203d           width =
-00000f40: 2073 656c 662e 6373 735f 7374 796c 652e   self.css_style.
-00000f50: 7769 6474 680a 2020 2020 2020 2020 2020  width.          
-00000f60: 2020 6865 6967 6874 203d 2073 656c 662e    height = self.
-00000f70: 6373 735f 7374 796c 652e 6865 6967 6874  css_style.height
-00000f80: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00000f90: 662e 6262 6f78 2e78 795f 7261 6e67 6573  f.bbox.xy_ranges
-00000fa0: 203d 205b 5b6c 6566 742c 206c 6566 7420   = [[left, left 
-00000fb0: 2b20 7769 6474 685d 2c20 5b74 6f70 2c20  + width], [top, 
-00000fc0: 746f 7020 2b20 6865 6967 6874 5d5d 0a20  top + height]]. 
-00000fd0: 2020 2020 2020 2073 656c 662e 656c 656d         self.elem
-00000fe0: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
-00000ff0: 7365 6c66 2e69 6e74 5f6e 756d 6265 7220  self.int_number 
-00001000: 3d20 4e6f 6e65 2020 2320 7064 6670 6c75  = None  # pdfplu
-00001010: 6d62 6572 2069 6e74 6567 6572 2070 6167  mber integer pag
-00001020: 6520 2831 2d62 6173 6564 290a 2020 2020  e (1-based).    
-00001030: 2020 2020 7365 6c66 2e70 5f6e 756d 5f73      self.p_num_s
-00001040: 7472 203d 204e 6f6e 6520 2023 2070 6466  tr = None  # pdf
-00001050: 706c 756d 6265 7220 2250 6167 6520 3132  plumber "Page 12
-00001060: 220a 0a20 2020 2040 7072 6f70 6572 7479  "..    @property
-00001070: 0a20 2020 2064 6566 2070 6167 655f 6e75  .    def page_nu
-00001080: 6d62 6572 2873 656c 6629 3a0a 2020 2020  mber(self):.    
-00001090: 2020 2020 6966 206e 6f74 2073 656c 662e      if not self.
-000010a0: 696e 745f 6e75 6d62 6572 3a0a 2020 2020  int_number:.    
-000010b0: 2020 2020 2020 2020 7365 6c66 2e69 6e74          self.int
-000010c0: 5f6e 756d 6265 7220 3d20 4e6f 6e65 2069  _number = None i
-000010d0: 6620 7365 6c66 2e65 6c65 6d20 6973 204e  f self.elem is N
-000010e0: 6f6e 6520 656c 7365 2050 6167 6542 6f78  one else PageBox
-000010f0: 2e65 7874 7261 6374 5f70 6167 655f 6e75  .extract_page_nu
-00001100: 6d62 6572 5f66 726f 6d5f 7064 665f 6874  mber_from_pdf_ht
-00001110: 6d6c 2873 656c 662e 656c 656d 290a 2020  ml(self.elem).  
-00001120: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-00001130: 662e 696e 745f 6e75 6d62 6572 0a0a 2020  f.int_number..  
-00001140: 2020 4063 6c61 7373 6d65 7468 6f64 0a20    @classmethod. 
-00001150: 2020 2064 6566 2065 7874 7261 6374 5f70     def extract_p
-00001160: 6167 655f 6e75 6d62 6572 5f66 726f 6d5f  age_number_from_
-00001170: 7064 665f 6874 6d6c 2863 6c73 2c20 656c  pdf_html(cls, el
-00001180: 656d 293a 0a20 2020 2020 2020 2022 2222  em):.        """
-00001190: 0a20 2020 2020 2020 2073 6f6d 6520 656c  .        some el
-000011a0: 656d 656e 7473 203f 7370 616e 7329 2066  ements ?spans) f
-000011b0: 726f 6d20 7064 6620 7061 7273 696e 6720  rom pdf parsing 
-000011c0: 6861 7665 2074 6865 2066 6f72 6d3a 0a20  have the form:. 
-000011d0: 2020 2020 2020 203c 6469 7620 2e2e 2e3e         <div ...>
-000011e0: 3c61 206e 616d 653d 2232 223e 5061 6765  <a name="2">Page
-000011f0: 2032 3c2f 613e 0a0a 2020 2020 2020 2020   2</a>..        
-00001200: 3a70 6172 616d 2065 6c65 6d3a 2063 6f6e  :param elem: con
-00001210: 7461 696e 7320 7061 6765 206e 756d 6265  tains page numbe
-00001220: 720a 2020 2020 2020 2020 3a72 6574 7572  r.        :retur
-00001230: 6e3a 2070 6167 6520 6e75 6d62 6572 206f  n: page number o
-00001240: 7220 6e6f 6e65 0a20 2020 2020 2020 2022  r none.        "
-00001250: 2222 0a20 2020 2020 2020 2069 6620 656c  "".        if el
-00001260: 656d 2069 7320 4e6f 6e65 3a0a 2020 2020  em is None:.    
-00001270: 2020 2020 2020 2020 7265 7475 726e 204e          return N
-00001280: 6f6e 650a 2020 2020 2020 2020 7870 6174  one.        xpat
-00001290: 6878 203d 2066 222e 2f2f 612f 407b 415f  hx = f".//a/@{A_
-000012a0: 4e41 4d45 7d22 0a20 2020 2020 2020 2061  NAME}".        a
-000012b0: 6e61 6d65 203d 2065 6c65 6d2e 7870 6174  name = elem.xpat
-000012c0: 6828 7870 6174 6878 290a 2020 2020 2020  h(xpathx).      
-000012d0: 2020 7265 7475 726e 2061 6e61 6d65 0a0a    return aname..
-000012e0: 2020 2020 6465 6620 6164 645f 7374 796c      def add_styl
-000012f0: 655f 7370 616e 5f61 6e64 5f70 6167 655f  e_span_and_page_
-00001300: 6e75 6d62 6572 2873 656c 662c 2065 6c65  number(self, ele
-00001310: 6d29 3a0a 2020 2020 2020 2020 2222 220a  m):.        """.
-00001320: 2020 2020 2020 2020 6164 6420 7374 796c          add styl
-00001330: 6520 7370 616e 2020 616e 6420 616c 736f  e span  and also
-00001340: 2067 6574 2070 6167 656e 756d 6265 7220   get pagenumber 
-00001350: 6672 6f6d 206e 6578 7420 656c 656d 656e  from next elemen
-00001360: 740a 0a20 2020 2020 2020 2074 7970 6963  t..        typic
-00001370: 616c 2074 7261 696c 696e 6720 656c 656d  al trailing elem
-00001380: 656e 740a 2020 2020 2020 2020 3c64 6976  ent.        <div
-00001390: 2073 7479 6c65 3d22 706f 7369 7469 6f6e   style="position
-000013a0: 3a61 6273 6f6c 7574 653b 2074 6f70 3a31  :absolute; top:1
-000013b0: 3037 3533 7078 3b22 3e3c 6120 6e61 6d65  0753px;"><a name
-000013c0: 3d22 3133 223e 5061 6765 2031 333c 2f61  ="13">Page 13</a
-000013d0: 3e3c 2f64 6976 3e0a 2020 2020 2020 2020  ></div>.        
-000013e0: 2222 220a 2020 2020 2020 2020 7365 6c66  """.        self
-000013f0: 2e65 6c65 6d20 3d20 656c 656d 0a20 2020  .elem = elem.   
-00001400: 2020 2020 2070 6167 655f 6469 7620 3d20       page_div = 
-00001410: 656c 656d 2e67 6574 6e65 7874 2829 0a20  elem.getnext(). 
-00001420: 2020 2020 2020 2069 6620 7061 6765 5f64         if page_d
-00001430: 6976 2069 7320 6e6f 7420 4e6f 6e65 3a0a  iv is not None:.
-00001440: 2020 2020 2020 2020 2020 2020 6e20 3d20              n = 
-00001450: 7061 6765 5f64 6976 2e78 7061 7468 2866  page_div.xpath(f
-00001460: 222e 2f61 2f40 7b41 5f4e 414d 457d 2229  "./a/@{A_NAME}")
-00001470: 0a20 2020 2020 2020 2020 2020 206e 203d  .            n =
-00001480: 206e 5b30 5d20 6966 206c 656e 286e 2920   n[0] if len(n) 
-00001490: 3d3d 2031 2065 6c73 6520 4e6f 6e65 0a20  == 1 else None. 
-000014a0: 2020 2020 2020 2020 2020 2069 6620 6e3a             if n:
-000014b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000014c0: 2073 656c 662e 696e 745f 6e75 6d62 6572   self.int_number
-000014d0: 203d 2069 6e74 286e 290a 0a20 2020 2020   = int(n)..     
-000014e0: 2020 2020 2020 2070 203d 2070 6167 655f         p = page_
-000014f0: 6469 762e 7870 6174 6828 6622 2e2f 615b  div.xpath(f"./a[
-00001500: 407b 415f 4e41 4d45 7d20 616e 6420 636f  @{A_NAME} and co
-00001510: 6e74 6169 6e73 282e 2c20 2750 6167 6527  ntains(., 'Page'
-00001520: 295d 2229 0a20 2020 2020 2020 2020 2020  )]").           
-00001530: 2073 656c 662e 705f 6e75 6d5f 7374 7220   self.p_num_str 
-00001540: 3d20 705b 305d 2069 6620 6c65 6e28 7029  = p[0] if len(p)
-00001550: 203d 3d20 3120 656c 7365 204e 6f6e 650a   == 1 else None.
-00001560: 0a0a 636c 6173 7320 4874 6d6c 5469 6479  ..class HtmlTidy
-00001570: 3a0a 2020 2020 2222 2266 6f72 2074 6964  :.    """for tid
-00001580: 7969 6e67 2050 4446 202f 2053 5647 2f20  ying PDF / SVG/ 
-00001590: 4f43 5220 7061 7273 696e 670a 2020 2020  OCR parsing.    
-000015a0: 7461 6b65 7320 7261 7720 4854 4d4c 2028  takes raw HTML (
-000015b0: 7072 6f62 6162 6c79 2073 6361 7474 6572  probably scatter
-000015c0: 6564 2077 6f72 6473 206f 7220 6c69 6e65  ed words or line
-000015d0: 7320 2c20 706f 7373 6962 6c79 2077 6974  s , possibly wit
-000015e0: 6820 636f 6f72 6469 6e61 7465 7320 616e  h coordinates an
-000015f0: 6420 6372 6561 7465 730a 2020 2020 666c  d creates.    fl
-00001600: 6f77 696e 6720 7374 796c 6564 2048 544d  owing styled HTM
-00001610: 4c20 7769 7468 2073 7562 7363 7269 7074  L with subscript
-00001620: 732c 2066 6f6e 7420 7374 796c 6573 2c20  s, font styles, 
-00001630: 6574 632e 0a20 2020 2022 2222 0a0a 2020  etc..    """..  
-00001640: 2020 4d49 4e5f 5041 4745 5f42 4f58 5f48    MIN_PAGE_BOX_H
-00001650: 4549 4748 5420 3d20 3330 3020 2023 2061  EIGHT = 300  # a
-00001660: 6c6c 6f77 7320 666f 7220 6c61 6e64 7363  llows for landsc
-00001670: 6170 650a 2020 2020 4845 4144 5f45 4c45  ape.    HEAD_ELE
-00001680: 4d53 5f49 4e5f 5850 4154 4820 3d20 6622  MS_IN_XPATH = f"
-00001690: 7b48 5f4d 4554 417d 207c 207b 485f 5449  {H_META} | {H_TI
-000016a0: 544c 457d 207c 207b 485f 5343 5249 5054  TLE} | {H_SCRIPT
-000016b0: 7d20 7c20 7b48 5f53 5459 4c45 7d22 0a0a  } | {H_STYLE}"..
-000016c0: 2020 2020 6465 6620 5f5f 696e 6974 5f5f      def __init__
-000016d0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-000016e0: 7365 6c66 2e75 6e77 616e 7465 6473 203d  self.unwanteds =
-000016f0: 205b 5d20 2023 206e 6f74 2073 7572 6520   []  # not sure 
-00001700: 7768 6174 2074 6869 7320 6973 0a20 2020  what this is.   
-00001710: 2020 2020 2073 656c 662e 656d 7074 795f       self.empty_
-00001720: 656c 656d 656e 7473 5f74 6f5f 7265 6d6f  elements_to_remo
-00001730: 7665 203d 205b 5d0a 2020 2020 2020 2020  ve = [].        
-00001740: 7365 6c66 2e73 7479 6c65 735f 746f 5f72  self.styles_to_r
-00001750: 656d 6f76 6520 3d20 5b5d 0a20 2020 2020  emove = [].     
-00001760: 2020 2073 656c 662e 6465 7363 656e 6461     self.descenda
-00001770: 6e74 735f 746f 5f72 656d 6f76 6520 3d20  nts_to_remove = 
-00001780: 5b5d 0a20 2020 2020 2020 2073 656c 662e  [].        self.
-00001790: 7265 6d6f 7665 5f6c 685f 6c69 6e65 5f6e  remove_lh_line_n
-000017a0: 756d 6265 7273 203d 2054 7275 650a 2020  umbers = True.  
-000017b0: 2020 2020 2020 7365 6c66 2e72 656d 6f76        self.remov
-000017c0: 655f 6c61 7267 655f 666f 6e74 6564 5f65  e_large_fonted_e
-000017d0: 6c65 6d65 6e74 7320 3d20 5472 7565 0a20  lements = True. 
-000017e0: 2020 2020 2020 2073 656c 662e 7374 796c         self.styl
-000017f0: 655f 6174 7472 6962 7574 6573 5f74 6f5f  e_attributes_to_
-00001800: 7265 6d6f 7665 203d 205b 5d0a 2020 2020  remove = [].    
-00001810: 2020 2020 7365 6c66 2e6d 6172 6b65 725f      self.marker_
-00001820: 7870 6174 6820 3d20 4e6f 6e65 0a20 2020  xpath = None.   
-00001830: 2020 2020 2073 656c 662e 7374 796c 655f       self.style_
-00001840: 6174 7472 6962 7574 6573 5f74 6f5f 7265  attributes_to_re
-00001850: 6d6f 7665 203d 205b 5d0a 0a20 2020 2020  move = []..     
-00001860: 2020 2073 656c 662e 6164 645f 6964 203d     self.add_id =
-00001870: 2054 7275 650a 2020 2020 2020 2020 7365   True.        se
-00001880: 6c66 2e68 6561 6465 7220 3d20 3830 0a20  lf.header = 80. 
-00001890: 2020 2020 2020 2073 656c 662e 666f 6f74         self.foot
-000018a0: 6572 203d 2038 300a 2020 2020 2020 2020  er = 80.        
-000018b0: 7365 6c66 2e70 6167 655f 746f 7073 203d  self.page_tops =
-000018c0: 204e 6f6e 650a 2020 2020 2020 2020 7365   None.        se
-000018d0: 6c66 2e70 6167 655f 626f 7865 7320 3d20  lf.page_boxes = 
-000018e0: 5b5d 0a20 2020 2020 2020 2073 656c 662e  [].        self.
-000018f0: 7261 775f 656c 656d 203d 204e 6f6e 650a  raw_elem = None.
-00001900: 2020 2020 2020 2020 7365 6c66 2e6f 7574          self.out
-00001910: 6469 7220 3d20 4e6f 6e65 0a0a 2020 2020  dir = None..    
-00001920: 6465 6620 7469 6479 5f66 6c6f 7728 7365  def tidy_flow(se
-00001930: 6c66 2c20 7261 775f 6874 6d6c 293a 0a20  lf, raw_html):. 
-00001940: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00001950: 2020 204e 6565 6420 746f 2063 6170 7475     Need to captu
-00001960: 7265 2070 6167 6520 696e 666f 726d 6174  re page informat
-00001970: 696f 6e20 746f 2063 6f6d 7075 7465 2070  ion to compute p
-00001980: 6167 6520 636f 6f72 6469 6e61 7465 732c  age coordinates,
-00001990: 206e 6f74 2064 6f63 756d 656e 7420 636f   not document co
-000019a0: 6f72 6469 6e61 7465 730a 2020 2020 2020  ordinates.      
-000019b0: 2020 636f 6e76 6572 7473 2072 6177 2068    converts raw h
-000019c0: 746d 6c20 746f 2074 6964 790a 2020 2020  tml to tidy.    
-000019d0: 2020 2020 2222 220a 0a20 2020 2020 2020      """..       
-000019e0: 2023 2054 4f44 4f20 6368 6563 6b20 616e   # TODO check an
-000019f0: 6420 6d6f 7665 2074 6f20 696e 7374 616e  d move to instan
-00001a00: 6365 206f 6620 4874 6d6c 5469 6479 0a0a  ce of HtmlTidy..
-00001a10: 2020 2020 2020 2020 6966 2072 6177 5f68          if raw_h
-00001a20: 746d 6c20 6973 204e 6f6e 653a 0a20 2020  tml is None:.   
-00001a30: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
-00001a40: 616c 7565 4572 726f 7228 224e 6f20 4854  alueError("No HT
-00001a50: 4d4c 2229 0a20 2020 2020 2020 2072 6177  ML").        raw
-00001a60: 5f74 7265 6520 3d20 4554 2e70 6172 7365  _tree = ET.parse
-00001a70: 2853 7472 696e 6749 4f28 7261 775f 6874  (StringIO(raw_ht
-00001a80: 6d6c 292c 2045 542e 4854 4d4c 5061 7273  ml), ET.HTMLPars
-00001a90: 6572 2829 290a 2020 2020 2020 2020 7365  er()).        se
-00001aa0: 6c66 2e72 6177 5f65 6c65 6d20 3d20 7261  lf.raw_elem = ra
-00001ab0: 775f 7472 6565 2e67 6574 726f 6f74 2829  w_tree.getroot()
-00001ac0: 0a20 2020 2020 2020 2073 656c 662e 6578  .        self.ex
-00001ad0: 7472 6163 745f 7061 6765 5f62 6f78 6573  tract_page_boxes
-00001ae0: 2829 0a0a 2020 2020 2020 2020 7365 6c66  ()..        self
-00001af0: 2e61 6464 5f65 6c65 6d65 6e74 2873 656c  .add_element(sel
-00001b00: 662e 7261 775f 656c 656d 290a 0a20 2020  f.raw_elem)..   
-00001b10: 2020 2020 2023 2074 6869 7320 6973 2073       # this is s
-00001b20: 6574 2062 7920 7573 6572 0a20 2020 2020  et by user.     
-00001b30: 2020 2073 656c 662e 7365 745f 7265 6d6f     self.set_remo
-00001b40: 7665 5f66 6c61 6773 2829 0a0a 2020 2020  ve_flags()..    
-00001b50: 2020 2020 7365 6c66 2e72 656d 6f76 655f      self.remove_
-00001b60: 756e 7761 6e74 6564 5f61 7474 7269 6275  unwanted_attribu
-00001b70: 7465 735f 616e 645f 656c 656d 656e 7473  tes_and_elements
-00001b80: 2829 0a20 2020 2020 2020 2070 6167 6573  ().        pages
-00001b90: 697a 6520 3d20 4e6f 6e65 0a20 2020 2020  ize = None.     
-00001ba0: 2020 2069 6620 7365 6c66 2e6d 6172 6b65     if self.marke
-00001bb0: 725f 7870 6174 683a 0a20 2020 2020 2020  r_xpath:.       
-00001bc0: 2020 2020 206f 6666 7365 742c 2070 6167       offset, pag
-00001bd0: 6573 697a 652c 2070 6167 655f 636f 6f72  esize, page_coor
-00001be0: 6473 203d 2048 746d 6c55 7469 6c2e 6669  ds = HtmlUtil.fi
-00001bf0: 6e64 5f63 6f6e 7374 616e 745f 636f 6f72  nd_constant_coor
-00001c00: 6469 6e61 7465 5f6d 6172 6b65 7273 2873  dinate_markers(s
-00001c10: 656c 662e 7261 775f 656c 656d 2c20 7365  elf.raw_elem, se
-00001c20: 6c66 2e6d 6172 6b65 725f 7870 6174 6829  lf.marker_xpath)
-00001c30: 0a20 2020 2020 2020 2020 2020 2048 746d  .            Htm
-00001c40: 6c55 7469 6c2e 7265 6d6f 7665 5f68 6561  lUtil.remove_hea
-00001c50: 6465 7273 5f61 6e64 5f66 6f6f 7465 7273  ders_and_footers
-00001c60: 5f75 7369 6e67 5f70 6466 6d69 6e65 725f  _using_pdfminer_
-00001c70: 636f 6f72 6473 280a 2020 2020 2020 2020  coords(.        
-00001c80: 2020 2020 2020 2020 7365 6c66 2e72 6177          self.raw
-00001c90: 5f65 6c65 6d2c 0a20 2020 2020 2020 2020  _elem,.         
-00001ca0: 2020 2020 2020 2070 6167 6573 697a 652c         pagesize,
-00001cb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00001cc0: 2073 656c 662e 6865 6164 6572 2c0a 2020   self.header,.  
-00001cd0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00001ce0: 6c66 2e66 6f6f 7465 722c 0a20 2020 2020  lf.footer,.     
-00001cf0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00001d00: 6d61 726b 6572 5f78 7061 7468 2c0a 2020  marker_xpath,.  
-00001d10: 2020 2020 2020 2020 2020 2020 2020 7061                pa
-00001d20: 6765 5f74 6f70 733d 7365 6c66 2e70 6167  ge_tops=self.pag
-00001d30: 655f 746f 7073 2c0a 2020 2020 2020 2020  e_tops,.        
-00001d40: 2020 2020 290a 2020 2020 2020 2020 666f      ).        fo
-00001d50: 7220 6174 7420 696e 2073 656c 662e 7374  r att in self.st
-00001d60: 796c 655f 6174 7472 6962 7574 6573 5f74  yle_attributes_t
-00001d70: 6f5f 7265 6d6f 7665 3a0a 2020 2020 2020  o_remove:.      
-00001d80: 2020 2020 2020 4874 6d6c 5574 696c 2e72        HtmlUtil.r
-00001d90: 656d 6f76 655f 7374 796c 655f 6174 7472  emove_style_attr
-00001da0: 6962 7574 6528 7365 6c66 2e72 6177 5f65  ibute(self.raw_e
-00001db0: 6c65 6d2c 2061 7474 290a 2020 2020 2020  lem, att).      
-00001dc0: 2020 4874 6d6c 5574 696c 2e72 656d 6f76    HtmlUtil.remov
-00001dd0: 655f 756e 7761 6e74 6564 7328 7365 6c66  e_unwanteds(self
-00001de0: 2e72 6177 5f65 6c65 6d2c 2073 656c 662e  .raw_elem, self.
-00001df0: 756e 7761 6e74 6564 7329 0a20 2020 2020  unwanteds).     
-00001e00: 2020 2048 746d 6c55 7469 6c2e 7265 6d6f     HtmlUtil.remo
-00001e10: 7665 5f6e 6577 6c69 6e65 7328 7365 6c66  ve_newlines(self
-00001e20: 2e72 6177 5f65 6c65 6d29 0a20 2020 2020  .raw_elem).     
-00001e30: 2020 2048 746d 6c54 7265 652e 6d61 6b65     HtmlTree.make
-00001e40: 5f73 6563 7469 6f6e 735f 616e 645f 6f75  _sections_and_ou
-00001e50: 7470 7574 2873 656c 662e 7261 775f 656c  tput(self.raw_el
-00001e60: 656d 2c20 6f75 7470 7574 5f64 6972 3d73  em, output_dir=s
-00001e70: 656c 662e 6f75 7464 6972 2c20 7265 6373  elf.outdir, recs
-00001e80: 5f62 795f 7365 6374 696f 6e3d 5245 4353  _by_section=RECS
-00001e90: 5f42 595f 5345 4354 494f 4e29 0a20 2020  _BY_SECTION).   
-00001ea0: 2020 2020 2068 746d 6c73 7472 203d 2045       htmlstr = E
-00001eb0: 542e 746f 7374 7269 6e67 2873 656c 662e  T.tostring(self.
-00001ec0: 7261 775f 656c 656d 2c20 656e 636f 6469  raw_elem, encodi
-00001ed0: 6e67 3d5f 5554 4638 292e 6465 636f 6465  ng=_UTF8).decode
-00001ee0: 2829 0a20 2020 2020 2020 2072 6574 7572  ().        retur
-00001ef0: 6e20 6874 6d6c 7374 720a 0a20 2020 2064  n htmlstr..    d
-00001f00: 6566 2072 656d 6f76 655f 756e 7761 6e74  ef remove_unwant
-00001f10: 6564 5f61 7474 7269 6275 7465 735f 616e  ed_attributes_an
-00001f20: 645f 656c 656d 656e 7473 2873 656c 6629  d_elements(self)
-00001f30: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-00001f40: 2020 2020 2020 7265 6d6f 7665 206f 626a        remove obj
-00001f50: 6563 7473 2069 6620 666c 6167 7320 6861  ects if flags ha
-00001f60: 7665 2062 6565 6e20 7365 7420 696e 2073  ve been set in s
-00001f70: 656c 660a 2020 2020 2020 2020 2222 220a  elf.        """.
-00001f80: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-00001f90: 6164 645f 6964 3a0a 2020 2020 2020 2020  add_id:.        
-00001fa0: 2020 2020 4874 6d6c 5574 696c 2e61 6464      HtmlUtil.add
-00001fb0: 5f67 656e 6572 6174 6564 5f69 6473 2873  _generated_ids(s
-00001fc0: 656c 662e 7261 775f 656c 656d 290a 2020  elf.raw_elem).  
-00001fd0: 2020 2020 2020 666f 7220 7461 6720 696e        for tag in
-00001fe0: 2073 656c 662e 6465 7363 656e 6461 6e74   self.descendant
-00001ff0: 735f 746f 5f72 656d 6f76 653a 0a20 2020  s_to_remove:.   
-00002000: 2020 2020 2020 2020 2045 542e 7374 7269           ET.stri
-00002010: 705f 7461 6773 2873 656c 662e 7261 775f  p_tags(self.raw_
-00002020: 656c 656d 2c20 5b74 6167 5d29 0a20 2020  elem, [tag]).   
-00002030: 2020 2020 2069 6620 7365 6c66 2e72 656d       if self.rem
-00002040: 6f76 655f 6c68 5f6c 696e 655f 6e75 6d62  ove_lh_line_numb
-00002050: 6572 733a 0a20 2020 2020 2020 2020 2020  ers:.           
-00002060: 2048 746d 6c55 7469 6c2e 7265 6d6f 7665   HtmlUtil.remove
-00002070: 5f6c 685f 6c69 6e65 5f6e 756d 6265 7273  _lh_line_numbers
-00002080: 2873 656c 662e 7261 775f 656c 656d 290a  (self.raw_elem).
-00002090: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-000020a0: 7265 6d6f 7665 5f6c 6172 6765 5f66 6f6e  remove_large_fon
-000020b0: 7465 645f 656c 656d 656e 7473 3a0a 2020  ted_elements:.  
-000020c0: 2020 2020 2020 2020 2020 4874 6d6c 5574            HtmlUt
-000020d0: 696c 2e72 656d 6f76 655f 6c61 7267 655f  il.remove_large_
-000020e0: 666f 6e74 6564 5f65 6c65 6d65 6e74 7328  fonted_elements(
-000020f0: 7365 6c66 2e72 6177 5f65 6c65 6d29 0a20  self.raw_elem). 
-00002100: 2020 2020 2020 2066 6f72 2074 6167 2069         for tag i
-00002110: 6e20 7365 6c66 2e65 6d70 7479 5f65 6c65  n self.empty_ele
-00002120: 6d65 6e74 735f 746f 5f72 656d 6f76 653a  ments_to_remove:
-00002130: 0a20 2020 2020 2020 2020 2020 2048 746d  .            Htm
-00002140: 6c55 7469 6c2e 7265 6d6f 7665 5f65 6d70  lUtil.remove_emp
-00002150: 7479 5f65 6c65 6d65 6e74 7328 7365 6c66  ty_elements(self
-00002160: 2e72 6177 5f65 6c65 6d2c 205b 7461 675d  .raw_elem, [tag]
-00002170: 290a 2020 2020 2020 2020 666f 7220 7374  ).        for st
-00002180: 796c 6520 696e 2073 656c 662e 7374 796c  yle in self.styl
-00002190: 6573 5f74 6f5f 7265 6d6f 7665 3a0a 2020  es_to_remove:.  
-000021a0: 2020 2020 2020 2020 2020 4874 6d6c 5574            HtmlUt
-000021b0: 696c 2e72 656d 6f76 655f 7374 796c 6528  il.remove_style(
-000021c0: 7365 6c66 2e72 6177 5f65 6c65 6d2c 205b  self.raw_elem, [
-000021d0: 7374 796c 655d 290a 0a20 2020 2064 6566  style])..    def
-000021e0: 2073 6574 5f72 656d 6f76 655f 666c 6167   set_remove_flag
-000021f0: 7328 7365 6c66 293a 0a20 2020 2020 2020  s(self):.       
-00002200: 2022 2222 0a20 2020 2020 2020 2073 6574   """.        set
-00002210: 2066 6c61 6773 2077 6869 6368 2064 6972   flags which dir
-00002220: 6563 7420 7265 6d6f 7661 6c20 6f66 2065  ect removal of e
-00002230: 6c65 6d65 6e74 732f 6174 7472 6962 7574  lements/attribut
-00002240: 6573 0a20 2020 2020 2020 206e 6f72 6d61  es.        norma
-00002250: 6c6c 7920 756e 6465 7220 7573 6572 2063  lly under user c
-00002260: 6f6e 7472 6f6c 0a20 2020 2020 2020 2022  ontrol.        "
-00002270: 2222 0a20 2020 2020 2020 2073 656c 662e  "".        self.
-00002280: 6164 645f 6465 7363 656e 6461 6e74 5f65  add_descendant_e
-00002290: 6c65 6d65 6e74 5f74 6f5f 7265 6d6f 7665  lement_to_remove
-000022a0: 285b 2262 7222 5d29 0a20 2020 2020 2020  (["br"]).       
-000022b0: 2073 656c 662e 6164 645f 7374 796c 6573   self.add_styles
-000022c0: 5f74 6f5f 7265 6d6f 7665 280a 2020 2020  _to_remove(.    
-000022d0: 2020 2020 2020 2020 5b0a 2020 2020 2020          [.      
-000022e0: 2020 2020 2020 2020 2020 535f 504f 5349            S_POSI
-000022f0: 5449 4f4e 2c0a 2020 2020 2020 2020 2020  TION,.          
-00002300: 2020 2020 2020 2320 226c 6566 7422 2c0a        # "left",.
-00002310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002320: 535f 424f 5244 4552 2c0a 2020 2020 2020  S_BORDER,.      
-00002330: 2020 2020 2020 2020 2020 535f 5752 4954            S_WRIT
-00002340: 494e 475f 4d4f 4445 2c0a 2020 2020 2020  ING_MODE,.      
-00002350: 2020 2020 2020 2020 2020 535f 5749 4454            S_WIDT
-00002360: 482c 2020 2320 7468 6973 2064 6973 6162  H,  # this disab
-00002370: 6c65 7320 666c 6f77 696e 6720 7465 7874  les flowing text
-00002380: 0a20 2020 2020 2020 2020 2020 205d 0a20  .            ]. 
-00002390: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-000023a0: 2073 656c 662e 6164 645f 6964 203d 2054   self.add_id = T
-000023b0: 7275 650a 2020 2020 2020 2020 7365 6c66  rue.        self
-000023c0: 2e61 6464 5f65 6d70 7479 5f65 6c65 6d65  .add_empty_eleme
-000023d0: 6e74 735f 746f 5f72 656d 6f76 6528 5b22  nts_to_remove(["
-000023e0: 7370 616e 222c 2022 6469 7622 5d29 0a20  span", "div"]). 
-000023f0: 2020 2020 2020 2073 656c 662e 7265 6d6f         self.remo
-00002400: 7665 5f6c 685f 6c69 6e65 5f6e 756d 6265  ve_lh_line_numbe
-00002410: 7273 203d 2054 7275 6520 2023 2078 0a20  rs = True  # x. 
-00002420: 2020 2020 2020 2073 656c 662e 7265 6d6f         self.remo
-00002430: 7665 5f6c 6172 6765 5f66 6f6e 7465 645f  ve_large_fonted_
-00002440: 656c 656d 656e 7473 203d 2054 7275 650a  elements = True.
-00002450: 2020 2020 2020 2020 7365 6c66 2e73 7479          self.sty
-00002460: 6c65 5f61 7474 7269 6275 7465 735f 746f  le_attributes_to
-00002470: 5f72 656d 6f76 6520 3d20 5b22 746f 7022  _remove = ["top"
-00002480: 5d0a 2020 2020 2020 2020 7365 6c66 2e6d  ].        self.m
-00002490: 6172 6b65 725f 7870 6174 6820 3d20 222e  arker_xpath = ".
-000024a0: 2f2f 6469 765b 615b 406e 616d 655d 5d22  //div[a[@name]]"
-000024b0: 0a20 2020 2020 2020 2073 656c 662e 7374  .        self.st
-000024c0: 796c 655f 6174 7472 6962 7574 6573 5f74  yle_attributes_t
-000024d0: 6f5f 7265 6d6f 7665 203d 205b 226c 6566  o_remove = ["lef
-000024e0: 7422 2c20 2268 6569 6768 7422 5d0a 0a20  t", "height"].. 
-000024f0: 2020 2064 6566 2065 7874 7261 6374 5f70     def extract_p
-00002500: 6167 655f 626f 7865 7328 7365 6c66 2c20  age_boxes(self, 
-00002510: 7261 6e67 6573 3d4e 6f6e 6529 3a0a 2020  ranges=None):.  
-00002520: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00002530: 2020 4261 7365 6420 6f6e 2070 6466 706c    Based on pdfpl
-00002540: 756d 6265 7220 6f75 7470 7574 0a20 2020  umber output.   
-00002550: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00002560: 2073 656c 662e 7061 6765 5f62 6f78 6573   self.page_boxes
-00002570: 203d 205b 5d20 2023 2070 6167 6542 6f78   = []  # pageBox
-00002580: 206d 6179 206d 6572 6765 2077 6974 6820   may merge with 
-00002590: 416d 6950 6167 650a 0a20 2020 2020 2020  AmiPage..       
-000025a0: 2069 6620 7365 6c66 2e72 6177 5f65 6c65   if self.raw_ele
-000025b0: 6d20 6973 204e 6f6e 653a 0a20 2020 2020  m is None:.     
-000025c0: 2020 2020 2020 2072 6574 7572 6e0a 2020         return.  
-000025d0: 2020 2020 2020 7374 796c 655f 7370 616e        style_span
-000025e0: 7320 3d20 7365 6c66 2e72 6177 5f65 6c65  s = self.raw_ele
-000025f0: 6d2e 7870 6174 6828 222f 2f73 7061 6e5b  m.xpath("//span[
-00002600: 636f 6e74 6169 6e73 2840 7374 796c 652c  contains(@style,
-00002610: 2770 6f73 6974 696f 6e3a 6162 736f 6c75  'position:absolu
-00002620: 7465 2729 5d22 290a 2020 2020 2020 2020  te')]").        
-00002630: 666f 7220 7374 796c 655f 7370 616e 2069  for style_span i
-00002640: 6e20 7374 796c 655f 7370 616e 733a 0a20  n style_spans:. 
-00002650: 2020 2020 2020 2020 2020 2063 7373 5f73             css_s
-00002660: 7479 6c65 203d 2043 5353 5374 796c 652e  tyle = CSSStyle.
-00002670: 6372 6561 7465 5f63 7373 5f73 7479 6c65  create_css_style
-00002680: 5f66 726f 6d5f 6174 7472 6962 7574 655f  _from_attribute_
-00002690: 6f66 5f62 6f64 795f 656c 656d 656e 7428  of_body_element(
-000026a0: 7374 796c 655f 7370 616e 290a 2020 2020  style_span).    
-000026b0: 2020 2020 2020 2020 6966 2063 7373 5f73          if css_s
-000026c0: 7479 6c65 2e68 6569 6768 7420 3e20 7365  tyle.height > se
-000026d0: 6c66 2e4d 494e 5f50 4147 455f 424f 585f  lf.MIN_PAGE_BOX_
-000026e0: 4845 4947 4854 3a0a 2020 2020 2020 2020  HEIGHT:.        
-000026f0: 2020 2020 2020 2020 7061 6765 5f62 6f78          page_box
-00002700: 203d 2050 6167 6542 6f78 2863 7373 5f73   = PageBox(css_s
-00002710: 7479 6c65 3d63 7373 5f73 7479 6c65 290a  tyle=css_style).
-00002720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002730: 7061 6765 5f62 6f78 2e61 6464 5f73 7479  page_box.add_sty
-00002740: 6c65 5f73 7061 6e5f 616e 645f 7061 6765  le_span_and_page
-00002750: 5f6e 756d 6265 7228 7374 796c 655f 7370  _number(style_sp
-00002760: 616e 290a 2020 2020 2020 2020 2020 2020  an).            
-00002770: 2020 2020 7365 6c66 2e70 6167 655f 626f      self.page_bo
-00002780: 7865 732e 6170 7065 6e64 2870 6167 655f  xes.append(page_
-00002790: 626f 7829 0a0a 2020 2020 2020 2020 7365  box)..        se
-000027a0: 6c66 2e65 7874 7261 6374 5f70 6167 655f  lf.extract_page_
-000027b0: 6e75 6d62 6572 7328 290a 0a20 2020 2064  numbers()..    d
-000027c0: 6566 2065 7874 7261 6374 5f70 6167 655f  ef extract_page_
-000027d0: 6e75 6d62 6572 7328 7365 6c66 293a 0a20  numbers(self):. 
-000027e0: 2020 2020 2020 2070 6167 656e 6f5f 7870         pageno_xp
-000027f0: 6174 6820 3d20 222f 2f73 7061 6e2f 6469  ath = "//span/di
-00002800: 762f 615b 406e 616d 655d 2220 2023 2070  v/a[@name]"  # p
-00002810: 6167 6520 6e75 6d62 6572 2062 6f78 6573  age number boxes
-00002820: 3b20 7468 6520 7061 7265 6e74 2073 7061  ; the parent spa
-00002830: 6e20 6973 2068 6f72 7269 640a 2020 2020  n is horrid.    
-00002840: 2020 2020 656c 656d 5f77 6974 685f 7061      elem_with_pa
-00002850: 6765 6e6f 7320 3d20 7365 6c66 2e72 6177  genos = self.raw
-00002860: 5f65 6c65 6d2e 7870 6174 6828 7061 6765  _elem.xpath(page
-00002870: 6e6f 5f78 7061 7468 290a 2020 2020 2020  no_xpath).      
-00002880: 2020 6373 735f 6c61 7374 203d 204e 6f6e    css_last = Non
-00002890: 650a 2020 2020 2020 2020 2222 223c 6272  e.        """<br
-000028a0: 3e3c 2f73 7061 6e3e 3c73 7061 6e20 7374  ></span><span st
-000028b0: 796c 653d 2266 6f6e 742d 6661 6d69 6c79  yle="font-family
-000028c0: 3a20 4361 6c69 6272 693b 2066 6f6e 742d  : Calibri; font-
-000028d0: 7369 7a65 3a31 3070 7822 3e20 0a20 2020  size:10px"> .   
-000028e0: 2020 2020 2020 2020 2020 2020 203c 6272               <br
-000028f0: 3e3c 7370 616e 2073 7479 6c65 3d22 706f  ><span style="po
-00002900: 7369 7469 6f6e 3a61 6273 6f6c 7574 653b  sition:absolute;
-00002910: 2062 6f72 6465 723a 2067 7261 7920 3170   border: gray 1p
-00002920: 7820 736f 6c69 643b 206c 6566 743a 3070  x solid; left:0p
-00002930: 783b 2074 6f70 3a39 3431 7078 3b20 7769  x; top:941px; wi
-00002940: 6474 683a 3539 3570 783b 2068 6569 6768  dth:595px; heigh
-00002950: 743a 3834 3170 783b 223e 3c2f 7370 616e  t:841px;"></span
-00002960: 3e0a 2020 2020 2020 2020 2020 2020 2020  >.              
-00002970: 2020 0a20 2020 2020 2020 2020 2020 2020    .             
-00002980: 2020 203c 6469 7620 7374 796c 653d 2270     <div style="p
-00002990: 6f73 6974 696f 6e3a 6162 736f 6c75 7465  osition:absolute
-000029a0: 3b20 746f 703a 3934 3170 783b 223e 3c61  ; top:941px;"><a
-000029b0: 206e 616d 653d 2232 223e 5061 6765 2032   name="2">Page 2
-000029c0: 3c2f 613e 3c2f 6469 763e 0a20 2020 2020  </a></div>.     
-000029d0: 2020 2020 2020 2020 2020 2022 2222 0a20             """. 
-000029e0: 2020 2020 2020 2066 6f72 2065 6c65 6d5f         for elem_
-000029f0: 7769 7468 5f70 6167 656e 6f20 696e 2065  with_pageno in e
-00002a00: 6c65 6d5f 7769 7468 5f70 6167 656e 6f73  lem_with_pagenos
-00002a10: 3a0a 2020 2020 2020 2020 2020 2020 6765  :.            ge
-00002a20: 7470 6172 656e 7420 3d20 656c 656d 5f77  tparent = elem_w
-00002a30: 6974 685f 7061 6765 6e6f 2e67 6574 7061  ith_pageno.getpa
-00002a40: 7265 6e74 2829 0a20 2020 2020 2020 2020  rent().         
-00002a50: 2020 2063 7373 203d 2043 5353 5374 796c     css = CSSStyl
-00002a60: 652e 6372 6561 7465 5f63 7373 5f73 7479  e.create_css_sty
-00002a70: 6c65 5f66 726f 6d5f 6174 7472 6962 7574  le_from_attribut
-00002a80: 655f 6f66 5f62 6f64 795f 656c 656d 656e  e_of_body_elemen
-00002a90: 7428 6765 7470 6172 656e 7429 0a20 2020  t(getparent).   
-00002aa0: 2020 2020 2020 2020 2070 7265 765f 656c           prev_el
-00002ab0: 656d 203d 2067 6574 7061 7265 6e74 2e67  em = getparent.g
-00002ac0: 6574 7072 6576 696f 7573 2829 0a20 2020  etprevious().   
-00002ad0: 2020 2020 2020 2020 2068 6569 6768 7420           height 
-00002ae0: 3d20 2d31 2069 6620 6373 735f 6c61 7374  = -1 if css_last
-00002af0: 2069 7320 4e6f 6e65 2065 6c73 6520 6373   is None else cs
-00002b00: 732e 746f 7020 2d20 6373 735f 6c61 7374  s.top - css_last
-00002b10: 2e74 6f70 0a20 2020 2020 2020 2020 2020  .top.           
-00002b20: 2070 7265 765f 7374 796c 6520 3d20 4353   prev_style = CS
-00002b30: 5353 7479 6c65 2e63 7265 6174 655f 6373  SStyle.create_cs
-00002b40: 735f 7374 796c 655f 6672 6f6d 5f61 7474  s_style_from_att
-00002b50: 7269 6275 7465 5f6f 665f 626f 6479 5f65  ribute_of_body_e
-00002b60: 6c65 6d65 6e74 2870 7265 765f 656c 656d  lement(prev_elem
-00002b70: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-00002b80: 206e 6f74 2070 7265 765f 7374 796c 653a   not prev_style:
-00002b90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00002ba0: 206c 6f67 6769 6e67 2e77 6172 6e69 6e67   logging.warning
-00002bb0: 2866 2220 6e6f 2070 7265 7669 6f75 7320  (f" no previous 
-00002bc0: 7374 796c 6522 290a 2020 2020 2020 2020  style").        
-00002bd0: 2020 2020 6262 6f78 203d 204e 6f6e 6520      bbox = None 
-00002be0: 6966 2070 7265 765f 7374 796c 6520 6973  if prev_style is
-00002bf0: 204e 6f6e 6520 656c 7365 2070 7265 765f   None else prev_
-00002c00: 7374 796c 652e 6372 6561 7465 5f62 626f  style.create_bbo
-00002c10: 7828 290a 2020 2020 2020 2020 2020 2020  x().            
-00002c20: 6373 735f 6c61 7374 203d 2063 7373 0a20  css_last = css. 
-00002c30: 2020 2020 2020 2072 6574 7572 6e20 656c         return el
-00002c40: 656d 5f77 6974 685f 7061 6765 6e6f 730a  em_with_pagenos.
-00002c50: 0a0a 2020 2020 6465 6620 7072 696e 745f  ..    def print_
-00002c60: 7061 6765 735f 6469 7628 7365 6c66 2c20  pages_div(self, 
-00002c70: 7261 6e67 6573 3d4e 6f6e 6529 3a0a 2020  ranges=None):.  
-00002c80: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00002c90: 2020 6d61 7962 6520 6a75 7374 2061 2064    maybe just a d
-00002ca0: 6562 7567 6765 720a 2020 2020 2020 2020  ebugger.        
-00002cb0: 2222 220a 0a20 2020 2020 2020 2069 6620  """..        if 
-00002cc0: 7261 6e67 6573 3a0a 2020 2020 2020 2020  ranges:.        
-00002cd0: 2020 2020 4874 6d6c 5469 6479 2e64 6562      HtmlTidy.deb
-00002ce0: 7567 5f62 795f 7870 6174 6828 7365 6c66  ug_by_xpath(self
-00002cf0: 2e72 6177 5f65 6c65 6d2c 2022 2f68 746d  .raw_elem, "/htm
-00002d00: 6c2f 626f 6479 2f73 7061 6e22 2c20 7469  l/body/span", ti
-00002d10: 746c 653d 2264 6972 6563 7420 7370 616e  tle="direct span
-00002d20: 7320 756e 6465 7220 626f 6479 2022 2c0a  s under body ",.
-00002d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002d50: 2020 2020 7261 6e67 653d 7261 6e67 6573      range=ranges
-00002d60: 5b30 5d29 2c0a 2020 2020 2020 2020 2020  [0]),.          
-00002d70: 2020 4874 6d6c 5469 6479 2e64 6562 7567    HtmlTidy.debug
-00002d80: 5f62 795f 7870 6174 6828 7365 6c66 2e72  _by_xpath(self.r
-00002d90: 6177 5f65 6c65 6d2c 2022 2f68 746d 6c2f  aw_elem, "/html/
-00002da0: 626f 6479 2f73 7061 6e5b 6469 765d 222c  body/span[div]",
-00002db0: 2074 6974 6c65 3d22 746f 702d 6c65 7665   title="top-leve
-00002dc0: 6c20 7370 616e 7320 7769 7468 2064 6976  l spans with div
-00002dd0: 733f 222c 0a20 2020 2020 2020 2020 2020  s?",.           
-00002de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002df0: 2020 2020 2020 2020 2072 616e 6765 3d72           range=r
-00002e00: 616e 6765 735b 315d 290a 2020 2020 2020  anges[1]).      
-00002e10: 2020 2020 2020 4874 6d6c 5469 6479 2e64        HtmlTidy.d
-00002e20: 6562 7567 5f62 795f 7870 6174 6828 7365  ebug_by_xpath(se
-00002e30: 6c66 2e72 6177 5f65 6c65 6d2c 2022 2f68  lf.raw_elem, "/h
-00002e40: 746d 6c2f 626f 6479 2f73 7061 6e2f 6469  tml/body/span/di
-00002e50: 7622 2c20 7469 746c 653d 2274 6865 2064  v", title="the d
-00002e60: 6976 7320 696e 2073 746f 702d 6c65 7665  ivs in stop-leve
-00002e70: 6c20 7370 616e 7322 2c0a 2020 2020 2020  l spans",.      
-00002e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002e90: 2020 2020 2020 2020 2020 2020 2020 7261                ra
-00002ea0: 6e67 653d 7261 6e67 6573 5b32 5d29 0a20  nge=ranges[2]). 
-00002eb0: 2020 2020 2020 2020 2020 2022 2222 0a20             """. 
-00002ec0: 2020 2020 2020 2020 2020 2020 2020 203c                 <
-00002ed0: 6469 7620 7374 796c 653d 2270 6f73 6974  div style="posit
-00002ee0: 696f 6e3a 6162 736f 6c75 7465 3b20 746f  ion:absolute; to
-00002ef0: 703a 3435 3039 7078 3b22 3e3c 6120 6e61  p:4509px;"><a na
-00002f00: 6d65 3d22 3622 3e50 6167 6520 363c 2f61  me="6">Page 6</a
-00002f10: 3e3c 2f64 6976 3e0a 2020 2020 2020 2020  ></div>.        
-00002f20: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00002f30: 2020 2020 4874 6d6c 5469 6479 2e64 6562      HtmlTidy.deb
-00002f40: 7567 5f62 795f 7870 6174 6828 7365 6c66  ug_by_xpath(self
-00002f50: 2e72 6177 5f65 6c65 6d2c 2022 2f68 746d  .raw_elem, "/htm
-00002f60: 6c2f 626f 6479 2f64 6976 5b40 7374 796c  l/body/div[@styl
-00002f70: 6520 616e 6420 615d 222c 2074 6974 6c65  e and a]", title
-00002f80: 3d22 7061 6765 206e 756d 6265 7220 626f  ="page number bo
-00002f90: 7865 7320 756e 6465 7220 626f 6479 222c  xes under body",
-00002fa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00002fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002fc0: 2020 2020 2072 616e 6765 3d72 616e 6765       range=range
-00002fd0: 735b 335d 290a 2020 2020 2020 2020 2020  s[3]).          
-00002fe0: 2020 4874 6d6c 5469 6479 2e64 6562 7567    HtmlTidy.debug
-00002ff0: 5f62 795f 7870 6174 6828 7365 6c66 2e72  _by_xpath(self.r
-00003000: 6177 5f65 6c65 6d2c 2022 2f68 746d 6c2f  aw_elem, "/html/
-00003010: 626f 6479 2f2f 6469 765b 4073 7479 6c65  body//div[@style
-00003020: 2061 6e64 2061 5b63 6f6e 7461 696e 7328   and a[contains(
-00003030: 2e2c 2027 5061 6765 2729 5d5d 222c 0a20  ., 'Page')]]",. 
-00003040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003060: 2020 2074 6974 6c65 3d22 7061 6765 206e     title="page n
-00003070: 756d 6265 7220 626f 7865 7320 756e 6465  umber boxes unde
-00003080: 7220 626f 6479 2f73 7061 6e22 2c20 7261  r body/span", ra
-00003090: 6e67 653d 7261 6e67 6573 5b34 5d29 0a0a  nge=ranges[4])..
-000030a0: 2020 2020 4063 6c61 7373 6d65 7468 6f64      @classmethod
-000030b0: 0a20 2020 2064 6566 2064 6562 7567 5f62  .    def debug_b
-000030c0: 795f 7870 6174 6828 636c 732c 2065 6c65  y_xpath(cls, ele
-000030d0: 6d2c 2078 7061 7468 2c20 7469 746c 653d  m, xpath, title=
-000030e0: 4e6f 6e65 2c20 7261 6e67 653d 4e6f 6e65  None, range=None
-000030f0: 2920 2d3e 2069 6e74 3a0a 2020 2020 2020  ) -> int:.      
-00003100: 2020 2222 220a 2020 2020 2020 2020 6170    """.        ap
-00003110: 706c 6965 7320 7870 6174 6820 616e 6420  plies xpath and 
-00003120: 7072 696e 7473 2064 6562 7567 390a 2020  prints debug9.  
-00003130: 2020 2020 2020 6173 7365 7274 0a20 2020        assert.   
-00003140: 2020 2020 203a 7061 7261 6d20 656c 656d       :param elem
-00003150: 3a20 746f 2064 6562 7567 0a20 2020 2020  : to debug.     
-00003160: 2020 203a 7061 7261 6d20 7870 6174 683a     :param xpath:
-00003170: 2074 6f20 6465 6275 6720 7769 7468 0a20   to debug with. 
-00003180: 2020 2020 2020 203a 7265 7475 726e 3a20         :return: 
-00003190: 7870 6174 6820 636f 756e 740a 2020 2020  xpath count.    
-000031a0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-000031b0: 7370 616e 7320 3d20 656c 656d 2e78 7061  spans = elem.xpa
-000031c0: 7468 2878 7061 7468 290a 2020 2020 2020  th(xpath).      
-000031d0: 2020 6966 2072 616e 6765 3a0a 2020 2020    if range:.    
-000031e0: 2020 2020 2020 2020 6173 7365 7274 2072          assert r
-000031f0: 616e 6765 5b30 5d20 3c3d 206c 656e 2873  ange[0] <= len(s
-00003200: 7061 6e73 2920 3c3d 2072 616e 6765 5b31  pans) <= range[1
-00003210: 5d2c 2066 227b 2727 2069 6620 6e6f 7420  ], f"{'' if not 
-00003220: 7469 746c 6520 656c 7365 2074 6974 6c65  title else title
-00003230: 7d3a 2066 6f75 6e64 3a20 7b6c 656e 2873  }: found: {len(s
-00003240: 7061 6e73 297d 220a 2020 2020 2020 2020  pans)}".        
-00003250: 7265 7475 726e 206c 656e 2873 7061 6e73  return len(spans
-00003260: 290a 0a20 2020 2064 6566 2061 6464 5f65  )..    def add_e
-00003270: 6c65 6d65 6e74 2873 656c 662c 2065 6c65  lement(self, ele
-00003280: 6d29 3a0a 2020 2020 2020 2020 7365 6c66  m):.        self
-00003290: 2e65 6c65 6d65 6e74 203d 2065 6c65 6d0a  .element = elem.
-000032a0: 0a20 2020 2064 6566 2061 6464 5f64 6573  .    def add_des
-000032b0: 6365 6e64 616e 745f 656c 656d 656e 745f  cendant_element_
-000032c0: 746f 5f72 656d 6f76 6528 7365 6c66 2c20  to_remove(self, 
-000032d0: 6465 7363 656e 6461 6e74 5f65 6c65 6d29  descendant_elem)
-000032e0: 3a0a 2020 2020 2020 2020 4874 6d6c 5469  :.        HtmlTi
-000032f0: 6479 2e61 6464 5f65 6c65 6d65 6e74 735f  dy.add_elements_
-00003300: 746f 5f73 746f 7265 2864 6573 6365 6e64  to_store(descend
-00003310: 616e 745f 656c 656d 2c20 7365 6c66 2e64  ant_elem, self.d
-00003320: 6573 6365 6e64 616e 7473 5f74 6f5f 7265  escendants_to_re
-00003330: 6d6f 7665 290a 0a20 2020 2064 6566 2061  move)..    def a
-00003340: 6464 5f73 7479 6c65 735f 746f 5f72 656d  dd_styles_to_rem
-00003350: 6f76 6528 7365 6c66 2c20 7374 796c 6529  ove(self, style)
-00003360: 3a0a 2020 2020 2020 2020 7365 6c66 2e73  :.        self.s
-00003370: 7479 6c65 735f 746f 5f72 656d 6f76 652e  tyles_to_remove.
-00003380: 6170 7065 6e64 2873 7479 6c65 290a 0a20  append(style).. 
-00003390: 2020 2064 6566 2061 6464 5f65 6d70 7479     def add_empty
-000033a0: 5f65 6c65 6d65 6e74 735f 746f 5f72 656d  _elements_to_rem
-000033b0: 6f76 6528 7365 6c66 2c20 656c 656d 735f  ove(self, elems_
-000033c0: 746f 5f72 656d 6f76 6529 3a0a 2020 2020  to_remove):.    
-000033d0: 2020 2020 4874 6d6c 5469 6479 2e61 6464      HtmlTidy.add
-000033e0: 5f65 6c65 6d65 6e74 735f 746f 5f73 746f  _elements_to_sto
-000033f0: 7265 2865 6c65 6d73 5f74 6f5f 7265 6d6f  re(elems_to_remo
-00003400: 7665 2c20 7365 6c66 2e65 6d70 7479 5f65  ve, self.empty_e
-00003410: 6c65 6d65 6e74 735f 746f 5f72 656d 6f76  lements_to_remov
-00003420: 6529 0a0a 2020 2020 4063 6c61 7373 6d65  e)..    @classme
-00003430: 7468 6f64 0a20 2020 2064 6566 2061 6464  thod.    def add
-00003440: 5f65 6c65 6d65 6e74 735f 746f 5f73 746f  _elements_to_sto
-00003450: 7265 2863 6c73 2c20 656c 656d 735f 746f  re(cls, elems_to
-00003460: 5f73 746f 7265 2c20 656c 656d 5f73 746f  _store, elem_sto
-00003470: 7261 6765 293a 0a20 2020 2020 2020 2069  rage):.        i
-00003480: 6620 656c 656d 735f 746f 5f73 746f 7265  f elems_to_store
-00003490: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
-000034a0: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-000034b0: 2074 7970 6528 656c 656d 735f 746f 5f73   type(elems_to_s
-000034c0: 746f 7265 2920 6973 206c 6973 743a 0a20  tore) is list:. 
-000034d0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-000034e0: 6c65 6d73 5f74 6f5f 7374 6f72 6520 3d20  lems_to_store = 
-000034f0: 6c69 7374 2865 6c65 6d73 5f74 6f5f 7374  list(elems_to_st
-00003500: 6f72 6529 0a20 2020 2020 2020 2020 2020  ore).           
-00003510: 2065 6c65 6d5f 7374 6f72 6167 652e 6578   elem_storage.ex
-00003520: 7465 6e64 2865 6c65 6d73 5f74 6f5f 7374  tend(elems_to_st
-00003530: 6f72 6529 0a0a 2020 2020 4063 6c61 7373  ore)..    @class
-00003540: 6d65 7468 6f64 0a20 2020 2064 6566 2065  method.    def e
-00003550: 6e73 7572 655f 6874 6d6c 5f68 6561 645f  nsure_html_head_
-00003560: 626f 6479 2863 6c73 2c20 6874 6d6c 5f65  body(cls, html_e
-00003570: 6c65 6d29 3a0a 2020 2020 2020 2020 2222  lem):.        ""
-00003580: 220a 2020 2020 2020 2020 6164 6473 203c  ".        adds <
-00003590: 6874 6d6c 3e2c 203c 6865 6164 3e2c 203c  html>, <head>, <
-000035a0: 626f 6479 3e20 6966 206e 6f74 2070 7265  body> if not pre
-000035b0: 7365 6e74 0a20 2020 2020 2020 204d 6f76  sent.        Mov
-000035c0: 6520 746f 2048 544d 4c54 6964 790a 2020  e to HTMLTidy.  
-000035d0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-000035e0: 2020 6874 6d6c 5f65 6c65 6d20 3d20 636c    html_elem = cl
-000035f0: 732e 5f65 6e73 7572 655f 6874 6d6c 5f72  s._ensure_html_r
-00003600: 6f6f 7428 6874 6d6c 5f65 6c65 6d29 0a20  oot(html_elem). 
-00003610: 2020 2020 2020 2068 746d 6c5f 7769 7468         html_with
-00003620: 5f68 6561 6420 3d20 636c 732e 5f65 6e73  _head = cls._ens
-00003630: 7572 655f 6865 6164 626f 6479 2868 746d  ure_headbody(htm
-00003640: 6c5f 656c 656d 2c20 2268 6561 6422 2c20  l_elem, "head", 
-00003650: 3029 0a20 2020 2020 2020 2068 746d 6c5f  0).        html_
-00003660: 7769 7468 5f68 6561 645f 626f 6479 203d  with_head_body =
-00003670: 2063 6c73 2e5f 656e 7375 7265 5f68 6561   cls._ensure_hea
-00003680: 6462 6f64 7928 6874 6d6c 5f77 6974 685f  dbody(html_with_
-00003690: 6865 6164 2c20 2262 6f64 7922 2c20 3129  head, "body", 1)
-000036a0: 0a20 2020 2020 2020 2068 746d 6c5f 6964  .        html_id
-000036b0: 6561 6c20 3d20 636c 732e 5f74 6964 795f  eal = cls._tidy_
-000036c0: 6e6f 6e5f 6865 6164 5f62 6f64 795f 6368  non_head_body_ch
-000036d0: 696c 6472 656e 2868 746d 6c5f 7769 7468  ildren(html_with
-000036e0: 5f68 6561 645f 626f 6479 290a 2020 2020  _head_body).    
-000036f0: 2020 2020 7265 7475 726e 2068 746d 6c5f      return html_
-00003700: 6964 6561 6c0a 0a20 2020 2040 636c 6173  ideal..    @clas
-00003710: 736d 6574 686f 640a 2020 2020 6465 6620  smethod.    def 
-00003720: 5f65 6e73 7572 655f 6865 6164 626f 6479  _ensure_headbody
-00003730: 2863 6c73 2c20 6874 6d6c 5f72 6f6f 742c  (cls, html_root,
-00003740: 2074 6167 2c20 706f 7329 3a0a 2020 2020   tag, pos):.    
-00003750: 2020 2020 6465 7363 656e 6473 203d 206c      descends = l
-00003760: 656e 2868 746d 6c5f 726f 6f74 2e78 7061  en(html_root.xpa
-00003770: 7468 2866 222e 2f2f 7b74 6167 7d22 2929  th(f".//{tag}"))
-00003780: 0a20 2020 2020 2020 2069 6620 6465 7363  .        if desc
-00003790: 656e 6473 203e 2031 3a0a 2020 2020 2020  ends > 1:.      
-000037a0: 2020 2020 2020 6c6f 6767 696e 672e 7761        logging.wa
-000037b0: 726e 696e 6728 6622 6d6f 7265 2074 6861  rning(f"more tha
-000037c0: 6e20 3120 7b74 6167 7d3b 2063 616e 6e6f  n 1 {tag}; canno
-000037d0: 7420 7072 6f63 6573 7322 290a 2020 2020  t process").    
-000037e0: 2020 2020 656c 6966 2064 6573 6365 6e64      elif descend
-000037f0: 7320 3d3d 2031 3a0a 2020 2020 2020 2020  s == 1:.        
-00003800: 2020 2020 2320 6f6e 6520 7461 672c 206f      # one tag, o
-00003810: 6b0a 2020 2020 2020 2020 2020 2020 7061  k.            pa
-00003820: 7373 0a20 2020 2020 2020 2065 6c69 6620  ss.        elif 
-00003830: 6465 7363 656e 6473 203d 3d20 303a 0a20  descends == 0:. 
-00003840: 2020 2020 2020 2020 2020 2068 6561 6420             head 
-00003850: 3d20 4554 2e45 6c65 6d65 6e74 2874 6167  = ET.Element(tag
-00003860: 290a 2020 2020 2020 2020 2020 2020 6874  ).            ht
-00003870: 6d6c 5f72 6f6f 742e 696e 7365 7274 2870  ml_root.insert(p
-00003880: 6f73 2c20 6865 6164 290a 2020 2020 2020  os, head).      
-00003890: 2020 7265 7475 726e 2068 746d 6c5f 726f    return html_ro
-000038a0: 6f74 0a0a 2020 2020 4063 6c61 7373 6d65  ot..    @classme
-000038b0: 7468 6f64 0a20 2020 2064 6566 205f 656e  thod.    def _en
-000038c0: 7375 7265 5f68 746d 6c5f 726f 6f74 2863  sure_html_root(c
-000038d0: 6c73 2c20 6874 6d6c 5f65 6c65 6d29 3a0a  ls, html_elem):.
-000038e0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-000038f0: 2020 2020 6966 2072 6f6f 7420 656c 656d      if root elem
-00003900: 656e 7420 6973 206e 6f74 203c 6874 6d6c  ent is not <html
-00003910: 3e20 6372 6561 7465 7320 6f6e 6520 616e  > creates one an
-00003920: 6420 7472 616e 7366 6572 7320 6368 696c  d transfers chil
-00003930: 6472 656e 0a20 2020 2020 2020 203a 7061  dren.        :pa
-00003940: 7261 6d20 6874 6d6c 5f65 6c65 6d3a 206f  ram html_elem: o
-00003950: 6c64 2045 6c65 6d65 6e74 5472 6565 206f  ld ElementTree o
-00003960: 7220 726f 6f74 2045 6c65 6d65 6e74 0a20  r root Element. 
-00003970: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00003980: 2020 206f 6c64 5f72 6f6f 7420 3d20 6874     old_root = ht
-00003990: 6d6c 5f65 6c65 6d2e 6765 7472 6f6f 7428  ml_elem.getroot(
-000039a0: 2920 6966 2074 7970 6528 6874 6d6c 5f65  ) if type(html_e
-000039b0: 6c65 6d29 2069 7320 5f45 6c65 6d65 6e74  lem) is _Element
-000039c0: 5472 6565 2065 6c73 6520 6874 6d6c 5f65  Tree else html_e
-000039d0: 6c65 6d0a 2020 2020 2020 2020 6874 6d6c  lem.        html
-000039e0: 7320 3d20 6874 6d6c 5f65 6c65 6d2e 7870  s = html_elem.xp
-000039f0: 6174 6828 222f 6874 6d6c 2229 0a20 2020  ath("/html").   
-00003a00: 2020 2020 2069 6620 6c65 6e28 6874 6d6c       if len(html
-00003a10: 7329 203d 3d20 303a 0a20 2020 2020 2020  s) == 0:.       
-00003a20: 2020 2020 2068 746d 6c5f 726f 6f74 203d       html_root =
-00003a30: 2045 542e 456c 656d 656e 7428 2268 746d   ET.Element("htm
-00003a40: 6c22 290a 2020 2020 2020 2020 2020 2020  l").            
-00003a50: 6874 6d6c 5f72 6f6f 742e 696e 7365 7274  html_root.insert
-00003a60: 2830 2c20 6f6c 645f 726f 6f74 290a 2020  (0, old_root).  
-00003a70: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00003a80: 2068 746d 6c5f 726f 6f74 0a20 2020 2020   html_root.     
-00003a90: 2020 2072 6574 7572 6e20 6874 6d6c 5f65     return html_e
-00003aa0: 6c65 6d0a 0a20 2020 2040 636c 6173 736d  lem..    @classm
-00003ab0: 6574 686f 640a 2020 2020 6465 6620 5f74  ethod.    def _t
-00003ac0: 6964 795f 6e6f 6e5f 6865 6164 5f62 6f64  idy_non_head_bod
-00003ad0: 795f 6368 696c 6472 656e 2863 6c73 2c20  y_children(cls, 
-00003ae0: 6874 6d6c 5f77 6974 685f 6865 6164 5f62  html_with_head_b
-00003af0: 6f64 7929 3a0a 0a20 2020 2020 2020 2068  ody):..        h
-00003b00: 6561 645f 656c 656d 7320 3d20 6874 6d6c  ead_elems = html
-00003b10: 5f77 6974 685f 6865 6164 5f62 6f64 792e  _with_head_body.
-00003b20: 7870 6174 6828 4874 6d6c 5469 6479 2e48  xpath(HtmlTidy.H
-00003b30: 4541 445f 454c 454d 535f 494e 5f58 5041  EAD_ELEMS_IN_XPA
-00003b40: 5448 290a 2020 2020 2020 2020 6865 6164  TH).        head
-00003b50: 203d 2068 746d 6c5f 7769 7468 5f68 6561   = html_with_hea
-00003b60: 645f 626f 6479 2e78 7061 7468 2822 6865  d_body.xpath("he
-00003b70: 6164 2229 5b30 5d0a 2020 2020 2020 2020  ad")[0].        
-00003b80: 666f 7220 656c 656d 2069 6e20 6865 6164  for elem in head
-00003b90: 5f65 6c65 6d73 3a0a 2020 2020 2020 2020  _elems:.        
-00003ba0: 2020 2020 6865 6164 2e61 7070 656e 6428      head.append(
-00003bb0: 656c 656d 290a 2020 2020 2020 2020 7265  elem).        re
-00003bc0: 7374 5f65 6c65 6d73 203d 2068 746d 6c5f  st_elems = html_
-00003bd0: 7769 7468 5f68 6561 645f 626f 6479 2e78  with_head_body.x
-00003be0: 7061 7468 2822 2a5b 6e6f 7428 6e61 6d65  path("*[not(name
-00003bf0: 2829 3d27 6865 6164 2729 2061 6e64 206e  ()='head') and n
-00003c00: 6f74 286e 616d 6528 293d 2762 6f64 7927  ot(name()='body'
-00003c10: 295d 2229 0a20 2020 2020 2020 2062 6f64  )]").        bod
-00003c20: 7920 3d20 6874 6d6c 5f77 6974 685f 6865  y = html_with_he
-00003c30: 6164 5f62 6f64 792e 7870 6174 6828 2262  ad_body.xpath("b
-00003c40: 6f64 7922 295b 305d 0a20 2020 2020 2020  ody")[0].       
-00003c50: 2066 6f72 2065 6c65 6d20 696e 2072 6573   for elem in res
-00003c60: 745f 656c 656d 733a 0a20 2020 2020 2020  t_elems:.       
-00003c70: 2020 2020 2062 6f64 792e 6170 7065 6e64       body.append
-00003c80: 2865 6c65 6d29 0a20 2020 2020 2020 2072  (elem).        r
-00003c90: 6574 7572 6e20 6874 6d6c 5f77 6974 685f  eturn html_with_
-00003ca0: 6865 6164 5f62 6f64 790a 0a20 2020 2040  head_body..    @
-00003cb0: 636c 6173 736d 6574 686f 640a 2020 2020  classmethod.    
-00003cc0: 6465 6620 636f 6e63 6174 656e 6174 655f  def concatenate_
-00003cd0: 7370 616e 735f 7769 7468 5f69 6465 6e74  spans_with_ident
-00003ce0: 6963 616c 5f73 7479 6c65 7328 636c 732c  ical_styles(cls,
-00003cf0: 2065 6c65 6d2c 2061 6464 7370 6163 653d   elem, addspace=
-00003d00: 5472 7565 293a 0a0a 2020 2020 2020 2020  True):..        
-00003d10: 2222 220a 2020 2020 2020 2020 536f 6d65  """.        Some
-00003d20: 7469 6d65 7320 756e 6e65 6365 7373 6172  times unnecessar
-00003d30: 7920 7370 616e 7320 6172 6520 6372 6561  y spans are crea
-00003d40: 7465 6420 2865 2e67 2e0a 2020 2020 2020  ted (e.g..      
-00003d50: 2020 3c73 7061 6e20 636c 6173 733d 2773    <span class='s
-00003d60: 3127 3e66 6f6f 3c2f 7370 616e 3e3c 7370  1'>foo</span><sp
-00003d70: 616e 6520 636c 6173 733d 2273 3122 3e62  ane class="s1">b
-00003d80: 6172 3c2f 7370 616e 3e0a 2020 2020 2020  ar</span>.      
-00003d90: 2020 6372 6561 7465 7320 3c73 7061 6e20    creates <span 
-00003da0: 636c 6173 733d 2273 3122 3e66 6f6f 2062  class="s1">foo b
-00003db0: 6172 3c2f 7370 616e 3e0a 2020 2020 2020  ar</span>.      
-00003dc0: 2020 3a70 6172 616d 2065 6c65 6d3a 2070    :param elem: p
-00003dd0: 726f 6261 626c 7920 6120 6469 7620 7769  robably a div wi
-00003de0: 7468 2063 6869 6c64 2073 7061 6e73 0a20  th child spans. 
-00003df0: 2020 2020 2020 203a 7061 7261 6d20 6164         :param ad
-00003e00: 6473 7061 6365 3a20 696e 7365 7274 2073  dspace: insert s
-00003e10: 7061 6365 0a20 2020 2020 2020 2022 2222  pace.        """
-00003e20: 0a20 2020 2020 2020 2073 7061 6e73 203d  .        spans =
-00003e30: 2065 6c65 6d2e 7870 6174 6828 222e 2f73   elem.xpath("./s
-00003e40: 7061 6e5b 4063 6c61 7373 5d22 290a 2020  pan[@class]").  
-00003e50: 2020 2020 2020 6c61 7374 5f73 7061 6e20        last_span 
-00003e60: 3d20 4e6f 6e65 0a20 2020 2020 2020 2073  = None.        s
-00003e70: 7061 6365 7320 3d20 2222 2069 6620 6e6f  paces = "" if no
-00003e80: 7420 6164 6473 7061 6365 2065 6c73 6520  t addspace else 
-00003e90: 2220 220a 2020 2020 2020 2020 666f 7220  " ".        for 
-00003ea0: 7370 616e 2069 6e20 7370 616e 733a 0a20  span in spans:. 
-00003eb0: 2020 2020 2020 2020 2020 2069 6620 6c61             if la
-00003ec0: 7374 5f73 7061 6e20 6973 206e 6f74 204e  st_span is not N
-00003ed0: 6f6e 6520 616e 6420 6c61 7374 5f73 7061  one and last_spa
-00003ee0: 6e2e 6174 7472 6962 5b22 636c 6173 7322  n.attrib["class"
-00003ef0: 5d20 3d3d 2073 7061 6e2e 6174 7472 6962  ] == span.attrib
-00003f00: 5b22 636c 6173 7322 5d3a 0a20 2020 2020  ["class"]:.     
-00003f10: 2020 2020 2020 2020 2020 206c 6173 745f             last_
-00003f20: 7370 616e 2e74 6578 7420 3d20 6c61 7374  span.text = last
-00003f30: 5f73 7061 6e2e 7465 7874 202b 2073 7061  _span.text + spa
-00003f40: 6365 7320 2b20 7370 616e 2e74 6578 740a  ces + span.text.
-00003f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003f60: 656c 656d 2e72 656d 6f76 6528 7370 616e  elem.remove(span
-00003f70: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
-00003f80: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00003f90: 2020 2020 6c61 7374 5f73 7061 6e20 3d20      last_span = 
-00003fa0: 7370 616e 0a0a 0a64 6566 2067 6574 5f74  span...def get_t
-00003fb0: 6172 6765 745f 6872 6566 2874 6172 6765  arget_href(targe
-00003fc0: 745f 6964 293a 0a20 2020 2072 655f 7461  t_id):.    re_ta
-00003fd0: 7267 6574 203d 2072 652e 636f 6d70 696c  rget = re.compil
-00003fe0: 6528 225c 5c73 2a28 3f50 3c72 6570 6f72  e("\\s*(?P<repor
-00003ff0: 743e 5747 497c 5747 4949 7c57 4749 4949  t>WGI|WGII|WGIII
-00004000: 7c53 5243 434c 7c53 524f 4343 7c53 5231  |SRCCL|SROCC|SR1
-00004010: 357c 5359 5229 5c5c 732b 283f 503c 6368  5|SYR)\\s+(?P<ch
-00004020: 6170 7465 723e 5350 4d7c 5453 295c 5c73  apter>SPM|TS)\\s
-00004030: 2b28 3f50 3c73 6563 7469 6f6e 3e5b 412d  +(?P<section>[A-
-00004040: 475d 5c5c 2e3f 5c5c 642b 283f 3a5c 5c2e  G]\\.?\\d+(?:\\.
-00004050: 5c5c 642b 292a 2922 290a 2020 2020 6769  \\d+)*)").    gi
-00004060: 7468 7562 5f62 6173 6520 3d20 2268 7474  thub_base = "htt
-00004070: 7073 3a2f 2f68 746d 6c70 7265 7669 6577  ps://htmlpreview
-00004080: 2e67 6974 6875 622e 696f 2f3f 6874 7470  .github.io/?http
-00004090: 733a 2f2f 6769 7468 7562 2e63 6f6d 220a  s://github.com".
-000040a0: 2020 2020 776f 726b 696e 675f 7572 6c20      working_url 
-000040b0: 3d20 2268 7474 7073 3a2f 2f68 746d 6c70  = "https://htmlp
-000040c0: 7265 7669 6577 2e67 6974 6875 622e 696f  review.github.io
-000040d0: 2f3f 6874 7470 733a 2f2f 6769 7468 7562  /?https://github
-000040e0: 2e63 6f6d 2f70 6574 6572 6d72 2f73 656d  .com/petermr/sem
-000040f0: 616e 7469 6343 6c69 6d61 7465 2f62 6c6f  anticClimate/blo
-00004100: 622f 6d61 696e 2f74 6573 742e 6874 6d6c  b/main/test.html
-00004110: 220a 2020 2020 7265 706f 7274 5f64 6963  ".    report_dic
-00004120: 7420 3d20 7b0a 2020 2020 2020 2020 2277  t = {.        "w
-00004130: 6769 2220 3a20 2277 6731 222c 0a20 2020  gi" : "wg1",.   
-00004140: 2020 2020 2022 7767 6969 223a 2022 7767       "wgii": "wg
-00004150: 3222 2c0a 2020 2020 2020 2020 2277 6769  2",.        "wgi
-00004160: 6969 223a 2022 7767 3322 2c0a 2020 2020  ii": "wg3",.    
-00004170: 7d0a 2020 2020 6872 6566 203d 2022 220a  }.    href = "".
-00004180: 2020 2020 6d61 7463 6820 3d20 7265 5f74      match = re_t
-00004190: 6172 6765 742e 6d61 7463 6828 7461 7267  arget.match(targ
-000041a0: 6574 5f69 6429 0a20 2020 2069 6620 6d61  et_id).    if ma
-000041b0: 7463 683a 0a20 2020 2020 2020 2072 6570  tch:.        rep
-000041c0: 6f72 7420 3d20 6d61 7463 682e 6772 6f75  ort = match.grou
-000041d0: 7028 2272 6570 6f72 7422 292e 6c6f 7765  p("report").lowe
-000041e0: 7228 290a 2020 2020 2020 2020 7265 706f  r().        repo
-000041f0: 7274 3120 3d20 7265 706f 7274 5f64 6963  rt1 = report_dic
-00004200: 742e 6765 7428 7265 706f 7274 290a 2020  t.get(report).  
-00004210: 2020 2020 2020 7265 706f 7274 203d 2072        report = r
-00004220: 6570 6f72 7431 2069 6620 7265 706f 7274  eport1 if report
-00004230: 3120 656c 7365 2072 6570 6f72 740a 2020  1 else report.  
-00004240: 2020 2020 2020 6368 6170 7465 7220 3d20        chapter = 
-00004250: 6d61 7463 682e 6772 6f75 7028 2263 6861  match.group("cha
-00004260: 7074 6572 2229 2e6c 6f77 6572 2829 0a20  pter").lower(). 
-00004270: 2020 2020 2020 2073 6563 7469 6f6e 203d         section =
-00004280: 206d 6174 6368 2e67 726f 7570 2822 7365   match.group("se
-00004290: 6374 696f 6e22 292e 6c6f 7765 7228 290a  ction").lower().
-000042a0: 2020 2020 2020 2020 6872 6566 203d 2066          href = f
-000042b0: 227b 6769 7468 7562 5f62 6173 657d 2f70  "{github_base}/p
-000042c0: 6574 6572 6d72 2f73 656d 616e 7469 6343  etermr/semanticC
-000042d0: 6c69 6d61 7465 2f62 6c6f 622f 6d61 696e  limate/blob/main
-000042e0: 2f61 7236 2f61 7236 2f7b 7265 706f 7274  /ar6/ar6/{report
-000042f0: 7d2f 7b63 6861 7074 6572 7d2f 6874 6d6c  }/{chapter}/html
-00004300: 2f66 756c 6c74 6578 742f 6772 6f75 7073  /fulltext/groups
-00004310: 5f67 726f 7570 732e 6874 6d6c 237b 7365  _groups.html#{se
-00004320: 6374 696f 6e7d 220a 0a20 2020 2072 6574  ction}"..    ret
-00004330: 7572 6e20 6872 6566 0a0a 0a63 6c61 7373  urn href...class
-00004340: 2048 746d 6c47 726f 7570 3a0a 2020 2020   HtmlGroup:.    
-00004350: 2222 2267 726f 7570 7320 7369 626c 696e  """groups siblin
-00004360: 6773 2069 6e74 6f20 6469 7673 2222 220a  gs into divs""".
-00004370: 0a20 2020 2044 4546 4155 4c54 5f53 5459  .    DEFAULT_STY
-00004380: 4c45 5320 3d20 5b0a 2020 2020 2020 2020  LES = [.        
-00004390: 2822 2e73 6563 7469 6f6e 5f74 6974 6c65  (".section_title
-000043a0: 222c 205b 2822 636f 6c6f 7222 2c20 2272  ", [("color", "r
-000043b0: 6564 3b22 295d 292c 0a20 2020 2020 2020  ed;")]),.       
-000043c0: 2028 222e 7375 625f 7365 6374 696f 6e5f   (".sub_section_
-000043d0: 7469 746c 6522 2c20 5b28 2263 6f6c 6f72  title", [("color
-000043e0: 222c 2022 626c 7565 3b22 295d 292c 0a20  ", "blue;")]),. 
-000043f0: 2020 2020 2020 2028 222e 7375 625f 7375         (".sub_su
-00004400: 625f 7365 6374 696f 6e5f 7469 746c 6522  b_section_title"
-00004410: 2c20 5b28 2263 6f6c 6f72 222c 2022 6772  , [("color", "gr
-00004420: 6565 6e3b 2229 5d29 2c0a 2020 2020 2020  een;")]),.      
-00004430: 2020 2822 2e63 6f6e 6669 6465 6e63 6522    (".confidence"
-00004440: 2c20 5b28 2263 6f6c 6f72 222c 2022 6f72  , [("color", "or
-00004450: 616e 6765 3b22 295d 292c 0a20 2020 2020  ange;")]),.     
-00004460: 2020 2028 222e 7072 6f62 6162 696c 6974     (".probabilit
-00004470: 7922 2c20 5b28 2263 6f6c 6f72 222c 2022  y", [("color", "
-00004480: 2338 3838 3866 663b 2229 5d29 2c0a 2020  #8888ff;")]),.  
-00004490: 2020 2020 2020 2822 2e73 7570 6572 7363        (".supersc
-000044a0: 7269 7074 222c 205b 2822 636f 6c6f 7222  ript", [("color"
-000044b0: 2c20 226d 6167 656e 7461 3b22 292c 2028  , "magenta;"), (
-000044c0: 2262 6163 6b67 726f 756e 6422 2c20 2279  "background", "y
-000044d0: 656c 6c6f 773b 2229 5d29 2c0a 2020 2020  ellow;")]),.    
-000044e0: 2020 2020 2822 2e63 6875 6e6b 222c 205b      (".chunk", [
-000044f0: 2822 6261 636b 6772 6f75 6e64 222c 2022  ("background", "
-00004500: 6379 616e 3b22 295d 292c 0a20 2020 2020  cyan;")]),.     
-00004510: 2020 2028 222e 7461 7267 6574 7322 2c20     (".targets", 
-00004520: 5b28 2262 6163 6b67 726f 756e 6422 2c20  [("background", 
-00004530: 2223 3838 6666 3838 3b22 295d 292c 0a20  "#88ff88;")]),. 
-00004540: 2020 2020 2020 2028 222e 7374 6172 7422         (".start"
-00004550: 2c20 5b28 2262 6163 6b67 726f 756e 6422  , [("background"
-00004560: 2c20 2267 7261 793b 2229 5d29 2c0a 2020  , "gray;")]),.  
-00004570: 2020 2020 2020 2822 2e65 6e64 222c 205b        (".end", [
-00004580: 2822 6261 636b 6772 6f75 6e64 222c 2022  ("background", "
-00004590: 7965 6c6c 6f77 3b22 295d 292c 0a20 2020  yellow;")]),.   
-000045a0: 2020 2020 2028 222e 7061 6765 222c 205b       (".page", [
-000045b0: 2822 6261 636b 6772 6f75 6e64 222c 2022  ("background", "
-000045c0: 6d61 6765 6e74 613b 2229 5d29 2c0a 2020  magenta;")]),.  
-000045d0: 2020 2020 2020 2822 2e73 7461 7465 6d65        (".stateme
-000045e0: 6e74 222c 205b 2822 6261 636b 6772 6f75  nt", [("backgrou
-000045f0: 6e64 222c 2022 2364 6464 6466 663b 2229  nd", "#ddddff;")
-00004600: 5d29 2c0a 2020 2020 2020 2020 2822 2e6c  ]),.        (".l
-00004610: 6576 656c 3122 2c20 5b28 2262 6163 6b67  evel1", [("backg
-00004620: 726f 756e 6422 2c20 2223 6666 6666 6464  round", "#ffffdd
-00004630: 3b22 295d 292c 0a20 2020 2020 2020 2028  ;")]),.        (
-00004640: 222e 6c65 7665 6c32 222c 205b 2822 6261  ".level2", [("ba
-00004650: 636b 6772 6f75 6e64 222c 2022 2364 6466  ckground", "#ddf
-00004660: 6666 663b 2229 5d29 2c0a 2020 2020 2020  fff;")]),.      
-00004670: 2020 2822 2e6c 6576 656c 3322 2c20 5b28    (".level3", [(
-00004680: 2262 6163 6b67 726f 756e 6422 2c20 2223  "background", "#
-00004690: 6464 6666 6464 3b22 295d 292c 0a20 2020  ddffdd;")]),.   
-000046a0: 2020 2020 2028 222e 666f 6f74 6e6f 7465       (".footnote
-000046b0: 222c 205b 2822 6261 636b 6772 6f75 6e64  ", [("background
-000046c0: 222c 2022 2366 6664 6466 663b 2229 5d29  ", "#ffddff;")])
-000046d0: 2c0a 2020 2020 5d0a 0a20 2020 2040 636c  ,.    ]..    @cl
-000046e0: 6173 736d 6574 686f 640a 2020 2020 6465  assmethod.    de
-000046f0: 6620 6765 6e65 7261 7465 5f6c 6f77 6572  f generate_lower
-00004700: 6361 7365 5f6c 6574 7465 725f 6964 2863  case_letter_id(c
-00004710: 6c73 2c20 6929 3a0a 2020 2020 2020 2020  ls, i):.        
-00004720: 226d 616b 6520 6964 206f 6620 666f 726d  "make id of form
-00004730: 2061 2c62 2c63 2c20 2e2e 2e20 6161 2c20   a,b,c, ... aa, 
-00004740: 6162 2c20 6163 202e 2e2e 2062 612c 2062  ab, ac ... ba, b
-00004750: 622c 202e 2e2e 207a 7a20 2c20 402e 7374  b, ... zz , @.st
-00004760: 7228 6929 220a 2020 2020 2020 2020 6162  r(i)".        ab
-00004770: 6320 3d20 2261 6263 6465 6667 6869 6a6b  c = "abcdefghijk
-00004780: 6c6d 6e6f 7071 7273 7475 7677 7879 7a22  lmnopqrstuvwxyz"
-00004790: 0a20 2020 2020 2020 2069 6920 3d20 6920  .        ii = i 
-000047a0: 2520 3236 0a20 2020 2020 2020 206a 6a20  % 26.        jj 
-000047b0: 3d20 6920 2f2f 2032 360a 2020 2020 2020  = i // 26.      
-000047c0: 2020 6966 2069 203e 3d20 3136 202a 2031    if i >= 16 * 1
-000047d0: 363a 0a20 2020 2020 2020 2020 2020 2072  6:.            r
-000047e0: 6574 7572 6e20 2240 2e22 202b 2073 7472  eturn "@." + str
-000047f0: 2869 290a 2020 2020 2020 2020 7320 3d20  (i).        s = 
-00004800: 2222 2069 6620 6a6a 203d 3d20 3020 656c  "" if jj == 0 el
-00004810: 7365 2061 6263 5b6a 6a20 2d20 315d 0a20  se abc[jj - 1]. 
-00004820: 2020 2020 2020 2072 6574 7572 6e20 7320         return s 
-00004830: 2b20 6162 635b 6969 5d0a 0a0a 0a20 2020  + abc[ii]....   
-00004840: 2040 636c 6173 736d 6574 686f 640a 2020   @classmethod.  
-00004850: 2020 6465 6620 6772 6f75 705f 7369 626c    def group_sibl
-00004860: 696e 6773 2863 6c73 2c20 6874 6d6c 5f65  ings(cls, html_e
-00004870: 6c65 6d2c 206c 6f63 6174 6f72 3d4e 6f6e  lem, locator=Non
-00004880: 652c 2070 6172 656e 745f 6c6f 6361 746f  e, parent_locato
-00004890: 723d 4e6f 6e65 2c20 7374 796c 653d 4e6f  r=None, style=No
-000048a0: 6e65 2c20 6465 6275 673d 4661 6c73 6529  ne, debug=False)
-000048b0: 3a0a 2020 2020 2020 2020 2222 2265 7672  :.        """evr
-000048c0: 7974 6869 6e67 2073 7461 7274 7320 6173  ything starts as
-000048d0: 2061 2073 6962 6c69 6e67 2122 2222 0a20   a sibling!""". 
-000048e0: 2020 2020 2020 2073 6563 7469 6f6e 7320         sections 
-000048f0: 3d20 6874 6d6c 5f65 6c65 6d2e 7870 6174  = html_elem.xpat
-00004900: 6828 6622 2e2f 2f73 7061 6e5b 7374 6172  h(f".//span[star
-00004910: 7473 2d77 6974 6828 4063 6c61 7373 2c20  ts-with(@class, 
-00004920: 277b 6c6f 6361 746f 727d 2729 5d22 290a  '{locator}')]").
-00004930: 2020 2020 2020 2020 6665 6e63 6570 6f73          fencepos
-00004940: 7473 203d 2068 746d 6c5f 656c 656d 2e78  ts = html_elem.x
-00004950: 7061 7468 2866 222e 2f2f 7370 616e 5b73  path(f".//span[s
-00004960: 7461 7274 732d 7769 7468 2840 636c 6173  tarts-with(@clas
-00004970: 732c 277b 7061 7265 6e74 5f6c 6f63 6174  s,'{parent_locat
-00004980: 6f72 7d27 295d 2229 0a20 2020 2020 2020  or}')]").       
-00004990: 2069 6620 6c65 6e28 7365 6374 696f 6e73   if len(sections
-000049a0: 2920 3e20 303a 0a20 2020 2020 2020 2020  ) > 0:.         
-000049b0: 2020 2070 6172 656e 7420 3d20 7365 6374     parent = sect
-000049c0: 696f 6e73 5b30 5d2e 6765 7470 6172 656e  ions[0].getparen
-000049d0: 7428 290a 2020 2020 2020 2020 2020 2020  t().            
-000049e0: 666f 7220 7365 6374 696f 6e20 696e 2073  for section in s
-000049f0: 6563 7469 6f6e 733a 0a20 2020 2020 2020  ections:.       
-00004a00: 2020 2020 2020 2020 2063 6c73 2e67 726f           cls.gro
-00004a10: 7570 5f73 6962 6c69 6e67 735f 6265 7477  up_siblings_betw
-00004a20: 6565 6e5f 6665 6e63 6570 6f73 7473 2866  een_fenceposts(f
-00004a30: 656e 6365 706f 7374 732c 2073 7479 6c65  enceposts, style
-00004a40: 3d73 7479 6c65 2c20 6465 6275 673d 6465  =style, debug=de
-00004a50: 6275 6729 0a0a 2020 2020 4063 6c61 7373  bug)..    @class
-00004a60: 6d65 7468 6f64 0a20 2020 2064 6566 2067  method.    def g
-00004a70: 726f 7570 5f73 6962 6c69 6e67 735f 6265  roup_siblings_be
-00004a80: 7477 6565 6e5f 6665 6e63 6570 6f73 7473  tween_fenceposts
-00004a90: 2863 6c73 2c20 6665 6e63 6570 6f73 7473  (cls, fenceposts
-00004aa0: 2c20 7374 796c 653d 4e6f 6e65 2c20 6465  , style=None, de
-00004ab0: 6275 673d 4661 6c73 6529 3a0a 2020 2020  bug=False):.    
-00004ac0: 2020 2020 666f 7220 692c 2066 656e 6365      for i, fence
-00004ad0: 706f 7374 2069 6e20 656e 756d 6572 6174  post in enumerat
-00004ae0: 6528 6665 6e63 6570 6f73 7473 293a 0a20  e(fenceposts):. 
-00004af0: 2020 2020 2020 2020 2020 2066 656e 6365             fence
-00004b00: 706f 7374 5f66 6f6c 6c6f 7765 7273 203d  post_followers =
-00004b10: 2066 656e 6365 706f 7374 2e78 7061 7468   fencepost.xpath
-00004b20: 2822 666f 6c6c 6f77 696e 672d 7369 626c  ("following-sibl
-00004b30: 696e 673a 3a64 6976 5b73 7061 6e5d 2229  ing::div[span]")
-00004b40: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
-00004b50: 7461 696e 6572 5f64 6976 203d 2045 542e  tainer_div = ET.
-00004b60: 456c 656d 656e 7428 2264 6976 2229 0a20  Element("div"). 
-00004b70: 2020 2020 2020 2020 2020 2063 6f6e 7461             conta
-00004b80: 696e 6572 5f64 6976 2e61 7474 7269 625b  iner_div.attrib[
-00004b90: 2273 7479 6c65 225d 203d 2073 7479 6c65  "style"] = style
-00004ba0: 0a20 2020 2020 2020 2020 2020 2066 656e  .            fen
-00004bb0: 6365 706f 7374 2e61 6464 7072 6576 696f  cepost.addprevio
-00004bc0: 7573 2863 6f6e 7461 696e 6572 5f64 6976  us(container_div
-00004bd0: 290a 2020 2020 2020 2020 2020 2020 636f  ).            co
-00004be0: 6e74 6169 6e65 725f 6469 762e 6170 7065  ntainer_div.appe
-00004bf0: 6e64 2866 656e 6365 706f 7374 290a 2020  nd(fencepost).  
-00004c00: 2020 2020 2020 2020 2020 7469 746c 6520            title 
-00004c10: 3d20 6665 6e63 6570 6f73 742e 7870 6174  = fencepost.xpat
-00004c20: 6828 2273 7061 6e22 295b 305d 2e61 7474  h("span")[0].att
-00004c30: 7269 622e 6765 7428 2269 6422 290a 2020  rib.get("id").  
-00004c40: 2020 2020 2020 2020 2020 6966 2074 6974            if tit
-00004c50: 6c65 3a0a 2020 2020 2020 2020 2020 2020  le:.            
-00004c60: 2020 2020 636f 6e74 6169 6e65 725f 6469      container_di
-00004c70: 762e 6174 7472 6962 5b22 7469 746c 6522  v.attrib["title"
-00004c80: 5d20 3d20 7469 746c 650a 2020 2020 2020  ] = title.      
-00004c90: 2020 2020 2020 666f 7220 666f 6c6c 6f77        for follow
-00004ca0: 6572 2069 6e20 6665 6e63 6570 6f73 745f  er in fencepost_
-00004cb0: 666f 6c6c 6f77 6572 733a 0a20 2020 2020  followers:.     
-00004cc0: 2020 2020 2020 2020 2020 2069 6620 666f             if fo
-00004cd0: 6c6c 6f77 6572 2069 6e20 6665 6e63 6570  llower in fencep
-00004ce0: 6f73 7473 3a0a 2020 2020 2020 2020 2020  osts:.          
-00004cf0: 2020 2020 2020 2020 2020 6964 203d 2066            id = f
-00004d00: 6f6c 6c6f 7765 722e 7870 6174 6828 222e  ollower.xpath(".
-00004d10: 2f73 7061 6e22 295b 305d 2e61 7474 7269  /span")[0].attri
-00004d20: 622e 6765 7428 2269 6422 290a 2020 2020  b.get("id").    
+00000060: 7322 2222 0a69 6d70 6f72 7420 636f 7079  s""".import copy
+00000070: 0a69 6d70 6f72 7420 6c6f 6767 696e 670a  .import logging.
+00000080: 696d 706f 7274 2072 650a 696d 706f 7274  import re.import
+00000090: 2073 7973 0a69 6d70 6f72 7420 7469 6d65   sys.import time
+000000a0: 0a66 726f 6d20 636f 6c6c 6563 7469 6f6e  .from collection
+000000b0: 7320 696d 706f 7274 2064 6566 6175 6c74  s import default
+000000c0: 6469 6374 0a66 726f 6d20 656e 756d 2069  dict.from enum i
+000000d0: 6d70 6f72 7420 456e 756d 0a66 726f 6d20  mport Enum.from 
+000000e0: 696f 2069 6d70 6f72 7420 5374 7269 6e67  io import String
+000000f0: 494f 0a66 726f 6d20 7061 7468 6c69 6220  IO.from pathlib 
+00000100: 696d 706f 7274 2050 6174 680a 6672 6f6d  import Path.from
+00000110: 2070 7072 696e 7420 696d 706f 7274 2070   pprint import p
+00000120: 7072 696e 740a 0a69 6d70 6f72 7420 6c78  print..import lx
+00000130: 6d6c 2e65 7472 6565 2061 7320 4554 0a69  ml.etree as ET.i
+00000140: 6d70 6f72 7420 6e75 6d70 7920 6173 206e  mport numpy as n
+00000150: 700a 6672 6f6d 206c 786d 6c2e 6574 7265  p.from lxml.etre
+00000160: 6520 696d 706f 7274 2045 6c65 6d65 6e74  e import Element
+00000170: 2c20 5f45 6c65 6d65 6e74 2c20 5f45 6c65  , _Element, _Ele
+00000180: 6d65 6e74 5472 6565 0a66 726f 6d20 736b  mentTree.from sk
+00000190: 6c65 6172 6e2e 6c69 6e65 6172 5f6d 6f64  learn.linear_mod
+000001a0: 656c 2069 6d70 6f72 7420 4c69 6e65 6172  el import Linear
+000001b0: 5265 6772 6573 7369 6f6e 0a0a 2320 6c6f  Regression..# lo
+000001c0: 6361 6c0a 6672 6f6d 2061 6d69 6c69 622e  cal.from amilib.
+000001d0: 6262 6f78 2069 6d70 6f72 7420 4242 6f78  bbox import BBox
+000001e0: 0a66 726f 6d20 616d 696c 6962 2e75 7469  .from amilib.uti
+000001f0: 6c20 696d 706f 7274 2053 5363 7269 7074  l import SScript
+00000200: 2c20 5574 696c 2c20 416d 694c 6f67 6765  , Util, AmiLogge
+00000210: 720a 6672 6f6d 2061 6d69 6c69 622e 786d  r.from amilib.xm
+00000220: 6c5f 6c69 6220 696d 706f 7274 2058 6d6c  l_lib import Xml
+00000230: 4c69 622c 2048 746d 6c4c 6962 0a0a 2320  Lib, HtmlLib..# 
+00000240: 6e6f 2074 7279 2d63 6174 6368 2069 6d70  no try-catch imp
+00000250: 6f72 7473 0a0a 6c6f 6767 6572 203d 2041  orts..logger = A
+00000260: 6d69 4c6f 6767 6572 2e63 7265 6174 655f  miLogger.create_
+00000270: 6e61 6d65 645f 6c6f 6767 6572 285f 5f66  named_logger(__f
+00000280: 696c 655f 5f29 0a0a 2320 4854 4d4c 2065  ile__)..# HTML e
+00000290: 6c65 6d65 6e74 730a 485f 4854 4d4c 203d  lements.H_HTML =
+000002a0: 2022 6874 6d6c 220a 485f 4845 4144 203d   "html".H_HEAD =
+000002b0: 2022 6865 6164 220a 485f 4d45 5441 203d   "head".H_META =
+000002c0: 2022 6d65 7461 220a 485f 5343 5249 5054   "meta".H_SCRIPT
+000002d0: 203d 2022 7363 7269 7074 220a 485f 5354   = "script".H_ST
+000002e0: 594c 4520 3d20 2273 7479 6c65 220a 485f  YLE = "style".H_
+000002f0: 424f 4459 203d 2022 626f 6479 220a 485f  BODY = "body".H_
+00000300: 5441 424c 4520 3d20 2274 6162 6c65 220a  TABLE = "table".
+00000310: 485f 5448 4541 4420 3d20 2274 6865 6164  H_THEAD = "thead
+00000320: 220a 485f 5449 544c 4520 3d20 2274 6974  ".H_TITLE = "tit
+00000330: 6c65 220a 485f 5442 4f44 5920 3d20 2274  le".H_TBODY = "t
+00000340: 626f 6479 220a 485f 5452 203d 2022 7472  body".H_TR = "tr
+00000350: 220a 485f 5448 203d 2022 7468 220a 485f  ".H_TH = "th".H_
+00000360: 5444 203d 2022 7464 220a 485f 4449 5620  TD = "td".H_DIV 
+00000370: 3d20 2264 6976 220a 485f 5350 414e 203d  = "div".H_SPAN =
+00000380: 2022 7370 616e 220a 485f 554c 203d 2022   "span".H_UL = "
+00000390: 756c 220a 485f 4c49 203d 2022 6c69 220a  ul".H_LI = "li".
+000003a0: 485f 4120 3d20 2261 220a 485f 4220 3d20  H_A = "a".H_B = 
+000003b0: 2262 220a 485f 5020 3d20 2270 220a 0a58  "b".H_P = "p"..X
+000003c0: 203d 2022 7822 0a59 203d 2022 7922 0a58   = "x".Y = "y".X
+000003d0: 3020 3d20 2278 3022 0a58 3120 3d20 2278  0 = "x0".X1 = "x
+000003e0: 3122 0a0a 2320 4854 4d4c 2061 7474 7269  1"..# HTML attri
+000003f0: 6275 7465 730a 415f 434c 4153 5320 3d20  butes.A_CLASS = 
+00000400: 2263 6c61 7373 220a 415f 4852 4546 203d  "class".A_HREF =
+00000410: 2022 6872 6566 220a 415f 4944 203d 2022   "href".A_ID = "
+00000420: 6964 220a 415f 4e41 4d45 203d 2022 6e61  id".A_NAME = "na
+00000430: 6d65 220a 415f 5354 594c 4520 3d20 2273  me".A_STYLE = "s
+00000440: 7479 6c65 220a 415f 5445 524d 203d 2022  tyle".A_TERM = "
+00000450: 7465 726d 220a 415f 5449 544c 4520 3d20  term".A_TITLE = 
+00000460: 2274 6974 6c65 220a 0a58 5f50 5245 4345  "title"..X_PRECE
+00000470: 4449 4e47 203d 2022 7072 6563 6564 696e  DING = "precedin
+00000480: 6722 0a0a 2320 7374 796c 6520 6275 6e64  g"..# style bund
+00000490: 6c65 0a53 5459 4c45 203d 2022 7374 796c  le.STYLE = "styl
+000004a0: 6522 0a49 5441 4c49 4320 3d20 2269 7461  e".ITALIC = "ita
+000004b0: 6c69 6322 0a42 4f4c 4420 3d20 2262 6f6c  lic".BOLD = "bol
+000004c0: 6422 0a54 494d 4553 203d 2022 7469 6d65  d".TIMES = "time
+000004d0: 7322 0a43 414c 4942 5249 203d 2022 6361  s".CALIBRI = "ca
+000004e0: 6c69 6272 6922 0a46 4f4e 545f 4641 4d49  libri".FONT_FAMI
+000004f0: 4c49 4553 203d 205b 5449 4d45 532c 2043  LIES = [TIMES, C
+00000500: 414c 4942 5249 5d0a 0a23 2073 7479 6c65  ALIBRI]..# style
+00000510: 2061 7474 7269 6275 7465 730a 464f 4e54   attributes.FONT
+00000520: 5f53 495a 4520 3d20 2266 6f6e 742d 7369  _SIZE = "font-si
+00000530: 7a65 220a 464f 4e54 5f53 5459 4c45 203d  ze".FONT_STYLE =
+00000540: 2022 666f 6e74 2d73 7479 6c65 220a 464f   "font-style".FO
+00000550: 4e54 5f57 4549 4748 5420 3d20 2266 6f6e  NT_WEIGHT = "fon
+00000560: 742d 7765 6967 6874 220a 464f 4e54 5f46  t-weight".FONT_F
+00000570: 414d 494c 5920 3d20 2266 6f6e 742d 6661  AMILY = "font-fa
+00000580: 6d69 6c79 220a 464f 4e54 5f46 4f4e 5420  mily".FONT_FONT 
+00000590: 3d20 2266 6f6e 7422 0a46 4f4e 545f 4e41  = "font".FONT_NA
+000005a0: 4d45 203d 2022 666f 6e74 2d6e 616d 6522  ME = "font-name"
+000005b0: 0a46 4f4e 545f 5354 5245 5443 4845 4420  .FONT_STRETCHED 
+000005c0: 3d20 2266 6f6e 742d 7374 7265 7463 6865  = "font-stretche
+000005d0: 6422 0a46 494c 4c20 3d20 2266 696c 6c22  d".FILL = "fill"
+000005e0: 0a53 5452 4f4b 4520 3d20 2273 7472 6f6b  .STROKE = "strok
+000005f0: 6522 0a0a 2320 6368 6172 6163 7465 7220  e"..# character 
+00000600: 7072 6f70 6572 7469 6573 0a50 5f46 4f4e  properties.P_FON
+00000610: 544e 414d 4520 3d20 2266 6f6e 746e 616d  TNAME = "fontnam
+00000620: 6522 0a50 5f48 4549 4748 5420 3d20 2268  e".P_HEIGHT = "h
+00000630: 6569 6768 7422 0a50 5f53 5452 4f4b 494e  eight".P_STROKIN
+00000640: 475f 434f 4c4f 5220 3d20 2273 7472 6f6b  G_COLOR = "strok
+00000650: 696e 675f 636f 6c6f 7222 0a50 5f4e 4f4e  ing_color".P_NON
+00000660: 5f53 5452 4f4b 494e 475f 434f 4c4f 5220  _STROKING_COLOR 
+00000670: 3d20 226e 6f6e 5f73 7472 6f6b 696e 675f  = "non_stroking_
+00000680: 636f 6c6f 7222 0a0a 505f 5830 203d 2022  color"..P_X0 = "
+00000690: 7830 220a 505f 5831 203d 2022 7831 220a  x0".P_X1 = "x1".
+000006a0: 505f 5930 203d 2022 7930 220a 505f 5931  P_Y0 = "y0".P_Y1
+000006b0: 203d 2022 7931 220a 505f 5445 5854 203d   = "y1".P_TEXT =
+000006c0: 2022 7465 7874 220a 0a23 2055 6e77 616e   "text"..# Unwan
+000006d0: 7465 6420 7365 6374 696f 6e73 0a55 5f58  ted sections.U_X
+000006e0: 5041 5448 203d 2022 7870 6174 6822 0a55  PATH = "xpath".U
+000006f0: 5f52 4547 4558 203d 2022 7265 6765 7822  _REGEX = "regex"
+00000700: 0a0a 5354 594c 4553 203d 205b 0a20 2020  ..STYLES = [.   
+00000710: 2046 4f4e 545f 5349 5a45 2c0a 2020 2020   FONT_SIZE,.    
+00000720: 464f 4e54 5f53 5459 4c45 2c0a 2020 2020  FONT_STYLE,.    
+00000730: 464f 4e54 5f46 414d 494c 592c 0a20 2020  FONT_FAMILY,.   
+00000740: 2046 4f4e 545f 5745 4947 4854 2c0a 2020   FONT_WEIGHT,.  
+00000750: 2020 4649 4c4c 2c0a 2020 2020 5354 524f    FILL,.    STRO
+00000760: 4b45 2c0a 5d0a 0a23 2043 5353 0a53 5f42  KE,.]..# CSS.S_B
+00000770: 4f52 4445 5220 3d20 2262 6f72 6465 7222  ORDER = "border"
+00000780: 0a53 5f50 4f53 4954 494f 4e20 3d20 2270  .S_POSITION = "p
+00000790: 6f73 6974 696f 6e22 0a53 5f57 4944 5448  osition".S_WIDTH
+000007a0: 203d 2022 7769 6474 6822 0a53 5f57 5249   = "width".S_WRI
+000007b0: 5449 4e47 5f4d 4f44 4520 3d20 2277 7269  TING_MODE = "wri
+000007c0: 7469 6e67 2d6d 6f64 6522 0a0a 5f55 5446  ting-mode".._UTF
+000007d0: 3820 3d20 2255 5446 2d38 220a 0a43 4841  8 = "UTF-8"..CHA
+000007e0: 505f 544f 505f 5245 4320 3d20 7265 2e63  P_TOP_REC = re.c
+000007f0: 6f6d 7069 6c65 2822 5f5f 4e4f 545f 5f59  ompile("__NOT__Y
+00000800: 4554 5f5f 494d 504c 454d 454e 5445 445f  ET__IMPLEMENTED_
+00000810: 5f22 290a 5345 4354 494f 4e53 5f44 4543  _").SECTIONS_DEC
+00000820: 494d 414c 5f52 4543 203d 2072 652e 636f  IMAL_REC = re.co
+00000830: 6d70 696c 6528 225c 5c64 2b5c 5c2e 5c5c  mpile("\\d+\\.\\
+00000840: 642b 2422 290a 5355 4253 4543 5453 5f44  d+$").SUBSECTS_D
+00000850: 4543 494d 414c 5f52 4543 203d 2072 652e  ECIMAL_REC = re.
+00000860: 636f 6d70 696c 6528 225c 5c64 2b5c 5c2e  compile("\\d+\\.
+00000870: 5c5c 642b 5c5c 2e5c 5c64 2b24 2229 0a0a  \\d+\\.\\d+$")..
+00000880: 434c 4153 5352 4546 203d 2022 636c 6173  CLASSREF = "clas
+00000890: 7372 6566 220a 0a53 5459 4c45 5f58 5041  sref"..STYLE_XPA
+000008a0: 5448 203d 2022 2f68 746d 6c2f 6865 6164  TH = "/html/head
+000008b0: 2f73 7479 6c65 220a 0a22 2222 0a4e 4f54  /style"..""".NOT
+000008c0: 452e 2074 6865 2075 7365 206f 6620 636c  E. the use of cl
+000008d0: 6173 736e 616d 652c 2063 6c61 7373 7265  assname, classre
+000008e0: 6620 616e 6420 7369 6d69 6c61 7220 6973  f and similar is
+000008f0: 2069 6e63 6f6e 7369 7374 656e 742e 2057   inconsistent. W
+00000900: 6520 7761 6e74 2074 6f20 6861 7665 3a0a  e want to have:.
+00000910: 7331 2020 746f 206d 6561 6e20 636c 6173  s1  to mean clas
+00000920: 7320 6e61 6d65 2028 636c 6173 736e 616d  s name (classnam
+00000930: 6529 0a2e 7331 2074 6f20 6d65 616e 2061  e)..s1 to mean a
+00000940: 2072 6566 6572 656e 6365 2074 6f20 6120   reference to a 
+00000950: 636c 6173 736e 616d 6520 286f 6e6c 7920  classname (only 
+00000960: 7573 6564 2069 6e20 3c73 7479 6c65 3e20  used in <style> 
+00000970: 656c 656d 656e 7473 2062 7574 2069 6e76  elements but inv
+00000980: 6f6c 7665 6420 696e 2063 6f6e 7665 7273  olved in convers
+00000990: 696f 6e73 0a22 2222 0a0a 6c6f 6767 6572  ions."""..logger
+000009a0: 203d 206c 6f67 6769 6e67 2e67 6574 4c6f   = logging.getLo
+000009b0: 6767 6572 285f 5f66 696c 655f 5f29 0a0a  gger(__file__)..
+000009c0: 0a63 6c61 7373 2041 6d69 5370 616e 3a0a  .class AmiSpan:.
+000009d0: 2020 2020 6465 6620 5f5f 696e 6974 5f5f      def __init__
+000009e0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+000009f0: 7365 6c66 2e74 6578 745f 7374 796c 6520  self.text_style 
+00000a00: 3d20 4e6f 6e65 0a20 2020 2020 2020 2073  = None.        s
+00000a10: 656c 662e 7374 7269 6e67 203d 2022 220a  elf.string = "".
+00000a20: 2020 2020 2020 2020 7365 6c66 2e78 7820          self.xx 
+00000a30: 3d20 5b5d 0a20 2020 2020 2020 2073 656c  = [].        sel
+00000a40: 662e 7830 203d 204e 6f6e 650a 2020 2020  f.x0 = None.    
+00000a50: 2020 2020 7365 6c66 2e78 3120 3d20 4e6f      self.x1 = No
+00000a60: 6e65 0a20 2020 2020 2020 2073 656c 662e  ne.        self.
+00000a70: 7930 203d 204e 6f6e 650a 2020 2020 2020  y0 = None.      
+00000a80: 2020 2320 7365 6c66 2e61 6476 203d 204e    # self.adv = N
+00000a90: 6f6e 650a 0a20 2020 2064 6566 2063 7265  one..    def cre
+00000aa0: 6174 655f 616e 645f 6164 645f 746f 2873  ate_and_add_to(s
+00000ab0: 656c 662c 2064 6976 293a 0a20 2020 2020  elf, div):.     
+00000ac0: 2020 2068 746d 6c5f 7370 616e 203d 204e     html_span = N
+00000ad0: 6f6e 650a 2020 2020 2020 2020 6966 2064  one.        if d
+00000ae0: 6976 2069 7320 6e6f 7420 4e6f 6e65 3a0a  iv is not None:.
+00000af0: 2020 2020 2020 2020 2020 2020 6874 6d6c              html
+00000b00: 5f73 7061 6e20 3d20 4554 2e53 7562 456c  _span = ET.SubEl
+00000b10: 656d 656e 7428 6469 762c 2048 5f53 5041  ement(div, H_SPA
+00000b20: 4e29 0a20 2020 2020 2020 2020 2020 2068  N).            h
+00000b30: 746d 6c5f 7370 616e 2e74 6578 7420 3d20  tml_span.text = 
+00000b40: 7365 6c66 2e73 7472 696e 670a 2020 2020  self.string.    
+00000b50: 2020 2020 2020 2020 4874 6d6c 5374 796c          HtmlStyl
+00000b60: 652e 7365 745f 7374 796c 6528 6874 6d6c  e.set_style(html
+00000b70: 5f73 7061 6e2c 2073 656c 662e 7465 7874  _span, self.text
+00000b80: 5f73 7479 6c65 2e63 7265 6174 655f 6373  _style.create_cs
+00000b90: 735f 7374 7269 6e67 2829 290a 2020 2020  s_string()).    
+00000ba0: 2020 2020 2020 2020 6966 206c 656e 2873          if len(s
+00000bb0: 656c 662e 7878 2920 3e20 303a 0a20 2020  elf.xx) > 0:.   
+00000bc0: 2020 2020 2020 2020 2020 2020 2068 746d               htm
+00000bd0: 6c5f 7370 616e 2e61 7474 7269 625b 585d  l_span.attrib[X]
+00000be0: 203d 2073 656c 662e 7878 5b30 5d0a 2020   = self.xx[0].  
+00000bf0: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
+00000c00: 662e 7830 3a0a 2020 2020 2020 2020 2020  f.x0:.          
+00000c10: 2020 2020 2020 6874 6d6c 5f73 7061 6e2e        html_span.
+00000c20: 6174 7472 6962 5b58 305d 203d 2073 7472  attrib[X0] = str
+00000c30: 2873 656c 662e 7830 290a 2020 2020 2020  (self.x0).      
+00000c40: 2020 2020 2020 6966 2073 656c 662e 7831        if self.x1
+00000c50: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00000c60: 2020 6874 6d6c 5f73 7061 6e2e 6174 7472    html_span.attr
+00000c70: 6962 5b58 315d 203d 2073 7472 2873 656c  ib[X1] = str(sel
+00000c80: 662e 7831 290a 2020 2020 2020 2020 2020  f.x1).          
+00000c90: 2020 6874 6d6c 5f73 7061 6e2e 6174 7472    html_span.attr
+00000ca0: 6962 5b59 5d20 3d20 7374 7228 7365 6c66  ib[Y] = str(self
+00000cb0: 2e79 3029 0a20 2020 2020 2020 2072 6574  .y0).        ret
+00000cc0: 7572 6e20 6874 6d6c 5f73 7061 6e0a 0a0a  urn html_span...
+00000cd0: 2320 7368 6f75 6c64 206d 6179 6265 2062  # should maybe b
+00000ce0: 6520 696e 2050 4446 0a63 6c61 7373 2050  e in PDF.class P
+00000cf0: 6167 6542 6f78 3a20 2023 2064 6566 696e  ageBox:  # defin
+00000d00: 6564 2062 7920 7064 666d 696e 6572 2049  ed by pdfminer I
+00000d10: 2074 6869 6e6b 0a0a 2020 2020 2222 220a   think..    """.
+00000d20: 3c62 723e 3c73 7061 6e20 7374 796c 653d  <br><span style=
+00000d30: 2270 6f73 6974 696f 6e3a 6162 736f 6c75  "position:absolu
+00000d40: 7465 3b20 626f 7264 6572 3a20 6772 6179  te; border: gray
+00000d50: 2031 7078 2073 6f6c 6964 3b20 6c65 6674   1px solid; left
+00000d60: 3a30 7078 3b20 746f 703a 3934 3170 783b  :0px; top:941px;
+00000d70: 2077 6964 7468 3a35 3935 7078 3b20 6865   width:595px; he
+00000d80: 6967 6874 3a38 3431 7078 3b22 3e3c 2f73  ight:841px;"></s
+00000d90: 7061 6e3e 0a3c 6469 7620 7374 796c 653d  pan>.<div style=
+00000da0: 2270 6f73 6974 696f 6e3a 6162 736f 6c75  "position:absolu
+00000db0: 7465 3b20 746f 703a 3934 3170 783b 223e  te; top:941px;">
+00000dc0: 3c61 206e 616d 653d 2232 223e 5061 6765  <a name="2">Page
+00000dd0: 2032 3c2f 613e 3c2f 6469 763e 0a0a 666f   2</a></div>..fo
+00000de0: 7220 4950 4343 2074 6f70 2850 6167 6531  r IPCC top(Page1
+00000df0: 2920 3d20 3530 0a74 6f70 2850 6167 656e  ) = 50.top(Pagen
+00000e00: 2920 3d20 3530 202b 2028 6e20 2d20 3129  ) = 50 + (n - 1)
+00000e10: 202a 2028 3834 3120 2b20 3437 290a 0a20   * (841 + 47).. 
+00000e20: 2020 2022 2222 0a0a 2020 2020 6465 6620     """..    def 
+00000e30: 5f5f 696e 6974 5f5f 2873 656c 662c 2063  __init__(self, c
+00000e40: 7373 5f73 7479 6c65 3d4e 6f6e 6529 3a0a  ss_style=None):.
+00000e50: 2020 2020 2020 2020 7365 6c66 2e63 7373          self.css
+00000e60: 5f73 7479 6c65 203d 2063 7373 5f73 7479  _style = css_sty
+00000e70: 6c65 0a20 2020 2020 2020 2073 656c 662e  le.        self.
+00000e80: 6262 6f78 203d 2042 426f 7828 2920 2023  bbox = BBox()  #
+00000e90: 2075 6e69 6e69 7469 616c 6973 6564 0a20   uninitialised. 
+00000ea0: 2020 2020 2020 2069 6620 7365 6c66 2e63         if self.c
+00000eb0: 7373 5f73 7479 6c65 3a0a 2020 2020 2020  ss_style:.      
+00000ec0: 2020 2020 2020 746f 7020 3d20 7365 6c66        top = self
+00000ed0: 2e63 7373 5f73 7479 6c65 2e74 6f70 0a20  .css_style.top. 
+00000ee0: 2020 2020 2020 2020 2020 206c 6566 7420             left 
+00000ef0: 3d20 7365 6c66 2e63 7373 5f73 7479 6c65  = self.css_style
+00000f00: 2e6c 6566 740a 2020 2020 2020 2020 2020  .left.          
+00000f10: 2020 7769 6474 6820 3d20 7365 6c66 2e63    width = self.c
+00000f20: 7373 5f73 7479 6c65 2e77 6964 7468 0a20  ss_style.width. 
+00000f30: 2020 2020 2020 2020 2020 2068 6569 6768             heigh
+00000f40: 7420 3d20 7365 6c66 2e63 7373 5f73 7479  t = self.css_sty
+00000f50: 6c65 2e68 6569 6768 740a 2020 2020 2020  le.height.      
+00000f60: 2020 2020 2020 7365 6c66 2e62 626f 782e        self.bbox.
+00000f70: 7879 5f72 616e 6765 7320 3d20 5b5b 6c65  xy_ranges = [[le
+00000f80: 6674 2c20 6c65 6674 202b 2077 6964 7468  ft, left + width
+00000f90: 5d2c 205b 746f 702c 2074 6f70 202b 2068  ], [top, top + h
+00000fa0: 6569 6768 745d 5d0a 2020 2020 2020 2020  eight]].        
+00000fb0: 7365 6c66 2e65 6c65 6d20 3d20 4e6f 6e65  self.elem = None
+00000fc0: 0a20 2020 2020 2020 2073 656c 662e 696e  .        self.in
+00000fd0: 745f 6e75 6d62 6572 203d 204e 6f6e 6520  t_number = None 
+00000fe0: 2023 2070 6466 706c 756d 6265 7220 696e   # pdfplumber in
+00000ff0: 7465 6765 7220 7061 6765 2028 312d 6261  teger page (1-ba
+00001000: 7365 6429 0a20 2020 2020 2020 2073 656c  sed).        sel
+00001010: 662e 705f 6e75 6d5f 7374 7220 3d20 4e6f  f.p_num_str = No
+00001020: 6e65 2020 2320 7064 6670 6c75 6d62 6572  ne  # pdfplumber
+00001030: 2022 5061 6765 2031 3222 0a0a 2020 2020   "Page 12"..    
+00001040: 4070 726f 7065 7274 790a 2020 2020 6465  @property.    de
+00001050: 6620 7061 6765 5f6e 756d 6265 7228 7365  f page_number(se
+00001060: 6c66 293a 0a20 2020 2020 2020 2069 6620  lf):.        if 
+00001070: 6e6f 7420 7365 6c66 2e69 6e74 5f6e 756d  not self.int_num
+00001080: 6265 723a 0a20 2020 2020 2020 2020 2020  ber:.           
+00001090: 2073 656c 662e 696e 745f 6e75 6d62 6572   self.int_number
+000010a0: 203d 204e 6f6e 6520 6966 2073 656c 662e   = None if self.
+000010b0: 656c 656d 2069 7320 4e6f 6e65 2065 6c73  elem is None els
+000010c0: 6520 5061 6765 426f 782e 6578 7472 6163  e PageBox.extrac
+000010d0: 745f 7061 6765 5f6e 756d 6265 725f 6672  t_page_number_fr
+000010e0: 6f6d 5f70 6466 5f68 746d 6c28 7365 6c66  om_pdf_html(self
+000010f0: 2e65 6c65 6d29 0a20 2020 2020 2020 2072  .elem).        r
+00001100: 6574 7572 6e20 7365 6c66 2e69 6e74 5f6e  eturn self.int_n
+00001110: 756d 6265 720a 0a20 2020 2040 636c 6173  umber..    @clas
+00001120: 736d 6574 686f 640a 2020 2020 6465 6620  smethod.    def 
+00001130: 6578 7472 6163 745f 7061 6765 5f6e 756d  extract_page_num
+00001140: 6265 725f 6672 6f6d 5f70 6466 5f68 746d  ber_from_pdf_htm
+00001150: 6c28 636c 732c 2065 6c65 6d29 3a0a 2020  l(cls, elem):.  
+00001160: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00001170: 2020 736f 6d65 2065 6c65 6d65 6e74 7320    some elements 
+00001180: 3f73 7061 6e73 2920 6672 6f6d 2070 6466  ?spans) from pdf
+00001190: 2070 6172 7369 6e67 2068 6176 6520 7468   parsing have th
+000011a0: 6520 666f 726d 3a0a 2020 2020 2020 2020  e form:.        
+000011b0: 3c64 6976 202e 2e2e 3e3c 6120 6e61 6d65  <div ...><a name
+000011c0: 3d22 3222 3e50 6167 6520 323c 2f61 3e0a  ="2">Page 2</a>.
+000011d0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+000011e0: 656c 656d 3a20 636f 6e74 6169 6e73 2070  elem: contains p
+000011f0: 6167 6520 6e75 6d62 6572 0a20 2020 2020  age number.     
+00001200: 2020 203a 7265 7475 726e 3a20 7061 6765     :return: page
+00001210: 206e 756d 6265 7220 6f72 206e 6f6e 650a   number or none.
+00001220: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00001230: 2020 2020 6966 2065 6c65 6d20 6973 204e      if elem is N
+00001240: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+00001250: 2072 6574 7572 6e20 4e6f 6e65 0a20 2020   return None.   
+00001260: 2020 2020 2078 7061 7468 7820 3d20 6622       xpathx = f"
+00001270: 2e2f 2f61 2f40 7b41 5f4e 414d 457d 220a  .//a/@{A_NAME}".
+00001280: 2020 2020 2020 2020 616e 616d 6520 3d20          aname = 
+00001290: 656c 656d 2e78 7061 7468 2878 7061 7468  elem.xpath(xpath
+000012a0: 7829 0a20 2020 2020 2020 2072 6574 7572  x).        retur
+000012b0: 6e20 616e 616d 650a 0a20 2020 2064 6566  n aname..    def
+000012c0: 2061 6464 5f73 7479 6c65 5f73 7061 6e5f   add_style_span_
+000012d0: 616e 645f 7061 6765 5f6e 756d 6265 7228  and_page_number(
+000012e0: 7365 6c66 2c20 656c 656d 293a 0a20 2020  self, elem):.   
+000012f0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00001300: 2061 6464 2073 7479 6c65 2073 7061 6e20   add style span 
+00001310: 2061 6e64 2061 6c73 6f20 6765 7420 7061   and also get pa
+00001320: 6765 6e75 6d62 6572 2066 726f 6d20 6e65  genumber from ne
+00001330: 7874 2065 6c65 6d65 6e74 0a0a 2020 2020  xt element..    
+00001340: 2020 2020 7479 7069 6361 6c20 7472 6169      typical trai
+00001350: 6c69 6e67 2065 6c65 6d65 6e74 0a20 2020  ling element.   
+00001360: 2020 2020 203c 6469 7620 7374 796c 653d       <div style=
+00001370: 2270 6f73 6974 696f 6e3a 6162 736f 6c75  "position:absolu
+00001380: 7465 3b20 746f 703a 3130 3735 3370 783b  te; top:10753px;
+00001390: 223e 3c61 206e 616d 653d 2231 3322 3e50  "><a name="13">P
+000013a0: 6167 6520 3133 3c2f 613e 3c2f 6469 763e  age 13</a></div>
+000013b0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+000013c0: 2020 2020 2073 656c 662e 656c 656d 203d       self.elem =
+000013d0: 2065 6c65 6d0a 2020 2020 2020 2020 7061   elem.        pa
+000013e0: 6765 5f64 6976 203d 2065 6c65 6d2e 6765  ge_div = elem.ge
+000013f0: 746e 6578 7428 290a 2020 2020 2020 2020  tnext().        
+00001400: 6966 2070 6167 655f 6469 7620 6973 206e  if page_div is n
+00001410: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+00001420: 2020 2020 206e 203d 2070 6167 655f 6469       n = page_di
+00001430: 762e 7870 6174 6828 6622 2e2f 612f 407b  v.xpath(f"./a/@{
+00001440: 415f 4e41 4d45 7d22 290a 2020 2020 2020  A_NAME}").      
+00001450: 2020 2020 2020 6e20 3d20 6e5b 305d 2069        n = n[0] i
+00001460: 6620 6c65 6e28 6e29 203d 3d20 3120 656c  f len(n) == 1 el
+00001470: 7365 204e 6f6e 650a 2020 2020 2020 2020  se None.        
+00001480: 2020 2020 6966 206e 3a0a 2020 2020 2020      if n:.      
+00001490: 2020 2020 2020 2020 2020 7365 6c66 2e69            self.i
+000014a0: 6e74 5f6e 756d 6265 7220 3d20 696e 7428  nt_number = int(
+000014b0: 6e29 0a0a 2020 2020 2020 2020 2020 2020  n)..            
+000014c0: 7020 3d20 7061 6765 5f64 6976 2e78 7061  p = page_div.xpa
+000014d0: 7468 2866 222e 2f61 5b40 7b41 5f4e 414d  th(f"./a[@{A_NAM
+000014e0: 457d 2061 6e64 2063 6f6e 7461 696e 7328  E} and contains(
+000014f0: 2e2c 2027 5061 6765 2729 5d22 290a 2020  ., 'Page')]").  
+00001500: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
+00001510: 5f6e 756d 5f73 7472 203d 2070 5b30 5d20  _num_str = p[0] 
+00001520: 6966 206c 656e 2870 2920 3d3d 2031 2065  if len(p) == 1 e
+00001530: 6c73 6520 4e6f 6e65 0a0a 0a63 6c61 7373  lse None...class
+00001540: 2048 746d 6c54 6964 793a 0a20 2020 2022   HtmlTidy:.    "
+00001550: 2222 666f 7220 7469 6479 696e 6720 5044  ""for tidying PD
+00001560: 4620 2f20 5356 472f 204f 4352 2070 6172  F / SVG/ OCR par
+00001570: 7369 6e67 0a20 2020 2074 616b 6573 2072  sing.    takes r
+00001580: 6177 2048 544d 4c20 2870 726f 6261 626c  aw HTML (probabl
+00001590: 7920 7363 6174 7465 7265 6420 776f 7264  y scattered word
+000015a0: 7320 6f72 206c 696e 6573 202c 2070 6f73  s or lines , pos
+000015b0: 7369 626c 7920 7769 7468 2063 6f6f 7264  sibly with coord
+000015c0: 696e 6174 6573 2061 6e64 2063 7265 6174  inates and creat
+000015d0: 6573 0a20 2020 2066 6c6f 7769 6e67 2073  es.    flowing s
+000015e0: 7479 6c65 6420 4854 4d4c 2077 6974 6820  tyled HTML with 
+000015f0: 7375 6273 6372 6970 7473 2c20 666f 6e74  subscripts, font
+00001600: 2073 7479 6c65 732c 2065 7463 2e0a 2020   styles, etc..  
+00001610: 2020 2222 220a 0a20 2020 204d 494e 5f50    """..    MIN_P
+00001620: 4147 455f 424f 585f 4845 4947 4854 203d  AGE_BOX_HEIGHT =
+00001630: 2033 3030 2020 2320 616c 6c6f 7773 2066   300  # allows f
+00001640: 6f72 206c 616e 6473 6361 7065 0a20 2020  or landscape.   
+00001650: 2048 4541 445f 454c 454d 535f 494e 5f58   HEAD_ELEMS_IN_X
+00001660: 5041 5448 203d 2066 227b 485f 4d45 5441  PATH = f"{H_META
+00001670: 7d20 7c20 7b48 5f54 4954 4c45 7d20 7c20  } | {H_TITLE} | 
+00001680: 7b48 5f53 4352 4950 547d 207c 207b 485f  {H_SCRIPT} | {H_
+00001690: 5354 594c 457d 220a 0a20 2020 2064 6566  STYLE}"..    def
+000016a0: 205f 5f69 6e69 745f 5f28 7365 6c66 293a   __init__(self):
+000016b0: 0a20 2020 2020 2020 2073 656c 662e 756e  .        self.un
+000016c0: 7761 6e74 6564 7320 3d20 5b5d 2020 2320  wanteds = []  # 
+000016d0: 6e6f 7420 7375 7265 2077 6861 7420 7468  not sure what th
+000016e0: 6973 2069 730a 2020 2020 2020 2020 7365  is is.        se
+000016f0: 6c66 2e65 6d70 7479 5f65 6c65 6d65 6e74  lf.empty_element
+00001700: 735f 746f 5f72 656d 6f76 6520 3d20 5b5d  s_to_remove = []
+00001710: 0a20 2020 2020 2020 2073 656c 662e 7374  .        self.st
+00001720: 796c 6573 5f74 6f5f 7265 6d6f 7665 203d  yles_to_remove =
+00001730: 205b 5d0a 2020 2020 2020 2020 7365 6c66   [].        self
+00001740: 2e64 6573 6365 6e64 616e 7473 5f74 6f5f  .descendants_to_
+00001750: 7265 6d6f 7665 203d 205b 5d0a 2020 2020  remove = [].    
+00001760: 2020 2020 7365 6c66 2e72 656d 6f76 655f      self.remove_
+00001770: 6c68 5f6c 696e 655f 6e75 6d62 6572 7320  lh_line_numbers 
+00001780: 3d20 5472 7565 0a20 2020 2020 2020 2073  = True.        s
+00001790: 656c 662e 7265 6d6f 7665 5f6c 6172 6765  elf.remove_large
+000017a0: 5f66 6f6e 7465 645f 656c 656d 656e 7473  _fonted_elements
+000017b0: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
+000017c0: 7365 6c66 2e73 7479 6c65 5f61 7474 7269  self.style_attri
+000017d0: 6275 7465 735f 746f 5f72 656d 6f76 6520  butes_to_remove 
+000017e0: 3d20 5b5d 0a20 2020 2020 2020 2073 656c  = [].        sel
+000017f0: 662e 6d61 726b 6572 5f78 7061 7468 203d  f.marker_xpath =
+00001800: 204e 6f6e 650a 2020 2020 2020 2020 7365   None.        se
+00001810: 6c66 2e73 7479 6c65 5f61 7474 7269 6275  lf.style_attribu
+00001820: 7465 735f 746f 5f72 656d 6f76 6520 3d20  tes_to_remove = 
+00001830: 5b5d 0a0a 2020 2020 2020 2020 7365 6c66  []..        self
+00001840: 2e61 6464 5f69 6420 3d20 5472 7565 0a20  .add_id = True. 
+00001850: 2020 2020 2020 2073 656c 662e 6865 6164         self.head
+00001860: 6572 203d 2038 300a 2020 2020 2020 2020  er = 80.        
+00001870: 7365 6c66 2e66 6f6f 7465 7220 3d20 3830  self.footer = 80
+00001880: 0a20 2020 2020 2020 2073 656c 662e 7061  .        self.pa
+00001890: 6765 5f74 6f70 7320 3d20 4e6f 6e65 0a20  ge_tops = None. 
+000018a0: 2020 2020 2020 2073 656c 662e 7061 6765         self.page
+000018b0: 5f62 6f78 6573 203d 205b 5d0a 2020 2020  _boxes = [].    
+000018c0: 2020 2020 7365 6c66 2e72 6177 5f65 6c65      self.raw_ele
+000018d0: 6d20 3d20 4e6f 6e65 0a20 2020 2020 2020  m = None.       
+000018e0: 2073 656c 662e 6f75 7464 6972 203d 204e   self.outdir = N
+000018f0: 6f6e 650a 0a20 2020 2064 6566 2074 6964  one..    def tid
+00001900: 795f 666c 6f77 2873 656c 662c 2072 6177  y_flow(self, raw
+00001910: 5f68 746d 6c29 3a0a 2020 2020 2020 2020  _html):.        
+00001920: 2222 220a 2020 2020 2020 2020 4e65 6564  """.        Need
+00001930: 2074 6f20 6361 7074 7572 6520 7061 6765   to capture page
+00001940: 2069 6e66 6f72 6d61 7469 6f6e 2074 6f20   information to 
+00001950: 636f 6d70 7574 6520 7061 6765 2063 6f6f  compute page coo
+00001960: 7264 696e 6174 6573 2c20 6e6f 7420 646f  rdinates, not do
+00001970: 6375 6d65 6e74 2063 6f6f 7264 696e 6174  cument coordinat
+00001980: 6573 0a20 2020 2020 2020 2063 6f6e 7665  es.        conve
+00001990: 7274 7320 7261 7720 6874 6d6c 2074 6f20  rts raw html to 
+000019a0: 7469 6479 0a20 2020 2020 2020 2022 2222  tidy.        """
+000019b0: 0a0a 2020 2020 2020 2020 2320 544f 444f  ..        # TODO
+000019c0: 2063 6865 636b 2061 6e64 206d 6f76 6520   check and move 
+000019d0: 746f 2069 6e73 7461 6e63 6520 6f66 2048  to instance of H
+000019e0: 746d 6c54 6964 790a 0a20 2020 2020 2020  tmlTidy..       
+000019f0: 2069 6620 7261 775f 6874 6d6c 2069 7320   if raw_html is 
+00001a00: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00001a10: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
+00001a20: 6f72 2822 4e6f 2048 544d 4c22 290a 2020  or("No HTML").  
+00001a30: 2020 2020 2020 7261 775f 7472 6565 203d        raw_tree =
+00001a40: 2045 542e 7061 7273 6528 5374 7269 6e67   ET.parse(String
+00001a50: 494f 2872 6177 5f68 746d 6c29 2c20 4554  IO(raw_html), ET
+00001a60: 2e48 544d 4c50 6172 7365 7228 2929 0a20  .HTMLParser()). 
+00001a70: 2020 2020 2020 2073 656c 662e 7261 775f         self.raw_
+00001a80: 656c 656d 203d 2072 6177 5f74 7265 652e  elem = raw_tree.
+00001a90: 6765 7472 6f6f 7428 290a 2020 2020 2020  getroot().      
+00001aa0: 2020 7365 6c66 2e65 7874 7261 6374 5f70    self.extract_p
+00001ab0: 6167 655f 626f 7865 7328 290a 0a20 2020  age_boxes()..   
+00001ac0: 2020 2020 2073 656c 662e 6164 645f 656c       self.add_el
+00001ad0: 656d 656e 7428 7365 6c66 2e72 6177 5f65  ement(self.raw_e
+00001ae0: 6c65 6d29 0a0a 2020 2020 2020 2020 2320  lem)..        # 
+00001af0: 7468 6973 2069 7320 7365 7420 6279 2075  this is set by u
+00001b00: 7365 720a 2020 2020 2020 2020 7365 6c66  ser.        self
+00001b10: 2e73 6574 5f72 656d 6f76 655f 666c 6167  .set_remove_flag
+00001b20: 7328 290a 0a20 2020 2020 2020 2073 656c  s()..        sel
+00001b30: 662e 7265 6d6f 7665 5f75 6e77 616e 7465  f.remove_unwante
+00001b40: 645f 6174 7472 6962 7574 6573 5f61 6e64  d_attributes_and
+00001b50: 5f65 6c65 6d65 6e74 7328 290a 2020 2020  _elements().    
+00001b60: 2020 2020 7061 6765 7369 7a65 203d 204e      pagesize = N
+00001b70: 6f6e 650a 2020 2020 2020 2020 6966 2073  one.        if s
+00001b80: 656c 662e 6d61 726b 6572 5f78 7061 7468  elf.marker_xpath
+00001b90: 3a0a 2020 2020 2020 2020 2020 2020 6f66  :.            of
+00001ba0: 6673 6574 2c20 7061 6765 7369 7a65 2c20  fset, pagesize, 
+00001bb0: 7061 6765 5f63 6f6f 7264 7320 3d20 4874  page_coords = Ht
+00001bc0: 6d6c 5574 696c 2e66 696e 645f 636f 6e73  mlUtil.find_cons
+00001bd0: 7461 6e74 5f63 6f6f 7264 696e 6174 655f  tant_coordinate_
+00001be0: 6d61 726b 6572 7328 7365 6c66 2e72 6177  markers(self.raw
+00001bf0: 5f65 6c65 6d2c 2073 656c 662e 6d61 726b  _elem, self.mark
+00001c00: 6572 5f78 7061 7468 290a 2020 2020 2020  er_xpath).      
+00001c10: 2020 2020 2020 4874 6d6c 5574 696c 2e72        HtmlUtil.r
+00001c20: 656d 6f76 655f 6865 6164 6572 735f 616e  emove_headers_an
+00001c30: 645f 666f 6f74 6572 735f 7573 696e 675f  d_footers_using_
+00001c40: 7064 666d 696e 6572 5f63 6f6f 7264 7328  pdfminer_coords(
+00001c50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00001c60: 2073 656c 662e 7261 775f 656c 656d 2c0a   self.raw_elem,.
+00001c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001c80: 7061 6765 7369 7a65 2c0a 2020 2020 2020  pagesize,.      
+00001c90: 2020 2020 2020 2020 2020 7365 6c66 2e68            self.h
+00001ca0: 6561 6465 722c 0a20 2020 2020 2020 2020  eader,.         
+00001cb0: 2020 2020 2020 2073 656c 662e 666f 6f74         self.foot
+00001cc0: 6572 2c0a 2020 2020 2020 2020 2020 2020  er,.            
+00001cd0: 2020 2020 7365 6c66 2e6d 6172 6b65 725f      self.marker_
+00001ce0: 7870 6174 682c 0a20 2020 2020 2020 2020  xpath,.         
+00001cf0: 2020 2020 2020 2070 6167 655f 746f 7073         page_tops
+00001d00: 3d73 656c 662e 7061 6765 5f74 6f70 732c  =self.page_tops,
+00001d10: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+00001d20: 2020 2020 2020 2066 6f72 2061 7474 2069         for att i
+00001d30: 6e20 7365 6c66 2e73 7479 6c65 5f61 7474  n self.style_att
+00001d40: 7269 6275 7465 735f 746f 5f72 656d 6f76  ributes_to_remov
+00001d50: 653a 0a20 2020 2020 2020 2020 2020 2048  e:.            H
+00001d60: 746d 6c55 7469 6c2e 7265 6d6f 7665 5f73  tmlUtil.remove_s
+00001d70: 7479 6c65 5f61 7474 7269 6275 7465 2873  tyle_attribute(s
+00001d80: 656c 662e 7261 775f 656c 656d 2c20 6174  elf.raw_elem, at
+00001d90: 7429 0a20 2020 2020 2020 2048 746d 6c55  t).        HtmlU
+00001da0: 7469 6c2e 7265 6d6f 7665 5f75 6e77 616e  til.remove_unwan
+00001db0: 7465 6473 2873 656c 662e 7261 775f 656c  teds(self.raw_el
+00001dc0: 656d 2c20 7365 6c66 2e75 6e77 616e 7465  em, self.unwante
+00001dd0: 6473 290a 2020 2020 2020 2020 4874 6d6c  ds).        Html
+00001de0: 5574 696c 2e72 656d 6f76 655f 6e65 776c  Util.remove_newl
+00001df0: 696e 6573 2873 656c 662e 7261 775f 656c  ines(self.raw_el
+00001e00: 656d 290a 2020 2020 2020 2020 4874 6d6c  em).        Html
+00001e10: 5472 6565 2e6d 616b 655f 7365 6374 696f  Tree.make_sectio
+00001e20: 6e73 5f61 6e64 5f6f 7574 7075 7428 7365  ns_and_output(se
+00001e30: 6c66 2e72 6177 5f65 6c65 6d2c 206f 7574  lf.raw_elem, out
+00001e40: 7075 745f 6469 723d 7365 6c66 2e6f 7574  put_dir=self.out
+00001e50: 6469 722c 2072 6563 735f 6279 5f73 6563  dir, recs_by_sec
+00001e60: 7469 6f6e 3d52 4543 535f 4259 5f53 4543  tion=RECS_BY_SEC
+00001e70: 5449 4f4e 290a 2020 2020 2020 2020 6874  TION).        ht
+00001e80: 6d6c 7374 7220 3d20 4554 2e74 6f73 7472  mlstr = ET.tostr
+00001e90: 696e 6728 7365 6c66 2e72 6177 5f65 6c65  ing(self.raw_ele
+00001ea0: 6d2c 2065 6e63 6f64 696e 673d 5f55 5446  m, encoding=_UTF
+00001eb0: 3829 2e64 6563 6f64 6528 290a 2020 2020  8).decode().    
+00001ec0: 2020 2020 7265 7475 726e 2068 746d 6c73      return htmls
+00001ed0: 7472 0a0a 2020 2020 6465 6620 7265 6d6f  tr..    def remo
+00001ee0: 7665 5f75 6e77 616e 7465 645f 6174 7472  ve_unwanted_attr
+00001ef0: 6962 7574 6573 5f61 6e64 5f65 6c65 6d65  ibutes_and_eleme
+00001f00: 6e74 7328 7365 6c66 293a 0a20 2020 2020  nts(self):.     
+00001f10: 2020 2022 2222 0a20 2020 2020 2020 2072     """.        r
+00001f20: 656d 6f76 6520 6f62 6a65 6374 7320 6966  emove objects if
+00001f30: 2066 6c61 6773 2068 6176 6520 6265 656e   flags have been
+00001f40: 2073 6574 2069 6e20 7365 6c66 0a20 2020   set in self.   
+00001f50: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00001f60: 2069 6620 7365 6c66 2e61 6464 5f69 643a   if self.add_id:
+00001f70: 0a20 2020 2020 2020 2020 2020 2048 746d  .            Htm
+00001f80: 6c55 7469 6c2e 6164 645f 6765 6e65 7261  lUtil.add_genera
+00001f90: 7465 645f 6964 7328 7365 6c66 2e72 6177  ted_ids(self.raw
+00001fa0: 5f65 6c65 6d29 0a20 2020 2020 2020 2066  _elem).        f
+00001fb0: 6f72 2074 6167 2069 6e20 7365 6c66 2e64  or tag in self.d
+00001fc0: 6573 6365 6e64 616e 7473 5f74 6f5f 7265  escendants_to_re
+00001fd0: 6d6f 7665 3a0a 2020 2020 2020 2020 2020  move:.          
+00001fe0: 2020 4554 2e73 7472 6970 5f74 6167 7328    ET.strip_tags(
+00001ff0: 7365 6c66 2e72 6177 5f65 6c65 6d2c 205b  self.raw_elem, [
+00002000: 7461 675d 290a 2020 2020 2020 2020 6966  tag]).        if
+00002010: 2073 656c 662e 7265 6d6f 7665 5f6c 685f   self.remove_lh_
+00002020: 6c69 6e65 5f6e 756d 6265 7273 3a0a 2020  line_numbers:.  
+00002030: 2020 2020 2020 2020 2020 4874 6d6c 5574            HtmlUt
+00002040: 696c 2e72 656d 6f76 655f 6c68 5f6c 696e  il.remove_lh_lin
+00002050: 655f 6e75 6d62 6572 7328 7365 6c66 2e72  e_numbers(self.r
+00002060: 6177 5f65 6c65 6d29 0a20 2020 2020 2020  aw_elem).       
+00002070: 2069 6620 7365 6c66 2e72 656d 6f76 655f   if self.remove_
+00002080: 6c61 7267 655f 666f 6e74 6564 5f65 6c65  large_fonted_ele
+00002090: 6d65 6e74 733a 0a20 2020 2020 2020 2020  ments:.         
+000020a0: 2020 2048 746d 6c55 7469 6c2e 7265 6d6f     HtmlUtil.remo
+000020b0: 7665 5f6c 6172 6765 5f66 6f6e 7465 645f  ve_large_fonted_
+000020c0: 656c 656d 656e 7473 2873 656c 662e 7261  elements(self.ra
+000020d0: 775f 656c 656d 290a 2020 2020 2020 2020  w_elem).        
+000020e0: 666f 7220 7461 6720 696e 2073 656c 662e  for tag in self.
+000020f0: 656d 7074 795f 656c 656d 656e 7473 5f74  empty_elements_t
+00002100: 6f5f 7265 6d6f 7665 3a0a 2020 2020 2020  o_remove:.      
+00002110: 2020 2020 2020 4874 6d6c 5574 696c 2e72        HtmlUtil.r
+00002120: 656d 6f76 655f 656d 7074 795f 656c 656d  emove_empty_elem
+00002130: 656e 7473 2873 656c 662e 7261 775f 656c  ents(self.raw_el
+00002140: 656d 2c20 5b74 6167 5d29 0a20 2020 2020  em, [tag]).     
+00002150: 2020 2066 6f72 2073 7479 6c65 2069 6e20     for style in 
+00002160: 7365 6c66 2e73 7479 6c65 735f 746f 5f72  self.styles_to_r
+00002170: 656d 6f76 653a 0a20 2020 2020 2020 2020  emove:.         
+00002180: 2020 2048 746d 6c55 7469 6c2e 7265 6d6f     HtmlUtil.remo
+00002190: 7665 5f73 7479 6c65 2873 656c 662e 7261  ve_style(self.ra
+000021a0: 775f 656c 656d 2c20 5b73 7479 6c65 5d29  w_elem, [style])
+000021b0: 0a0a 2020 2020 6465 6620 7365 745f 7265  ..    def set_re
+000021c0: 6d6f 7665 5f66 6c61 6773 2873 656c 6629  move_flags(self)
+000021d0: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+000021e0: 2020 2020 2020 7365 7420 666c 6167 7320        set flags 
+000021f0: 7768 6963 6820 6469 7265 6374 2072 656d  which direct rem
+00002200: 6f76 616c 206f 6620 656c 656d 656e 7473  oval of elements
+00002210: 2f61 7474 7269 6275 7465 730a 2020 2020  /attributes.    
+00002220: 2020 2020 6e6f 726d 616c 6c79 2075 6e64      normally und
+00002230: 6572 2075 7365 7220 636f 6e74 726f 6c0a  er user control.
+00002240: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00002250: 2020 2020 7365 6c66 2e61 6464 5f64 6573      self.add_des
+00002260: 6365 6e64 616e 745f 656c 656d 656e 745f  cendant_element_
+00002270: 746f 5f72 656d 6f76 6528 5b22 6272 225d  to_remove(["br"]
+00002280: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+00002290: 6464 5f73 7479 6c65 735f 746f 5f72 656d  dd_styles_to_rem
+000022a0: 6f76 6528 0a20 2020 2020 2020 2020 2020  ove(.           
+000022b0: 205b 0a20 2020 2020 2020 2020 2020 2020   [.             
+000022c0: 2020 2053 5f50 4f53 4954 494f 4e2c 0a20     S_POSITION,. 
+000022d0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+000022e0: 2022 6c65 6674 222c 0a20 2020 2020 2020   "left",.       
+000022f0: 2020 2020 2020 2020 2053 5f42 4f52 4445           S_BORDE
+00002300: 522c 0a20 2020 2020 2020 2020 2020 2020  R,.             
+00002310: 2020 2053 5f57 5249 5449 4e47 5f4d 4f44     S_WRITING_MOD
+00002320: 452c 0a20 2020 2020 2020 2020 2020 2020  E,.             
+00002330: 2020 2053 5f57 4944 5448 2c20 2023 2074     S_WIDTH,  # t
+00002340: 6869 7320 6469 7361 626c 6573 2066 6c6f  his disables flo
+00002350: 7769 6e67 2074 6578 740a 2020 2020 2020  wing text.      
+00002360: 2020 2020 2020 5d0a 2020 2020 2020 2020        ].        
+00002370: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
+00002380: 6464 5f69 6420 3d20 5472 7565 0a20 2020  dd_id = True.   
+00002390: 2020 2020 2073 656c 662e 6164 645f 656d       self.add_em
+000023a0: 7074 795f 656c 656d 656e 7473 5f74 6f5f  pty_elements_to_
+000023b0: 7265 6d6f 7665 285b 2273 7061 6e22 2c20  remove(["span", 
+000023c0: 2264 6976 225d 290a 2020 2020 2020 2020  "div"]).        
+000023d0: 7365 6c66 2e72 656d 6f76 655f 6c68 5f6c  self.remove_lh_l
+000023e0: 696e 655f 6e75 6d62 6572 7320 3d20 5472  ine_numbers = Tr
+000023f0: 7565 2020 2320 780a 2020 2020 2020 2020  ue  # x.        
+00002400: 7365 6c66 2e72 656d 6f76 655f 6c61 7267  self.remove_larg
+00002410: 655f 666f 6e74 6564 5f65 6c65 6d65 6e74  e_fonted_element
+00002420: 7320 3d20 5472 7565 0a20 2020 2020 2020  s = True.       
+00002430: 2073 656c 662e 7374 796c 655f 6174 7472   self.style_attr
+00002440: 6962 7574 6573 5f74 6f5f 7265 6d6f 7665  ibutes_to_remove
+00002450: 203d 205b 2274 6f70 225d 0a20 2020 2020   = ["top"].     
+00002460: 2020 2073 656c 662e 6d61 726b 6572 5f78     self.marker_x
+00002470: 7061 7468 203d 2022 2e2f 2f64 6976 5b61  path = ".//div[a
+00002480: 5b40 6e61 6d65 5d5d 220a 2020 2020 2020  [@name]]".      
+00002490: 2020 7365 6c66 2e73 7479 6c65 5f61 7474    self.style_att
+000024a0: 7269 6275 7465 735f 746f 5f72 656d 6f76  ributes_to_remov
+000024b0: 6520 3d20 5b22 6c65 6674 222c 2022 6865  e = ["left", "he
+000024c0: 6967 6874 225d 0a0a 2020 2020 6465 6620  ight"]..    def 
+000024d0: 6578 7472 6163 745f 7061 6765 5f62 6f78  extract_page_box
+000024e0: 6573 2873 656c 662c 2072 616e 6765 733d  es(self, ranges=
+000024f0: 4e6f 6e65 293a 0a20 2020 2020 2020 2022  None):.        "
+00002500: 2222 0a20 2020 2020 2020 2042 6173 6564  "".        Based
+00002510: 206f 6e20 7064 6670 6c75 6d62 6572 206f   on pdfplumber o
+00002520: 7574 7075 740a 2020 2020 2020 2020 2222  utput.        ""
+00002530: 220a 2020 2020 2020 2020 7365 6c66 2e70  ".        self.p
+00002540: 6167 655f 626f 7865 7320 3d20 5b5d 2020  age_boxes = []  
+00002550: 2320 7061 6765 426f 7820 6d61 7920 6d65  # pageBox may me
+00002560: 7267 6520 7769 7468 2041 6d69 5061 6765  rge with AmiPage
+00002570: 0a0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
+00002580: 662e 7261 775f 656c 656d 2069 7320 4e6f  f.raw_elem is No
+00002590: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+000025a0: 7265 7475 726e 0a20 2020 2020 2020 2073  return.        s
+000025b0: 7479 6c65 5f73 7061 6e73 203d 2073 656c  tyle_spans = sel
+000025c0: 662e 7261 775f 656c 656d 2e78 7061 7468  f.raw_elem.xpath
+000025d0: 2822 2f2f 7370 616e 5b63 6f6e 7461 696e  ("//span[contain
+000025e0: 7328 4073 7479 6c65 2c27 706f 7369 7469  s(@style,'positi
+000025f0: 6f6e 3a61 6273 6f6c 7574 6527 295d 2229  on:absolute')]")
+00002600: 0a20 2020 2020 2020 2066 6f72 2073 7479  .        for sty
+00002610: 6c65 5f73 7061 6e20 696e 2073 7479 6c65  le_span in style
+00002620: 5f73 7061 6e73 3a0a 2020 2020 2020 2020  _spans:.        
+00002630: 2020 2020 6373 735f 7374 796c 6520 3d20      css_style = 
+00002640: 4353 5353 7479 6c65 2e63 7265 6174 655f  CSSStyle.create_
+00002650: 6373 735f 7374 796c 655f 6672 6f6d 5f61  css_style_from_a
+00002660: 7474 7269 6275 7465 5f6f 665f 626f 6479  ttribute_of_body
+00002670: 5f65 6c65 6d65 6e74 2873 7479 6c65 5f73  _element(style_s
+00002680: 7061 6e29 0a20 2020 2020 2020 2020 2020  pan).           
+00002690: 2069 6620 6373 735f 7374 796c 652e 6865   if css_style.he
+000026a0: 6967 6874 203e 2073 656c 662e 4d49 4e5f  ight > self.MIN_
+000026b0: 5041 4745 5f42 4f58 5f48 4549 4748 543a  PAGE_BOX_HEIGHT:
+000026c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000026d0: 2070 6167 655f 626f 7820 3d20 5061 6765   page_box = Page
+000026e0: 426f 7828 6373 735f 7374 796c 653d 6373  Box(css_style=cs
+000026f0: 735f 7374 796c 6529 0a20 2020 2020 2020  s_style).       
+00002700: 2020 2020 2020 2020 2070 6167 655f 626f           page_bo
+00002710: 782e 6164 645f 7374 796c 655f 7370 616e  x.add_style_span
+00002720: 5f61 6e64 5f70 6167 655f 6e75 6d62 6572  _and_page_number
+00002730: 2873 7479 6c65 5f73 7061 6e29 0a20 2020  (style_span).   
+00002740: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00002750: 662e 7061 6765 5f62 6f78 6573 2e61 7070  f.page_boxes.app
+00002760: 656e 6428 7061 6765 5f62 6f78 290a 0a20  end(page_box).. 
+00002770: 2020 2020 2020 2073 656c 662e 6578 7472         self.extr
+00002780: 6163 745f 7061 6765 5f6e 756d 6265 7273  act_page_numbers
+00002790: 2829 0a0a 2020 2020 6465 6620 6578 7472  ()..    def extr
+000027a0: 6163 745f 7061 6765 5f6e 756d 6265 7273  act_page_numbers
+000027b0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+000027c0: 7061 6765 6e6f 5f78 7061 7468 203d 2022  pageno_xpath = "
+000027d0: 2f2f 7370 616e 2f64 6976 2f61 5b40 6e61  //span/div/a[@na
+000027e0: 6d65 5d22 2020 2320 7061 6765 206e 756d  me]"  # page num
+000027f0: 6265 7220 626f 7865 733b 2074 6865 2070  ber boxes; the p
+00002800: 6172 656e 7420 7370 616e 2069 7320 686f  arent span is ho
+00002810: 7272 6964 0a20 2020 2020 2020 2065 6c65  rrid.        ele
+00002820: 6d5f 7769 7468 5f70 6167 656e 6f73 203d  m_with_pagenos =
+00002830: 2073 656c 662e 7261 775f 656c 656d 2e78   self.raw_elem.x
+00002840: 7061 7468 2870 6167 656e 6f5f 7870 6174  path(pageno_xpat
+00002850: 6829 0a20 2020 2020 2020 2063 7373 5f6c  h).        css_l
+00002860: 6173 7420 3d20 4e6f 6e65 0a20 2020 2020  ast = None.     
+00002870: 2020 2022 2222 3c62 723e 3c2f 7370 616e     """<br></span
+00002880: 3e3c 7370 616e 2073 7479 6c65 3d22 666f  ><span style="fo
+00002890: 6e74 2d66 616d 696c 793a 2043 616c 6962  nt-family: Calib
+000028a0: 7269 3b20 666f 6e74 2d73 697a 653a 3130  ri; font-size:10
+000028b0: 7078 223e 200a 2020 2020 2020 2020 2020  px"> .          
+000028c0: 2020 2020 2020 3c62 723e 3c73 7061 6e20        <br><span 
+000028d0: 7374 796c 653d 2270 6f73 6974 696f 6e3a  style="position:
+000028e0: 6162 736f 6c75 7465 3b20 626f 7264 6572  absolute; border
+000028f0: 3a20 6772 6179 2031 7078 2073 6f6c 6964  : gray 1px solid
+00002900: 3b20 6c65 6674 3a30 7078 3b20 746f 703a  ; left:0px; top:
+00002910: 3934 3170 783b 2077 6964 7468 3a35 3935  941px; width:595
+00002920: 7078 3b20 6865 6967 6874 3a38 3431 7078  px; height:841px
+00002930: 3b22 3e3c 2f73 7061 6e3e 0a20 2020 2020  ;"></span>.     
+00002940: 2020 2020 2020 2020 2020 200a 2020 2020             .    
+00002950: 2020 2020 2020 2020 2020 2020 3c64 6976              <div
+00002960: 2073 7479 6c65 3d22 706f 7369 7469 6f6e   style="position
+00002970: 3a61 6273 6f6c 7574 653b 2074 6f70 3a39  :absolute; top:9
+00002980: 3431 7078 3b22 3e3c 6120 6e61 6d65 3d22  41px;"><a name="
+00002990: 3222 3e50 6167 6520 323c 2f61 3e3c 2f64  2">Page 2</a></d
+000029a0: 6976 3e0a 2020 2020 2020 2020 2020 2020  iv>.            
+000029b0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+000029c0: 666f 7220 656c 656d 5f77 6974 685f 7061  for elem_with_pa
+000029d0: 6765 6e6f 2069 6e20 656c 656d 5f77 6974  geno in elem_wit
+000029e0: 685f 7061 6765 6e6f 733a 0a20 2020 2020  h_pagenos:.     
+000029f0: 2020 2020 2020 2067 6574 7061 7265 6e74         getparent
+00002a00: 203d 2065 6c65 6d5f 7769 7468 5f70 6167   = elem_with_pag
+00002a10: 656e 6f2e 6765 7470 6172 656e 7428 290a  eno.getparent().
+00002a20: 2020 2020 2020 2020 2020 2020 6373 7320              css 
+00002a30: 3d20 4353 5353 7479 6c65 2e63 7265 6174  = CSSStyle.creat
+00002a40: 655f 6373 735f 7374 796c 655f 6672 6f6d  e_css_style_from
+00002a50: 5f61 7474 7269 6275 7465 5f6f 665f 626f  _attribute_of_bo
+00002a60: 6479 5f65 6c65 6d65 6e74 2867 6574 7061  dy_element(getpa
+00002a70: 7265 6e74 290a 2020 2020 2020 2020 2020  rent).          
+00002a80: 2020 7072 6576 5f65 6c65 6d20 3d20 6765    prev_elem = ge
+00002a90: 7470 6172 656e 742e 6765 7470 7265 7669  tparent.getprevi
+00002aa0: 6f75 7328 290a 2020 2020 2020 2020 2020  ous().          
+00002ab0: 2020 6865 6967 6874 203d 202d 3120 6966    height = -1 if
+00002ac0: 2063 7373 5f6c 6173 7420 6973 204e 6f6e   css_last is Non
+00002ad0: 6520 656c 7365 2063 7373 2e74 6f70 202d  e else css.top -
+00002ae0: 2063 7373 5f6c 6173 742e 746f 700a 2020   css_last.top.  
+00002af0: 2020 2020 2020 2020 2020 7072 6576 5f73            prev_s
+00002b00: 7479 6c65 203d 2043 5353 5374 796c 652e  tyle = CSSStyle.
+00002b10: 6372 6561 7465 5f63 7373 5f73 7479 6c65  create_css_style
+00002b20: 5f66 726f 6d5f 6174 7472 6962 7574 655f  _from_attribute_
+00002b30: 6f66 5f62 6f64 795f 656c 656d 656e 7428  of_body_element(
+00002b40: 7072 6576 5f65 6c65 6d29 0a20 2020 2020  prev_elem).     
+00002b50: 2020 2020 2020 2069 6620 6e6f 7420 7072         if not pr
+00002b60: 6576 5f73 7479 6c65 3a0a 2020 2020 2020  ev_style:.      
+00002b70: 2020 2020 2020 2020 2020 6c6f 6767 696e            loggin
+00002b80: 672e 7761 726e 696e 6728 6622 206e 6f20  g.warning(f" no 
+00002b90: 7072 6576 696f 7573 2073 7479 6c65 2229  previous style")
+00002ba0: 0a20 2020 2020 2020 2020 2020 2062 626f  .            bbo
+00002bb0: 7820 3d20 4e6f 6e65 2069 6620 7072 6576  x = None if prev
+00002bc0: 5f73 7479 6c65 2069 7320 4e6f 6e65 2065  _style is None e
+00002bd0: 6c73 6520 7072 6576 5f73 7479 6c65 2e63  lse prev_style.c
+00002be0: 7265 6174 655f 6262 6f78 2829 0a20 2020  reate_bbox().   
+00002bf0: 2020 2020 2020 2020 2063 7373 5f6c 6173           css_las
+00002c00: 7420 3d20 6373 730a 2020 2020 2020 2020  t = css.        
+00002c10: 7265 7475 726e 2065 6c65 6d5f 7769 7468  return elem_with
+00002c20: 5f70 6167 656e 6f73 0a0a 2020 2020 6465  _pagenos..    de
+00002c30: 6620 7072 696e 745f 7061 6765 735f 6469  f print_pages_di
+00002c40: 7628 7365 6c66 2c20 7261 6e67 6573 3d4e  v(self, ranges=N
+00002c50: 6f6e 6529 3a0a 2020 2020 2020 2020 2222  one):.        ""
+00002c60: 220a 2020 2020 2020 2020 6d61 7962 6520  ".        maybe 
+00002c70: 6a75 7374 2061 2064 6562 7567 6765 720a  just a debugger.
+00002c80: 2020 2020 2020 2020 2222 220a 0a20 2020          """..   
+00002c90: 2020 2020 2069 6620 7261 6e67 6573 3a0a       if ranges:.
+00002ca0: 2020 2020 2020 2020 2020 2020 4874 6d6c              Html
+00002cb0: 5469 6479 2e64 6562 7567 5f62 795f 7870  Tidy.debug_by_xp
+00002cc0: 6174 6828 7365 6c66 2e72 6177 5f65 6c65  ath(self.raw_ele
+00002cd0: 6d2c 2022 2f68 746d 6c2f 626f 6479 2f73  m, "/html/body/s
+00002ce0: 7061 6e22 2c20 7469 746c 653d 2264 6972  pan", title="dir
+00002cf0: 6563 7420 7370 616e 7320 756e 6465 7220  ect spans under 
+00002d00: 626f 6479 2022 2c0a 2020 2020 2020 2020  body ",.        
+00002d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002d20: 2020 2020 2020 2020 2020 2020 7261 6e67              rang
+00002d30: 653d 7261 6e67 6573 5b30 5d29 2c0a 2020  e=ranges[0]),.  
+00002d40: 2020 2020 2020 2020 2020 4874 6d6c 5469            HtmlTi
+00002d50: 6479 2e64 6562 7567 5f62 795f 7870 6174  dy.debug_by_xpat
+00002d60: 6828 7365 6c66 2e72 6177 5f65 6c65 6d2c  h(self.raw_elem,
+00002d70: 2022 2f68 746d 6c2f 626f 6479 2f73 7061   "/html/body/spa
+00002d80: 6e5b 6469 765d 222c 2074 6974 6c65 3d22  n[div]", title="
+00002d90: 746f 702d 6c65 7665 6c20 7370 616e 7320  top-level spans 
+00002da0: 7769 7468 2064 6976 733f 222c 0a20 2020  with divs?",.   
+00002db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002dd0: 2072 616e 6765 3d72 616e 6765 735b 315d   range=ranges[1]
+00002de0: 290a 2020 2020 2020 2020 2020 2020 4874  ).            Ht
+00002df0: 6d6c 5469 6479 2e64 6562 7567 5f62 795f  mlTidy.debug_by_
+00002e00: 7870 6174 6828 7365 6c66 2e72 6177 5f65  xpath(self.raw_e
+00002e10: 6c65 6d2c 2022 2f68 746d 6c2f 626f 6479  lem, "/html/body
+00002e20: 2f73 7061 6e2f 6469 7622 2c20 7469 746c  /span/div", titl
+00002e30: 653d 2274 6865 2064 6976 7320 696e 2073  e="the divs in s
+00002e40: 746f 702d 6c65 7665 6c20 7370 616e 7322  top-level spans"
+00002e50: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00002e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002e70: 2020 2020 2020 7261 6e67 653d 7261 6e67        range=rang
+00002e80: 6573 5b32 5d29 0a20 2020 2020 2020 2020  es[2]).         
+00002e90: 2020 2022 2222 0a20 2020 2020 2020 2020     """.         
+00002ea0: 2020 2020 2020 203c 6469 7620 7374 796c         <div styl
+00002eb0: 653d 2270 6f73 6974 696f 6e3a 6162 736f  e="position:abso
+00002ec0: 6c75 7465 3b20 746f 703a 3435 3039 7078  lute; top:4509px
+00002ed0: 3b22 3e3c 6120 6e61 6d65 3d22 3622 3e50  ;"><a name="6">P
+00002ee0: 6167 6520 363c 2f61 3e3c 2f64 6976 3e0a  age 6</a></div>.
+00002ef0: 2020 2020 2020 2020 2020 2020 2222 220a              """.
+00002f00: 2020 2020 2020 2020 2020 2020 4874 6d6c              Html
+00002f10: 5469 6479 2e64 6562 7567 5f62 795f 7870  Tidy.debug_by_xp
+00002f20: 6174 6828 7365 6c66 2e72 6177 5f65 6c65  ath(self.raw_ele
+00002f30: 6d2c 2022 2f68 746d 6c2f 626f 6479 2f64  m, "/html/body/d
+00002f40: 6976 5b40 7374 796c 6520 616e 6420 615d  iv[@style and a]
+00002f50: 222c 2074 6974 6c65 3d22 7061 6765 206e  ", title="page n
+00002f60: 756d 6265 7220 626f 7865 7320 756e 6465  umber boxes unde
+00002f70: 7220 626f 6479 222c 0a20 2020 2020 2020  r body",.       
+00002f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002f90: 2020 2020 2020 2020 2020 2020 2072 616e               ran
+00002fa0: 6765 3d72 616e 6765 735b 335d 290a 2020  ge=ranges[3]).  
+00002fb0: 2020 2020 2020 2020 2020 4874 6d6c 5469            HtmlTi
+00002fc0: 6479 2e64 6562 7567 5f62 795f 7870 6174  dy.debug_by_xpat
+00002fd0: 6828 7365 6c66 2e72 6177 5f65 6c65 6d2c  h(self.raw_elem,
+00002fe0: 2022 2f68 746d 6c2f 626f 6479 2f2f 6469   "/html/body//di
+00002ff0: 765b 4073 7479 6c65 2061 6e64 2061 5b63  v[@style and a[c
+00003000: 6f6e 7461 696e 7328 2e2c 2027 5061 6765  ontains(., 'Page
+00003010: 2729 5d5d 222c 0a20 2020 2020 2020 2020  ')]]",.         
+00003020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003030: 2020 2020 2020 2020 2020 2074 6974 6c65             title
+00003040: 3d22 7061 6765 206e 756d 6265 7220 626f  ="page number bo
+00003050: 7865 7320 756e 6465 7220 626f 6479 2f73  xes under body/s
+00003060: 7061 6e22 2c20 7261 6e67 653d 7261 6e67  pan", range=rang
+00003070: 6573 5b34 5d29 0a0a 2020 2020 4063 6c61  es[4])..    @cla
+00003080: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
+00003090: 2064 6562 7567 5f62 795f 7870 6174 6828   debug_by_xpath(
+000030a0: 636c 732c 2065 6c65 6d2c 2078 7061 7468  cls, elem, xpath
+000030b0: 2c20 7469 746c 653d 4e6f 6e65 2c20 7261  , title=None, ra
+000030c0: 6e67 653d 4e6f 6e65 2920 2d3e 2069 6e74  nge=None) -> int
+000030d0: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+000030e0: 2020 2020 2020 6170 706c 6965 7320 7870        applies xp
+000030f0: 6174 6820 616e 6420 7072 696e 7473 2064  ath and prints d
+00003100: 6562 7567 390a 2020 2020 2020 2020 6173  ebug9.        as
+00003110: 7365 7274 0a20 2020 2020 2020 203a 7061  sert.        :pa
+00003120: 7261 6d20 656c 656d 3a20 746f 2064 6562  ram elem: to deb
+00003130: 7567 0a20 2020 2020 2020 203a 7061 7261  ug.        :para
+00003140: 6d20 7870 6174 683a 2074 6f20 6465 6275  m xpath: to debu
+00003150: 6720 7769 7468 0a20 2020 2020 2020 203a  g with.        :
+00003160: 7265 7475 726e 3a20 7870 6174 6820 636f  return: xpath co
+00003170: 756e 740a 2020 2020 2020 2020 2222 220a  unt.        """.
+00003180: 2020 2020 2020 2020 7370 616e 7320 3d20          spans = 
+00003190: 656c 656d 2e78 7061 7468 2878 7061 7468  elem.xpath(xpath
+000031a0: 290a 2020 2020 2020 2020 6966 2072 616e  ).        if ran
+000031b0: 6765 3a0a 2020 2020 2020 2020 2020 2020  ge:.            
+000031c0: 6173 7365 7274 2072 616e 6765 5b30 5d20  assert range[0] 
+000031d0: 3c3d 206c 656e 2873 7061 6e73 2920 3c3d  <= len(spans) <=
+000031e0: 2072 616e 6765 5b31 5d2c 2066 227b 2727   range[1], f"{''
+000031f0: 2069 6620 6e6f 7420 7469 746c 6520 656c   if not title el
+00003200: 7365 2074 6974 6c65 7d3a 2066 6f75 6e64  se title}: found
+00003210: 3a20 7b6c 656e 2873 7061 6e73 297d 220a  : {len(spans)}".
+00003220: 2020 2020 2020 2020 7265 7475 726e 206c          return l
+00003230: 656e 2873 7061 6e73 290a 0a20 2020 2064  en(spans)..    d
+00003240: 6566 2061 6464 5f65 6c65 6d65 6e74 2873  ef add_element(s
+00003250: 656c 662c 2065 6c65 6d29 3a0a 2020 2020  elf, elem):.    
+00003260: 2020 2020 7365 6c66 2e65 6c65 6d65 6e74      self.element
+00003270: 203d 2065 6c65 6d0a 0a20 2020 2064 6566   = elem..    def
+00003280: 2061 6464 5f64 6573 6365 6e64 616e 745f   add_descendant_
+00003290: 656c 656d 656e 745f 746f 5f72 656d 6f76  element_to_remov
+000032a0: 6528 7365 6c66 2c20 6465 7363 656e 6461  e(self, descenda
+000032b0: 6e74 5f65 6c65 6d29 3a0a 2020 2020 2020  nt_elem):.      
+000032c0: 2020 4874 6d6c 5469 6479 2e61 6464 5f65    HtmlTidy.add_e
+000032d0: 6c65 6d65 6e74 735f 746f 5f73 746f 7265  lements_to_store
+000032e0: 2864 6573 6365 6e64 616e 745f 656c 656d  (descendant_elem
+000032f0: 2c20 7365 6c66 2e64 6573 6365 6e64 616e  , self.descendan
+00003300: 7473 5f74 6f5f 7265 6d6f 7665 290a 0a20  ts_to_remove).. 
+00003310: 2020 2064 6566 2061 6464 5f73 7479 6c65     def add_style
+00003320: 735f 746f 5f72 656d 6f76 6528 7365 6c66  s_to_remove(self
+00003330: 2c20 7374 796c 6529 3a0a 2020 2020 2020  , style):.      
+00003340: 2020 7365 6c66 2e73 7479 6c65 735f 746f    self.styles_to
+00003350: 5f72 656d 6f76 652e 6170 7065 6e64 2873  _remove.append(s
+00003360: 7479 6c65 290a 0a20 2020 2064 6566 2061  tyle)..    def a
+00003370: 6464 5f65 6d70 7479 5f65 6c65 6d65 6e74  dd_empty_element
+00003380: 735f 746f 5f72 656d 6f76 6528 7365 6c66  s_to_remove(self
+00003390: 2c20 656c 656d 735f 746f 5f72 656d 6f76  , elems_to_remov
+000033a0: 6529 3a0a 2020 2020 2020 2020 4874 6d6c  e):.        Html
+000033b0: 5469 6479 2e61 6464 5f65 6c65 6d65 6e74  Tidy.add_element
+000033c0: 735f 746f 5f73 746f 7265 2865 6c65 6d73  s_to_store(elems
+000033d0: 5f74 6f5f 7265 6d6f 7665 2c20 7365 6c66  _to_remove, self
+000033e0: 2e65 6d70 7479 5f65 6c65 6d65 6e74 735f  .empty_elements_
+000033f0: 746f 5f72 656d 6f76 6529 0a0a 2020 2020  to_remove)..    
+00003400: 4063 6c61 7373 6d65 7468 6f64 0a20 2020  @classmethod.   
+00003410: 2064 6566 2061 6464 5f65 6c65 6d65 6e74   def add_element
+00003420: 735f 746f 5f73 746f 7265 2863 6c73 2c20  s_to_store(cls, 
+00003430: 656c 656d 735f 746f 5f73 746f 7265 2c20  elems_to_store, 
+00003440: 656c 656d 5f73 746f 7261 6765 293a 0a20  elem_storage):. 
+00003450: 2020 2020 2020 2069 6620 656c 656d 735f         if elems_
+00003460: 746f 5f73 746f 7265 2069 7320 6e6f 7420  to_store is not 
+00003470: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00003480: 2020 6966 206e 6f74 2074 7970 6528 656c    if not type(el
+00003490: 656d 735f 746f 5f73 746f 7265 2920 6973  ems_to_store) is
+000034a0: 206c 6973 743a 0a20 2020 2020 2020 2020   list:.         
+000034b0: 2020 2020 2020 2065 6c65 6d73 5f74 6f5f         elems_to_
+000034c0: 7374 6f72 6520 3d20 6c69 7374 2865 6c65  store = list(ele
+000034d0: 6d73 5f74 6f5f 7374 6f72 6529 0a20 2020  ms_to_store).   
+000034e0: 2020 2020 2020 2020 2065 6c65 6d5f 7374           elem_st
+000034f0: 6f72 6167 652e 6578 7465 6e64 2865 6c65  orage.extend(ele
+00003500: 6d73 5f74 6f5f 7374 6f72 6529 0a0a 2020  ms_to_store)..  
+00003510: 2020 4063 6c61 7373 6d65 7468 6f64 0a20    @classmethod. 
+00003520: 2020 2064 6566 2065 6e73 7572 655f 6874     def ensure_ht
+00003530: 6d6c 5f68 6561 645f 626f 6479 2863 6c73  ml_head_body(cls
+00003540: 2c20 6874 6d6c 5f65 6c65 6d29 3a0a 2020  , html_elem):.  
+00003550: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00003560: 2020 6164 6473 203c 6874 6d6c 3e2c 203c    adds <html>, <
+00003570: 6865 6164 3e2c 203c 626f 6479 3e20 6966  head>, <body> if
+00003580: 206e 6f74 2070 7265 7365 6e74 0a20 2020   not present.   
+00003590: 2020 2020 204d 6f76 6520 746f 2048 544d       Move to HTM
+000035a0: 4c54 6964 790a 2020 2020 2020 2020 2222  LTidy.        ""
+000035b0: 220a 2020 2020 2020 2020 6874 6d6c 5f65  ".        html_e
+000035c0: 6c65 6d20 3d20 636c 732e 5f65 6e73 7572  lem = cls._ensur
+000035d0: 655f 6874 6d6c 5f72 6f6f 7428 6874 6d6c  e_html_root(html
+000035e0: 5f65 6c65 6d29 0a20 2020 2020 2020 2068  _elem).        h
+000035f0: 746d 6c5f 7769 7468 5f68 6561 6420 3d20  tml_with_head = 
+00003600: 636c 732e 5f65 6e73 7572 655f 6865 6164  cls._ensure_head
+00003610: 626f 6479 2868 746d 6c5f 656c 656d 2c20  body(html_elem, 
+00003620: 2268 6561 6422 2c20 3029 0a20 2020 2020  "head", 0).     
+00003630: 2020 2068 746d 6c5f 7769 7468 5f68 6561     html_with_hea
+00003640: 645f 626f 6479 203d 2063 6c73 2e5f 656e  d_body = cls._en
+00003650: 7375 7265 5f68 6561 6462 6f64 7928 6874  sure_headbody(ht
+00003660: 6d6c 5f77 6974 685f 6865 6164 2c20 2262  ml_with_head, "b
+00003670: 6f64 7922 2c20 3129 0a20 2020 2020 2020  ody", 1).       
+00003680: 2068 746d 6c5f 6964 6561 6c20 3d20 636c   html_ideal = cl
+00003690: 732e 5f74 6964 795f 6e6f 6e5f 6865 6164  s._tidy_non_head
+000036a0: 5f62 6f64 795f 6368 696c 6472 656e 2868  _body_children(h
+000036b0: 746d 6c5f 7769 7468 5f68 6561 645f 626f  tml_with_head_bo
+000036c0: 6479 290a 2020 2020 2020 2020 7265 7475  dy).        retu
+000036d0: 726e 2068 746d 6c5f 6964 6561 6c0a 0a20  rn html_ideal.. 
+000036e0: 2020 2040 636c 6173 736d 6574 686f 640a     @classmethod.
+000036f0: 2020 2020 6465 6620 5f65 6e73 7572 655f      def _ensure_
+00003700: 6865 6164 626f 6479 2863 6c73 2c20 6874  headbody(cls, ht
+00003710: 6d6c 5f72 6f6f 742c 2074 6167 2c20 706f  ml_root, tag, po
+00003720: 7329 3a0a 2020 2020 2020 2020 6465 7363  s):.        desc
+00003730: 656e 6473 203d 206c 656e 2868 746d 6c5f  ends = len(html_
+00003740: 726f 6f74 2e78 7061 7468 2866 222e 2f2f  root.xpath(f".//
+00003750: 7b74 6167 7d22 2929 0a20 2020 2020 2020  {tag}")).       
+00003760: 2069 6620 6465 7363 656e 6473 203e 2031   if descends > 1
+00003770: 3a0a 2020 2020 2020 2020 2020 2020 6c6f  :.            lo
+00003780: 6767 696e 672e 7761 726e 696e 6728 6622  gging.warning(f"
+00003790: 6d6f 7265 2074 6861 6e20 3120 7b74 6167  more than 1 {tag
+000037a0: 7d3b 2063 616e 6e6f 7420 7072 6f63 6573  }; cannot proces
+000037b0: 7322 290a 2020 2020 2020 2020 656c 6966  s").        elif
+000037c0: 2064 6573 6365 6e64 7320 3d3d 2031 3a0a   descends == 1:.
+000037d0: 2020 2020 2020 2020 2020 2020 2320 6f6e              # on
+000037e0: 6520 7461 672c 206f 6b0a 2020 2020 2020  e tag, ok.      
+000037f0: 2020 2020 2020 7061 7373 0a20 2020 2020        pass.     
+00003800: 2020 2065 6c69 6620 6465 7363 656e 6473     elif descends
+00003810: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
+00003820: 2020 2068 6561 6420 3d20 4554 2e45 6c65     head = ET.Ele
+00003830: 6d65 6e74 2874 6167 290a 2020 2020 2020  ment(tag).      
+00003840: 2020 2020 2020 6874 6d6c 5f72 6f6f 742e        html_root.
+00003850: 696e 7365 7274 2870 6f73 2c20 6865 6164  insert(pos, head
+00003860: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+00003870: 2068 746d 6c5f 726f 6f74 0a0a 2020 2020   html_root..    
+00003880: 4063 6c61 7373 6d65 7468 6f64 0a20 2020  @classmethod.   
+00003890: 2064 6566 205f 656e 7375 7265 5f68 746d   def _ensure_htm
+000038a0: 6c5f 726f 6f74 2863 6c73 2c20 6874 6d6c  l_root(cls, html
+000038b0: 5f65 6c65 6d29 3a0a 2020 2020 2020 2020  _elem):.        
+000038c0: 2222 220a 2020 2020 2020 2020 6966 2072  """.        if r
+000038d0: 6f6f 7420 656c 656d 656e 7420 6973 206e  oot element is n
+000038e0: 6f74 203c 6874 6d6c 3e20 6372 6561 7465  ot <html> create
+000038f0: 7320 6f6e 6520 616e 6420 7472 616e 7366  s one and transf
+00003900: 6572 7320 6368 696c 6472 656e 0a20 2020  ers children.   
+00003910: 2020 2020 203a 7061 7261 6d20 6874 6d6c       :param html
+00003920: 5f65 6c65 6d3a 206f 6c64 2045 6c65 6d65  _elem: old Eleme
+00003930: 6e74 5472 6565 206f 7220 726f 6f74 2045  ntTree or root E
+00003940: 6c65 6d65 6e74 0a20 2020 2020 2020 2022  lement.        "
+00003950: 2222 0a20 2020 2020 2020 206f 6c64 5f72  "".        old_r
+00003960: 6f6f 7420 3d20 6874 6d6c 5f65 6c65 6d2e  oot = html_elem.
+00003970: 6765 7472 6f6f 7428 2920 6966 2074 7970  getroot() if typ
+00003980: 6528 6874 6d6c 5f65 6c65 6d29 2069 7320  e(html_elem) is 
+00003990: 5f45 6c65 6d65 6e74 5472 6565 2065 6c73  _ElementTree els
+000039a0: 6520 6874 6d6c 5f65 6c65 6d0a 2020 2020  e html_elem.    
+000039b0: 2020 2020 6874 6d6c 7320 3d20 6874 6d6c      htmls = html
+000039c0: 5f65 6c65 6d2e 7870 6174 6828 222f 6874  _elem.xpath("/ht
+000039d0: 6d6c 2229 0a20 2020 2020 2020 2069 6620  ml").        if 
+000039e0: 6c65 6e28 6874 6d6c 7329 203d 3d20 303a  len(htmls) == 0:
+000039f0: 0a20 2020 2020 2020 2020 2020 2068 746d  .            htm
+00003a00: 6c5f 726f 6f74 203d 2045 542e 456c 656d  l_root = ET.Elem
+00003a10: 656e 7428 2268 746d 6c22 290a 2020 2020  ent("html").    
+00003a20: 2020 2020 2020 2020 6874 6d6c 5f72 6f6f          html_roo
+00003a30: 742e 696e 7365 7274 2830 2c20 6f6c 645f  t.insert(0, old_
+00003a40: 726f 6f74 290a 2020 2020 2020 2020 2020  root).          
+00003a50: 2020 7265 7475 726e 2068 746d 6c5f 726f    return html_ro
+00003a60: 6f74 0a20 2020 2020 2020 2072 6574 7572  ot.        retur
+00003a70: 6e20 6874 6d6c 5f65 6c65 6d0a 0a20 2020  n html_elem..   
+00003a80: 2040 636c 6173 736d 6574 686f 640a 2020   @classmethod.  
+00003a90: 2020 6465 6620 5f74 6964 795f 6e6f 6e5f    def _tidy_non_
+00003aa0: 6865 6164 5f62 6f64 795f 6368 696c 6472  head_body_childr
+00003ab0: 656e 2863 6c73 2c20 6874 6d6c 5f77 6974  en(cls, html_wit
+00003ac0: 685f 6865 6164 5f62 6f64 7929 3a0a 0a20  h_head_body):.. 
+00003ad0: 2020 2020 2020 2068 6561 645f 656c 656d         head_elem
+00003ae0: 7320 3d20 6874 6d6c 5f77 6974 685f 6865  s = html_with_he
+00003af0: 6164 5f62 6f64 792e 7870 6174 6828 4874  ad_body.xpath(Ht
+00003b00: 6d6c 5469 6479 2e48 4541 445f 454c 454d  mlTidy.HEAD_ELEM
+00003b10: 535f 494e 5f58 5041 5448 290a 2020 2020  S_IN_XPATH).    
+00003b20: 2020 2020 6865 6164 203d 2068 746d 6c5f      head = html_
+00003b30: 7769 7468 5f68 6561 645f 626f 6479 2e78  with_head_body.x
+00003b40: 7061 7468 2822 6865 6164 2229 5b30 5d0a  path("head")[0].
+00003b50: 2020 2020 2020 2020 666f 7220 656c 656d          for elem
+00003b60: 2069 6e20 6865 6164 5f65 6c65 6d73 3a0a   in head_elems:.
+00003b70: 2020 2020 2020 2020 2020 2020 6865 6164              head
+00003b80: 2e61 7070 656e 6428 656c 656d 290a 2020  .append(elem).  
+00003b90: 2020 2020 2020 7265 7374 5f65 6c65 6d73        rest_elems
+00003ba0: 203d 2068 746d 6c5f 7769 7468 5f68 6561   = html_with_hea
+00003bb0: 645f 626f 6479 2e78 7061 7468 2822 2a5b  d_body.xpath("*[
+00003bc0: 6e6f 7428 6e61 6d65 2829 3d27 6865 6164  not(name()='head
+00003bd0: 2729 2061 6e64 206e 6f74 286e 616d 6528  ') and not(name(
+00003be0: 293d 2762 6f64 7927 295d 2229 0a20 2020  )='body')]").   
+00003bf0: 2020 2020 2062 6f64 7920 3d20 6874 6d6c       body = html
+00003c00: 5f77 6974 685f 6865 6164 5f62 6f64 792e  _with_head_body.
+00003c10: 7870 6174 6828 2262 6f64 7922 295b 305d  xpath("body")[0]
+00003c20: 0a20 2020 2020 2020 2066 6f72 2065 6c65  .        for ele
+00003c30: 6d20 696e 2072 6573 745f 656c 656d 733a  m in rest_elems:
+00003c40: 0a20 2020 2020 2020 2020 2020 2062 6f64  .            bod
+00003c50: 792e 6170 7065 6e64 2865 6c65 6d29 0a20  y.append(elem). 
+00003c60: 2020 2020 2020 2072 6574 7572 6e20 6874         return ht
+00003c70: 6d6c 5f77 6974 685f 6865 6164 5f62 6f64  ml_with_head_bod
+00003c80: 790a 0a20 2020 2040 636c 6173 736d 6574  y..    @classmet
+00003c90: 686f 640a 2020 2020 6465 6620 636f 6e63  hod.    def conc
+00003ca0: 6174 656e 6174 655f 7370 616e 735f 7769  atenate_spans_wi
+00003cb0: 7468 5f69 6465 6e74 6963 616c 5f73 7479  th_identical_sty
+00003cc0: 6c65 7328 636c 732c 2065 6c65 6d2c 2061  les(cls, elem, a
+00003cd0: 6464 7370 6163 653d 5472 7565 293a 0a0a  ddspace=True):..
+00003ce0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00003cf0: 2020 2020 536f 6d65 7469 6d65 7320 756e      Sometimes un
+00003d00: 6e65 6365 7373 6172 7920 7370 616e 7320  necessary spans 
+00003d10: 6172 6520 6372 6561 7465 6420 2865 2e67  are created (e.g
+00003d20: 2e0a 2020 2020 2020 2020 3c73 7061 6e20  ..        <span 
+00003d30: 636c 6173 733d 2773 3127 3e66 6f6f 3c2f  class='s1'>foo</
+00003d40: 7370 616e 3e3c 7370 616e 6520 636c 6173  span><spane clas
+00003d50: 733d 2273 3122 3e62 6172 3c2f 7370 616e  s="s1">bar</span
+00003d60: 3e0a 2020 2020 2020 2020 6372 6561 7465  >.        create
+00003d70: 7320 3c73 7061 6e20 636c 6173 733d 2273  s <span class="s
+00003d80: 3122 3e66 6f6f 2062 6172 3c2f 7370 616e  1">foo bar</span
+00003d90: 3e0a 2020 2020 2020 2020 3a70 6172 616d  >.        :param
+00003da0: 2065 6c65 6d3a 2070 726f 6261 626c 7920   elem: probably 
+00003db0: 6120 6469 7620 7769 7468 2063 6869 6c64  a div with child
+00003dc0: 2073 7061 6e73 0a20 2020 2020 2020 203a   spans.        :
+00003dd0: 7061 7261 6d20 6164 6473 7061 6365 3a20  param addspace: 
+00003de0: 696e 7365 7274 2073 7061 6365 0a20 2020  insert space.   
+00003df0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00003e00: 2073 7061 6e73 203d 2065 6c65 6d2e 7870   spans = elem.xp
+00003e10: 6174 6828 222e 2f73 7061 6e5b 4063 6c61  ath("./span[@cla
+00003e20: 7373 5d22 290a 2020 2020 2020 2020 6c61  ss]").        la
+00003e30: 7374 5f73 7061 6e20 3d20 4e6f 6e65 0a20  st_span = None. 
+00003e40: 2020 2020 2020 2073 7061 6365 7320 3d20         spaces = 
+00003e50: 2222 2069 6620 6e6f 7420 6164 6473 7061  "" if not addspa
+00003e60: 6365 2065 6c73 6520 2220 220a 2020 2020  ce else " ".    
+00003e70: 2020 2020 666f 7220 7370 616e 2069 6e20      for span in 
+00003e80: 7370 616e 733a 0a20 2020 2020 2020 2020  spans:.         
+00003e90: 2020 2069 6620 6c61 7374 5f73 7061 6e20     if last_span 
+00003ea0: 6973 206e 6f74 204e 6f6e 6520 616e 6420  is not None and 
+00003eb0: 6c61 7374 5f73 7061 6e2e 6174 7472 6962  last_span.attrib
+00003ec0: 5b22 636c 6173 7322 5d20 3d3d 2073 7061  ["class"] == spa
+00003ed0: 6e2e 6174 7472 6962 5b22 636c 6173 7322  n.attrib["class"
+00003ee0: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
+00003ef0: 2020 206c 6173 745f 7370 616e 2e74 6578     last_span.tex
+00003f00: 7420 3d20 6c61 7374 5f73 7061 6e2e 7465  t = last_span.te
+00003f10: 7874 202b 2073 7061 6365 7320 2b20 7370  xt + spaces + sp
+00003f20: 616e 2e74 6578 740a 2020 2020 2020 2020  an.text.        
+00003f30: 2020 2020 2020 2020 656c 656d 2e72 656d          elem.rem
+00003f40: 6f76 6528 7370 616e 290a 2020 2020 2020  ove(span).      
+00003f50: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00003f60: 2020 2020 2020 2020 2020 2020 6c61 7374              last
+00003f70: 5f73 7061 6e20 3d20 7370 616e 0a0a 0a64  _span = span...d
+00003f80: 6566 2067 6574 5f74 6172 6765 745f 6872  ef get_target_hr
+00003f90: 6566 2874 6172 6765 745f 6964 293a 0a20  ef(target_id):. 
+00003fa0: 2020 2072 655f 7461 7267 6574 203d 2072     re_target = r
+00003fb0: 652e 636f 6d70 696c 6528 0a20 2020 2020  e.compile(.     
+00003fc0: 2020 2022 5c5c 732a 283f 503c 7265 706f     "\\s*(?P<repo
+00003fd0: 7274 3e57 4749 7c57 4749 497c 5747 4949  rt>WGI|WGII|WGII
+00003fe0: 497c 5352 4343 4c7c 5352 4f43 437c 5352  I|SRCCL|SROCC|SR
+00003ff0: 3135 7c53 5952 295c 5c73 2b28 3f50 3c63  15|SYR)\\s+(?P<c
+00004000: 6861 7074 6572 3e53 504d 7c54 5329 5c5c  hapter>SPM|TS)\\
+00004010: 732b 283f 503c 7365 6374 696f 6e3e 5b41  s+(?P<section>[A
+00004020: 2d47 5d5c 5c2e 3f5c 5c64 2b28 3f3a 5c5c  -G]\\.?\\d+(?:\\
+00004030: 2e5c 5c64 2b29 2a29 2229 0a20 2020 2067  .\\d+)*)").    g
+00004040: 6974 6875 625f 6261 7365 203d 2022 6874  ithub_base = "ht
+00004050: 7470 733a 2f2f 6874 6d6c 7072 6576 6965  tps://htmlprevie
+00004060: 772e 6769 7468 7562 2e69 6f2f 3f68 7474  w.github.io/?htt
+00004070: 7073 3a2f 2f67 6974 6875 622e 636f 6d22  ps://github.com"
+00004080: 0a20 2020 2077 6f72 6b69 6e67 5f75 726c  .    working_url
+00004090: 203d 2022 6874 7470 733a 2f2f 6874 6d6c   = "https://html
+000040a0: 7072 6576 6965 772e 6769 7468 7562 2e69  preview.github.i
+000040b0: 6f2f 3f68 7474 7073 3a2f 2f67 6974 6875  o/?https://githu
+000040c0: 622e 636f 6d2f 7065 7465 726d 722f 7365  b.com/petermr/se
+000040d0: 6d61 6e74 6963 436c 696d 6174 652f 626c  manticClimate/bl
+000040e0: 6f62 2f6d 6169 6e2f 7465 7374 2e68 746d  ob/main/test.htm
+000040f0: 6c22 0a20 2020 2072 6570 6f72 745f 6469  l".    report_di
+00004100: 6374 203d 207b 0a20 2020 2020 2020 2022  ct = {.        "
+00004110: 7767 6922 3a20 2277 6731 222c 0a20 2020  wgi": "wg1",.   
+00004120: 2020 2020 2022 7767 6969 223a 2022 7767       "wgii": "wg
+00004130: 3222 2c0a 2020 2020 2020 2020 2277 6769  2",.        "wgi
+00004140: 6969 223a 2022 7767 3322 2c0a 2020 2020  ii": "wg3",.    
+00004150: 7d0a 2020 2020 6872 6566 203d 2022 220a  }.    href = "".
+00004160: 2020 2020 6d61 7463 6820 3d20 7265 5f74      match = re_t
+00004170: 6172 6765 742e 6d61 7463 6828 7461 7267  arget.match(targ
+00004180: 6574 5f69 6429 0a20 2020 2069 6620 6d61  et_id).    if ma
+00004190: 7463 683a 0a20 2020 2020 2020 2072 6570  tch:.        rep
+000041a0: 6f72 7420 3d20 6d61 7463 682e 6772 6f75  ort = match.grou
+000041b0: 7028 2272 6570 6f72 7422 292e 6c6f 7765  p("report").lowe
+000041c0: 7228 290a 2020 2020 2020 2020 7265 706f  r().        repo
+000041d0: 7274 3120 3d20 7265 706f 7274 5f64 6963  rt1 = report_dic
+000041e0: 742e 6765 7428 7265 706f 7274 290a 2020  t.get(report).  
+000041f0: 2020 2020 2020 7265 706f 7274 203d 2072        report = r
+00004200: 6570 6f72 7431 2069 6620 7265 706f 7274  eport1 if report
+00004210: 3120 656c 7365 2072 6570 6f72 740a 2020  1 else report.  
+00004220: 2020 2020 2020 6368 6170 7465 7220 3d20        chapter = 
+00004230: 6d61 7463 682e 6772 6f75 7028 2263 6861  match.group("cha
+00004240: 7074 6572 2229 2e6c 6f77 6572 2829 0a20  pter").lower(). 
+00004250: 2020 2020 2020 2073 6563 7469 6f6e 203d         section =
+00004260: 206d 6174 6368 2e67 726f 7570 2822 7365   match.group("se
+00004270: 6374 696f 6e22 292e 6c6f 7765 7228 290a  ction").lower().
+00004280: 2020 2020 2020 2020 6872 6566 203d 2066          href = f
+00004290: 227b 6769 7468 7562 5f62 6173 657d 2f70  "{github_base}/p
+000042a0: 6574 6572 6d72 2f73 656d 616e 7469 6343  etermr/semanticC
+000042b0: 6c69 6d61 7465 2f62 6c6f 622f 6d61 696e  limate/blob/main
+000042c0: 2f61 7236 2f61 7236 2f7b 7265 706f 7274  /ar6/ar6/{report
+000042d0: 7d2f 7b63 6861 7074 6572 7d2f 6874 6d6c  }/{chapter}/html
+000042e0: 2f66 756c 6c74 6578 742f 6772 6f75 7073  /fulltext/groups
+000042f0: 5f67 726f 7570 732e 6874 6d6c 237b 7365  _groups.html#{se
+00004300: 6374 696f 6e7d 220a 0a20 2020 2072 6574  ction}"..    ret
+00004310: 7572 6e20 6872 6566 0a0a 0a63 6c61 7373  urn href...class
+00004320: 2048 746d 6c47 726f 7570 3a0a 2020 2020   HtmlGroup:.    
+00004330: 2222 2267 726f 7570 7320 7369 626c 696e  """groups siblin
+00004340: 6773 2069 6e74 6f20 6469 7673 2222 220a  gs into divs""".
+00004350: 0a20 2020 2044 4546 4155 4c54 5f53 5459  .    DEFAULT_STY
+00004360: 4c45 5320 3d20 5b0a 2020 2020 2020 2020  LES = [.        
+00004370: 2822 2e73 6563 7469 6f6e 5f74 6974 6c65  (".section_title
+00004380: 222c 205b 2822 636f 6c6f 7222 2c20 2272  ", [("color", "r
+00004390: 6564 3b22 295d 292c 0a20 2020 2020 2020  ed;")]),.       
+000043a0: 2028 222e 7375 625f 7365 6374 696f 6e5f   (".sub_section_
+000043b0: 7469 746c 6522 2c20 5b28 2263 6f6c 6f72  title", [("color
+000043c0: 222c 2022 626c 7565 3b22 295d 292c 0a20  ", "blue;")]),. 
+000043d0: 2020 2020 2020 2028 222e 7375 625f 7375         (".sub_su
+000043e0: 625f 7365 6374 696f 6e5f 7469 746c 6522  b_section_title"
+000043f0: 2c20 5b28 2263 6f6c 6f72 222c 2022 6772  , [("color", "gr
+00004400: 6565 6e3b 2229 5d29 2c0a 2020 2020 2020  een;")]),.      
+00004410: 2020 2822 2e63 6f6e 6669 6465 6e63 6522    (".confidence"
+00004420: 2c20 5b28 2263 6f6c 6f72 222c 2022 6f72  , [("color", "or
+00004430: 616e 6765 3b22 295d 292c 0a20 2020 2020  ange;")]),.     
+00004440: 2020 2028 222e 7072 6f62 6162 696c 6974     (".probabilit
+00004450: 7922 2c20 5b28 2263 6f6c 6f72 222c 2022  y", [("color", "
+00004460: 2338 3838 3866 663b 2229 5d29 2c0a 2020  #8888ff;")]),.  
+00004470: 2020 2020 2020 2822 2e73 7570 6572 7363        (".supersc
+00004480: 7269 7074 222c 205b 2822 636f 6c6f 7222  ript", [("color"
+00004490: 2c20 226d 6167 656e 7461 3b22 292c 2028  , "magenta;"), (
+000044a0: 2262 6163 6b67 726f 756e 6422 2c20 2279  "background", "y
+000044b0: 656c 6c6f 773b 2229 5d29 2c0a 2020 2020  ellow;")]),.    
+000044c0: 2020 2020 2822 2e63 6875 6e6b 222c 205b      (".chunk", [
+000044d0: 2822 6261 636b 6772 6f75 6e64 222c 2022  ("background", "
+000044e0: 6379 616e 3b22 295d 292c 0a20 2020 2020  cyan;")]),.     
+000044f0: 2020 2028 222e 7461 7267 6574 7322 2c20     (".targets", 
+00004500: 5b28 2262 6163 6b67 726f 756e 6422 2c20  [("background", 
+00004510: 2223 3838 6666 3838 3b22 295d 292c 0a20  "#88ff88;")]),. 
+00004520: 2020 2020 2020 2028 222e 7374 6172 7422         (".start"
+00004530: 2c20 5b28 2262 6163 6b67 726f 756e 6422  , [("background"
+00004540: 2c20 2267 7261 793b 2229 5d29 2c0a 2020  , "gray;")]),.  
+00004550: 2020 2020 2020 2822 2e65 6e64 222c 205b        (".end", [
+00004560: 2822 6261 636b 6772 6f75 6e64 222c 2022  ("background", "
+00004570: 7965 6c6c 6f77 3b22 295d 292c 0a20 2020  yellow;")]),.   
+00004580: 2020 2020 2028 222e 7061 6765 222c 205b       (".page", [
+00004590: 2822 6261 636b 6772 6f75 6e64 222c 2022  ("background", "
+000045a0: 6d61 6765 6e74 613b 2229 5d29 2c0a 2020  magenta;")]),.  
+000045b0: 2020 2020 2020 2822 2e73 7461 7465 6d65        (".stateme
+000045c0: 6e74 222c 205b 2822 6261 636b 6772 6f75  nt", [("backgrou
+000045d0: 6e64 222c 2022 2364 6464 6466 663b 2229  nd", "#ddddff;")
+000045e0: 5d29 2c0a 2020 2020 2020 2020 2822 2e6c  ]),.        (".l
+000045f0: 6576 656c 3122 2c20 5b28 2262 6163 6b67  evel1", [("backg
+00004600: 726f 756e 6422 2c20 2223 6666 6666 6464  round", "#ffffdd
+00004610: 3b22 295d 292c 0a20 2020 2020 2020 2028  ;")]),.        (
+00004620: 222e 6c65 7665 6c32 222c 205b 2822 6261  ".level2", [("ba
+00004630: 636b 6772 6f75 6e64 222c 2022 2364 6466  ckground", "#ddf
+00004640: 6666 663b 2229 5d29 2c0a 2020 2020 2020  fff;")]),.      
+00004650: 2020 2822 2e6c 6576 656c 3322 2c20 5b28    (".level3", [(
+00004660: 2262 6163 6b67 726f 756e 6422 2c20 2223  "background", "#
+00004670: 6464 6666 6464 3b22 295d 292c 0a20 2020  ddffdd;")]),.   
+00004680: 2020 2020 2028 222e 666f 6f74 6e6f 7465       (".footnote
+00004690: 222c 205b 2822 6261 636b 6772 6f75 6e64  ", [("background
+000046a0: 222c 2022 2366 6664 6466 663b 2229 5d29  ", "#ffddff;")])
+000046b0: 2c0a 2020 2020 5d0a 0a20 2020 2040 636c  ,.    ]..    @cl
+000046c0: 6173 736d 6574 686f 640a 2020 2020 6465  assmethod.    de
+000046d0: 6620 6765 6e65 7261 7465 5f6c 6f77 6572  f generate_lower
+000046e0: 6361 7365 5f6c 6574 7465 725f 6964 2863  case_letter_id(c
+000046f0: 6c73 2c20 6929 3a0a 2020 2020 2020 2020  ls, i):.        
+00004700: 226d 616b 6520 6964 206f 6620 666f 726d  "make id of form
+00004710: 2061 2c62 2c63 2c20 2e2e 2e20 6161 2c20   a,b,c, ... aa, 
+00004720: 6162 2c20 6163 202e 2e2e 2062 612c 2062  ab, ac ... ba, b
+00004730: 622c 202e 2e2e 207a 7a20 2c20 402e 7374  b, ... zz , @.st
+00004740: 7228 6929 220a 2020 2020 2020 2020 6162  r(i)".        ab
+00004750: 6320 3d20 2261 6263 6465 6667 6869 6a6b  c = "abcdefghijk
+00004760: 6c6d 6e6f 7071 7273 7475 7677 7879 7a22  lmnopqrstuvwxyz"
+00004770: 0a20 2020 2020 2020 2069 6920 3d20 6920  .        ii = i 
+00004780: 2520 3236 0a20 2020 2020 2020 206a 6a20  % 26.        jj 
+00004790: 3d20 6920 2f2f 2032 360a 2020 2020 2020  = i // 26.      
+000047a0: 2020 6966 2069 203e 3d20 3136 202a 2031    if i >= 16 * 1
+000047b0: 363a 0a20 2020 2020 2020 2020 2020 2072  6:.            r
+000047c0: 6574 7572 6e20 2240 2e22 202b 2073 7472  eturn "@." + str
+000047d0: 2869 290a 2020 2020 2020 2020 7320 3d20  (i).        s = 
+000047e0: 2222 2069 6620 6a6a 203d 3d20 3020 656c  "" if jj == 0 el
+000047f0: 7365 2061 6263 5b6a 6a20 2d20 315d 0a20  se abc[jj - 1]. 
+00004800: 2020 2020 2020 2072 6574 7572 6e20 7320         return s 
+00004810: 2b20 6162 635b 6969 5d0a 0a20 2020 2040  + abc[ii]..    @
+00004820: 636c 6173 736d 6574 686f 640a 2020 2020  classmethod.    
+00004830: 6465 6620 6772 6f75 705f 7369 626c 696e  def group_siblin
+00004840: 6773 2863 6c73 2c20 6874 6d6c 5f65 6c65  gs(cls, html_ele
+00004850: 6d2c 206c 6f63 6174 6f72 3d4e 6f6e 652c  m, locator=None,
+00004860: 2070 6172 656e 745f 6c6f 6361 746f 723d   parent_locator=
+00004870: 4e6f 6e65 2c20 7374 796c 653d 4e6f 6e65  None, style=None
+00004880: 2c20 6465 6275 673d 4661 6c73 6529 3a0a  , debug=False):.
+00004890: 2020 2020 2020 2020 2222 2265 7672 7974          """evryt
+000048a0: 6869 6e67 2073 7461 7274 7320 6173 2061  hing starts as a
+000048b0: 2073 6962 6c69 6e67 2122 2222 0a20 2020   sibling!""".   
+000048c0: 2020 2020 2073 6563 7469 6f6e 7320 3d20       sections = 
+000048d0: 6874 6d6c 5f65 6c65 6d2e 7870 6174 6828  html_elem.xpath(
+000048e0: 6622 2e2f 2f73 7061 6e5b 7374 6172 7473  f".//span[starts
+000048f0: 2d77 6974 6828 4063 6c61 7373 2c20 277b  -with(@class, '{
+00004900: 6c6f 6361 746f 727d 2729 5d22 290a 2020  locator}')]").  
+00004910: 2020 2020 2020 6665 6e63 6570 6f73 7473        fenceposts
+00004920: 203d 2068 746d 6c5f 656c 656d 2e78 7061   = html_elem.xpa
+00004930: 7468 2866 222e 2f2f 7370 616e 5b73 7461  th(f".//span[sta
+00004940: 7274 732d 7769 7468 2840 636c 6173 732c  rts-with(@class,
+00004950: 277b 7061 7265 6e74 5f6c 6f63 6174 6f72  '{parent_locator
+00004960: 7d27 295d 2229 0a20 2020 2020 2020 2069  }')]").        i
+00004970: 6620 6c65 6e28 7365 6374 696f 6e73 2920  f len(sections) 
+00004980: 3e20 303a 0a20 2020 2020 2020 2020 2020  > 0:.           
+00004990: 2070 6172 656e 7420 3d20 7365 6374 696f   parent = sectio
+000049a0: 6e73 5b30 5d2e 6765 7470 6172 656e 7428  ns[0].getparent(
+000049b0: 290a 2020 2020 2020 2020 2020 2020 666f  ).            fo
+000049c0: 7220 7365 6374 696f 6e20 696e 2073 6563  r section in sec
+000049d0: 7469 6f6e 733a 0a20 2020 2020 2020 2020  tions:.         
+000049e0: 2020 2020 2020 2063 6c73 2e67 726f 7570         cls.group
+000049f0: 5f73 6962 6c69 6e67 735f 6265 7477 6565  _siblings_betwee
+00004a00: 6e5f 6665 6e63 6570 6f73 7473 2866 656e  n_fenceposts(fen
+00004a10: 6365 706f 7374 732c 2073 7479 6c65 3d73  ceposts, style=s
+00004a20: 7479 6c65 2c20 6465 6275 673d 6465 6275  tyle, debug=debu
+00004a30: 6729 0a0a 2020 2020 4063 6c61 7373 6d65  g)..    @classme
+00004a40: 7468 6f64 0a20 2020 2064 6566 2067 726f  thod.    def gro
+00004a50: 7570 5f73 6962 6c69 6e67 735f 6265 7477  up_siblings_betw
+00004a60: 6565 6e5f 6665 6e63 6570 6f73 7473 2863  een_fenceposts(c
+00004a70: 6c73 2c20 6665 6e63 6570 6f73 7473 2c20  ls, fenceposts, 
+00004a80: 7374 796c 653d 4e6f 6e65 2c20 6465 6275  style=None, debu
+00004a90: 673d 4661 6c73 6529 3a0a 2020 2020 2020  g=False):.      
+00004aa0: 2020 666f 7220 692c 2066 656e 6365 706f    for i, fencepo
+00004ab0: 7374 2069 6e20 656e 756d 6572 6174 6528  st in enumerate(
+00004ac0: 6665 6e63 6570 6f73 7473 293a 0a20 2020  fenceposts):.   
+00004ad0: 2020 2020 2020 2020 2066 656e 6365 706f           fencepo
+00004ae0: 7374 5f66 6f6c 6c6f 7765 7273 203d 2066  st_followers = f
+00004af0: 656e 6365 706f 7374 2e78 7061 7468 2822  encepost.xpath("
+00004b00: 666f 6c6c 6f77 696e 672d 7369 626c 696e  following-siblin
+00004b10: 673a 3a64 6976 5b73 7061 6e5d 2229 0a20  g::div[span]"). 
+00004b20: 2020 2020 2020 2020 2020 2063 6f6e 7461             conta
+00004b30: 696e 6572 5f64 6976 203d 2045 542e 456c  iner_div = ET.El
+00004b40: 656d 656e 7428 2264 6976 2229 0a20 2020  ement("div").   
+00004b50: 2020 2020 2020 2020 2063 6f6e 7461 696e           contain
+00004b60: 6572 5f64 6976 2e61 7474 7269 625b 2273  er_div.attrib["s
+00004b70: 7479 6c65 225d 203d 2073 7479 6c65 0a20  tyle"] = style. 
+00004b80: 2020 2020 2020 2020 2020 2066 656e 6365             fence
+00004b90: 706f 7374 2e61 6464 7072 6576 696f 7573  post.addprevious
+00004ba0: 2863 6f6e 7461 696e 6572 5f64 6976 290a  (container_div).
+00004bb0: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
+00004bc0: 6169 6e65 725f 6469 762e 6170 7065 6e64  ainer_div.append
+00004bd0: 2866 656e 6365 706f 7374 290a 2020 2020  (fencepost).    
+00004be0: 2020 2020 2020 2020 7469 746c 6520 3d20          title = 
+00004bf0: 6665 6e63 6570 6f73 742e 7870 6174 6828  fencepost.xpath(
+00004c00: 2273 7061 6e22 295b 305d 2e61 7474 7269  "span")[0].attri
+00004c10: 622e 6765 7428 2269 6422 290a 2020 2020  b.get("id").    
+00004c20: 2020 2020 2020 2020 6966 2074 6974 6c65          if title
+00004c30: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00004c40: 2020 636f 6e74 6169 6e65 725f 6469 762e    container_div.
+00004c50: 6174 7472 6962 5b22 7469 746c 6522 5d20  attrib["title"] 
+00004c60: 3d20 7469 746c 650a 2020 2020 2020 2020  = title.        
+00004c70: 2020 2020 666f 7220 666f 6c6c 6f77 6572      for follower
+00004c80: 2069 6e20 6665 6e63 6570 6f73 745f 666f   in fencepost_fo
+00004c90: 6c6c 6f77 6572 733a 0a20 2020 2020 2020  llowers:.       
+00004ca0: 2020 2020 2020 2020 2069 6620 666f 6c6c           if foll
+00004cb0: 6f77 6572 2069 6e20 6665 6e63 6570 6f73  ower in fencepos
+00004cc0: 7473 3a0a 2020 2020 2020 2020 2020 2020  ts:.            
+00004cd0: 2020 2020 2020 2020 6964 203d 2066 6f6c          id = fol
+00004ce0: 6c6f 7765 722e 7870 6174 6828 222e 2f73  lower.xpath("./s
+00004cf0: 7061 6e22 295b 305d 2e61 7474 7269 622e  pan")[0].attrib.
+00004d00: 6765 7428 2269 6422 290a 2020 2020 2020  get("id").      
+00004d10: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00004d20: 2064 6562 7567 3a0a 2020 2020 2020 2020   debug:.        
 00004d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004d40: 6966 2064 6562 7567 3a0a 2020 2020 2020  if debug:.      
-00004d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004d60: 2020 7072 696e 7428 6622 2069 643a 207b    print(f" id: {
-00004d70: 6964 7d22 290a 2020 2020 2020 2020 2020  id}").          
-00004d80: 2020 2020 2020 2020 2020 6272 6561 6b0a            break.
-00004d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004da0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00004db0: 2020 2020 2020 2020 2020 6966 2064 6562            if deb
-00004dc0: 7567 3a0a 2020 2020 2020 2020 2020 2020  ug:.            
-00004dd0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-00004de0: 7428 6622 6d6f 7665 6420 666f 6c6c 6f77  t(f"moved follow
-00004df0: 6572 207b 666f 6c6c 6f77 6572 7d20 746f  er {follower} to
-00004e00: 207b 636f 6e74 6169 6e65 725f 6469 762e   {container_div.
-00004e10: 6174 7472 6962 2e67 6574 2827 7469 746c  attrib.get('titl
-00004e20: 6527 297d 2229 0a20 2020 2020 2020 2020  e')}").         
-00004e30: 2020 2020 2020 2020 2020 2063 6f6e 7461             conta
-00004e40: 696e 6572 5f64 6976 2e61 7070 656e 6428  iner_div.append(
-00004e50: 666f 6c6c 6f77 6572 290a 0a20 2020 2020  follower)..     
-00004e60: 2020 2022 2222 4927 6d20 776f 726b 696e     """I'm workin
-00004e70: 6720 7769 7468 206c 786d 6c20 696e 2050  g with lxml in P
-00004e80: 7974 686f 6e20 616e 6420 7769 7368 2074  ython and wish t
-00004e90: 6f20 6772 6f75 7020 6120 666c 6174 2073  o group a flat s
-00004ea0: 6574 206f 6620 3c64 6976 3e20 656c 656d  et of <div> elem
-00004eb0: 656e 7473 2069 6e74 6f20 6120 7472 6565  ents into a tree
-00004ec0: 2062 6173 6564 206f 6e20 7468 6569 7220   based on their 
-00004ed0: 636c 6173 7320 6174 7472 6962 7574 6573  class attributes
-00004ee0: 0a49 2068 6176 6520 6120 7365 7420 6f66  .I have a set of
-00004ef0: 2073 6563 7469 6f6e 7320 3c64 6976 3e20   sections <div> 
-00004f00: 7468 6174 2061 7265 2061 6c6c 2063 6869  that are all chi
-00004f10: 6c64 7265 6e20 6f66 203c 626f 6479 3e20  ldren of <body> 
-00004f20: 7768 6963 6820 6d75 7374 2062 6520 6172  which must be ar
-00004f30: 7261 6e67 6564 2069 6e20 6120 7472 6565  ranged in a tree
-00004f40: 2073 7472 7563 7475 7265 2e20 536f 6d65   structure. Some
-00004f50: 206f 6620 7468 6520 6469 7673 2063 6f6e   of the divs con
-00004f60: 7461 696e 206a 7573 7420 6120 7469 746c  tain just a titl
-00004f70: 652d 7374 7269 6e67 2028 7469 746c 652d  e-string (title-
-00004f80: 6469 7673 2920 696e 6469 6361 7469 6e67  divs) indicating
-00004f90: 2074 6865 206c 6576 656c 2069 6e20 7472   the level in tr
-00004fa0: 6565 3b20 7468 6973 2069 7320 696e 6469  ee; this is indi
-00004fb0: 6361 7465 6420 6279 2061 2063 6c61 7373  cated by a class
-00004fc0: 2061 7474 7269 6275 7465 206f 6620 2273   attribute of "s
-00004fd0: 6563 7469 6f6e 222c 2022 7375 625f 7365  ection", "sub_se
-00004fe0: 6374 696f 6e22 2c20 2273 7562 5f73 7562  ction", "sub_sub
-00004ff0: 5f73 6563 7469 6f6e 222c 2065 7463 2e20  _section", etc. 
-00005000: 416e 7920 6469 7673 2066 6f6c 6c6f 7769  Any divs followi
-00005010: 6e67 2074 6974 6c65 2d64 6976 7320 6265  ng title-divs be
-00005020: 6c6f 6e67 2074 6f20 7468 6520 7361 6d65  long to the same
-00005030: 206c 6576 656c 2c20 756e 7469 6c20 6120   level, until a 
-00005040: 666f 6c6c 6f77 696e 6720 7469 746c 652d  following title-
-00005050: 6469 7620 6973 2072 6561 6368 6564 2e20  div is reached. 
-00005060: 506c 6561 7365 2063 7265 6174 6520 636f  Please create co
-00005070: 6465 2074 6861 743a 0a2a 2063 7265 6174  de that:.* creat
-00005080: 6573 2061 206e 6577 2068 6965 7261 7263  es a new hierarc
-00005090: 6879 206f 6620 6469 7673 2072 6570 7265  hy of divs repre
-000050a0: 7365 6e74 696e 6720 7468 6520 7472 6565  senting the tree
-000050b0: 2073 7472 7563 7475 7265 0a2a 2061 6464   structure.* add
-000050c0: 7320 7468 6520 7469 746c 652d 6469 7673  s the title-divs
-000050d0: 2061 6e64 2074 6865 6972 2066 6f6c 6c6f   and their follo
-000050e0: 7769 6e67 206e 6f6e 2d74 6974 6c65 2d64  wing non-title-d
-000050f0: 6976 7320 746f 2074 6865 2061 7070 726f  ivs to the appro
-00005100: 7072 6961 7465 2070 6f73 6974 696f 6e20  priate position 
-00005110: 696e 2074 6865 2068 6965 7261 7263 6879  in the hierarchy
-00005120: 2e0a 0a48 6572 6520 6973 2061 2074 7970  ...Here is a typ
-00005130: 6963 616c 2069 6e70 7574 3a0a 0a3c 6874  ical input:..<ht
-00005140: 6d6c 3e0a 2020 3c68 6561 643e 2e2e 2e3c  ml>.  <head>...<
-00005150: 2f68 6561 643e 0a20 203c 626f 6479 3e0a  /head>.  <body>.
-00005160: 2020 2020 3c64 6976 2063 6c61 7373 3d22      <div class="
-00005170: 7365 6374 696f 6e5f 7469 746c 6522 3e53  section_title">S
-00005180: 6563 7469 6f6e 2031 3c2f 6469 763e 0a20  ection 1</div>. 
-00005190: 2020 203c 6469 763e 7374 7566 6620 613c     <div>stuff a<
-000051a0: 2f64 6976 3e0a 2020 2020 3c64 6976 2063  /div>.    <div c
-000051b0: 6c61 7373 3d22 7375 6273 6563 7469 6f6e  lass="subsection
-000051c0: 5f74 6974 6c65 223e 5365 6374 696f 6e20  _title">Section 
-000051d0: 312e 313c 2f64 6976 3e0a 2020 2020 3c64  1.1</div>.    <d
-000051e0: 6976 3e73 7475 6666 2062 3c2f 6469 763e  iv>stuff b</div>
-000051f0: 0a20 2020 203c 6469 763e 7374 7566 6620  .    <div>stuff 
-00005200: 6278 3c2f 6469 763e 0a20 2020 203c 6469  bx</div>.    <di
-00005210: 7620 636c 6173 733d 2273 7562 7375 6273  v class="subsubs
-00005220: 6563 7469 6f6e 5f74 6974 6c65 223e 5365  ection_title">Se
-00005230: 6374 696f 6e20 312e 312e 313c 2f64 6976  ction 1.1.1</div
-00005240: 3e0a 2020 2020 3c64 6976 3e73 7475 6666  >.    <div>stuff
-00005250: 207a 3c2f 6469 763e 0a20 2020 203c 6469   z</div>.    <di
-00005260: 763e 7374 7566 6620 7a7a 3c2f 6469 763e  v>stuff zz</div>
-00005270: 0a20 2020 203c 6469 7620 636c 6173 733d  .    <div class=
-00005280: 2273 7562 7375 6273 6563 7469 6f6e 5f74  "subsubsection_t
-00005290: 6974 6c65 223e 5365 6374 696f 6e20 312e  itle">Section 1.
-000052a0: 312e 323c 2f64 6976 3e0a 2020 2020 3c64  1.2</div>.    <d
-000052b0: 6976 3e73 7475 6666 2078 3c2f 6469 763e  iv>stuff x</div>
-000052c0: 0a20 2020 203c 6469 763e 7374 7566 6620  .    <div>stuff 
-000052d0: 7878 3c2f 6469 763e 0a20 2020 203c 6469  xx</div>.    <di
-000052e0: 763e 7374 7566 6620 7878 783c 2f64 6976  v>stuff xxx</div
-000052f0: 3e0a 2020 2020 3c64 6976 2063 6c61 7373  >.    <div class
-00005300: 3d22 7375 6273 6563 7469 6f6e 5f74 6974  ="subsection_tit
-00005310: 6c65 223e 5365 6374 696f 6e20 312e 323c  le">Section 1.2<
-00005320: 2f64 6976 3e0a 2020 3c2f 626f 6479 3e0a  /div>.  </body>.
-00005330: 3c2f 6874 6d6c 3e0a 0a20 2020 616e 6420  </html>..   and 
-00005340: 6465 7369 7265 6420 6f75 7470 7574 0a3c  desired output.<
-00005350: 6874 6d6c 3e0a 2020 3c68 6561 643e 2e2e  html>.  <head>..
-00005360: 2e3c 2f68 6561 643e 0a20 203c 626f 6479  .</head>.  <body
-00005370: 3e0a 2020 2020 3c64 6976 2063 6c61 7373  >.    <div class
-00005380: 3d22 7365 6374 696f 6e22 3e0a 2020 2020  ="section">.    
-00005390: 2020 3c64 6976 2063 6c61 7373 3d22 7365    <div class="se
-000053a0: 6374 696f 6e5f 7469 746c 6522 3e53 6563  ction_title">Sec
-000053b0: 7469 6f6e 2031 3c2f 6469 763e 0a20 2020  tion 1</div>.   
-000053c0: 2020 203c 6469 763e 7374 7566 6620 613c     <div>stuff a<
-000053d0: 2f64 6976 3e0a 0920 203c 6469 7620 636c  /div>..  <div cl
-000053e0: 6173 733d 2273 7562 7365 6374 696f 6e22  ass="subsection"
-000053f0: 3e0a 2020 2020 2020 2020 3c64 6976 2063  >.        <div c
-00005400: 6c61 7373 3d22 7375 6273 6563 7469 6f6e  lass="subsection
-00005410: 5f74 6974 6c65 223e 5365 6374 696f 6e20  _title">Section 
-00005420: 312e 313c 2f64 6976 3e0a 2020 2020 2020  1.1</div>.      
-00005430: 2020 3c64 6976 3e73 7475 6666 2062 3c2f    <div>stuff b</
-00005440: 6469 763e 0a20 2020 2020 2020 203c 6469  div>.        <di
-00005450: 763e 7374 7566 6620 6278 3c2f 6469 763e  v>stuff bx</div>
-00005460: 0a09 093c 6469 7620 636c 6173 733d 2273  ...<div class="s
-00005470: 7562 7375 6273 6563 7469 6f6e 223e 0a20  ubsubsection">. 
-00005480: 2020 2020 2020 2020 203c 6469 7620 636c           <div cl
-00005490: 6173 733d 2273 7562 7375 6273 6563 7469  ass="subsubsecti
-000054a0: 6f6e 5f74 6974 6c65 223e 5365 6374 696f  on_title">Sectio
-000054b0: 6e20 312e 312e 313c 2f64 6976 3e0a 2020  n 1.1.1</div>.  
-000054c0: 2020 2020 2020 2020 3c64 6976 3e73 7475          <div>stu
-000054d0: 6666 207a 3c2f 6469 763e 0a20 2020 2020  ff z</div>.     
-000054e0: 2020 2020 203c 6469 763e 7374 7566 6620       <div>stuff 
-000054f0: 7a7a 3c2f 6469 763e 0a09 093c 2f64 6976  zz</div>...</div
-00005500: 3e0a 0909 3c64 6976 2063 6c61 7373 3d22  >...<div class="
-00005510: 7375 6273 7562 7365 6374 696f 6e22 3e0a  subsubsection">.
-00005520: 2020 2020 2020 2020 2020 3c64 6976 2063            <div c
-00005530: 6c61 7373 3d22 7375 6273 7562 7365 6374  lass="subsubsect
-00005540: 696f 6e5f 7469 746c 6522 3e53 6563 7469  ion_title">Secti
-00005550: 6f6e 2031 2e31 2e32 3c2f 6469 763e 0a20  on 1.1.2</div>. 
-00005560: 2020 2020 2020 2020 203c 6469 763e 7374           <div>st
-00005570: 7566 6620 783c 2f64 6976 3e0a 2020 2020  uff x</div>.    
-00005580: 2020 2020 2020 3c64 6976 3e73 7475 6666        <div>stuff
-00005590: 2078 783c 2f64 6976 3e0a 2020 2020 2020   xx</div>.      
-000055a0: 2020 2020 3c64 6976 3e73 7475 6666 2078      <div>stuff x
-000055b0: 7878 3c2f 6469 763e 0a09 093c 2f64 6976  xx</div>...</div
-000055c0: 3e0a 0920 203c 2f64 6976 3e0a 093c 2f64  >..  </div>..</d
-000055d0: 6976 3e0a 2020 2020 3c64 6976 2063 6c61  iv>.    <div cla
-000055e0: 7373 3d22 7365 6374 696f 6e22 3e0a 2020  ss="section">.  
-000055f0: 2020 2020 3c64 6976 2063 6c61 7373 3d22      <div class="
-00005600: 7365 6374 696f 6e5f 7469 746c 6522 3e53  section_title">S
-00005610: 6563 7469 6f6e 2032 3c2f 6469 763e 0a09  ection 2</div>..
-00005620: 3c2f 6469 763e 0a20 203c 2f62 6f64 793e  </div>.  </body>
-00005630: 0a3c 2f68 746d 6c3e 0a0a 4368 6174 4750  .</html>..ChatGP
-00005640: 540a 546f 2061 6368 6965 7665 2074 6865  T.To achieve the
-00005650: 2064 6573 6972 6564 206f 7574 7075 742c   desired output,
-00005660: 2079 6f75 2063 616e 2075 7365 2074 6865   you can use the
-00005670: 2066 6f6c 6c6f 7769 6e67 2050 7974 686f   following Pytho
-00005680: 6e20 636f 6465 2074 6f20 7061 7273 6520  n code to parse 
-00005690: 7468 6520 4854 4d4c 2075 7369 6e67 206c  the HTML using l
-000056a0: 786d 6c20 616e 6420 7265 7374 7275 6374  xml and restruct
-000056b0: 7572 6520 7468 6520 3c64 6976 3e20 656c  ure the <div> el
-000056c0: 656d 656e 7473 2069 6e74 6f20 6120 7472  ements into a tr
-000056d0: 6565 2073 7472 7563 7475 7265 2062 6173  ee structure bas
-000056e0: 6564 206f 6e20 7468 6569 7220 636c 6173  ed on their clas
-000056f0: 7320 6174 7472 6962 7574 6573 3a0a 0a70  s attributes:..p
-00005700: 7974 686f 6e0a 436f 7079 2063 6f64 650a  ython.Copy code.
-00005710: 6672 6f6d 206c 786d 6c20 696d 706f 7274  from lxml import
-00005720: 2065 7472 6565 2023 2069 6e20 636f 6d6d   etree # in comm
-00005730: 656e 740a 0a64 6566 2067 726f 7570 5f64  ent..def group_d
-00005740: 6976 735f 696e 746f 5f74 7265 6528 6874  ivs_into_tree(ht
-00005750: 6d6c 293a 0a20 2020 2023 2050 6172 7365  ml):.    # Parse
-00005760: 2074 6865 2048 544d 4c0a 2020 2020 7472   the HTML.    tr
-00005770: 6565 203d 2065 7472 6565 2e48 544d 4c28  ee = etree.HTML(
-00005780: 6874 6d6c 290a 0a20 2020 2023 2046 696e  html)..    # Fin
-00005790: 6420 616c 6c20 3c64 6976 3e20 656c 656d  d all <div> elem
-000057a0: 656e 7473 2077 6974 6869 6e20 7468 6520  ents within the 
-000057b0: 3c62 6f64 793e 2074 6167 0a20 2020 2064  <body> tag.    d
-000057c0: 6976 5f65 6c65 6d65 6e74 7320 3d20 7472  iv_elements = tr
-000057d0: 6565 2e78 7061 7468 2822 2f2f 626f 6479  ee.xpath("//body
-000057e0: 2f64 6976 2229 0a0a 2020 2020 2320 4372  /div")..    # Cr
-000057f0: 6561 7465 2061 206e 6577 2072 6f6f 7420  eate a new root 
-00005800: 3c64 6976 3e20 656c 656d 656e 7420 746f  <div> element to
-00005810: 2068 6f6c 6420 7468 6520 7472 6565 2073   hold the tree s
-00005820: 7472 7563 7475 7265 0a20 2020 2072 6f6f  tructure.    roo
-00005830: 7420 3d20 6574 7265 652e 456c 656d 656e  t = etree.Elemen
-00005840: 7428 2264 6976 2229 0a0a 2020 2020 2320  t("div")..    # 
-00005850: 496e 6974 6961 6c69 7a65 2076 6172 6961  Initialize varia
-00005860: 626c 6573 2074 6f20 6b65 6570 2074 7261  bles to keep tra
-00005870: 636b 206f 6620 7468 6520 6375 7272 656e  ck of the curren
-00005880: 7420 7061 7265 6e74 203c 6469 763e 2061  t parent <div> a
-00005890: 6e64 2069 7473 206c 6576 656c 0a20 2020  nd its level.   
-000058a0: 2063 7572 7265 6e74 5f70 6172 656e 7420   current_parent 
-000058b0: 3d20 726f 6f74 0a20 2020 2063 7572 7265  = root.    curre
-000058c0: 6e74 5f6c 6576 656c 203d 2030 0a0a 2020  nt_level = 0..  
-000058d0: 2020 666f 7220 6469 7620 696e 2064 6976    for div in div
-000058e0: 5f65 6c65 6d65 6e74 733a 0a20 2020 2020  _elements:.     
-000058f0: 2020 2023 2043 6865 636b 2069 6620 7468     # Check if th
-00005900: 6520 6375 7272 656e 7420 3c64 6976 3e20  e current <div> 
-00005910: 6861 7320 6120 636c 6173 7320 6174 7472  has a class attr
-00005920: 6962 7574 650a 2020 2020 2020 2020 6966  ibute.        if
-00005930: 2022 636c 6173 7322 2069 6e20 6469 762e   "class" in div.
-00005940: 6174 7472 6962 3a0a 2020 2020 2020 2020  attrib:.        
-00005950: 2020 2020 636c 6173 735f 7661 6c75 6520      class_value 
-00005960: 3d20 6469 762e 6174 7472 6962 5b22 636c  = div.attrib["cl
-00005970: 6173 7322 5d0a 0a20 2020 2020 2020 2020  ass"]..         
-00005980: 2020 2023 2044 6574 6572 6d69 6e65 2074     # Determine t
-00005990: 6865 206c 6576 656c 2062 6173 6564 206f  he level based o
-000059a0: 6e20 7468 6520 636c 6173 7320 6174 7472  n the class attr
-000059b0: 6962 7574 650a 2020 2020 2020 2020 2020  ibute.          
-000059c0: 2020 6966 2063 6c61 7373 5f76 616c 7565    if class_value
-000059d0: 2e73 7461 7274 7377 6974 6828 2273 6563  .startswith("sec
-000059e0: 7469 6f6e 5f74 6974 6c65 2229 3a0a 2020  tion_title"):.  
-000059f0: 2020 2020 2020 2020 2020 2020 2020 6c65                le
-00005a00: 7665 6c20 3d20 300a 2020 2020 2020 2020  vel = 0.        
-00005a10: 2020 2020 656c 6966 2063 6c61 7373 5f76      elif class_v
-00005a20: 616c 7565 2e73 7461 7274 7377 6974 6828  alue.startswith(
-00005a30: 2273 7562 7365 6374 696f 6e5f 7469 746c  "subsection_titl
-00005a40: 6522 293a 0a20 2020 2020 2020 2020 2020  e"):.           
-00005a50: 2020 2020 206c 6576 656c 203d 2031 0a20       level = 1. 
-00005a60: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
-00005a70: 636c 6173 735f 7661 6c75 652e 7374 6172  class_value.star
-00005a80: 7473 7769 7468 2822 7375 6273 7562 7365  tswith("subsubse
-00005a90: 6374 696f 6e5f 7469 746c 6522 293a 0a20  ction_title"):. 
-00005aa0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-00005ab0: 6576 656c 203d 2032 0a20 2020 2020 2020  evel = 2.       
-00005ac0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00005ad0: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
-00005ae0: 6e75 6520 2023 2053 6b69 7020 3c64 6976  nue  # Skip <div
-00005af0: 3e20 656c 656d 656e 7473 2077 6974 686f  > elements witho
-00005b00: 7574 2074 6974 6c65 2063 6c61 7373 6573  ut title classes
-00005b10: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-00005b20: 4372 6561 7465 2061 206e 6577 203c 6469  Create a new <di
-00005b30: 763e 2065 6c65 6d65 6e74 2061 6e64 2073  v> element and s
-00005b40: 6574 2069 7473 2063 6c61 7373 2061 7474  et its class att
-00005b50: 7269 6275 7465 0a20 2020 2020 2020 2020  ribute.         
-00005b60: 2020 206e 6577 5f64 6976 203d 2065 7472     new_div = etr
-00005b70: 6565 2e53 7562 456c 656d 656e 7428 6375  ee.SubElement(cu
-00005b80: 7272 656e 745f 7061 7265 6e74 2c20 2264  rrent_parent, "d
-00005b90: 6976 2229 0a20 2020 2020 2020 2020 2020  iv").           
-00005ba0: 206e 6577 5f64 6976 2e61 7474 7269 625b   new_div.attrib[
-00005bb0: 2263 6c61 7373 225d 203d 2022 7365 6374  "class"] = "sect
-00005bc0: 696f 6e22 202a 2028 6c65 7665 6c20 2b20  ion" * (level + 
-00005bd0: 3129 2020 2320 4164 6420 6170 7072 6f70  1)  # Add approp
-00005be0: 7269 6174 6520 636c 6173 7320 6261 7365  riate class base
-00005bf0: 6420 6f6e 206c 6576 656c 0a0a 2020 2020  d on level..    
-00005c00: 2020 2020 2020 2020 2320 4164 6420 7468          # Add th
-00005c10: 6520 6375 7272 656e 7420 3c64 6976 3e20  e current <div> 
-00005c20: 746f 2074 6865 206e 6577 203c 6469 763e  to the new <div>
-00005c30: 2065 6c65 6d65 6e74 0a20 2020 2020 2020   element.       
-00005c40: 2020 2020 206e 6577 5f64 6976 2e61 7070       new_div.app
-00005c50: 656e 6428 6469 7629 0a0a 2020 2020 2020  end(div)..      
-00005c60: 2020 2020 2020 2320 5570 6461 7465 2074        # Update t
-00005c70: 6865 2063 7572 7265 6e74 2070 6172 656e  he current paren
-00005c80: 7420 616e 6420 6c65 7665 6c0a 2020 2020  t and level.    
-00005c90: 2020 2020 2020 2020 6375 7272 656e 745f          current_
-00005ca0: 7061 7265 6e74 203d 206e 6577 5f64 6976  parent = new_div
-00005cb0: 0a20 2020 2020 2020 2020 2020 2063 7572  .            cur
-00005cc0: 7265 6e74 5f6c 6576 656c 203d 206c 6576  rent_level = lev
-00005cd0: 656c 0a20 2020 2020 2020 2065 6c73 653a  el.        else:
-00005ce0: 0a20 2020 2020 2020 2020 2020 2023 2041  .            # A
-00005cf0: 6464 206e 6f6e 2d74 6974 6c65 203c 6469  dd non-title <di
-00005d00: 763e 2065 6c65 6d65 6e74 7320 746f 2074  v> elements to t
-00005d10: 6865 2063 7572 7265 6e74 2070 6172 656e  he current paren
-00005d20: 740a 2020 2020 2020 2020 2020 2020 6375  t.            cu
-00005d30: 7272 656e 745f 7061 7265 6e74 2e61 7070  rrent_parent.app
-00005d40: 656e 6428 6469 7629 0a0a 2020 2020 2320  end(div)..    # 
-00005d50: 5265 7475 726e 2074 6865 206d 6f64 6966  Return the modif
-00005d60: 6965 6420 4854 4d4c 2061 7320 6120 7374  ied HTML as a st
-00005d70: 7269 6e67 0a20 2020 2072 6574 7572 6e20  ring.    return 
-00005d80: 6574 7265 652e 746f 7374 7269 6e67 2874  etree.tostring(t
-00005d90: 7265 652c 2065 6e63 6f64 696e 673d 2275  ree, encoding="u
-00005da0: 6e69 636f 6465 2229 0a0a 2320 4578 616d  nicode")..# Exam
-00005db0: 706c 6520 7573 6167 650a 6874 6d6c 203d  ple usage.html =
-00005dc0: 2027 2727 0a3c 6874 6d6c 3e0a 2020 3c68   '''.<html>.  <h
-00005dd0: 6561 643e 2e2e 2e3c 2f68 6561 643e 0a20  ead>...</head>. 
-00005de0: 203c 626f 6479 3e0a 2020 2020 3c64 6976   <body>.    <div
-00005df0: 2063 6c61 7373 3d22 7365 6374 696f 6e5f   class="section_
-00005e00: 7469 746c 6522 3e53 6563 7469 6f6e 2031  title">Section 1
-00005e10: 3c2f 6469 763e 0a20 2020 203c 6469 763e  </div>.    <div>
-00005e20: 7374 7566 6620 613c 2f64 6976 3e0a 2020  stuff a</div>.  
-00005e30: 2020 3c64 6976 2063 6c61 7373 3d22 7375    <div class="su
-00005e40: 6273 6563 7469 6f6e 5f74 6974 6c65 223e  bsection_title">
-00005e50: 5365 6374 696f 6e20 312e 313c 2f64 6976  Section 1.1</div
-00005e60: 3e0a 2020 2020 3c64 6976 3e73 7475 6666  >.    <div>stuff
-00005e70: 2062 3c2f 6469 763e 0a20 2020 203c 6469   b</div>.    <di
-00005e80: 763e 7374 7566 6620 6278 3c2f 6469 763e  v>stuff bx</div>
-00005e90: 0a20 2020 203c 6469 7620 636c 6173 733d  .    <div class=
-00005ea0: 2273 7562 7375 6273 6563 7469 6f6e 5f74  "subsubsection_t
-00005eb0: 6974 6c65 223e 5365 6374 696f 6e20 312e  itle">Section 1.
-00005ec0: 312e 313c 2f64 6976 3e0a 2020 2020 3c64  1.1</div>.    <d
-00005ed0: 6976 3e73 7475 6666 207a 3c2f 6469 763e  iv>stuff z</div>
-00005ee0: 0a20 2020 203c 6469 763e 7374 7566 6620  .    <div>stuff 
-00005ef0: 7a7a 3c2f 6469 763e 0a20 2020 203c 6469  zz</div>.    <di
-00005f00: 7620 636c 6173 733d 2273 7562 7375 6273  v class="subsubs
-00005f10: 6563 7469 6f6e 5f74 6974 6c65 223e 5365  ection_title">Se
-00005f20: 6374 696f 6e20 312e 312e 323c 2f64 6976  ction 1.1.2</div
-00005f30: 3e0a 2020 2020 3c64 6976 3e73 7475 6666  >.    <div>stuff
-00005f40: 2078 3c2f 6469 763e 0a20 2020 203c 6469   x</div>.    <di
-00005f50: 763e 7374 7566 6620 7878 3c2f 6469 763e  v>stuff xx</div>
-00005f60: 0a20 2020 203c 6469 763e 7374 7566 6620  .    <div>stuff 
-00005f70: 7878 783c 2f64 6976 3e0a 2020 2020 3c64  xxx</div>.    <d
-00005f80: 6976 2063 6c61 7373 3d22 7375 6273 6563  iv class="subsec
-00005f90: 7469 6f6e 5f74 6974 6c65 223e 5365 6374  tion_title">Sect
-00005fa0: 696f 6e20 312e 323c 2f64 6976 3e0a 2020  ion 1.2</div>.  
-00005fb0: 3c2f 626f 6479 3e0a 3c2f 6874 6d6c 3e0a  </body>.</html>.
-00005fc0: 2727 270a 0a6f 7574 7075 745f 6874 6d6c  '''..output_html
-00005fd0: 203d 2067 726f 7570 5f64 6976 735f 696e   = group_divs_in
-00005fe0: 746f 5f74 7265 6528 6874 6d6c 290a 7072  to_tree(html).pr
-00005ff0: 696e 7428 6f75 7470 7574 5f68 746d 6c29  int(output_html)
-00006000: 0a54 6865 2063 6f64 6520 7769 6c6c 2070  .The code will p
-00006010: 6172 7365 2074 6865 2048 544d 4c2c 2069  arse the HTML, i
-00006020: 6465 6e74 6966 7920 7468 6520 7469 746c  dentify the titl
-00006030: 6520 3c64 6976 3e20 656c 656d 656e 7473  e <div> elements
-00006040: 2062 6173 6564 206f 6e20 7468 6569 7220   based on their 
-00006050: 636c 6173 7320 6174 7472 6962 7574 6573  class attributes
-00006060: 2c20 6372 6561 7465 2061 206e 6577 2068  , create a new h
-00006070: 6965 7261 7263 6879 206f 6620 3c64 6976  ierarchy of <div
-00006080: 3e20 656c 656d 656e 7473 2c20 616e 6420  > elements, and 
-00006090: 6164 6420 7468 6520 7469 746c 6520 3c64  add the title <d
-000060a0: 6976 3e73 2061 6e64 2074 6865 6972 2066  iv>s and their f
-000060b0: 6f6c 6c6f 7769 6e67 206e 6f6e 2d74 6974  ollowing non-tit
-000060c0: 6c65 203c 6469 763e 7320 746f 2074 6865  le <div>s to the
-000060d0: 2061 7070 726f 7072 6961 7465 2070 6f73   appropriate pos
-000060e0: 6974 696f 6e20 696e 2074 6865 2068 6965  ition in the hie
-000060f0: 7261 7263 6879 2e20 4669 6e61 6c6c 792c  rarchy. Finally,
-00006100: 2069 7420 7769 6c6c 2072 6574 7572 6e20   it will return 
-00006110: 7468 6520 6d6f 6469 6669 6564 2048 544d  the modified HTM
-00006120: 4c20 6173 2061 2073 7472 696e 672e 0a0a  L as a string...
-00006130: 506c 6561 7365 206e 6f74 6520 7468 6174  Please note that
-00006140: 2074 6865 2063 6f64 6520 6173 7375 6d65   the code assume
-00006150: 7320 7468 6174 2074 6865 2063 6c61 7373  s that the class
-00006160: 2076 616c 7565 7320 666f 7220 7468 6520   values for the 
-00006170: 7469 746c 6520 3c64 6976 3e20 656c 656d  title <div> elem
-00006180: 656e 7473 2066 6f6c 6c6f 7720 7468 6520  ents follow the 
-00006190: 7061 7474 6572 6e20 2273 6563 7469 6f6e  pattern "section
-000061a0: 5f74 6974 6c65 222c 2022 7375 6273 6563  _title", "subsec
-000061b0: 7469 6f6e 5f74 6974 6c65 222c 2022 7375  tion_title", "su
-000061c0: 6273 7562 7365 6374 696f 6e5f 7469 746c  bsubsection_titl
-000061d0: 6522 2c20 616e 6420 736f 206f 6e2e 2049  e", and so on. I
-000061e0: 6620 796f 7572 2061 6374 7561 6c20 636c  f your actual cl
-000061f0: 6173 7320 6e61 6d65 7320 6469 6666 6572  ass names differ
-00006200: 2c20 796f 7520 6d61 7920 6e65 6564 2074  , you may need t
-00006210: 6f20 6d6f 6469 6679 2074 6865 2063 6f64  o modify the cod
-00006220: 6520 6163 636f 7264 696e 676c 792e 0a0a  e accordingly...
-00006230: 0a0a 0a0a 5265 6765 6e65 7261 7465 2072  ....Regenerate r
-00006240: 6573 706f 6e73 650a 5365 6e64 2061 206d  esponse.Send a m
-00006250: 6573 7361 6765 2e0a 0a46 7265 6520 5265  essage...Free Re
-00006260: 7365 6172 6368 2050 7265 7669 6577 2e20  search Preview. 
-00006270: 4368 6174 4750 5420 6d61 7920 7072 6f64  ChatGPT may prod
-00006280: 7563 6520 696e 6163 6375 7261 7465 2069  uce inaccurate i
-00006290: 6e66 6f72 6d61 7469 6f6e 2061 626f 7574  nformation about
-000062a0: 2070 656f 706c 652c 2070 6c61 6365 732c   people, places,
-000062b0: 206f 7220 6661 6374 732e 2043 6861 7447   or facts. ChatG
-000062c0: 5054 204d 6179 2031 3220 5665 7273 696f  PT May 12 Versio
-000062d0: 6e22 2222 0a20 2020 2040 636c 6173 736d  n""".    @classm
-000062e0: 6574 686f 640a 2020 2020 6465 6620 6772  ethod.    def gr
-000062f0: 6f75 705f 6469 7673 5f69 6e74 6f5f 7472  oup_divs_into_tr
-00006300: 6565 2863 6c73 2c20 626f 6479 293a 0a20  ee(cls, body):. 
-00006310: 2020 2020 2020 2022 2222 5065 7465 7220         """Peter 
-00006320: 4d75 7272 6179 2d52 7573 7422 2222 0a20  Murray-Rust""". 
-00006330: 2020 2020 2020 2045 4e44 203d 2022 5b45         END = "[E
-00006340: 4e44 220a 2020 2020 2020 2020 5354 4152  ND".        STAR
-00006350: 5420 3d20 225b 5354 4152 5422 0a20 2020  T = "[START".   
-00006360: 2020 2020 2046 4c4f 4154 203d 2022 666c       FLOAT = "fl
-00006370: 6f61 7422 0a0a 2020 2020 2020 2020 736b  oat"..        sk
-00006380: 6970 5f72 6573 203d 205b 0a20 2020 2020  ip_res = [.     
-00006390: 2020 2020 2020 2072 652e 636f 6d70 696c         re.compil
-000063a0: 6528 2241 646f 7074 6564 2e2a 2229 2c0a  e("Adopted.*"),.
-000063b0: 2020 2020 2020 2020 2020 2020 7265 2e63              re.c
-000063c0: 6f6d 7069 6c65 2822 5375 626a 6563 7420  ompile("Subject 
-000063d0: 746f 2043 6f70 7922 290a 2020 2020 2020  to Copy").      
-000063e0: 2020 5d0a 0a0a 2020 2020 2020 2020 6469    ]...        di
-000063f0: 765f 7374 796c 6573 203d 205b 2262 6f72  v_styles = ["bor
-00006400: 6465 723a 2023 3838 3838 6666 2073 6f6c  der: #8888ff sol
-00006410: 6964 2033 7078 3b22 2c0a 2020 2020 2020  id 3px;",.      
-00006420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006430: 2262 6f72 6465 723a 2063 7961 6e20 6461  "border: cyan da
-00006440: 7368 6564 2032 2e35 7078 3b22 2c0a 2020  shed 2.5px;",.  
-00006450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006460: 2020 2020 2262 6f72 6465 723a 2067 7265      "border: gre
-00006470: 656e 2064 6173 6865 6420 3270 783b 222c  en dashed 2px;",
-00006480: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00006490: 2020 2020 2020 205d 0a0a 2020 2020 2020         ]..      
-000064a0: 2020 2320 4669 6e64 2061 6c6c 203c 6469    # Find all <di
-000064b0: 763e 2065 6c65 6d65 6e74 7320 7769 7468  v> elements with
-000064c0: 696e 2074 6865 203c 626f 6479 3e20 7461  in the <body> ta
-000064d0: 670a 2020 2020 2020 2020 6469 765f 656c  g.        div_el
-000064e0: 656d 656e 7473 203d 2062 6f64 792e 7870  ements = body.xp
-000064f0: 6174 6828 222e 2f64 6976 2229 0a0a 2020  ath("./div")..  
-00006500: 2020 2020 2020 2320 4372 6561 7465 2061        # Create a
-00006510: 206e 6577 2072 6f6f 7420 3c64 6976 3e20   new root <div> 
-00006520: 656c 656d 656e 7420 746f 2068 6f6c 6420  element to hold 
-00006530: 7468 6520 7472 6565 2073 7472 7563 7475  the tree structu
-00006540: 7265 0a20 2020 2020 2020 2072 6f6f 745f  re.        root_
-00006550: 6469 7620 3d20 4554 2e45 6c65 6d65 6e74  div = ET.Element
-00006560: 2822 6469 7622 290a 2020 2020 2020 2020  ("div").        
-00006570: 726f 6f74 5f64 6976 2e61 7474 7269 625b  root_div.attrib[
-00006580: 2263 6c61 7373 225d 203d 2022 726f 6f74  "class"] = "root
-00006590: 220a 2020 2020 2020 2020 726f 6f74 5f64  ".        root_d
-000065a0: 6976 2e61 7474 7269 625b 2274 6974 6c65  iv.attrib["title
-000065b0: 225d 203d 2022 726f 6f74 220a 0a20 2020  "] = "root"..   
-000065c0: 2020 2020 2023 2049 6e69 7469 616c 697a       # Initializ
-000065d0: 6520 7661 7269 6162 6c65 7320 746f 206b  e variables to k
-000065e0: 6565 7020 7472 6163 6b20 6f66 2074 6865  eep track of the
-000065f0: 2063 7572 7265 6e74 2070 6172 656e 7420   current parent 
-00006600: 3c64 6976 3e20 616e 6420 6974 7320 6c65  <div> and its le
-00006610: 7665 6c0a 2020 2020 2020 2020 6375 7272  vel.        curr
-00006620: 656e 745f 7061 7265 6e74 203d 2072 6f6f  ent_parent = roo
-00006630: 745f 6469 760a 2020 2020 2020 2020 6375  t_div.        cu
-00006640: 7272 656e 745f 6c65 7665 6c20 3d20 300a  rrent_level = 0.
-00006650: 0a20 2020 2020 2020 2070 6172 656e 7473  .        parents
-00006660: 203d 205b 726f 6f74 5f64 6976 2c20 4e6f   = [root_div, No
-00006670: 6e65 2c20 4e6f 6e65 2c20 4e6f 6e65 5d0a  ne, None, None].
-00006680: 2020 2020 2020 2020 7374 6172 745f 656e          start_en
-00006690: 6473 203d 205b 5d0a 2020 2020 2020 2020  ds = [].        
-000066a0: 7061 7265 6e74 203d 2072 6f6f 745f 6469  parent = root_di
-000066b0: 760a 2020 2020 2020 2020 666f 7220 6469  v.        for di
-000066c0: 7620 696e 2064 6976 5f65 6c65 6d65 6e74  v in div_element
-000066d0: 733a 0a20 2020 2020 2020 2020 2020 2023  s:.            #
-000066e0: 2043 6865 636b 2069 6620 7468 6520 6375   Check if the cu
-000066f0: 7272 656e 7420 3c64 6976 3e20 6861 7320  rrent <div> has 
-00006700: 6120 636c 6173 7320 6174 7472 6962 7574  a class attribut
-00006710: 650a 2020 2020 2020 2020 2020 2020 7465  e.            te
-00006720: 7874 203d 2027 272e 6a6f 696e 2864 6976  xt = ''.join(div
-00006730: 2e69 7465 7274 6578 7428 2929 0a20 2020  .itertext()).   
-00006740: 2020 2020 2020 2020 2069 6620 2263 6c61           if "cla
-00006750: 7373 2220 696e 2064 6976 2e61 7474 7269  ss" in div.attri
-00006760: 623a 0a20 2020 2020 2020 2020 2020 2020  b:.             
-00006770: 2020 2070 6172 656e 7420 3d20 636c 732e     parent = cls.
-00006780: 7072 6f63 6573 735f 636c 6173 735f 6469  process_class_di
-00006790: 7628 6469 762c 2064 6976 5f73 7479 6c65  v(div, div_style
-000067a0: 732c 2070 6172 656e 742c 2070 6172 656e  s, parent, paren
-000067b0: 7473 2c20 7465 7874 290a 0a20 2020 2020  ts, text)..     
-000067c0: 2020 2020 2020 2065 6c69 6620 7465 7874         elif text
-000067d0: 2e73 7461 7274 7377 6974 6828 5354 4152  .startswith(STAR
-000067e0: 5429 3a0a 2020 2020 2020 2020 2020 2020  T):.            
-000067f0: 2020 2020 7061 7265 6e74 203d 2063 6c73      parent = cls
-00006800: 2e70 726f 6365 7373 5f69 7063 635f 7374  .process_ipcc_st
-00006810: 6172 7428 464c 4f41 542c 2053 5441 5254  art(FLOAT, START
-00006820: 2c20 7061 7265 6e74 2c20 7374 6172 745f  , parent, start_
-00006830: 656e 6473 2c20 7465 7874 290a 0a20 2020  ends, text)..   
-00006840: 2020 2020 2020 2020 2065 6c69 6620 7465           elif te
-00006850: 7874 2e73 7461 7274 7377 6974 6828 454e  xt.startswith(EN
-00006860: 4429 3a0a 2020 2020 2020 2020 2020 2020  D):.            
-00006870: 2020 2020 7061 7265 6e74 203d 2063 6c73      parent = cls
-00006880: 2e70 726f 6365 7373 5f69 7063 635f 656e  .process_ipcc_en
-00006890: 6428 454e 442c 2053 5441 5254 2c20 7061  d(END, START, pa
-000068a0: 7265 6e74 2c20 7374 6172 745f 656e 6473  rent, start_ends
-000068b0: 2c20 7465 7874 290a 0a20 2020 2020 2020  , text)..       
-000068c0: 2020 2020 2065 6c69 6620 636c 732e 736b       elif cls.sk
-000068d0: 6970 5f63 6f6e 7465 6e74 2874 6578 742c  ip_content(text,
-000068e0: 2073 6b69 705f 7265 7329 3a0a 2020 2020   skip_res):.    
-000068f0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-00006900: 7428 6622 736b 6970 7065 6420 7b74 6578  t(f"skipped {tex
-00006910: 745b 3a35 305d 7d22 290a 0a20 2020 2020  t[:50]}")..     
-00006920: 2020 2020 2020 2023 2065 6c69 6620 636c         # elif cl
-00006930: 732e 6973 5f66 6f6f 746e 6f74 6528 7370  s.is_footnote(sp
-00006940: 616e 293a 0a20 2020 2020 2020 2020 2020  an):.           
-00006950: 2023 2020 2020 2070 7269 6e74 2866 2273   #     print(f"s
-00006960: 6b69 7070 6564 207b 7465 7874 5b3a 3530  kipped {text[:50
-00006970: 5d7d 2229 0a20 2020 2020 2020 2020 2020  ]}").           
-00006980: 2023 0a20 2020 2020 2020 2020 2020 2065   #.            e
-00006990: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-000069a0: 2020 2020 2070 6172 656e 742e 6170 7065       parent.appe
-000069b0: 6e64 2864 6976 290a 0a20 2020 2020 2020  nd(div)..       
-000069c0: 2072 6574 7572 6e20 726f 6f74 5f64 6976   return root_div
-000069d0: 0a0a 2020 2020 4063 6c61 7373 6d65 7468  ..    @classmeth
-000069e0: 6f64 0a20 2020 2064 6566 2070 726f 6365  od.    def proce
-000069f0: 7373 5f69 7063 635f 656e 6428 636c 732c  ss_ipcc_end(cls,
-00006a00: 2045 4e44 2c20 5354 4152 542c 2070 6172   END, START, par
-00006a10: 656e 742c 2073 7461 7274 5f65 6e64 732c  ent, start_ends,
-00006a20: 2074 6578 7429 3a0a 2020 2020 2020 2020   text):.        
-00006a30: 656e 645f 7374 7220 3d20 7465 7874 5b6c  end_str = text[l
-00006a40: 656e 2845 4e44 293a 5d0a 2020 2020 2020  en(END):].      
-00006a50: 2020 6966 2073 7461 7274 5f65 6e64 733a    if start_ends:
-00006a60: 0a20 2020 2020 2020 2020 2020 2023 2073  .            # s
-00006a70: 6f6d 6574 696d 6573 2075 6e62 616c 616e  ometimes unbalan
-00006a80: 6365 6420 696e 2064 6f63 756d 656e 740a  ced in document.
-00006a90: 2020 2020 2020 2020 2020 2020 7374 6172              star
-00006aa0: 745f 7374 7220 3d20 7374 6172 745f 656e  t_str = start_en
-00006ab0: 6473 2e70 6f70 2829 0a20 2020 2020 2020  ds.pop().       
-00006ac0: 2020 2020 2069 6620 7374 6172 745f 7374       if start_st
-00006ad0: 7220 213d 2065 6e64 5f73 7472 3a0a 2020  r != end_str:.  
-00006ae0: 2020 2020 2020 2020 2020 2020 2020 6c6f                lo
-00006af0: 6767 6572 2e77 6172 6e69 6e67 2866 2275  gger.warning(f"u
-00006b00: 6e62 616c 616e 6365 643a 207b 5354 4152  nbalanced: {STAR
-00006b10: 5420 2b20 7374 6172 745f 7374 727d 2061  T + start_str} a
-00006b20: 6e64 207b 454e 4420 2b20 656e 645f 7374  nd {END + end_st
-00006b30: 727d 2229 0a20 2020 2020 2020 2020 2020  r}").           
-00006b40: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00006b50: 2020 2020 2020 2070 6172 656e 7420 3d20         parent = 
-00006b60: 7061 7265 6e74 2e67 6574 7061 7265 6e74  parent.getparent
-00006b70: 2829 0a20 2020 2020 2020 2072 6574 7572  ().        retur
-00006b80: 6e20 7061 7265 6e74 0a0a 2020 2020 4063  n parent..    @c
-00006b90: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
-00006ba0: 6566 2070 726f 6365 7373 5f69 7063 635f  ef process_ipcc_
-00006bb0: 7374 6172 7428 636c 732c 2046 4c4f 4154  start(cls, FLOAT
-00006bc0: 2c20 5354 4152 542c 2070 6172 656e 742c  , START, parent,
-00006bd0: 2073 7461 7274 5f65 6e64 732c 2074 6578   start_ends, tex
-00006be0: 7429 3a0a 2020 2020 2020 2020 7374 6172  t):.        star
-00006bf0: 745f 7374 7220 3d20 7465 7874 5b6c 656e  t_str = text[len
-00006c00: 2853 5441 5254 293a 5d0a 2020 2020 2020  (START):].      
-00006c10: 2020 7374 6172 745f 656e 6473 2e61 7070    start_ends.app
-00006c20: 656e 6428 7374 6172 745f 7374 7229 0a20  end(start_str). 
-00006c30: 2020 2020 2020 2073 7562 5f64 6976 203d         sub_div =
-00006c40: 2045 542e 5375 6245 6c65 6d65 6e74 2870   ET.SubElement(p
-00006c50: 6172 656e 742c 2022 6469 7622 290a 2020  arent, "div").  
-00006c60: 2020 2020 2020 7375 625f 6469 762e 6174        sub_div.at
-00006c70: 7472 6962 5b22 636c 6173 7322 5d20 3d20  trib["class"] = 
-00006c80: 464c 4f41 540a 2020 2020 2020 2020 7375  FLOAT.        su
-00006c90: 625f 6469 762e 6174 7472 6962 5b22 7469  b_div.attrib["ti
-00006ca0: 746c 6522 5d20 3d20 7465 7874 0a20 2020  tle"] = text.   
-00006cb0: 2020 2020 2073 7562 5f64 6976 2e61 7474       sub_div.att
-00006cc0: 7269 625b 2273 7479 6c65 225d 203d 2022  rib["style"] = "
-00006cd0: 626f 7264 6572 3a20 6461 7368 6564 2062  border: dashed b
-00006ce0: 6c75 6520 3370 783b 220a 2020 2020 2020  lue 3px;".      
-00006cf0: 2020 7061 7265 6e74 203d 2073 7562 5f64    parent = sub_d
-00006d00: 6976 0a20 2020 2020 2020 2072 6574 7572  iv.        retur
-00006d10: 6e20 7061 7265 6e74 0a0a 2020 2020 4063  n parent..    @c
-00006d20: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
-00006d30: 6566 2070 726f 6365 7373 5f63 6c61 7373  ef process_class
-00006d40: 5f64 6976 2863 6c73 2c20 6469 762c 2064  _div(cls, div, d
-00006d50: 6976 5f73 7479 6c65 732c 2070 6172 656e  iv_styles, paren
-00006d60: 742c 2070 6172 656e 7473 2c20 7465 7874  t, parents, text
-00006d70: 293a 0a20 2020 2020 2020 2063 6c61 7373  ):.        class
-00006d80: 5f76 616c 7565 203d 2064 6976 2e61 7474  _value = div.att
-00006d90: 7269 625b 2263 6c61 7373 225d 0a20 2020  rib["class"].   
-00006da0: 2020 2020 2023 2044 6574 6572 6d69 6e65       # Determine
-00006db0: 2074 6865 206c 6576 656c 2062 6173 6564   the level based
-00006dc0: 206f 6e20 7468 6520 636c 6173 7320 6174   on the class at
-00006dd0: 7472 6962 7574 650a 2020 2020 2020 2020  tribute.        
-00006de0: 6966 2063 6c61 7373 5f76 616c 7565 2e73  if class_value.s
-00006df0: 7461 7274 7377 6974 6828 2273 6563 7469  tartswith("secti
-00006e00: 6f6e 2229 3a0a 2020 2020 2020 2020 2020  on"):.          
-00006e10: 2020 6c65 7665 6c20 3d20 310a 2020 2020    level = 1.    
-00006e20: 2020 2020 656c 6966 2063 6c61 7373 5f76      elif class_v
-00006e30: 616c 7565 2e73 7461 7274 7377 6974 6828  alue.startswith(
-00006e40: 2273 7562 5f73 6563 7469 6f6e 2229 3a0a  "sub_section"):.
-00006e50: 2020 2020 2020 2020 2020 2020 6c65 7665              leve
-00006e60: 6c20 3d20 320a 2020 2020 2020 2020 656c  l = 2.        el
-00006e70: 6966 2063 6c61 7373 5f76 616c 7565 2e73  if class_value.s
-00006e80: 7461 7274 7377 6974 6828 2273 7562 5f73  tartswith("sub_s
-00006e90: 7562 5f73 6563 7469 6f6e 2229 3a0a 2020  ub_section"):.  
-00006ea0: 2020 2020 2020 2020 2020 6c65 7665 6c20            level 
-00006eb0: 3d20 330a 2020 2020 2020 2020 656c 7365  = 3.        else
-00006ec0: 3a0a 2020 2020 2020 2020 2020 2020 6c65  :.            le
-00006ed0: 7665 6c20 3d20 4e6f 6e65 0a20 2020 2020  vel = None.     
-00006ee0: 2020 2020 2020 2023 2063 6f6e 7469 6e75         # continu
-00006ef0: 6520 2023 2053 6b69 7020 3c64 6976 3e20  e  # Skip <div> 
-00006f00: 656c 656d 656e 7473 2077 6974 686f 7574  elements without
-00006f10: 2074 6974 6c65 2063 6c61 7373 6573 0a20   title classes. 
-00006f20: 2020 2020 2020 2069 6620 6c65 7665 6c3a         if level:
-00006f30: 0a20 2020 2020 2020 2020 2020 2073 7461  .            sta
-00006f40: 636b 5f70 6172 656e 7420 3d20 7061 7265  ck_parent = pare
-00006f50: 6e74 735b 6c65 7665 6c20 2d20 315d 0a20  nts[level - 1]. 
-00006f60: 2020 2020 2020 2020 2020 2069 6620 7374             if st
-00006f70: 6163 6b5f 7061 7265 6e74 2069 7320 6e6f  ack_parent is no
-00006f80: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-00006f90: 2020 2020 2020 2020 6e65 775f 6469 7620          new_div 
-00006fa0: 3d20 4554 2e53 7562 456c 656d 656e 7428  = ET.SubElement(
-00006fb0: 7374 6163 6b5f 7061 7265 6e74 2c20 2264  stack_parent, "d
-00006fc0: 6976 2229 0a20 2020 2020 2020 2020 2020  iv").           
-00006fd0: 2020 2020 206e 6577 5f64 6976 2e61 7474       new_div.att
-00006fe0: 7269 625b 2274 6974 6c65 225d 203d 2074  rib["title"] = t
-00006ff0: 6578 745b 3a35 305d 0a20 2020 2020 2020  ext[:50].       
-00007000: 2020 2020 2020 2020 206e 6577 5f64 6976           new_div
-00007010: 2e61 7474 7269 625b 2273 7479 6c65 225d  .attrib["style"]
-00007020: 203d 2064 6976 5f73 7479 6c65 735b 6c65   = div_styles[le
-00007030: 7665 6c20 2d20 315d 0a0a 2020 2020 2020  vel - 1]..      
-00007040: 2020 2020 2020 2020 2020 7061 7265 6e74            parent
-00007050: 203d 206e 6577 5f64 6976 0a20 2020 2020   = new_div.     
-00007060: 2020 2020 2020 2020 2020 2070 6172 656e             paren
-00007070: 7473 5b6c 6576 656c 5d20 3d20 6e65 775f  ts[level] = new_
-00007080: 6469 760a 2020 2020 2020 2020 2020 2020  div.            
-00007090: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-000070a0: 2020 2020 2020 6c6f 6767 6572 2e69 6e66        logger.inf
-000070b0: 6f28 6622 6e6f 2070 6172 656e 7420 6f6e  o(f"no parent on
-000070c0: 2073 7461 636b 206c 6576 656c 207b 6c65   stack level {le
-000070d0: 7665 6c7d 2229 0a0a 0a0a 2020 2020 2020  vel}")....      
-000070e0: 2020 7061 7265 6e74 2e61 7070 656e 6428    parent.append(
-000070f0: 6469 7629 0a20 2020 2020 2020 2072 6574  div).        ret
-00007100: 7572 6e20 7061 7265 6e74 0a0a 2020 2020  urn parent..    
-00007110: 4063 6c61 7373 6d65 7468 6f64 0a20 2020  @classmethod.   
-00007120: 2064 6566 2073 6b69 705f 636f 6e74 656e   def skip_conten
-00007130: 7428 636c 732c 2074 6578 742c 2073 6b69  t(cls, text, ski
-00007140: 705f 7265 7329 3a0a 2020 2020 2020 2020  p_res):.        
-00007150: 666f 7220 736b 6970 5f72 6520 696e 2073  for skip_re in s
-00007160: 6b69 705f 7265 733a 0a20 2020 2020 2020  kip_res:.       
-00007170: 2020 2020 2069 6620 736b 6970 5f72 652e       if skip_re.
-00007180: 6d61 7463 6828 7465 7874 293a 0a20 2020  match(text):.   
-00007190: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-000071a0: 7572 6e20 5472 7565 0a20 2020 2020 2020  urn True.       
-000071b0: 2072 6574 7572 6e20 4661 6c73 650a 0a20   return False.. 
-000071c0: 2020 2064 6566 206d 6174 6368 5f72 6567     def match_reg
-000071d0: 6578 2864 6976 2c20 7265 6765 782c 2073  ex(div, regex, s
-000071e0: 6563 7469 6f6e 5f63 6c61 7373 2c20 7465  ection_class, te
-000071f0: 7874 293a 0a20 2020 2020 2020 2074 7279  xt):.        try
-00007200: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-00007210: 6720 3d20 7265 2e63 6f6d 7069 6c65 2872  g = re.compile(r
-00007220: 6567 6578 290a 2020 2020 2020 2020 6578  egex).        ex
-00007230: 6365 7074 2045 7863 6570 7469 6f6e 2061  cept Exception a
-00007240: 7320 653a 0a20 2020 2020 2020 2020 2020  s e:.           
-00007250: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
-00007260: 7228 6622 4241 4420 5245 4745 5820 7b72  r(f"BAD REGEX {r
-00007270: 6567 6578 7d20 6265 6361 7573 6520 7b65  egex} because {e
-00007280: 7d22 290a 2020 2020 2020 2020 6d61 7463  }").        matc
-00007290: 6820 3d20 7265 672e 6d61 7463 6828 7465  h = reg.match(te
-000072a0: 7874 290a 2020 2020 2020 2020 6966 206d  xt).        if m
-000072b0: 6174 6368 3a0a 2020 2020 2020 2020 2020  atch:.          
-000072c0: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
-000072d0: 2020 2020 2020 2069 6420 3d20 6d61 7463         id = matc
-000072e0: 682e 6772 6f75 7028 2769 6427 290a 2020  h.group('id').  
-000072f0: 2020 2020 2020 2020 2020 2020 2020 6469                di
-00007300: 762e 6174 7472 6962 5b22 7469 746c 6522  v.attrib["title"
-00007310: 5d20 3d20 6964 0a20 2020 2020 2020 2020  ] = id.         
-00007320: 2020 2065 7863 6570 7420 4578 6365 7074     except Except
-00007330: 696f 6e20 6173 2065 3a0a 2020 2020 2020  ion as e:.      
-00007340: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-00007350: 6622 6661 696c 6564 2074 6f20 6d61 7463  f"failed to matc
-00007360: 6820 6964 2069 6e20 7b72 6567 6578 7d22  h id in {regex}"
-00007370: 290a 2020 2020 2020 2020 2020 2020 6469  ).            di
-00007380: 762e 6174 7472 6962 5b22 636c 6173 7322  v.attrib["class"
-00007390: 5d20 3d20 7365 6374 696f 6e5f 636c 6173  ] = section_clas
-000073a0: 730a 0a0a 2020 2020 4063 6c61 7373 6d65  s...    @classme
-000073b0: 7468 6f64 0a20 2020 2064 6566 2061 6e6e  thod.    def ann
-000073c0: 6f74 6174 655f 7469 746c 655f 7365 6374  otate_title_sect
-000073d0: 696f 6e73 2863 6c73 2c20 6874 6d6c 5f65  ions(cls, html_e
-000073e0: 6c65 6d2c 2073 6563 7469 6f6e 5f72 6567  lem, section_reg
-000073f0: 6578 6573 3d4e 6f6e 6529 3a0a 2020 2020  exes=None):.    
-00007400: 2020 2020 6966 2073 6563 7469 6f6e 5f72      if section_r
-00007410: 6567 6578 6573 2069 7320 4e6f 6e65 3a0a  egexes is None:.
-00007420: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-00007430: 6520 5661 6c75 6545 7272 6f72 2822 6d75  e ValueError("mu
-00007440: 7374 2068 6176 6520 7365 6374 696f 6e5f  st have section_
-00007450: 7265 6765 7865 7320 6172 6775 6d65 6e74  regexes argument
-00007460: 2229 0a20 2020 2020 2020 2020 2020 2023  ").            #
-00007470: 2074 6869 7320 6f6e 6c79 2077 6f72 6b73   this only works
-00007480: 2066 6f72 2049 5043 4320 6472 6166 740a   for IPCC draft.
-00007490: 2020 2020 2020 2020 2020 2020 2320 7365              # se
-000074a0: 6374 696f 6e5f 7265 6765 7865 7320 3d20  ction_regexes = 
-000074b0: 5b0a 2020 2020 2020 2020 2020 2020 2320  [.            # 
-000074c0: 2020 2020 2822 7365 6374 696f 6e22 2c20      ("section", 
-000074d0: 2253 6563 7469 6f6e 5c73 2a28 3f50 3c69  "Section\s*(?P<i
-000074e0: 643e 5c64 293a 5c73 2b2e 2a22 292c 0a20  d>\d):\s+.*"),. 
-000074f0: 2020 2020 2020 2020 2020 2023 2020 2020             #    
-00007500: 2028 2273 7562 5f73 6563 7469 6f6e 222c   ("sub_section",
-00007510: 2022 283f 503c 6964 3e5c 642b 5c2e 5c64   "(?P<id>\d+\.\d
-00007520: 2b29 5c73 2e2a 2229 2c0a 2020 2020 2020  +)\s.*"),.      
-00007530: 2020 2020 2020 2320 2020 2020 2822 7375        #     ("su
-00007540: 625f 7375 625f 7365 6374 696f 6e22 2c20  b_sub_section", 
-00007550: 2228 3f50 3c69 643e 5c64 2b5c 2e5c 642b  "(?P<id>\d+\.\d+
-00007560: 5c2e 5c64 2b29 5c73 2e2a 2229 0a20 2020  \.\d+)\s.*").   
-00007570: 2020 2020 2020 2020 2023 205d 0a0a 2020           # ]..  
-00007580: 2020 2020 2020 626f 6479 203d 2048 746d        body = Htm
-00007590: 6c4c 6962 2e67 6574 5f62 6f64 7928 6874  lLib.get_body(ht
-000075a0: 6d6c 5f65 6c65 6d29 0a20 2020 2020 2020  ml_elem).       
-000075b0: 2066 6f72 2064 6976 2069 6e20 626f 6479   for div in body
-000075c0: 2e78 7061 7468 2822 2e2f 2f64 6976 2229  .xpath(".//div")
-000075d0: 3a0a 2020 2020 2020 2020 2020 2020 7465  :.            te
-000075e0: 7874 203d 2027 272e 6a6f 696e 2864 6976  xt = ''.join(div
-000075f0: 2e69 7465 7274 6578 7428 2929 0a0a 2020  .itertext())..  
-00007600: 2020 2020 2020 2020 2020 666f 7220 7365            for se
-00007610: 6374 696f 6e5f 7265 6765 7820 696e 2073  ction_regex in s
-00007620: 6563 7469 6f6e 5f72 6567 6578 6573 3a0a  ection_regexes:.
-00007630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007640: 7365 6374 696f 6e5f 636c 6173 7320 3d20  section_class = 
-00007650: 7365 6374 696f 6e5f 7265 6765 785b 305d  section_regex[0]
-00007660: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00007670: 2072 6567 6578 203d 204e 6f6e 6520 6966   regex = None if
-00007680: 206e 6f74 2073 6563 7469 6f6e 5f72 6567   not section_reg
-00007690: 6578 2065 6c73 6520 7365 6374 696f 6e5f  ex else section_
-000076a0: 7265 6765 785b 315d 0a20 2020 2020 2020  regex[1].       
-000076b0: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
-000076c0: 7265 6765 783a 0a20 2020 2020 2020 2020  regex:.         
-000076d0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-000076e0: 2866 224e 4f20 5245 4745 583a 2072 6567  (f"NO REGEX: reg
-000076f0: 6578 2069 6e20 7365 6374 696f 6e5f 7265  ex in section_re
-00007700: 6765 7820 7b73 6563 7469 6f6e 5f72 6567  gex {section_reg
-00007710: 6578 7d22 290a 2020 2020 2020 2020 2020  ex}").          
-00007720: 2020 2020 2020 2020 2020 636f 6e74 696e            contin
-00007730: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
-00007740: 2020 2063 6c73 2e6d 6174 6368 5f72 6567     cls.match_reg
-00007750: 6578 2864 6976 2c20 7265 6765 782c 2073  ex(div, regex, s
-00007760: 6563 7469 6f6e 5f63 6c61 7373 2c20 7465  ection_class, te
-00007770: 7874 290a 0a20 2020 2040 636c 6173 736d  xt)..    @classm
-00007780: 6574 686f 640a 2020 2020 6465 6620 636f  ethod.    def co
-00007790: 6c6c 6563 745f 666c 6f61 7473 5f74 6f5f  llect_floats_to_
-000077a0: 6261 636b 2863 6c73 2c20 6874 6d6c 5f65  back(cls, html_e
-000077b0: 6c65 6d29 3a0a 2020 2020 2020 2020 6261  lem):.        ba
-000077c0: 636b 203d 2048 746d 6c47 726f 7570 2e67  ck = HtmlGroup.g
-000077d0: 6574 5f62 6163 6b5f 6469 7628 6874 6d6c  et_back_div(html
-000077e0: 5f65 6c65 6d29 0a20 2020 2020 2020 2066  _elem).        f
-000077f0: 6c6f 6174 7320 3d20 6874 6d6c 5f65 6c65  loats = html_ele
-00007800: 6d2e 7870 6174 6828 222e 2f2f 6469 765b  m.xpath(".//div[
-00007810: 4063 6c61 7373 3d27 666c 6f61 7427 5d22  @class='float']"
-00007820: 290a 2020 2020 2020 2020 6c6f 6767 6572  ).        logger
-00007830: 2e64 6562 7567 2866 2266 6c6f 6174 7320  .debug(f"floats 
-00007840: 7b6c 656e 2866 6c6f 6174 7329 7d22 290a  {len(floats)}").
-00007850: 2020 2020 2020 2020 666f 7220 666c 6f61          for floa
-00007860: 7420 696e 2066 6c6f 6174 733a 0a20 2020  t in floats:.   
-00007870: 2020 2020 2020 2020 2062 6163 6b2e 6170           back.ap
-00007880: 7065 6e64 2866 6c6f 6174 290a 0a20 2020  pend(float)..   
-00007890: 2040 636c 6173 736d 6574 686f 640a 2020   @classmethod.  
-000078a0: 2020 6465 6620 6372 6561 7465 5f62 6163    def create_bac
-000078b0: 6b5f 6469 7628 636c 732c 2068 746d 6c5f  k_div(cls, html_
-000078c0: 656c 656d 293a 0a20 2020 2020 2020 2062  elem):.        b
-000078d0: 6163 6b20 3d20 4554 2e53 7562 456c 656d  ack = ET.SubElem
-000078e0: 656e 7428 4874 6d6c 4c69 622e 6765 745f  ent(HtmlLib.get_
-000078f0: 626f 6479 2868 746d 6c5f 656c 656d 292c  body(html_elem),
-00007900: 2022 6469 7622 290a 2020 2020 2020 2020   "div").        
-00007910: 6261 636b 2e61 7474 7269 625b 2263 6c61  back.attrib["cla
-00007920: 7373 225d 203d 2022 6261 636b 220a 2020  ss"] = "back".  
-00007930: 2020 2020 2020 6261 636b 2e61 7474 7269        back.attri
-00007940: 625b 2274 6974 6c65 225d 203d 2022 6261  b["title"] = "ba
-00007950: 636b 206d 6174 7465 7222 0a20 2020 2020  ck matter".     
-00007960: 2020 2062 6163 6b2e 6174 7472 6962 5b22     back.attrib["
-00007970: 7374 796c 6522 5d20 3d20 2262 6163 6b67  style"] = "backg
-00007980: 726f 756e 643a 2023 6666 6666 6464 3b20  round: #ffffdd; 
-00007990: 626f 7264 6572 3a20 736f 6c69 6420 7075  border: solid pu
-000079a0: 7270 6c65 2031 2e35 7078 3b20 6d61 7267  rple 1.5px; marg
-000079b0: 696e 3a20 3270 783b 220a 2020 2020 2020  in: 2px;".      
-000079c0: 2020 6261 636b 5f74 6974 6c65 203d 2045    back_title = E
-000079d0: 542e 5375 6245 6c65 6d65 6e74 2862 6163  T.SubElement(bac
-000079e0: 6b2c 2022 6469 7622 290a 2020 2020 2020  k, "div").      
-000079f0: 2020 6261 636b 5f74 6974 6c65 2e74 6578    back_title.tex
-00007a00: 7420 3d20 2242 6163 6b20 4d61 7474 6572  t = "Back Matter
-00007a10: 2c20 466f 6f74 6e6f 7465 732c 2046 6967  , Footnotes, Fig
-00007a20: 7572 6573 2c20 5461 626c 6573 2c20 426f  ures, Tables, Bo
-00007a30: 7865 7322 0a20 2020 2020 2020 2062 6163  xes".        bac
-00007a40: 6b5f 7469 746c 652e 6174 7472 6962 5b22  k_title.attrib["
-00007a50: 7374 796c 6522 5d20 3d20 2266 6f6e 742d  style"] = "font-
-00007a60: 7369 7a65 3a20 3230 7078 3b20 666f 6e74  size: 20px; font
-00007a70: 2d66 616d 696c 793a 2073 616e 7365 7269  -family: sanseri
-00007a80: 663b 220a 2020 2020 2020 2020 7265 7475  f;".        retu
-00007a90: 726e 2062 6163 6b0a 0a20 2020 2040 636c  rn back..    @cl
-00007aa0: 6173 736d 6574 686f 640a 2020 2020 6465  assmethod.    de
-00007ab0: 6620 6765 745f 6261 636b 5f64 6976 2863  f get_back_div(c
-00007ac0: 6c73 2c20 6874 6d6c 5f65 6c65 6d29 3a0a  ls, html_elem):.
-00007ad0: 2020 2020 2020 2020 2222 2267 6574 206f          """get o
-00007ae0: 7220 6372 6561 7465 2062 6f64 792f 6469  r create body/di
-00007af0: 765b 4063 6c61 7373 3d27 6261 636b 275d  v[@class='back']
-00007b00: 2222 220a 2020 2020 2020 2020 6261 636b  """.        back
-00007b10: 7320 3d20 4874 6d6c 4c69 622e 6765 745f  s = HtmlLib.get_
-00007b20: 626f 6479 2868 746d 6c5f 656c 656d 292e  body(html_elem).
-00007b30: 7870 6174 6828 222e 2f64 6976 5b63 6c61  xpath("./div[cla
-00007b40: 7373 3d27 6261 636b 275d 2229 0a20 2020  ss='back']").   
-00007b50: 2020 2020 2072 6574 7572 6e20 6261 636b       return back
-00007b60: 735b 305d 2069 6620 6c65 6e28 6261 636b  s[0] if len(back
-00007b70: 7329 203e 2030 2065 6c73 6520 4874 6d6c  s) > 0 else Html
-00007b80: 4772 6f75 702e 6372 6561 7465 5f62 6163  Group.create_bac
-00007b90: 6b5f 6469 7628 6874 6d6c 5f65 6c65 6d29  k_div(html_elem)
-00007ba0: 0a0a 2020 2020 4063 6c61 7373 6d65 7468  ..    @classmeth
-00007bb0: 6f64 0a20 2020 2064 6566 2063 7265 6174  od.    def creat
-00007bc0: 655f 6865 6164 5f73 7479 6c65 5f65 6c65  e_head_style_ele
-00007bd0: 6d28 636c 732c 206e 6577 5f68 746d 6c2c  m(cls, new_html,
-00007be0: 2074 6169 6c3d 225a 5a5a 2229 3a0a 2020   tail="ZZZ"):.  
-00007bf0: 2020 2020 2020 7374 796c 6520 3d20 4554        style = ET
-00007c00: 2e53 7562 456c 656d 656e 7428 4874 6d6c  .SubElement(Html
-00007c10: 4c69 622e 6765 745f 6865 6164 286e 6577  Lib.get_head(new
-00007c20: 5f68 746d 6c29 2c20 4353 5353 7479 6c65  _html), CSSStyle
-00007c30: 2e53 5459 4c45 290a 2020 2020 2020 2020  .STYLE).        
-00007c40: 6966 2074 6169 6c3a 0a20 2020 2020 2020  if tail:.       
-00007c50: 2020 2020 2073 7479 6c65 2e74 6169 6c20       style.tail 
-00007c60: 3d20 7461 696c 0a20 2020 2020 2020 2023  = tail.        #
-00007c70: 2062 6173 6963 2073 7479 6c69 6e67 2074   basic styling t
-00007c80: 6f20 7368 6f77 2064 6976 7320 616e 6420  o show divs and 
-00007c90: 7370 616e 730a 2020 2020 2020 2020 7374  spans.        st
-00007ca0: 796c 652e 7465 7874 203d 2022 2222 0a20  yle.text = """. 
-00007cb0: 2020 2020 2020 2064 6976 207b 626f 7264         div {bord
-00007cc0: 6572 3a20 7265 6420 736f 6c69 6420 3170  er: red solid 1p
-00007cd0: 783b 206d 6172 6769 6e3a 2031 7078 3b7d  x; margin: 1px;}
-00007ce0: 0a20 2020 2020 2020 2073 7061 6e20 7b62  .        span {b
-00007cf0: 6163 6b67 726f 756e 643a 2023 6565 6565  ackground: #eeee
-00007d00: 6565 3b20 6d61 7267 696e 3a20 3170 783b  ee; margin: 1px;
-00007d10: 7d0a 2020 2020 2020 2020 6469 762e 666c  }.        div.fl
-00007d20: 6f61 7420 7b62 6163 6b67 726f 756e 643a  oat {background:
-00007d30: 2023 6464 6666 6666 3b7d 0a20 2020 2020   #ddffff;}.     
-00007d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007d50: 2222 220a 2020 2020 2020 2020 7265 7475  """.        retu
-00007d60: 726e 2073 7479 6c65 0a0a 2020 2020 4063  rn style..    @c
-00007d70: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
-00007d80: 6566 2065 7874 7261 6374 5f66 6f6f 746e  ef extract_footn
-00007d90: 6f74 6573 5f74 6f5f 6261 636b 2863 6c73  otes_to_back(cls
-00007da0: 2c20 6874 6d6c 5f65 6c65 6d29 3a0a 2020  , html_elem):.  
-00007db0: 2020 2020 2020 4874 6d6c 5574 696c 2e65        HtmlUtil.e
-00007dc0: 7874 7261 6374 5f66 6f6f 746e 6f74 6573  xtract_footnotes
-00007dd0: 2868 746d 6c5f 656c 656d 2c20 2266 6f6e  (html_elem, "fon
-00007de0: 742d 7369 7a65 3a20 362e 3022 290a 0a20  t-size: 6.0").. 
-00007df0: 2020 2040 636c 6173 736d 6574 686f 640a     @classmethod.
-00007e00: 2020 2020 6465 6620 7265 6d6f 7665 5f65      def remove_e
-00007e10: 6d70 7479 5f64 6976 7328 636c 732c 2065  mpty_divs(cls, e
-00007e20: 6c65 6d29 3a0a 2020 2020 2020 2020 6469  lem):.        di
-00007e30: 7673 203d 2065 6c65 6d2e 7870 6174 6828  vs = elem.xpath(
-00007e40: 222e 2f2f 6469 7622 290a 2020 2020 2020  ".//div").      
-00007e50: 2020 666f 7220 6469 7620 696e 2064 6976    for div in div
-00007e60: 733a 0a20 2020 2020 2020 2020 2020 2074  s:.            t
-00007e70: 6578 7420 3d20 2727 2e6a 6f69 6e28 6469  ext = ''.join(di
-00007e80: 762e 6974 6572 7465 7874 2829 290a 2020  v.itertext()).  
-00007e90: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-00007ea0: 2074 6578 743a 0a20 2020 2020 2020 2020   text:.         
-00007eb0: 2020 2020 2020 2064 6976 2e67 6574 7061         div.getpa
-00007ec0: 7265 6e74 2829 2e72 656d 6f76 6528 6469  rent().remove(di
-00007ed0: 7629 0a0a 2020 2020 4063 6c61 7373 6d65  v)..    @classme
-00007ee0: 7468 6f64 0a20 2020 2064 6566 206a 6f69  thod.    def joi
-00007ef0: 6e5f 7370 6c69 745f 6469 7673 2863 6c73  n_split_divs(cls
-00007f00: 2c20 746f 705f 6469 7629 3a0a 2020 2020  , top_div):.    
-00007f10: 2020 2020 6469 7673 203d 2074 6f70 5f64      divs = top_d
-00007f20: 6976 2e78 7061 7468 2822 2e2f 2f64 6976  iv.xpath(".//div
-00007f30: 2229 0a20 2020 2020 2020 2066 6f72 2069  ").        for i
-00007f40: 2c20 6469 7620 696e 2065 6e75 6d65 7261  , div in enumera
-00007f50: 7465 2864 6976 7329 3a0a 2020 2020 2020  te(divs):.      
-00007f60: 2020 2020 2020 6966 2069 203e 2030 3a0a        if i > 0:.
-00007f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007f80: 6469 7630 203d 2064 6976 735b 6920 2d20  div0 = divs[i - 
-00007f90: 315d 0a20 2020 2020 2020 2020 2020 2020  1].             
-00007fa0: 2020 2073 7061 6e30 203d 2048 746d 6c47     span0 = HtmlG
-00007fb0: 726f 7570 2e67 6574 5f6c 6173 745f 7370  roup.get_last_sp
-00007fc0: 616e 2864 6976 3029 0a20 2020 2020 2020  an(div0).       
-00007fd0: 2020 2020 2020 2020 2073 7061 6e31 203d           span1 =
-00007fe0: 2048 746d 6c47 726f 7570 2e67 6574 5f66   HtmlGroup.get_f
-00007ff0: 6972 7374 5f73 7061 6e28 6469 7629 0a20  irst_span(div). 
-00008000: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00008010: 6620 7370 616e 3020 6973 206e 6f74 204e  f span0 is not N
-00008020: 6f6e 6520 616e 6420 7370 616e 3120 6973  one and span1 is
-00008030: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
-00008040: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00008050: 7479 6c65 3020 3d20 4353 5353 7479 6c65  tyle0 = CSSStyle
-00008060: 2e63 7265 6174 655f 6373 735f 7374 796c  .create_css_styl
-00008070: 655f 6672 6f6d 5f61 7474 7269 6275 7465  e_from_attribute
-00008080: 5f6f 665f 626f 6479 5f65 6c65 6d65 6e74  _of_body_element
-00008090: 2873 7061 6e30 290a 2020 2020 2020 2020  (span0).        
-000080a0: 2020 2020 2020 2020 2020 2020 7374 796c              styl
-000080b0: 6531 203d 2043 5353 5374 796c 652e 6372  e1 = CSSStyle.cr
-000080c0: 6561 7465 5f63 7373 5f73 7479 6c65 5f66  eate_css_style_f
-000080d0: 726f 6d5f 6174 7472 6962 7574 655f 6f66  rom_attribute_of
-000080e0: 5f62 6f64 795f 656c 656d 656e 7428 7370  _body_element(sp
-000080f0: 616e 3029 0a20 2020 2020 2020 2020 2020  an0).           
-00008100: 2020 2020 2020 2020 2069 6620 7374 796c           if styl
-00008110: 6530 203d 3d20 7374 796c 6531 3a0a 2020  e0 == style1:.  
-00008120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008130: 2020 2020 2020 6966 2073 7061 6e31 2069        if span1 i
-00008140: 7320 6e6f 7420 4e6f 6e65 2061 6e64 206c  s not None and l
-00008150: 656e 2873 7061 6e31 2e74 6578 7429 203e  en(span1.text) >
-00008160: 2030 2061 6e64 2073 7061 6e31 2e74 6578   0 and span1.tex
-00008170: 745b 305d 2e69 736c 6f77 6572 2829 3a0a  t[0].islower():.
-00008180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008190: 2020 2020 2020 2020 2020 2020 2320 7072              # pr
-000081a0: 696e 7428 6622 206a 6f69 6e65 6420 7365  int(f" joined se
-000081b0: 636f 6e64 5f73 7061 6e20 7b73 7061 6e31  cond_span {span1
-000081c0: 2e74 6578 747d 2229 0a20 2020 2020 2020  .text}").       
-000081d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000081e0: 2020 2020 2048 746d 6c55 7469 6c2e 6a6f       HtmlUtil.jo
-000081f0: 696e 5f73 7061 6e73 5f69 6e5f 7361 6d65  in_spans_in_same
-00008200: 5f64 6976 2873 7061 6e30 2c20 7370 616e  _div(span0, span
-00008210: 3129 0a20 2020 2020 2020 2020 2020 2020  1).             
-00008220: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00008230: 6f72 2073 7061 6e20 696e 2064 6976 2e78  or span in div.x
-00008240: 7061 7468 2822 2e2f 7370 616e 2229 3a0a  path("./span"):.
-00008250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004d40: 7072 696e 7428 6622 2069 643a 207b 6964  print(f" id: {id
+00004d50: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
+00004d60: 2020 2020 2020 2020 6272 6561 6b0a 2020          break.  
+00004d70: 2020 2020 2020 2020 2020 2020 2020 656c                el
+00004d80: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00004d90: 2020 2020 2020 2020 6966 2064 6562 7567          if debug
+00004da0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00004db0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+00004dc0: 6622 6d6f 7665 6420 666f 6c6c 6f77 6572  f"moved follower
+00004dd0: 207b 666f 6c6c 6f77 6572 7d20 746f 207b   {follower} to {
+00004de0: 636f 6e74 6169 6e65 725f 6469 762e 6174  container_div.at
+00004df0: 7472 6962 2e67 6574 2827 7469 746c 6527  trib.get('title'
+00004e00: 297d 2229 0a20 2020 2020 2020 2020 2020  )}").           
+00004e10: 2020 2020 2020 2020 2063 6f6e 7461 696e           contain
+00004e20: 6572 5f64 6976 2e61 7070 656e 6428 666f  er_div.append(fo
+00004e30: 6c6c 6f77 6572 290a 0a20 2020 2020 2020  llower)..       
+00004e40: 2022 2222 4927 6d20 776f 726b 696e 6720   """I'm working 
+00004e50: 7769 7468 206c 786d 6c20 696e 2050 7974  with lxml in Pyt
+00004e60: 686f 6e20 616e 6420 7769 7368 2074 6f20  hon and wish to 
+00004e70: 6772 6f75 7020 6120 666c 6174 2073 6574  group a flat set
+00004e80: 206f 6620 3c64 6976 3e20 656c 656d 656e   of <div> elemen
+00004e90: 7473 2069 6e74 6f20 6120 7472 6565 2062  ts into a tree b
+00004ea0: 6173 6564 206f 6e20 7468 6569 7220 636c  ased on their cl
+00004eb0: 6173 7320 6174 7472 6962 7574 6573 0a49  ass attributes.I
+00004ec0: 2068 6176 6520 6120 7365 7420 6f66 2073   have a set of s
+00004ed0: 6563 7469 6f6e 7320 3c64 6976 3e20 7468  ections <div> th
+00004ee0: 6174 2061 7265 2061 6c6c 2063 6869 6c64  at are all child
+00004ef0: 7265 6e20 6f66 203c 626f 6479 3e20 7768  ren of <body> wh
+00004f00: 6963 6820 6d75 7374 2062 6520 6172 7261  ich must be arra
+00004f10: 6e67 6564 2069 6e20 6120 7472 6565 2073  nged in a tree s
+00004f20: 7472 7563 7475 7265 2e20 536f 6d65 206f  tructure. Some o
+00004f30: 6620 7468 6520 6469 7673 2063 6f6e 7461  f the divs conta
+00004f40: 696e 206a 7573 7420 6120 7469 746c 652d  in just a title-
+00004f50: 7374 7269 6e67 2028 7469 746c 652d 6469  string (title-di
+00004f60: 7673 2920 696e 6469 6361 7469 6e67 2074  vs) indicating t
+00004f70: 6865 206c 6576 656c 2069 6e20 7472 6565  he level in tree
+00004f80: 3b20 7468 6973 2069 7320 696e 6469 6361  ; this is indica
+00004f90: 7465 6420 6279 2061 2063 6c61 7373 2061  ted by a class a
+00004fa0: 7474 7269 6275 7465 206f 6620 2273 6563  ttribute of "sec
+00004fb0: 7469 6f6e 222c 2022 7375 625f 7365 6374  tion", "sub_sect
+00004fc0: 696f 6e22 2c20 2273 7562 5f73 7562 5f73  ion", "sub_sub_s
+00004fd0: 6563 7469 6f6e 222c 2065 7463 2e20 416e  ection", etc. An
+00004fe0: 7920 6469 7673 2066 6f6c 6c6f 7769 6e67  y divs following
+00004ff0: 2074 6974 6c65 2d64 6976 7320 6265 6c6f   title-divs belo
+00005000: 6e67 2074 6f20 7468 6520 7361 6d65 206c  ng to the same l
+00005010: 6576 656c 2c20 756e 7469 6c20 6120 666f  evel, until a fo
+00005020: 6c6c 6f77 696e 6720 7469 746c 652d 6469  llowing title-di
+00005030: 7620 6973 2072 6561 6368 6564 2e20 506c  v is reached. Pl
+00005040: 6561 7365 2063 7265 6174 6520 636f 6465  ease create code
+00005050: 2074 6861 743a 0a2a 2063 7265 6174 6573   that:.* creates
+00005060: 2061 206e 6577 2068 6965 7261 7263 6879   a new hierarchy
+00005070: 206f 6620 6469 7673 2072 6570 7265 7365   of divs represe
+00005080: 6e74 696e 6720 7468 6520 7472 6565 2073  nting the tree s
+00005090: 7472 7563 7475 7265 0a2a 2061 6464 7320  tructure.* adds 
+000050a0: 7468 6520 7469 746c 652d 6469 7673 2061  the title-divs a
+000050b0: 6e64 2074 6865 6972 2066 6f6c 6c6f 7769  nd their followi
+000050c0: 6e67 206e 6f6e 2d74 6974 6c65 2d64 6976  ng non-title-div
+000050d0: 7320 746f 2074 6865 2061 7070 726f 7072  s to the appropr
+000050e0: 6961 7465 2070 6f73 6974 696f 6e20 696e  iate position in
+000050f0: 2074 6865 2068 6965 7261 7263 6879 2e0a   the hierarchy..
+00005100: 0a48 6572 6520 6973 2061 2074 7970 6963  .Here is a typic
+00005110: 616c 2069 6e70 7574 3a0a 0a3c 6874 6d6c  al input:..<html
+00005120: 3e0a 2020 3c68 6561 643e 2e2e 2e3c 2f68  >.  <head>...</h
+00005130: 6561 643e 0a20 203c 626f 6479 3e0a 2020  ead>.  <body>.  
+00005140: 2020 3c64 6976 2063 6c61 7373 3d22 7365    <div class="se
+00005150: 6374 696f 6e5f 7469 746c 6522 3e53 6563  ction_title">Sec
+00005160: 7469 6f6e 2031 3c2f 6469 763e 0a20 2020  tion 1</div>.   
+00005170: 203c 6469 763e 7374 7566 6620 613c 2f64   <div>stuff a</d
+00005180: 6976 3e0a 2020 2020 3c64 6976 2063 6c61  iv>.    <div cla
+00005190: 7373 3d22 7375 6273 6563 7469 6f6e 5f74  ss="subsection_t
+000051a0: 6974 6c65 223e 5365 6374 696f 6e20 312e  itle">Section 1.
+000051b0: 313c 2f64 6976 3e0a 2020 2020 3c64 6976  1</div>.    <div
+000051c0: 3e73 7475 6666 2062 3c2f 6469 763e 0a20  >stuff b</div>. 
+000051d0: 2020 203c 6469 763e 7374 7566 6620 6278     <div>stuff bx
+000051e0: 3c2f 6469 763e 0a20 2020 203c 6469 7620  </div>.    <div 
+000051f0: 636c 6173 733d 2273 7562 7375 6273 6563  class="subsubsec
+00005200: 7469 6f6e 5f74 6974 6c65 223e 5365 6374  tion_title">Sect
+00005210: 696f 6e20 312e 312e 313c 2f64 6976 3e0a  ion 1.1.1</div>.
+00005220: 2020 2020 3c64 6976 3e73 7475 6666 207a      <div>stuff z
+00005230: 3c2f 6469 763e 0a20 2020 203c 6469 763e  </div>.    <div>
+00005240: 7374 7566 6620 7a7a 3c2f 6469 763e 0a20  stuff zz</div>. 
+00005250: 2020 203c 6469 7620 636c 6173 733d 2273     <div class="s
+00005260: 7562 7375 6273 6563 7469 6f6e 5f74 6974  ubsubsection_tit
+00005270: 6c65 223e 5365 6374 696f 6e20 312e 312e  le">Section 1.1.
+00005280: 323c 2f64 6976 3e0a 2020 2020 3c64 6976  2</div>.    <div
+00005290: 3e73 7475 6666 2078 3c2f 6469 763e 0a20  >stuff x</div>. 
+000052a0: 2020 203c 6469 763e 7374 7566 6620 7878     <div>stuff xx
+000052b0: 3c2f 6469 763e 0a20 2020 203c 6469 763e  </div>.    <div>
+000052c0: 7374 7566 6620 7878 783c 2f64 6976 3e0a  stuff xxx</div>.
+000052d0: 2020 2020 3c64 6976 2063 6c61 7373 3d22      <div class="
+000052e0: 7375 6273 6563 7469 6f6e 5f74 6974 6c65  subsection_title
+000052f0: 223e 5365 6374 696f 6e20 312e 323c 2f64  ">Section 1.2</d
+00005300: 6976 3e0a 2020 3c2f 626f 6479 3e0a 3c2f  iv>.  </body>.</
+00005310: 6874 6d6c 3e0a 0a20 2020 616e 6420 6465  html>..   and de
+00005320: 7369 7265 6420 6f75 7470 7574 0a3c 6874  sired output.<ht
+00005330: 6d6c 3e0a 2020 3c68 6561 643e 2e2e 2e3c  ml>.  <head>...<
+00005340: 2f68 6561 643e 0a20 203c 626f 6479 3e0a  /head>.  <body>.
+00005350: 2020 2020 3c64 6976 2063 6c61 7373 3d22      <div class="
+00005360: 7365 6374 696f 6e22 3e0a 2020 2020 2020  section">.      
+00005370: 3c64 6976 2063 6c61 7373 3d22 7365 6374  <div class="sect
+00005380: 696f 6e5f 7469 746c 6522 3e53 6563 7469  ion_title">Secti
+00005390: 6f6e 2031 3c2f 6469 763e 0a20 2020 2020  on 1</div>.     
+000053a0: 203c 6469 763e 7374 7566 6620 613c 2f64   <div>stuff a</d
+000053b0: 6976 3e0a 0920 203c 6469 7620 636c 6173  iv>..  <div clas
+000053c0: 733d 2273 7562 7365 6374 696f 6e22 3e0a  s="subsection">.
+000053d0: 2020 2020 2020 2020 3c64 6976 2063 6c61          <div cla
+000053e0: 7373 3d22 7375 6273 6563 7469 6f6e 5f74  ss="subsection_t
+000053f0: 6974 6c65 223e 5365 6374 696f 6e20 312e  itle">Section 1.
+00005400: 313c 2f64 6976 3e0a 2020 2020 2020 2020  1</div>.        
+00005410: 3c64 6976 3e73 7475 6666 2062 3c2f 6469  <div>stuff b</di
+00005420: 763e 0a20 2020 2020 2020 203c 6469 763e  v>.        <div>
+00005430: 7374 7566 6620 6278 3c2f 6469 763e 0a09  stuff bx</div>..
+00005440: 093c 6469 7620 636c 6173 733d 2273 7562  .<div class="sub
+00005450: 7375 6273 6563 7469 6f6e 223e 0a20 2020  subsection">.   
+00005460: 2020 2020 2020 203c 6469 7620 636c 6173         <div clas
+00005470: 733d 2273 7562 7375 6273 6563 7469 6f6e  s="subsubsection
+00005480: 5f74 6974 6c65 223e 5365 6374 696f 6e20  _title">Section 
+00005490: 312e 312e 313c 2f64 6976 3e0a 2020 2020  1.1.1</div>.    
+000054a0: 2020 2020 2020 3c64 6976 3e73 7475 6666        <div>stuff
+000054b0: 207a 3c2f 6469 763e 0a20 2020 2020 2020   z</div>.       
+000054c0: 2020 203c 6469 763e 7374 7566 6620 7a7a     <div>stuff zz
+000054d0: 3c2f 6469 763e 0a09 093c 2f64 6976 3e0a  </div>...</div>.
+000054e0: 0909 3c64 6976 2063 6c61 7373 3d22 7375  ..<div class="su
+000054f0: 6273 7562 7365 6374 696f 6e22 3e0a 2020  bsubsection">.  
+00005500: 2020 2020 2020 2020 3c64 6976 2063 6c61          <div cla
+00005510: 7373 3d22 7375 6273 7562 7365 6374 696f  ss="subsubsectio
+00005520: 6e5f 7469 746c 6522 3e53 6563 7469 6f6e  n_title">Section
+00005530: 2031 2e31 2e32 3c2f 6469 763e 0a20 2020   1.1.2</div>.   
+00005540: 2020 2020 2020 203c 6469 763e 7374 7566         <div>stuf
+00005550: 6620 783c 2f64 6976 3e0a 2020 2020 2020  f x</div>.      
+00005560: 2020 2020 3c64 6976 3e73 7475 6666 2078      <div>stuff x
+00005570: 783c 2f64 6976 3e0a 2020 2020 2020 2020  x</div>.        
+00005580: 2020 3c64 6976 3e73 7475 6666 2078 7878    <div>stuff xxx
+00005590: 3c2f 6469 763e 0a09 093c 2f64 6976 3e0a  </div>...</div>.
+000055a0: 0920 203c 2f64 6976 3e0a 093c 2f64 6976  .  </div>..</div
+000055b0: 3e0a 2020 2020 3c64 6976 2063 6c61 7373  >.    <div class
+000055c0: 3d22 7365 6374 696f 6e22 3e0a 2020 2020  ="section">.    
+000055d0: 2020 3c64 6976 2063 6c61 7373 3d22 7365    <div class="se
+000055e0: 6374 696f 6e5f 7469 746c 6522 3e53 6563  ction_title">Sec
+000055f0: 7469 6f6e 2032 3c2f 6469 763e 0a09 3c2f  tion 2</div>..</
+00005600: 6469 763e 0a20 203c 2f62 6f64 793e 0a3c  div>.  </body>.<
+00005610: 2f68 746d 6c3e 0a0a 4368 6174 4750 540a  /html>..ChatGPT.
+00005620: 546f 2061 6368 6965 7665 2074 6865 2064  To achieve the d
+00005630: 6573 6972 6564 206f 7574 7075 742c 2079  esired output, y
+00005640: 6f75 2063 616e 2075 7365 2074 6865 2066  ou can use the f
+00005650: 6f6c 6c6f 7769 6e67 2050 7974 686f 6e20  ollowing Python 
+00005660: 636f 6465 2074 6f20 7061 7273 6520 7468  code to parse th
+00005670: 6520 4854 4d4c 2075 7369 6e67 206c 786d  e HTML using lxm
+00005680: 6c20 616e 6420 7265 7374 7275 6374 7572  l and restructur
+00005690: 6520 7468 6520 3c64 6976 3e20 656c 656d  e the <div> elem
+000056a0: 656e 7473 2069 6e74 6f20 6120 7472 6565  ents into a tree
+000056b0: 2073 7472 7563 7475 7265 2062 6173 6564   structure based
+000056c0: 206f 6e20 7468 6569 7220 636c 6173 7320   on their class 
+000056d0: 6174 7472 6962 7574 6573 3a0a 0a70 7974  attributes:..pyt
+000056e0: 686f 6e0a 436f 7079 2063 6f64 650a 6672  hon.Copy code.fr
+000056f0: 6f6d 206c 786d 6c20 696d 706f 7274 2065  om lxml import e
+00005700: 7472 6565 2023 2069 6e20 636f 6d6d 656e  tree # in commen
+00005710: 740a 0a64 6566 2067 726f 7570 5f64 6976  t..def group_div
+00005720: 735f 696e 746f 5f74 7265 6528 6874 6d6c  s_into_tree(html
+00005730: 293a 0a20 2020 2023 2050 6172 7365 2074  ):.    # Parse t
+00005740: 6865 2048 544d 4c0a 2020 2020 7472 6565  he HTML.    tree
+00005750: 203d 2065 7472 6565 2e48 544d 4c28 6874   = etree.HTML(ht
+00005760: 6d6c 290a 0a20 2020 2023 2046 696e 6420  ml)..    # Find 
+00005770: 616c 6c20 3c64 6976 3e20 656c 656d 656e  all <div> elemen
+00005780: 7473 2077 6974 6869 6e20 7468 6520 3c62  ts within the <b
+00005790: 6f64 793e 2074 6167 0a20 2020 2064 6976  ody> tag.    div
+000057a0: 5f65 6c65 6d65 6e74 7320 3d20 7472 6565  _elements = tree
+000057b0: 2e78 7061 7468 2822 2f2f 626f 6479 2f64  .xpath("//body/d
+000057c0: 6976 2229 0a0a 2020 2020 2320 4372 6561  iv")..    # Crea
+000057d0: 7465 2061 206e 6577 2072 6f6f 7420 3c64  te a new root <d
+000057e0: 6976 3e20 656c 656d 656e 7420 746f 2068  iv> element to h
+000057f0: 6f6c 6420 7468 6520 7472 6565 2073 7472  old the tree str
+00005800: 7563 7475 7265 0a20 2020 2072 6f6f 7420  ucture.    root 
+00005810: 3d20 6574 7265 652e 456c 656d 656e 7428  = etree.Element(
+00005820: 2264 6976 2229 0a0a 2020 2020 2320 496e  "div")..    # In
+00005830: 6974 6961 6c69 7a65 2076 6172 6961 626c  itialize variabl
+00005840: 6573 2074 6f20 6b65 6570 2074 7261 636b  es to keep track
+00005850: 206f 6620 7468 6520 6375 7272 656e 7420   of the current 
+00005860: 7061 7265 6e74 203c 6469 763e 2061 6e64  parent <div> and
+00005870: 2069 7473 206c 6576 656c 0a20 2020 2063   its level.    c
+00005880: 7572 7265 6e74 5f70 6172 656e 7420 3d20  urrent_parent = 
+00005890: 726f 6f74 0a20 2020 2063 7572 7265 6e74  root.    current
+000058a0: 5f6c 6576 656c 203d 2030 0a0a 2020 2020  _level = 0..    
+000058b0: 666f 7220 6469 7620 696e 2064 6976 5f65  for div in div_e
+000058c0: 6c65 6d65 6e74 733a 0a20 2020 2020 2020  lements:.       
+000058d0: 2023 2043 6865 636b 2069 6620 7468 6520   # Check if the 
+000058e0: 6375 7272 656e 7420 3c64 6976 3e20 6861  current <div> ha
+000058f0: 7320 6120 636c 6173 7320 6174 7472 6962  s a class attrib
+00005900: 7574 650a 2020 2020 2020 2020 6966 2022  ute.        if "
+00005910: 636c 6173 7322 2069 6e20 6469 762e 6174  class" in div.at
+00005920: 7472 6962 3a0a 2020 2020 2020 2020 2020  trib:.          
+00005930: 2020 636c 6173 735f 7661 6c75 6520 3d20    class_value = 
+00005940: 6469 762e 6174 7472 6962 5b22 636c 6173  div.attrib["clas
+00005950: 7322 5d0a 0a20 2020 2020 2020 2020 2020  s"]..           
+00005960: 2023 2044 6574 6572 6d69 6e65 2074 6865   # Determine the
+00005970: 206c 6576 656c 2062 6173 6564 206f 6e20   level based on 
+00005980: 7468 6520 636c 6173 7320 6174 7472 6962  the class attrib
+00005990: 7574 650a 2020 2020 2020 2020 2020 2020  ute.            
+000059a0: 6966 2063 6c61 7373 5f76 616c 7565 2e73  if class_value.s
+000059b0: 7461 7274 7377 6974 6828 2273 6563 7469  tartswith("secti
+000059c0: 6f6e 5f74 6974 6c65 2229 3a0a 2020 2020  on_title"):.    
+000059d0: 2020 2020 2020 2020 2020 2020 6c65 7665              leve
+000059e0: 6c20 3d20 300a 2020 2020 2020 2020 2020  l = 0.          
+000059f0: 2020 656c 6966 2063 6c61 7373 5f76 616c    elif class_val
+00005a00: 7565 2e73 7461 7274 7377 6974 6828 2273  ue.startswith("s
+00005a10: 7562 7365 6374 696f 6e5f 7469 746c 6522  ubsection_title"
+00005a20: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00005a30: 2020 206c 6576 656c 203d 2031 0a20 2020     level = 1.   
+00005a40: 2020 2020 2020 2020 2065 6c69 6620 636c           elif cl
+00005a50: 6173 735f 7661 6c75 652e 7374 6172 7473  ass_value.starts
+00005a60: 7769 7468 2822 7375 6273 7562 7365 6374  with("subsubsect
+00005a70: 696f 6e5f 7469 746c 6522 293a 0a20 2020  ion_title"):.   
+00005a80: 2020 2020 2020 2020 2020 2020 206c 6576               lev
+00005a90: 656c 203d 2032 0a20 2020 2020 2020 2020  el = 2.         
+00005aa0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00005ab0: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
+00005ac0: 6520 2023 2053 6b69 7020 3c64 6976 3e20  e  # Skip <div> 
+00005ad0: 656c 656d 656e 7473 2077 6974 686f 7574  elements without
+00005ae0: 2074 6974 6c65 2063 6c61 7373 6573 0a0a   title classes..
+00005af0: 2020 2020 2020 2020 2020 2020 2320 4372              # Cr
+00005b00: 6561 7465 2061 206e 6577 203c 6469 763e  eate a new <div>
+00005b10: 2065 6c65 6d65 6e74 2061 6e64 2073 6574   element and set
+00005b20: 2069 7473 2063 6c61 7373 2061 7474 7269   its class attri
+00005b30: 6275 7465 0a20 2020 2020 2020 2020 2020  bute.           
+00005b40: 206e 6577 5f64 6976 203d 2065 7472 6565   new_div = etree
+00005b50: 2e53 7562 456c 656d 656e 7428 6375 7272  .SubElement(curr
+00005b60: 656e 745f 7061 7265 6e74 2c20 2264 6976  ent_parent, "div
+00005b70: 2229 0a20 2020 2020 2020 2020 2020 206e  ").            n
+00005b80: 6577 5f64 6976 2e61 7474 7269 625b 2263  ew_div.attrib["c
+00005b90: 6c61 7373 225d 203d 2022 7365 6374 696f  lass"] = "sectio
+00005ba0: 6e22 202a 2028 6c65 7665 6c20 2b20 3129  n" * (level + 1)
+00005bb0: 2020 2320 4164 6420 6170 7072 6f70 7269    # Add appropri
+00005bc0: 6174 6520 636c 6173 7320 6261 7365 6420  ate class based 
+00005bd0: 6f6e 206c 6576 656c 0a0a 2020 2020 2020  on level..      
+00005be0: 2020 2020 2020 2320 4164 6420 7468 6520        # Add the 
+00005bf0: 6375 7272 656e 7420 3c64 6976 3e20 746f  current <div> to
+00005c00: 2074 6865 206e 6577 203c 6469 763e 2065   the new <div> e
+00005c10: 6c65 6d65 6e74 0a20 2020 2020 2020 2020  lement.         
+00005c20: 2020 206e 6577 5f64 6976 2e61 7070 656e     new_div.appen
+00005c30: 6428 6469 7629 0a0a 2020 2020 2020 2020  d(div)..        
+00005c40: 2020 2020 2320 5570 6461 7465 2074 6865      # Update the
+00005c50: 2063 7572 7265 6e74 2070 6172 656e 7420   current parent 
+00005c60: 616e 6420 6c65 7665 6c0a 2020 2020 2020  and level.      
+00005c70: 2020 2020 2020 6375 7272 656e 745f 7061        current_pa
+00005c80: 7265 6e74 203d 206e 6577 5f64 6976 0a20  rent = new_div. 
+00005c90: 2020 2020 2020 2020 2020 2063 7572 7265             curre
+00005ca0: 6e74 5f6c 6576 656c 203d 206c 6576 656c  nt_level = level
+00005cb0: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+00005cc0: 2020 2020 2020 2020 2020 2023 2041 6464             # Add
+00005cd0: 206e 6f6e 2d74 6974 6c65 203c 6469 763e   non-title <div>
+00005ce0: 2065 6c65 6d65 6e74 7320 746f 2074 6865   elements to the
+00005cf0: 2063 7572 7265 6e74 2070 6172 656e 740a   current parent.
+00005d00: 2020 2020 2020 2020 2020 2020 6375 7272              curr
+00005d10: 656e 745f 7061 7265 6e74 2e61 7070 656e  ent_parent.appen
+00005d20: 6428 6469 7629 0a0a 2020 2020 2320 5265  d(div)..    # Re
+00005d30: 7475 726e 2074 6865 206d 6f64 6966 6965  turn the modifie
+00005d40: 6420 4854 4d4c 2061 7320 6120 7374 7269  d HTML as a stri
+00005d50: 6e67 0a20 2020 2072 6574 7572 6e20 6574  ng.    return et
+00005d60: 7265 652e 746f 7374 7269 6e67 2874 7265  ree.tostring(tre
+00005d70: 652c 2065 6e63 6f64 696e 673d 2275 6e69  e, encoding="uni
+00005d80: 636f 6465 2229 0a0a 2320 4578 616d 706c  code")..# Exampl
+00005d90: 6520 7573 6167 650a 6874 6d6c 203d 2027  e usage.html = '
+00005da0: 2727 0a3c 6874 6d6c 3e0a 2020 3c68 6561  ''.<html>.  <hea
+00005db0: 643e 2e2e 2e3c 2f68 6561 643e 0a20 203c  d>...</head>.  <
+00005dc0: 626f 6479 3e0a 2020 2020 3c64 6976 2063  body>.    <div c
+00005dd0: 6c61 7373 3d22 7365 6374 696f 6e5f 7469  lass="section_ti
+00005de0: 746c 6522 3e53 6563 7469 6f6e 2031 3c2f  tle">Section 1</
+00005df0: 6469 763e 0a20 2020 203c 6469 763e 7374  div>.    <div>st
+00005e00: 7566 6620 613c 2f64 6976 3e0a 2020 2020  uff a</div>.    
+00005e10: 3c64 6976 2063 6c61 7373 3d22 7375 6273  <div class="subs
+00005e20: 6563 7469 6f6e 5f74 6974 6c65 223e 5365  ection_title">Se
+00005e30: 6374 696f 6e20 312e 313c 2f64 6976 3e0a  ction 1.1</div>.
+00005e40: 2020 2020 3c64 6976 3e73 7475 6666 2062      <div>stuff b
+00005e50: 3c2f 6469 763e 0a20 2020 203c 6469 763e  </div>.    <div>
+00005e60: 7374 7566 6620 6278 3c2f 6469 763e 0a20  stuff bx</div>. 
+00005e70: 2020 203c 6469 7620 636c 6173 733d 2273     <div class="s
+00005e80: 7562 7375 6273 6563 7469 6f6e 5f74 6974  ubsubsection_tit
+00005e90: 6c65 223e 5365 6374 696f 6e20 312e 312e  le">Section 1.1.
+00005ea0: 313c 2f64 6976 3e0a 2020 2020 3c64 6976  1</div>.    <div
+00005eb0: 3e73 7475 6666 207a 3c2f 6469 763e 0a20  >stuff z</div>. 
+00005ec0: 2020 203c 6469 763e 7374 7566 6620 7a7a     <div>stuff zz
+00005ed0: 3c2f 6469 763e 0a20 2020 203c 6469 7620  </div>.    <div 
+00005ee0: 636c 6173 733d 2273 7562 7375 6273 6563  class="subsubsec
+00005ef0: 7469 6f6e 5f74 6974 6c65 223e 5365 6374  tion_title">Sect
+00005f00: 696f 6e20 312e 312e 323c 2f64 6976 3e0a  ion 1.1.2</div>.
+00005f10: 2020 2020 3c64 6976 3e73 7475 6666 2078      <div>stuff x
+00005f20: 3c2f 6469 763e 0a20 2020 203c 6469 763e  </div>.    <div>
+00005f30: 7374 7566 6620 7878 3c2f 6469 763e 0a20  stuff xx</div>. 
+00005f40: 2020 203c 6469 763e 7374 7566 6620 7878     <div>stuff xx
+00005f50: 783c 2f64 6976 3e0a 2020 2020 3c64 6976  x</div>.    <div
+00005f60: 2063 6c61 7373 3d22 7375 6273 6563 7469   class="subsecti
+00005f70: 6f6e 5f74 6974 6c65 223e 5365 6374 696f  on_title">Sectio
+00005f80: 6e20 312e 323c 2f64 6976 3e0a 2020 3c2f  n 1.2</div>.  </
+00005f90: 626f 6479 3e0a 3c2f 6874 6d6c 3e0a 2727  body>.</html>.''
+00005fa0: 270a 0a6f 7574 7075 745f 6874 6d6c 203d  '..output_html =
+00005fb0: 2067 726f 7570 5f64 6976 735f 696e 746f   group_divs_into
+00005fc0: 5f74 7265 6528 6874 6d6c 290a 7072 696e  _tree(html).prin
+00005fd0: 7428 6f75 7470 7574 5f68 746d 6c29 0a54  t(output_html).T
+00005fe0: 6865 2063 6f64 6520 7769 6c6c 2070 6172  he code will par
+00005ff0: 7365 2074 6865 2048 544d 4c2c 2069 6465  se the HTML, ide
+00006000: 6e74 6966 7920 7468 6520 7469 746c 6520  ntify the title 
+00006010: 3c64 6976 3e20 656c 656d 656e 7473 2062  <div> elements b
+00006020: 6173 6564 206f 6e20 7468 6569 7220 636c  ased on their cl
+00006030: 6173 7320 6174 7472 6962 7574 6573 2c20  ass attributes, 
+00006040: 6372 6561 7465 2061 206e 6577 2068 6965  create a new hie
+00006050: 7261 7263 6879 206f 6620 3c64 6976 3e20  rarchy of <div> 
+00006060: 656c 656d 656e 7473 2c20 616e 6420 6164  elements, and ad
+00006070: 6420 7468 6520 7469 746c 6520 3c64 6976  d the title <div
+00006080: 3e73 2061 6e64 2074 6865 6972 2066 6f6c  >s and their fol
+00006090: 6c6f 7769 6e67 206e 6f6e 2d74 6974 6c65  lowing non-title
+000060a0: 203c 6469 763e 7320 746f 2074 6865 2061   <div>s to the a
+000060b0: 7070 726f 7072 6961 7465 2070 6f73 6974  ppropriate posit
+000060c0: 696f 6e20 696e 2074 6865 2068 6965 7261  ion in the hiera
+000060d0: 7263 6879 2e20 4669 6e61 6c6c 792c 2069  rchy. Finally, i
+000060e0: 7420 7769 6c6c 2072 6574 7572 6e20 7468  t will return th
+000060f0: 6520 6d6f 6469 6669 6564 2048 544d 4c20  e modified HTML 
+00006100: 6173 2061 2073 7472 696e 672e 0a0a 506c  as a string...Pl
+00006110: 6561 7365 206e 6f74 6520 7468 6174 2074  ease note that t
+00006120: 6865 2063 6f64 6520 6173 7375 6d65 7320  he code assumes 
+00006130: 7468 6174 2074 6865 2063 6c61 7373 2076  that the class v
+00006140: 616c 7565 7320 666f 7220 7468 6520 7469  alues for the ti
+00006150: 746c 6520 3c64 6976 3e20 656c 656d 656e  tle <div> elemen
+00006160: 7473 2066 6f6c 6c6f 7720 7468 6520 7061  ts follow the pa
+00006170: 7474 6572 6e20 2273 6563 7469 6f6e 5f74  ttern "section_t
+00006180: 6974 6c65 222c 2022 7375 6273 6563 7469  itle", "subsecti
+00006190: 6f6e 5f74 6974 6c65 222c 2022 7375 6273  on_title", "subs
+000061a0: 7562 7365 6374 696f 6e5f 7469 746c 6522  ubsection_title"
+000061b0: 2c20 616e 6420 736f 206f 6e2e 2049 6620  , and so on. If 
+000061c0: 796f 7572 2061 6374 7561 6c20 636c 6173  your actual clas
+000061d0: 7320 6e61 6d65 7320 6469 6666 6572 2c20  s names differ, 
+000061e0: 796f 7520 6d61 7920 6e65 6564 2074 6f20  you may need to 
+000061f0: 6d6f 6469 6679 2074 6865 2063 6f64 6520  modify the code 
+00006200: 6163 636f 7264 696e 676c 792e 0a0a 0a0a  accordingly.....
+00006210: 0a0a 5265 6765 6e65 7261 7465 2072 6573  ..Regenerate res
+00006220: 706f 6e73 650a 5365 6e64 2061 206d 6573  ponse.Send a mes
+00006230: 7361 6765 2e0a 0a46 7265 6520 5265 7365  sage...Free Rese
+00006240: 6172 6368 2050 7265 7669 6577 2e20 4368  arch Preview. Ch
+00006250: 6174 4750 5420 6d61 7920 7072 6f64 7563  atGPT may produc
+00006260: 6520 696e 6163 6375 7261 7465 2069 6e66  e inaccurate inf
+00006270: 6f72 6d61 7469 6f6e 2061 626f 7574 2070  ormation about p
+00006280: 656f 706c 652c 2070 6c61 6365 732c 206f  eople, places, o
+00006290: 7220 6661 6374 732e 2043 6861 7447 5054  r facts. ChatGPT
+000062a0: 204d 6179 2031 3220 5665 7273 696f 6e22   May 12 Version"
+000062b0: 2222 0a0a 2020 2020 4063 6c61 7373 6d65  ""..    @classme
+000062c0: 7468 6f64 0a20 2020 2064 6566 2067 726f  thod.    def gro
+000062d0: 7570 5f64 6976 735f 696e 746f 5f74 7265  up_divs_into_tre
+000062e0: 6528 636c 732c 2062 6f64 7929 3a0a 2020  e(cls, body):.  
+000062f0: 2020 2020 2020 2222 2250 6574 6572 204d        """Peter M
+00006300: 7572 7261 792d 5275 7374 2222 220a 2020  urray-Rust""".  
+00006310: 2020 2020 2020 454e 4420 3d20 225b 454e        END = "[EN
+00006320: 4422 0a20 2020 2020 2020 2053 5441 5254  D".        START
+00006330: 203d 2022 5b53 5441 5254 220a 2020 2020   = "[START".    
+00006340: 2020 2020 464c 4f41 5420 3d20 2266 6c6f      FLOAT = "flo
+00006350: 6174 220a 0a20 2020 2020 2020 2073 6b69  at"..        ski
+00006360: 705f 7265 7320 3d20 5b0a 2020 2020 2020  p_res = [.      
+00006370: 2020 2020 2020 7265 2e63 6f6d 7069 6c65        re.compile
+00006380: 2822 4164 6f70 7465 642e 2a22 292c 0a20  ("Adopted.*"),. 
+00006390: 2020 2020 2020 2020 2020 2072 652e 636f             re.co
+000063a0: 6d70 696c 6528 2253 7562 6a65 6374 2074  mpile("Subject t
+000063b0: 6f20 436f 7079 2229 0a20 2020 2020 2020  o Copy").       
+000063c0: 205d 0a0a 2020 2020 2020 2020 6469 765f   ]..        div_
+000063d0: 7374 796c 6573 203d 205b 2262 6f72 6465  styles = ["borde
+000063e0: 723a 2023 3838 3838 6666 2073 6f6c 6964  r: #8888ff solid
+000063f0: 2033 7078 3b22 2c0a 2020 2020 2020 2020   3px;",.        
+00006400: 2020 2020 2020 2020 2020 2020 2020 2262                "b
+00006410: 6f72 6465 723a 2063 7961 6e20 6461 7368  order: cyan dash
+00006420: 6564 2032 2e35 7078 3b22 2c0a 2020 2020  ed 2.5px;",.    
+00006430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006440: 2020 2262 6f72 6465 723a 2067 7265 656e    "border: green
+00006450: 2064 6173 6865 6420 3270 783b 222c 0a20   dashed 2px;",. 
+00006460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006470: 2020 2020 205d 0a0a 2020 2020 2020 2020       ]..        
+00006480: 2320 4669 6e64 2061 6c6c 203c 6469 763e  # Find all <div>
+00006490: 2065 6c65 6d65 6e74 7320 7769 7468 696e   elements within
+000064a0: 2074 6865 203c 626f 6479 3e20 7461 670a   the <body> tag.
+000064b0: 2020 2020 2020 2020 6469 765f 656c 656d          div_elem
+000064c0: 656e 7473 203d 2062 6f64 792e 7870 6174  ents = body.xpat
+000064d0: 6828 222e 2f64 6976 2229 0a0a 2020 2020  h("./div")..    
+000064e0: 2020 2020 2320 4372 6561 7465 2061 206e      # Create a n
+000064f0: 6577 2072 6f6f 7420 3c64 6976 3e20 656c  ew root <div> el
+00006500: 656d 656e 7420 746f 2068 6f6c 6420 7468  ement to hold th
+00006510: 6520 7472 6565 2073 7472 7563 7475 7265  e tree structure
+00006520: 0a20 2020 2020 2020 2072 6f6f 745f 6469  .        root_di
+00006530: 7620 3d20 4554 2e45 6c65 6d65 6e74 2822  v = ET.Element("
+00006540: 6469 7622 290a 2020 2020 2020 2020 726f  div").        ro
+00006550: 6f74 5f64 6976 2e61 7474 7269 625b 2263  ot_div.attrib["c
+00006560: 6c61 7373 225d 203d 2022 726f 6f74 220a  lass"] = "root".
+00006570: 2020 2020 2020 2020 726f 6f74 5f64 6976          root_div
+00006580: 2e61 7474 7269 625b 2274 6974 6c65 225d  .attrib["title"]
+00006590: 203d 2022 726f 6f74 220a 0a20 2020 2020   = "root"..     
+000065a0: 2020 2023 2049 6e69 7469 616c 697a 6520     # Initialize 
+000065b0: 7661 7269 6162 6c65 7320 746f 206b 6565  variables to kee
+000065c0: 7020 7472 6163 6b20 6f66 2074 6865 2063  p track of the c
+000065d0: 7572 7265 6e74 2070 6172 656e 7420 3c64  urrent parent <d
+000065e0: 6976 3e20 616e 6420 6974 7320 6c65 7665  iv> and its leve
+000065f0: 6c0a 2020 2020 2020 2020 6375 7272 656e  l.        curren
+00006600: 745f 7061 7265 6e74 203d 2072 6f6f 745f  t_parent = root_
+00006610: 6469 760a 2020 2020 2020 2020 6375 7272  div.        curr
+00006620: 656e 745f 6c65 7665 6c20 3d20 300a 0a20  ent_level = 0.. 
+00006630: 2020 2020 2020 2070 6172 656e 7473 203d         parents =
+00006640: 205b 726f 6f74 5f64 6976 2c20 4e6f 6e65   [root_div, None
+00006650: 2c20 4e6f 6e65 2c20 4e6f 6e65 5d0a 2020  , None, None].  
+00006660: 2020 2020 2020 7374 6172 745f 656e 6473        start_ends
+00006670: 203d 205b 5d0a 2020 2020 2020 2020 7061   = [].        pa
+00006680: 7265 6e74 203d 2072 6f6f 745f 6469 760a  rent = root_div.
+00006690: 2020 2020 2020 2020 666f 7220 6469 7620          for div 
+000066a0: 696e 2064 6976 5f65 6c65 6d65 6e74 733a  in div_elements:
+000066b0: 0a20 2020 2020 2020 2020 2020 2023 2043  .            # C
+000066c0: 6865 636b 2069 6620 7468 6520 6375 7272  heck if the curr
+000066d0: 656e 7420 3c64 6976 3e20 6861 7320 6120  ent <div> has a 
+000066e0: 636c 6173 7320 6174 7472 6962 7574 650a  class attribute.
+000066f0: 2020 2020 2020 2020 2020 2020 7465 7874              text
+00006700: 203d 2027 272e 6a6f 696e 2864 6976 2e69   = ''.join(div.i
+00006710: 7465 7274 6578 7428 2929 0a20 2020 2020  tertext()).     
+00006720: 2020 2020 2020 2069 6620 2263 6c61 7373         if "class
+00006730: 2220 696e 2064 6976 2e61 7474 7269 623a  " in div.attrib:
+00006740: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00006750: 2070 6172 656e 7420 3d20 636c 732e 7072   parent = cls.pr
+00006760: 6f63 6573 735f 636c 6173 735f 6469 7628  ocess_class_div(
+00006770: 6469 762c 2064 6976 5f73 7479 6c65 732c  div, div_styles,
+00006780: 2070 6172 656e 742c 2070 6172 656e 7473   parent, parents
+00006790: 2c20 7465 7874 290a 0a20 2020 2020 2020  , text)..       
+000067a0: 2020 2020 2065 6c69 6620 7465 7874 2e73       elif text.s
+000067b0: 7461 7274 7377 6974 6828 5354 4152 5429  tartswith(START)
+000067c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000067d0: 2020 7061 7265 6e74 203d 2063 6c73 2e70    parent = cls.p
+000067e0: 726f 6365 7373 5f69 7063 635f 7374 6172  rocess_ipcc_star
+000067f0: 7428 464c 4f41 542c 2053 5441 5254 2c20  t(FLOAT, START, 
+00006800: 7061 7265 6e74 2c20 7374 6172 745f 656e  parent, start_en
+00006810: 6473 2c20 7465 7874 290a 0a20 2020 2020  ds, text)..     
+00006820: 2020 2020 2020 2065 6c69 6620 7465 7874         elif text
+00006830: 2e73 7461 7274 7377 6974 6828 454e 4429  .startswith(END)
+00006840: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00006850: 2020 7061 7265 6e74 203d 2063 6c73 2e70    parent = cls.p
+00006860: 726f 6365 7373 5f69 7063 635f 656e 6428  rocess_ipcc_end(
+00006870: 454e 442c 2053 5441 5254 2c20 7061 7265  END, START, pare
+00006880: 6e74 2c20 7374 6172 745f 656e 6473 2c20  nt, start_ends, 
+00006890: 7465 7874 290a 0a20 2020 2020 2020 2020  text)..         
+000068a0: 2020 2065 6c69 6620 636c 732e 736b 6970     elif cls.skip
+000068b0: 5f63 6f6e 7465 6e74 2874 6578 742c 2073  _content(text, s
+000068c0: 6b69 705f 7265 7329 3a0a 2020 2020 2020  kip_res):.      
+000068d0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+000068e0: 6622 736b 6970 7065 6420 7b74 6578 745b  f"skipped {text[
+000068f0: 3a35 305d 7d22 290a 0a20 2020 2020 2020  :50]}")..       
+00006900: 2020 2020 2023 2065 6c69 6620 636c 732e       # elif cls.
+00006910: 6973 5f66 6f6f 746e 6f74 6528 7370 616e  is_footnote(span
+00006920: 293a 0a20 2020 2020 2020 2020 2020 2023  ):.            #
+00006930: 2020 2020 2070 7269 6e74 2866 2273 6b69       print(f"ski
+00006940: 7070 6564 207b 7465 7874 5b3a 3530 5d7d  pped {text[:50]}
+00006950: 2229 0a20 2020 2020 2020 2020 2020 2023  ").            #
+00006960: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+00006970: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00006980: 2020 2070 6172 656e 742e 6170 7065 6e64     parent.append
+00006990: 2864 6976 290a 0a20 2020 2020 2020 2072  (div)..        r
+000069a0: 6574 7572 6e20 726f 6f74 5f64 6976 0a0a  eturn root_div..
+000069b0: 2020 2020 4063 6c61 7373 6d65 7468 6f64      @classmethod
+000069c0: 0a20 2020 2064 6566 2070 726f 6365 7373  .    def process
+000069d0: 5f69 7063 635f 656e 6428 636c 732c 2045  _ipcc_end(cls, E
+000069e0: 4e44 2c20 5354 4152 542c 2070 6172 656e  ND, START, paren
+000069f0: 742c 2073 7461 7274 5f65 6e64 732c 2074  t, start_ends, t
+00006a00: 6578 7429 3a0a 2020 2020 2020 2020 656e  ext):.        en
+00006a10: 645f 7374 7220 3d20 7465 7874 5b6c 656e  d_str = text[len
+00006a20: 2845 4e44 293a 5d0a 2020 2020 2020 2020  (END):].        
+00006a30: 6966 2073 7461 7274 5f65 6e64 733a 0a20  if start_ends:. 
+00006a40: 2020 2020 2020 2020 2020 2023 2073 6f6d             # som
+00006a50: 6574 696d 6573 2075 6e62 616c 616e 6365  etimes unbalance
+00006a60: 6420 696e 2064 6f63 756d 656e 740a 2020  d in document.  
+00006a70: 2020 2020 2020 2020 2020 7374 6172 745f            start_
+00006a80: 7374 7220 3d20 7374 6172 745f 656e 6473  str = start_ends
+00006a90: 2e70 6f70 2829 0a20 2020 2020 2020 2020  .pop().         
+00006aa0: 2020 2069 6620 7374 6172 745f 7374 7220     if start_str 
+00006ab0: 213d 2065 6e64 5f73 7472 3a0a 2020 2020  != end_str:.    
+00006ac0: 2020 2020 2020 2020 2020 2020 6c6f 6767              logg
+00006ad0: 6572 2e77 6172 6e69 6e67 2866 2275 6e62  er.warning(f"unb
+00006ae0: 616c 616e 6365 643a 207b 5354 4152 5420  alanced: {START 
+00006af0: 2b20 7374 6172 745f 7374 727d 2061 6e64  + start_str} and
+00006b00: 207b 454e 4420 2b20 656e 645f 7374 727d   {END + end_str}
+00006b10: 2229 0a20 2020 2020 2020 2020 2020 2065  ").            e
+00006b20: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00006b30: 2020 2020 2070 6172 656e 7420 3d20 7061       parent = pa
+00006b40: 7265 6e74 2e67 6574 7061 7265 6e74 2829  rent.getparent()
+00006b50: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00006b60: 7061 7265 6e74 0a0a 2020 2020 4063 6c61  parent..    @cla
+00006b70: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
+00006b80: 2070 726f 6365 7373 5f69 7063 635f 7374   process_ipcc_st
+00006b90: 6172 7428 636c 732c 2046 4c4f 4154 2c20  art(cls, FLOAT, 
+00006ba0: 5354 4152 542c 2070 6172 656e 742c 2073  START, parent, s
+00006bb0: 7461 7274 5f65 6e64 732c 2074 6578 7429  tart_ends, text)
+00006bc0: 3a0a 2020 2020 2020 2020 7374 6172 745f  :.        start_
+00006bd0: 7374 7220 3d20 7465 7874 5b6c 656e 2853  str = text[len(S
+00006be0: 5441 5254 293a 5d0a 2020 2020 2020 2020  TART):].        
+00006bf0: 7374 6172 745f 656e 6473 2e61 7070 656e  start_ends.appen
+00006c00: 6428 7374 6172 745f 7374 7229 0a20 2020  d(start_str).   
+00006c10: 2020 2020 2073 7562 5f64 6976 203d 2045       sub_div = E
+00006c20: 542e 5375 6245 6c65 6d65 6e74 2870 6172  T.SubElement(par
+00006c30: 656e 742c 2022 6469 7622 290a 2020 2020  ent, "div").    
+00006c40: 2020 2020 7375 625f 6469 762e 6174 7472      sub_div.attr
+00006c50: 6962 5b22 636c 6173 7322 5d20 3d20 464c  ib["class"] = FL
+00006c60: 4f41 540a 2020 2020 2020 2020 7375 625f  OAT.        sub_
+00006c70: 6469 762e 6174 7472 6962 5b22 7469 746c  div.attrib["titl
+00006c80: 6522 5d20 3d20 7465 7874 0a20 2020 2020  e"] = text.     
+00006c90: 2020 2073 7562 5f64 6976 2e61 7474 7269     sub_div.attri
+00006ca0: 625b 2273 7479 6c65 225d 203d 2022 626f  b["style"] = "bo
+00006cb0: 7264 6572 3a20 6461 7368 6564 2062 6c75  rder: dashed blu
+00006cc0: 6520 3370 783b 220a 2020 2020 2020 2020  e 3px;".        
+00006cd0: 7061 7265 6e74 203d 2073 7562 5f64 6976  parent = sub_div
+00006ce0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00006cf0: 7061 7265 6e74 0a0a 2020 2020 4063 6c61  parent..    @cla
+00006d00: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
+00006d10: 2070 726f 6365 7373 5f63 6c61 7373 5f64   process_class_d
+00006d20: 6976 2863 6c73 2c20 6469 762c 2064 6976  iv(cls, div, div
+00006d30: 5f73 7479 6c65 732c 2070 6172 656e 742c  _styles, parent,
+00006d40: 2070 6172 656e 7473 2c20 7465 7874 293a   parents, text):
+00006d50: 0a20 2020 2020 2020 2063 6c61 7373 5f76  .        class_v
+00006d60: 616c 7565 203d 2064 6976 2e61 7474 7269  alue = div.attri
+00006d70: 625b 2263 6c61 7373 225d 0a20 2020 2020  b["class"].     
+00006d80: 2020 2023 2044 6574 6572 6d69 6e65 2074     # Determine t
+00006d90: 6865 206c 6576 656c 2062 6173 6564 206f  he level based o
+00006da0: 6e20 7468 6520 636c 6173 7320 6174 7472  n the class attr
+00006db0: 6962 7574 650a 2020 2020 2020 2020 6966  ibute.        if
+00006dc0: 2063 6c61 7373 5f76 616c 7565 2e73 7461   class_value.sta
+00006dd0: 7274 7377 6974 6828 2273 6563 7469 6f6e  rtswith("section
+00006de0: 2229 3a0a 2020 2020 2020 2020 2020 2020  "):.            
+00006df0: 6c65 7665 6c20 3d20 310a 2020 2020 2020  level = 1.      
+00006e00: 2020 656c 6966 2063 6c61 7373 5f76 616c    elif class_val
+00006e10: 7565 2e73 7461 7274 7377 6974 6828 2273  ue.startswith("s
+00006e20: 7562 5f73 6563 7469 6f6e 2229 3a0a 2020  ub_section"):.  
+00006e30: 2020 2020 2020 2020 2020 6c65 7665 6c20            level 
+00006e40: 3d20 320a 2020 2020 2020 2020 656c 6966  = 2.        elif
+00006e50: 2063 6c61 7373 5f76 616c 7565 2e73 7461   class_value.sta
+00006e60: 7274 7377 6974 6828 2273 7562 5f73 7562  rtswith("sub_sub
+00006e70: 5f73 6563 7469 6f6e 2229 3a0a 2020 2020  _section"):.    
+00006e80: 2020 2020 2020 2020 6c65 7665 6c20 3d20          level = 
+00006e90: 330a 2020 2020 2020 2020 656c 7365 3a0a  3.        else:.
+00006ea0: 2020 2020 2020 2020 2020 2020 6c65 7665              leve
+00006eb0: 6c20 3d20 4e6f 6e65 0a20 2020 2020 2020  l = None.       
+00006ec0: 2020 2020 2023 2063 6f6e 7469 6e75 6520       # continue 
+00006ed0: 2023 2053 6b69 7020 3c64 6976 3e20 656c   # Skip <div> el
+00006ee0: 656d 656e 7473 2077 6974 686f 7574 2074  ements without t
+00006ef0: 6974 6c65 2063 6c61 7373 6573 0a20 2020  itle classes.   
+00006f00: 2020 2020 2069 6620 6c65 7665 6c3a 0a20       if level:. 
+00006f10: 2020 2020 2020 2020 2020 2073 7461 636b             stack
+00006f20: 5f70 6172 656e 7420 3d20 7061 7265 6e74  _parent = parent
+00006f30: 735b 6c65 7665 6c20 2d20 315d 0a20 2020  s[level - 1].   
+00006f40: 2020 2020 2020 2020 2069 6620 7374 6163           if stac
+00006f50: 6b5f 7061 7265 6e74 2069 7320 6e6f 7420  k_parent is not 
+00006f60: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00006f70: 2020 2020 2020 6e65 775f 6469 7620 3d20        new_div = 
+00006f80: 4554 2e53 7562 456c 656d 656e 7428 7374  ET.SubElement(st
+00006f90: 6163 6b5f 7061 7265 6e74 2c20 2264 6976  ack_parent, "div
+00006fa0: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+00006fb0: 2020 206e 6577 5f64 6976 2e61 7474 7269     new_div.attri
+00006fc0: 625b 2274 6974 6c65 225d 203d 2074 6578  b["title"] = tex
+00006fd0: 745b 3a35 305d 0a20 2020 2020 2020 2020  t[:50].         
+00006fe0: 2020 2020 2020 206e 6577 5f64 6976 2e61         new_div.a
+00006ff0: 7474 7269 625b 2273 7479 6c65 225d 203d  ttrib["style"] =
+00007000: 2064 6976 5f73 7479 6c65 735b 6c65 7665   div_styles[leve
+00007010: 6c20 2d20 315d 0a0a 2020 2020 2020 2020  l - 1]..        
+00007020: 2020 2020 2020 2020 7061 7265 6e74 203d          parent =
+00007030: 206e 6577 5f64 6976 0a20 2020 2020 2020   new_div.       
+00007040: 2020 2020 2020 2020 2070 6172 656e 7473           parents
+00007050: 5b6c 6576 656c 5d20 3d20 6e65 775f 6469  [level] = new_di
+00007060: 760a 2020 2020 2020 2020 2020 2020 656c  v.            el
+00007070: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00007080: 2020 2020 6c6f 6767 6572 2e69 6e66 6f28      logger.info(
+00007090: 6622 6e6f 2070 6172 656e 7420 6f6e 2073  f"no parent on s
+000070a0: 7461 636b 206c 6576 656c 207b 6c65 7665  tack level {leve
+000070b0: 6c7d 2229 0a0a 2020 2020 2020 2020 7061  l}")..        pa
+000070c0: 7265 6e74 2e61 7070 656e 6428 6469 7629  rent.append(div)
+000070d0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+000070e0: 7061 7265 6e74 0a0a 2020 2020 4063 6c61  parent..    @cla
+000070f0: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
+00007100: 2073 6b69 705f 636f 6e74 656e 7428 636c   skip_content(cl
+00007110: 732c 2074 6578 742c 2073 6b69 705f 7265  s, text, skip_re
+00007120: 7329 3a0a 2020 2020 2020 2020 666f 7220  s):.        for 
+00007130: 736b 6970 5f72 6520 696e 2073 6b69 705f  skip_re in skip_
+00007140: 7265 733a 0a20 2020 2020 2020 2020 2020  res:.           
+00007150: 2069 6620 736b 6970 5f72 652e 6d61 7463   if skip_re.matc
+00007160: 6828 7465 7874 293a 0a20 2020 2020 2020  h(text):.       
+00007170: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00007180: 5472 7565 0a20 2020 2020 2020 2072 6574  True.        ret
+00007190: 7572 6e20 4661 6c73 650a 0a20 2020 2064  urn False..    d
+000071a0: 6566 206d 6174 6368 5f72 6567 6578 2864  ef match_regex(d
+000071b0: 6976 2c20 7265 6765 782c 2073 6563 7469  iv, regex, secti
+000071c0: 6f6e 5f63 6c61 7373 2c20 7465 7874 293a  on_class, text):
+000071d0: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
+000071e0: 2020 2020 2020 2020 2020 7265 6720 3d20            reg = 
+000071f0: 7265 2e63 6f6d 7069 6c65 2872 6567 6578  re.compile(regex
+00007200: 290a 2020 2020 2020 2020 6578 6365 7074  ).        except
+00007210: 2045 7863 6570 7469 6f6e 2061 7320 653a   Exception as e:
+00007220: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+00007230: 7365 2056 616c 7565 4572 726f 7228 6622  se ValueError(f"
+00007240: 4241 4420 5245 4745 5820 7b72 6567 6578  BAD REGEX {regex
+00007250: 7d20 6265 6361 7573 6520 7b65 7d22 290a  } because {e}").
+00007260: 2020 2020 2020 2020 6d61 7463 6820 3d20          match = 
+00007270: 7265 672e 6d61 7463 6828 7465 7874 290a  reg.match(text).
+00007280: 2020 2020 2020 2020 6966 206d 6174 6368          if match
+00007290: 3a0a 2020 2020 2020 2020 2020 2020 7472  :.            tr
+000072a0: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
+000072b0: 2020 2069 6420 3d20 6d61 7463 682e 6772     id = match.gr
+000072c0: 6f75 7028 2769 6427 290a 2020 2020 2020  oup('id').      
+000072d0: 2020 2020 2020 2020 2020 6469 762e 6174            div.at
+000072e0: 7472 6962 5b22 7469 746c 6522 5d20 3d20  trib["title"] = 
+000072f0: 6964 0a20 2020 2020 2020 2020 2020 2065  id.            e
+00007300: 7863 6570 7420 4578 6365 7074 696f 6e20  xcept Exception 
+00007310: 6173 2065 3a0a 2020 2020 2020 2020 2020  as e:.          
+00007320: 2020 2020 2020 7072 696e 7428 6622 6661        print(f"fa
+00007330: 696c 6564 2074 6f20 6d61 7463 6820 6964  iled to match id
+00007340: 2069 6e20 7b72 6567 6578 7d22 290a 2020   in {regex}").  
+00007350: 2020 2020 2020 2020 2020 6469 762e 6174            div.at
+00007360: 7472 6962 5b22 636c 6173 7322 5d20 3d20  trib["class"] = 
+00007370: 7365 6374 696f 6e5f 636c 6173 730a 0a20  section_class.. 
+00007380: 2020 2040 636c 6173 736d 6574 686f 640a     @classmethod.
+00007390: 2020 2020 6465 6620 616e 6e6f 7461 7465      def annotate
+000073a0: 5f74 6974 6c65 5f73 6563 7469 6f6e 7328  _title_sections(
+000073b0: 636c 732c 2068 746d 6c5f 656c 656d 2c20  cls, html_elem, 
+000073c0: 7365 6374 696f 6e5f 7265 6765 7865 733d  section_regexes=
+000073d0: 4e6f 6e65 293a 0a20 2020 2020 2020 2069  None):.        i
+000073e0: 6620 7365 6374 696f 6e5f 7265 6765 7865  f section_regexe
+000073f0: 7320 6973 204e 6f6e 653a 0a20 2020 2020  s is None:.     
+00007400: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
+00007410: 7565 4572 726f 7228 226d 7573 7420 6861  ueError("must ha
+00007420: 7665 2073 6563 7469 6f6e 5f72 6567 6578  ve section_regex
+00007430: 6573 2061 7267 756d 656e 7422 290a 2020  es argument").  
+00007440: 2020 2020 2020 2020 2020 2320 7468 6973            # this
+00007450: 206f 6e6c 7920 776f 726b 7320 666f 7220   only works for 
+00007460: 4950 4343 2064 7261 6674 0a20 2020 2020  IPCC draft.     
+00007470: 2020 2020 2020 2023 2073 6563 7469 6f6e         # section
+00007480: 5f72 6567 6578 6573 203d 205b 0a20 2020  _regexes = [.   
+00007490: 2020 2020 2020 2020 2023 2020 2020 2028           #     (
+000074a0: 2273 6563 7469 6f6e 222c 2022 5365 6374  "section", "Sect
+000074b0: 696f 6e5c 732a 283f 503c 6964 3e5c 6429  ion\s*(?P<id>\d)
+000074c0: 3a5c 732b 2e2a 2229 2c0a 2020 2020 2020  :\s+.*"),.      
+000074d0: 2020 2020 2020 2320 2020 2020 2822 7375        #     ("su
+000074e0: 625f 7365 6374 696f 6e22 2c20 2228 3f50  b_section", "(?P
+000074f0: 3c69 643e 5c64 2b5c 2e5c 642b 295c 732e  <id>\d+\.\d+)\s.
+00007500: 2a22 292c 0a20 2020 2020 2020 2020 2020  *"),.           
+00007510: 2023 2020 2020 2028 2273 7562 5f73 7562   #     ("sub_sub
+00007520: 5f73 6563 7469 6f6e 222c 2022 283f 503c  _section", "(?P<
+00007530: 6964 3e5c 642b 5c2e 5c64 2b5c 2e5c 642b  id>\d+\.\d+\.\d+
+00007540: 295c 732e 2a22 290a 2020 2020 2020 2020  )\s.*").        
+00007550: 2020 2020 2320 5d0a 0a20 2020 2020 2020      # ]..       
+00007560: 2062 6f64 7920 3d20 4874 6d6c 4c69 622e   body = HtmlLib.
+00007570: 6765 745f 626f 6479 2868 746d 6c5f 656c  get_body(html_el
+00007580: 656d 290a 2020 2020 2020 2020 666f 7220  em).        for 
+00007590: 6469 7620 696e 2062 6f64 792e 7870 6174  div in body.xpat
+000075a0: 6828 222e 2f2f 6469 7622 293a 0a20 2020  h(".//div"):.   
+000075b0: 2020 2020 2020 2020 2074 6578 7420 3d20           text = 
+000075c0: 2727 2e6a 6f69 6e28 6469 762e 6974 6572  ''.join(div.iter
+000075d0: 7465 7874 2829 290a 0a20 2020 2020 2020  text())..       
+000075e0: 2020 2020 2066 6f72 2073 6563 7469 6f6e       for section
+000075f0: 5f72 6567 6578 2069 6e20 7365 6374 696f  _regex in sectio
+00007600: 6e5f 7265 6765 7865 733a 0a20 2020 2020  n_regexes:.     
+00007610: 2020 2020 2020 2020 2020 2073 6563 7469             secti
+00007620: 6f6e 5f63 6c61 7373 203d 2073 6563 7469  on_class = secti
+00007630: 6f6e 5f72 6567 6578 5b30 5d0a 2020 2020  on_regex[0].    
+00007640: 2020 2020 2020 2020 2020 2020 7265 6765              rege
+00007650: 7820 3d20 4e6f 6e65 2069 6620 6e6f 7420  x = None if not 
+00007660: 7365 6374 696f 6e5f 7265 6765 7820 656c  section_regex el
+00007670: 7365 2073 6563 7469 6f6e 5f72 6567 6578  se section_regex
+00007680: 5b31 5d0a 2020 2020 2020 2020 2020 2020  [1].            
+00007690: 2020 2020 6966 206e 6f74 2072 6567 6578      if not regex
+000076a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000076b0: 2020 2020 2020 7072 696e 7428 6622 4e4f        print(f"NO
+000076c0: 2052 4547 4558 3a20 7265 6765 7820 696e   REGEX: regex in
+000076d0: 2073 6563 7469 6f6e 5f72 6567 6578 207b   section_regex {
+000076e0: 7365 6374 696f 6e5f 7265 6765 787d 2229  section_regex}")
+000076f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00007700: 2020 2020 2063 6f6e 7469 6e75 650a 2020       continue.  
+00007710: 2020 2020 2020 2020 2020 2020 2020 636c                cl
+00007720: 732e 6d61 7463 685f 7265 6765 7828 6469  s.match_regex(di
+00007730: 762c 2072 6567 6578 2c20 7365 6374 696f  v, regex, sectio
+00007740: 6e5f 636c 6173 732c 2074 6578 7429 0a0a  n_class, text)..
+00007750: 2020 2020 4063 6c61 7373 6d65 7468 6f64      @classmethod
+00007760: 0a20 2020 2064 6566 2063 6f6c 6c65 6374  .    def collect
+00007770: 5f66 6c6f 6174 735f 746f 5f62 6163 6b28  _floats_to_back(
+00007780: 636c 732c 2068 746d 6c5f 656c 656d 293a  cls, html_elem):
+00007790: 0a20 2020 2020 2020 2062 6163 6b20 3d20  .        back = 
+000077a0: 4874 6d6c 4772 6f75 702e 6765 745f 6261  HtmlGroup.get_ba
+000077b0: 636b 5f64 6976 2868 746d 6c5f 656c 656d  ck_div(html_elem
+000077c0: 290a 2020 2020 2020 2020 666c 6f61 7473  ).        floats
+000077d0: 203d 2068 746d 6c5f 656c 656d 2e78 7061   = html_elem.xpa
+000077e0: 7468 2822 2e2f 2f64 6976 5b40 636c 6173  th(".//div[@clas
+000077f0: 733d 2766 6c6f 6174 275d 2229 0a20 2020  s='float']").   
+00007800: 2020 2020 206c 6f67 6765 722e 6465 6275       logger.debu
+00007810: 6728 6622 666c 6f61 7473 207b 6c65 6e28  g(f"floats {len(
+00007820: 666c 6f61 7473 297d 2229 0a20 2020 2020  floats)}").     
+00007830: 2020 2066 6f72 2066 6c6f 6174 2069 6e20     for float in 
+00007840: 666c 6f61 7473 3a0a 2020 2020 2020 2020  floats:.        
+00007850: 2020 2020 6261 636b 2e61 7070 656e 6428      back.append(
+00007860: 666c 6f61 7429 0a0a 2020 2020 4063 6c61  float)..    @cla
+00007870: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
+00007880: 2063 7265 6174 655f 6261 636b 5f64 6976   create_back_div
+00007890: 2863 6c73 2c20 6874 6d6c 5f65 6c65 6d29  (cls, html_elem)
+000078a0: 3a0a 2020 2020 2020 2020 6261 636b 203d  :.        back =
+000078b0: 2045 542e 5375 6245 6c65 6d65 6e74 2848   ET.SubElement(H
+000078c0: 746d 6c4c 6962 2e67 6574 5f62 6f64 7928  tmlLib.get_body(
+000078d0: 6874 6d6c 5f65 6c65 6d29 2c20 2264 6976  html_elem), "div
+000078e0: 2229 0a20 2020 2020 2020 2062 6163 6b2e  ").        back.
+000078f0: 6174 7472 6962 5b22 636c 6173 7322 5d20  attrib["class"] 
+00007900: 3d20 2262 6163 6b22 0a20 2020 2020 2020  = "back".       
+00007910: 2062 6163 6b2e 6174 7472 6962 5b22 7469   back.attrib["ti
+00007920: 746c 6522 5d20 3d20 2262 6163 6b20 6d61  tle"] = "back ma
+00007930: 7474 6572 220a 2020 2020 2020 2020 6261  tter".        ba
+00007940: 636b 2e61 7474 7269 625b 2273 7479 6c65  ck.attrib["style
+00007950: 225d 203d 2022 6261 636b 6772 6f75 6e64  "] = "background
+00007960: 3a20 2366 6666 6664 643b 2062 6f72 6465  : #ffffdd; borde
+00007970: 723a 2073 6f6c 6964 2070 7572 706c 6520  r: solid purple 
+00007980: 312e 3570 783b 206d 6172 6769 6e3a 2032  1.5px; margin: 2
+00007990: 7078 3b22 0a20 2020 2020 2020 2062 6163  px;".        bac
+000079a0: 6b5f 7469 746c 6520 3d20 4554 2e53 7562  k_title = ET.Sub
+000079b0: 456c 656d 656e 7428 6261 636b 2c20 2264  Element(back, "d
+000079c0: 6976 2229 0a20 2020 2020 2020 2062 6163  iv").        bac
+000079d0: 6b5f 7469 746c 652e 7465 7874 203d 2022  k_title.text = "
+000079e0: 4261 636b 204d 6174 7465 722c 2046 6f6f  Back Matter, Foo
+000079f0: 746e 6f74 6573 2c20 4669 6775 7265 732c  tnotes, Figures,
+00007a00: 2054 6162 6c65 732c 2042 6f78 6573 220a   Tables, Boxes".
+00007a10: 2020 2020 2020 2020 6261 636b 5f74 6974          back_tit
+00007a20: 6c65 2e61 7474 7269 625b 2273 7479 6c65  le.attrib["style
+00007a30: 225d 203d 2022 666f 6e74 2d73 697a 653a  "] = "font-size:
+00007a40: 2032 3070 783b 2066 6f6e 742d 6661 6d69   20px; font-fami
+00007a50: 6c79 3a20 7361 6e73 6572 6966 3b22 0a20  ly: sanserif;". 
+00007a60: 2020 2020 2020 2072 6574 7572 6e20 6261         return ba
+00007a70: 636b 0a0a 2020 2020 4063 6c61 7373 6d65  ck..    @classme
+00007a80: 7468 6f64 0a20 2020 2064 6566 2067 6574  thod.    def get
+00007a90: 5f62 6163 6b5f 6469 7628 636c 732c 2068  _back_div(cls, h
+00007aa0: 746d 6c5f 656c 656d 293a 0a20 2020 2020  tml_elem):.     
+00007ab0: 2020 2022 2222 6765 7420 6f72 2063 7265     """get or cre
+00007ac0: 6174 6520 626f 6479 2f64 6976 5b40 636c  ate body/div[@cl
+00007ad0: 6173 733d 2762 6163 6b27 5d22 2222 0a20  ass='back']""". 
+00007ae0: 2020 2020 2020 2062 6163 6b73 203d 2048         backs = H
+00007af0: 746d 6c4c 6962 2e67 6574 5f62 6f64 7928  tmlLib.get_body(
+00007b00: 6874 6d6c 5f65 6c65 6d29 2e78 7061 7468  html_elem).xpath
+00007b10: 2822 2e2f 6469 765b 636c 6173 733d 2762  ("./div[class='b
+00007b20: 6163 6b27 5d22 290a 2020 2020 2020 2020  ack']").        
+00007b30: 7265 7475 726e 2062 6163 6b73 5b30 5d20  return backs[0] 
+00007b40: 6966 206c 656e 2862 6163 6b73 2920 3e20  if len(backs) > 
+00007b50: 3020 656c 7365 2048 746d 6c47 726f 7570  0 else HtmlGroup
+00007b60: 2e63 7265 6174 655f 6261 636b 5f64 6976  .create_back_div
+00007b70: 2868 746d 6c5f 656c 656d 290a 0a20 2020  (html_elem)..   
+00007b80: 2040 636c 6173 736d 6574 686f 640a 2020   @classmethod.  
+00007b90: 2020 6465 6620 6372 6561 7465 5f68 6561    def create_hea
+00007ba0: 645f 7374 796c 655f 656c 656d 2863 6c73  d_style_elem(cls
+00007bb0: 2c20 6e65 775f 6874 6d6c 2c20 7461 696c  , new_html, tail
+00007bc0: 3d22 5a5a 5a22 293a 0a20 2020 2020 2020  ="ZZZ"):.       
+00007bd0: 2073 7479 6c65 203d 2045 542e 5375 6245   style = ET.SubE
+00007be0: 6c65 6d65 6e74 2848 746d 6c4c 6962 2e67  lement(HtmlLib.g
+00007bf0: 6574 5f68 6561 6428 6e65 775f 6874 6d6c  et_head(new_html
+00007c00: 292c 2043 5353 5374 796c 652e 5354 594c  ), CSSStyle.STYL
+00007c10: 4529 0a20 2020 2020 2020 2069 6620 7461  E).        if ta
+00007c20: 696c 3a0a 2020 2020 2020 2020 2020 2020  il:.            
+00007c30: 7374 796c 652e 7461 696c 203d 2074 6169  style.tail = tai
+00007c40: 6c0a 2020 2020 2020 2020 2320 6261 7369  l.        # basi
+00007c50: 6320 7374 796c 696e 6720 746f 2073 686f  c styling to sho
+00007c60: 7720 6469 7673 2061 6e64 2073 7061 6e73  w divs and spans
+00007c70: 0a20 2020 2020 2020 2073 7479 6c65 2e74  .        style.t
+00007c80: 6578 7420 3d20 2222 220a 2020 2020 2020  ext = """.      
+00007c90: 2020 6469 7620 7b62 6f72 6465 723a 2072    div {border: r
+00007ca0: 6564 2073 6f6c 6964 2031 7078 3b20 6d61  ed solid 1px; ma
+00007cb0: 7267 696e 3a20 3170 783b 7d0a 2020 2020  rgin: 1px;}.    
+00007cc0: 2020 2020 7370 616e 207b 6261 636b 6772      span {backgr
+00007cd0: 6f75 6e64 3a20 2365 6565 6565 653b 206d  ound: #eeeeee; m
+00007ce0: 6172 6769 6e3a 2031 7078 3b7d 0a20 2020  argin: 1px;}.   
+00007cf0: 2020 2020 2064 6976 2e66 6c6f 6174 207b       div.float {
+00007d00: 6261 636b 6772 6f75 6e64 3a20 2364 6466  background: #ddf
+00007d10: 6666 663b 7d0a 2020 2020 2020 2020 2020  fff;}.          
+00007d20: 2020 2020 2020 2020 2020 2022 2222 0a20             """. 
+00007d30: 2020 2020 2020 2072 6574 7572 6e20 7374         return st
+00007d40: 796c 650a 0a20 2020 2040 636c 6173 736d  yle..    @classm
+00007d50: 6574 686f 640a 2020 2020 6465 6620 6578  ethod.    def ex
+00007d60: 7472 6163 745f 666f 6f74 6e6f 7465 735f  tract_footnotes_
+00007d70: 746f 5f62 6163 6b28 636c 732c 2068 746d  to_back(cls, htm
+00007d80: 6c5f 656c 656d 293a 0a20 2020 2020 2020  l_elem):.       
+00007d90: 2048 746d 6c55 7469 6c2e 6578 7472 6163   HtmlUtil.extrac
+00007da0: 745f 666f 6f74 6e6f 7465 7328 6874 6d6c  t_footnotes(html
+00007db0: 5f65 6c65 6d2c 2022 666f 6e74 2d73 697a  _elem, "font-siz
+00007dc0: 653a 2036 2e30 2229 0a0a 2020 2020 4063  e: 6.0")..    @c
+00007dd0: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
+00007de0: 6566 2072 656d 6f76 655f 656d 7074 795f  ef remove_empty_
+00007df0: 6469 7673 2863 6c73 2c20 656c 656d 293a  divs(cls, elem):
+00007e00: 0a20 2020 2020 2020 2064 6976 7320 3d20  .        divs = 
+00007e10: 656c 656d 2e78 7061 7468 2822 2e2f 2f64  elem.xpath(".//d
+00007e20: 6976 2229 0a20 2020 2020 2020 2066 6f72  iv").        for
+00007e30: 2064 6976 2069 6e20 6469 7673 3a0a 2020   div in divs:.  
+00007e40: 2020 2020 2020 2020 2020 7465 7874 203d            text =
+00007e50: 2027 272e 6a6f 696e 2864 6976 2e69 7465   ''.join(div.ite
+00007e60: 7274 6578 7428 2929 0a20 2020 2020 2020  rtext()).       
+00007e70: 2020 2020 2069 6620 6e6f 7420 7465 7874       if not text
+00007e80: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00007e90: 2020 6469 762e 6765 7470 6172 656e 7428    div.getparent(
+00007ea0: 292e 7265 6d6f 7665 2864 6976 290a 0a20  ).remove(div).. 
+00007eb0: 2020 2040 636c 6173 736d 6574 686f 640a     @classmethod.
+00007ec0: 2020 2020 6465 6620 6a6f 696e 5f73 706c      def join_spl
+00007ed0: 6974 5f64 6976 7328 636c 732c 2074 6f70  it_divs(cls, top
+00007ee0: 5f64 6976 293a 0a20 2020 2020 2020 2064  _div):.        d
+00007ef0: 6976 7320 3d20 746f 705f 6469 762e 7870  ivs = top_div.xp
+00007f00: 6174 6828 222e 2f2f 6469 7622 290a 2020  ath(".//div").  
+00007f10: 2020 2020 2020 666f 7220 692c 2064 6976        for i, div
+00007f20: 2069 6e20 656e 756d 6572 6174 6528 6469   in enumerate(di
+00007f30: 7673 293a 0a20 2020 2020 2020 2020 2020  vs):.           
+00007f40: 2069 6620 6920 3e20 303a 0a20 2020 2020   if i > 0:.     
+00007f50: 2020 2020 2020 2020 2020 2064 6976 3020             div0 
+00007f60: 3d20 6469 7673 5b69 202d 2031 5d0a 2020  = divs[i - 1].  
+00007f70: 2020 2020 2020 2020 2020 2020 2020 7370                sp
+00007f80: 616e 3020 3d20 4874 6d6c 4772 6f75 702e  an0 = HtmlGroup.
+00007f90: 6765 745f 6c61 7374 5f73 7061 6e28 6469  get_last_span(di
+00007fa0: 7630 290a 2020 2020 2020 2020 2020 2020  v0).            
+00007fb0: 2020 2020 7370 616e 3120 3d20 4874 6d6c      span1 = Html
+00007fc0: 4772 6f75 702e 6765 745f 6669 7273 745f  Group.get_first_
+00007fd0: 7370 616e 2864 6976 290a 2020 2020 2020  span(div).      
+00007fe0: 2020 2020 2020 2020 2020 6966 2073 7061            if spa
+00007ff0: 6e30 2069 7320 6e6f 7420 4e6f 6e65 2061  n0 is not None a
+00008000: 6e64 2073 7061 6e31 2069 7320 6e6f 7420  nd span1 is not 
+00008010: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00008020: 2020 2020 2020 2020 2020 7374 796c 6530            style0
+00008030: 203d 2043 5353 5374 796c 652e 6372 6561   = CSSStyle.crea
+00008040: 7465 5f63 7373 5f73 7479 6c65 5f66 726f  te_css_style_fro
+00008050: 6d5f 6174 7472 6962 7574 655f 6f66 5f62  m_attribute_of_b
+00008060: 6f64 795f 656c 656d 656e 7428 7370 616e  ody_element(span
+00008070: 3029 0a20 2020 2020 2020 2020 2020 2020  0).             
+00008080: 2020 2020 2020 2073 7479 6c65 3120 3d20         style1 = 
+00008090: 4353 5353 7479 6c65 2e63 7265 6174 655f  CSSStyle.create_
+000080a0: 6373 735f 7374 796c 655f 6672 6f6d 5f61  css_style_from_a
+000080b0: 7474 7269 6275 7465 5f6f 665f 626f 6479  ttribute_of_body
+000080c0: 5f65 6c65 6d65 6e74 2873 7061 6e30 290a  _element(span0).
+000080d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000080e0: 2020 2020 6966 2073 7479 6c65 3020 3d3d      if style0 ==
+000080f0: 2073 7479 6c65 313a 0a20 2020 2020 2020   style1:.       
+00008100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008110: 2069 6620 7370 616e 3120 6973 206e 6f74   if span1 is not
+00008120: 204e 6f6e 6520 616e 6420 6c65 6e28 7370   None and len(sp
+00008130: 616e 312e 7465 7874 2920 3e20 3020 616e  an1.text) > 0 an
+00008140: 6420 7370 616e 312e 7465 7874 5b30 5d2e  d span1.text[0].
+00008150: 6973 6c6f 7765 7228 293a 0a20 2020 2020  islower():.     
+00008160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008170: 2020 2020 2020 2023 2070 7269 6e74 2866         # print(f
+00008180: 2220 6a6f 696e 6564 2073 6563 6f6e 645f  " joined second_
+00008190: 7370 616e 207b 7370 616e 312e 7465 7874  span {span1.text
+000081a0: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
+000081b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000081c0: 4874 6d6c 5574 696c 2e6a 6f69 6e5f 7370  HtmlUtil.join_sp
+000081d0: 616e 735f 696e 5f73 616d 655f 6469 7628  ans_in_same_div(
+000081e0: 7370 616e 302c 2073 7061 6e31 290a 2020  span0, span1).  
+000081f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008200: 2020 2020 2020 2020 2020 666f 7220 7370            for sp
+00008210: 616e 2069 6e20 6469 762e 7870 6174 6828  an in div.xpath(
+00008220: 222e 2f73 7061 6e22 293a 0a20 2020 2020  "./span"):.     
+00008230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008240: 2020 2020 2020 2020 2020 2064 6976 302e             div0.
+00008250: 6170 7065 6e64 2873 7061 6e29 0a20 2020  append(span).   
 00008260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008270: 6469 7630 2e61 7070 656e 6428 7370 616e  div0.append(span
-00008280: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00008290: 2020 2020 2020 2020 2020 2020 2020 6469                di
-000082a0: 762e 6765 7470 6172 656e 7428 292e 7265  v.getparent().re
-000082b0: 6d6f 7665 2864 6976 290a 0a0a 2020 2020  move(div)...    
-000082c0: 4063 6c61 7373 6d65 7468 6f64 0a20 2020  @classmethod.   
-000082d0: 2064 6566 2067 6574 5f6c 6173 745f 7370   def get_last_sp
-000082e0: 616e 2863 6c73 2c20 6469 7629 3a0a 2020  an(cls, div):.  
-000082f0: 2020 2020 2020 7370 616e 7320 3d20 6469        spans = di
-00008300: 762e 7870 6174 6828 222e 2f73 7061 6e22  v.xpath("./span"
-00008310: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-00008320: 2073 7061 6e73 5b2d 315d 2069 6620 6c65   spans[-1] if le
-00008330: 6e28 7370 616e 7329 203e 2030 2065 6c73  n(spans) > 0 els
-00008340: 6520 4e6f 6e65 0a0a 2020 2020 4063 6c61  e None..    @cla
-00008350: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
-00008360: 2067 6574 5f66 6972 7374 5f73 7061 6e28   get_first_span(
-00008370: 636c 732c 2064 6976 293a 0a20 2020 2020  cls, div):.     
-00008380: 2020 2073 7061 6e73 203d 2064 6976 2e78     spans = div.x
-00008390: 7061 7468 2822 2e2f 7370 616e 2229 0a20  path("./span"). 
-000083a0: 2020 2020 2020 2072 6574 7572 6e20 7370         return sp
-000083b0: 616e 735b 305d 2069 6620 6c65 6e28 7370  ans[0] if len(sp
-000083c0: 616e 7329 203e 2030 2065 6c73 6520 4e6f  ans) > 0 else No
-000083d0: 6e65 0a0a 2020 2020 4063 6c61 7373 6d65  ne..    @classme
-000083e0: 7468 6f64 0a20 2020 2064 6566 2061 6464  thod.    def add
-000083f0: 5f70 6172 6167 7261 7068 5f69 6473 2863  _paragraph_ids(c
-00008400: 6c73 2c20 746f 705f 6469 7629 3a0a 2020  ls, top_div):.  
-00008410: 2020 2020 2020 2222 2261 6464 7320 7365        """adds se
-00008420: 7175 656e 7469 616c 2070 6172 6167 7261  quential paragra
-00008430: 7068 206e 756d 6265 7269 6e67 2028 652e  ph numbering (e.
-00008440: 672e 2031 2e32 2e33 203d 3e20 312e 322e  g. 1.2.3 => 1.2.
-00008450: 332e 612c 2031 2e32 2e33 2e62 2065 7463  3.a, 1.2.3.b etc
-00008460: 2222 220a 2020 2020 2020 2020 7469 746c  """.        titl
-00008470: 655f 7061 7261 5f64 6976 7320 3d20 746f  e_para_divs = to
-00008480: 705f 6469 762e 7870 6174 6828 222e 2f2f  p_div.xpath(".//
-00008490: 6469 765b 4074 6974 6c65 2061 6e64 2063  div[@title and c
-000084a0: 6f6e 7461 696e 7328 4063 6c61 7373 2c20  ontains(@class, 
-000084b0: 2773 6563 7469 6f6e 2729 5d22 290a 2020  'section')]").  
-000084c0: 2020 2020 2020 666f 7220 7469 746c 655f        for title_
-000084d0: 7061 7261 5f64 6976 2069 6e20 7469 746c  para_div in titl
-000084e0: 655f 7061 7261 5f64 6976 733a 0a20 2020  e_para_divs:.   
-000084f0: 2020 2020 2020 2020 206c 6f67 6765 722e           logger.
-00008500: 6465 6275 6728 6622 7469 746c 6520 7061  debug(f"title pa
-00008510: 7261 2064 6976 7320 7b6c 656e 2874 6974  ra divs {len(tit
-00008520: 6c65 5f70 6172 615f 6469 7673 297d 2229  le_para_divs)}")
-00008530: 0a20 2020 2020 2020 2020 2020 2074 6974  .            tit
-00008540: 6c65 5f69 6420 3d20 7469 746c 655f 7061  le_id = title_pa
-00008550: 7261 5f64 6976 2e61 7474 7269 622e 6765  ra_div.attrib.ge
-00008560: 7428 2774 6974 6c65 2729 0a20 2020 2020  t('title').     
-00008570: 2020 2020 2020 2069 6620 6e6f 7420 7469         if not ti
-00008580: 746c 655f 6964 3a0a 2020 2020 2020 2020  tle_id:.        
-00008590: 2020 2020 2020 2020 636f 6e74 696e 7565          continue
-000085a0: 0a20 2020 2020 2020 2020 2020 2066 6f6c  .            fol
-000085b0: 6c6f 7765 7273 203d 2074 6974 6c65 5f70  lowers = title_p
-000085c0: 6172 615f 6469 762e 7870 6174 6828 2266  ara_div.xpath("f
-000085d0: 6f6c 6c6f 7769 6e67 2d73 6962 6c69 6e67  ollowing-sibling
-000085e0: 3a3a 6469 7622 290a 2020 2020 2020 2020  ::div").        
-000085f0: 2020 2020 666f 7220 692c 2066 6f6c 6c6f      for i, follo
-00008600: 7765 7220 696e 2065 6e75 6d65 7261 7465  wer in enumerate
-00008610: 2866 6f6c 6c6f 7765 7273 293a 0a20 2020  (followers):.   
-00008620: 2020 2020 2020 2020 2020 2020 206c 6574               let
-00008630: 7465 7220 3d20 4874 6d6c 4772 6f75 702e  ter = HtmlGroup.
-00008640: 6765 6e65 7261 7465 5f6c 6f77 6572 6361  generate_lowerca
-00008650: 7365 5f6c 6574 7465 725f 6964 2869 290a  se_letter_id(i).
-00008660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008670: 6964 203d 2074 6974 6c65 5f69 6420 2b20  id = title_id + 
-00008680: 222e 2220 2b20 6c65 7474 6572 0a20 2020  "." + letter.   
-00008690: 2020 2020 2020 2020 2020 2020 2073 7061               spa
-000086a0: 6e20 3d20 4554 2e45 6c65 6d65 6e74 2822  n = ET.Element("
-000086b0: 7370 616e 2229 0a20 2020 2020 2020 2020  span").         
-000086c0: 2020 2020 2020 2073 7061 6e2e 6174 7472         span.attr
-000086d0: 6962 5b22 7374 796c 6522 5d20 3d20 2262  ib["style"] = "b
-000086e0: 6163 6b67 726f 756e 643a 2023 6666 6666  ackground: #ffff
-000086f0: 6464 3b20 666f 6e74 2d73 697a 653a 2038  dd; font-size: 8
-00008700: 7078 220a 2020 2020 2020 2020 2020 2020  px".            
-00008710: 2020 2020 7370 616e 2e74 6578 7420 3d20      span.text = 
-00008720: 6964 0a20 2020 2020 2020 2020 2020 2020  id.             
-00008730: 2020 2073 7061 6e2e 6174 7472 6962 5b22     span.attrib["
-00008740: 6964 225d 203d 2069 640a 2020 2020 2020  id"] = id.      
-00008750: 2020 2020 2020 2020 2020 666f 6c6c 6f77            follow
-00008760: 6572 2e69 6e73 6572 7428 302c 2073 7061  er.insert(0, spa
-00008770: 6e29 0a0a 2020 2020 4063 6c61 7373 6d65  n)..    @classme
-00008780: 7468 6f64 0a20 2020 2064 6566 206d 616b  thod.    def mak
-00008790: 655f 6869 6572 6172 6368 6963 616c 5f73  e_hierarchical_s
-000087a0: 6563 7469 6f6e 735f 4b45 5928 636c 732c  ections_KEY(cls,
-000087b0: 2068 746d 6c5f 656c 656d 2c20 7374 656d   html_elem, stem
-000087c0: 2c20 7365 6374 696f 6e5f 7265 6765 7865  , section_regexe
-000087d0: 733d 4e6f 6e65 2c20 6f75 7464 6972 3d4e  s=None, outdir=N
-000087e0: 6f6e 652c 2064 6562 7567 3d46 616c 7365  one, debug=False
-000087f0: 293a 0a20 2020 2020 2020 2022 2222 4b65  ):.        """Ke
-00008800: 7920 666f 726d 6174 7469 6e67 2072 6f75  y formatting rou
-00008810: 7469 6e65 0a20 2020 2020 2020 2022 2222  tine.        """
-00008820: 0a20 2020 2020 2020 2048 746d 6c53 7479  .        HtmlSty
-00008830: 6c65 2e65 7874 7261 6374 5f73 7479 6c65  le.extract_style
-00008840: 735f 616e 645f 6e6f 726d 616c 697a 655f  s_and_normalize_
-00008850: 636c 6173 7372 6566 7328 6874 6d6c 5f65  classrefs(html_e
-00008860: 6c65 6d2c 206f 7574 6469 723d 6f75 7464  lem, outdir=outd
-00008870: 6972 290a 2020 2020 2020 2020 6966 206f  ir).        if o
-00008880: 7574 6469 723a 0a20 2020 2020 2020 2020  utdir:.         
-00008890: 2020 2048 746d 6c4c 6962 2e77 7269 7465     HtmlLib.write
-000088a0: 5f68 746d 6c5f 6669 6c65 2868 746d 6c5f  _html_file(html_
-000088b0: 656c 656d 2c20 5061 7468 286f 7574 6469  elem, Path(outdi
-000088c0: 722c 2066 227b 7374 656d 7d5f 7374 796c  r, f"{stem}_styl
-000088d0: 6573 2e68 746d 6c22 292c 2064 6562 7567  es.html"), debug
-000088e0: 3d54 7275 6529 0a20 2020 2020 2020 2048  =True).        H
-000088f0: 746d 6c47 726f 7570 2e61 6e6e 6f74 6174  tmlGroup.annotat
-00008900: 655f 7469 746c 655f 7365 6374 696f 6e73  e_title_sections
-00008910: 2868 746d 6c5f 656c 656d 2c20 7365 6374  (html_elem, sect
-00008920: 696f 6e5f 7265 6765 7865 733d 7365 6374  ion_regexes=sect
-00008930: 696f 6e5f 7265 6765 7865 7329 0a20 2020  ion_regexes).   
-00008940: 2020 2020 2048 746d 6c47 726f 7570 2e65       HtmlGroup.e
-00008950: 7874 7261 6374 5f66 6f6f 746e 6f74 6573  xtract_footnotes
-00008960: 5f74 6f5f 6261 636b 2868 746d 6c5f 656c  _to_back(html_el
-00008970: 656d 290a 2020 2020 2020 2020 6e65 775f  em).        new_
-00008980: 6469 7620 3d20 4874 6d6c 4772 6f75 702e  div = HtmlGroup.
-00008990: 6772 6f75 705f 6469 7673 5f69 6e74 6f5f  group_divs_into_
-000089a0: 7472 6565 2848 746d 6c4c 6962 2e67 6574  tree(HtmlLib.get
-000089b0: 5f62 6f64 7928 6874 6d6c 5f65 6c65 6d29  _body(html_elem)
-000089c0: 290a 2020 2020 2020 2020 4874 6d6c 4772  ).        HtmlGr
-000089d0: 6f75 702e 7265 6d6f 7665 5f65 6d70 7479  oup.remove_empty
-000089e0: 5f64 6976 7328 6e65 775f 6469 7629 0a20  _divs(new_div). 
-000089f0: 2020 2020 2020 2048 746d 6c47 726f 7570         HtmlGroup
-00008a00: 2e6a 6f69 6e5f 7370 6c69 745f 6469 7673  .join_split_divs
-00008a10: 286e 6577 5f64 6976 290a 2020 2020 2020  (new_div).      
-00008a20: 2020 4874 6d6c 4772 6f75 702e 6164 645f    HtmlGroup.add_
-00008a30: 7061 7261 6772 6170 685f 6964 7328 6e65  paragraph_ids(ne
-00008a40: 775f 6469 7629 0a20 2020 2020 2020 2023  w_div).        #
-00008a50: 2074 7261 6e73 6665 7220 746f 206e 6577   transfer to new
-00008a60: 2065 6c65 6d65 6e74 2028 6d61 7920 6e6f   element (may no
-00008a70: 7420 6265 206e 6563 6573 7361 7279 3f29  t be necessary?)
-00008a80: 0a20 2020 2020 2020 206e 6577 5f68 746d  .        new_htm
-00008a90: 6c20 3d20 4874 6d6c 4c69 622e 6372 6561  l = HtmlLib.crea
-00008aa0: 7465 5f68 746d 6c5f 7769 7468 5f65 6d70  te_html_with_emp
-00008ab0: 7479 5f68 6561 645f 626f 6479 2829 0a20  ty_head_body(). 
-00008ac0: 2020 2020 2020 2048 746d 6c4c 6962 2e67         HtmlLib.g
-00008ad0: 6574 5f62 6f64 7928 6e65 775f 6874 6d6c  et_body(new_html
-00008ae0: 292e 6170 7065 6e64 286e 6577 5f64 6976  ).append(new_div
-00008af0: 290a 2020 2020 2020 2020 4874 6d6c 5374  ).        HtmlSt
-00008b00: 796c 652e 7472 616e 7366 6572 5f68 6561  yle.transfer_hea
-00008b10: 645f 7374 796c 6573 2868 746d 6c5f 656c  d_styles(html_el
-00008b20: 656d 2c20 6e65 775f 6874 6d6c 290a 2020  em, new_html).  
-00008b30: 2020 2020 2020 4874 6d6c 4772 6f75 702e        HtmlGroup.
-00008b40: 636f 6c6c 6563 745f 666c 6f61 7473 5f74  collect_floats_t
-00008b50: 6f5f 6261 636b 286e 6577 5f68 746d 6c29  o_back(new_html)
-00008b60: 0a20 2020 2020 2020 2048 746d 6c47 726f  .        HtmlGro
-00008b70: 7570 2e61 6e6e 6f74 6174 655f 6970 6363  up.annotate_ipcc
-00008b80: 5f74 6172 6765 745f 6964 7328 6e65 775f  _target_ids(new_
-00008b90: 6874 6d6c 290a 2020 2020 2020 2020 6966  html).        if
-00008ba0: 206f 7574 6469 723a 0a20 2020 2020 2020   outdir:.       
-00008bb0: 2020 2020 2048 746d 6c4c 6962 2e77 7269       HtmlLib.wri
-00008bc0: 7465 5f68 746d 6c5f 6669 6c65 286e 6577  te_html_file(new
-00008bd0: 5f68 746d 6c2c 2050 6174 6828 6f75 7464  _html, Path(outd
-00008be0: 6972 2c20 6622 7b73 7465 6d7d 5f67 726f  ir, f"{stem}_gro
-00008bf0: 7570 732e 6874 6d6c 2229 2c20 6465 6275  ups.html"), debu
-00008c00: 673d 5472 7565 290a 2020 2020 2020 2020  g=True).        
-00008c10: 7370 6c69 745f 7370 616e 5f72 6567 6578  split_span_regex
-00008c20: 203d 2022 283f 503c 7072 653e 2e2a 283f   = "(?P<pre>.*(?
-00008c30: 3a68 6967 687c 6d65 6469 756d 7c6c 6f77  :high|medium|low
-00008c40: 295c 5c73 2a28 636f 6e66 6964 656e 6365  )\\s*(confidence
-00008c50: 2929 283f 503c 706f 7374 3e2e 2a29 220a  ))(?P<post>.*)".
-00008c60: 2020 2020 2020 2020 4874 6d6c 4772 6f75          HtmlGrou
-00008c70: 702e 7370 6c69 745f 7370 616e 7328 6e65  p.split_spans(ne
-00008c80: 775f 6874 6d6c 2c20 7370 6c69 745f 7370  w_html, split_sp
-00008c90: 616e 5f72 6567 6578 290a 2020 2020 2020  an_regex).      
-00008ca0: 2020 6966 206f 7574 6469 723a 0a20 2020    if outdir:.   
-00008cb0: 2020 2020 2020 2020 2048 746d 6c4c 6962           HtmlLib
-00008cc0: 2e77 7269 7465 5f68 746d 6c5f 6669 6c65  .write_html_file
-00008cd0: 286e 6577 5f68 746d 6c2c 2050 6174 6828  (new_html, Path(
-00008ce0: 6f75 7464 6972 2c20 6622 7b73 7465 6d7d  outdir, f"{stem}
-00008cf0: 5f73 7461 7465 6d65 6e74 732e 6874 6d6c  _statements.html
-00008d00: 2229 2c20 6465 6275 673d 5472 7565 290a  "), debug=True).
-00008d10: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00008d20: 6e65 775f 6874 6d6c 0a0a 2020 2020 4063  new_html..    @c
-00008d30: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
-00008d40: 6566 2067 726f 7570 5f6e 6573 7465 645f  ef group_nested_
-00008d50: 7369 626c 696e 6773 2863 6c73 2c20 6874  siblings(cls, ht
-00008d60: 6d6c 5f65 6c65 6d2c 2073 7479 6c65 733d  ml_elem, styles=
-00008d70: 4e6f 6e65 293a 0a20 2020 2020 2020 2069  None):.        i
-00008d80: 6620 7374 796c 6573 2069 7320 4e6f 6e65  f styles is None
-00008d90: 3a0a 2020 2020 2020 2020 2020 2020 7374  :.            st
-00008da0: 796c 6573 203d 205b 0a20 2020 2020 2020  yles = [.       
-00008db0: 2020 2020 2022 626f 7264 6572 203a 2073       "border : s
-00008dc0: 6f6c 6964 2070 7572 706c 6520 3270 783b  olid purple 2px;
-00008dd0: 206d 6172 6769 6e3a 3270 783b 222c 0a20   margin:2px;",. 
-00008de0: 2020 2020 2020 2020 2020 2022 626f 7264             "bord
-00008df0: 6572 203a 2064 6173 6865 6420 6772 6565  er : dashed gree
-00008e00: 6e20 312e 3570 783b 206d 6172 6769 6e3a  n 1.5px; margin:
-00008e10: 312e 3570 783b 222c 0a20 2020 2020 2020  1.5px;",.       
-00008e20: 2020 2020 2022 626f 7264 6572 203a 2064       "border : d
-00008e30: 6f74 7465 6420 626c 7565 2031 7078 3b20  otted blue 1px; 
-00008e40: 6d61 7267 696e 3a31 7078 3b22 2c0a 2020  margin:1px;",.  
-00008e50: 2020 2020 2020 2020 2020 5d0a 0a20 2020            ]..   
-00008e60: 2020 2020 2048 746d 6c47 726f 7570 2e67       HtmlGroup.g
-00008e70: 726f 7570 5f73 6962 6c69 6e67 7328 6874  roup_siblings(ht
-00008e80: 6d6c 5f65 6c65 6d2c 206c 6f63 6174 6f72  ml_elem, locator
-00008e90: 3d22 7365 6374 696f 6e22 2c20 7374 796c  ="section", styl
-00008ea0: 653d 7374 796c 6573 5b30 5d29 0a20 2020  e=styles[0]).   
-00008eb0: 2020 2020 2048 746d 6c47 726f 7570 2e67       HtmlGroup.g
-00008ec0: 726f 7570 5f73 6962 6c69 6e67 7328 6874  roup_siblings(ht
-00008ed0: 6d6c 5f65 6c65 6d2c 206c 6f63 6174 6f72  ml_elem, locator
-00008ee0: 3d22 7375 625f 7365 6374 696f 6e22 2c20  ="sub_section", 
-00008ef0: 7374 796c 653d 7374 796c 6573 5b31 5d2c  style=styles[1],
-00008f00: 2064 6562 7567 3d54 7275 6529 0a20 2020   debug=True).   
-00008f10: 2020 2020 2048 746d 6c47 726f 7570 2e67       HtmlGroup.g
-00008f20: 726f 7570 5f73 6962 6c69 6e67 7328 6874  roup_siblings(ht
-00008f30: 6d6c 5f65 6c65 6d2c 206c 6f63 6174 6f72  ml_elem, locator
-00008f40: 3d22 7375 625f 7375 625f 7365 6374 696f  ="sub_sub_sectio
-00008f50: 6e22 2c20 7374 796c 653d 7374 796c 6573  n", style=styles
-00008f60: 5b32 5d29 0a0a 2020 2020 4063 6c61 7373  [2])..    @class
-00008f70: 6d65 7468 6f64 0a20 2020 2064 6566 2061  method.    def a
-00008f80: 6e6e 6f74 6174 655f 6970 6363 5f74 6172  nnotate_ipcc_tar
-00008f90: 6765 745f 6964 7328 636c 732c 2068 746d  get_ids(cls, htm
-00008fa0: 6c5f 656c 656d 293a 0a20 2020 2020 2020  l_elem):.       
-00008fb0: 2022 2222 6669 6e64 7320 7365 6374 696f   """finds sectio
-00008fc0: 6e73 206f 6620 666f 726d 207b 7461 7267  ns of form {targ
-00008fd0: 6574 5f69 642c 2074 6172 6765 745f 6964  et_id, target_id
-00008fe0: 2e2e 2e7d 2061 6e64 2061 6464 7320 636c  ...} and adds cl
-00008ff0: 6173 733d 7461 7267 6574 730a 2020 2020  ass=targets.    
-00009000: 2020 2020 5468 6973 2069 7320 6265 7474      This is bett
-00009010: 6572 2064 6f6e 6520 696e 2074 6865 2061  er done in the a
-00009020: 6e6e 6f74 6174 6f72 2077 6f72 6b66 6c6f  nnotator workflo
-00009030: 7720 7768 6572 6520 6974 2077 6f72 6b73  w where it works
-00009040: 2e20 5468 6973 2069 7320 6120 6861 636b  . This is a hack
-00009050: 2066 6f72 0a20 2020 2020 2020 2066 696c   for.        fil
-00009060: 6573 2077 6869 6368 2068 6176 6520 6265  es which have be
-00009070: 656e 206d 6973 7365 6422 2222 0a20 2020  en missed""".   
-00009080: 2020 2020 2072 655f 6375 726c 7920 3d20       re_curly = 
-00009090: 7265 2e63 6f6d 7069 6c65 2872 2228 3f50  re.compile(r"(?P
-000090a0: 3c70 7265 3e2e 2a29 7b28 3f50 3c62 6f64  <pre>.*){(?P<bod
-000090b0: 793e 5b5e 7d5d 2b29 7d28 3f50 3c70 6f73  y>[^}]+)}(?P<pos
-000090c0: 743e 2e2a 2922 290a 2020 2020 2020 2020  t>.*)").        
-000090d0: 5441 5247 4554 5320 3d20 2274 6172 6765  TARGETS = "targe
-000090e0: 7473 220a 2020 2020 2020 2020 6375 726c  ts".        curl
-000090f0: 795f 7370 616e 7320 3d20 6874 6d6c 5f65  y_spans = html_e
-00009100: 6c65 6d2e 7870 6174 6828 6622 2e2f 2f73  lem.xpath(f".//s
-00009110: 7061 6e5b 636f 6e74 6169 6e73 282e 2c20  pan[contains(., 
-00009120: 277b 7b27 2920 616e 6420 636f 6e74 6169  '{{') and contai
-00009130: 6e73 282e 2c20 277d 7d27 295d 2229 0a20  ns(., '}}')]"). 
-00009140: 2020 2020 2020 206c 6f67 6765 722e 6465         logger.de
-00009150: 6275 6728 6622 666f 756e 6420 6375 726c  bug(f"found curl
-00009160: 6965 7320 7b6c 656e 2863 7572 6c79 5f73  ies {len(curly_s
-00009170: 7061 6e73 297d 2229 0a20 2020 2020 2020  pans)}").       
-00009180: 2066 6f72 2073 7061 6e20 696e 2063 7572   for span in cur
-00009190: 6c79 5f73 7061 6e73 3a0a 2020 2020 2020  ly_spans:.      
-000091a0: 2020 2020 2020 7061 7265 6e74 203d 2073        parent = s
-000091b0: 7061 6e2e 6765 7470 6172 656e 7428 290a  pan.getparent().
-000091c0: 2020 2020 2020 2020 2020 2020 6d61 7463              matc
-000091d0: 6820 3d20 7265 5f63 7572 6c79 2e6d 6174  h = re_curly.mat
-000091e0: 6368 2873 7061 6e2e 7465 7874 290a 2020  ch(span.text).  
-000091f0: 2020 2020 2020 2020 2020 6966 206d 6174            if mat
-00009200: 6368 3a0a 2020 2020 2020 2020 2020 2020  ch:.            
-00009210: 2020 2020 666f 7220 6770 2069 6e20 5b22      for gp in ["
-00009220: 7072 6522 2c20 2262 6f64 7922 2c20 2270  pre", "body", "p
-00009230: 6f73 7422 5d3a 0a20 2020 2020 2020 2020  ost"]:.         
-00009240: 2020 2020 2020 2020 2020 2074 203d 206d             t = m
-00009250: 6174 6368 2e67 726f 7570 2867 7029 0a20  atch.group(gp). 
-00009260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009270: 2020 2069 6620 6c65 6e28 7429 203e 2030     if len(t) > 0
-00009280: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00009290: 2020 2020 2020 2020 2020 6966 2067 7020            if gp 
-000092a0: 3d3d 2022 626f 6479 223a 0a20 2020 2020  == "body":.     
-000092b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000092c0: 2020 2020 2020 2074 6172 6765 745f 6964         target_id
-000092d0: 7320 3d20 7265 2e73 706c 6974 2822 5b2c  s = re.split("[,
-000092e0: 3b5d 222c 2074 290a 2020 2020 2020 2020  ;]", t).        
-000092f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009300: 2020 2020 666f 7220 7461 7267 6574 5f69      for target_i
-00009310: 6420 696e 2074 6172 6765 745f 6964 733a  d in target_ids:
-00009320: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009340: 2061 203d 2045 542e 5375 6245 6c65 6d65   a = ET.SubEleme
-00009350: 6e74 2870 6172 656e 742c 2022 6122 290a  nt(parent, "a").
-00009360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009380: 7370 616e 2e61 6464 7072 6576 696f 7573  span.addprevious
-00009390: 2861 290a 2020 2020 2020 2020 2020 2020  (a).            
-000093a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000093b0: 2020 2020 612e 7465 7874 203d 2074 6172      a.text = tar
-000093c0: 6765 745f 6964 0a20 2020 2020 2020 2020  get_id.         
-000093d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000093e0: 2020 2020 2020 2061 2e61 7474 7269 625b         a.attrib[
-000093f0: 2268 7265 6622 5d20 3d20 6765 745f 7461  "href"] = get_ta
-00009400: 7267 6574 5f68 7265 6628 7429 0a20 2020  rget_href(t).   
-00009410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009420: 2020 2020 2020 2020 2023 2070 6172 656e           # paren
-00009430: 742e 7265 6d6f 7665 2873 7061 6e29 0a20  t.remove(span). 
-00009440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009450: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00009460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009470: 2020 2020 2020 2020 2073 7061 6e78 203d           spanx =
-00009480: 2045 542e 5375 6245 6c65 6d65 6e74 2870   ET.SubElement(p
-00009490: 6172 656e 742c 2022 7370 616e 2229 0a20  arent, "span"). 
-000094a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000094b0: 2020 2020 2020 2020 2020 2073 7061 6e78             spanx
-000094c0: 2e74 6578 7420 3d20 740a 2020 2020 2020  .text = t.      
-000094d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000094e0: 2020 2020 2020 666f 7220 6174 7420 696e        for att in
-000094f0: 2073 7061 6e2e 6174 7472 6962 3a0a 2020   span.attrib:.  
-00009500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009510: 2020 2020 2020 2020 2020 2020 2020 7370                sp
-00009520: 616e 782e 6174 7472 6962 5b61 7474 5d20  anx.attrib[att] 
-00009530: 3d20 7370 616e 2e61 7474 7269 625b 6174  = span.attrib[at
-00009540: 745d 0a20 2020 2020 2020 2020 2020 2020  t].             
-00009550: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00009560: 7061 6e2e 6164 6470 7265 7669 6f75 7328  pan.addprevious(
-00009570: 7370 616e 7829 0a20 2020 2020 2020 2020  spanx).         
-00009580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009590: 2020 2073 7061 6e78 2e61 7474 7269 625b     spanx.attrib[
-000095a0: 2261 6e63 686f 7222 5d20 3d20 6770 0a0a  "anchor"] = gp..
-000095b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000095c0: 7061 7265 6e74 2e72 656d 6f76 6528 7370  parent.remove(sp
-000095d0: 616e 290a 0a0a 0a0a 2020 2020 2020 2020  an).....        
-000095e0: 2020 2020 7370 616e 2e61 7474 7269 625b      span.attrib[
-000095f0: 2263 6c61 7373 225d 203d 2054 4152 4745  "class"] = TARGE
-00009600: 5453 0a0a 0a0a 0a20 2020 2040 636c 6173  TS.....    @clas
-00009610: 736d 6574 686f 640a 2020 2020 6465 6620  smethod.    def 
-00009620: 6578 7472 6163 745f 7365 6374 696f 6e5f  extract_section_
-00009630: 6964 7328 636c 732c 2068 746d 6c5f 656c  ids(cls, html_el
-00009640: 656d 2c20 7870 6174 6873 3d5b 222e 2f2f  em, xpaths=[".//
-00009650: 6469 7622 2c20 222e 2f73 7061 6e22 5d2c  div", "./span"],
-00009660: 2072 6567 6578 6573 3d4e 6f6e 6529 3a0a   regexes=None):.
-00009670: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00009680: 2020 2020 6578 7472 6163 7473 2073 6563      extracts sec
-00009690: 7469 6f6e 7320 616e 6420 706f 7373 6962  tions and possib
-000096a0: 6c79 2073 7562 7365 6374 696f 6e73 2066  ly subsections f
-000096b0: 726f 6d20 636f 6d70 6f75 6e64 2065 6c65  rom compound ele
-000096c0: 6d65 6e74 7320 2865 2e67 2e20 6469 7629  ments (e.g. div)
-000096d0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-000096e0: 6874 6d6c 5f65 6c65 6d3a 2063 6f6d 706f  html_elem: compo
-000096f0: 756e 6420 656c 656d 656e 740a 2020 2020  und element.    
-00009700: 2020 2020 3a70 6172 616d 2078 7061 7468      :param xpath
-00009710: 733a 206c 6973 7420 6f66 2078 7061 7468  s: list of xpath
-00009720: 2066 6f72 2073 6563 7469 6f6e 2c20 6f70   for section, op
-00009730: 7469 6f6e 616c 2073 7562 7365 6374 696f  tional subsectio
-00009740: 6e2c 2063 7572 7265 6e74 6c79 206c 656e  n, currently len
-00009750: 2031 206f 7220 322c 0a20 2020 2020 2020   1 or 2,.       
-00009760: 2020 2073 696e 676c 6520 7870 6174 6820     single xpath 
-00009770: 6973 2074 6865 6e20 7772 6170 7065 6420  is then wrapped 
-00009780: 746f 206c 6973 743b 2064 6566 6175 6c74  to list; default
-00009790: 205b 222e 2f2f 6469 7622 2c20 222e 2f73   [".//div", "./s
-000097a0: 7061 6e22 5d0a 2020 2020 2020 2020 3a70  pan"].        :p
-000097b0: 6172 616d 2072 6567 6578 6573 3a20 6c69  aram regexes: li
-000097c0: 7374 206f 6620 7265 6765 7865 7320 666f  st of regexes fo
-000097d0: 7220 6561 6368 2064 6573 6365 6e74 3b20  r each descent; 
-000097e0: 7369 6e67 6c65 2069 7320 7772 6170 7065  single is wrappe
-000097f0: 6420 746f 206c 6973 7420 3b20 6966 206e  d to list ; if n
-00009800: 6f6e 6520 6769 7665 6e0a 2020 2020 2020  one given.      
-00009810: 2020 2020 6163 6365 7074 7320 616c 6c20      accepts all 
-00009820: 6465 7363 656e 6461 6e74 7320 6672 6f6d  descendants from
-00009830: 2078 7061 7468 0a20 2020 2020 2020 2022   xpath.        "
-00009840: 2222 0a20 2020 2020 2020 2069 6620 6e6f  "".        if no
-00009850: 7420 7870 6174 6873 3a0a 2020 2020 2020  t xpaths:.      
-00009860: 2020 2020 2020 7265 7475 726e 204e 6f6e        return Non
-00009870: 650a 2020 2020 2020 2020 6966 206e 6f74  e.        if not
-00009880: 2074 7970 6528 7870 6174 6873 2920 6973   type(xpaths) is
-00009890: 206c 6973 743a 0a20 2020 2020 2020 2020   list:.         
-000098a0: 2020 2078 7061 7468 7320 3d20 5b78 7061     xpaths = [xpa
-000098b0: 7468 735d 0a20 2020 2020 2020 2061 7373  ths].        ass
-000098c0: 6572 7420 3020 3c20 6c65 6e28 7870 6174  ert 0 < len(xpat
-000098d0: 6873 2920 3c3d 2032 2c20 6622 6e6f 2078  hs) <= 2, f"no x
-000098e0: 7061 7468 7320 6769 7665 6e22 0a0a 2020  paths given"..  
-000098f0: 2020 2020 2020 6966 206e 6f74 2072 6567        if not reg
-00009900: 6578 6573 3a0a 2020 2020 2020 2020 2020  exes:.          
-00009910: 2020 7265 6765 7865 7320 3d20 5b5d 0a20    regexes = []. 
-00009920: 2020 2020 2020 2069 6620 6e6f 7420 7479         if not ty
-00009930: 7065 2872 6567 6578 6573 2920 6973 206c  pe(regexes) is l
-00009940: 6973 743a 0a20 2020 2020 2020 2020 2020  ist:.           
-00009950: 2072 6567 6578 6573 203d 205b 7265 6765   regexes = [rege
-00009960: 7865 735d 0a0a 2020 2020 2020 2020 6469  xes]..        di
-00009970: 7673 203d 2068 746d 6c5f 656c 656d 2e78  vs = html_elem.x
-00009980: 7061 7468 2878 7061 7468 735b 305d 290a  path(xpaths[0]).
-00009990: 2020 2020 2020 2020 7365 6374 696f 6e73          sections
-000099a0: 203d 205b 5d0a 2020 2020 2020 2020 7375   = [].        su
-000099b0: 6273 6563 7469 6f6e 7320 3d20 5b5d 0a20  bsections = []. 
-000099c0: 2020 2020 2020 2066 6f72 2064 6976 2069         for div i
-000099d0: 6e20 6469 7673 3a0a 2020 2020 2020 2020  n divs:.        
-000099e0: 2020 2020 6966 206c 656e 2872 6567 6578      if len(regex
-000099f0: 6573 2920 3e20 3020 616e 6420 7265 6765  es) > 0 and rege
-00009a00: 7865 735b 305d 3a0a 2020 2020 2020 2020  xes[0]:.        
-00009a10: 2020 2020 2020 2020 7365 6374 696f 6e5f          section_
-00009a20: 6964 203d 2048 746d 6c55 7469 6c2e 6578  id = HtmlUtil.ex
-00009a30: 7472 6163 745f 7375 6273 7472 696e 6773  tract_substrings
-00009a40: 2864 6976 2c20 7870 6174 683d 7870 6174  (div, xpath=xpat
-00009a50: 6873 5b30 5d2c 2072 6567 6578 3d72 6567  hs[0], regex=reg
-00009a60: 6578 6573 5b30 5d29 0a20 2020 2020 2020  exes[0]).       
-00009a70: 2020 2020 2020 2020 2069 6620 7365 6374           if sect
-00009a80: 696f 6e5f 6964 3a0a 2020 2020 2020 2020  ion_id:.        
-00009a90: 2020 2020 2020 2020 2020 2020 7365 6374              sect
-00009aa0: 696f 6e73 2e61 7070 656e 6428 7365 6374  ions.append(sect
-00009ab0: 696f 6e5f 6964 290a 2020 2020 2020 2020  ion_id).        
-00009ac0: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
-00009ad0: 696e 7565 0a20 2020 2020 2020 2020 2020  inue.           
-00009ae0: 2069 6620 6c65 6e20 2872 6567 6578 6573   if len (regexes
-00009af0: 2920 3e20 3120 616e 6420 7265 6765 7865  ) > 1 and regexe
-00009b00: 735b 315d 3a0a 2020 2020 2020 2020 2020  s[1]:.          
-00009b10: 2020 2020 2020 7375 6273 6563 7469 6f6e        subsection
-00009b20: 5f69 6420 3d20 4874 6d6c 5574 696c 2e65  _id = HtmlUtil.e
-00009b30: 7874 7261 6374 5f73 7562 7374 7269 6e67  xtract_substring
-00009b40: 7328 6469 762c 2078 7061 7468 3d78 7061  s(div, xpath=xpa
-00009b50: 7468 735b 315d 2c0a 2020 2020 2020 2020  ths[1],.        
+00008270: 2020 2020 2020 2020 2064 6976 2e67 6574           div.get
+00008280: 7061 7265 6e74 2829 2e72 656d 6f76 6528  parent().remove(
+00008290: 6469 7629 0a0a 2020 2020 4063 6c61 7373  div)..    @class
+000082a0: 6d65 7468 6f64 0a20 2020 2064 6566 2067  method.    def g
+000082b0: 6574 5f6c 6173 745f 7370 616e 2863 6c73  et_last_span(cls
+000082c0: 2c20 6469 7629 3a0a 2020 2020 2020 2020  , div):.        
+000082d0: 7370 616e 7320 3d20 6469 762e 7870 6174  spans = div.xpat
+000082e0: 6828 222e 2f73 7061 6e22 290a 2020 2020  h("./span").    
+000082f0: 2020 2020 7265 7475 726e 2073 7061 6e73      return spans
+00008300: 5b2d 315d 2069 6620 6c65 6e28 7370 616e  [-1] if len(span
+00008310: 7329 203e 2030 2065 6c73 6520 4e6f 6e65  s) > 0 else None
+00008320: 0a0a 2020 2020 4063 6c61 7373 6d65 7468  ..    @classmeth
+00008330: 6f64 0a20 2020 2064 6566 2067 6574 5f66  od.    def get_f
+00008340: 6972 7374 5f73 7061 6e28 636c 732c 2064  irst_span(cls, d
+00008350: 6976 293a 0a20 2020 2020 2020 2073 7061  iv):.        spa
+00008360: 6e73 203d 2064 6976 2e78 7061 7468 2822  ns = div.xpath("
+00008370: 2e2f 7370 616e 2229 0a20 2020 2020 2020  ./span").       
+00008380: 2072 6574 7572 6e20 7370 616e 735b 305d   return spans[0]
+00008390: 2069 6620 6c65 6e28 7370 616e 7329 203e   if len(spans) >
+000083a0: 2030 2065 6c73 6520 4e6f 6e65 0a0a 2020   0 else None..  
+000083b0: 2020 4063 6c61 7373 6d65 7468 6f64 0a20    @classmethod. 
+000083c0: 2020 2064 6566 2061 6464 5f70 6172 6167     def add_parag
+000083d0: 7261 7068 5f69 6473 2863 6c73 2c20 746f  raph_ids(cls, to
+000083e0: 705f 6469 7629 3a0a 2020 2020 2020 2020  p_div):.        
+000083f0: 2222 2261 6464 7320 7365 7175 656e 7469  """adds sequenti
+00008400: 616c 2070 6172 6167 7261 7068 206e 756d  al paragraph num
+00008410: 6265 7269 6e67 2028 652e 672e 2031 2e32  bering (e.g. 1.2
+00008420: 2e33 203d 3e20 312e 322e 332e 612c 2031  .3 => 1.2.3.a, 1
+00008430: 2e32 2e33 2e62 2065 7463 2222 220a 2020  .2.3.b etc""".  
+00008440: 2020 2020 2020 7469 746c 655f 7061 7261        title_para
+00008450: 5f64 6976 7320 3d20 746f 705f 6469 762e  _divs = top_div.
+00008460: 7870 6174 6828 222e 2f2f 6469 765b 4074  xpath(".//div[@t
+00008470: 6974 6c65 2061 6e64 2063 6f6e 7461 696e  itle and contain
+00008480: 7328 4063 6c61 7373 2c20 2773 6563 7469  s(@class, 'secti
+00008490: 6f6e 2729 5d22 290a 2020 2020 2020 2020  on')]").        
+000084a0: 666f 7220 7469 746c 655f 7061 7261 5f64  for title_para_d
+000084b0: 6976 2069 6e20 7469 746c 655f 7061 7261  iv in title_para
+000084c0: 5f64 6976 733a 0a20 2020 2020 2020 2020  _divs:.         
+000084d0: 2020 206c 6f67 6765 722e 6465 6275 6728     logger.debug(
+000084e0: 6622 7469 746c 6520 7061 7261 2064 6976  f"title para div
+000084f0: 7320 7b6c 656e 2874 6974 6c65 5f70 6172  s {len(title_par
+00008500: 615f 6469 7673 297d 2229 0a20 2020 2020  a_divs)}").     
+00008510: 2020 2020 2020 2074 6974 6c65 5f69 6420         title_id 
+00008520: 3d20 7469 746c 655f 7061 7261 5f64 6976  = title_para_div
+00008530: 2e61 7474 7269 622e 6765 7428 2774 6974  .attrib.get('tit
+00008540: 6c65 2729 0a20 2020 2020 2020 2020 2020  le').           
+00008550: 2069 6620 6e6f 7420 7469 746c 655f 6964   if not title_id
+00008560: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00008570: 2020 636f 6e74 696e 7565 0a20 2020 2020    continue.     
+00008580: 2020 2020 2020 2066 6f6c 6c6f 7765 7273         followers
+00008590: 203d 2074 6974 6c65 5f70 6172 615f 6469   = title_para_di
+000085a0: 762e 7870 6174 6828 2266 6f6c 6c6f 7769  v.xpath("followi
+000085b0: 6e67 2d73 6962 6c69 6e67 3a3a 6469 7622  ng-sibling::div"
+000085c0: 290a 2020 2020 2020 2020 2020 2020 666f  ).            fo
+000085d0: 7220 692c 2066 6f6c 6c6f 7765 7220 696e  r i, follower in
+000085e0: 2065 6e75 6d65 7261 7465 2866 6f6c 6c6f   enumerate(follo
+000085f0: 7765 7273 293a 0a20 2020 2020 2020 2020  wers):.         
+00008600: 2020 2020 2020 206c 6574 7465 7220 3d20         letter = 
+00008610: 4874 6d6c 4772 6f75 702e 6765 6e65 7261  HtmlGroup.genera
+00008620: 7465 5f6c 6f77 6572 6361 7365 5f6c 6574  te_lowercase_let
+00008630: 7465 725f 6964 2869 290a 2020 2020 2020  ter_id(i).      
+00008640: 2020 2020 2020 2020 2020 6964 203d 2074            id = t
+00008650: 6974 6c65 5f69 6420 2b20 222e 2220 2b20  itle_id + "." + 
+00008660: 6c65 7474 6572 0a20 2020 2020 2020 2020  letter.         
+00008670: 2020 2020 2020 2073 7061 6e20 3d20 4554         span = ET
+00008680: 2e45 6c65 6d65 6e74 2822 7370 616e 2229  .Element("span")
+00008690: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000086a0: 2073 7061 6e2e 6174 7472 6962 5b22 7374   span.attrib["st
+000086b0: 796c 6522 5d20 3d20 2262 6163 6b67 726f  yle"] = "backgro
+000086c0: 756e 643a 2023 6666 6666 6464 3b20 666f  und: #ffffdd; fo
+000086d0: 6e74 2d73 697a 653a 2038 7078 220a 2020  nt-size: 8px".  
+000086e0: 2020 2020 2020 2020 2020 2020 2020 7370                sp
+000086f0: 616e 2e74 6578 7420 3d20 6964 0a20 2020  an.text = id.   
+00008700: 2020 2020 2020 2020 2020 2020 2073 7061               spa
+00008710: 6e2e 6174 7472 6962 5b22 6964 225d 203d  n.attrib["id"] =
+00008720: 2069 640a 2020 2020 2020 2020 2020 2020   id.            
+00008730: 2020 2020 666f 6c6c 6f77 6572 2e69 6e73      follower.ins
+00008740: 6572 7428 302c 2073 7061 6e29 0a0a 2020  ert(0, span)..  
+00008750: 2020 4063 6c61 7373 6d65 7468 6f64 0a20    @classmethod. 
+00008760: 2020 2064 6566 206d 616b 655f 6869 6572     def make_hier
+00008770: 6172 6368 6963 616c 5f73 6563 7469 6f6e  archical_section
+00008780: 735f 4b45 5928 636c 732c 2068 746d 6c5f  s_KEY(cls, html_
+00008790: 656c 656d 2c20 7374 656d 2c20 7365 6374  elem, stem, sect
+000087a0: 696f 6e5f 7265 6765 7865 733d 4e6f 6e65  ion_regexes=None
+000087b0: 2c20 6f75 7464 6972 3d4e 6f6e 652c 2064  , outdir=None, d
+000087c0: 6562 7567 3d46 616c 7365 293a 0a20 2020  ebug=False):.   
+000087d0: 2020 2020 2022 2222 4b65 7920 666f 726d       """Key form
+000087e0: 6174 7469 6e67 2072 6f75 7469 6e65 0a20  atting routine. 
+000087f0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00008800: 2020 2048 746d 6c53 7479 6c65 2e65 7874     HtmlStyle.ext
+00008810: 7261 6374 5f73 7479 6c65 735f 616e 645f  ract_styles_and_
+00008820: 6e6f 726d 616c 697a 655f 636c 6173 7372  normalize_classr
+00008830: 6566 7328 6874 6d6c 5f65 6c65 6d2c 206f  efs(html_elem, o
+00008840: 7574 6469 723d 6f75 7464 6972 290a 2020  utdir=outdir).  
+00008850: 2020 2020 2020 6966 206f 7574 6469 723a        if outdir:
+00008860: 0a20 2020 2020 2020 2020 2020 2048 746d  .            Htm
+00008870: 6c4c 6962 2e77 7269 7465 5f68 746d 6c5f  lLib.write_html_
+00008880: 6669 6c65 2868 746d 6c5f 656c 656d 2c20  file(html_elem, 
+00008890: 5061 7468 286f 7574 6469 722c 2066 227b  Path(outdir, f"{
+000088a0: 7374 656d 7d5f 7374 796c 6573 2e68 746d  stem}_styles.htm
+000088b0: 6c22 292c 2064 6562 7567 3d54 7275 6529  l"), debug=True)
+000088c0: 0a20 2020 2020 2020 2048 746d 6c47 726f  .        HtmlGro
+000088d0: 7570 2e61 6e6e 6f74 6174 655f 7469 746c  up.annotate_titl
+000088e0: 655f 7365 6374 696f 6e73 2868 746d 6c5f  e_sections(html_
+000088f0: 656c 656d 2c20 7365 6374 696f 6e5f 7265  elem, section_re
+00008900: 6765 7865 733d 7365 6374 696f 6e5f 7265  gexes=section_re
+00008910: 6765 7865 7329 0a20 2020 2020 2020 2048  gexes).        H
+00008920: 746d 6c47 726f 7570 2e65 7874 7261 6374  tmlGroup.extract
+00008930: 5f66 6f6f 746e 6f74 6573 5f74 6f5f 6261  _footnotes_to_ba
+00008940: 636b 2868 746d 6c5f 656c 656d 290a 2020  ck(html_elem).  
+00008950: 2020 2020 2020 6e65 775f 6469 7620 3d20        new_div = 
+00008960: 4874 6d6c 4772 6f75 702e 6772 6f75 705f  HtmlGroup.group_
+00008970: 6469 7673 5f69 6e74 6f5f 7472 6565 2848  divs_into_tree(H
+00008980: 746d 6c4c 6962 2e67 6574 5f62 6f64 7928  tmlLib.get_body(
+00008990: 6874 6d6c 5f65 6c65 6d29 290a 2020 2020  html_elem)).    
+000089a0: 2020 2020 4874 6d6c 4772 6f75 702e 7265      HtmlGroup.re
+000089b0: 6d6f 7665 5f65 6d70 7479 5f64 6976 7328  move_empty_divs(
+000089c0: 6e65 775f 6469 7629 0a20 2020 2020 2020  new_div).       
+000089d0: 2048 746d 6c47 726f 7570 2e6a 6f69 6e5f   HtmlGroup.join_
+000089e0: 7370 6c69 745f 6469 7673 286e 6577 5f64  split_divs(new_d
+000089f0: 6976 290a 2020 2020 2020 2020 4874 6d6c  iv).        Html
+00008a00: 4772 6f75 702e 6164 645f 7061 7261 6772  Group.add_paragr
+00008a10: 6170 685f 6964 7328 6e65 775f 6469 7629  aph_ids(new_div)
+00008a20: 0a20 2020 2020 2020 2023 2074 7261 6e73  .        # trans
+00008a30: 6665 7220 746f 206e 6577 2065 6c65 6d65  fer to new eleme
+00008a40: 6e74 2028 6d61 7920 6e6f 7420 6265 206e  nt (may not be n
+00008a50: 6563 6573 7361 7279 3f29 0a20 2020 2020  ecessary?).     
+00008a60: 2020 206e 6577 5f68 746d 6c20 3d20 4874     new_html = Ht
+00008a70: 6d6c 4c69 622e 6372 6561 7465 5f68 746d  mlLib.create_htm
+00008a80: 6c5f 7769 7468 5f65 6d70 7479 5f68 6561  l_with_empty_hea
+00008a90: 645f 626f 6479 2829 0a20 2020 2020 2020  d_body().       
+00008aa0: 2048 746d 6c4c 6962 2e67 6574 5f62 6f64   HtmlLib.get_bod
+00008ab0: 7928 6e65 775f 6874 6d6c 292e 6170 7065  y(new_html).appe
+00008ac0: 6e64 286e 6577 5f64 6976 290a 2020 2020  nd(new_div).    
+00008ad0: 2020 2020 4874 6d6c 5374 796c 652e 7472      HtmlStyle.tr
+00008ae0: 616e 7366 6572 5f68 6561 645f 7374 796c  ansfer_head_styl
+00008af0: 6573 2868 746d 6c5f 656c 656d 2c20 6e65  es(html_elem, ne
+00008b00: 775f 6874 6d6c 290a 2020 2020 2020 2020  w_html).        
+00008b10: 4874 6d6c 4772 6f75 702e 636f 6c6c 6563  HtmlGroup.collec
+00008b20: 745f 666c 6f61 7473 5f74 6f5f 6261 636b  t_floats_to_back
+00008b30: 286e 6577 5f68 746d 6c29 0a20 2020 2020  (new_html).     
+00008b40: 2020 2048 746d 6c47 726f 7570 2e61 6e6e     HtmlGroup.ann
+00008b50: 6f74 6174 655f 6970 6363 5f74 6172 6765  otate_ipcc_targe
+00008b60: 745f 6964 7328 6e65 775f 6874 6d6c 290a  t_ids(new_html).
+00008b70: 2020 2020 2020 2020 6966 206f 7574 6469          if outdi
+00008b80: 723a 0a20 2020 2020 2020 2020 2020 2048  r:.            H
+00008b90: 746d 6c4c 6962 2e77 7269 7465 5f68 746d  tmlLib.write_htm
+00008ba0: 6c5f 6669 6c65 286e 6577 5f68 746d 6c2c  l_file(new_html,
+00008bb0: 2050 6174 6828 6f75 7464 6972 2c20 6622   Path(outdir, f"
+00008bc0: 7b73 7465 6d7d 5f67 726f 7570 732e 6874  {stem}_groups.ht
+00008bd0: 6d6c 2229 2c20 6465 6275 673d 5472 7565  ml"), debug=True
+00008be0: 290a 2020 2020 2020 2020 7370 6c69 745f  ).        split_
+00008bf0: 7370 616e 5f72 6567 6578 203d 2022 283f  span_regex = "(?
+00008c00: 503c 7072 653e 2e2a 283f 3a68 6967 687c  P<pre>.*(?:high|
+00008c10: 6d65 6469 756d 7c6c 6f77 295c 5c73 2a28  medium|low)\\s*(
+00008c20: 636f 6e66 6964 656e 6365 2929 283f 503c  confidence))(?P<
+00008c30: 706f 7374 3e2e 2a29 220a 2020 2020 2020  post>.*)".      
+00008c40: 2020 4874 6d6c 4772 6f75 702e 7370 6c69    HtmlGroup.spli
+00008c50: 745f 7370 616e 7328 6e65 775f 6874 6d6c  t_spans(new_html
+00008c60: 2c20 7370 6c69 745f 7370 616e 5f72 6567  , split_span_reg
+00008c70: 6578 290a 2020 2020 2020 2020 6966 206f  ex).        if o
+00008c80: 7574 6469 723a 0a20 2020 2020 2020 2020  utdir:.         
+00008c90: 2020 2048 746d 6c4c 6962 2e77 7269 7465     HtmlLib.write
+00008ca0: 5f68 746d 6c5f 6669 6c65 286e 6577 5f68  _html_file(new_h
+00008cb0: 746d 6c2c 2050 6174 6828 6f75 7464 6972  tml, Path(outdir
+00008cc0: 2c20 6622 7b73 7465 6d7d 5f73 7461 7465  , f"{stem}_state
+00008cd0: 6d65 6e74 732e 6874 6d6c 2229 2c20 6465  ments.html"), de
+00008ce0: 6275 673d 5472 7565 290a 0a20 2020 2020  bug=True)..     
+00008cf0: 2020 2072 6574 7572 6e20 6e65 775f 6874     return new_ht
+00008d00: 6d6c 0a0a 2020 2020 4063 6c61 7373 6d65  ml..    @classme
+00008d10: 7468 6f64 0a20 2020 2064 6566 2067 726f  thod.    def gro
+00008d20: 7570 5f6e 6573 7465 645f 7369 626c 696e  up_nested_siblin
+00008d30: 6773 2863 6c73 2c20 6874 6d6c 5f65 6c65  gs(cls, html_ele
+00008d40: 6d2c 2073 7479 6c65 733d 4e6f 6e65 293a  m, styles=None):
+00008d50: 0a20 2020 2020 2020 2069 6620 7374 796c  .        if styl
+00008d60: 6573 2069 7320 4e6f 6e65 3a0a 2020 2020  es is None:.    
+00008d70: 2020 2020 2020 2020 7374 796c 6573 203d          styles =
+00008d80: 205b 0a20 2020 2020 2020 2020 2020 2020   [.             
+00008d90: 2020 2022 626f 7264 6572 203a 2073 6f6c     "border : sol
+00008da0: 6964 2070 7572 706c 6520 3270 783b 206d  id purple 2px; m
+00008db0: 6172 6769 6e3a 3270 783b 222c 0a20 2020  argin:2px;",.   
+00008dc0: 2020 2020 2020 2020 2020 2020 2022 626f               "bo
+00008dd0: 7264 6572 203a 2064 6173 6865 6420 6772  rder : dashed gr
+00008de0: 6565 6e20 312e 3570 783b 206d 6172 6769  een 1.5px; margi
+00008df0: 6e3a 312e 3570 783b 222c 0a20 2020 2020  n:1.5px;",.     
+00008e00: 2020 2020 2020 2020 2020 2022 626f 7264             "bord
+00008e10: 6572 203a 2064 6f74 7465 6420 626c 7565  er : dotted blue
+00008e20: 2031 7078 3b20 6d61 7267 696e 3a31 7078   1px; margin:1px
+00008e30: 3b22 2c0a 2020 2020 2020 2020 2020 2020  ;",.            
+00008e40: 5d0a 0a20 2020 2020 2020 2048 746d 6c47  ]..        HtmlG
+00008e50: 726f 7570 2e67 726f 7570 5f73 6962 6c69  roup.group_sibli
+00008e60: 6e67 7328 6874 6d6c 5f65 6c65 6d2c 206c  ngs(html_elem, l
+00008e70: 6f63 6174 6f72 3d22 7365 6374 696f 6e22  ocator="section"
+00008e80: 2c20 7374 796c 653d 7374 796c 6573 5b30  , style=styles[0
+00008e90: 5d29 0a20 2020 2020 2020 2048 746d 6c47  ]).        HtmlG
+00008ea0: 726f 7570 2e67 726f 7570 5f73 6962 6c69  roup.group_sibli
+00008eb0: 6e67 7328 6874 6d6c 5f65 6c65 6d2c 206c  ngs(html_elem, l
+00008ec0: 6f63 6174 6f72 3d22 7375 625f 7365 6374  ocator="sub_sect
+00008ed0: 696f 6e22 2c20 7374 796c 653d 7374 796c  ion", style=styl
+00008ee0: 6573 5b31 5d2c 2064 6562 7567 3d54 7275  es[1], debug=Tru
+00008ef0: 6529 0a20 2020 2020 2020 2048 746d 6c47  e).        HtmlG
+00008f00: 726f 7570 2e67 726f 7570 5f73 6962 6c69  roup.group_sibli
+00008f10: 6e67 7328 6874 6d6c 5f65 6c65 6d2c 206c  ngs(html_elem, l
+00008f20: 6f63 6174 6f72 3d22 7375 625f 7375 625f  ocator="sub_sub_
+00008f30: 7365 6374 696f 6e22 2c20 7374 796c 653d  section", style=
+00008f40: 7374 796c 6573 5b32 5d29 0a0a 2020 2020  styles[2])..    
+00008f50: 4063 6c61 7373 6d65 7468 6f64 0a20 2020  @classmethod.   
+00008f60: 2064 6566 2061 6e6e 6f74 6174 655f 6970   def annotate_ip
+00008f70: 6363 5f74 6172 6765 745f 6964 7328 636c  cc_target_ids(cl
+00008f80: 732c 2068 746d 6c5f 656c 656d 293a 0a20  s, html_elem):. 
+00008f90: 2020 2020 2020 2022 2222 6669 6e64 7320         """finds 
+00008fa0: 7365 6374 696f 6e73 206f 6620 666f 726d  sections of form
+00008fb0: 207b 7461 7267 6574 5f69 642c 2074 6172   {target_id, tar
+00008fc0: 6765 745f 6964 2e2e 2e7d 2061 6e64 2061  get_id...} and a
+00008fd0: 6464 7320 636c 6173 733d 7461 7267 6574  dds class=target
+00008fe0: 730a 2020 2020 2020 2020 5468 6973 2069  s.        This i
+00008ff0: 7320 6265 7474 6572 2064 6f6e 6520 696e  s better done in
+00009000: 2074 6865 2061 6e6e 6f74 6174 6f72 2077   the annotator w
+00009010: 6f72 6b66 6c6f 7720 7768 6572 6520 6974  orkflow where it
+00009020: 2077 6f72 6b73 2e20 5468 6973 2069 7320   works. This is 
+00009030: 6120 6861 636b 2066 6f72 0a20 2020 2020  a hack for.     
+00009040: 2020 2066 696c 6573 2077 6869 6368 2068     files which h
+00009050: 6176 6520 6265 656e 206d 6973 7365 6422  ave been missed"
+00009060: 2222 0a20 2020 2020 2020 2072 655f 6375  "".        re_cu
+00009070: 726c 7920 3d20 7265 2e63 6f6d 7069 6c65  rly = re.compile
+00009080: 2872 2228 3f50 3c70 7265 3e2e 2a29 7b28  (r"(?P<pre>.*){(
+00009090: 3f50 3c62 6f64 793e 5b5e 7d5d 2b29 7d28  ?P<body>[^}]+)}(
+000090a0: 3f50 3c70 6f73 743e 2e2a 2922 290a 2020  ?P<post>.*)").  
+000090b0: 2020 2020 2020 5441 5247 4554 5320 3d20        TARGETS = 
+000090c0: 2274 6172 6765 7473 220a 2020 2020 2020  "targets".      
+000090d0: 2020 6375 726c 795f 7370 616e 7320 3d20    curly_spans = 
+000090e0: 6874 6d6c 5f65 6c65 6d2e 7870 6174 6828  html_elem.xpath(
+000090f0: 6622 2e2f 2f73 7061 6e5b 636f 6e74 6169  f".//span[contai
+00009100: 6e73 282e 2c20 277b 7b27 2920 616e 6420  ns(., '{{') and 
+00009110: 636f 6e74 6169 6e73 282e 2c20 277d 7d27  contains(., '}}'
+00009120: 295d 2229 0a20 2020 2020 2020 206c 6f67  )]").        log
+00009130: 6765 722e 6465 6275 6728 6622 666f 756e  ger.debug(f"foun
+00009140: 6420 6375 726c 6965 7320 7b6c 656e 2863  d curlies {len(c
+00009150: 7572 6c79 5f73 7061 6e73 297d 2229 0a20  urly_spans)}"). 
+00009160: 2020 2020 2020 2066 6f72 2073 7061 6e20         for span 
+00009170: 696e 2063 7572 6c79 5f73 7061 6e73 3a0a  in curly_spans:.
+00009180: 2020 2020 2020 2020 2020 2020 7061 7265              pare
+00009190: 6e74 203d 2073 7061 6e2e 6765 7470 6172  nt = span.getpar
+000091a0: 656e 7428 290a 2020 2020 2020 2020 2020  ent().          
+000091b0: 2020 6d61 7463 6820 3d20 7265 5f63 7572    match = re_cur
+000091c0: 6c79 2e6d 6174 6368 2873 7061 6e2e 7465  ly.match(span.te
+000091d0: 7874 290a 2020 2020 2020 2020 2020 2020  xt).            
+000091e0: 6966 206d 6174 6368 3a0a 2020 2020 2020  if match:.      
+000091f0: 2020 2020 2020 2020 2020 666f 7220 6770            for gp
+00009200: 2069 6e20 5b22 7072 6522 2c20 2262 6f64   in ["pre", "bod
+00009210: 7922 2c20 2270 6f73 7422 5d3a 0a20 2020  y", "post"]:.   
+00009220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009230: 2074 203d 206d 6174 6368 2e67 726f 7570   t = match.group
+00009240: 2867 7029 0a20 2020 2020 2020 2020 2020  (gp).           
+00009250: 2020 2020 2020 2020 2069 6620 6c65 6e28           if len(
+00009260: 7429 203e 2030 3a0a 2020 2020 2020 2020  t) > 0:.        
+00009270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009280: 6966 2067 7020 3d3d 2022 626f 6479 223a  if gp == "body":
+00009290: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000092a0: 2020 2020 2020 2020 2020 2020 2074 6172               tar
+000092b0: 6765 745f 6964 7320 3d20 7265 2e73 706c  get_ids = re.spl
+000092c0: 6974 2822 5b2c 3b5d 222c 2074 290a 2020  it("[,;]", t).  
+000092d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000092e0: 2020 2020 2020 2020 2020 666f 7220 7461            for ta
+000092f0: 7267 6574 5f69 6420 696e 2074 6172 6765  rget_id in targe
+00009300: 745f 6964 733a 0a20 2020 2020 2020 2020  t_ids:.         
+00009310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009320: 2020 2020 2020 2061 203d 2045 542e 5375         a = ET.Su
+00009330: 6245 6c65 6d65 6e74 2870 6172 656e 742c  bElement(parent,
+00009340: 2022 6122 290a 2020 2020 2020 2020 2020   "a").          
+00009350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009360: 2020 2020 2020 7370 616e 2e61 6464 7072        span.addpr
+00009370: 6576 696f 7573 2861 290a 2020 2020 2020  evious(a).      
+00009380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009390: 2020 2020 2020 2020 2020 612e 7465 7874            a.text
+000093a0: 203d 2074 6172 6765 745f 6964 0a20 2020   = target_id.   
+000093b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000093c0: 2020 2020 2020 2020 2020 2020 2061 2e61               a.a
+000093d0: 7474 7269 625b 2268 7265 6622 5d20 3d20  ttrib["href"] = 
+000093e0: 6765 745f 7461 7267 6574 5f68 7265 6628  get_target_href(
+000093f0: 7429 0a20 2020 2020 2020 2020 2020 2020  t).             
+00009400: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00009410: 2070 6172 656e 742e 7265 6d6f 7665 2873   parent.remove(s
+00009420: 7061 6e29 0a20 2020 2020 2020 2020 2020  pan).           
+00009430: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+00009440: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00009450: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00009460: 7061 6e78 203d 2045 542e 5375 6245 6c65  panx = ET.SubEle
+00009470: 6d65 6e74 2870 6172 656e 742c 2022 7370  ment(parent, "sp
+00009480: 616e 2229 0a20 2020 2020 2020 2020 2020  an").           
+00009490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000094a0: 2073 7061 6e78 2e74 6578 7420 3d20 740a   spanx.text = t.
+000094b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000094c0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+000094d0: 6174 7420 696e 2073 7061 6e2e 6174 7472  att in span.attr
+000094e0: 6962 3a0a 2020 2020 2020 2020 2020 2020  ib:.            
+000094f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009500: 2020 2020 7370 616e 782e 6174 7472 6962      spanx.attrib
+00009510: 5b61 7474 5d20 3d20 7370 616e 2e61 7474  [att] = span.att
+00009520: 7269 625b 6174 745d 0a20 2020 2020 2020  rib[att].       
+00009530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009540: 2020 2020 2073 7061 6e2e 6164 6470 7265       span.addpre
+00009550: 7669 6f75 7328 7370 616e 7829 0a20 2020  vious(spanx).   
+00009560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009570: 2020 2020 2020 2020 2073 7061 6e78 2e61           spanx.a
+00009580: 7474 7269 625b 2261 6e63 686f 7222 5d20  ttrib["anchor"] 
+00009590: 3d20 6770 0a0a 2020 2020 2020 2020 2020  = gp..          
+000095a0: 2020 2020 2020 7061 7265 6e74 2e72 656d        parent.rem
+000095b0: 6f76 6528 7370 616e 290a 0a20 2020 2020  ove(span)..     
+000095c0: 2020 2020 2020 2073 7061 6e2e 6174 7472         span.attr
+000095d0: 6962 5b22 636c 6173 7322 5d20 3d20 5441  ib["class"] = TA
+000095e0: 5247 4554 530a 0a20 2020 2040 636c 6173  RGETS..    @clas
+000095f0: 736d 6574 686f 640a 2020 2020 6465 6620  smethod.    def 
+00009600: 6578 7472 6163 745f 7365 6374 696f 6e5f  extract_section_
+00009610: 6964 7328 636c 732c 2068 746d 6c5f 656c  ids(cls, html_el
+00009620: 656d 2c20 7870 6174 6873 3d5b 222e 2f2f  em, xpaths=[".//
+00009630: 6469 7622 2c20 222e 2f73 7061 6e22 5d2c  div", "./span"],
+00009640: 2072 6567 6578 6573 3d4e 6f6e 6529 3a0a   regexes=None):.
+00009650: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00009660: 2020 2020 6578 7472 6163 7473 2073 6563      extracts sec
+00009670: 7469 6f6e 7320 616e 6420 706f 7373 6962  tions and possib
+00009680: 6c79 2073 7562 7365 6374 696f 6e73 2066  ly subsections f
+00009690: 726f 6d20 636f 6d70 6f75 6e64 2065 6c65  rom compound ele
+000096a0: 6d65 6e74 7320 2865 2e67 2e20 6469 7629  ments (e.g. div)
+000096b0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+000096c0: 6874 6d6c 5f65 6c65 6d3a 2063 6f6d 706f  html_elem: compo
+000096d0: 756e 6420 656c 656d 656e 740a 2020 2020  und element.    
+000096e0: 2020 2020 3a70 6172 616d 2078 7061 7468      :param xpath
+000096f0: 733a 206c 6973 7420 6f66 2078 7061 7468  s: list of xpath
+00009700: 2066 6f72 2073 6563 7469 6f6e 2c20 6f70   for section, op
+00009710: 7469 6f6e 616c 2073 7562 7365 6374 696f  tional subsectio
+00009720: 6e2c 2063 7572 7265 6e74 6c79 206c 656e  n, currently len
+00009730: 2031 206f 7220 322c 0a20 2020 2020 2020   1 or 2,.       
+00009740: 2020 2073 696e 676c 6520 7870 6174 6820     single xpath 
+00009750: 6973 2074 6865 6e20 7772 6170 7065 6420  is then wrapped 
+00009760: 746f 206c 6973 743b 2064 6566 6175 6c74  to list; default
+00009770: 205b 222e 2f2f 6469 7622 2c20 222e 2f73   [".//div", "./s
+00009780: 7061 6e22 5d0a 2020 2020 2020 2020 3a70  pan"].        :p
+00009790: 6172 616d 2072 6567 6578 6573 3a20 6c69  aram regexes: li
+000097a0: 7374 206f 6620 7265 6765 7865 7320 666f  st of regexes fo
+000097b0: 7220 6561 6368 2064 6573 6365 6e74 3b20  r each descent; 
+000097c0: 7369 6e67 6c65 2069 7320 7772 6170 7065  single is wrappe
+000097d0: 6420 746f 206c 6973 7420 3b20 6966 206e  d to list ; if n
+000097e0: 6f6e 6520 6769 7665 6e0a 2020 2020 2020  one given.      
+000097f0: 2020 2020 6163 6365 7074 7320 616c 6c20      accepts all 
+00009800: 6465 7363 656e 6461 6e74 7320 6672 6f6d  descendants from
+00009810: 2078 7061 7468 0a20 2020 2020 2020 2022   xpath.        "
+00009820: 2222 0a20 2020 2020 2020 2069 6620 6e6f  "".        if no
+00009830: 7420 7870 6174 6873 3a0a 2020 2020 2020  t xpaths:.      
+00009840: 2020 2020 2020 7265 7475 726e 204e 6f6e        return Non
+00009850: 650a 2020 2020 2020 2020 6966 206e 6f74  e.        if not
+00009860: 2074 7970 6528 7870 6174 6873 2920 6973   type(xpaths) is
+00009870: 206c 6973 743a 0a20 2020 2020 2020 2020   list:.         
+00009880: 2020 2078 7061 7468 7320 3d20 5b78 7061     xpaths = [xpa
+00009890: 7468 735d 0a20 2020 2020 2020 2061 7373  ths].        ass
+000098a0: 6572 7420 3020 3c20 6c65 6e28 7870 6174  ert 0 < len(xpat
+000098b0: 6873 2920 3c3d 2032 2c20 6622 6e6f 2078  hs) <= 2, f"no x
+000098c0: 7061 7468 7320 6769 7665 6e22 0a0a 2020  paths given"..  
+000098d0: 2020 2020 2020 6966 206e 6f74 2072 6567        if not reg
+000098e0: 6578 6573 3a0a 2020 2020 2020 2020 2020  exes:.          
+000098f0: 2020 7265 6765 7865 7320 3d20 5b5d 0a20    regexes = []. 
+00009900: 2020 2020 2020 2069 6620 6e6f 7420 7479         if not ty
+00009910: 7065 2872 6567 6578 6573 2920 6973 206c  pe(regexes) is l
+00009920: 6973 743a 0a20 2020 2020 2020 2020 2020  ist:.           
+00009930: 2072 6567 6578 6573 203d 205b 7265 6765   regexes = [rege
+00009940: 7865 735d 0a0a 2020 2020 2020 2020 6469  xes]..        di
+00009950: 7673 203d 2068 746d 6c5f 656c 656d 2e78  vs = html_elem.x
+00009960: 7061 7468 2878 7061 7468 735b 305d 290a  path(xpaths[0]).
+00009970: 2020 2020 2020 2020 7365 6374 696f 6e73          sections
+00009980: 203d 205b 5d0a 2020 2020 2020 2020 7375   = [].        su
+00009990: 6273 6563 7469 6f6e 7320 3d20 5b5d 0a20  bsections = []. 
+000099a0: 2020 2020 2020 2066 6f72 2064 6976 2069         for div i
+000099b0: 6e20 6469 7673 3a0a 2020 2020 2020 2020  n divs:.        
+000099c0: 2020 2020 6966 206c 656e 2872 6567 6578      if len(regex
+000099d0: 6573 2920 3e20 3020 616e 6420 7265 6765  es) > 0 and rege
+000099e0: 7865 735b 305d 3a0a 2020 2020 2020 2020  xes[0]:.        
+000099f0: 2020 2020 2020 2020 7365 6374 696f 6e5f          section_
+00009a00: 6964 203d 2048 746d 6c55 7469 6c2e 6578  id = HtmlUtil.ex
+00009a10: 7472 6163 745f 7375 6273 7472 696e 6773  tract_substrings
+00009a20: 2864 6976 2c20 7870 6174 683d 7870 6174  (div, xpath=xpat
+00009a30: 6873 5b30 5d2c 2072 6567 6578 3d72 6567  hs[0], regex=reg
+00009a40: 6578 6573 5b30 5d29 0a20 2020 2020 2020  exes[0]).       
+00009a50: 2020 2020 2020 2020 2069 6620 7365 6374           if sect
+00009a60: 696f 6e5f 6964 3a0a 2020 2020 2020 2020  ion_id:.        
+00009a70: 2020 2020 2020 2020 2020 2020 7365 6374              sect
+00009a80: 696f 6e73 2e61 7070 656e 6428 7365 6374  ions.append(sect
+00009a90: 696f 6e5f 6964 290a 2020 2020 2020 2020  ion_id).        
+00009aa0: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
+00009ab0: 696e 7565 0a20 2020 2020 2020 2020 2020  inue.           
+00009ac0: 2069 6620 6c65 6e28 7265 6765 7865 7329   if len(regexes)
+00009ad0: 203e 2031 2061 6e64 2072 6567 6578 6573   > 1 and regexes
+00009ae0: 5b31 5d3a 0a20 2020 2020 2020 2020 2020  [1]:.           
+00009af0: 2020 2020 2073 7562 7365 6374 696f 6e5f       subsection_
+00009b00: 6964 203d 2048 746d 6c55 7469 6c2e 6578  id = HtmlUtil.ex
+00009b10: 7472 6163 745f 7375 6273 7472 696e 6773  tract_substrings
+00009b20: 2864 6976 2c20 7870 6174 683d 7870 6174  (div, xpath=xpat
+00009b30: 6873 5b31 5d2c 0a20 2020 2020 2020 2020  hs[1],.         
+00009b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00009b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009b90: 2020 2020 7265 6765 783d 7265 6765 7865      regex=regexe
-00009ba0: 735b 315d 2c0a 2020 2020 2020 2020 2020  s[1],.          
+00009b70: 2020 2072 6567 6578 3d72 6567 6578 6573     regex=regexes
+00009b80: 5b31 5d2c 0a20 2020 2020 2020 2020 2020  [1],.           
+00009b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00009bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009be0: 2020 7265 6d6f 7665 3d46 616c 7365 290a    remove=False).
-00009bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009c00: 6966 2073 7562 7365 6374 696f 6e5f 6964  if subsection_id
-00009c10: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00009c20: 2020 2020 2020 7375 6273 6563 7469 6f6e        subsection
-00009c30: 732e 6170 7065 6e64 2873 7562 7365 6374  s.append(subsect
-00009c40: 696f 6e5f 6964 290a 2020 2020 2020 2020  ion_id).        
-00009c50: 7265 7475 726e 2073 6563 7469 6f6e 732c  return sections,
-00009c60: 2073 7562 7365 6374 696f 6e73 0a0a 2020   subsections..  
-00009c70: 2020 4063 6c61 7373 6d65 7468 6f64 0a20    @classmethod. 
-00009c80: 2020 2064 6566 2061 6e6e 6f74 6174 655f     def annotate_
-00009c90: 6469 765f 7370 616e 735f 7772 6974 655f  div_spans_write_
-00009ca0: 6669 6e61 6c5f 6874 6d6c 2863 6c73 2c20  final_html(cls, 
-00009cb0: 696e 7075 745f 6874 6d6c 2c20 6f75 7466  input_html, outf
-00009cc0: 696c 652c 2073 7479 6c65 733d 4e6f 6e65  ile, styles=None
-00009cd0: 293a 0a20 2020 2020 2020 2069 6620 6e6f  ):.        if no
-00009ce0: 7420 7374 796c 6573 3a0a 2020 2020 2020  t styles:.      
-00009cf0: 2020 2020 2020 7374 796c 6573 203d 2048        styles = H
-00009d00: 746d 6c47 726f 7570 2e44 4546 4155 4c54  tmlGroup.DEFAULT
-00009d10: 5f53 5459 4c45 530a 2020 2020 2020 2020  _STYLES.        
-00009d20: 6874 6d6c 5f65 6c65 6d20 3d20 4554 2e70  html_elem = ET.p
-00009d30: 6172 7365 2873 7472 2869 6e70 7574 5f68  arse(str(input_h
-00009d40: 746d 6c29 292e 6765 7472 6f6f 7428 290a  tml)).getroot().
-00009d50: 2020 2020 2020 2020 616e 6e6f 7461 746f          annotato
-00009d60: 7220 3d20 4874 6d6c 416e 6e6f 7461 746f  r = HtmlAnnotato
-00009d70: 722e 6372 6561 7465 5f69 7063 635f 616e  r.create_ipcc_an
-00009d80: 6e6f 7461 746f 7228 290a 2020 2020 2020  notator().      
-00009d90: 2020 4874 6d6c 5374 796c 652e 6164 645f    HtmlStyle.add_
-00009da0: 6865 6164 5f73 7479 6c65 735f 6f72 6967  head_styles_orig
-00009db0: 2868 746d 6c5f 656c 656d 2c20 7374 796c  (html_elem, styl
-00009dc0: 6573 290a 2020 2020 2020 2020 7370 616e  es).        span
-00009dd0: 7320 3d20 6874 6d6c 5f65 6c65 6d2e 7870  s = html_elem.xp
-00009de0: 6174 6828 222e 2f2f 7370 616e 2229 0a20  ath(".//span"). 
-00009df0: 2020 2020 2020 2066 6f72 2073 7061 6e20         for span 
-00009e00: 696e 2073 7061 6e73 3a0a 2020 2020 2020  in spans:.      
-00009e10: 2020 2020 2020 616e 6e6f 7461 746f 722e        annotator.
-00009e20: 7275 6e5f 636f 6d6d 616e 6473 2873 7061  run_commands(spa
-00009e30: 6e29 0a20 2020 2020 2020 2048 746d 6c47  n).        HtmlG
-00009e40: 726f 7570 2e67 726f 7570 5f6e 6573 7465  roup.group_neste
-00009e50: 645f 7369 626c 696e 6773 2868 746d 6c5f  d_siblings(html_
-00009e60: 656c 656d 2c20 7374 796c 6573 3d4e 6f6e  elem, styles=Non
-00009e70: 6529 0a20 2020 2020 2020 2048 746d 6c4c  e).        HtmlL
-00009e80: 6962 2e77 7269 7465 5f68 746d 6c5f 6669  ib.write_html_fi
-00009e90: 6c65 2868 746d 6c5f 656c 656d 2c20 6f75  le(html_elem, ou
-00009ea0: 7466 696c 652c 2064 6562 7567 3d54 7275  tfile, debug=Tru
-00009eb0: 6529 0a0a 2020 2020 4063 6c61 7373 6d65  e)..    @classme
-00009ec0: 7468 6f64 0a20 2020 2064 6566 2073 706c  thod.    def spl
-00009ed0: 6974 5f73 7061 6e73 2863 6c73 2c20 6874  it_spans(cls, ht
-00009ee0: 6d6c 2c20 7370 6c69 745f 7370 616e 5f72  ml, split_span_r
-00009ef0: 6567 6578 293a 0a20 2020 2020 2020 2072  egex):.        r
-00009f00: 655f 7370 6c69 7420 3d20 7265 2e63 6f6d  e_split = re.com
-00009f10: 7069 6c65 2873 706c 6974 5f73 7061 6e5f  pile(split_span_
-00009f20: 7265 6765 7829 0a20 2020 2020 2020 2073  regex).        s
-00009f30: 7061 6e73 203d 2068 746d 6c2e 7870 6174  pans = html.xpat
-00009f40: 6828 222f 2f73 7061 6e22 290a 2020 2020  h("//span").    
-00009f50: 2020 2020 6e73 7061 6e73 203d 206c 656e      nspans = len
-00009f60: 2873 7061 6e73 290a 0a20 2020 2020 2020  (spans)..       
-00009f70: 2063 6c73 2e73 6361 6e5f 7265 6d61 696e   cls.scan_remain
-00009f80: 696e 675f 7370 616e 7328 7265 5f73 706c  ing_spans(re_spl
-00009f90: 6974 2c20 7370 616e 7329 0a0a 2020 2020  it, spans)..    
-00009fa0: 4063 6c61 7373 6d65 7468 6f64 0a20 2020  @classmethod.   
-00009fb0: 2064 6566 2073 6361 6e5f 7265 6d61 696e   def scan_remain
-00009fc0: 696e 675f 7370 616e 7328 636c 732c 2072  ing_spans(cls, r
-00009fd0: 655f 7370 6c69 742c 2073 7061 6e73 293a  e_split, spans):
-00009fe0: 0a20 2020 2020 2020 2064 6976 203d 204e  .        div = N
-00009ff0: 6f6e 650a 2020 2020 2020 2020 7768 696c  one.        whil
-0000a000: 6520 6c65 6e28 7370 616e 7329 203e 2030  e len(spans) > 0
-0000a010: 3a0a 2020 2020 2020 2020 2020 2020 666f  :.            fo
-0000a020: 7220 692c 2073 7061 6e20 696e 2065 6e75  r i, span in enu
-0000a030: 6d65 7261 7465 2873 7061 6e73 293a 0a20  merate(spans):. 
-0000a040: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0000a050: 6620 6469 7620 6973 206e 6f74 204e 6f6e  f div is not Non
-0000a060: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0000a070: 2020 2020 2020 2064 6976 2e61 7070 656e         div.appen
-0000a080: 6428 7370 616e 290a 2020 2020 2020 2020  d(span).        
-0000a090: 2020 2020 2020 2020 6d61 7463 6820 3d20          match = 
-0000a0a0: 7265 5f73 706c 6974 2e6d 6174 6368 2873  re_split.match(s
-0000a0b0: 7061 6e2e 7465 7874 290a 2020 2020 2020  pan.text).      
-0000a0c0: 2020 2020 2020 2020 2020 6966 206d 6174            if mat
-0000a0d0: 6368 3a0a 2020 2020 2020 2020 2020 2020  ch:.            
-0000a0e0: 2020 2020 2020 2020 7072 6520 3d20 6d61          pre = ma
-0000a0f0: 7463 682e 6772 6f75 7028 2270 7265 2229  tch.group("pre")
-0000a100: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a110: 2020 2020 2070 6f73 7420 3d20 6d61 7463       post = matc
-0000a120: 682e 6772 6f75 7028 2270 6f73 7422 290a  h.group("post").
-0000a130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a140: 2020 2020 7370 616e 2e74 6578 7420 3d20      span.text = 
-0000a150: 7072 650a 2020 2020 2020 2020 2020 2020  pre.            
-0000a160: 2020 2020 2020 2020 7061 7265 6e74 5f64          parent_d
-0000a170: 6976 203d 2073 7061 6e2e 6765 7470 6172  iv = span.getpar
-0000a180: 656e 7428 290a 2020 2020 2020 2020 2020  ent().          
-0000a190: 2020 2020 2020 2020 2020 6e65 7874 5f73            next_s
-0000a1a0: 7061 6e20 3d20 4554 2e53 7562 456c 656d  pan = ET.SubElem
-0000a1b0: 656e 7428 7061 7265 6e74 5f64 6976 2c20  ent(parent_div, 
-0000a1c0: 2273 7061 6e22 290a 2020 2020 2020 2020  "span").        
-0000a1d0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-0000a1e0: 6174 7420 696e 2073 7061 6e2e 6174 7472  att in span.attr
-0000a1f0: 6962 3a0a 2020 2020 2020 2020 2020 2020  ib:.            
-0000a200: 2020 2020 2020 2020 2020 2020 6e65 7874              next
-0000a210: 5f73 7061 6e2e 6174 7472 6962 5b61 7474  _span.attrib[att
-0000a220: 5b30 5d5d 203d 2061 7474 5b31 5d0a 2020  [0]] = att[1].  
-0000a230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a240: 2020 2020 2020 7370 616e 2e61 6464 6e65        span.addne
-0000a250: 7874 286e 6578 745f 7370 616e 290a 2020  xt(next_span).  
-0000a260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a270: 2020 7370 616e 7320 3d20 7370 616e 735b    spans = spans[
-0000a280: 6920 2b20 313a 5d0a 2020 2020 2020 2020  i + 1:].        
-0000a290: 2020 2020 2020 2020 2020 2020 6469 7620              div 
-0000a2a0: 3d20 4554 2e53 7562 456c 656d 656e 7428  = ET.SubElement(
-0000a2b0: 7061 7265 6e74 5f64 6976 2e67 6574 7061  parent_div.getpa
-0000a2c0: 7265 6e74 2829 2c20 2264 6976 2229 0a0a  rent(), "div")..
-0000a2d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a2e0: 2020 2020 6272 6561 6b0a 2020 2020 2020      break.      
-0000a2f0: 2020 2020 2020 2020 2020 6966 2069 203d            if i =
-0000a300: 3d20 6c65 6e28 7370 616e 7329 202d 2031  = len(spans) - 1
-0000a310: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000a320: 2020 2020 2020 7370 616e 7320 3d20 5b5d        spans = []
-0000a330: 0a0a 0a0a 636c 6173 7320 4874 6d6c 5574  ....class HtmlUt
-0000a340: 696c 3a0a 2020 2020 5343 5249 5054 5f46  il:.    SCRIPT_F
-0000a350: 4143 5420 3d20 302e 3920 2023 206d 6179  ACT = 0.9  # may
-0000a360: 6265 2073 686f 6c64 6e27 7420 6265 2068  be sholdn't be h
-0000a370: 6572 653b 2061 766f 6964 2063 6972 6375  ere; avoid circu
-0000a380: 6c61 720a 2020 2020 4d41 524b 4552 203d  lar.    MARKER =
-0000a390: 2022 6d61 726b 6572 220a 0a0a 2020 2020   "marker"...    
-0000a3a0: 4063 6c61 7373 6d65 7468 6f64 0a20 2020  @classmethod.   
-0000a3b0: 2064 6566 2072 656d 6f76 655f 656d 7074   def remove_empt
-0000a3c0: 795f 656c 656d 656e 7473 2863 6c73 2c20  y_elements(cls, 
-0000a3d0: 656c 656d 2c20 7461 6729 3a0a 2020 2020  elem, tag):.    
-0000a3e0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0000a3f0: 4d61 7962 6520 6d6f 7665 2074 6f20 4854  Maybe move to HT
-0000a400: 4d4c 5469 6479 0a20 2020 2020 2020 2022  MLTidy.        "
-0000a410: 2222 0a20 2020 2020 2020 2069 6620 7461  "".        if ta
-0000a420: 673a 0a20 2020 2020 2020 2020 2020 2069  g:.            i
-0000a430: 6620 7479 7065 2874 6167 2920 6973 206c  f type(tag) is l
-0000a440: 6973 743a 0a20 2020 2020 2020 2020 2020  ist:.           
-0000a450: 2020 2020 2066 6f72 2074 2069 6e20 7461       for t in ta
-0000a460: 673a 0a20 2020 2020 2020 2020 2020 2020  g:.             
-0000a470: 2020 2020 2020 2063 6c73 2e72 656d 6f76         cls.remov
-0000a480: 655f 656d 7074 795f 656c 656d 656e 7473  e_empty_elements
-0000a490: 2865 6c65 6d2c 2074 290a 2020 2020 2020  (elem, t).      
-0000a4a0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0000a4b0: 2020 2020 2020 2020 2020 2020 7870 203d              xp =
-0000a4c0: 2066 222e 2f2f 7b74 6167 7d5b 6e6f 726d   f".//{tag}[norm
-0000a4d0: 616c 697a 652d 7370 6163 6528 2e29 3d27  alize-space(.)='
-0000a4e0: 2720 616e 6420 636f 756e 7428 7b74 6167  ' and count({tag
-0000a4f0: 7d2f 2a29 203d 2030 5d22 0a20 2020 2020  }/*) = 0]".     
-0000a500: 2020 2020 2020 2020 2020 2065 6c65 6d73             elems
-0000a510: 203d 2065 6c65 6d2e 7870 6174 6828 7870   = elem.xpath(xp
-0000a520: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000a530: 2020 666f 7220 656c 2069 6e20 656c 656d    for el in elem
-0000a540: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-0000a550: 2020 2020 2020 2063 6c73 2e72 656d 6f76         cls.remov
-0000a560: 655f 656c 656d 5f6b 6565 705f 7461 696c  e_elem_keep_tail
-0000a570: 2865 6c29 0a0a 2020 2020 4063 6c61 7373  (el)..    @class
-0000a580: 6d65 7468 6f64 0a20 2020 2064 6566 2072  method.    def r
-0000a590: 656d 6f76 655f 656c 656d 5f6b 6565 705f  emove_elem_keep_
-0000a5a0: 7461 696c 2863 6c73 2c20 656c 293a 0a20  tail(cls, el):. 
-0000a5b0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0000a5c0: 2020 204d 6179 6265 206d 6f76 6520 746f     Maybe move to
-0000a5d0: 2048 544d 4c54 6964 790a 2020 2020 2020   HTMLTidy.      
-0000a5e0: 2020 2222 220a 2020 2020 2020 2020 7061    """.        pa
-0000a5f0: 7265 6e74 203d 2065 6c2e 6765 7470 6172  rent = el.getpar
-0000a600: 656e 7428 290a 2020 2020 2020 2020 7461  ent().        ta
-0000a610: 696c 203d 2065 6c2e 7461 696c 0a20 2020  il = el.tail.   
-0000a620: 2020 2020 2069 6620 7461 696c 2069 7320       if tail is 
-0000a630: 6e6f 7420 4e6f 6e65 2061 6e64 206c 656e  not None and len
-0000a640: 2874 6169 6c2e 7374 7269 7028 2929 203e  (tail.strip()) >
-0000a650: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
-0000a660: 7072 6576 203d 2065 6c2e 6765 7470 7265  prev = el.getpre
-0000a670: 7669 6f75 7328 290a 2020 2020 2020 2020  vious().        
-0000a680: 2020 2020 6966 2070 7265 7620 6973 206e      if prev is n
-0000a690: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-0000a6a0: 2020 2020 2020 2020 2070 7265 762e 7461           prev.ta
-0000a6b0: 696c 203d 2028 7072 6576 2e74 6169 6c20  il = (prev.tail 
-0000a6c0: 6f72 2027 2729 202b 2065 6c2e 7461 696c  or '') + el.tail
-0000a6d0: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-0000a6e0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0000a6f0: 2020 2070 6172 656e 742e 7465 7874 203d     parent.text =
-0000a700: 2028 7061 7265 6e74 2e74 6578 7420 6f72   (parent.text or
-0000a710: 2027 2729 202b 2065 6c2e 7461 696c 0a0a   '') + el.tail..
-0000a720: 2020 2020 2020 2020 7061 7265 6e74 2e72          parent.r
-0000a730: 656d 6f76 6528 656c 290a 0a20 2020 2040  emove(el)..    @
-0000a740: 636c 6173 736d 6574 686f 640a 2020 2020  classmethod.    
-0000a750: 6465 6620 7370 6c69 745f 7370 616e 5f61  def split_span_a
-0000a760: 745f 6d61 7463 6828 636c 732c 2065 6c65  t_match(cls, ele
-0000a770: 6d78 2c20 7265 6765 782c 2063 6f70 795f  mx, regex, copy_
-0000a780: 6174 7473 3d54 7275 652c 2072 6563 7572  atts=True, recur
-0000a790: 7365 3d54 7275 652c 2069 645f 726f 6f74  se=True, id_root
-0000a7a0: 3d4e 6f6e 652c 2069 645f 636f 756e 7465  =None, id_counte
-0000a7b0: 723d 302c 0a20 2020 2020 2020 2020 2020  r=0,.           
-0000a7c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a7d0: 206e 6577 5f74 6167 733d 4e6f 6e65 293a   new_tags=None):
-0000a7e0: 0a20 2020 2020 2020 2022 2222 7370 6c69  .        """spli
-0000a7f0: 7473 2061 6e20 656c 656d 2028 6e6f 726d  ts an elem (norm
-0000a800: 616c 6c79 2073 7061 6e29 2069 6e74 6f20  ally span) into 
-0000a810: 3320 636f 6d70 6f6e 656e 7473 2062 7920  3 components by 
-0000a820: 7265 6765 7820 6d61 7463 680a 2020 2020  regex match.    
-0000a830: 2020 2020 3a70 6172 616d 2065 6c65 6d78      :param elemx
-0000a840: 3a20 656c 656d 2074 6f20 7370 6c69 7420  : elem to split 
-0000a850: 286e 6f72 6d61 6c6c 7920 6861 7320 6120  (normally has a 
-0000a860: 7061 7265 6e74 2028 652e 672e 2064 6976  parent (e.g. div
-0000a870: 290a 2020 2020 2020 2020 3a70 6172 616d  ).        :param
-0000a880: 2072 6567 6578 3a20 7265 6765 7820 746f   regex: regex to
-0000a890: 2073 706c 6974 2065 6c65 6d20 286f 6620   split elem (of 
-0000a8a0: 666f 726d 2028 7072 6529 286d 6174 6368  form (pre)(match
-0000a8b0: 2928 706f 7374 290a 2020 2020 2020 2020  )(post).        
-0000a8c0: 3a70 6172 616d 2063 6f70 795f 6174 7473  :param copy_atts
-0000a8d0: 3a20 6966 2054 7275 6520 636f 7079 2061  : if True copy a
-0000a8e0: 7474 7320 6672 6f6d 2065 6c65 6d0a 2020  tts from elem.  
-0000a8f0: 2020 2020 2020 3a70 6172 616d 2072 6563        :param rec
-0000a900: 7572 7365 3a20 6966 2054 7275 652c 2072  urse: if True, r
-0000a910: 6573 6574 7320 656c 656d 2074 6f20 7472  esets elem to tr
-0000a920: 6169 6c69 6e67 2065 6c65 6d20 616e 6420  ailing elem and 
-0000a930: 7265 616e 6c79 7365 7320 756e 7469 6c20  reanlyses until 
-0000a940: 6e6f 206d 6f72 6520 6d61 7463 680a 2020  no more match.  
-0000a950: 2020 2020 2020 3a70 6172 616d 2069 645f        :param id_
-0000a960: 726f 6f74 3a20 6175 746f 2d67 656e 6572  root: auto-gener
-0000a970: 6174 6520 6964 7320 6275 696c 6469 6e67  ate ids building
-0000a980: 206f 6e20 6964 5f72 6f6f 740a 2020 2020   on id_root.    
-0000a990: 2020 2020 3a70 6172 616d 2069 645f 636f      :param id_co
-0000a9a0: 756e 7465 723a 2063 6f75 6e74 6572 2066  unter: counter f
-0000a9b0: 6f72 2069 6473 0a20 2020 2020 2020 203a  or ids.        :
-0000a9c0: 7061 7261 6d20 6e65 775f 7461 6773 3a20  param new_tags: 
-0000a9d0: 6e65 775f 656c 656d 656e 7420 7461 6773  new_element tags
-0000a9e0: 2028 6465 6661 756c 7420 7370 616e 2c20   (default span, 
-0000a9f0: 7370 616e 2c20 7370 616e 290a 2020 2020  span, span).    
-0000aa00: 2020 2020 3a72 6574 7572 6e3a 206c 6973      :return: lis
-0000aa10: 7420 6f66 2033 2065 6c65 6d73 3b20 6966  t of 3 elems; if
-0000aa20: 206e 6577 5f65 6c65 6d73 5b32 5d20 6973   new_elems[2] is
-0000aa30: 206e 6f74 204e 6f6e 6520 6974 2773 2061   not None it's a
-0000aa40: 7661 696c 6162 6c65 2066 6f72 2072 6563  vailable for rec
-0000aa50: 7572 7369 6f6e 290a 2020 2020 2020 2020  ursion).        
-0000aa60: 2222 220a 2020 2020 2020 2020 6966 206e  """.        if n
-0000aa70: 6f74 206e 6577 5f74 6167 733a 0a20 2020  ot new_tags:.   
-0000aa80: 2020 2020 2020 2020 206e 6577 5f74 6167           new_tag
-0000aa90: 7320 3d20 5b48 5f53 5041 4e2c 2048 5f53  s = [H_SPAN, H_S
-0000aaa0: 5041 4e2c 2048 5f53 5041 4e5d 0a20 2020  PAN, H_SPAN].   
-0000aab0: 2020 2020 2061 7373 6572 7420 656c 656d       assert elem
-0000aac0: 7820 6973 206e 6f74 204e 6f6e 650a 2020  x is not None.  
-0000aad0: 2020 2020 2020 7465 7874 7820 3d20 4874        textx = Ht
-0000aae0: 6d6c 5574 696c 2e67 6574 5f74 6578 745f  mlUtil.get_text_
-0000aaf0: 636f 6e74 656e 7428 656c 656d 7829 0a20  content(elemx). 
-0000ab00: 2020 2020 2020 2072 6563 203d 2072 652e         rec = re.
-0000ab10: 636f 6d70 696c 6528 7265 6765 7829 0a20  compile(regex). 
-0000ab20: 2020 2020 2020 206d 6174 6368 203d 2072         match = r
-0000ab30: 6563 2e6d 6174 6368 2874 6578 7478 290a  ec.match(textx).
-0000ab40: 2020 2020 2020 2020 6e65 775f 656c 656d          new_elem
-0000ab50: 7320 3d20 5b4e 6f6e 652c 204e 6f6e 652c  s = [None, None,
-0000ab60: 204e 6f6e 655d 0a20 2020 2020 2020 2069   None].        i
-0000ab70: 6620 6d61 7463 683a 0a20 2020 2020 2020  f match:.       
-0000ab80: 2020 2020 2070 6172 656e 7420 3d20 656c       parent = el
-0000ab90: 656d 782e 6765 7470 6172 656e 7428 290a  emx.getparent().
-0000aba0: 2020 2020 2020 2020 2020 2020 6966 206c              if l
-0000abb0: 656e 286d 6174 6368 2e67 726f 7570 7328  en(match.groups(
-0000abc0: 2929 2021 3d20 333a 2020 2320 736f 6d65  )) != 3:  # some
-0000abd0: 206d 6179 2062 6520 656d 7074 7920 7374   may be empty st
-0000abe0: 7269 6e67 730a 2020 2020 2020 2020 2020  rings.          
-0000abf0: 2020 2020 2020 6c6f 6767 696e 672e 7761        logging.wa
-0000ac00: 726e 696e 6728 6622 4361 6e6e 6f74 206d  rning(f"Cannot m
-0000ac10: 6174 6368 207b 7465 7874 787d 2061 6761  atch {textx} aga
-0000ac20: 696e 7374 207b 7265 6765 787d 2229 0a20  inst {regex}"). 
-0000ac30: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0000ac40: 6574 7572 6e20 6e65 775f 656c 656d 732c  eturn new_elems,
-0000ac50: 2069 645f 636f 756e 7465 720a 2020 2020   id_counter.    
-0000ac60: 2020 2020 2020 2020 6772 6f75 7031 203d          group1 =
-0000ac70: 206d 6174 6368 2e67 726f 7570 2831 290a   match.group(1).
-0000ac80: 2020 2020 2020 2020 2020 2020 6966 2067              if g
-0000ac90: 726f 7570 3120 213d 2022 223a 2020 2320  roup1 != "":  # 
-0000aca0: 646f 6e27 7420 6164 6420 656d 7074 7920  don't add empty 
-0000acb0: 7374 7269 6e67 0a20 2020 2020 2020 2020  string.         
-0000acc0: 2020 2020 2020 2065 6c65 6d78 203d 2048         elemx = H
-0000acd0: 746d 6c55 7469 6c2e 6164 645f 7369 626c  tmlUtil.add_sibl
-0000ace0: 696e 675f 6166 7465 7228 656c 656d 782c  ing_after(elemx,
-0000acf0: 206e 6577 5f74 6167 735b 305d 2c20 7265   new_tags[0], re
-0000ad00: 706c 6163 653d 5472 7565 2c20 636f 7079  place=True, copy
-0000ad10: 5f61 7474 733d 636f 7079 5f61 7474 732c  _atts=copy_atts,
-0000ad20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ad30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ad40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ad50: 2020 2020 7465 7874 3d67 726f 7570 3129      text=group1)
-0000ad60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ad70: 206e 6577 5f65 6c65 6d73 5b30 5d20 3d20   new_elems[0] = 
-0000ad80: 656c 656d 780a 2020 2020 2020 2020 2020  elemx.          
-0000ad90: 2020 2020 2020 6e65 775f 656c 656d 735b        new_elems[
-0000ada0: 305d 2e61 7474 7269 625b 415f 434c 4153  0].attrib[A_CLAS
-0000adb0: 535d 203d 2022 7265 5f70 7265 6622 0a20  S] = "re_pref". 
-0000adc0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0000add0: 645f 636f 756e 7465 7220 3d20 636c 732e  d_counter = cls.
-0000ade0: 6164 645f 6964 5f69 6e63 7265 6d65 6e74  add_id_increment
-0000adf0: 5f63 6f75 6e74 6572 2869 645f 636f 756e  _counter(id_coun
-0000ae00: 7465 722c 2069 645f 726f 6f74 2c20 656c  ter, id_root, el
-0000ae10: 656d 7829 0a20 2020 2020 2020 2020 2020  emx).           
-0000ae20: 206e 6577 5f65 6c65 6d73 5b31 5d20 3d20   new_elems[1] = 
-0000ae30: 4874 6d6c 5574 696c 2e61 6464 5f73 6962  HtmlUtil.add_sib
-0000ae40: 6c69 6e67 5f61 6674 6572 2865 6c65 6d78  ling_after(elemx
-0000ae50: 2c20 6e65 775f 7461 6773 5b31 5d2c 2063  , new_tags[1], c
-0000ae60: 6f70 795f 6174 7473 3d63 6f70 795f 6174  opy_atts=copy_at
-0000ae70: 7473 2c20 7465 7874 3d6d 6174 6368 2e67  ts, text=match.g
-0000ae80: 726f 7570 2832 2929 0a20 2020 2020 2020  roup(2)).       
-0000ae90: 2020 2020 206e 6577 5f65 6c65 6d73 5b31       new_elems[1
-0000aea0: 5d2e 6174 7472 6962 5b41 5f43 4c41 5353  ].attrib[A_CLASS
-0000aeb0: 5d20 3d20 2272 655f 6d61 7463 6822 0a20  ] = "re_match". 
-0000aec0: 2020 2020 2020 2020 2020 2069 645f 636f             id_co
-0000aed0: 756e 7465 7220 3d20 636c 732e 6164 645f  unter = cls.add_
-0000aee0: 6964 5f69 6e63 7265 6d65 6e74 5f63 6f75  id_increment_cou
-0000aef0: 6e74 6572 2869 645f 636f 756e 7465 722c  nter(id_counter,
-0000af00: 2069 645f 726f 6f74 2c20 6e65 775f 656c   id_root, new_el
-0000af10: 656d 735b 315d 290a 2020 2020 2020 2020  ems[1]).        
-0000af20: 2020 2020 6966 206d 6174 6368 2e67 726f      if match.gro
-0000af30: 7570 2833 2920 213d 2022 223a 2020 2320  up(3) != "":  # 
-0000af40: 646f 6e27 7420 6164 6420 656d 7074 7920  don't add empty 
-0000af50: 7374 7269 6e67 0a20 2020 2020 2020 2020  string.         
-0000af60: 2020 2020 2020 206e 6577 5f65 6c65 6d73         new_elems
-0000af70: 5b32 5d20 3d20 4874 6d6c 5574 696c 2e61  [2] = HtmlUtil.a
-0000af80: 6464 5f73 6962 6c69 6e67 5f61 6674 6572  dd_sibling_after
-0000af90: 286e 6577 5f65 6c65 6d73 5b31 5d2c 206e  (new_elems[1], n
-0000afa0: 6577 5f74 6167 735b 325d 2c20 636f 7079  ew_tags[2], copy
-0000afb0: 5f61 7474 733d 636f 7079 5f61 7474 732c  _atts=copy_atts,
-0000afc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000afd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000afe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000aff0: 2020 2020 2020 2020 2020 2074 6578 743d             text=
-0000b000: 6d61 7463 682e 6772 6f75 7028 3329 290a  match.group(3)).
-0000b010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b020: 6e65 775f 656c 656d 735b 325d 2e61 7474  new_elems[2].att
-0000b030: 7269 625b 415f 434c 4153 535d 203d 2022  rib[A_CLASS] = "
-0000b040: 7265 5f70 6f73 7422 0a0a 2020 2020 2020  re_post"..      
-0000b050: 2020 2020 2020 2020 2020 6964 5f63 6f75            id_cou
-0000b060: 6e74 6572 203d 2063 6c73 2e61 6464 5f69  nter = cls.add_i
-0000b070: 645f 696e 6372 656d 656e 745f 636f 756e  d_increment_coun
-0000b080: 7465 7228 6964 5f63 6f75 6e74 6572 2c20  ter(id_counter, 
-0000b090: 6964 5f72 6f6f 742c 206e 6577 5f65 6c65  id_root, new_ele
-0000b0a0: 6d73 5b32 5d29 0a20 2020 2020 2020 2020  ms[2]).         
-0000b0b0: 2020 2020 2020 2069 6620 7265 6375 7273         if recurs
-0000b0c0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0000b0d0: 2020 2020 2020 205f 2c20 6964 5f63 6f75         _, id_cou
-0000b0e0: 6e74 6572 203d 2048 746d 6c55 7469 6c2e  nter = HtmlUtil.
-0000b0f0: 7370 6c69 745f 7370 616e 5f61 745f 6d61  split_span_at_ma
-0000b100: 7463 6828 6e65 775f 656c 656d 735b 325d  tch(new_elems[2]
-0000b110: 2c20 7265 6765 782c 2063 6f70 795f 6174  , regex, copy_at
-0000b120: 7473 3d63 6f70 795f 6174 7473 2c0a 2020  ts=copy_atts,.  
+00009bc0: 2072 656d 6f76 653d 4661 6c73 6529 0a20   remove=False). 
+00009bd0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00009be0: 6620 7375 6273 6563 7469 6f6e 5f69 643a  f subsection_id:
+00009bf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009c00: 2020 2020 2073 7562 7365 6374 696f 6e73       subsections
+00009c10: 2e61 7070 656e 6428 7375 6273 6563 7469  .append(subsecti
+00009c20: 6f6e 5f69 6429 0a20 2020 2020 2020 2072  on_id).        r
+00009c30: 6574 7572 6e20 7365 6374 696f 6e73 2c20  eturn sections, 
+00009c40: 7375 6273 6563 7469 6f6e 730a 0a20 2020  subsections..   
+00009c50: 2040 636c 6173 736d 6574 686f 640a 2020   @classmethod.  
+00009c60: 2020 6465 6620 616e 6e6f 7461 7465 5f64    def annotate_d
+00009c70: 6976 5f73 7061 6e73 5f77 7269 7465 5f66  iv_spans_write_f
+00009c80: 696e 616c 5f68 746d 6c28 636c 732c 2069  inal_html(cls, i
+00009c90: 6e70 7574 5f68 746d 6c2c 206f 7574 6669  nput_html, outfi
+00009ca0: 6c65 2c20 7374 796c 6573 3d4e 6f6e 6529  le, styles=None)
+00009cb0: 3a0a 2020 2020 2020 2020 6966 206e 6f74  :.        if not
+00009cc0: 2073 7479 6c65 733a 0a20 2020 2020 2020   styles:.       
+00009cd0: 2020 2020 2073 7479 6c65 7320 3d20 4874       styles = Ht
+00009ce0: 6d6c 4772 6f75 702e 4445 4641 554c 545f  mlGroup.DEFAULT_
+00009cf0: 5354 594c 4553 0a20 2020 2020 2020 2068  STYLES.        h
+00009d00: 746d 6c5f 656c 656d 203d 2045 542e 7061  tml_elem = ET.pa
+00009d10: 7273 6528 7374 7228 696e 7075 745f 6874  rse(str(input_ht
+00009d20: 6d6c 2929 2e67 6574 726f 6f74 2829 0a20  ml)).getroot(). 
+00009d30: 2020 2020 2020 2061 6e6e 6f74 6174 6f72         annotator
+00009d40: 203d 2048 746d 6c41 6e6e 6f74 6174 6f72   = HtmlAnnotator
+00009d50: 2e63 7265 6174 655f 6970 6363 5f61 6e6e  .create_ipcc_ann
+00009d60: 6f74 6174 6f72 2829 0a20 2020 2020 2020  otator().       
+00009d70: 2048 746d 6c53 7479 6c65 2e61 6464 5f68   HtmlStyle.add_h
+00009d80: 6561 645f 7374 796c 6573 5f6f 7269 6728  ead_styles_orig(
+00009d90: 6874 6d6c 5f65 6c65 6d2c 2073 7479 6c65  html_elem, style
+00009da0: 7329 0a20 2020 2020 2020 2073 7061 6e73  s).        spans
+00009db0: 203d 2068 746d 6c5f 656c 656d 2e78 7061   = html_elem.xpa
+00009dc0: 7468 2822 2e2f 2f73 7061 6e22 290a 2020  th(".//span").  
+00009dd0: 2020 2020 2020 666f 7220 7370 616e 2069        for span i
+00009de0: 6e20 7370 616e 733a 0a20 2020 2020 2020  n spans:.       
+00009df0: 2020 2020 2061 6e6e 6f74 6174 6f72 2e72       annotator.r
+00009e00: 756e 5f63 6f6d 6d61 6e64 7328 7370 616e  un_commands(span
+00009e10: 290a 2020 2020 2020 2020 4874 6d6c 4772  ).        HtmlGr
+00009e20: 6f75 702e 6772 6f75 705f 6e65 7374 6564  oup.group_nested
+00009e30: 5f73 6962 6c69 6e67 7328 6874 6d6c 5f65  _siblings(html_e
+00009e40: 6c65 6d2c 2073 7479 6c65 733d 4e6f 6e65  lem, styles=None
+00009e50: 290a 2020 2020 2020 2020 4874 6d6c 4c69  ).        HtmlLi
+00009e60: 622e 7772 6974 655f 6874 6d6c 5f66 696c  b.write_html_fil
+00009e70: 6528 6874 6d6c 5f65 6c65 6d2c 206f 7574  e(html_elem, out
+00009e80: 6669 6c65 2c20 6465 6275 673d 5472 7565  file, debug=True
+00009e90: 290a 0a20 2020 2040 636c 6173 736d 6574  )..    @classmet
+00009ea0: 686f 640a 2020 2020 6465 6620 7370 6c69  hod.    def spli
+00009eb0: 745f 7370 616e 7328 636c 732c 2068 746d  t_spans(cls, htm
+00009ec0: 6c2c 2073 706c 6974 5f73 7061 6e5f 7265  l, split_span_re
+00009ed0: 6765 7829 3a0a 2020 2020 2020 2020 7265  gex):.        re
+00009ee0: 5f73 706c 6974 203d 2072 652e 636f 6d70  _split = re.comp
+00009ef0: 696c 6528 7370 6c69 745f 7370 616e 5f72  ile(split_span_r
+00009f00: 6567 6578 290a 2020 2020 2020 2020 7370  egex).        sp
+00009f10: 616e 7320 3d20 6874 6d6c 2e78 7061 7468  ans = html.xpath
+00009f20: 2822 2f2f 7370 616e 2229 0a20 2020 2020  ("//span").     
+00009f30: 2020 206e 7370 616e 7320 3d20 6c65 6e28     nspans = len(
+00009f40: 7370 616e 7329 0a0a 2020 2020 2020 2020  spans)..        
+00009f50: 636c 732e 7363 616e 5f72 656d 6169 6e69  cls.scan_remaini
+00009f60: 6e67 5f73 7061 6e73 2872 655f 7370 6c69  ng_spans(re_spli
+00009f70: 742c 2073 7061 6e73 290a 0a20 2020 2040  t, spans)..    @
+00009f80: 636c 6173 736d 6574 686f 640a 2020 2020  classmethod.    
+00009f90: 6465 6620 7363 616e 5f72 656d 6169 6e69  def scan_remaini
+00009fa0: 6e67 5f73 7061 6e73 2863 6c73 2c20 7265  ng_spans(cls, re
+00009fb0: 5f73 706c 6974 2c20 7370 616e 7329 3a0a  _split, spans):.
+00009fc0: 2020 2020 2020 2020 6469 7620 3d20 4e6f          div = No
+00009fd0: 6e65 0a20 2020 2020 2020 2077 6869 6c65  ne.        while
+00009fe0: 206c 656e 2873 7061 6e73 2920 3e20 303a   len(spans) > 0:
+00009ff0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+0000a000: 2069 2c20 7370 616e 2069 6e20 656e 756d   i, span in enum
+0000a010: 6572 6174 6528 7370 616e 7329 3a0a 2020  erate(spans):.  
+0000a020: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0000a030: 2064 6976 2069 7320 6e6f 7420 4e6f 6e65   div is not None
+0000a040: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000a050: 2020 2020 2020 6469 762e 6170 7065 6e64        div.append
+0000a060: 2873 7061 6e29 0a20 2020 2020 2020 2020  (span).         
+0000a070: 2020 2020 2020 206d 6174 6368 203d 2072         match = r
+0000a080: 655f 7370 6c69 742e 6d61 7463 6828 7370  e_split.match(sp
+0000a090: 616e 2e74 6578 7429 0a20 2020 2020 2020  an.text).       
+0000a0a0: 2020 2020 2020 2020 2069 6620 6d61 7463           if matc
+0000a0b0: 683a 0a20 2020 2020 2020 2020 2020 2020  h:.             
+0000a0c0: 2020 2020 2020 2070 7265 203d 206d 6174         pre = mat
+0000a0d0: 6368 2e67 726f 7570 2822 7072 6522 290a  ch.group("pre").
+0000a0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a0f0: 2020 2020 706f 7374 203d 206d 6174 6368      post = match
+0000a100: 2e67 726f 7570 2822 706f 7374 2229 0a20  .group("post"). 
+0000a110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a120: 2020 2073 7061 6e2e 7465 7874 203d 2070     span.text = p
+0000a130: 7265 0a20 2020 2020 2020 2020 2020 2020  re.             
+0000a140: 2020 2020 2020 2070 6172 656e 745f 6469         parent_di
+0000a150: 7620 3d20 7370 616e 2e67 6574 7061 7265  v = span.getpare
+0000a160: 6e74 2829 0a20 2020 2020 2020 2020 2020  nt().           
+0000a170: 2020 2020 2020 2020 206e 6578 745f 7370           next_sp
+0000a180: 616e 203d 2045 542e 5375 6245 6c65 6d65  an = ET.SubEleme
+0000a190: 6e74 2870 6172 656e 745f 6469 762c 2022  nt(parent_div, "
+0000a1a0: 7370 616e 2229 0a20 2020 2020 2020 2020  span").         
+0000a1b0: 2020 2020 2020 2020 2020 2066 6f72 2061             for a
+0000a1c0: 7474 2069 6e20 7370 616e 2e61 7474 7269  tt in span.attri
+0000a1d0: 623a 0a20 2020 2020 2020 2020 2020 2020  b:.             
+0000a1e0: 2020 2020 2020 2020 2020 206e 6578 745f             next_
+0000a1f0: 7370 616e 2e61 7474 7269 625b 6174 745b  span.attrib[att[
+0000a200: 305d 5d20 3d20 6174 745b 315d 0a20 2020  0]] = att[1].   
+0000a210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a220: 2020 2020 2073 7061 6e2e 6164 646e 6578       span.addnex
+0000a230: 7428 6e65 7874 5f73 7061 6e29 0a20 2020  t(next_span).   
+0000a240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a250: 2073 7061 6e73 203d 2073 7061 6e73 5b69   spans = spans[i
+0000a260: 202b 2031 3a5d 0a20 2020 2020 2020 2020   + 1:].         
+0000a270: 2020 2020 2020 2020 2020 2064 6976 203d             div =
+0000a280: 2045 542e 5375 6245 6c65 6d65 6e74 2870   ET.SubElement(p
+0000a290: 6172 656e 745f 6469 762e 6765 7470 6172  arent_div.getpar
+0000a2a0: 656e 7428 292c 2022 6469 7622 290a 0a20  ent(), "div").. 
+0000a2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a2c0: 2020 2062 7265 616b 0a20 2020 2020 2020     break.       
+0000a2d0: 2020 2020 2020 2020 2069 6620 6920 3d3d           if i ==
+0000a2e0: 206c 656e 2873 7061 6e73 2920 2d20 313a   len(spans) - 1:
+0000a2f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000a300: 2020 2020 2073 7061 6e73 203d 205b 5d0a       spans = [].
+0000a310: 0a0a 636c 6173 7320 4874 6d6c 5574 696c  ..class HtmlUtil
+0000a320: 3a0a 2020 2020 5343 5249 5054 5f46 4143  :.    SCRIPT_FAC
+0000a330: 5420 3d20 302e 3920 2023 206d 6179 6265  T = 0.9  # maybe
+0000a340: 2073 686f 6c64 6e27 7420 6265 2068 6572   sholdn't be her
+0000a350: 653b 2061 766f 6964 2063 6972 6375 6c61  e; avoid circula
+0000a360: 720a 2020 2020 4d41 524b 4552 203d 2022  r.    MARKER = "
+0000a370: 6d61 726b 6572 220a 0a20 2020 2040 636c  marker"..    @cl
+0000a380: 6173 736d 6574 686f 640a 2020 2020 6465  assmethod.    de
+0000a390: 6620 7265 6d6f 7665 5f65 6d70 7479 5f65  f remove_empty_e
+0000a3a0: 6c65 6d65 6e74 7328 636c 732c 2065 6c65  lements(cls, ele
+0000a3b0: 6d2c 2074 6167 293a 0a20 2020 2020 2020  m, tag):.       
+0000a3c0: 2022 2222 0a20 2020 2020 2020 204d 6179   """.        May
+0000a3d0: 6265 206d 6f76 6520 746f 2048 544d 4c54  be move to HTMLT
+0000a3e0: 6964 790a 2020 2020 2020 2020 2222 220a  idy.        """.
+0000a3f0: 2020 2020 2020 2020 6966 2074 6167 3a0a          if tag:.
+0000a400: 2020 2020 2020 2020 2020 2020 6966 2074              if t
+0000a410: 7970 6528 7461 6729 2069 7320 6c69 7374  ype(tag) is list
+0000a420: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000a430: 2020 666f 7220 7420 696e 2074 6167 3a0a    for t in tag:.
+0000a440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a450: 2020 2020 636c 732e 7265 6d6f 7665 5f65      cls.remove_e
+0000a460: 6d70 7479 5f65 6c65 6d65 6e74 7328 656c  mpty_elements(el
+0000a470: 656d 2c20 7429 0a20 2020 2020 2020 2020  em, t).         
+0000a480: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0000a490: 2020 2020 2020 2020 2078 7020 3d20 6622           xp = f"
+0000a4a0: 2e2f 2f7b 7461 677d 5b6e 6f72 6d61 6c69  .//{tag}[normali
+0000a4b0: 7a65 2d73 7061 6365 282e 293d 2727 2061  ze-space(.)='' a
+0000a4c0: 6e64 2063 6f75 6e74 287b 7461 677d 2f2a  nd count({tag}/*
+0000a4d0: 2920 3d20 305d 220a 2020 2020 2020 2020  ) = 0]".        
+0000a4e0: 2020 2020 2020 2020 656c 656d 7320 3d20          elems = 
+0000a4f0: 656c 656d 2e78 7061 7468 2878 7029 0a20  elem.xpath(xp). 
+0000a500: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0000a510: 6f72 2065 6c20 696e 2065 6c65 6d73 3a0a  or el in elems:.
+0000a520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a530: 2020 2020 636c 732e 7265 6d6f 7665 5f65      cls.remove_e
+0000a540: 6c65 6d5f 6b65 6570 5f74 6169 6c28 656c  lem_keep_tail(el
+0000a550: 290a 0a20 2020 2040 636c 6173 736d 6574  )..    @classmet
+0000a560: 686f 640a 2020 2020 6465 6620 7265 6d6f  hod.    def remo
+0000a570: 7665 5f65 6c65 6d5f 6b65 6570 5f74 6169  ve_elem_keep_tai
+0000a580: 6c28 636c 732c 2065 6c29 3a0a 2020 2020  l(cls, el):.    
+0000a590: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0000a5a0: 4d61 7962 6520 6d6f 7665 2074 6f20 4854  Maybe move to HT
+0000a5b0: 4d4c 5469 6479 0a20 2020 2020 2020 2022  MLTidy.        "
+0000a5c0: 2222 0a20 2020 2020 2020 2070 6172 656e  "".        paren
+0000a5d0: 7420 3d20 656c 2e67 6574 7061 7265 6e74  t = el.getparent
+0000a5e0: 2829 0a20 2020 2020 2020 2074 6169 6c20  ().        tail 
+0000a5f0: 3d20 656c 2e74 6169 6c0a 2020 2020 2020  = el.tail.      
+0000a600: 2020 6966 2074 6169 6c20 6973 206e 6f74    if tail is not
+0000a610: 204e 6f6e 6520 616e 6420 6c65 6e28 7461   None and len(ta
+0000a620: 696c 2e73 7472 6970 2829 2920 3e20 303a  il.strip()) > 0:
+0000a630: 0a20 2020 2020 2020 2020 2020 2070 7265  .            pre
+0000a640: 7620 3d20 656c 2e67 6574 7072 6576 696f  v = el.getprevio
+0000a650: 7573 2829 0a20 2020 2020 2020 2020 2020  us().           
+0000a660: 2069 6620 7072 6576 2069 7320 6e6f 7420   if prev is not 
+0000a670: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+0000a680: 2020 2020 2020 7072 6576 2e74 6169 6c20        prev.tail 
+0000a690: 3d20 2870 7265 762e 7461 696c 206f 7220  = (prev.tail or 
+0000a6a0: 2727 2920 2b20 656c 2e74 6169 6c0a 2020  '') + el.tail.  
+0000a6b0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+0000a6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a6d0: 7061 7265 6e74 2e74 6578 7420 3d20 2870  parent.text = (p
+0000a6e0: 6172 656e 742e 7465 7874 206f 7220 2727  arent.text or ''
+0000a6f0: 2920 2b20 656c 2e74 6169 6c0a 0a20 2020  ) + el.tail..   
+0000a700: 2020 2020 2070 6172 656e 742e 7265 6d6f       parent.remo
+0000a710: 7665 2865 6c29 0a0a 2020 2020 4063 6c61  ve(el)..    @cla
+0000a720: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
+0000a730: 2073 706c 6974 5f73 7061 6e5f 6174 5f6d   split_span_at_m
+0000a740: 6174 6368 2863 6c73 2c20 656c 656d 782c  atch(cls, elemx,
+0000a750: 2072 6567 6578 2c20 636f 7079 5f61 7474   regex, copy_att
+0000a760: 733d 5472 7565 2c20 7265 6375 7273 653d  s=True, recurse=
+0000a770: 5472 7565 2c20 6964 5f72 6f6f 743d 4e6f  True, id_root=No
+0000a780: 6e65 2c20 6964 5f63 6f75 6e74 6572 3d30  ne, id_counter=0
+0000a790: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000a7a0: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
+0000a7b0: 775f 7461 6773 3d4e 6f6e 6529 3a0a 2020  w_tags=None):.  
+0000a7c0: 2020 2020 2020 2222 2273 706c 6974 7320        """splits 
+0000a7d0: 616e 2065 6c65 6d20 286e 6f72 6d61 6c6c  an elem (normall
+0000a7e0: 7920 7370 616e 2920 696e 746f 2033 2063  y span) into 3 c
+0000a7f0: 6f6d 706f 6e65 6e74 7320 6279 2072 6567  omponents by reg
+0000a800: 6578 206d 6174 6368 0a20 2020 2020 2020  ex match.       
+0000a810: 203a 7061 7261 6d20 656c 656d 783a 2065   :param elemx: e
+0000a820: 6c65 6d20 746f 2073 706c 6974 2028 6e6f  lem to split (no
+0000a830: 726d 616c 6c79 2068 6173 2061 2070 6172  rmally has a par
+0000a840: 656e 7420 2865 2e67 2e20 6469 7629 0a20  ent (e.g. div). 
+0000a850: 2020 2020 2020 203a 7061 7261 6d20 7265         :param re
+0000a860: 6765 783a 2072 6567 6578 2074 6f20 7370  gex: regex to sp
+0000a870: 6c69 7420 656c 656d 2028 6f66 2066 6f72  lit elem (of for
+0000a880: 6d20 2870 7265 2928 6d61 7463 6829 2870  m (pre)(match)(p
+0000a890: 6f73 7429 0a20 2020 2020 2020 203a 7061  ost).        :pa
+0000a8a0: 7261 6d20 636f 7079 5f61 7474 733a 2069  ram copy_atts: i
+0000a8b0: 6620 5472 7565 2063 6f70 7920 6174 7473  f True copy atts
+0000a8c0: 2066 726f 6d20 656c 656d 0a20 2020 2020   from elem.     
+0000a8d0: 2020 203a 7061 7261 6d20 7265 6375 7273     :param recurs
+0000a8e0: 653a 2069 6620 5472 7565 2c20 7265 7365  e: if True, rese
+0000a8f0: 7473 2065 6c65 6d20 746f 2074 7261 696c  ts elem to trail
+0000a900: 696e 6720 656c 656d 2061 6e64 2072 6561  ing elem and rea
+0000a910: 6e6c 7973 6573 2075 6e74 696c 206e 6f20  nlyses until no 
+0000a920: 6d6f 7265 206d 6174 6368 0a20 2020 2020  more match.     
+0000a930: 2020 203a 7061 7261 6d20 6964 5f72 6f6f     :param id_roo
+0000a940: 743a 2061 7574 6f2d 6765 6e65 7261 7465  t: auto-generate
+0000a950: 2069 6473 2062 7569 6c64 696e 6720 6f6e   ids building on
+0000a960: 2069 645f 726f 6f74 0a20 2020 2020 2020   id_root.       
+0000a970: 203a 7061 7261 6d20 6964 5f63 6f75 6e74   :param id_count
+0000a980: 6572 3a20 636f 756e 7465 7220 666f 7220  er: counter for 
+0000a990: 6964 730a 2020 2020 2020 2020 3a70 6172  ids.        :par
+0000a9a0: 616d 206e 6577 5f74 6167 733a 206e 6577  am new_tags: new
+0000a9b0: 5f65 6c65 6d65 6e74 2074 6167 7320 2864  _element tags (d
+0000a9c0: 6566 6175 6c74 2073 7061 6e2c 2073 7061  efault span, spa
+0000a9d0: 6e2c 2073 7061 6e29 0a20 2020 2020 2020  n, span).       
+0000a9e0: 203a 7265 7475 726e 3a20 6c69 7374 206f   :return: list o
+0000a9f0: 6620 3320 656c 656d 733b 2069 6620 6e65  f 3 elems; if ne
+0000aa00: 775f 656c 656d 735b 325d 2069 7320 6e6f  w_elems[2] is no
+0000aa10: 7420 4e6f 6e65 2069 7427 7320 6176 6169  t None it's avai
+0000aa20: 6c61 626c 6520 666f 7220 7265 6375 7273  lable for recurs
+0000aa30: 696f 6e29 0a20 2020 2020 2020 2022 2222  ion).        """
+0000aa40: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+0000aa50: 6e65 775f 7461 6773 3a0a 2020 2020 2020  new_tags:.      
+0000aa60: 2020 2020 2020 6e65 775f 7461 6773 203d        new_tags =
+0000aa70: 205b 485f 5350 414e 2c20 485f 5350 414e   [H_SPAN, H_SPAN
+0000aa80: 2c20 485f 5350 414e 5d0a 2020 2020 2020  , H_SPAN].      
+0000aa90: 2020 6173 7365 7274 2065 6c65 6d78 2069    assert elemx i
+0000aaa0: 7320 6e6f 7420 4e6f 6e65 0a20 2020 2020  s not None.     
+0000aab0: 2020 2074 6578 7478 203d 2048 746d 6c55     textx = HtmlU
+0000aac0: 7469 6c2e 6765 745f 7465 7874 5f63 6f6e  til.get_text_con
+0000aad0: 7465 6e74 2865 6c65 6d78 290a 2020 2020  tent(elemx).    
+0000aae0: 2020 2020 7265 6320 3d20 7265 2e63 6f6d      rec = re.com
+0000aaf0: 7069 6c65 2872 6567 6578 290a 2020 2020  pile(regex).    
+0000ab00: 2020 2020 6d61 7463 6820 3d20 7265 632e      match = rec.
+0000ab10: 6d61 7463 6828 7465 7874 7829 0a20 2020  match(textx).   
+0000ab20: 2020 2020 206e 6577 5f65 6c65 6d73 203d       new_elems =
+0000ab30: 205b 4e6f 6e65 2c20 4e6f 6e65 2c20 4e6f   [None, None, No
+0000ab40: 6e65 5d0a 2020 2020 2020 2020 6966 206d  ne].        if m
+0000ab50: 6174 6368 3a0a 2020 2020 2020 2020 2020  atch:.          
+0000ab60: 2020 7061 7265 6e74 203d 2065 6c65 6d78    parent = elemx
+0000ab70: 2e67 6574 7061 7265 6e74 2829 0a20 2020  .getparent().   
+0000ab80: 2020 2020 2020 2020 2069 6620 6c65 6e28           if len(
+0000ab90: 6d61 7463 682e 6772 6f75 7073 2829 2920  match.groups()) 
+0000aba0: 213d 2033 3a20 2023 2073 6f6d 6520 6d61  != 3:  # some ma
+0000abb0: 7920 6265 2065 6d70 7479 2073 7472 696e  y be empty strin
+0000abc0: 6773 0a20 2020 2020 2020 2020 2020 2020  gs.             
+0000abd0: 2020 206c 6f67 6769 6e67 2e77 6172 6e69     logging.warni
+0000abe0: 6e67 2866 2243 616e 6e6f 7420 6d61 7463  ng(f"Cannot matc
+0000abf0: 6820 7b74 6578 7478 7d20 6167 6169 6e73  h {textx} agains
+0000ac00: 7420 7b72 6567 6578 7d22 290a 2020 2020  t {regex}").    
+0000ac10: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0000ac20: 726e 206e 6577 5f65 6c65 6d73 2c20 6964  rn new_elems, id
+0000ac30: 5f63 6f75 6e74 6572 0a20 2020 2020 2020  _counter.       
+0000ac40: 2020 2020 2067 726f 7570 3120 3d20 6d61       group1 = ma
+0000ac50: 7463 682e 6772 6f75 7028 3129 0a20 2020  tch.group(1).   
+0000ac60: 2020 2020 2020 2020 2069 6620 6772 6f75           if grou
+0000ac70: 7031 2021 3d20 2222 3a20 2023 2064 6f6e  p1 != "":  # don
+0000ac80: 2774 2061 6464 2065 6d70 7479 2073 7472  't add empty str
+0000ac90: 696e 670a 2020 2020 2020 2020 2020 2020  ing.            
+0000aca0: 2020 2020 656c 656d 7820 3d20 4874 6d6c      elemx = Html
+0000acb0: 5574 696c 2e61 6464 5f73 6962 6c69 6e67  Util.add_sibling
+0000acc0: 5f61 6674 6572 2865 6c65 6d78 2c20 6e65  _after(elemx, ne
+0000acd0: 775f 7461 6773 5b30 5d2c 2072 6570 6c61  w_tags[0], repla
+0000ace0: 6365 3d54 7275 652c 2063 6f70 795f 6174  ce=True, copy_at
+0000acf0: 7473 3d63 6f70 795f 6174 7473 2c0a 2020  ts=copy_atts,.  
+0000ad00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ad10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ad20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ad30: 2074 6578 743d 6772 6f75 7031 290a 2020   text=group1).  
+0000ad40: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
+0000ad50: 775f 656c 656d 735b 305d 203d 2065 6c65  w_elems[0] = ele
+0000ad60: 6d78 0a20 2020 2020 2020 2020 2020 2020  mx.             
+0000ad70: 2020 206e 6577 5f65 6c65 6d73 5b30 5d2e     new_elems[0].
+0000ad80: 6174 7472 6962 5b41 5f43 4c41 5353 5d20  attrib[A_CLASS] 
+0000ad90: 3d20 2272 655f 7072 6566 220a 2020 2020  = "re_pref".    
+0000ada0: 2020 2020 2020 2020 2020 2020 6964 5f63              id_c
+0000adb0: 6f75 6e74 6572 203d 2063 6c73 2e61 6464  ounter = cls.add
+0000adc0: 5f69 645f 696e 6372 656d 656e 745f 636f  _id_increment_co
+0000add0: 756e 7465 7228 6964 5f63 6f75 6e74 6572  unter(id_counter
+0000ade0: 2c20 6964 5f72 6f6f 742c 2065 6c65 6d78  , id_root, elemx
+0000adf0: 290a 2020 2020 2020 2020 2020 2020 6e65  ).            ne
+0000ae00: 775f 656c 656d 735b 315d 203d 2048 746d  w_elems[1] = Htm
+0000ae10: 6c55 7469 6c2e 6164 645f 7369 626c 696e  lUtil.add_siblin
+0000ae20: 675f 6166 7465 7228 656c 656d 782c 206e  g_after(elemx, n
+0000ae30: 6577 5f74 6167 735b 315d 2c20 636f 7079  ew_tags[1], copy
+0000ae40: 5f61 7474 733d 636f 7079 5f61 7474 732c  _atts=copy_atts,
+0000ae50: 2074 6578 743d 6d61 7463 682e 6772 6f75   text=match.grou
+0000ae60: 7028 3229 290a 2020 2020 2020 2020 2020  p(2)).          
+0000ae70: 2020 6e65 775f 656c 656d 735b 315d 2e61    new_elems[1].a
+0000ae80: 7474 7269 625b 415f 434c 4153 535d 203d  ttrib[A_CLASS] =
+0000ae90: 2022 7265 5f6d 6174 6368 220a 2020 2020   "re_match".    
+0000aea0: 2020 2020 2020 2020 6964 5f63 6f75 6e74          id_count
+0000aeb0: 6572 203d 2063 6c73 2e61 6464 5f69 645f  er = cls.add_id_
+0000aec0: 696e 6372 656d 656e 745f 636f 756e 7465  increment_counte
+0000aed0: 7228 6964 5f63 6f75 6e74 6572 2c20 6964  r(id_counter, id
+0000aee0: 5f72 6f6f 742c 206e 6577 5f65 6c65 6d73  _root, new_elems
+0000aef0: 5b31 5d29 0a20 2020 2020 2020 2020 2020  [1]).           
+0000af00: 2069 6620 6d61 7463 682e 6772 6f75 7028   if match.group(
+0000af10: 3329 2021 3d20 2222 3a20 2023 2064 6f6e  3) != "":  # don
+0000af20: 2774 2061 6464 2065 6d70 7479 2073 7472  't add empty str
+0000af30: 696e 670a 2020 2020 2020 2020 2020 2020  ing.            
+0000af40: 2020 2020 6e65 775f 656c 656d 735b 325d      new_elems[2]
+0000af50: 203d 2048 746d 6c55 7469 6c2e 6164 645f   = HtmlUtil.add_
+0000af60: 7369 626c 696e 675f 6166 7465 7228 6e65  sibling_after(ne
+0000af70: 775f 656c 656d 735b 315d 2c20 6e65 775f  w_elems[1], new_
+0000af80: 7461 6773 5b32 5d2c 2063 6f70 795f 6174  tags[2], copy_at
+0000af90: 7473 3d63 6f70 795f 6174 7473 2c0a 2020  ts=copy_atts,.  
+0000afa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000afb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000afc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000afd0: 2020 2020 2020 2020 7465 7874 3d6d 6174          text=mat
+0000afe0: 6368 2e67 726f 7570 2833 2929 0a20 2020  ch.group(3)).   
+0000aff0: 2020 2020 2020 2020 2020 2020 206e 6577               new
+0000b000: 5f65 6c65 6d73 5b32 5d2e 6174 7472 6962  _elems[2].attrib
+0000b010: 5b41 5f43 4c41 5353 5d20 3d20 2272 655f  [A_CLASS] = "re_
+0000b020: 706f 7374 220a 0a20 2020 2020 2020 2020  post"..         
+0000b030: 2020 2020 2020 2069 645f 636f 756e 7465         id_counte
+0000b040: 7220 3d20 636c 732e 6164 645f 6964 5f69  r = cls.add_id_i
+0000b050: 6e63 7265 6d65 6e74 5f63 6f75 6e74 6572  ncrement_counter
+0000b060: 2869 645f 636f 756e 7465 722c 2069 645f  (id_counter, id_
+0000b070: 726f 6f74 2c20 6e65 775f 656c 656d 735b  root, new_elems[
+0000b080: 325d 290a 2020 2020 2020 2020 2020 2020  2]).            
+0000b090: 2020 2020 6966 2072 6563 7572 7365 3a0a      if recurse:.
+0000b0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b0b0: 2020 2020 5f2c 2069 645f 636f 756e 7465      _, id_counte
+0000b0c0: 7220 3d20 4874 6d6c 5574 696c 2e73 706c  r = HtmlUtil.spl
+0000b0d0: 6974 5f73 7061 6e5f 6174 5f6d 6174 6368  it_span_at_match
+0000b0e0: 286e 6577 5f65 6c65 6d73 5b32 5d2c 2072  (new_elems[2], r
+0000b0f0: 6567 6578 2c20 636f 7079 5f61 7474 733d  egex, copy_atts=
+0000b100: 636f 7079 5f61 7474 732c 0a20 2020 2020  copy_atts,.     
+0000b110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b120: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000b130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b160: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0000b170: 6563 7572 7365 3d72 6563 7572 7365 2c20  ecurse=recurse, 
-0000b180: 6964 5f72 6f6f 743d 6964 5f72 6f6f 742c  id_root=id_root,
-0000b190: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000b1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b1d0: 2020 6964 5f63 6f75 6e74 6572 3d69 645f    id_counter=id_
-0000b1e0: 636f 756e 7465 7229 0a20 2020 2020 2020  counter).       
-0000b1f0: 2072 6574 7572 6e20 6e65 775f 656c 656d   return new_elem
-0000b200: 732c 2069 645f 636f 756e 7465 720a 0a20  s, id_counter.. 
-0000b210: 2020 2040 636c 6173 736d 6574 686f 640a     @classmethod.
-0000b220: 2020 2020 6465 6620 6164 645f 6964 5f69      def add_id_i
-0000b230: 6e63 7265 6d65 6e74 5f63 6f75 6e74 6572  ncrement_counter
-0000b240: 2863 6c73 2c20 6964 5f63 6f75 6e74 6572  (cls, id_counter
-0000b250: 2c20 6964 5f72 6f6f 742c 2068 746d 6c5f  , id_root, html_
-0000b260: 656c 656d 293a 0a20 2020 2020 2020 2069  elem):.        i
-0000b270: 6620 6964 5f72 6f6f 743a 0a20 2020 2020  f id_root:.     
-0000b280: 2020 2020 2020 2068 746d 6c5f 656c 656d         html_elem
-0000b290: 2e61 7474 7269 625b 415f 4944 5d20 3d20  .attrib[A_ID] = 
-0000b2a0: 6964 5f72 6f6f 7420 2b20 7374 7228 6964  id_root + str(id
-0000b2b0: 5f63 6f75 6e74 6572 290a 2020 2020 2020  _counter).      
-0000b2c0: 2020 2020 2020 6964 5f63 6f75 6e74 6572        id_counter
-0000b2d0: 202b 3d20 310a 2020 2020 2020 2020 7265   += 1.        re
-0000b2e0: 7475 726e 2069 645f 636f 756e 7465 720a  turn id_counter.
-0000b2f0: 0a20 2020 2040 636c 6173 736d 6574 686f  .    @classmetho
-0000b300: 640a 2020 2020 6465 6620 6164 645f 7369  d.    def add_si
-0000b310: 626c 696e 675f 6166 7465 7228 636c 732c  bling_after(cls,
-0000b320: 2061 6e63 686f 725f 656c 656d 2c20 7461   anchor_elem, ta
-0000b330: 672c 2072 6570 6c61 6365 3d46 616c 7365  g, replace=False
-0000b340: 2c20 636f 7079 5f61 7474 733d 4661 6c73  , copy_atts=Fals
-0000b350: 652c 2074 6578 743d 4e6f 6e65 293a 0a20  e, text=None):. 
-0000b360: 2020 2020 2020 2022 2222 6164 6473 206e         """adds n
-0000b370: 6577 2074 7261 696c 696e 6720 7369 626c  ew trailing sibl
-0000b380: 696e 6720 6f66 2061 6e63 686f 725f 656c  ing of anchor_el
-0000b390: 656d 2077 6974 6820 7461 670a 2020 2020  em with tag.    
-0000b3a0: 2020 2020 3a70 6172 616d 2074 6167 3a20      :param tag: 
-0000b3b0: 7461 6720 666f 7220 6e65 7720 656c 656d  tag for new elem
-0000b3c0: 656e 740a 2020 2020 2020 2020 3a70 6172  ent.        :par
-0000b3d0: 616d 2061 6e63 686f 725f 656c 656d 3a20  am anchor_elem: 
-0000b3e0: 7265 6665 7265 6e63 6520 656c 656d 656e  reference elemen
-0000b3f0: 742c 206d 7573 7420 6861 7665 2061 2070  t, must have a p
-0000b400: 6172 656e 740a 2020 2020 2020 2020 3a70  arent.        :p
-0000b410: 6172 616d 2072 6570 6c61 6365 3a20 6966  aram replace: if
-0000b420: 2054 7275 652c 2072 656d 6f76 6520 616e   True, remove an
-0000b430: 6368 6f72 2065 6c65 6d65 6e74 0a20 2020  chor element.   
-0000b440: 2020 2020 203a 7061 7261 6d20 636f 7079       :param copy
-0000b450: 5f61 7474 733a 2063 6f70 7920 6174 7472  _atts: copy attr
-0000b460: 6962 7574 6573 2066 726f 6d20 616e 6368  ibutes from anch
-0000b470: 6f72 0a20 2020 2020 2020 203a 7061 7261  or.        :para
-0000b480: 6d20 7465 7874 3a20 6966 206e 6f74 204e  m text: if not N
-0000b490: 6f6e 6520 6164 6420 7465 7874 2074 6f20  one add text to 
-0000b4a0: 6e65 7720 656c 656d 656e 740a 2020 2020  new element.    
-0000b4b0: 2020 2020 3a72 6574 7572 6e3a 206e 6577      :return: new
-0000b4c0: 2073 6962 6c69 6e67 2077 6974 6820 6f70   sibling with op
-0000b4d0: 7469 6f6e 616c 2061 7979 7472 6962 7574  tional ayytribut
-0000b4e0: 6573 2061 6e64 2074 6578 740a 0a0a 0a20  es and text.... 
-0000b4f0: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
-0000b500: 2020 2020 6173 7365 7274 2061 6e63 686f      assert ancho
-0000b510: 725f 656c 656d 2069 7320 6e6f 7420 4e6f  r_elem is not No
-0000b520: 6e65 0a20 2020 2020 2020 2061 7373 6572  ne.        asser
-0000b530: 7420 7461 670a 2020 2020 2020 2020 7061  t tag.        pa
-0000b540: 7265 6e74 203d 2061 6e63 686f 725f 656c  rent = anchor_el
-0000b550: 656d 2e67 6574 7061 7265 6e74 2829 0a20  em.getparent(). 
-0000b560: 2020 2020 2020 2061 7373 6572 7420 7061         assert pa
-0000b570: 7265 6e74 2069 7320 6e6f 7420 4e6f 6e65  rent is not None
-0000b580: 2c20 6622 4e6f 2070 6172 656e 7420 666f  , f"No parent fo
-0000b590: 7220 616e 6368 6f72 5f65 6c65 6d22 0a20  r anchor_elem". 
-0000b5a0: 2020 2020 2020 2073 6962 6c69 6e67 203d         sibling =
-0000b5b0: 2045 542e 5375 6245 6c65 6d65 6e74 2870   ET.SubElement(p
-0000b5c0: 6172 656e 742c 2074 6167 290a 2020 2020  arent, tag).    
-0000b5d0: 2020 2020 6966 2063 6f70 795f 6174 7473      if copy_atts
-0000b5e0: 3a0a 2020 2020 2020 2020 2020 2020 666f  :.            fo
-0000b5f0: 7220 6b2c 2076 2069 6e20 616e 6368 6f72  r k, v in anchor
-0000b600: 5f65 6c65 6d2e 6174 7472 6962 2e69 7465  _elem.attrib.ite
-0000b610: 6d73 2829 3a0a 2020 2020 2020 2020 2020  ms():.          
-0000b620: 2020 2020 2020 7369 626c 696e 672e 6174        sibling.at
-0000b630: 7472 6962 5b6b 5d20 3d20 760a 2020 2020  trib[k] = v.    
-0000b640: 2020 2020 616e 6368 6f72 5f65 6c65 6d2e      anchor_elem.
-0000b650: 6164 646e 6578 7428 7369 626c 696e 6729  addnext(sibling)
-0000b660: 0a20 2020 2020 2020 2069 6620 7465 7874  .        if text
-0000b670: 3a0a 2020 2020 2020 2020 2020 2020 7369  :.            si
-0000b680: 626c 696e 672e 7465 7874 203d 2074 6578  bling.text = tex
-0000b690: 740a 2020 2020 2020 2020 6966 2072 6570  t.        if rep
-0000b6a0: 6c61 6365 3a0a 2020 2020 2020 2020 2020  lace:.          
-0000b6b0: 2020 7061 7265 6e74 2e72 656d 6f76 6528    parent.remove(
-0000b6c0: 616e 6368 6f72 5f65 6c65 6d29 0a20 2020  anchor_elem).   
-0000b6d0: 2020 2020 2072 6574 7572 6e20 7369 626c       return sibl
-0000b6e0: 696e 670a 0a20 2020 2040 636c 6173 736d  ing..    @classm
-0000b6f0: 6574 686f 640a 2020 2020 6465 6620 6372  ethod.    def cr
-0000b700: 6561 7465 5f64 6976 5f73 7061 6e28 636c  eate_div_span(cl
-0000b710: 732c 2074 6578 742c 2073 7479 6c65 3d4e  s, text, style=N
-0000b720: 6f6e 6529 3a0a 2020 2020 2020 2020 2222  one):.        ""
-0000b730: 2275 7469 6c69 7479 206d 6574 686f 6420  "utility method 
-0000b740: 746f 2063 7265 6174 6520 6120 6469 762f  to create a div/
-0000b750: 7370 616e 4074 6578 7420 2870 726f 6261  span@text (proba
-0000b760: 626c 7920 6d61 696e 6c79 2066 6f72 2074  bly mainly for t
-0000b770: 6573 7469 6e67 290a 2020 2020 2020 2020  esting).        
-0000b780: 3a70 6172 616d 2074 6578 743a 2074 6f20  :param text: to 
-0000b790: 6164 640a 2020 2020 2020 2020 3a72 6574  add.        :ret
-0000b7a0: 7572 6e3a 2074 6865 2064 6976 2222 220a  urn: the div""".
-0000b7b0: 2020 2020 2020 2020 6469 7620 3d20 4554          div = ET
-0000b7c0: 2e45 6c65 6d65 6e74 2848 5f44 4956 290a  .Element(H_DIV).
-0000b7d0: 2020 2020 2020 2020 7370 616e 203d 2045          span = E
-0000b7e0: 542e 5375 6245 6c65 6d65 6e74 2864 6976  T.SubElement(div
-0000b7f0: 2c20 485f 5350 414e 290a 2020 2020 2020  , H_SPAN).      
-0000b800: 2020 6966 2073 7479 6c65 3a0a 2020 2020    if style:.    
-0000b810: 2020 2020 2020 2020 6373 735f 7374 796c          css_styl
-0000b820: 6520 3d20 4353 5353 7479 6c65 2e63 7265  e = CSSStyle.cre
-0000b830: 6174 655f 6373 735f 7374 796c 655f 6672  ate_css_style_fr
-0000b840: 6f6d 5f63 7373 5f73 7472 696e 6728 2266  om_css_string("f
-0000b850: 6f6e 742d 7369 7a65 3a31 323b 2066 6f6e  ont-size:12; fon
-0000b860: 742d 7765 6967 6874 3a20 626f 6c64 3b22  t-weight: bold;"
-0000b870: 290a 2020 2020 2020 2020 2020 2020 4874  ).            Ht
-0000b880: 6d6c 5374 796c 652e 7365 745f 7374 796c  mlStyle.set_styl
-0000b890: 6528 7370 616e 2c20 6373 735f 7374 796c  e(span, css_styl
-0000b8a0: 652e 6765 745f 6373 735f 7661 6c75 6528  e.get_css_value(
-0000b8b0: 2929 0a20 2020 2020 2020 2073 7061 6e2e  )).        span.
-0000b8c0: 7465 7874 203d 2074 6578 740a 2020 2020  text = text.    
-0000b8d0: 2020 2020 7265 7475 726e 2064 6976 2c20      return div, 
-0000b8e0: 7370 616e 0a0a 2020 2020 4063 6c61 7373  span..    @class
-0000b8f0: 6d65 7468 6f64 0a20 2020 2064 6566 2069  method.    def i
-0000b900: 735f 7375 6273 6372 6970 7428 636c 732c  s_subscript(cls,
-0000b910: 206c 6173 745f 7370 616e 2c20 7468 6973   last_span, this
-0000b920: 5f73 7061 6e29 202d 3e20 626f 6f6c 3a0a  _span) -> bool:.
-0000b930: 2020 2020 2020 2020 2222 2269 7320 7468          """is th
-0000b940: 6973 5f73 7061 6e20 6120 7375 6273 6372  is_span a subscr
-0000b950: 6970 743f 0a20 2020 2020 2020 2075 7365  ipt?.        use
-0000b960: 7320 6865 7572 6973 7469 6373 2069 6e20  s heuristics in 
-0000b970: 6973 5f73 6372 6970 745f 7479 7065 0a20  is_script_type. 
-0000b980: 2020 2020 2020 203a 7061 7261 6d20 6c61         :param la
-0000b990: 7374 5f73 7061 6e3a 2070 7265 6365 6469  st_span: precedi
-0000b9a0: 6e67 2073 7061 6e20 2869 6620 4e6f 6e65  ng span (if None
-0000b9b0: 2072 6574 7572 6e73 2046 616c 7365 290a   returns False).
-0000b9c0: 2020 2020 2020 2020 3a70 6172 616d 2074          :param t
-0000b9d0: 6869 735f 7370 616e 3a20 7370 616e 2074  his_span: span t
-0000b9e0: 6f20 7465 7374 0a20 2020 2020 2020 203a  o test.        :
-0000b9f0: 7265 7475 726e 3a20 5472 7565 2069 6620  return: True if 
-0000ba00: 7468 6973 2073 7061 6e20 6973 2073 6d61  this span is sma
-0000ba10: 6c6c 6572 2061 6e64 2022 6c6f 7765 7222  ller and "lower"
-0000ba20: 2074 6861 6e20 6c61 7374 2222 220a 2020   than last""".  
-0000ba30: 2020 2020 2020 7265 7475 726e 2063 6c73        return cls
-0000ba40: 2e69 735f 7363 7269 7074 5f74 7970 6528  .is_script_type(
-0000ba50: 6c61 7374 5f73 7061 6e2c 2074 6869 735f  last_span, this_
-0000ba60: 7370 616e 2c20 7363 7269 7074 5f74 7970  span, script_typ
-0000ba70: 653d 5353 6372 6970 742e 5355 4229 0a0a  e=SScript.SUB)..
-0000ba80: 2020 2020 4063 6c61 7373 6d65 7468 6f64      @classmethod
-0000ba90: 0a20 2020 2064 6566 2069 735f 7375 7065  .    def is_supe
-0000baa0: 7273 6372 6970 7428 636c 732c 206c 6173  rscript(cls, las
-0000bab0: 745f 7370 616e 2c20 7468 6973 5f73 7061  t_span, this_spa
-0000bac0: 6e29 202d 3e20 626f 6f6c 3a0a 2020 2020  n) -> bool:.    
-0000bad0: 2020 2020 2222 2269 7320 7468 6973 5f73      """is this_s
-0000bae0: 7061 6e20 6120 7375 7065 7273 6372 6970  pan a superscrip
-0000baf0: 743f 0a20 2020 2020 2020 2075 7365 7320  t?.        uses 
-0000bb00: 6865 7572 6973 7469 6373 2069 6e20 6973  heuristics in is
-0000bb10: 5f73 6372 6970 745f 7479 7065 0a20 2020  _script_type.   
-0000bb20: 2020 2020 203a 7061 7261 6d20 6c61 7374       :param last
-0000bb30: 5f73 7061 6e3a 2070 7265 6365 6469 6e67  _span: preceding
-0000bb40: 2073 7061 6e20 2869 6620 4e6f 6e65 2072   span (if None r
-0000bb50: 6574 7572 6e73 2046 616c 7365 290a 2020  eturns False).  
-0000bb60: 2020 2020 2020 3a70 6172 616d 2074 6869        :param thi
-0000bb70: 735f 7370 616e 3a20 7370 616e 2074 6f20  s_span: span to 
-0000bb80: 7465 7374 0a20 2020 2020 2020 203a 7265  test.        :re
-0000bb90: 7475 726e 3a20 5472 7565 2069 6620 7468  turn: True if th
-0000bba0: 6973 2073 7061 6e20 6973 2073 6d61 6c6c  is span is small
-0000bbb0: 6572 2061 6e64 2022 6869 6768 6572 2220  er and "higher" 
-0000bbc0: 7468 616e 206c 6173 7422 2222 0a20 2020  than last""".   
-0000bbd0: 2020 2020 2072 6574 7572 6e20 636c 732e       return cls.
-0000bbe0: 6973 5f73 6372 6970 745f 7479 7065 286c  is_script_type(l
-0000bbf0: 6173 745f 7370 616e 2c20 7468 6973 5f73  ast_span, this_s
-0000bc00: 7061 6e2c 2073 6372 6970 745f 7479 7065  pan, script_type
-0000bc10: 3d53 5363 7269 7074 2e53 5550 290a 0a20  =SScript.SUP).. 
-0000bc20: 2020 2040 636c 6173 736d 6574 686f 640a     @classmethod.
-0000bc30: 2020 2020 6465 6620 6973 5f73 6372 6970      def is_scrip
-0000bc40: 745f 7479 7065 2863 6c73 2c20 6c61 7374  t_type(cls, last
-0000bc50: 5f73 7061 6e2c 2074 6869 735f 7370 616e  _span, this_span
-0000bc60: 2c20 7363 7269 7074 5f74 7970 652c 2079  , script_type, y
-0000bc70: 646f 776e 3d54 7275 652c 2070 7265 6365  down=True, prece
-0000bc80: 6469 6e67 3d4e 6f6e 6529 202d 3e20 626f  ding=None) -> bo
-0000bc90: 6f6c 3a0a 2020 2020 2020 2020 2222 2268  ol:.        """h
-0000bca0: 6575 7269 7374 6320 746f 2064 6574 6572  euristc to deter
-0000bcb0: 6d69 6e65 2077 6865 7468 6572 2074 6869  mine whether thi
-0000bcc0: 735f 7370 616e 2069 7320 6120 7375 622f  s_span is a sub/
-0000bcd0: 7375 7065 7273 6372 6970 7420 6f66 206c  superscript of l
-0000bce0: 6173 745f 7370 616e 0a20 2020 2020 2020  ast_span.       
-0000bcf0: 204e 4f54 453a 2049 4620 5920 6973 2044   NOTE: IF Y is D
-0000bd00: 4f57 4e20 7468 6520 7061 6765 2c20 6120  OWN the page, a 
-0000bd10: 7375 7065 7273 6372 6970 7420 6861 7320  superscript has 
-0000bd20: 534d 414c 4c45 5220 792d 7661 6c75 652c  SMALLER y-value,
-0000bd30: 2065 7463 2e20 286c 6f67 6963 2072 6576   etc. (logic rev
-0000bd40: 6572 7365 6420 6966 206e 6f74 2079 646f  ersed if not ydo
-0000bd50: 776e 290a 2020 2020 2020 2020 3a70 6172  wn).        :par
-0000bd60: 616d 206c 6173 745f 7370 616e 3a20 6966  am last_span: if
-0000bd70: 204e 6f6e 652c 2072 6574 7572 6e73 2066   None, returns f
-0000bd80: 616c 7365 0a20 2020 2020 2020 203a 7061  alse.        :pa
-0000bd90: 7261 6d20 7468 6973 5f73 7061 6e3a 2069  ram this_span: i
-0000bda0: 6620 6e6f 7420 736d 616c 6c65 7220 6279  f not smaller by
-0000bdb0: 2053 4352 4950 545f 4641 4354 2072 6574   SCRIPT_FACT ret
-0000bdc0: 7572 6e20 4661 6c73 650a 2020 2020 2020  urn False.      
-0000bdd0: 2020 3a70 6172 616d 2073 6372 6970 745f    :param script_
-0000bde0: 7479 7065 3a20 5353 6372 6970 742e 5355  type: SScript.SU
-0000bdf0: 4220 6f72 2053 5363 7269 7074 2e53 5550  B or SScript.SUP
-0000be00: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-0000be10: 7964 6f77 6e3a 2054 7275 6520 6966 2079  ydown: True if y
-0000be20: 2069 6e63 7265 6173 6573 2064 6f77 6e20   increases down 
-0000be30: 7468 7220 7061 6765 2028 652e 672e 2053  thr page (e.g. S
-0000be40: 5647 2920 2844 4546 4155 4c54 2920 656c  VG) (DEFAULT) el
-0000be50: 7365 2046 616c 7365 0a20 2020 2020 2020  se False.       
-0000be60: 203a 7265 7475 726e 3a20 5472 7565 2069   :return: True i
-0000be70: 6620 736d 616c 6c65 7220 616e 6420 6d6f  f smaller and mo
-0000be80: 7665 6420 696e 2072 6967 6874 2079 2d64  ved in right y-d
-0000be90: 6972 6563 7469 6f6e 0a20 2020 2020 2020  irection.       
-0000bea0: 2022 2222 0a20 2020 2020 2020 2069 6620   """.        if 
-0000beb0: 7468 6973 5f73 7061 6e20 6973 204e 6f6e  this_span is Non
-0000bec0: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
-0000bed0: 6574 7572 6e20 4661 6c73 650a 2020 2020  eturn False.    
-0000bee0: 2020 2020 2320 7472 7920 746f 2066 696e      # try to fin
-0000bef0: 6420 6d69 7373 696e 6720 6c61 7374 5f73  d missing last_s
-0000bf00: 7061 6e0a 2020 2020 2020 2020 6966 206c  pan.        if l
-0000bf10: 6173 745f 7370 616e 2069 7320 4e6f 6e65  ast_span is None
-0000bf20: 3a0a 2020 2020 2020 2020 2020 2020 6c61  :.            la
-0000bf30: 7374 5f73 7061 6e20 3d20 7468 6973 5f73  st_span = this_s
-0000bf40: 7061 6e2e 7870 6174 6828 6622 7b58 5f50  pan.xpath(f"{X_P
-0000bf50: 5245 4345 4449 4e47 7d3a 3a7b 485f 5350  RECEDING}::{H_SP
-0000bf60: 414e 7d22 290a 2020 2020 2020 2020 2020  AN}").          
-0000bf70: 2020 6966 206c 656e 286c 6173 745f 7370    if len(last_sp
-0000bf80: 616e 2920 3d3d 2030 3a0a 2020 2020 2020  an) == 0:.      
-0000bf90: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0000bfa0: 2046 616c 7365 0a20 2020 2020 2020 2020   False.         
-0000bfb0: 2020 206c 6173 745f 7370 616e 203d 206c     last_span = l
-0000bfc0: 6173 745f 7370 616e 5b30 5d0a 2020 2020  ast_span[0].    
-0000bfd0: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-0000bfe0: 2020 2020 206c 6173 745f 666f 6e74 5f73       last_font_s
-0000bff0: 697a 6520 3d20 4e6f 6e65 0a20 2020 2020  ize = None.     
-0000c000: 2020 2020 2020 2074 6869 735f 666f 6e74         this_font
-0000c010: 5f73 697a 6520 3d20 4e6f 6e65 0a20 2020  _size = None.   
-0000c020: 2020 2020 2020 2020 206c 6173 745f 666f           last_fo
-0000c030: 6e74 5f73 697a 6520 3d20 6c61 7374 5f73  nt_size = last_s
-0000c040: 7061 6e2e 7465 7874 5f73 7479 6c65 2e5f  pan.text_style._
-0000c050: 666f 6e74 5f73 697a 650a 2020 2020 2020  font_size.      
-0000c060: 2020 2020 2020 7468 6973 5f66 6f6e 745f        this_font_
-0000c070: 7369 7a65 203d 2074 6869 735f 7370 616e  size = this_span
-0000c080: 2e74 6578 745f 7374 796c 652e 5f66 6f6e  .text_style._fon
-0000c090: 745f 7369 7a65 0a20 2020 2020 2020 2065  t_size.        e
-0000c0a0: 7863 6570 7420 4578 6365 7074 696f 6e20  xcept Exception 
-0000c0b0: 6173 2065 3a0a 2020 2020 2020 2020 2020  as e:.          
-0000c0c0: 2020 7061 7373 0a20 2020 2020 2020 2020    pass.         
-0000c0d0: 2020 2023 206e 6f20 666f 6e74 2073 7479     # no font sty
-0000c0e0: 6c65 0a20 2020 2020 2020 2069 735f 7363  le.        is_sc
-0000c0f0: 7269 7074 203d 2063 6c73 2e69 735f 7265  ript = cls.is_re
-0000c100: 7175 6972 6564 5f73 6372 6970 745f 7479  quired_script_ty
-0000c110: 7065 2873 6372 6970 745f 7479 7065 2c20  pe(script_type, 
-0000c120: 6c61 7374 5f66 6f6e 745f 7369 7a65 2c20  last_font_size, 
-0000c130: 6c61 7374 5f73 7061 6e2c 2074 6869 735f  last_span, this_
-0000c140: 666f 6e74 5f73 697a 652c 2074 6869 735f  font_size, this_
-0000c150: 7370 616e 2c0a 2020 2020 2020 2020 2020  span,.          
-0000c160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c180: 2020 7964 6f77 6e29 0a20 2020 2020 2020    ydown).       
-0000c190: 2072 6574 7572 6e20 6973 5f73 6372 6970   return is_scrip
-0000c1a0: 740a 0a20 2020 2040 636c 6173 736d 6574  t..    @classmet
-0000c1b0: 686f 640a 2020 2020 6465 6620 6973 5f72  hod.    def is_r
-0000c1c0: 6571 7569 7265 645f 7363 7269 7074 5f74  equired_script_t
-0000c1d0: 7970 6528 636c 732c 2073 6372 6970 745f  ype(cls, script_
-0000c1e0: 7479 7065 2c20 6c61 7374 5f66 6f6e 745f  type, last_font_
-0000c1f0: 7369 7a65 2c20 6c61 7374 5f73 7061 6e2c  size, last_span,
-0000c200: 2074 6869 735f 666f 6e74 5f73 697a 652c   this_font_size,
-0000c210: 2074 6869 735f 7370 616e 2c20 7964 6f77   this_span, ydow
-0000c220: 6e3d 5472 7565 2c20 293a 0a20 2020 2020  n=True, ):.     
-0000c230: 2020 2022 2222 6f6c 6420 6170 7072 6f61     """old approa
-0000c240: 6368 2077 6974 6820 416d 6953 7061 6e0a  ch with AmiSpan.
-0000c250: 2020 2020 2020 2020 5468 6973 2069 7320          This is 
-0000c260: 6e6f 7420 7269 6768 7421 2222 220a 2020  not right!""".  
-0000c270: 2020 2020 2020 5946 4143 544f 5220 3d20        YFACTOR = 
-0000c280: 3320 2320 7069 7865 6c73 0a20 2020 2020  3 # pixels.     
-0000c290: 2020 2069 735f 7363 7269 7074 203d 2046     is_script = F
-0000c2a0: 616c 7365 0a20 2020 2020 2020 2073 6372  alse.        scr
-0000c2b0: 6970 745f 6661 6374 6f72 203d 2048 746d  ipt_factor = Htm
-0000c2c0: 6c55 7469 6c2e 5343 5249 5054 5f46 4143  lUtil.SCRIPT_FAC
-0000c2d0: 540a 2020 2020 2020 2020 2320 6966 2066  T.        # if f
-0000c2e0: 6f6e 7420 7369 7a65 7320 6e6f 7420 6769  ont sizes not gi
-0000c2f0: 7665 6e20 6173 7375 6d65 2074 6865 7920  ven assume they 
-0000c300: 646f 6e27 7420 6d61 7474 6572 0a20 2020  don't matter.   
-0000c310: 2020 2020 2069 6620 6c61 7374 5f66 6f6e       if last_fon
-0000c320: 745f 7369 7a65 2061 6e64 2074 6869 735f  t_size and this_
-0000c330: 666f 6e74 5f73 697a 653a 0a20 2020 2020  font_size:.     
-0000c340: 2020 2020 2020 2070 6173 7365 645f 666f         passed_fo
-0000c350: 6e74 5f73 697a 655f 6368 616e 6765 203d  nt_size_change =
-0000c360: 2074 6869 735f 666f 6e74 5f73 697a 6520   this_font_size 
-0000c370: 3c20 7363 7269 7074 5f66 6163 746f 7220  < script_factor 
-0000c380: 2a20 6c61 7374 5f66 6f6e 745f 7369 7a65  * last_font_size
-0000c390: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-0000c3a0: 2020 2020 2020 2020 2020 2070 6173 7365             passe
-0000c3b0: 645f 666f 6e74 5f73 697a 655f 6368 616e  d_font_size_chan
-0000c3c0: 6765 203d 2054 7275 650a 2020 2020 2020  ge = True.      
-0000c3d0: 2020 2320 7573 6520 7920 636f 6f72 6473    # use y coords
-0000c3e0: 0a20 2020 2020 2020 2069 6620 7061 7373  .        if pass
-0000c3f0: 6564 5f66 6f6e 745f 7369 7a65 5f63 6861  ed_font_size_cha
-0000c400: 6e67 653a 0a20 2020 2020 2020 2020 2020  nge:.           
-0000c410: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
-0000c420: 2020 2020 2020 6c61 7374 5f79 203d 206c        last_y = l
-0000c430: 6173 745f 7370 616e 2e79 0a20 2020 2020  ast_span.y.     
-0000c440: 2020 2020 2020 2020 2020 2074 6869 735f             this_
-0000c450: 7920 3d20 7468 6973 5f73 7061 6e2e 790a  y = this_span.y.
-0000c460: 2020 2020 2020 2020 2020 2020 6578 6365              exce
-0000c470: 7074 2045 7863 6570 7469 6f6e 2061 7320  pt Exception as 
-0000c480: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0000c490: 2020 206c 6173 745f 7920 3d20 4874 6d6c     last_y = Html
-0000c4a0: 5574 696c 2e67 6574 5f66 6c6f 6174 286c  Util.get_float(l
-0000c4b0: 6173 745f 7370 616e 2c20 2279 3022 290a  ast_span, "y0").
-0000c4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c4d0: 7468 6973 5f79 203d 2048 746d 6c55 7469  this_y = HtmlUti
-0000c4e0: 6c2e 6765 745f 666c 6f61 7428 7468 6973  l.get_float(this
-0000c4f0: 5f73 7061 6e2c 2022 7930 2229 0a20 2020  _span, "y0").   
-0000c500: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
-0000c510: 2020 2020 2020 2020 2020 2020 2020 6c61                la
-0000c520: 7374 5f78 203d 206c 6173 745f 7370 616e  st_x = last_span
-0000c530: 2e78 0a20 2020 2020 2020 2020 2020 2020  .x.             
-0000c540: 2020 2074 6869 735f 7820 3d20 7468 6973     this_x = this
-0000c550: 5f73 7061 6e2e 780a 2020 2020 2020 2020  _span.x.        
-0000c560: 2020 2020 6578 6365 7074 2045 7863 6570      except Excep
-0000c570: 7469 6f6e 2061 7320 653a 0a20 2020 2020  tion as e:.     
-0000c580: 2020 2020 2020 2020 2020 206c 6173 745f             last_
-0000c590: 7820 3d20 4874 6d6c 5574 696c 2e67 6574  x = HtmlUtil.get
-0000c5a0: 5f66 6c6f 6174 286c 6173 745f 7370 616e  _float(last_span
-0000c5b0: 2c20 2278 3022 290a 2020 2020 2020 2020  , "x0").        
-0000c5c0: 2020 2020 2020 2020 7468 6973 5f78 203d          this_x =
-0000c5d0: 2048 746d 6c55 7469 6c2e 6765 745f 666c   HtmlUtil.get_fl
-0000c5e0: 6f61 7428 7468 6973 5f73 7061 6e2c 2022  oat(this_span, "
-0000c5f0: 7830 2229 0a20 2020 2020 2020 2020 2020  x0").           
-0000c600: 2069 6620 7363 7269 7074 5f74 7970 6520   if script_type 
-0000c610: 3d3d 2053 5363 7269 7074 2e53 5542 3a0a  == SScript.SUB:.
-0000c620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c630: 2320 6973 2069 7420 6c6f 7765 7265 643f  # is it lowered?
-0000c640: 2059 2044 4f57 4e0a 2020 2020 2020 2020   Y DOWN.        
-0000c650: 2020 2020 2020 2020 6973 5f73 6372 6970          is_scrip
-0000c660: 7420 3d20 7964 6f77 6e20 616e 6420 286c  t = ydown and (l
-0000c670: 6173 745f 7920 3c20 7468 6973 5f79 290a  ast_y < this_y).
-0000c680: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-0000c690: 2073 6372 6970 745f 7479 7065 203d 3d20   script_type == 
-0000c6a0: 5353 6372 6970 742e 5355 503a 0a20 2020  SScript.SUP:.   
-0000c6b0: 2020 2020 2020 2020 2020 2020 2023 2069               # i
-0000c6c0: 7320 6974 2072 6169 7365 643f 2059 2044  s it raised? Y D
-0000c6d0: 4f57 4e0a 2020 2020 2020 2020 2020 2020  OWN.            
-0000c6e0: 2020 2020 6973 5f73 6372 6970 7420 3d20      is_script = 
-0000c6f0: 7964 6f77 6e20 616e 6420 286c 6173 745f  ydown and (last_
-0000c700: 7920 2d20 7468 6973 5f79 2920 3e20 5946  y - this_y) > YF
-0000c710: 4143 544f 520a 2020 2020 2020 2020 2020  ACTOR.          
-0000c720: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0000c730: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-0000c740: 6c75 6545 7272 6f72 2822 6261 6420 7363  lueError("bad sc
-0000c750: 7269 7074 2074 7970 6520 222c 2073 6372  ript type ", scr
-0000c760: 6970 745f 7479 7065 290a 2020 2020 2020  ipt_type).      
-0000c770: 2020 2020 2020 6966 2046 616c 7365 3a0a        if False:.
-0000c780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c790: 6966 2069 735f 7363 7269 7074 2061 6e64  if is_script and
-0000c7a0: 206c 6173 745f 7820 616e 6420 7468 6973   last_x and this
-0000c7b0: 5f78 3a0a 2020 2020 2020 2020 2020 2020  _x:.            
-0000c7c0: 2020 2020 2020 2020 6973 5f73 6372 6970          is_scrip
-0000c7d0: 7420 3d20 6c61 7374 5f78 203c 2074 6869  t = last_x < thi
-0000c7e0: 735f 780a 2020 2020 2020 2020 7265 7475  s_x.        retu
-0000c7f0: 726e 2069 735f 7363 7269 7074 0a0a 2020  rn is_script..  
-0000c800: 2020 4063 6c61 7373 6d65 7468 6f64 0a20    @classmethod. 
-0000c810: 2020 2064 6566 2065 7874 7261 6374 5f66     def extract_f
-0000c820: 6f6f 746e 6f74 6573 2863 6c73 2c20 6874  ootnotes(cls, ht
-0000c830: 6d6c 5f65 6c65 6d2c 2066 6f6e 745f 7369  ml_elem, font_si
-0000c840: 7a65 5f63 6f6e 6469 7469 6f6e 2c20 7469  ze_condition, ti
-0000c850: 746c 653d 2246 6f6f 746e 6f74 6573 2229  tle="Footnotes")
-0000c860: 3a0a 2020 2020 2020 2020 6469 7673 203d  :.        divs =
-0000c870: 2068 746d 6c5f 656c 656d 2e78 7061 7468   html_elem.xpath
-0000c880: 2866 222f 2f64 6976 5b73 7061 6e5b 636f  (f"//div[span[co
-0000c890: 6e74 6169 6e73 2840 7374 796c 652c 2027  ntains(@style, '
-0000c8a0: 7b66 6f6e 745f 7369 7a65 5f63 6f6e 6469  {font_size_condi
-0000c8b0: 7469 6f6e 7d27 2920 616e 6420 6e75 6d62  tion}') and numb
-0000c8c0: 6572 282e 293d 6e75 6d62 6572 282e 295d  er(.)=number(.)]
-0000c8d0: 5d22 290a 2020 2020 2020 2020 666f 6f74  ]").        foot
-0000c8e0: 6e6f 7465 5f64 6976 203d 2048 746d 6c47  note_div = HtmlG
-0000c8f0: 726f 7570 2e67 6574 5f62 6163 6b5f 6469  roup.get_back_di
-0000c900: 7628 6874 6d6c 5f65 6c65 6d29 0a20 2020  v(html_elem).   
-0000c910: 2020 2020 2066 6f6f 746e 6f74 655f 7469       footnote_ti
-0000c920: 746c 6520 3d20 4554 2e53 7562 456c 656d  tle = ET.SubElem
-0000c930: 656e 7428 666f 6f74 6e6f 7465 5f64 6976  ent(footnote_div
-0000c940: 2c20 2264 6976 2229 0a20 2020 2020 2020  , "div").       
-0000c950: 2066 6f6f 746e 6f74 655f 7469 746c 652e   footnote_title.
-0000c960: 7465 7874 203d 2074 6974 6c65 0a20 2020  text = title.   
-0000c970: 2020 2020 2075 6c20 3d20 4554 2e53 7562       ul = ET.Sub
-0000c980: 456c 656d 656e 7428 666f 6f74 6e6f 7465  Element(footnote
-0000c990: 5f64 6976 2c20 2275 6c22 290a 2020 2020  _div, "ul").    
-0000c9a0: 2020 2020 6375 7272 656e 745f 6c69 203d      current_li =
-0000c9b0: 204e 6f6e 650a 2020 2020 2020 2020 666f   None.        fo
-0000c9c0: 7220 6469 7620 696e 2064 6976 733a 0a20  r div in divs:. 
-0000c9d0: 2020 2020 2020 2020 2020 2073 7061 6e73             spans
-0000c9e0: 203d 2064 6976 2e78 7061 7468 2822 2e2f   = div.xpath("./
-0000c9f0: 7370 616e 2229 0a20 2020 2020 2020 2020  span").         
-0000ca00: 2020 2066 6f72 2069 2c20 7370 616e 2069     for i, span i
-0000ca10: 6e20 656e 756d 6572 6174 6528 7370 616e  n enumerate(span
-0000ca20: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
-0000ca30: 2020 2020 6966 2058 6d6c 4c69 622e 6973      if XmlLib.is
-0000ca40: 5f69 6e74 6567 6572 2873 7061 6e29 2061  _integer(span) a
-0000ca50: 6e64 2028 6920 3d3d 2030 206f 7220 4874  nd (i == 0 or Ht
-0000ca60: 6d6c 5574 696c 2e69 735f 7375 7065 7273  mlUtil.is_supers
-0000ca70: 6372 6970 7428 7370 616e 735b 6920 2d20  cript(spans[i - 
-0000ca80: 315d 2c20 7370 616e 2929 3a0a 2020 2020  1], span)):.    
-0000ca90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000caa0: 6375 7272 656e 745f 6c69 203d 2045 542e  current_li = ET.
-0000cab0: 5375 6245 6c65 6d65 6e74 2875 6c2c 2022  SubElement(ul, "
-0000cac0: 6c69 2229 0a20 2020 2020 2020 2020 2020  li").           
-0000cad0: 2020 2020 2069 6620 6375 7272 656e 745f       if current_
-0000cae0: 6c69 2069 7320 6e6f 7420 4e6f 6e65 3a0a  li is not None:.
-0000caf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cb00: 2020 2020 6375 7272 656e 745f 6c69 2e61      current_li.a
-0000cb10: 7070 656e 6428 7370 616e 290a 0a0a 2020  ppend(span)...  
-0000cb20: 2020 4063 6c61 7373 6d65 7468 6f64 0a20    @classmethod. 
-0000cb30: 2020 2064 6566 2061 6e6e 6f74 6174 655f     def annotate_
-0000cb40: 7363 7269 7074 5f74 7970 6528 636c 732c  script_type(cls,
-0000cb50: 2073 7061 6e2c 2073 6372 6970 745f 7479   span, script_ty
-0000cb60: 7065 2c20 7363 7269 7074 5f66 6163 746f  pe, script_facto
-0000cb70: 723d 4e6f 6e65 2c20 6c61 7374 5f73 7061  r=None, last_spa
-0000cb80: 6e3d 4e6f 6e65 2c20 7964 6f77 6e3d 5472  n=None, ydown=Tr
-0000cb90: 7565 293a 0a20 2020 2020 2020 2022 2222  ue):.        """
-0000cba0: 6973 2061 2073 7061 6e20 6120 7375 6220  is a span a sub 
-0000cbb0: 6f72 2073 7570 6572 7363 7269 7074 3f0a  or superscript?.
-0000cbc0: 2020 2020 2020 2020 3a70 6172 616d 2073          :param s
-0000cbd0: 7061 6e3a 2074 6f20 7465 7374 0a20 2020  pan: to test.   
-0000cbe0: 2020 2020 203a 7061 7261 6d20 7363 7269       :param scri
-0000cbf0: 7074 5f74 7970 653a 2053 5363 7269 7074  pt_type: SScript
-0000cc00: 2e53 5542 206f 7220 5353 6372 6970 742e  .SUB or SScript.
-0000cc10: 5355 5045 520a 2020 2020 2020 2020 3a70  SUPER.        :p
-0000cc20: 6172 616d 2073 6372 6970 745f 6661 6374  aram script_fact
-0000cc30: 6f72 3a20 6966 204e 6f6e 652c 2064 6566  or: if None, def
-0000cc40: 6175 6c74 7320 746f 2048 746d 6c55 7469  aults to HtmlUti
-0000cc50: 6c2e 5343 5249 5054 5f46 4143 540a 2020  l.SCRIPT_FACT.  
-0000cc60: 2020 2020 2020 3a70 6172 616d 206c 6173        :param las
-0000cc70: 745f 7370 616e 3a20 7072 6563 6564 696e  t_span: precedin
-0000cc80: 6720 7370 616e 3b20 6966 204e 6f6e 6520  g span; if None 
-0000cc90: 7472 6965 7320 7870 6174 6828 2270 7265  tries xpath("pre
-0000cca0: 6365 6469 6e67 3a3a 7370 616e 2229 0a20  ceding::span"). 
-0000ccb0: 2020 2020 2020 203a 7061 7261 6d20 7964         :param yd
-0000ccc0: 6f77 6e3a 2069 7320 7920 7275 6e6e 696e  own: is y runnin
-0000ccd0: 6720 646f 6e77 2074 6865 2070 6167 653f  g donw the page?
-0000cce0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0000ccf0: 2020 2020 2069 6620 7370 616e 2069 7320       if span is 
-0000cd00: 4e6f 6e65 206f 7220 6e6f 7420 7363 7269  None or not scri
-0000cd10: 7074 5f74 7970 653a 0a20 2020 2020 2020  pt_type:.       
-0000cd20: 2020 2020 2072 6574 7572 6e20 4e6f 6e65       return None
-0000cd30: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-0000cd40: 7363 7269 7074 5f66 6163 746f 723a 0a20  script_factor:. 
-0000cd50: 2020 2020 2020 2020 2020 2073 6372 6970             scrip
-0000cd60: 745f 6661 6374 6f72 203d 2048 746d 6c55  t_factor = HtmlU
-0000cd70: 7469 6c2e 5343 5249 5054 5f46 4143 540a  til.SCRIPT_FACT.
-0000cd80: 2020 2020 2020 2020 6966 206e 6f74 206c          if not l
-0000cd90: 6173 745f 7370 616e 3a0a 2020 2020 2020  ast_span:.      
-0000cda0: 2020 2020 2020 6c61 7374 5f73 7061 6e20        last_span 
-0000cdb0: 3d20 7370 616e 2e78 7061 7468 2822 7072  = span.xpath("pr
-0000cdc0: 6563 6564 696e 673a 3a73 7061 6e22 290a  eceding::span").
-0000cdd0: 2020 2020 2020 2020 2020 2020 6966 206c              if l
-0000cde0: 656e 286c 6173 745f 7370 616e 2920 3d3d  en(last_span) ==
-0000cdf0: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
-0000ce00: 2020 2020 7265 7475 726e 204e 6f6e 650a      return None.
-0000ce10: 2020 2020 2020 2020 2020 2020 6c61 7374              last
-0000ce20: 5f73 7061 6e20 3d20 6c61 7374 5f73 7061  _span = last_spa
-0000ce30: 6e5b 2d31 5d0a 2020 2020 2020 2020 6373  n[-1].        cs
-0000ce40: 7373 203d 2043 5353 5374 796c 652e 6372  ss = CSSStyle.cr
-0000ce50: 6561 7465 5f63 7373 5f73 7479 6c65 5f66  eate_css_style_f
-0000ce60: 726f 6d5f 6174 7472 6962 7574 655f 6f66  rom_attribute_of
-0000ce70: 5f62 6f64 795f 656c 656d 656e 7428 7370  _body_element(sp
-0000ce80: 616e 290a 2020 2020 2020 2020 6c61 7374  an).        last
-0000ce90: 5f63 7373 7320 3d20 4353 5353 7479 6c65  _csss = CSSStyle
-0000cea0: 2e63 7265 6174 655f 6373 735f 7374 796c  .create_css_styl
-0000ceb0: 655f 6672 6f6d 5f61 7474 7269 6275 7465  e_from_attribute
-0000cec0: 5f6f 665f 626f 6479 5f65 6c65 6d65 6e74  _of_body_element
-0000ced0: 286c 6173 745f 7370 616e 290a 2020 2020  (last_span).    
-0000cee0: 2020 2020 666f 6e74 5f73 697a 6520 3d20      font_size = 
-0000cef0: 6373 7373 2e66 6f6e 745f 7369 7a65 0a20  csss.font_size. 
-0000cf00: 2020 2020 2020 206c 6173 745f 666f 6e74         last_font
-0000cf10: 5f73 697a 6520 3d20 6c61 7374 5f63 7373  _size = last_css
-0000cf20: 732e 666f 6e74 5f73 697a 650a 2020 2020  s.font_size.    
-0000cf30: 2020 2020 6973 5f73 6372 6970 7420 3d20      is_script = 
-0000cf40: 4e6f 6e65 0a20 2020 2020 2020 2069 6620  None.        if 
-0000cf50: 666f 6e74 5f73 697a 6520 616e 6420 666f  font_size and fo
-0000cf60: 6e74 5f73 697a 6520 3c20 7363 7269 7074  nt_size < script
-0000cf70: 5f66 6163 746f 7220 2a20 6c61 7374 5f66  _factor * last_f
-0000cf80: 6f6e 745f 7369 7a65 3a0a 2020 2020 2020  ont_size:.      
-0000cf90: 2020 2020 2020 6c61 7374 5f79 203d 2043        last_y = C
-0000cfa0: 5353 5374 796c 652e 6765 745f 7930 286c  SSStyle.get_y0(l
-0000cfb0: 6173 745f 7370 616e 290a 2020 2020 2020  ast_span).      
-0000cfc0: 2020 2020 2020 7468 6973 5f79 203d 2043        this_y = C
-0000cfd0: 5353 5374 796c 652e 6765 745f 7930 2873  SSStyle.get_y0(s
-0000cfe0: 7061 6e29 0a20 2020 2020 2020 2020 2020  pan).           
-0000cff0: 2069 6620 7363 7269 7074 5f74 7970 6520   if script_type 
-0000d000: 3d3d 2053 5363 7269 7074 2e53 5542 3a0a  == SScript.SUB:.
-0000d010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d020: 2320 6973 2069 7420 6c6f 7765 7265 643f  # is it lowered?
-0000d030: 2059 2044 4f57 4e0a 2020 2020 2020 2020   Y DOWN.        
-0000d040: 2020 2020 2020 2020 6973 5f73 6372 6970          is_scrip
-0000d050: 7420 3d20 7964 6f77 6e20 3d3d 2028 6c61  t = ydown == (la
-0000d060: 7374 5f79 203c 2074 6869 735f 7929 0a20  st_y < this_y). 
-0000d070: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
-0000d080: 7363 7269 7074 5f74 7970 6520 3d3d 2053  script_type == S
-0000d090: 5363 7269 7074 2e53 5550 3a0a 2020 2020  Script.SUP:.    
-0000d0a0: 2020 2020 2020 2020 2020 2020 2320 6973              # is
-0000d0b0: 2069 7420 7261 6973 6564 3f20 5920 444f   it raised? Y DO
-0000d0c0: 574e 0a20 2020 2020 2020 2020 2020 2020  WN.             
-0000d0d0: 2020 2069 735f 7363 7269 7074 203d 2079     is_script = y
-0000d0e0: 646f 776e 203d 3d20 286c 6173 745f 7920  down == (last_y 
-0000d0f0: 3e20 7468 6973 5f79 290a 2020 2020 2020  > this_y).      
-0000d100: 2020 2020 2020 6966 2069 735f 7363 7269        if is_scri
-0000d110: 7074 3a0a 2020 2020 2020 2020 2020 2020  pt:.            
-0000d120: 2020 2020 7061 7373 0a20 2020 2020 2020      pass.       
-0000d130: 2072 6574 7572 6e20 6973 5f73 6372 6970   return is_scrip
-0000d140: 740a 0a0a 2020 2020 4063 6c61 7373 6d65  t...    @classme
-0000d150: 7468 6f64 0a20 2020 2064 6566 2073 6574  thod.    def set
-0000d160: 5f61 7474 7269 6228 636c 732c 2065 6c65  _attrib(cls, ele
-0000d170: 6d65 6e74 2c20 6174 746e 616d 652c 2061  ment, attname, a
-0000d180: 7474 7661 6c75 6529 3a0a 2020 2020 2020  ttvalue):.      
-0000d190: 2020 2222 2263 6f6e 7665 6e69 656e 6365    """convenience
-0000d1a0: 206d 6574 686f 6420 746f 2073 6574 2061   method to set a
-0000d1b0: 7474 7269 6275 7465 2076 616c 7565 0a20  ttribute value. 
-0000d1c0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0000d1d0: 2020 2069 6620 656c 656d 656e 7420 6973     if element is
-0000d1e0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-0000d1f0: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
-0000d200: 726f 7228 2265 6c65 6d65 6e74 2069 7320  ror("element is 
-0000d210: 4e6f 6e65 2229 0a20 2020 2020 2020 2069  None").        i
-0000d220: 6620 6174 746e 616d 6520 616e 6420 6174  f attname and at
-0000d230: 7476 616c 7565 3a0a 2020 2020 2020 2020  tvalue:.        
-0000d240: 2020 2020 656c 656d 656e 742e 7365 7428      element.set(
-0000d250: 6174 746e 616d 652c 2073 7472 2861 7474  attname, str(att
-0000d260: 7661 6c75 6529 290a 0a20 2020 2040 636c  value))..    @cl
-0000d270: 6173 736d 6574 686f 640a 2020 2020 6465  assmethod.    de
-0000d280: 6620 6765 745f 7465 7874 5f63 6f6e 7465  f get_text_conte
-0000d290: 6e74 2863 6c73 2c20 656c 656d 293a 0a20  nt(cls, elem):. 
-0000d2a0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0000d2b0: 2020 2063 6f6e 7665 6e69 656e 6365 206d     convenience m
-0000d2c0: 6574 686f 643b 2061 766f 6964 7320 6861  ethod; avoids ha
-0000d2d0: 7669 6e67 2074 6f20 7265 6d65 6d62 6572  ving to remember
-0000d2e0: 206a 6f69 6e2f 6974 6572 7465 7874 0a20   join/itertext. 
-0000d2f0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0000d300: 2020 2072 6574 7572 6e20 2727 2e6a 6f69     return ''.joi
-0000d310: 6e28 656c 656d 2e69 7465 7274 6578 7428  n(elem.itertext(
-0000d320: 2929 0a0a 2020 2020 4063 6c61 7373 6d65  ))..    @classme
-0000d330: 7468 6f64 0a20 2020 2064 6566 2061 6464  thod.    def add
-0000d340: 5f67 656e 6572 6174 6564 5f69 6473 2863  _generated_ids(c
-0000d350: 6c73 2c20 726f 6f74 5f65 6c65 6d29 3a0a  ls, root_elem):.
-0000d360: 2020 2020 2020 2020 2222 2261 6464 7320          """adds 
-0000d370: 4944 7320 746f 2061 6c6c 2065 6c65 6d65  IDs to all eleme
-0000d380: 6e74 7320 696e 2064 6f63 756d 656e 7420  nts in document 
-0000d390: 6f72 6465 720a 2020 2020 2020 2020 3a70  order.        :p
-0000d3a0: 6172 616d 2072 6f6f 745f 656c 656d 3a20  aram root_elem: 
-0000d3b0: 656c 656d 656e 7420 6465 6669 6e69 6e67  element defining
-0000d3c0: 2074 7265 6520 6f66 2073 7562 656c 656d   tree of subelem
-0000d3d0: 656e 7473 2222 220a 2020 2020 2020 2020  ents""".        
-0000d3e0: 7870 6174 6820 3d20 222f 2f2a 220a 2020  xpath = "//*".  
-0000d3f0: 2020 2020 2020 656c 656d 7320 3d20 726f        elems = ro
-0000d400: 6f74 5f65 6c65 6d2e 7870 6174 6828 7870  ot_elem.xpath(xp
-0000d410: 6174 6829 0a20 2020 2020 2020 2066 6f72  ath).        for
-0000d420: 2069 2c20 656c 2069 6e20 656e 756d 6572   i, el in enumer
-0000d430: 6174 6528 656c 656d 7329 3a0a 2020 2020  ate(elems):.    
-0000d440: 2020 2020 2020 2020 656c 2e61 7474 7269          el.attri
-0000d450: 625b 415f 4944 5d20 3d20 415f 4944 202b  b[A_ID] = A_ID +
-0000d460: 2073 7472 2869 290a 2020 2020 4063 6c61   str(i).    @cla
-0000d470: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
-0000d480: 206a 6f69 6e5f 7370 616e 735f 696e 5f73   join_spans_in_s
-0000d490: 616d 655f 6469 7628 636c 732c 2073 7061  ame_div(cls, spa
-0000d4a0: 6e30 2c20 7370 616e 312c 2061 6464 7370  n0, span1, addsp
-0000d4b0: 6163 653d 5472 7565 2c20 7265 6d6f 7665  ace=True, remove
-0000d4c0: 3d54 7275 6529 3a0a 2020 2020 2020 2020  =True):.        
-0000d4d0: 2222 220a 2020 2020 2020 2020 6a6f 696e  """.        join
-0000d4e0: 7420 3c73 7061 6e3e 2e2e 2e3c 2f73 7061  t <span>...</spa
-0000d4f0: 6e3e 3c73 7061 6e3e 2e2e 2e3c 2f73 7061  n><span>...</spa
-0000d500: 6e3e 2069 6e74 6f20 3c73 7061 6e3e 2e2e  n> into <span>..
-0000d510: 2e3c 2f73 7061 6e3e 0a20 2020 2020 2020  .</span>.       
-0000d520: 2074 6869 7320 7374 7275 6374 7572 6520   this structure 
-0000d530: 6172 6973 6573 2077 6865 6e20 5044 4620  arises when PDF 
-0000d540: 6f72 2069 6d61 6765 7320 6973 2070 6172  or images is par
-0000d550: 7365 6420 616e 6420 7370 616e 7320 6861  sed and spans ha
-0000d560: 7665 2074 6865 2073 616d 6520 7374 796c  ve the same styl
-0000d570: 6573 2028 7369 7a65 2f73 7479 6c65 2f77  es (size/style/w
-0000d580: 6569 6768 7429 2061 6e64 2063 616e 2062  eight) and can b
-0000d590: 6520 6d65 7267 6564 0a20 2020 2020 2020  e merged.       
-0000d5a0: 2077 6520 6173 7375 6d65 2074 6861 7420   we assume that 
-0000d5b0: 7374 796c 6520 616e 6420 6765 6f6d 6574  style and geomet
-0000d5c0: 7279 2063 6865 6b69 6e67 2068 6173 2062  ry cheking has b
-0000d5d0: 6565 6e20 646f 6e65 0a20 2020 2020 2020  een done.       
-0000d5e0: 203a 7061 7261 6d20 7370 616e 303a 2066   :param span0: f
-0000d5f0: 6972 7374 203c 7370 616e 3e2c 2074 6578  irst <span>, tex
-0000d600: 7420 7769 6c6c 2062 6520 696e 6372 6561  t will be increa
-0000d610: 7365 6420 6672 6f6d 2073 7061 6e31 0a20  sed from span1. 
-0000d620: 2020 2020 2020 203a 7061 7261 6d20 7370         :param sp
-0000d630: 616e 313a 2074 6578 7420 7769 6c6c 2062  an1: text will b
-0000d640: 6520 6170 7065 6e64 6564 2074 6f20 7370  e appended to sp
-0000d650: 616e 3020 7465 7874 0a20 2020 2020 2020  an0 text.       
-0000d660: 203a 7061 7261 6d20 7265 6d6f 7665 3a20   :param remove: 
-0000d670: 7265 6d6f 7665 2073 7061 6e31 2028 6465  remove span1 (de
-0000d680: 6661 756c 7429 0a20 2020 2020 2020 2022  fault).        "
-0000d690: 2222 0a20 2020 2020 2020 2069 6620 4874  "".        if Ht
-0000d6a0: 6d6c 5574 696c 2e63 6865 636b 5f74 6167  mlUtil.check_tag
-0000d6b0: 2873 7061 6e30 2c20 2273 7061 6e22 2920  (span0, "span") 
-0000d6c0: 616e 6420 4874 6d6c 5574 696c 2e63 6865  and HtmlUtil.che
-0000d6d0: 636b 5f74 6167 2873 7061 6e31 2c20 2273  ck_tag(span1, "s
-0000d6e0: 7061 6e22 293a 0a20 2020 2020 2020 2020  pan"):.         
-0000d6f0: 2020 2070 6172 656e 7431 203d 2073 7061     parent1 = spa
-0000d700: 6e31 2e67 6574 7061 7265 6e74 2829 0a20  n1.getparent(). 
-0000d710: 2020 2020 2020 2020 2020 2069 6620 6164             if ad
-0000d720: 6473 7061 6365 3a0a 2020 2020 2020 2020  dspace:.        
-0000d730: 2020 2020 2020 2020 7370 616e 305f 6e6f          span0_no
-0000d740: 745f 656e 645f 7370 6163 6520 3d20 6c65  t_end_space = le
-0000d750: 6e28 7370 616e 3029 203e 2030 2061 6e64  n(span0) > 0 and
-0000d760: 2073 7061 6e30 5b2d 315d 2021 3d20 2220   span0[-1] != " 
-0000d770: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-0000d780: 2020 7370 616e 315f 6e6f 745f 7374 6172    span1_not_star
-0000d790: 745f 7370 6163 6520 3d20 6c65 6e28 7370  t_space = len(sp
-0000d7a0: 616e 3129 203e 2030 2061 6e64 2073 7061  an1) > 0 and spa
-0000d7b0: 6e31 5b2d 315d 2021 3d20 2220 220a 2020  n1[-1] != " ".  
-0000d7c0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0000d7d0: 2073 7061 6e30 5f6e 6f74 5f65 6e64 5f73   span0_not_end_s
-0000d7e0: 7061 6365 2061 6e64 2073 7061 6e31 5f6e  pace and span1_n
-0000d7f0: 6f74 5f73 7461 7274 5f73 7061 6365 3a0a  ot_start_space:.
-0000d800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d810: 2020 2020 7370 616e 302e 7465 7874 202b      span0.text +
-0000d820: 3d20 2220 220a 2020 2020 2020 2020 2020  = " ".          
-0000d830: 2020 7370 616e 302e 7465 7874 202b 3d20    span0.text += 
-0000d840: 7370 616e 312e 7465 7874 0a20 2020 2020  span1.text.     
-0000d850: 2020 2020 2020 2069 6620 7265 6d6f 7665         if remove
-0000d860: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000d870: 2020 7061 7265 6e74 312e 7265 6d6f 7665    parent1.remove
-0000d880: 2873 7061 6e31 290a 0a0a 0a0a 2020 2020  (span1).....    
-0000d890: 4063 6c61 7373 6d65 7468 6f64 0a20 2020  @classmethod.   
-0000d8a0: 2064 6566 2063 7265 6174 655f 736b 656c   def create_skel
-0000d8b0: 6574 6f6e 5f68 746d 6c28 636c 7329 3a0a  eton_html(cls):.
-0000d8c0: 2020 2020 2020 2020 2222 2263 7265 6174          """creat
-0000d8d0: 6520 656d 7074 7920 6874 6d6c 2074 7265  e empty html tre
-0000d8e0: 650a 2020 2020 2020 2020 6874 6d6c 0a20  e.        html. 
-0000d8f0: 2020 2020 2020 2020 2020 2068 6561 640a             head.
-0000d900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d910: 6d65 7461 0a20 2020 2020 2020 2020 2020  meta.           
-0000d920: 2020 2020 2023 2073 7479 6c65 0a20 2020       # style.   
-0000d930: 2020 2020 2020 2020 2062 6f64 790a 0a20           body.. 
-0000d940: 2020 2020 2020 203a 7265 7475 726e 3a20         :return: 
-0000d950: 7468 6973 2068 746d 6c0a 2020 2020 2020  this html.      
-0000d960: 2020 2222 220a 0a20 2020 2020 2020 2068    """..        h
-0000d970: 746d 6c20 3d20 4554 2e45 6c65 6d65 6e74  tml = ET.Element
-0000d980: 2848 5f48 544d 4c29 0a20 2020 2020 2020  (H_HTML).       
-0000d990: 2068 6561 6420 3d20 4554 2e45 6c65 6d65   head = ET.Eleme
-0000d9a0: 6e74 2848 5f48 4541 4429 0a20 2020 2020  nt(H_HEAD).     
-0000d9b0: 2020 2068 746d 6c2e 6170 7065 6e64 2868     html.append(h
-0000d9c0: 6561 6429 0a20 2020 2020 2020 206d 6574  ead).        met
-0000d9d0: 6120 3d20 4554 2e45 6c65 6d65 6e74 2848  a = ET.Element(H
-0000d9e0: 5f4d 4554 4129 0a20 2020 2020 2020 2068  _META).        h
-0000d9f0: 6561 642e 6170 7065 6e64 286d 6574 6129  ead.append(meta)
-0000da00: 0a20 2020 2020 2020 2073 7479 6c65 203d  .        style =
-0000da10: 2045 542e 456c 656d 656e 7428 485f 5354   ET.Element(H_ST
-0000da20: 594c 4529 2020 2320 656d 7074 7920 3c73  YLE)  # empty <s
-0000da30: 7479 6c65 3e20 6d65 616e 7320 6e6f 2064  tyle> means no d
-0000da40: 6973 706c 6179 0a20 2020 2020 2020 2023  isplay.        #
-0000da50: 2068 6561 642e 6170 7065 6e64 2873 7479   head.append(sty
-0000da60: 6c65 290a 2020 2020 2020 2020 626f 6479  le).        body
-0000da70: 203d 2045 542e 456c 656d 656e 7428 485f   = ET.Element(H_
-0000da80: 424f 4459 290a 2020 2020 2020 2020 6874  BODY).        ht
-0000da90: 6d6c 2e61 7070 656e 6428 626f 6479 290a  ml.append(body).
-0000daa0: 2020 2020 2020 2020 7265 7475 726e 2068          return h
-0000dab0: 746d 6c0a 0a20 2020 2040 636c 6173 736d  tml..    @classm
-0000dac0: 6574 686f 640a 2020 2020 6465 6620 6669  ethod.    def fi
-0000dad0: 6e64 5f65 6c65 6d65 6e74 735f 7769 7468  nd_elements_with
-0000dae0: 5f73 7479 6c65 2863 6c73 2c20 656c 656d  _style(cls, elem
-0000daf0: 2c20 7870 6174 682c 2063 6f6e 6469 7469  , xpath, conditi
-0000db00: 6f6e 3d4e 6f6e 652c 2072 656d 6f76 653d  on=None, remove=
-0000db10: 4661 6c73 6529 3a0a 2020 2020 2020 2020  False):.        
-0000db20: 2222 2272 656d 6f76 6520 616c 6c20 656c  """remove all el
-0000db30: 656d 656e 7473 2077 6974 6820 7374 796c  ements with styl
-0000db40: 6520 6675 6c66 696c 6c69 6e67 2063 6f6e  e fulfilling con
-0000db50: 6469 7469 6f6e 0a20 2020 2020 2020 203a  dition.        :
-0000db60: 7061 7261 6d20 656c 656d 3a20 726f 6f74  param elem: root
-0000db70: 2065 6c65 6d65 6e74 2066 6f72 2078 7061   element for xpa
-0000db80: 7468 0a20 2020 2020 2020 203a 7061 7261  th.        :para
-0000db90: 6d20 7870 6174 683a 2065 6c65 6d65 6e74  m xpath: element
-0000dba0: 7320 746f 2073 6361 6e20 2c20 7368 6f75  s to scan , shou
-0000dbb0: 6c64 206e 6f72 6d61 6c6c 7920 636f 6e74  ld normally cont
-0000dbc0: 6169 6e20 7468 6520 4073 7479 6c65 2063  ain the @style c
-0000dbd0: 6f6e 6469 7469 6f6e 0a20 2020 2020 2020  ondition.       
-0000dbe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dbf0: 2020 2069 6620 4e6f 6e65 2075 7365 730a     if None uses.
-0000dc00: 2020 2020 2020 2020 3a70 6172 616d 2063          :param c
-0000dc10: 6f6e 6469 7469 6f6e 3a20 7374 796c 6520  ondition: style 
-0000dc20: 636f 6e64 6974 696f 6e20 7072 696d 6974  condition primit
-0000dc30: 6976 6520 6174 2070 7265 7365 6e74 0a20  ive at present. 
-0000dc40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dc50: 2020 2020 2020 2020 2028 7661 7269 6162           (variab
-0000dc60: 6c65 2c20 6f72 2076 6172 6961 626c 6520  le, or variable 
-0000dc70: 206f 7065 7261 746f 7220 7661 6c75 6520   operator value 
-0000dc80: 2865 7661 6c20 6973 2065 7669 6c29 0a20  (eval is evil). 
-0000dc90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dca0: 2020 2020 2020 2020 2065 7861 6d70 6c65           example
-0000dcb0: 2022 5f66 6f6e 742d 7369 7a65 203e 2033   "_font-size > 3
-0000dcc0: 3022 206f 7220 225f 706f 7369 7469 6f6e  0" or "_position
-0000dcd0: 2220 286d 6561 6e73 2068 6173 2070 6f73  " (means has pos
-0000dce0: 6974 696f 6e29 0a20 2020 2020 2020 203a  ition).        :
-0000dcf0: 7061 7261 6d20 7265 6d6f 7665 3a20 7265  param remove: re
-0000dd00: 6d6f 7665 2074 6865 7365 2065 6c65 6d65  move these eleme
-0000dd10: 6e74 7320 286e 6f74 2074 6865 6972 2074  nts (not their t
-0000dd20: 6169 6c29 0a20 2020 2020 2020 2022 2222  ail).        """
-0000dd30: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0000dd40: 2020 2020 204d 6179 6265 206d 6f76 6520       Maybe move 
-0000dd50: 746f 2048 544d 4c54 6964 790a 2020 2020  to HTMLTidy.    
-0000dd60: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0000dd70: 6173 7365 7274 2065 6c65 6d20 6973 206e  assert elem is n
-0000dd80: 6f74 204e 6f6e 652c 2066 226d 7573 7420  ot None, f"must 
-0000dd90: 6861 7665 2065 6c65 6d22 0a20 2020 2020  have elem".     
-0000dda0: 2020 2069 6620 7870 6174 683a 0a20 2020     if xpath:.   
-0000ddb0: 2020 2020 2020 2020 2065 6c73 203d 2065           els = e
-0000ddc0: 6c65 6d2e 7870 6174 6828 7870 6174 6829  lem.xpath(xpath)
-0000ddd0: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-0000dde0: 2020 2020 2020 2020 2020 2065 6c73 203d             els =
-0000ddf0: 205b 656c 656d 5d0a 2020 2020 2020 2020   [elem].        
-0000de00: 656c 656d 7320 3d20 5b5d 0a20 2020 2020  elems = [].     
-0000de10: 2020 2066 6f72 2065 6c20 696e 2065 6c73     for el in els
-0000de20: 3a0a 2020 2020 2020 2020 2020 2020 6373  :.            cs
-0000de30: 735f 7374 796c 6520 3d20 4353 5353 7479  s_style = CSSSty
-0000de40: 6c65 2e63 7265 6174 655f 6373 735f 7374  le.create_css_st
-0000de50: 796c 655f 6672 6f6d 5f61 7474 7269 6275  yle_from_attribu
-0000de60: 7465 5f6f 665f 626f 6479 5f65 6c65 6d65  te_of_body_eleme
-0000de70: 6e74 2865 6c29 0a20 2020 2020 2020 2020  nt(el).         
-0000de80: 2020 2069 6620 636f 6e64 6974 696f 6e3a     if condition:
-0000de90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000dea0: 2069 6620 6373 735f 7374 796c 652e 6f62   if css_style.ob
-0000deb0: 6579 7328 636f 6e64 6974 696f 6e29 3a0a  eys(condition):.
+0000b140: 2020 2020 2020 2020 2020 2020 7265 6375              recu
+0000b150: 7273 653d 7265 6375 7273 652c 2069 645f  rse=recurse, id_
+0000b160: 726f 6f74 3d69 645f 726f 6f74 2c0a 2020  root=id_root,.  
+0000b170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b1a0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000b1b0: 645f 636f 756e 7465 723d 6964 5f63 6f75  d_counter=id_cou
+0000b1c0: 6e74 6572 290a 2020 2020 2020 2020 7265  nter).        re
+0000b1d0: 7475 726e 206e 6577 5f65 6c65 6d73 2c20  turn new_elems, 
+0000b1e0: 6964 5f63 6f75 6e74 6572 0a0a 2020 2020  id_counter..    
+0000b1f0: 4063 6c61 7373 6d65 7468 6f64 0a20 2020  @classmethod.   
+0000b200: 2064 6566 2061 6464 5f69 645f 696e 6372   def add_id_incr
+0000b210: 656d 656e 745f 636f 756e 7465 7228 636c  ement_counter(cl
+0000b220: 732c 2069 645f 636f 756e 7465 722c 2069  s, id_counter, i
+0000b230: 645f 726f 6f74 2c20 6874 6d6c 5f65 6c65  d_root, html_ele
+0000b240: 6d29 3a0a 2020 2020 2020 2020 6966 2069  m):.        if i
+0000b250: 645f 726f 6f74 3a0a 2020 2020 2020 2020  d_root:.        
+0000b260: 2020 2020 6874 6d6c 5f65 6c65 6d2e 6174      html_elem.at
+0000b270: 7472 6962 5b41 5f49 445d 203d 2069 645f  trib[A_ID] = id_
+0000b280: 726f 6f74 202b 2073 7472 2869 645f 636f  root + str(id_co
+0000b290: 756e 7465 7229 0a20 2020 2020 2020 2020  unter).         
+0000b2a0: 2020 2069 645f 636f 756e 7465 7220 2b3d     id_counter +=
+0000b2b0: 2031 0a20 2020 2020 2020 2072 6574 7572   1.        retur
+0000b2c0: 6e20 6964 5f63 6f75 6e74 6572 0a0a 2020  n id_counter..  
+0000b2d0: 2020 4063 6c61 7373 6d65 7468 6f64 0a20    @classmethod. 
+0000b2e0: 2020 2064 6566 2061 6464 5f73 6962 6c69     def add_sibli
+0000b2f0: 6e67 5f61 6674 6572 2863 6c73 2c20 616e  ng_after(cls, an
+0000b300: 6368 6f72 5f65 6c65 6d2c 2074 6167 2c20  chor_elem, tag, 
+0000b310: 7265 706c 6163 653d 4661 6c73 652c 2063  replace=False, c
+0000b320: 6f70 795f 6174 7473 3d46 616c 7365 2c20  opy_atts=False, 
+0000b330: 7465 7874 3d4e 6f6e 6529 3a0a 2020 2020  text=None):.    
+0000b340: 2020 2020 2222 2261 6464 7320 6e65 7720      """adds new 
+0000b350: 7472 6169 6c69 6e67 2073 6962 6c69 6e67  trailing sibling
+0000b360: 206f 6620 616e 6368 6f72 5f65 6c65 6d20   of anchor_elem 
+0000b370: 7769 7468 2074 6167 0a20 2020 2020 2020  with tag.       
+0000b380: 203a 7061 7261 6d20 7461 673a 2074 6167   :param tag: tag
+0000b390: 2066 6f72 206e 6577 2065 6c65 6d65 6e74   for new element
+0000b3a0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+0000b3b0: 616e 6368 6f72 5f65 6c65 6d3a 2072 6566  anchor_elem: ref
+0000b3c0: 6572 656e 6365 2065 6c65 6d65 6e74 2c20  erence element, 
+0000b3d0: 6d75 7374 2068 6176 6520 6120 7061 7265  must have a pare
+0000b3e0: 6e74 0a20 2020 2020 2020 203a 7061 7261  nt.        :para
+0000b3f0: 6d20 7265 706c 6163 653a 2069 6620 5472  m replace: if Tr
+0000b400: 7565 2c20 7265 6d6f 7665 2061 6e63 686f  ue, remove ancho
+0000b410: 7220 656c 656d 656e 740a 2020 2020 2020  r element.      
+0000b420: 2020 3a70 6172 616d 2063 6f70 795f 6174    :param copy_at
+0000b430: 7473 3a20 636f 7079 2061 7474 7269 6275  ts: copy attribu
+0000b440: 7465 7320 6672 6f6d 2061 6e63 686f 720a  tes from anchor.
+0000b450: 2020 2020 2020 2020 3a70 6172 616d 2074          :param t
+0000b460: 6578 743a 2069 6620 6e6f 7420 4e6f 6e65  ext: if not None
+0000b470: 2061 6464 2074 6578 7420 746f 206e 6577   add text to new
+0000b480: 2065 6c65 6d65 6e74 0a20 2020 2020 2020   element.       
+0000b490: 203a 7265 7475 726e 3a20 6e65 7720 7369   :return: new si
+0000b4a0: 626c 696e 6720 7769 7468 206f 7074 696f  bling with optio
+0000b4b0: 6e61 6c20 6179 7974 7269 6275 7465 7320  nal ayytributes 
+0000b4c0: 616e 6420 7465 7874 0a0a 0a0a 2020 2020  and text....    
+0000b4d0: 2020 2020 2222 220a 0a20 2020 2020 2020      """..       
+0000b4e0: 2061 7373 6572 7420 616e 6368 6f72 5f65   assert anchor_e
+0000b4f0: 6c65 6d20 6973 206e 6f74 204e 6f6e 650a  lem is not None.
+0000b500: 2020 2020 2020 2020 6173 7365 7274 2074          assert t
+0000b510: 6167 0a20 2020 2020 2020 2070 6172 656e  ag.        paren
+0000b520: 7420 3d20 616e 6368 6f72 5f65 6c65 6d2e  t = anchor_elem.
+0000b530: 6765 7470 6172 656e 7428 290a 2020 2020  getparent().    
+0000b540: 2020 2020 6173 7365 7274 2070 6172 656e      assert paren
+0000b550: 7420 6973 206e 6f74 204e 6f6e 652c 2066  t is not None, f
+0000b560: 224e 6f20 7061 7265 6e74 2066 6f72 2061  "No parent for a
+0000b570: 6e63 686f 725f 656c 656d 220a 2020 2020  nchor_elem".    
+0000b580: 2020 2020 7369 626c 696e 6720 3d20 4554      sibling = ET
+0000b590: 2e53 7562 456c 656d 656e 7428 7061 7265  .SubElement(pare
+0000b5a0: 6e74 2c20 7461 6729 0a20 2020 2020 2020  nt, tag).       
+0000b5b0: 2069 6620 636f 7079 5f61 7474 733a 0a20   if copy_atts:. 
+0000b5c0: 2020 2020 2020 2020 2020 2066 6f72 206b             for k
+0000b5d0: 2c20 7620 696e 2061 6e63 686f 725f 656c  , v in anchor_el
+0000b5e0: 656d 2e61 7474 7269 622e 6974 656d 7328  em.attrib.items(
+0000b5f0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0000b600: 2020 2073 6962 6c69 6e67 2e61 7474 7269     sibling.attri
+0000b610: 625b 6b5d 203d 2076 0a20 2020 2020 2020  b[k] = v.       
+0000b620: 2061 6e63 686f 725f 656c 656d 2e61 6464   anchor_elem.add
+0000b630: 6e65 7874 2873 6962 6c69 6e67 290a 2020  next(sibling).  
+0000b640: 2020 2020 2020 6966 2074 6578 743a 0a20        if text:. 
+0000b650: 2020 2020 2020 2020 2020 2073 6962 6c69             sibli
+0000b660: 6e67 2e74 6578 7420 3d20 7465 7874 0a20  ng.text = text. 
+0000b670: 2020 2020 2020 2069 6620 7265 706c 6163         if replac
+0000b680: 653a 0a20 2020 2020 2020 2020 2020 2070  e:.            p
+0000b690: 6172 656e 742e 7265 6d6f 7665 2861 6e63  arent.remove(anc
+0000b6a0: 686f 725f 656c 656d 290a 2020 2020 2020  hor_elem).      
+0000b6b0: 2020 7265 7475 726e 2073 6962 6c69 6e67    return sibling
+0000b6c0: 0a0a 2020 2020 4063 6c61 7373 6d65 7468  ..    @classmeth
+0000b6d0: 6f64 0a20 2020 2064 6566 2063 7265 6174  od.    def creat
+0000b6e0: 655f 6469 765f 7370 616e 2863 6c73 2c20  e_div_span(cls, 
+0000b6f0: 7465 7874 2c20 7374 796c 653d 4e6f 6e65  text, style=None
+0000b700: 293a 0a20 2020 2020 2020 2022 2222 7574  ):.        """ut
+0000b710: 696c 6974 7920 6d65 7468 6f64 2074 6f20  ility method to 
+0000b720: 6372 6561 7465 2061 2064 6976 2f73 7061  create a div/spa
+0000b730: 6e40 7465 7874 2028 7072 6f62 6162 6c79  n@text (probably
+0000b740: 206d 6169 6e6c 7920 666f 7220 7465 7374   mainly for test
+0000b750: 696e 6729 0a20 2020 2020 2020 203a 7061  ing).        :pa
+0000b760: 7261 6d20 7465 7874 3a20 746f 2061 6464  ram text: to add
+0000b770: 0a20 2020 2020 2020 203a 7265 7475 726e  .        :return
+0000b780: 3a20 7468 6520 6469 7622 2222 0a20 2020  : the div""".   
+0000b790: 2020 2020 2064 6976 203d 2045 542e 456c       div = ET.El
+0000b7a0: 656d 656e 7428 485f 4449 5629 0a20 2020  ement(H_DIV).   
+0000b7b0: 2020 2020 2073 7061 6e20 3d20 4554 2e53       span = ET.S
+0000b7c0: 7562 456c 656d 656e 7428 6469 762c 2048  ubElement(div, H
+0000b7d0: 5f53 5041 4e29 0a20 2020 2020 2020 2069  _SPAN).        i
+0000b7e0: 6620 7374 796c 653a 0a20 2020 2020 2020  f style:.       
+0000b7f0: 2020 2020 2063 7373 5f73 7479 6c65 203d       css_style =
+0000b800: 2043 5353 5374 796c 652e 6372 6561 7465   CSSStyle.create
+0000b810: 5f63 7373 5f73 7479 6c65 5f66 726f 6d5f  _css_style_from_
+0000b820: 6373 735f 7374 7269 6e67 2822 666f 6e74  css_string("font
+0000b830: 2d73 697a 653a 3132 3b20 666f 6e74 2d77  -size:12; font-w
+0000b840: 6569 6768 743a 2062 6f6c 643b 2229 0a20  eight: bold;"). 
+0000b850: 2020 2020 2020 2020 2020 2048 746d 6c53             HtmlS
+0000b860: 7479 6c65 2e73 6574 5f73 7479 6c65 2873  tyle.set_style(s
+0000b870: 7061 6e2c 2063 7373 5f73 7479 6c65 2e67  pan, css_style.g
+0000b880: 6574 5f63 7373 5f76 616c 7565 2829 290a  et_css_value()).
+0000b890: 2020 2020 2020 2020 7370 616e 2e74 6578          span.tex
+0000b8a0: 7420 3d20 7465 7874 0a20 2020 2020 2020  t = text.       
+0000b8b0: 2072 6574 7572 6e20 6469 762c 2073 7061   return div, spa
+0000b8c0: 6e0a 0a20 2020 2040 636c 6173 736d 6574  n..    @classmet
+0000b8d0: 686f 640a 2020 2020 6465 6620 6973 5f73  hod.    def is_s
+0000b8e0: 7562 7363 7269 7074 2863 6c73 2c20 6c61  ubscript(cls, la
+0000b8f0: 7374 5f73 7061 6e2c 2074 6869 735f 7370  st_span, this_sp
+0000b900: 616e 2920 2d3e 2062 6f6f 6c3a 0a20 2020  an) -> bool:.   
+0000b910: 2020 2020 2022 2222 6973 2074 6869 735f       """is this_
+0000b920: 7370 616e 2061 2073 7562 7363 7269 7074  span a subscript
+0000b930: 3f0a 2020 2020 2020 2020 7573 6573 2068  ?.        uses h
+0000b940: 6575 7269 7374 6963 7320 696e 2069 735f  euristics in is_
+0000b950: 7363 7269 7074 5f74 7970 650a 2020 2020  script_type.    
+0000b960: 2020 2020 3a70 6172 616d 206c 6173 745f      :param last_
+0000b970: 7370 616e 3a20 7072 6563 6564 696e 6720  span: preceding 
+0000b980: 7370 616e 2028 6966 204e 6f6e 6520 7265  span (if None re
+0000b990: 7475 726e 7320 4661 6c73 6529 0a20 2020  turns False).   
+0000b9a0: 2020 2020 203a 7061 7261 6d20 7468 6973       :param this
+0000b9b0: 5f73 7061 6e3a 2073 7061 6e20 746f 2074  _span: span to t
+0000b9c0: 6573 740a 2020 2020 2020 2020 3a72 6574  est.        :ret
+0000b9d0: 7572 6e3a 2054 7275 6520 6966 2074 6869  urn: True if thi
+0000b9e0: 7320 7370 616e 2069 7320 736d 616c 6c65  s span is smalle
+0000b9f0: 7220 616e 6420 226c 6f77 6572 2220 7468  r and "lower" th
+0000ba00: 616e 206c 6173 7422 2222 0a20 2020 2020  an last""".     
+0000ba10: 2020 2072 6574 7572 6e20 636c 732e 6973     return cls.is
+0000ba20: 5f73 6372 6970 745f 7479 7065 286c 6173  _script_type(las
+0000ba30: 745f 7370 616e 2c20 7468 6973 5f73 7061  t_span, this_spa
+0000ba40: 6e2c 2073 6372 6970 745f 7479 7065 3d53  n, script_type=S
+0000ba50: 5363 7269 7074 2e53 5542 290a 0a20 2020  Script.SUB)..   
+0000ba60: 2040 636c 6173 736d 6574 686f 640a 2020   @classmethod.  
+0000ba70: 2020 6465 6620 6973 5f73 7570 6572 7363    def is_supersc
+0000ba80: 7269 7074 2863 6c73 2c20 6c61 7374 5f73  ript(cls, last_s
+0000ba90: 7061 6e2c 2074 6869 735f 7370 616e 2920  pan, this_span) 
+0000baa0: 2d3e 2062 6f6f 6c3a 0a20 2020 2020 2020  -> bool:.       
+0000bab0: 2022 2222 6973 2074 6869 735f 7370 616e   """is this_span
+0000bac0: 2061 2073 7570 6572 7363 7269 7074 3f0a   a superscript?.
+0000bad0: 2020 2020 2020 2020 7573 6573 2068 6575          uses heu
+0000bae0: 7269 7374 6963 7320 696e 2069 735f 7363  ristics in is_sc
+0000baf0: 7269 7074 5f74 7970 650a 2020 2020 2020  ript_type.      
+0000bb00: 2020 3a70 6172 616d 206c 6173 745f 7370    :param last_sp
+0000bb10: 616e 3a20 7072 6563 6564 696e 6720 7370  an: preceding sp
+0000bb20: 616e 2028 6966 204e 6f6e 6520 7265 7475  an (if None retu
+0000bb30: 726e 7320 4661 6c73 6529 0a20 2020 2020  rns False).     
+0000bb40: 2020 203a 7061 7261 6d20 7468 6973 5f73     :param this_s
+0000bb50: 7061 6e3a 2073 7061 6e20 746f 2074 6573  pan: span to tes
+0000bb60: 740a 2020 2020 2020 2020 3a72 6574 7572  t.        :retur
+0000bb70: 6e3a 2054 7275 6520 6966 2074 6869 7320  n: True if this 
+0000bb80: 7370 616e 2069 7320 736d 616c 6c65 7220  span is smaller 
+0000bb90: 616e 6420 2268 6967 6865 7222 2074 6861  and "higher" tha
+0000bba0: 6e20 6c61 7374 2222 220a 2020 2020 2020  n last""".      
+0000bbb0: 2020 7265 7475 726e 2063 6c73 2e69 735f    return cls.is_
+0000bbc0: 7363 7269 7074 5f74 7970 6528 6c61 7374  script_type(last
+0000bbd0: 5f73 7061 6e2c 2074 6869 735f 7370 616e  _span, this_span
+0000bbe0: 2c20 7363 7269 7074 5f74 7970 653d 5353  , script_type=SS
+0000bbf0: 6372 6970 742e 5355 5029 0a0a 2020 2020  cript.SUP)..    
+0000bc00: 4063 6c61 7373 6d65 7468 6f64 0a20 2020  @classmethod.   
+0000bc10: 2064 6566 2069 735f 7363 7269 7074 5f74   def is_script_t
+0000bc20: 7970 6528 636c 732c 206c 6173 745f 7370  ype(cls, last_sp
+0000bc30: 616e 2c20 7468 6973 5f73 7061 6e2c 2073  an, this_span, s
+0000bc40: 6372 6970 745f 7479 7065 2c20 7964 6f77  cript_type, ydow
+0000bc50: 6e3d 5472 7565 2c20 7072 6563 6564 696e  n=True, precedin
+0000bc60: 673d 4e6f 6e65 2920 2d3e 2062 6f6f 6c3a  g=None) -> bool:
+0000bc70: 0a20 2020 2020 2020 2022 2222 6865 7572  .        """heur
+0000bc80: 6973 7463 2074 6f20 6465 7465 726d 696e  istc to determin
+0000bc90: 6520 7768 6574 6865 7220 7468 6973 5f73  e whether this_s
+0000bca0: 7061 6e20 6973 2061 2073 7562 2f73 7570  pan is a sub/sup
+0000bcb0: 6572 7363 7269 7074 206f 6620 6c61 7374  erscript of last
+0000bcc0: 5f73 7061 6e0a 2020 2020 2020 2020 4e4f  _span.        NO
+0000bcd0: 5445 3a20 4946 2059 2069 7320 444f 574e  TE: IF Y is DOWN
+0000bce0: 2074 6865 2070 6167 652c 2061 2073 7570   the page, a sup
+0000bcf0: 6572 7363 7269 7074 2068 6173 2053 4d41  erscript has SMA
+0000bd00: 4c4c 4552 2079 2d76 616c 7565 2c20 6574  LLER y-value, et
+0000bd10: 632e 2028 6c6f 6769 6320 7265 7665 7273  c. (logic revers
+0000bd20: 6564 2069 6620 6e6f 7420 7964 6f77 6e29  ed if not ydown)
+0000bd30: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+0000bd40: 6c61 7374 5f73 7061 6e3a 2069 6620 4e6f  last_span: if No
+0000bd50: 6e65 2c20 7265 7475 726e 7320 6661 6c73  ne, returns fals
+0000bd60: 650a 2020 2020 2020 2020 3a70 6172 616d  e.        :param
+0000bd70: 2074 6869 735f 7370 616e 3a20 6966 206e   this_span: if n
+0000bd80: 6f74 2073 6d61 6c6c 6572 2062 7920 5343  ot smaller by SC
+0000bd90: 5249 5054 5f46 4143 5420 7265 7475 726e  RIPT_FACT return
+0000bda0: 2046 616c 7365 0a20 2020 2020 2020 203a   False.        :
+0000bdb0: 7061 7261 6d20 7363 7269 7074 5f74 7970  param script_typ
+0000bdc0: 653a 2053 5363 7269 7074 2e53 5542 206f  e: SScript.SUB o
+0000bdd0: 7220 5353 6372 6970 742e 5355 500a 2020  r SScript.SUP.  
+0000bde0: 2020 2020 2020 3a70 6172 616d 2079 646f        :param ydo
+0000bdf0: 776e 3a20 5472 7565 2069 6620 7920 696e  wn: True if y in
+0000be00: 6372 6561 7365 7320 646f 776e 2074 6872  creases down thr
+0000be10: 2070 6167 6520 2865 2e67 2e20 5356 4729   page (e.g. SVG)
+0000be20: 2028 4445 4641 554c 5429 2065 6c73 6520   (DEFAULT) else 
+0000be30: 4661 6c73 650a 2020 2020 2020 2020 3a72  False.        :r
+0000be40: 6574 7572 6e3a 2054 7275 6520 6966 2073  eturn: True if s
+0000be50: 6d61 6c6c 6572 2061 6e64 206d 6f76 6564  maller and moved
+0000be60: 2069 6e20 7269 6768 7420 792d 6469 7265   in right y-dire
+0000be70: 6374 696f 6e0a 2020 2020 2020 2020 2222  ction.        ""
+0000be80: 220a 2020 2020 2020 2020 6966 2074 6869  ".        if thi
+0000be90: 735f 7370 616e 2069 7320 4e6f 6e65 3a0a  s_span is None:.
+0000bea0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0000beb0: 726e 2046 616c 7365 0a20 2020 2020 2020  rn False.       
+0000bec0: 2023 2074 7279 2074 6f20 6669 6e64 206d   # try to find m
+0000bed0: 6973 7369 6e67 206c 6173 745f 7370 616e  issing last_span
+0000bee0: 0a20 2020 2020 2020 2069 6620 6c61 7374  .        if last
+0000bef0: 5f73 7061 6e20 6973 204e 6f6e 653a 0a20  _span is None:. 
+0000bf00: 2020 2020 2020 2020 2020 206c 6173 745f             last_
+0000bf10: 7370 616e 203d 2074 6869 735f 7370 616e  span = this_span
+0000bf20: 2e78 7061 7468 2866 227b 585f 5052 4543  .xpath(f"{X_PREC
+0000bf30: 4544 494e 477d 3a3a 7b48 5f53 5041 4e7d  EDING}::{H_SPAN}
+0000bf40: 2229 0a20 2020 2020 2020 2020 2020 2069  ").            i
+0000bf50: 6620 6c65 6e28 6c61 7374 5f73 7061 6e29  f len(last_span)
+0000bf60: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
+0000bf70: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
+0000bf80: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
+0000bf90: 6c61 7374 5f73 7061 6e20 3d20 6c61 7374  last_span = last
+0000bfa0: 5f73 7061 6e5b 305d 0a20 2020 2020 2020  _span[0].       
+0000bfb0: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
+0000bfc0: 2020 6c61 7374 5f66 6f6e 745f 7369 7a65    last_font_size
+0000bfd0: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
+0000bfe0: 2020 2020 7468 6973 5f66 6f6e 745f 7369      this_font_si
+0000bff0: 7a65 203d 204e 6f6e 650a 2020 2020 2020  ze = None.      
+0000c000: 2020 2020 2020 6c61 7374 5f66 6f6e 745f        last_font_
+0000c010: 7369 7a65 203d 206c 6173 745f 7370 616e  size = last_span
+0000c020: 2e74 6578 745f 7374 796c 652e 5f66 6f6e  .text_style._fon
+0000c030: 745f 7369 7a65 0a20 2020 2020 2020 2020  t_size.         
+0000c040: 2020 2074 6869 735f 666f 6e74 5f73 697a     this_font_siz
+0000c050: 6520 3d20 7468 6973 5f73 7061 6e2e 7465  e = this_span.te
+0000c060: 7874 5f73 7479 6c65 2e5f 666f 6e74 5f73  xt_style._font_s
+0000c070: 697a 650a 2020 2020 2020 2020 6578 6365  ize.        exce
+0000c080: 7074 2045 7863 6570 7469 6f6e 2061 7320  pt Exception as 
+0000c090: 653a 0a20 2020 2020 2020 2020 2020 2070  e:.            p
+0000c0a0: 6173 730a 2020 2020 2020 2020 2020 2020  ass.            
+0000c0b0: 2320 6e6f 2066 6f6e 7420 7374 796c 650a  # no font style.
+0000c0c0: 2020 2020 2020 2020 6973 5f73 6372 6970          is_scrip
+0000c0d0: 7420 3d20 636c 732e 6973 5f72 6571 7569  t = cls.is_requi
+0000c0e0: 7265 645f 7363 7269 7074 5f74 7970 6528  red_script_type(
+0000c0f0: 7363 7269 7074 5f74 7970 652c 206c 6173  script_type, las
+0000c100: 745f 666f 6e74 5f73 697a 652c 206c 6173  t_font_size, las
+0000c110: 745f 7370 616e 2c20 7468 6973 5f66 6f6e  t_span, this_fon
+0000c120: 745f 7369 7a65 2c20 7468 6973 5f73 7061  t_size, this_spa
+0000c130: 6e2c 0a20 2020 2020 2020 2020 2020 2020  n,.             
+0000c140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c160: 2020 2079 646f 776e 290a 2020 2020 2020     ydown).      
+0000c170: 2020 7265 7475 726e 2069 735f 7363 7269    return is_scri
+0000c180: 7074 0a0a 2020 2020 4063 6c61 7373 6d65  pt..    @classme
+0000c190: 7468 6f64 0a20 2020 2064 6566 2069 735f  thod.    def is_
+0000c1a0: 7265 7175 6972 6564 5f73 6372 6970 745f  required_script_
+0000c1b0: 7479 7065 2863 6c73 2c20 7363 7269 7074  type(cls, script
+0000c1c0: 5f74 7970 652c 206c 6173 745f 666f 6e74  _type, last_font
+0000c1d0: 5f73 697a 652c 206c 6173 745f 7370 616e  _size, last_span
+0000c1e0: 2c20 7468 6973 5f66 6f6e 745f 7369 7a65  , this_font_size
+0000c1f0: 2c20 7468 6973 5f73 7061 6e2c 2079 646f  , this_span, ydo
+0000c200: 776e 3d54 7275 652c 2029 3a0a 2020 2020  wn=True, ):.    
+0000c210: 2020 2020 2222 226f 6c64 2061 7070 726f      """old appro
+0000c220: 6163 6820 7769 7468 2041 6d69 5370 616e  ach with AmiSpan
+0000c230: 0a20 2020 2020 2020 2054 6869 7320 6973  .        This is
+0000c240: 206e 6f74 2072 6967 6874 2122 2222 0a20   not right!""". 
+0000c250: 2020 2020 2020 2059 4641 4354 4f52 203d         YFACTOR =
+0000c260: 2033 2020 2320 7069 7865 6c73 0a20 2020   3  # pixels.   
+0000c270: 2020 2020 2069 735f 7363 7269 7074 203d       is_script =
+0000c280: 2046 616c 7365 0a20 2020 2020 2020 2073   False.        s
+0000c290: 6372 6970 745f 6661 6374 6f72 203d 2048  cript_factor = H
+0000c2a0: 746d 6c55 7469 6c2e 5343 5249 5054 5f46  tmlUtil.SCRIPT_F
+0000c2b0: 4143 540a 2020 2020 2020 2020 2320 6966  ACT.        # if
+0000c2c0: 2066 6f6e 7420 7369 7a65 7320 6e6f 7420   font sizes not 
+0000c2d0: 6769 7665 6e20 6173 7375 6d65 2074 6865  given assume the
+0000c2e0: 7920 646f 6e27 7420 6d61 7474 6572 0a20  y don't matter. 
+0000c2f0: 2020 2020 2020 2069 6620 6c61 7374 5f66         if last_f
+0000c300: 6f6e 745f 7369 7a65 2061 6e64 2074 6869  ont_size and thi
+0000c310: 735f 666f 6e74 5f73 697a 653a 0a20 2020  s_font_size:.   
+0000c320: 2020 2020 2020 2020 2070 6173 7365 645f           passed_
+0000c330: 666f 6e74 5f73 697a 655f 6368 616e 6765  font_size_change
+0000c340: 203d 2074 6869 735f 666f 6e74 5f73 697a   = this_font_siz
+0000c350: 6520 3c20 7363 7269 7074 5f66 6163 746f  e < script_facto
+0000c360: 7220 2a20 6c61 7374 5f66 6f6e 745f 7369  r * last_font_si
+0000c370: 7a65 0a20 2020 2020 2020 2065 6c73 653a  ze.        else:
+0000c380: 0a20 2020 2020 2020 2020 2020 2070 6173  .            pas
+0000c390: 7365 645f 666f 6e74 5f73 697a 655f 6368  sed_font_size_ch
+0000c3a0: 616e 6765 203d 2054 7275 650a 2020 2020  ange = True.    
+0000c3b0: 2020 2020 2320 7573 6520 7920 636f 6f72      # use y coor
+0000c3c0: 6473 0a20 2020 2020 2020 2069 6620 7061  ds.        if pa
+0000c3d0: 7373 6564 5f66 6f6e 745f 7369 7a65 5f63  ssed_font_size_c
+0000c3e0: 6861 6e67 653a 0a20 2020 2020 2020 2020  hange:.         
+0000c3f0: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+0000c400: 2020 2020 2020 2020 6c61 7374 5f79 203d          last_y =
+0000c410: 206c 6173 745f 7370 616e 2e79 0a20 2020   last_span.y.   
+0000c420: 2020 2020 2020 2020 2020 2020 2074 6869               thi
+0000c430: 735f 7920 3d20 7468 6973 5f73 7061 6e2e  s_y = this_span.
+0000c440: 790a 2020 2020 2020 2020 2020 2020 6578  y.            ex
+0000c450: 6365 7074 2045 7863 6570 7469 6f6e 2061  cept Exception a
+0000c460: 7320 653a 0a20 2020 2020 2020 2020 2020  s e:.           
+0000c470: 2020 2020 206c 6173 745f 7920 3d20 4874       last_y = Ht
+0000c480: 6d6c 5574 696c 2e67 6574 5f66 6c6f 6174  mlUtil.get_float
+0000c490: 286c 6173 745f 7370 616e 2c20 2279 3022  (last_span, "y0"
+0000c4a0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000c4b0: 2020 7468 6973 5f79 203d 2048 746d 6c55    this_y = HtmlU
+0000c4c0: 7469 6c2e 6765 745f 666c 6f61 7428 7468  til.get_float(th
+0000c4d0: 6973 5f73 7061 6e2c 2022 7930 2229 0a20  is_span, "y0"). 
+0000c4e0: 2020 2020 2020 2020 2020 2074 7279 3a0a             try:.
+0000c4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c500: 6c61 7374 5f78 203d 206c 6173 745f 7370  last_x = last_sp
+0000c510: 616e 2e78 0a20 2020 2020 2020 2020 2020  an.x.           
+0000c520: 2020 2020 2074 6869 735f 7820 3d20 7468       this_x = th
+0000c530: 6973 5f73 7061 6e2e 780a 2020 2020 2020  is_span.x.      
+0000c540: 2020 2020 2020 6578 6365 7074 2045 7863        except Exc
+0000c550: 6570 7469 6f6e 2061 7320 653a 0a20 2020  eption as e:.   
+0000c560: 2020 2020 2020 2020 2020 2020 206c 6173               las
+0000c570: 745f 7820 3d20 4874 6d6c 5574 696c 2e67  t_x = HtmlUtil.g
+0000c580: 6574 5f66 6c6f 6174 286c 6173 745f 7370  et_float(last_sp
+0000c590: 616e 2c20 2278 3022 290a 2020 2020 2020  an, "x0").      
+0000c5a0: 2020 2020 2020 2020 2020 7468 6973 5f78            this_x
+0000c5b0: 203d 2048 746d 6c55 7469 6c2e 6765 745f   = HtmlUtil.get_
+0000c5c0: 666c 6f61 7428 7468 6973 5f73 7061 6e2c  float(this_span,
+0000c5d0: 2022 7830 2229 0a20 2020 2020 2020 2020   "x0").         
+0000c5e0: 2020 2069 6620 7363 7269 7074 5f74 7970     if script_typ
+0000c5f0: 6520 3d3d 2053 5363 7269 7074 2e53 5542  e == SScript.SUB
+0000c600: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000c610: 2020 2320 6973 2069 7420 6c6f 7765 7265    # is it lowere
+0000c620: 643f 2059 2044 4f57 4e0a 2020 2020 2020  d? Y DOWN.      
+0000c630: 2020 2020 2020 2020 2020 6973 5f73 6372            is_scr
+0000c640: 6970 7420 3d20 7964 6f77 6e20 616e 6420  ipt = ydown and 
+0000c650: 286c 6173 745f 7920 3c20 7468 6973 5f79  (last_y < this_y
+0000c660: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
+0000c670: 6966 2073 6372 6970 745f 7479 7065 203d  if script_type =
+0000c680: 3d20 5353 6372 6970 742e 5355 503a 0a20  = SScript.SUP:. 
+0000c690: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0000c6a0: 2069 7320 6974 2072 6169 7365 643f 2059   is it raised? Y
+0000c6b0: 2044 4f57 4e0a 2020 2020 2020 2020 2020   DOWN.          
+0000c6c0: 2020 2020 2020 6973 5f73 6372 6970 7420        is_script 
+0000c6d0: 3d20 7964 6f77 6e20 616e 6420 286c 6173  = ydown and (las
+0000c6e0: 745f 7920 2d20 7468 6973 5f79 2920 3e20  t_y - this_y) > 
+0000c6f0: 5946 4143 544f 520a 2020 2020 2020 2020  YFACTOR.        
+0000c700: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0000c710: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+0000c720: 5661 6c75 6545 7272 6f72 2822 6261 6420  ValueError("bad 
+0000c730: 7363 7269 7074 2074 7970 6520 222c 2073  script type ", s
+0000c740: 6372 6970 745f 7479 7065 290a 2020 2020  cript_type).    
+0000c750: 2020 2020 2020 2020 6966 2046 616c 7365          if False
+0000c760: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000c770: 2020 6966 2069 735f 7363 7269 7074 2061    if is_script a
+0000c780: 6e64 206c 6173 745f 7820 616e 6420 7468  nd last_x and th
+0000c790: 6973 5f78 3a0a 2020 2020 2020 2020 2020  is_x:.          
+0000c7a0: 2020 2020 2020 2020 2020 6973 5f73 6372            is_scr
+0000c7b0: 6970 7420 3d20 6c61 7374 5f78 203c 2074  ipt = last_x < t
+0000c7c0: 6869 735f 780a 2020 2020 2020 2020 7265  his_x.        re
+0000c7d0: 7475 726e 2069 735f 7363 7269 7074 0a0a  turn is_script..
+0000c7e0: 2020 2020 4063 6c61 7373 6d65 7468 6f64      @classmethod
+0000c7f0: 0a20 2020 2064 6566 2065 7874 7261 6374  .    def extract
+0000c800: 5f66 6f6f 746e 6f74 6573 2863 6c73 2c20  _footnotes(cls, 
+0000c810: 6874 6d6c 5f65 6c65 6d2c 2066 6f6e 745f  html_elem, font_
+0000c820: 7369 7a65 5f63 6f6e 6469 7469 6f6e 2c20  size_condition, 
+0000c830: 7469 746c 653d 2246 6f6f 746e 6f74 6573  title="Footnotes
+0000c840: 2229 3a0a 2020 2020 2020 2020 6469 7673  "):.        divs
+0000c850: 203d 2068 746d 6c5f 656c 656d 2e78 7061   = html_elem.xpa
+0000c860: 7468 2866 222f 2f64 6976 5b73 7061 6e5b  th(f"//div[span[
+0000c870: 636f 6e74 6169 6e73 2840 7374 796c 652c  contains(@style,
+0000c880: 2027 7b66 6f6e 745f 7369 7a65 5f63 6f6e   '{font_size_con
+0000c890: 6469 7469 6f6e 7d27 2920 616e 6420 6e75  dition}') and nu
+0000c8a0: 6d62 6572 282e 293d 6e75 6d62 6572 282e  mber(.)=number(.
+0000c8b0: 295d 5d22 290a 2020 2020 2020 2020 666f  )]]").        fo
+0000c8c0: 6f74 6e6f 7465 5f64 6976 203d 2048 746d  otnote_div = Htm
+0000c8d0: 6c47 726f 7570 2e67 6574 5f62 6163 6b5f  lGroup.get_back_
+0000c8e0: 6469 7628 6874 6d6c 5f65 6c65 6d29 0a20  div(html_elem). 
+0000c8f0: 2020 2020 2020 2066 6f6f 746e 6f74 655f         footnote_
+0000c900: 7469 746c 6520 3d20 4554 2e53 7562 456c  title = ET.SubEl
+0000c910: 656d 656e 7428 666f 6f74 6e6f 7465 5f64  ement(footnote_d
+0000c920: 6976 2c20 2264 6976 2229 0a20 2020 2020  iv, "div").     
+0000c930: 2020 2066 6f6f 746e 6f74 655f 7469 746c     footnote_titl
+0000c940: 652e 7465 7874 203d 2074 6974 6c65 0a20  e.text = title. 
+0000c950: 2020 2020 2020 2075 6c20 3d20 4554 2e53         ul = ET.S
+0000c960: 7562 456c 656d 656e 7428 666f 6f74 6e6f  ubElement(footno
+0000c970: 7465 5f64 6976 2c20 2275 6c22 290a 2020  te_div, "ul").  
+0000c980: 2020 2020 2020 6375 7272 656e 745f 6c69        current_li
+0000c990: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
+0000c9a0: 666f 7220 6469 7620 696e 2064 6976 733a  for div in divs:
+0000c9b0: 0a20 2020 2020 2020 2020 2020 2073 7061  .            spa
+0000c9c0: 6e73 203d 2064 6976 2e78 7061 7468 2822  ns = div.xpath("
+0000c9d0: 2e2f 7370 616e 2229 0a20 2020 2020 2020  ./span").       
+0000c9e0: 2020 2020 2066 6f72 2069 2c20 7370 616e       for i, span
+0000c9f0: 2069 6e20 656e 756d 6572 6174 6528 7370   in enumerate(sp
+0000ca00: 616e 7329 3a0a 2020 2020 2020 2020 2020  ans):.          
+0000ca10: 2020 2020 2020 6966 2058 6d6c 4c69 622e        if XmlLib.
+0000ca20: 6973 5f69 6e74 6567 6572 2873 7061 6e29  is_integer(span)
+0000ca30: 2061 6e64 2028 6920 3d3d 2030 206f 7220   and (i == 0 or 
+0000ca40: 4874 6d6c 5574 696c 2e69 735f 7375 7065  HtmlUtil.is_supe
+0000ca50: 7273 6372 6970 7428 7370 616e 735b 6920  rscript(spans[i 
+0000ca60: 2d20 315d 2c20 7370 616e 2929 3a0a 2020  - 1], span)):.  
+0000ca70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ca80: 2020 6375 7272 656e 745f 6c69 203d 2045    current_li = E
+0000ca90: 542e 5375 6245 6c65 6d65 6e74 2875 6c2c  T.SubElement(ul,
+0000caa0: 2022 6c69 2229 0a20 2020 2020 2020 2020   "li").         
+0000cab0: 2020 2020 2020 2069 6620 6375 7272 656e         if curren
+0000cac0: 745f 6c69 2069 7320 6e6f 7420 4e6f 6e65  t_li is not None
+0000cad0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000cae0: 2020 2020 2020 6375 7272 656e 745f 6c69        current_li
+0000caf0: 2e61 7070 656e 6428 7370 616e 290a 0a20  .append(span).. 
+0000cb00: 2020 2040 636c 6173 736d 6574 686f 640a     @classmethod.
+0000cb10: 2020 2020 6465 6620 616e 6e6f 7461 7465      def annotate
+0000cb20: 5f73 6372 6970 745f 7479 7065 2863 6c73  _script_type(cls
+0000cb30: 2c20 7370 616e 2c20 7363 7269 7074 5f74  , span, script_t
+0000cb40: 7970 652c 2073 6372 6970 745f 6661 6374  ype, script_fact
+0000cb50: 6f72 3d4e 6f6e 652c 206c 6173 745f 7370  or=None, last_sp
+0000cb60: 616e 3d4e 6f6e 652c 2079 646f 776e 3d54  an=None, ydown=T
+0000cb70: 7275 6529 3a0a 2020 2020 2020 2020 2222  rue):.        ""
+0000cb80: 2269 7320 6120 7370 616e 2061 2073 7562  "is a span a sub
+0000cb90: 206f 7220 7375 7065 7273 6372 6970 743f   or superscript?
+0000cba0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+0000cbb0: 7370 616e 3a20 746f 2074 6573 740a 2020  span: to test.  
+0000cbc0: 2020 2020 2020 3a70 6172 616d 2073 6372        :param scr
+0000cbd0: 6970 745f 7479 7065 3a20 5353 6372 6970  ipt_type: SScrip
+0000cbe0: 742e 5355 4220 6f72 2053 5363 7269 7074  t.SUB or SScript
+0000cbf0: 2e53 5550 4552 0a20 2020 2020 2020 203a  .SUPER.        :
+0000cc00: 7061 7261 6d20 7363 7269 7074 5f66 6163  param script_fac
+0000cc10: 746f 723a 2069 6620 4e6f 6e65 2c20 6465  tor: if None, de
+0000cc20: 6661 756c 7473 2074 6f20 4874 6d6c 5574  faults to HtmlUt
+0000cc30: 696c 2e53 4352 4950 545f 4641 4354 0a20  il.SCRIPT_FACT. 
+0000cc40: 2020 2020 2020 203a 7061 7261 6d20 6c61         :param la
+0000cc50: 7374 5f73 7061 6e3a 2070 7265 6365 6469  st_span: precedi
+0000cc60: 6e67 2073 7061 6e3b 2069 6620 4e6f 6e65  ng span; if None
+0000cc70: 2074 7269 6573 2078 7061 7468 2822 7072   tries xpath("pr
+0000cc80: 6563 6564 696e 673a 3a73 7061 6e22 290a  eceding::span").
+0000cc90: 2020 2020 2020 2020 3a70 6172 616d 2079          :param y
+0000cca0: 646f 776e 3a20 6973 2079 2072 756e 6e69  down: is y runni
+0000ccb0: 6e67 2064 6f6e 7720 7468 6520 7061 6765  ng donw the page
+0000ccc0: 3f0a 2020 2020 2020 2020 2222 220a 2020  ?.        """.  
+0000ccd0: 2020 2020 2020 6966 2073 7061 6e20 6973        if span is
+0000cce0: 204e 6f6e 6520 6f72 206e 6f74 2073 6372   None or not scr
+0000ccf0: 6970 745f 7479 7065 3a0a 2020 2020 2020  ipt_type:.      
+0000cd00: 2020 2020 2020 7265 7475 726e 204e 6f6e        return Non
+0000cd10: 650a 2020 2020 2020 2020 6966 206e 6f74  e.        if not
+0000cd20: 2073 6372 6970 745f 6661 6374 6f72 3a0a   script_factor:.
+0000cd30: 2020 2020 2020 2020 2020 2020 7363 7269              scri
+0000cd40: 7074 5f66 6163 746f 7220 3d20 4874 6d6c  pt_factor = Html
+0000cd50: 5574 696c 2e53 4352 4950 545f 4641 4354  Util.SCRIPT_FACT
+0000cd60: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+0000cd70: 6c61 7374 5f73 7061 6e3a 0a20 2020 2020  last_span:.     
+0000cd80: 2020 2020 2020 206c 6173 745f 7370 616e         last_span
+0000cd90: 203d 2073 7061 6e2e 7870 6174 6828 2270   = span.xpath("p
+0000cda0: 7265 6365 6469 6e67 3a3a 7370 616e 2229  receding::span")
+0000cdb0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0000cdc0: 6c65 6e28 6c61 7374 5f73 7061 6e29 203d  len(last_span) =
+0000cdd0: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
+0000cde0: 2020 2020 2072 6574 7572 6e20 4e6f 6e65       return None
+0000cdf0: 0a20 2020 2020 2020 2020 2020 206c 6173  .            las
+0000ce00: 745f 7370 616e 203d 206c 6173 745f 7370  t_span = last_sp
+0000ce10: 616e 5b2d 315d 0a20 2020 2020 2020 2063  an[-1].        c
+0000ce20: 7373 7320 3d20 4353 5353 7479 6c65 2e63  sss = CSSStyle.c
+0000ce30: 7265 6174 655f 6373 735f 7374 796c 655f  reate_css_style_
+0000ce40: 6672 6f6d 5f61 7474 7269 6275 7465 5f6f  from_attribute_o
+0000ce50: 665f 626f 6479 5f65 6c65 6d65 6e74 2873  f_body_element(s
+0000ce60: 7061 6e29 0a20 2020 2020 2020 206c 6173  pan).        las
+0000ce70: 745f 6373 7373 203d 2043 5353 5374 796c  t_csss = CSSStyl
+0000ce80: 652e 6372 6561 7465 5f63 7373 5f73 7479  e.create_css_sty
+0000ce90: 6c65 5f66 726f 6d5f 6174 7472 6962 7574  le_from_attribut
+0000cea0: 655f 6f66 5f62 6f64 795f 656c 656d 656e  e_of_body_elemen
+0000ceb0: 7428 6c61 7374 5f73 7061 6e29 0a20 2020  t(last_span).   
+0000cec0: 2020 2020 2066 6f6e 745f 7369 7a65 203d       font_size =
+0000ced0: 2063 7373 732e 666f 6e74 5f73 697a 650a   csss.font_size.
+0000cee0: 2020 2020 2020 2020 6c61 7374 5f66 6f6e          last_fon
+0000cef0: 745f 7369 7a65 203d 206c 6173 745f 6373  t_size = last_cs
+0000cf00: 7373 2e66 6f6e 745f 7369 7a65 0a20 2020  ss.font_size.   
+0000cf10: 2020 2020 2069 735f 7363 7269 7074 203d       is_script =
+0000cf20: 204e 6f6e 650a 2020 2020 2020 2020 6966   None.        if
+0000cf30: 2066 6f6e 745f 7369 7a65 2061 6e64 2066   font_size and f
+0000cf40: 6f6e 745f 7369 7a65 203c 2073 6372 6970  ont_size < scrip
+0000cf50: 745f 6661 6374 6f72 202a 206c 6173 745f  t_factor * last_
+0000cf60: 666f 6e74 5f73 697a 653a 0a20 2020 2020  font_size:.     
+0000cf70: 2020 2020 2020 206c 6173 745f 7920 3d20         last_y = 
+0000cf80: 4353 5353 7479 6c65 2e67 6574 5f79 3028  CSSStyle.get_y0(
+0000cf90: 6c61 7374 5f73 7061 6e29 0a20 2020 2020  last_span).     
+0000cfa0: 2020 2020 2020 2074 6869 735f 7920 3d20         this_y = 
+0000cfb0: 4353 5353 7479 6c65 2e67 6574 5f79 3028  CSSStyle.get_y0(
+0000cfc0: 7370 616e 290a 2020 2020 2020 2020 2020  span).          
+0000cfd0: 2020 6966 2073 6372 6970 745f 7479 7065    if script_type
+0000cfe0: 203d 3d20 5353 6372 6970 742e 5355 423a   == SScript.SUB:
+0000cff0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d000: 2023 2069 7320 6974 206c 6f77 6572 6564   # is it lowered
+0000d010: 3f20 5920 444f 574e 0a20 2020 2020 2020  ? Y DOWN.       
+0000d020: 2020 2020 2020 2020 2069 735f 7363 7269           is_scri
+0000d030: 7074 203d 2079 646f 776e 203d 3d20 286c  pt = ydown == (l
+0000d040: 6173 745f 7920 3c20 7468 6973 5f79 290a  ast_y < this_y).
+0000d050: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+0000d060: 2073 6372 6970 745f 7479 7065 203d 3d20   script_type == 
+0000d070: 5353 6372 6970 742e 5355 503a 0a20 2020  SScript.SUP:.   
+0000d080: 2020 2020 2020 2020 2020 2020 2023 2069               # i
+0000d090: 7320 6974 2072 6169 7365 643f 2059 2044  s it raised? Y D
+0000d0a0: 4f57 4e0a 2020 2020 2020 2020 2020 2020  OWN.            
+0000d0b0: 2020 2020 6973 5f73 6372 6970 7420 3d20      is_script = 
+0000d0c0: 7964 6f77 6e20 3d3d 2028 6c61 7374 5f79  ydown == (last_y
+0000d0d0: 203e 2074 6869 735f 7929 0a20 2020 2020   > this_y).     
+0000d0e0: 2020 2020 2020 2069 6620 6973 5f73 6372         if is_scr
+0000d0f0: 6970 743a 0a20 2020 2020 2020 2020 2020  ipt:.           
+0000d100: 2020 2020 2070 6173 730a 2020 2020 2020       pass.      
+0000d110: 2020 7265 7475 726e 2069 735f 7363 7269    return is_scri
+0000d120: 7074 0a0a 2020 2020 4063 6c61 7373 6d65  pt..    @classme
+0000d130: 7468 6f64 0a20 2020 2064 6566 2073 6574  thod.    def set
+0000d140: 5f61 7474 7269 6228 636c 732c 2065 6c65  _attrib(cls, ele
+0000d150: 6d65 6e74 2c20 6174 746e 616d 652c 2061  ment, attname, a
+0000d160: 7474 7661 6c75 6529 3a0a 2020 2020 2020  ttvalue):.      
+0000d170: 2020 2222 2263 6f6e 7665 6e69 656e 6365    """convenience
+0000d180: 206d 6574 686f 6420 746f 2073 6574 2061   method to set a
+0000d190: 7474 7269 6275 7465 2076 616c 7565 0a20  ttribute value. 
+0000d1a0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+0000d1b0: 2020 2069 6620 656c 656d 656e 7420 6973     if element is
+0000d1c0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+0000d1d0: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
+0000d1e0: 726f 7228 2265 6c65 6d65 6e74 2069 7320  ror("element is 
+0000d1f0: 4e6f 6e65 2229 0a20 2020 2020 2020 2069  None").        i
+0000d200: 6620 6174 746e 616d 6520 616e 6420 6174  f attname and at
+0000d210: 7476 616c 7565 3a0a 2020 2020 2020 2020  tvalue:.        
+0000d220: 2020 2020 656c 656d 656e 742e 7365 7428      element.set(
+0000d230: 6174 746e 616d 652c 2073 7472 2861 7474  attname, str(att
+0000d240: 7661 6c75 6529 290a 0a20 2020 2040 636c  value))..    @cl
+0000d250: 6173 736d 6574 686f 640a 2020 2020 6465  assmethod.    de
+0000d260: 6620 6765 745f 7465 7874 5f63 6f6e 7465  f get_text_conte
+0000d270: 6e74 2863 6c73 2c20 656c 656d 293a 0a20  nt(cls, elem):. 
+0000d280: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+0000d290: 2020 2063 6f6e 7665 6e69 656e 6365 206d     convenience m
+0000d2a0: 6574 686f 643b 2061 766f 6964 7320 6861  ethod; avoids ha
+0000d2b0: 7669 6e67 2074 6f20 7265 6d65 6d62 6572  ving to remember
+0000d2c0: 206a 6f69 6e2f 6974 6572 7465 7874 0a20   join/itertext. 
+0000d2d0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+0000d2e0: 2020 2072 6574 7572 6e20 2727 2e6a 6f69     return ''.joi
+0000d2f0: 6e28 656c 656d 2e69 7465 7274 6578 7428  n(elem.itertext(
+0000d300: 2929 0a0a 2020 2020 4063 6c61 7373 6d65  ))..    @classme
+0000d310: 7468 6f64 0a20 2020 2064 6566 2061 6464  thod.    def add
+0000d320: 5f67 656e 6572 6174 6564 5f69 6473 2863  _generated_ids(c
+0000d330: 6c73 2c20 726f 6f74 5f65 6c65 6d29 3a0a  ls, root_elem):.
+0000d340: 2020 2020 2020 2020 2222 2261 6464 7320          """adds 
+0000d350: 4944 7320 746f 2061 6c6c 2065 6c65 6d65  IDs to all eleme
+0000d360: 6e74 7320 696e 2064 6f63 756d 656e 7420  nts in document 
+0000d370: 6f72 6465 720a 2020 2020 2020 2020 3a70  order.        :p
+0000d380: 6172 616d 2072 6f6f 745f 656c 656d 3a20  aram root_elem: 
+0000d390: 656c 656d 656e 7420 6465 6669 6e69 6e67  element defining
+0000d3a0: 2074 7265 6520 6f66 2073 7562 656c 656d   tree of subelem
+0000d3b0: 656e 7473 2222 220a 2020 2020 2020 2020  ents""".        
+0000d3c0: 7870 6174 6820 3d20 222f 2f2a 220a 2020  xpath = "//*".  
+0000d3d0: 2020 2020 2020 656c 656d 7320 3d20 726f        elems = ro
+0000d3e0: 6f74 5f65 6c65 6d2e 7870 6174 6828 7870  ot_elem.xpath(xp
+0000d3f0: 6174 6829 0a20 2020 2020 2020 2066 6f72  ath).        for
+0000d400: 2069 2c20 656c 2069 6e20 656e 756d 6572   i, el in enumer
+0000d410: 6174 6528 656c 656d 7329 3a0a 2020 2020  ate(elems):.    
+0000d420: 2020 2020 2020 2020 656c 2e61 7474 7269          el.attri
+0000d430: 625b 415f 4944 5d20 3d20 415f 4944 202b  b[A_ID] = A_ID +
+0000d440: 2073 7472 2869 290a 0a20 2020 2040 636c   str(i)..    @cl
+0000d450: 6173 736d 6574 686f 640a 2020 2020 6465  assmethod.    de
+0000d460: 6620 6a6f 696e 5f73 7061 6e73 5f69 6e5f  f join_spans_in_
+0000d470: 7361 6d65 5f64 6976 2863 6c73 2c20 7370  same_div(cls, sp
+0000d480: 616e 302c 2073 7061 6e31 2c20 6164 6473  an0, span1, adds
+0000d490: 7061 6365 3d54 7275 652c 2072 656d 6f76  pace=True, remov
+0000d4a0: 653d 5472 7565 293a 0a20 2020 2020 2020  e=True):.       
+0000d4b0: 2022 2222 0a20 2020 2020 2020 206a 6f69   """.        joi
+0000d4c0: 6e74 203c 7370 616e 3e2e 2e2e 3c2f 7370  nt <span>...</sp
+0000d4d0: 616e 3e3c 7370 616e 3e2e 2e2e 3c2f 7370  an><span>...</sp
+0000d4e0: 616e 3e20 696e 746f 203c 7370 616e 3e2e  an> into <span>.
+0000d4f0: 2e2e 3c2f 7370 616e 3e0a 2020 2020 2020  ..</span>.      
+0000d500: 2020 7468 6973 2073 7472 7563 7475 7265    this structure
+0000d510: 2061 7269 7365 7320 7768 656e 2050 4446   arises when PDF
+0000d520: 206f 7220 696d 6167 6573 2069 7320 7061   or images is pa
+0000d530: 7273 6564 2061 6e64 2073 7061 6e73 2068  rsed and spans h
+0000d540: 6176 6520 7468 6520 7361 6d65 2073 7479  ave the same sty
+0000d550: 6c65 7320 2873 697a 652f 7374 796c 652f  les (size/style/
+0000d560: 7765 6967 6874 2920 616e 6420 6361 6e20  weight) and can 
+0000d570: 6265 206d 6572 6765 640a 2020 2020 2020  be merged.      
+0000d580: 2020 7765 2061 7373 756d 6520 7468 6174    we assume that
+0000d590: 2073 7479 6c65 2061 6e64 2067 656f 6d65   style and geome
+0000d5a0: 7472 7920 6368 656b 696e 6720 6861 7320  try cheking has 
+0000d5b0: 6265 656e 2064 6f6e 650a 2020 2020 2020  been done.      
+0000d5c0: 2020 3a70 6172 616d 2073 7061 6e30 3a20    :param span0: 
+0000d5d0: 6669 7273 7420 3c73 7061 6e3e 2c20 7465  first <span>, te
+0000d5e0: 7874 2077 696c 6c20 6265 2069 6e63 7265  xt will be incre
+0000d5f0: 6173 6564 2066 726f 6d20 7370 616e 310a  ased from span1.
+0000d600: 2020 2020 2020 2020 3a70 6172 616d 2073          :param s
+0000d610: 7061 6e31 3a20 7465 7874 2077 696c 6c20  pan1: text will 
+0000d620: 6265 2061 7070 656e 6465 6420 746f 2073  be appended to s
+0000d630: 7061 6e30 2074 6578 740a 2020 2020 2020  pan0 text.      
+0000d640: 2020 3a70 6172 616d 2072 656d 6f76 653a    :param remove:
+0000d650: 2072 656d 6f76 6520 7370 616e 3120 2864   remove span1 (d
+0000d660: 6566 6175 6c74 290a 2020 2020 2020 2020  efault).        
+0000d670: 2222 220a 2020 2020 2020 2020 6966 2048  """.        if H
+0000d680: 746d 6c55 7469 6c2e 6368 6563 6b5f 7461  tmlUtil.check_ta
+0000d690: 6728 7370 616e 302c 2022 7370 616e 2229  g(span0, "span")
+0000d6a0: 2061 6e64 2048 746d 6c55 7469 6c2e 6368   and HtmlUtil.ch
+0000d6b0: 6563 6b5f 7461 6728 7370 616e 312c 2022  eck_tag(span1, "
+0000d6c0: 7370 616e 2229 3a0a 2020 2020 2020 2020  span"):.        
+0000d6d0: 2020 2020 7061 7265 6e74 3120 3d20 7370      parent1 = sp
+0000d6e0: 616e 312e 6765 7470 6172 656e 7428 290a  an1.getparent().
+0000d6f0: 2020 2020 2020 2020 2020 2020 6966 2061              if a
+0000d700: 6464 7370 6163 653a 0a20 2020 2020 2020  ddspace:.       
+0000d710: 2020 2020 2020 2020 2073 7061 6e30 5f6e           span0_n
+0000d720: 6f74 5f65 6e64 5f73 7061 6365 203d 206c  ot_end_space = l
+0000d730: 656e 2873 7061 6e30 2920 3e20 3020 616e  en(span0) > 0 an
+0000d740: 6420 7370 616e 305b 2d31 5d20 213d 2022  d span0[-1] != "
+0000d750: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
+0000d760: 2020 2073 7061 6e31 5f6e 6f74 5f73 7461     span1_not_sta
+0000d770: 7274 5f73 7061 6365 203d 206c 656e 2873  rt_space = len(s
+0000d780: 7061 6e31 2920 3e20 3020 616e 6420 7370  pan1) > 0 and sp
+0000d790: 616e 315b 2d31 5d20 213d 2022 2022 0a20  an1[-1] != " ". 
+0000d7a0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000d7b0: 6620 7370 616e 305f 6e6f 745f 656e 645f  f span0_not_end_
+0000d7c0: 7370 6163 6520 616e 6420 7370 616e 315f  space and span1_
+0000d7d0: 6e6f 745f 7374 6172 745f 7370 6163 653a  not_start_space:
+0000d7e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d7f0: 2020 2020 2073 7061 6e30 2e74 6578 7420       span0.text 
+0000d800: 2b3d 2022 2022 0a20 2020 2020 2020 2020  += " ".         
+0000d810: 2020 2073 7061 6e30 2e74 6578 7420 2b3d     span0.text +=
+0000d820: 2073 7061 6e31 2e74 6578 740a 2020 2020   span1.text.    
+0000d830: 2020 2020 2020 2020 6966 2072 656d 6f76          if remov
+0000d840: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0000d850: 2020 2070 6172 656e 7431 2e72 656d 6f76     parent1.remov
+0000d860: 6528 7370 616e 3129 0a0a 2020 2020 4063  e(span1)..    @c
+0000d870: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
+0000d880: 6566 2063 7265 6174 655f 736b 656c 6574  ef create_skelet
+0000d890: 6f6e 5f68 746d 6c28 636c 7329 3a0a 2020  on_html(cls):.  
+0000d8a0: 2020 2020 2020 2222 2263 7265 6174 6520        """create 
+0000d8b0: 656d 7074 7920 6874 6d6c 2074 7265 650a  empty html tree.
+0000d8c0: 2020 2020 2020 2020 6874 6d6c 0a20 2020          html.   
+0000d8d0: 2020 2020 2020 2020 2068 6561 640a 2020           head.  
+0000d8e0: 2020 2020 2020 2020 2020 2020 2020 6d65                me
+0000d8f0: 7461 0a20 2020 2020 2020 2020 2020 2020  ta.             
+0000d900: 2020 2023 2073 7479 6c65 0a20 2020 2020     # style.     
+0000d910: 2020 2020 2020 2062 6f64 790a 0a20 2020         body..   
+0000d920: 2020 2020 203a 7265 7475 726e 3a20 7468       :return: th
+0000d930: 6973 2068 746d 6c0a 2020 2020 2020 2020  is html.        
+0000d940: 2222 220a 0a20 2020 2020 2020 2068 746d  """..        htm
+0000d950: 6c20 3d20 4554 2e45 6c65 6d65 6e74 2848  l = ET.Element(H
+0000d960: 5f48 544d 4c29 0a20 2020 2020 2020 2068  _HTML).        h
+0000d970: 6561 6420 3d20 4554 2e45 6c65 6d65 6e74  ead = ET.Element
+0000d980: 2848 5f48 4541 4429 0a20 2020 2020 2020  (H_HEAD).       
+0000d990: 2068 746d 6c2e 6170 7065 6e64 2868 6561   html.append(hea
+0000d9a0: 6429 0a20 2020 2020 2020 206d 6574 6120  d).        meta 
+0000d9b0: 3d20 4554 2e45 6c65 6d65 6e74 2848 5f4d  = ET.Element(H_M
+0000d9c0: 4554 4129 0a20 2020 2020 2020 2068 6561  ETA).        hea
+0000d9d0: 642e 6170 7065 6e64 286d 6574 6129 0a20  d.append(meta). 
+0000d9e0: 2020 2020 2020 2073 7479 6c65 203d 2045         style = E
+0000d9f0: 542e 456c 656d 656e 7428 485f 5354 594c  T.Element(H_STYL
+0000da00: 4529 2020 2320 656d 7074 7920 3c73 7479  E)  # empty <sty
+0000da10: 6c65 3e20 6d65 616e 7320 6e6f 2064 6973  le> means no dis
+0000da20: 706c 6179 0a20 2020 2020 2020 2023 2068  play.        # h
+0000da30: 6561 642e 6170 7065 6e64 2873 7479 6c65  ead.append(style
+0000da40: 290a 2020 2020 2020 2020 626f 6479 203d  ).        body =
+0000da50: 2045 542e 456c 656d 656e 7428 485f 424f   ET.Element(H_BO
+0000da60: 4459 290a 2020 2020 2020 2020 6874 6d6c  DY).        html
+0000da70: 2e61 7070 656e 6428 626f 6479 290a 2020  .append(body).  
+0000da80: 2020 2020 2020 7265 7475 726e 2068 746d        return htm
+0000da90: 6c0a 0a20 2020 2040 636c 6173 736d 6574  l..    @classmet
+0000daa0: 686f 640a 2020 2020 6465 6620 6669 6e64  hod.    def find
+0000dab0: 5f65 6c65 6d65 6e74 735f 7769 7468 5f73  _elements_with_s
+0000dac0: 7479 6c65 2863 6c73 2c20 656c 656d 2c20  tyle(cls, elem, 
+0000dad0: 7870 6174 682c 2063 6f6e 6469 7469 6f6e  xpath, condition
+0000dae0: 3d4e 6f6e 652c 2072 656d 6f76 653d 4661  =None, remove=Fa
+0000daf0: 6c73 6529 3a0a 2020 2020 2020 2020 2222  lse):.        ""
+0000db00: 2272 656d 6f76 6520 616c 6c20 656c 656d  "remove all elem
+0000db10: 656e 7473 2077 6974 6820 7374 796c 6520  ents with style 
+0000db20: 6675 6c66 696c 6c69 6e67 2063 6f6e 6469  fulfilling condi
+0000db30: 7469 6f6e 0a20 2020 2020 2020 203a 7061  tion.        :pa
+0000db40: 7261 6d20 656c 656d 3a20 726f 6f74 2065  ram elem: root e
+0000db50: 6c65 6d65 6e74 2066 6f72 2078 7061 7468  lement for xpath
+0000db60: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+0000db70: 7870 6174 683a 2065 6c65 6d65 6e74 7320  xpath: elements 
+0000db80: 746f 2073 6361 6e20 2c20 7368 6f75 6c64  to scan , should
+0000db90: 206e 6f72 6d61 6c6c 7920 636f 6e74 6169   normally contai
+0000dba0: 6e20 7468 6520 4073 7479 6c65 2063 6f6e  n the @style con
+0000dbb0: 6469 7469 6f6e 0a20 2020 2020 2020 2020  dition.         
+0000dbc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dbd0: 2069 6620 4e6f 6e65 2075 7365 730a 2020   if None uses.  
+0000dbe0: 2020 2020 2020 3a70 6172 616d 2063 6f6e        :param con
+0000dbf0: 6469 7469 6f6e 3a20 7374 796c 6520 636f  dition: style co
+0000dc00: 6e64 6974 696f 6e20 7072 696d 6974 6976  ndition primitiv
+0000dc10: 6520 6174 2070 7265 7365 6e74 0a20 2020  e at present.   
+0000dc20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dc30: 2020 2020 2020 2028 7661 7269 6162 6c65         (variable
+0000dc40: 2c20 6f72 2076 6172 6961 626c 6520 206f  , or variable  o
+0000dc50: 7065 7261 746f 7220 7661 6c75 6520 2865  perator value (e
+0000dc60: 7661 6c20 6973 2065 7669 6c29 0a20 2020  val is evil).   
+0000dc70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dc80: 2020 2020 2020 2065 7861 6d70 6c65 2022         example "
+0000dc90: 5f66 6f6e 742d 7369 7a65 203e 2033 3022  _font-size > 30"
+0000dca0: 206f 7220 225f 706f 7369 7469 6f6e 2220   or "_position" 
+0000dcb0: 286d 6561 6e73 2068 6173 2070 6f73 6974  (means has posit
+0000dcc0: 696f 6e29 0a20 2020 2020 2020 203a 7061  ion).        :pa
+0000dcd0: 7261 6d20 7265 6d6f 7665 3a20 7265 6d6f  ram remove: remo
+0000dce0: 7665 2074 6865 7365 2065 6c65 6d65 6e74  ve these element
+0000dcf0: 7320 286e 6f74 2074 6865 6972 2074 6169  s (not their tai
+0000dd00: 6c29 0a20 2020 2020 2020 2022 2222 0a20  l).        """. 
+0000dd10: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+0000dd20: 2020 204d 6179 6265 206d 6f76 6520 746f     Maybe move to
+0000dd30: 2048 544d 4c54 6964 790a 2020 2020 2020   HTMLTidy.      
+0000dd40: 2020 2222 220a 2020 2020 2020 2020 6173    """.        as
+0000dd50: 7365 7274 2065 6c65 6d20 6973 206e 6f74  sert elem is not
+0000dd60: 204e 6f6e 652c 2066 226d 7573 7420 6861   None, f"must ha
+0000dd70: 7665 2065 6c65 6d22 0a20 2020 2020 2020  ve elem".       
+0000dd80: 2069 6620 7870 6174 683a 0a20 2020 2020   if xpath:.     
+0000dd90: 2020 2020 2020 2065 6c73 203d 2065 6c65         els = ele
+0000dda0: 6d2e 7870 6174 6828 7870 6174 6829 0a20  m.xpath(xpath). 
+0000ddb0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0000ddc0: 2020 2020 2020 2020 2065 6c73 203d 205b           els = [
+0000ddd0: 656c 656d 5d0a 2020 2020 2020 2020 656c  elem].        el
+0000dde0: 656d 7320 3d20 5b5d 0a20 2020 2020 2020  ems = [].       
+0000ddf0: 2066 6f72 2065 6c20 696e 2065 6c73 3a0a   for el in els:.
+0000de00: 2020 2020 2020 2020 2020 2020 6373 735f              css_
+0000de10: 7374 796c 6520 3d20 4353 5353 7479 6c65  style = CSSStyle
+0000de20: 2e63 7265 6174 655f 6373 735f 7374 796c  .create_css_styl
+0000de30: 655f 6672 6f6d 5f61 7474 7269 6275 7465  e_from_attribute
+0000de40: 5f6f 665f 626f 6479 5f65 6c65 6d65 6e74  _of_body_element
+0000de50: 2865 6c29 0a20 2020 2020 2020 2020 2020  (el).           
+0000de60: 2069 6620 636f 6e64 6974 696f 6e3a 0a20   if condition:. 
+0000de70: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000de80: 6620 6373 735f 7374 796c 652e 6f62 6579  f css_style.obey
+0000de90: 7328 636f 6e64 6974 696f 6e29 3a0a 2020  s(condition):.  
+0000dea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000deb0: 2020 6966 2072 656d 6f76 653a 0a20 2020    if remove:.   
 0000dec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ded0: 2020 2020 6966 2072 656d 6f76 653a 0a20      if remove:. 
-0000dee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000def0: 2020 2020 2020 2063 6c73 2e72 656d 6f76         cls.remov
-0000df00: 655f 656c 656d 5f6b 6565 705f 7461 696c  e_elem_keep_tail
-0000df10: 2865 6c29 0a0a 2020 2020 4063 6c61 7373  (el)..    @class
-0000df20: 6d65 7468 6f64 0a20 2020 2064 6566 2072  method.    def r
-0000df30: 656d 6f76 655f 6865 6164 6572 735f 616e  emove_headers_an
-0000df40: 645f 666f 6f74 6572 735f 7573 696e 675f  d_footers_using_
-0000df50: 7064 666d 696e 6572 5f63 6f6f 7264 7328  pdfminer_coords(
-0000df60: 636c 732c 2072 6566 5f65 6c65 6d2c 2070  cls, ref_elem, p
-0000df70: 6167 6573 697a 652c 2068 6561 6465 725f  agesize, header_
-0000df80: 6865 6967 6874 2c20 666f 6f74 6572 5f68  height, footer_h
-0000df90: 6569 6768 742c 0a20 2020 2020 2020 2020  eight,.         
-0000dfa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dfb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dfc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dfd0: 6d61 726b 6572 5f78 7061 7468 2c20 7061  marker_xpath, pa
-0000dfe0: 6765 5f74 6f70 733d 4e6f 6e65 293a 0a20  ge_tops=None):. 
-0000dff0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0000e000: 2020 204e 4f54 2043 4f4d 504c 4554 4520     NOT COMPLETE 
-0000e010: 2d20 7468 6572 6520 6172 6520 6e6f 2066  - there are no f
-0000e020: 6f6f 7465 7273 2062 6563 6175 7365 206f  ooters because o
-0000e030: 6620 7468 6520 636f 6f72 6469 6e61 7465  f the coordinate
-0000e040: 2073 7973 7465 6d2e 0a0a 2020 2020 2020   system...      
-0000e050: 2020 4d61 7962 6520 6d6f 7665 2074 6f20    Maybe move to 
-0000e060: 4854 4d4c 5469 6479 0a0a 2020 2020 2020  HTMLTidy..      
-0000e070: 2020 7468 6520 4074 6f70 2072 6570 7265    the @top repre
-0000e080: 7365 6e74 7320 7468 6520 792d 636f 6f72  sents the y-coor
-0000e090: 6469 6e61 7465 2066 726f 6d20 7468 6520  dinate from the 
-0000e0a0: 7374 6172 7420 6f66 2074 6865 2064 6f63  start of the doc
-0000e0b0: 756d 656e 7420 2870 6466 6d69 6e65 723f  ument (pdfminer?
-0000e0c0: 292e 0a20 2020 2020 2020 2074 6869 7320  )..        this 
-0000e0d0: 6d65 616e 7320 7765 2068 6176 6520 746f  means we have to
-0000e0e0: 2073 7562 7472 6163 7420 7061 6765 7369   subtract pagesi
-0000e0f0: 7a65 7320 6672 6f6d 2069 742e 0a20 2020  zes from it..   
-0000e100: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0000e110: 2064 6562 7567 203d 2046 616c 7365 0a20   debug = False. 
-0000e120: 2020 2020 2020 2065 6c65 6d73 203d 2072         elems = r
-0000e130: 6566 5f65 6c65 6d2e 7870 6174 6828 6d61  ef_elem.xpath(ma
-0000e140: 726b 6572 5f78 7061 7468 290a 0a20 2020  rker_xpath)..   
-0000e150: 2020 2020 206c 6173 745f 746f 7020 3d20       last_top = 
-0000e160: 300a 2020 2020 2020 2020 666f 7220 656c  0.        for el
-0000e170: 656d 2069 6e20 7265 665f 656c 656d 2e78  em in ref_elem.x
-0000e180: 7061 7468 2822 2f2f 2a5b 4073 7479 6c65  path("//*[@style
-0000e190: 5d22 293a 0a20 2020 2020 2020 2020 2020  ]"):.           
-0000e1a0: 2079 636f 6f72 6430 203d 2048 746d 6c55   ycoord0 = HtmlU
-0000e1b0: 7469 6c2e 6765 745f 7930 2865 6c65 6d29  til.get_y0(elem)
-0000e1c0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0000e1d0: 6e6f 7420 7963 6f6f 7264 303a 0a20 2020  not ycoord0:.   
-0000e1e0: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
-0000e1f0: 7469 6e75 650a 2020 2020 2020 2020 2020  tinue.          
-0000e200: 2020 7465 7874 203d 2058 6d6c 4c69 622e    text = XmlLib.
-0000e210: 6765 745f 7465 7874 2865 6c65 6d29 2e73  get_text(elem).s
-0000e220: 7472 6970 2829 0a20 2020 2020 2020 2020  trip().         
-0000e230: 2020 2070 6167 655f 746f 705f 7920 3d20     page_top_y = 
-0000e240: 4874 6d6c 5574 696c 2e67 6574 5f6c 6172  HtmlUtil.get_lar
-0000e250: 6765 7374 5f63 6f6f 7264 5f6c 6573 735f  gest_coord_less_
-0000e260: 7468 616e 2870 6167 655f 746f 7073 2c20  than(page_tops, 
-0000e270: 7963 6f6f 7264 3029 0a20 2020 2020 2020  ycoord0).       
-0000e280: 2020 2020 2069 6620 7061 6765 5f74 6f70       if page_top
-0000e290: 5f79 2069 7320 4e6f 6e65 3a0a 2020 2020  _y is None:.    
-0000e2a0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-0000e2b0: 7428 6622 6361 6e6e 6f74 2066 696e 6420  t(f"cannot find 
-0000e2c0: 7061 6765 2074 6f70 207b 7963 6f6f 7264  page top {ycoord
-0000e2d0: 307d 2229 0a20 2020 2020 2020 2020 2020  0}").           
-0000e2e0: 2020 2020 2063 6f6e 7469 6e75 650a 2020       continue.  
-0000e2f0: 2020 2020 2020 2020 2020 7061 6765 5f74            page_t
-0000e300: 6f70 5f79 203d 2066 6c6f 6174 2870 6167  op_y = float(pag
-0000e310: 655f 746f 705f 7929 0a20 2020 2020 2020  e_top_y).       
-0000e320: 2020 2020 2079 636f 6f72 6420 3d20 7963       ycoord = yc
-0000e330: 6f6f 7264 3020 2d20 7061 6765 5f74 6f70  oord0 - page_top
-0000e340: 5f79 0a0a 2020 2020 2020 2020 2020 2020  _y..            
-0000e350: 2320 7072 696e 7428 6622 544f 5020 7b79  # print(f"TOP {y
-0000e360: 636f 6f72 6430 7d20 7b79 636f 6f72 647d  coord0} {ycoord}
-0000e370: 207b 7061 6765 7369 7a65 7d20 7b79 636f   {pagesize} {yco
-0000e380: 6f72 6420 2520 7061 6765 7369 7a65 7d22  ord % pagesize}"
-0000e390: 290a 2020 2020 2020 2020 2020 2020 696e  ).            in
-0000e3a0: 5f74 6f70 203d 2079 636f 6f72 6420 3c20  _top = ycoord < 
-0000e3b0: 6865 6164 6572 5f68 6569 6768 740a 2020  header_height.  
-0000e3c0: 2020 2020 2020 2020 2020 6966 2069 6e5f            if in_
-0000e3d0: 746f 703a 0a20 2020 2020 2020 2020 2020  top:.           
-0000e3e0: 2020 2020 2069 6620 6465 6275 673a 0a20       if debug:. 
-0000e3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e400: 2020 2070 7269 6e74 2866 2254 4f50 2020     print(f"TOP  
-0000e410: 7b74 6578 747d 2229 0a20 2020 2020 2020  {text}").       
-0000e420: 2020 2020 2069 6e5f 626f 7474 6f6d 203d       in_bottom =
-0000e430: 2079 636f 6f72 6420 3e20 7061 6765 7369   ycoord > pagesi
-0000e440: 7a65 5b30 5d20 2d20 666f 6f74 6572 5f68  ze[0] - footer_h
-0000e450: 6569 6768 740a 2020 2020 2020 2020 2020  eight.          
-0000e460: 2020 6966 2069 6e5f 626f 7474 6f6d 3a0a    if in_bottom:.
-0000e470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e480: 6966 2064 6562 7567 3a0a 2020 2020 2020  if debug:.      
-0000e490: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-0000e4a0: 696e 7428 6622 424f 5454 4f4d 2020 7b74  int(f"BOTTOM  {t
-0000e4b0: 6578 747d 2229 0a20 2020 2020 2020 2020  ext}").         
-0000e4c0: 2020 2069 6620 696e 5f74 6f70 206f 7220     if in_top or 
-0000e4d0: 696e 5f62 6f74 746f 6d3a 0a20 2020 2020  in_bottom:.     
-0000e4e0: 2020 2020 2020 2020 2020 2069 6620 6c65             if le
-0000e4f0: 6e28 7465 7874 2e73 7472 6970 2829 2920  n(text.strip()) 
-0000e500: 3e20 303a 0a20 2020 2020 2020 2020 2020  > 0:.           
-0000e510: 2020 2020 2020 2020 206c 6f67 6769 6e67           logging
-0000e520: 2e77 6172 6e69 6e67 2866 2272 656d 6f76  .warning(f"remov
-0000e530: 696e 6720 746f 7020 7465 7874 207b 7465  ing top text {te
-0000e540: 7874 7d22 290a 2020 2020 2020 2020 2020  xt}").          
-0000e550: 2020 2020 2020 636c 732e 7265 6d6f 7665        cls.remove
-0000e560: 5f65 6c65 6d5f 6b65 6570 5f74 6169 6c28  _elem_keep_tail(
-0000e570: 656c 656d 290a 2020 2020 2020 2020 2020  elem).          
-0000e580: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0000e590: 2020 2020 2020 2020 2320 736b 6970 7065          # skippe
-0000e5a0: 640a 2020 2020 2020 2020 2020 2020 2020  d.              
-0000e5b0: 2020 7061 7373 0a0a 2020 2020 4063 6c61    pass..    @cla
-0000e5c0: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
-0000e5d0: 2067 6574 5f6c 6172 6765 7374 5f63 6f6f   get_largest_coo
-0000e5e0: 7264 5f6c 6573 735f 7468 616e 2863 6c73  rd_less_than(cls
-0000e5f0: 2c20 7061 6765 5f74 6f70 732c 2063 6f6f  , page_tops, coo
-0000e600: 7264 293a 0a20 2020 2020 2020 2022 2222  rd):.        """
-0000e610: 0a20 2020 2020 2020 2069 7465 7261 7465  .        iterate
-0000e620: 2074 6872 6f75 6768 2073 6f72 7465 6420   through sorted 
-0000e630: 6c69 7374 206f 6620 7061 6765 5f74 6f70  list of page_top
-0000e640: 7320 616e 6420 6669 6e64 2074 6865 206c  s and find the l
-0000e650: 6172 6765 7374 206c 6573 7320 7468 616e  argest less than
-0000e660: 2063 6f6f 7264 0a20 2020 2020 2020 203a   coord.        :
-0000e670: 7061 7261 6d20 7061 6765 5f74 6f70 733a  param page_tops:
-0000e680: 2073 6f72 7465 6420 696e 6372 6561 7369   sorted increasi
-0000e690: 6e67 206c 6973 7420 6f66 2070 6167 6520  ng list of page 
-0000e6a0: 746f 7073 0a20 2020 2020 2020 203a 7061  tops.        :pa
-0000e6b0: 7261 6d20 636f 6f72 643a 2061 6374 7561  ram coord: actua
-0000e6c0: 6c20 636f 6f72 6469 6e61 7465 0a20 2020  l coordinate.   
-0000e6d0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0000e6e0: 2069 6620 7061 6765 5f74 6f70 7320 6973   if page_tops is
-0000e6f0: 204e 6f6e 6520 6f72 2063 6f6f 7264 2069   None or coord i
-0000e700: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-0000e710: 2020 2020 7265 7475 726e 204e 6f6e 650a      return None.
-0000e720: 2020 2020 2020 2020 666f 7220 692c 2070          for i, p
-0000e730: 6167 655f 746f 7020 696e 2065 6e75 6d65  age_top in enume
-0000e740: 7261 7465 2870 6167 655f 746f 7073 293a  rate(page_tops):
-0000e750: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0000e760: 666c 6f61 7428 7061 6765 5f74 6f70 2920  float(page_top) 
-0000e770: 3e20 666c 6f61 7428 636f 6f72 6429 3a0a  > float(coord):.
-0000e780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e790: 6966 2069 203d 3d20 303a 0a20 2020 2020  if i == 0:.     
-0000e7a0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0000e7b0: 6574 7572 6e20 4e6f 6e65 0a20 2020 2020  eturn None.     
-0000e7c0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0000e7d0: 6e20 7061 6765 5f74 6f70 735b 6920 2d20  n page_tops[i - 
-0000e7e0: 315d 0a20 2020 2020 2020 2072 6574 7572  1].        retur
-0000e7f0: 6e20 4e6f 6e65 0a0a 2020 2020 4063 6c61  n None..    @cla
-0000e800: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
-0000e810: 2072 656d 6f76 655f 6c68 5f6c 696e 655f   remove_lh_line_
-0000e820: 6e75 6d62 6572 7328 636c 732c 2072 6566  numbers(cls, ref
-0000e830: 5f65 6c65 6d29 3a0a 2020 2020 2020 2020  _elem):.        
-0000e840: 636c 732e 6669 6e64 5f65 6c65 6d65 6e74  cls.find_element
-0000e850: 735f 7769 7468 5f73 7479 6c65 2872 6566  s_with_style(ref
-0000e860: 5f65 6c65 6d2c 2022 2e2f 2f2a 5b40 7374  _elem, ".//*[@st
-0000e870: 796c 655d 222c 2022 6c65 6674 3c34 3922  yle]", "left<49"
-0000e880: 2c20 7265 6d6f 7665 3d54 7275 6529 0a20  , remove=True). 
-0000e890: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0000e8a0: 2020 204d 6179 6265 206d 6f76 6520 746f     Maybe move to
-0000e8b0: 2048 544d 4c54 6964 790a 2020 2020 2020   HTMLTidy.      
-0000e8c0: 2020 2222 220a 0a20 2020 2040 636c 6173    """..    @clas
-0000e8d0: 736d 6574 686f 640a 2020 2020 6465 6620  smethod.    def 
-0000e8e0: 7265 6d6f 7665 5f61 7474 7269 6275 7465  remove_attribute
-0000e8f0: 2863 6c73 2c20 656c 656d 2c20 6174 745f  (cls, elem, att_
-0000e900: 6e61 6d65 293a 0a20 2020 2020 2020 2022  name):.        "
-0000e910: 2222 0a20 2020 2020 2020 2072 656d 6f76  "".        remov
-0000e920: 6573 2061 7474 7269 6275 7465 2077 6974  es attribute wit
-0000e930: 6820 6769 7665 6e20 6e61 6d65 0a20 2020  h given name.   
-0000e940: 2020 2020 2049 6620 6e6f 7420 7072 6573       If not pres
-0000e950: 656e 742c 206e 6f2d 6f70 0a20 2020 2020  ent, no-op.     
-0000e960: 2020 203a 7061 7261 6d20 656c 656d 3a20     :param elem: 
-0000e970: 656c 656d 656e 7420 636f 6e74 6169 6e69  element containi
-0000e980: 6e67 2061 7474 7269 6275 7465 0a20 2020  ng attribute.   
-0000e990: 2020 2020 203a 7061 7261 6d20 6174 745f       :param att_
-0000e9a0: 6e61 6d65 3a20 6e61 6d65 206f 6620 6174  name: name of at
-0000e9b0: 7472 6962 7574 650a 2020 2020 2020 2020  tribute.        
-0000e9c0: 3a72 6574 7572 6e3a 204e 6f6e 650a 2020  :return: None.  
-0000e9d0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0000e9e0: 2020 2222 220a 2020 2020 2020 2020 726f    """.        ro
-0000e9f0: 6f74 2e61 7474 7269 622e 706f 7028 2278  ot.attrib.pop("x
-0000ea00: 797a 222c 204e 6f6e 6529 2022 2222 0a20  yz", None) """. 
-0000ea10: 2020 2020 2020 2069 6620 656c 656d 2069         if elem i
-0000ea20: 7320 4e6f 6e65 206f 7220 6174 745f 6e61  s None or att_na
-0000ea30: 6d65 2069 7320 4e6f 6e65 3a0a 2020 2020  me is None:.    
-0000ea40: 2020 2020 2020 2020 7265 7475 726e 0a20          return. 
-0000ea50: 2020 2020 2020 2065 6c65 6d2e 6174 7472         elem.attr
-0000ea60: 6962 2e70 6f70 2861 7474 5f6e 616d 652c  ib.pop(att_name,
-0000ea70: 204e 6f6e 6529 0a0a 2020 2020 4063 6c61   None)..    @cla
-0000ea80: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
-0000ea90: 2072 656d 6f76 655f 7374 796c 655f 6174   remove_style_at
-0000eaa0: 7472 6962 7574 6528 636c 732c 2072 6566  tribute(cls, ref
-0000eab0: 5f65 6c65 6d2c 2073 7479 6c65 5f6e 616d  _elem, style_nam
-0000eac0: 6529 3a0a 2020 2020 2020 2020 2222 220a  e):.        """.
-0000ead0: 2020 2020 2020 2020 4d61 7962 6520 6d6f          Maybe mo
-0000eae0: 7665 2074 6f20 4854 4d4c 5469 6479 0a20  ve to HTMLTidy. 
-0000eaf0: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
-0000eb00: 2020 2020 656c 656d 7320 3d20 7265 665f      elems = ref_
-0000eb10: 656c 656d 2e78 7061 7468 2822 2e2f 2f2a  elem.xpath(".//*
-0000eb20: 2229 0a20 2020 2020 2020 2066 6f72 2065  ").        for e
-0000eb30: 6c20 696e 2065 6c65 6d73 3a0a 2020 2020  l in elems:.    
-0000eb40: 2020 2020 2020 2020 6373 735f 7374 796c          css_styl
-0000eb50: 6520 3d20 4353 5353 7479 6c65 2e63 7265  e = CSSStyle.cre
-0000eb60: 6174 655f 6373 735f 7374 796c 655f 6672  ate_css_style_fr
-0000eb70: 6f6d 5f61 7474 7269 6275 7465 5f6f 665f  om_attribute_of_
-0000eb80: 626f 6479 5f65 6c65 6d65 6e74 2865 6c29  body_element(el)
-0000eb90: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0000eba0: 6373 735f 7374 796c 652e 6e61 6d65 5f76  css_style.name_v
-0000ebb0: 616c 7565 5f64 6963 742e 6765 7428 7374  alue_dict.get(st
-0000ebc0: 796c 655f 6e61 6d65 293a 0a20 2020 2020  yle_name):.     
-0000ebd0: 2020 2020 2020 2020 2020 2063 7373 5f73             css_s
-0000ebe0: 7479 6c65 2e6e 616d 655f 7661 6c75 655f  tyle.name_value_
-0000ebf0: 6469 6374 2e70 6f70 2873 7479 6c65 5f6e  dict.pop(style_n
-0000ec00: 616d 6529 0a20 2020 2020 2020 2020 2020  ame).           
-0000ec10: 2020 2020 2063 7373 5f73 7479 6c65 2e61       css_style.a
-0000ec20: 7070 6c79 5f74 6f28 656c 290a 0a20 2020  pply_to(el)..   
-0000ec30: 2040 636c 6173 736d 6574 686f 640a 2020   @classmethod.  
-0000ec40: 2020 6465 6620 7265 6d6f 7665 5f6c 6172    def remove_lar
-0000ec50: 6765 5f66 6f6e 7465 645f 656c 656d 656e  ge_fonted_elemen
-0000ec60: 7473 2863 6c73 2c20 7265 665f 656c 656d  ts(cls, ref_elem
-0000ec70: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
-0000ec80: 2020 2020 2020 204d 6179 6265 206d 6f76         Maybe mov
-0000ec90: 6520 746f 2048 544d 4c54 6964 790a 2020  e to HTMLTidy.  
-0000eca0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0000ecb0: 2020 636c 732e 6669 6e64 5f65 6c65 6d65    cls.find_eleme
-0000ecc0: 6e74 735f 7769 7468 5f73 7479 6c65 2872  nts_with_style(r
-0000ecd0: 6566 5f65 6c65 6d2c 2022 2e2f 2f2a 5b40  ef_elem, ".//*[@
-0000ece0: 7374 796c 655d 222c 2022 666f 6e74 2d73  style]", "font-s
-0000ecf0: 697a 653e 3330 222c 2072 656d 6f76 653d  ize>30", remove=
-0000ed00: 5472 7565 290a 0a20 2020 2040 636c 6173  True)..    @clas
-0000ed10: 736d 6574 686f 640a 2020 2020 6465 6620  smethod.    def 
-0000ed20: 6669 6e64 5f63 6f6e 7374 616e 745f 636f  find_constant_co
-0000ed30: 6f72 6469 6e61 7465 5f6d 6172 6b65 7273  ordinate_markers
-0000ed40: 2863 6c73 2c20 7265 665f 656c 656d 2c20  (cls, ref_elem, 
-0000ed50: 7870 6174 682c 2073 7479 6c65 3d22 746f  xpath, style="to
-0000ed60: 7022 293a 0a20 2020 2020 2020 2022 2222  p"):.        """
-0000ed70: 0a20 2020 2020 2020 2066 696e 6473 2061  .        finds a
-0000ed80: 206c 696e 6520 7769 7468 2063 6f6e 7374   line with const
-0000ed90: 616e 7420 6469 6666 6572 656e 6365 2066  ant difference f
-0000eda0: 726f 6d20 746f 7020 6f66 2070 6167 650a  rom top of page.
-0000edb0: 3c64 6976 2073 7479 6c65 3d22 746f 703a  <div style="top:
-0000edc0: 2035 3070 783b 223e 3c61 206e 616d 653d   50px;"><a name=
-0000edd0: 2231 223e 5061 6765 2031 3c2f 613e 3c2f  "1">Page 1</a></
-0000ede0: 6469 763e 0a20 2020 2020 2020 2022 2222  div>.        """
-0000edf0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0000ee00: 2020 2020 204d 6179 6265 206d 6f76 6520       Maybe move 
-0000ee10: 746f 2048 544d 4c54 6964 790a 2020 2020  to HTMLTidy.    
-0000ee20: 2020 2020 2222 220a 0a20 2020 2020 2020      """..       
-0000ee30: 2065 6c65 6d73 203d 2072 6566 5f65 6c65   elems = ref_ele
-0000ee40: 6d2e 7870 6174 6828 7870 6174 6829 0a20  m.xpath(xpath). 
-0000ee50: 2020 2020 2020 2063 6f6f 7264 7320 3d20         coords = 
-0000ee60: 5b5d 0a20 2020 2020 2020 2066 6f72 2065  [].        for e
-0000ee70: 6c65 6d20 696e 2065 6c65 6d73 3a0a 2020  lem in elems:.  
-0000ee80: 2020 2020 2020 2020 2020 6373 735f 7374            css_st
-0000ee90: 796c 6520 3d20 4353 5353 7479 6c65 2e63  yle = CSSStyle.c
-0000eea0: 7265 6174 655f 6373 735f 7374 796c 655f  reate_css_style_
-0000eeb0: 6672 6f6d 5f61 7474 7269 6275 7465 5f6f  from_attribute_o
-0000eec0: 665f 626f 6479 5f65 6c65 6d65 6e74 2865  f_body_element(e
-0000eed0: 6c65 6d29 0a20 2020 2020 2020 2020 2020  lem).           
-0000eee0: 2063 6f6f 7264 203d 2063 7373 5f73 7479   coord = css_sty
-0000eef0: 6c65 2e6e 616d 655f 7661 6c75 655f 6469  le.name_value_di
-0000ef00: 6374 2e67 6574 2873 7479 6c65 290a 2020  ct.get(style).  
-0000ef10: 2020 2020 2020 2020 2020 6966 2063 6f6f            if coo
-0000ef20: 7264 3a0a 2020 2020 2020 2020 2020 2020  rd:.            
-0000ef30: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-0000ef40: 2020 2020 2020 2020 2020 2020 2063 6f6f               coo
-0000ef50: 7264 732e 6170 7065 6e64 2866 6c6f 6174  rds.append(float
-0000ef60: 2863 6f6f 7264 5b3a 2d32 5d29 290a 2020  (coord[:-2])).  
-0000ef70: 2020 2020 2020 2020 2020 2020 2020 6578                ex
-0000ef80: 6365 7074 2045 7863 6570 7469 6f6e 3a0a  cept Exception:.
-0000ef90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000efa0: 2020 2020 6c6f 6767 696e 672e 7761 726e      logging.warn
-0000efb0: 696e 6728 6622 6361 6e6e 6f74 2070 6172  ing(f"cannot par
-0000efc0: 7365 207b 636f 6f72 647d 2066 6f72 207b  se {coord} for {
-0000efd0: 7374 796c 657d 2229 0a20 2020 2020 2020  style}").       
-0000efe0: 2069 6620 6e6f 7420 636f 6f72 6473 3a0a   if not coords:.
-0000eff0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0000f000: 726e 204e 6f6e 652c 204e 6f6e 652c 205b  rn None, None, [
-0000f010: 5d0a 2020 2020 2020 2020 6e70 5f63 6f6f  ].        np_coo
-0000f020: 7264 7320 3d20 6e70 2e61 7272 6179 2863  rds = np.array(c
-0000f030: 6f6f 7264 7329 0a0a 2020 2020 2020 2020  oords)..        
-0000f040: 7820 3d20 6e70 2e61 7272 6179 2872 616e  x = np.array(ran
-0000f050: 6765 286e 705f 636f 6f72 6473 2e73 697a  ge(np_coords.siz
-0000f060: 6529 292e 7265 7368 6170 6528 282d 312c  e)).reshape((-1,
-0000f070: 2031 2929 0a20 2020 2020 2020 206d 6f64   1)).        mod
-0000f080: 656c 203d 204c 696e 6561 7252 6567 7265  el = LinearRegre
-0000f090: 7373 696f 6e28 292e 6669 7428 782c 2063  ssion().fit(x, c
-0000f0a0: 6f6f 7264 7329 0a20 2020 2020 2020 2072  oords).        r
-0000f0b0: 5f73 7120 3d20 6d6f 6465 6c2e 7363 6f72  _sq = model.scor
-0000f0c0: 6528 782c 2063 6f6f 7264 7329 0a20 2020  e(x, coords).   
-0000f0d0: 2020 2020 2069 6620 725f 7371 203c 2030       if r_sq < 0
-0000f0e0: 2e39 383a 0a20 2020 2020 2020 2020 2020  .98:.           
-0000f0f0: 206c 6f67 6769 6e67 2e77 6172 6e69 6e67   logging.warning
-0000f100: 2866 2263 616e 6e6f 7420 6361 6c63 756c  (f"cannot calcul
-0000f110: 6174 6520 6f66 6673 6574 2072 656c 6961  ate offset relia
-0000f120: 626c 7922 290a 2020 2020 2020 2020 7265  bly").        re
-0000f130: 7475 726e 206d 6f64 656c 2e69 6e74 6572  turn model.inter
-0000f140: 6365 7074 5f2c 206d 6f64 656c 2e63 6f65  cept_, model.coe
-0000f150: 665f 2c20 6e70 5f63 6f6f 7264 730a 0a20  f_, np_coords.. 
-0000f160: 2020 2040 636c 6173 736d 6574 686f 640a     @classmethod.
-0000f170: 2020 2020 6465 6620 7265 6d6f 7665 5f75      def remove_u
-0000f180: 6e77 616e 7465 6473 2863 6c73 2c20 746f  nwanteds(cls, to
-0000f190: 705f 656c 656d 2c20 756e 7761 6e74 6564  p_elem, unwanted
-0000f1a0: 7329 3a0a 2020 2020 2020 2020 2222 220a  s):.        """.
-0000f1b0: 2020 2020 2020 2020 4d61 7962 6520 6d6f          Maybe mo
-0000f1c0: 7665 2074 6f20 4854 4d4c 5469 6479 0a20  ve to HTMLTidy. 
-0000f1d0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0000f1e0: 2020 2069 6620 6e6f 7420 756e 7761 6e74     if not unwant
-0000f1f0: 6564 733a 0a20 2020 2020 2020 2020 2020  eds:.           
-0000f200: 206c 6f67 6769 6e67 2e77 6172 6e69 6e67   logging.warning
-0000f210: 2866 226e 6f20 756e 7761 6e74 6564 7320  (f"no unwanteds 
-0000f220: 746f 2072 656d 6f76 6522 290a 2020 2020  to remove").    
-0000f230: 2020 2020 2020 2020 7265 7475 726e 0a20          return. 
-0000f240: 2020 2020 2020 2066 6f72 206b 6579 2069         for key i
-0000f250: 6e20 756e 7761 6e74 6564 733a 0a20 2020  n unwanteds:.   
-0000f260: 2020 2020 2020 2020 2075 6e77 616e 7465           unwante
-0000f270: 6420 3d20 756e 7761 6e74 6564 735b 6b65  d = unwanteds[ke
-0000f280: 795d 0a20 2020 2020 2020 2020 2020 2078  y].            x
-0000f290: 7061 7468 203d 2075 6e77 616e 7465 645b  path = unwanted[
-0000f2a0: 555f 5850 4154 485d 0a20 2020 2020 2020  U_XPATH].       
-0000f2b0: 2020 2020 2069 6620 7870 6174 683a 0a20       if xpath:. 
-0000f2c0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0000f2d0: 6567 6578 203d 2075 6e77 616e 7465 645b  egex = unwanted[
-0000f2e0: 555f 5245 4745 585d 0a20 2020 2020 2020  U_REGEX].       
-0000f2f0: 2020 2020 2020 2020 2072 6567 6578 5f63           regex_c
-0000f300: 6f6d 7020 3d20 7265 2e63 6f6d 7069 6c65  omp = re.compile
-0000f310: 2872 6567 6578 2920 6966 2072 6567 6578  (regex) if regex
-0000f320: 2065 6c73 6520 4e6f 6e65 0a20 2020 2020   else None.     
-0000f330: 2020 2020 2020 2020 2020 2065 6c65 6d73             elems
-0000f340: 203d 2074 6f70 5f65 6c65 6d2e 7870 6174   = top_elem.xpat
-0000f350: 6828 7870 6174 6829 0a20 2020 2020 2020  h(xpath).       
-0000f360: 2020 2020 2020 2020 2066 6f72 2065 6c65           for ele
-0000f370: 6d20 696e 2065 6c65 6d73 3a0a 2020 2020  m in elems:.    
-0000f380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f390: 7465 7874 203d 2048 746d 6c55 7469 6c2e  text = HtmlUtil.
-0000f3a0: 6765 745f 7465 7874 5f63 6f6e 7465 6e74  get_text_content
-0000f3b0: 2865 6c65 6d29 0a20 2020 2020 2020 2020  (elem).         
-0000f3c0: 2020 2020 2020 2020 2020 206d 6174 6368             match
-0000f3d0: 6564 203d 2072 6567 6578 5f63 6f6d 702e  ed = regex_comp.
-0000f3e0: 7365 6172 6368 2874 6578 7429 2069 6620  search(text) if 
-0000f3f0: 7265 6765 785f 636f 6d70 2065 6c73 6520  regex_comp else 
-0000f400: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
-0000f410: 2020 2020 2020 2020 2069 6620 6d61 7463           if matc
-0000f420: 6865 643a 0a20 2020 2020 2020 2020 2020  hed:.           
-0000f430: 2020 2020 2020 2020 2020 2020 2063 6c73               cls
-0000f440: 2e72 656d 6f76 655f 656c 656d 5f6b 6565  .remove_elem_kee
-0000f450: 705f 7461 696c 2865 6c65 6d29 0a0a 2020  p_tail(elem)..  
-0000f460: 2020 4063 6c61 7373 6d65 7468 6f64 0a20    @classmethod. 
-0000f470: 2020 2064 6566 2072 656d 6f76 655f 6e65     def remove_ne
-0000f480: 776c 696e 6573 2863 6c73 2c20 656c 656d  wlines(cls, elem
-0000f490: 293a 0a20 2020 2020 2020 2022 2222 7265  ):.        """re
-0000f4a0: 6d6f 7665 205c 6e22 2222 0a20 2020 2020  move \n""".     
-0000f4b0: 2020 2022 2222 0a20 2020 2020 2020 204d     """.        M
-0000f4c0: 6179 6265 206d 6f76 6520 746f 2048 544d  aybe move to HTM
-0000f4d0: 4c54 6964 790a 2020 2020 2020 2020 2222  LTidy.        ""
-0000f4e0: 220a 0a20 2020 2020 2020 2066 6f72 2065  "..        for e
-0000f4f0: 6c20 696e 2065 6c65 6d2e 7870 6174 6828  l in elem.xpath(
-0000f500: 222e 2f2f 2a5b 6e6f 7428 2a29 5d22 293a  ".//*[not(*)]"):
-0000f510: 0a20 2020 2020 2020 2020 2020 2074 6578  .            tex
-0000f520: 7420 3d20 4874 6d6c 5574 696c 2e67 6574  t = HtmlUtil.get
-0000f530: 5f74 6578 745f 636f 6e74 656e 7428 656c  _text_content(el
-0000f540: 290a 2020 2020 2020 2020 2020 2020 7465  ).            te
-0000f550: 7874 3120 3d20 7465 7874 2e72 6570 6c61  xt1 = text.repla
-0000f560: 6365 2827 5c6e 272c 2027 2729 0a20 2020  ce('\n', '').   
-0000f570: 2020 2020 2020 2020 2069 6620 7465 7874           if text
-0000f580: 3120 213d 2074 6578 743a 0a20 2020 2020  1 != text:.     
-0000f590: 2020 2020 2020 2020 2020 2065 6c2e 7465             el.te
-0000f5a0: 7874 203d 2074 6578 7431 0a0a 2020 2020  xt = text1..    
-0000f5b0: 4063 6c61 7373 6d65 7468 6f64 0a20 2020  @classmethod.   
-0000f5c0: 2064 6566 2072 656d 6f76 655f 7374 796c   def remove_styl
-0000f5d0: 6528 636c 732c 2078 7061 7468 5f72 6f6f  e(cls, xpath_roo
-0000f5e0: 745f 656c 656d 2c20 6e61 6d65 7329 3a0a  t_elem, names):.
-0000f5f0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0000f600: 2020 2020 7265 6d6f 7665 7320 6e61 6d65      removes name
-0000f610: 2d76 616c 7565 2070 6169 7273 2066 726f  -value pairs fro
-0000f620: 6d20 6373 732d 7374 796c 6520 616e 6420  m css-style and 
-0000f630: 7265 6170 706c 7920 746f 2078 7061 7468  reapply to xpath
-0000f640: 2765 6420 656c 656d 656e 7473 2222 220a  'ed elements""".
-0000f650: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0000f660: 2020 2020 4d61 7962 6520 6d6f 7665 2074      Maybe move t
-0000f670: 6f20 4854 4d4c 5469 6479 0a20 2020 2020  o HTMLTidy.     
-0000f680: 2020 2022 2222 0a0a 2020 2020 2020 2020     """..        
-0000f690: 7870 6174 6820 3d20 6622 2e2f 2f2a 5b40  xpath = f".//*[@
-0000f6a0: 7374 796c 655d 220a 2020 2020 2020 2020  style]".        
-0000f6b0: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
-0000f6c0: 2073 7479 6c65 645f 656c 656d 7320 3d20   styled_elems = 
-0000f6d0: 7870 6174 685f 726f 6f74 5f65 6c65 6d2e  xpath_root_elem.
-0000f6e0: 7870 6174 6828 7870 6174 6829 0a20 2020  xpath(xpath).   
-0000f6f0: 2020 2020 2065 7863 6570 7420 4554 2e58       except ET.X
-0000f700: 5061 7468 4576 616c 4572 726f 7220 6173  PathEvalError as
-0000f710: 2078 7065 653a 0a20 2020 2020 2020 2020   xpee:.         
-0000f720: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
-0000f730: 726f 7228 6622 4261 6420 7870 6174 6820  ror(f"Bad xpath 
-0000f740: 7b78 7061 7468 7d22 290a 0a20 2020 2020  {xpath}")..     
-0000f750: 2020 2066 6f72 2073 7479 6c65 645f 656c     for styled_el
-0000f760: 656d 2069 6e20 7374 796c 6564 5f65 6c65  em in styled_ele
-0000f770: 6d73 3a0a 2020 2020 2020 2020 2020 2020  ms:.            
-0000f780: 6373 735f 7374 796c 6520 3d20 4353 5353  css_style = CSSS
-0000f790: 7479 6c65 2e63 7265 6174 655f 6373 735f  tyle.create_css_
-0000f7a0: 7374 796c 655f 6672 6f6d 5f61 7474 7269  style_from_attri
-0000f7b0: 6275 7465 5f6f 665f 626f 6479 5f65 6c65  bute_of_body_ele
-0000f7c0: 6d65 6e74 2873 7479 6c65 645f 656c 656d  ment(styled_elem
-0000f7d0: 290a 2020 2020 2020 2020 2020 2020 6373  ).            cs
-0000f7e0: 735f 7374 796c 652e 7265 6d6f 7665 286e  s_style.remove(n
-0000f7f0: 616d 6573 290a 2020 2020 2020 2020 2020  ames).          
-0000f800: 2020 6373 735f 7374 796c 652e 6170 706c    css_style.appl
-0000f810: 795f 746f 2873 7479 6c65 645f 656c 656d  y_to(styled_elem
-0000f820: 290a 2020 2020 2020 2020 2020 2020 7374  ).            st
-0000f830: 796c 6520 3d20 4874 6d6c 5374 796c 652e  yle = HtmlStyle.
-0000f840: 6765 745f 6373 7373 7479 6c65 5f73 7472  get_cssstyle_str
-0000f850: 696e 6728 7374 796c 6564 5f65 6c65 6d29  ing(styled_elem)
-0000f860: 0a0a 2020 2020 4063 6c61 7373 6d65 7468  ..    @classmeth
-0000f870: 6f64 0a20 2020 2064 6566 2065 7874 7261  od.    def extra
-0000f880: 6374 5f73 7562 7374 7269 6e67 7328 636c  ct_substrings(cl
-0000f890: 732c 2065 6c65 6d2c 2078 7061 7468 3d4e  s, elem, xpath=N
-0000f8a0: 6f6e 652c 2072 6567 6578 3d4e 6f6e 652c  one, regex=None,
-0000f8b0: 2072 656d 6f76 653d 4661 6c73 652c 2069   remove=False, i
-0000f8c0: 6e63 6c75 6465 5f6e 6f6e 653d 4661 6c73  nclude_none=Fals
-0000f8d0: 652c 2061 6464 5f69 643d 4661 6c73 6529  e, add_id=False)
-0000f8e0: 3a0a 2020 2020 2020 2020 2222 2267 6574  :.        """get
-0000f8f0: 7320 7375 6273 7472 696e 6720 6672 6f6d  s substring from
-0000f900: 2062 6f64 7920 6f66 2074 6578 7420 696e   body of text in
-0000f910: 2065 6c65 6d0a 2020 2020 2020 2020 7265   elem.        re
-0000f920: 6765 7820 6f66 2066 6f72 6d20 283f 503c  gex of form (?P<
-0000f930: 7072 653e 2928 3f50 3c62 6f64 793e 2928  pre>)(?P<body>)(
-0000f940: 3f50 3c70 6f73 743e 290a 2020 2020 2020  ?P<post>).      
-0000f950: 2020 7072 6520 616e 6420 6f72 2070 6f73    pre and or pos
-0000f960: 7420 6361 6e20 6265 206d 6973 7369 6e67  t can be missing
-0000f970: 0a20 2020 2020 2020 2028 5468 6572 6520  .        (There 
-0000f980: 7769 6c6c 2062 6520 6265 7474 6572 2077  will be better w
-0000f990: 6179 7320 6f66 2064 6f69 6e67 2074 6869  ays of doing thi
-0000f9a0: 7321 290a 2020 2020 2020 2020 3a70 6172  s!).        :par
-0000f9b0: 616d 2065 6c65 6d3a 746f 2071 7565 7279  am elem:to query
-0000f9c0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-0000f9d0: 7870 6174 683a 2074 6f20 6669 6e64 2064  xpath: to find d
-0000f9e0: 6573 6365 6e64 616e 7420 7375 6265 6c65  escendant subele
-0000f9f0: 6d65 6e74 0a20 2020 2020 2020 203a 7061  ment.        :pa
-0000fa00: 7261 6d20 7265 6765 783a 2074 6f20 6669  ram regex: to fi
-0000fa10: 6e64 2073 7472 696e 6720 696e 2073 7562  nd string in sub
-0000fa20: 656c 656d 656e 7420 286d 7573 7420 6861  element (must ha
-0000fa30: 7665 2033 2063 6170 7475 7265 2067 726f  ve 3 capture gro
-0000fa40: 7570 7329 0a20 2020 2020 2020 203a 7061  ups).        :pa
-0000fa50: 7261 6d20 7265 6d6f 7665 3a20 7265 6d6f  ram remove: remo
-0000fa60: 7665 7320 626f 6479 2074 6578 7420 616e  ves body text an
-0000fa70: 6420 6a6f 696e 7320 7072 6520 746f 2070  d joins pre to p
-0000fa80: 6f73 7420 2875 7365 2077 6974 6820 6361  ost (use with ca
-0000fa90: 7265 2c20 6465 6661 756c 7420 4661 6c73  re, default Fals
-0000faa0: 6529 0a20 2020 2020 2020 203a 7061 7261  e).        :para
-0000fab0: 6d20 696e 636c 7564 655f 6e6f 6e65 3a20  m include_none: 
-0000fac0: 4966 2074 7275 6520 696e 636c 7564 6520  If true include 
-0000fad0: 6661 696c 6564 206d 6174 6368 6573 2061  failed matches a
-0000fae0: 7320 4e6f 6e65 3b20 6465 6661 756c 7420  s None; default 
-0000faf0: 4661 6c73 650a 2020 2020 2020 2020 3a70  False.        :p
-0000fb00: 6172 616d 5f61 6464 5f69 643a 2061 6464  aram_add_id: add
-0000fb10: 2065 7874 7261 6374 6564 2074 6578 7420   extracted text 
-0000fb20: 6173 2061 7474 7269 6275 7465 206f 6e20  as attribute on 
-0000fb30: 7375 6265 6c65 6d65 6e74 0a20 2020 2020  subelement.     
-0000fb40: 2020 2069 6620 7072 6520 616e 6420 7461     if pre and ta
-0000fb50: 696c 2061 7265 2070 7265 7365 6e74 2c20  il are present, 
-0000fb60: 656c 656d 2e74 6578 7420 3d3c 2070 7265  elem.text =< pre
-0000fb70: 2b70 6f73 740a 2020 2020 2020 2020 6966  +post.        if
-0000fb80: 2070 7265 2069 7320 6d69 7373 696e 6720   pre is missing 
-0000fb90: 656c 656d 2e74 6578 7420 3d3e 2070 6f73  elem.text => pos
-0000fba0: 740a 2020 2020 2020 2020 6966 2074 6169  t.        if tai
-0000fbb0: 6c20 6973 206d 6973 7369 6e67 2065 6c65  l is missing ele
-0000fbc0: 6d2e 7465 7874 203d 3e20 7072 650a 2020  m.text => pre.  
-0000fbd0: 2020 2020 2020 6966 2062 6f74 6820 6172        if both ar
-0000fbe0: 6520 6d69 7373 696e 6720 6e6f 2072 656d  e missing no rem
-0000fbf0: 6f76 616c 0a20 2020 2020 2020 203a 7265  oval.        :re
-0000fc00: 7475 726e 3a20 7265 6765 782e 6d61 7463  turn: regex.matc
-0000fc10: 682e 6772 6f75 7069 6e64 6578 283f 503c  h.groupindex(?P<
-0000fc20: 626f 6479 3e29 2069 6620 6d61 7463 6865  body>) if matche
-0000fc30: 6420 656c 7365 204e 6f6e 650a 2020 2020  d else None.    
-0000fc40: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0000fc50: 7375 625f 656c 656d 7320 3d20 656c 656d  sub_elems = elem
-0000fc60: 2e78 7061 7468 2878 7061 7468 290a 2020  .xpath(xpath).  
-0000fc70: 2020 2020 2020 7375 625f 656c 656d 203d        sub_elem =
-0000fc80: 2073 7562 5f65 6c65 6d73 5b30 5d20 6966   sub_elems[0] if
-0000fc90: 206c 656e 2873 7562 5f65 6c65 6d73 2920   len(sub_elems) 
-0000fca0: 3e20 3020 656c 7365 204e 6f6e 650a 2020  > 0 else None.  
-0000fcb0: 2020 2020 2020 7375 6273 7472 696e 6773        substrings
-0000fcc0: 203d 205b 5d0a 2020 2020 2020 2020 7265   = [].        re
-0000fcd0: 3020 3d20 7265 2e63 6f6d 7069 6c65 2872  0 = re.compile(r
-0000fce0: 6567 6578 290a 2020 2020 2020 2020 666f  egex).        fo
-0000fcf0: 7220 7375 625f 656c 656d 2069 6e20 7375  r sub_elem in su
-0000fd00: 625f 656c 656d 733a 0a20 2020 2020 2020  b_elems:.       
-0000fd10: 2020 2020 2073 7562 7374 7269 6e67 203d       substring =
-0000fd20: 2063 6c73 2e65 7874 7261 6374 5f73 7562   cls.extract_sub
-0000fd30: 7374 7269 6e67 2872 6530 2c20 7265 6d6f  string(re0, remo
-0000fd40: 7665 2c20 7375 625f 656c 656d 290a 2020  ve, sub_elem).  
-0000fd50: 2020 2020 2020 2020 2020 6966 2073 7562            if sub
-0000fd60: 7374 7269 6e67 2061 6e64 2061 6464 5f69  string and add_i
-0000fd70: 643a 0a20 2020 2020 2020 2020 2020 2020  d:.             
-0000fd80: 2020 2073 7562 5f65 6c65 6d2e 6174 7472     sub_elem.attr
-0000fd90: 6962 5b22 6964 225d 203d 2073 7562 7374  ib["id"] = subst
-0000fda0: 7269 6e67 0a20 2020 2020 2020 2020 2020  ring.           
-0000fdb0: 2069 6620 7375 6273 7472 696e 6720 6f72   if substring or
-0000fdc0: 2069 6e63 6c75 6465 5f6e 6f6e 653a 0a20   include_none:. 
-0000fdd0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0000fde0: 7562 7374 7269 6e67 732e 6170 7065 6e64  ubstrings.append
-0000fdf0: 2873 7562 7374 7269 6e67 290a 2020 2020  (substring).    
-0000fe00: 2020 2020 7265 7475 726e 2073 7562 7374      return subst
-0000fe10: 7269 6e67 730a 0a20 2020 2040 636c 6173  rings..    @clas
-0000fe20: 736d 6574 686f 640a 2020 2020 6465 6620  smethod.    def 
-0000fe30: 6578 7472 6163 745f 7375 6273 7472 696e  extract_substrin
-0000fe40: 6728 636c 732c 2072 6530 2c20 7265 6d6f  g(cls, re0, remo
-0000fe50: 7665 2c20 7375 625f 656c 656d 293a 0a20  ve, sub_elem):. 
-0000fe60: 2020 2020 2020 206d 6174 6368 203d 2072         match = r
-0000fe70: 6530 2e6d 6174 6368 2873 7562 5f65 6c65  e0.match(sub_ele
-0000fe80: 6d2e 7465 7874 290a 2020 2020 2020 2020  m.text).        
-0000fe90: 7375 6273 7472 696e 6720 3d20 4e6f 6e65  substring = None
-0000fea0: 0a20 2020 2020 2020 2069 6620 6d61 7463  .        if matc
-0000feb0: 683a 0a20 2020 2020 2020 2020 2020 2073  h:.            s
-0000fec0: 7562 7374 7269 6e67 203d 206d 6174 6368  ubstring = match
-0000fed0: 2e67 726f 7570 2822 626f 6479 2229 0a20  .group("body"). 
-0000fee0: 2020 2020 2020 2020 2020 2069 6620 7265             if re
-0000fef0: 6d6f 7665 3a0a 2020 2020 2020 2020 2020  move:.          
-0000ff00: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-0000ff10: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0000ff20: 7265 203d 206d 6174 6368 2e67 726f 7570  re = match.group
-0000ff30: 2822 7072 6522 290a 2020 2020 2020 2020  ("pre").        
-0000ff40: 2020 2020 2020 2020 2020 2020 706f 7374              post
-0000ff50: 203d 206d 6174 6368 2e67 726f 7570 2822   = match.group("
-0000ff60: 706f 7374 2229 0a20 2020 2020 2020 2020  post").         
-0000ff70: 2020 2020 2020 2020 2020 2073 7562 5f65             sub_e
-0000ff80: 6c65 6d2e 7465 7874 203d 2070 7265 202b  lem.text = pre +
-0000ff90: 2070 6f73 740a 2020 2020 2020 2020 2020   post.          
-0000ffa0: 2020 2020 2020 6578 6365 7074 3a0a 2020        except:.  
-0000ffb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ffc0: 2020 7061 7373 0a20 2020 2020 2020 2072    pass.        r
-0000ffd0: 6574 7572 6e20 7375 6273 7472 696e 670a  eturn substring.
-0000ffe0: 0a20 2020 2040 636c 6173 736d 6574 686f  .    @classmetho
-0000fff0: 640a 2020 2020 6465 6620 6765 745f 666c  d.    def get_fl
-00010000: 6f61 7428 636c 732c 2065 6c65 6d2c 2061  oat(cls, elem, a
-00010010: 7474 7269 625f 6e61 6d65 293a 0a20 2020  ttrib_name):.   
-00010020: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
-00010030: 2020 2020 2020 7661 6c20 3d20 656c 656d        val = elem
-00010040: 2e61 7474 7269 625b 6174 7472 6962 5f6e  .attrib[attrib_n
-00010050: 616d 655d 0a20 2020 2020 2020 2020 2020  ame].           
-00010060: 2072 6574 7572 6e20 666c 6f61 7428 7661   return float(va
-00010070: 6c29 0a20 2020 2020 2020 2065 7863 6570  l).        excep
-00010080: 7420 4578 6365 7074 696f 6e20 6173 2065  t Exception as e
-00010090: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-000100a0: 7475 726e 204e 6f6e 650a 0a20 2020 2040  turn None..    @
-000100b0: 636c 6173 736d 6574 686f 640a 2020 2020  classmethod.    
-000100c0: 6465 6620 6368 6563 6b5f 7461 6728 636c  def check_tag(cl
-000100d0: 732c 2065 6c65 6d2c 2074 6167 293a 0a20  s, elem, tag):. 
-000100e0: 2020 2020 2020 2022 2222 6368 6563 6b73         """checks
-000100f0: 2074 6861 7420 656c 656d 2069 7320 616e   that elem is an
-00010100: 2045 6c65 6d65 6e74 2077 6974 6820 6769   Element with gi
-00010110: 7665 6e20 7461 6722 2222 0a20 2020 2020  ven tag""".     
-00010120: 2020 2072 6574 7572 6e20 7479 7065 2865     return type(e
-00010130: 6c65 6d29 2069 7320 4554 2e5f 456c 656d  lem) is ET._Elem
-00010140: 656e 7420 616e 6420 656c 656d 2e74 6167  ent and elem.tag
-00010150: 203d 3d20 7461 670a 0a20 2020 2040 636c   == tag..    @cl
-00010160: 6173 736d 6574 686f 640a 2020 2020 6465  assmethod.    de
-00010170: 6620 6765 745f 6964 2863 6c73 2c20 6469  f get_id(cls, di
-00010180: 7629 3a0a 2020 2020 2020 2020 2222 2267  v):.        """g
-00010190: 6574 7320 7661 6c75 6520 6f66 2022 6964  ets value of "id
-000101a0: 2220 6174 7472 6962 7574 650a 2020 2020  " attribute.    
-000101b0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-000101c0: 7265 7475 726e 204e 6f6e 6520 6966 2064  return None if d
-000101d0: 6976 2069 7320 4e6f 6e65 2065 6c73 6520  iv is None else 
-000101e0: 6469 762e 6174 7472 6962 2e67 6574 2822  div.attrib.get("
-000101f0: 6964 2229 0a0a 2020 2020 4063 6c61 7373  id")..    @class
-00010200: 6d65 7468 6f64 0a20 2020 2064 6566 2061  method.    def a
-00010210: 6e61 6c79 7a65 5f73 7479 6c65 7328 636c  nalyze_styles(cl
-00010220: 732c 2065 6c65 6d29 3a0a 2020 2020 2020  s, elem):.      
-00010230: 2020 6865 6164 5f73 7479 6c65 5f65 6c65    head_style_ele
-00010240: 6d73 203d 2048 746d 6c53 7479 6c65 2e67  ms = HtmlStyle.g
-00010250: 6574 5f68 6561 645f 7374 796c 6573 2865  et_head_styles(e
-00010260: 6c65 6d29 0a20 2020 2020 2020 2070 7269  lem).        pri
-00010270: 6e74 2866 2268 6561 6420 7374 796c 6520  nt(f"head style 
-00010280: 656c 656d 7320 7b6c 656e 2868 6561 645f  elems {len(head_
-00010290: 7374 796c 655f 656c 656d 7329 7d22 290a  style_elems)}").
-000102a0: 2020 2020 2020 2020 626f 6479 5f63 6c61          body_cla
-000102b0: 7373 7265 6673 203d 2048 746d 6c53 7479  ssrefs = HtmlSty
-000102c0: 6c65 2e67 6574 5f62 6f64 795f 636c 6173  le.get_body_clas
-000102d0: 7372 6566 7328 656c 656d 290a 2020 2020  srefs(elem).    
-000102e0: 2020 2020 7072 696e 7428 6622 626f 6479      print(f"body
-000102f0: 2063 6c61 7373 7265 6673 207b 6c65 6e28   classrefs {len(
-00010300: 626f 6479 5f63 6c61 7373 7265 6673 297d  body_classrefs)}
-00010310: 2229 0a20 2020 2020 2020 2066 6f6e 745f  ").        font_
-00010320: 7369 7a65 5f64 6963 7420 3d20 6465 6661  size_dict = defa
-00010330: 756c 7464 6963 7428 6c69 7374 290a 2020  ultdict(list).  
-00010340: 2020 2020 2020 6661 6d69 6c79 5f64 6963        family_dic
-00010350: 7420 3d20 6465 6661 756c 7464 6963 7428  t = defaultdict(
-00010360: 6c69 7374 290a 2020 2020 2020 2020 666f  list).        fo
-00010370: 7220 6865 6164 5f73 7479 6c65 5f65 6c65  r head_style_ele
-00010380: 6d20 696e 2068 6561 645f 7374 796c 655f  m in head_style_
-00010390: 656c 656d 733a 0a20 2020 2020 2020 2020  elems:.         
-000103a0: 2020 2068 6561 645f 7374 796c 652c 2063     head_style, c
-000103b0: 7373 7374 7220 3d20 4874 6d6c 5374 796c  ssstr = HtmlStyl
-000103c0: 652e 6578 7472 6163 745f 636c 6173 7372  e.extract_classr
-000103d0: 6566 5f61 6e64 5f63 7373 7374 7269 6e67  ef_and_cssstring
-000103e0: 5f66 726f 6d5f 6874 6d6c 5f73 7479 6c65  _from_html_style
-000103f0: 2868 6561 645f 7374 796c 655f 656c 656d  (head_style_elem
-00010400: 290a 2020 2020 2020 2020 2020 2020 6373  ).            cs
-00010410: 735f 7374 796c 6520 3d20 4353 5353 7479  s_style = CSSSty
-00010420: 6c65 2e63 7265 6174 655f 6373 735f 7374  le.create_css_st
-00010430: 796c 655f 6672 6f6d 5f63 7373 5f73 7472  yle_from_css_str
-00010440: 696e 6728 6373 7373 7472 290a 2020 2020  ing(cssstr).    
-00010450: 2020 2020 2020 2020 666f 6e74 5f73 697a          font_siz
-00010460: 6520 3d20 6373 735f 7374 796c 652e 666f  e = css_style.fo
-00010470: 6e74 5f73 697a 650a 2020 2020 2020 2020  nt_size.        
-00010480: 2020 2020 666f 6e74 5f73 697a 655f 6469      font_size_di
-00010490: 6374 5b73 7472 2866 6f6e 745f 7369 7a65  ct[str(font_size
-000104a0: 295d 2e61 7070 656e 6428 6373 7373 7472  )].append(cssstr
-000104b0: 290a 2020 2020 2020 2020 2020 2020 666f  ).            fo
-000104c0: 6e74 5f66 616d 696c 7920 3d20 6373 735f  nt_family = css_
-000104d0: 7374 796c 652e 666f 6e74 5f66 616d 696c  style.font_famil
-000104e0: 790a 2020 2020 2020 2020 2020 2020 6661  y.            fa
-000104f0: 6d69 6c79 5f64 6963 745b 666f 6e74 5f66  mily_dict[font_f
-00010500: 616d 696c 795d 2e61 7070 656e 6428 6373  amily].append(cs
-00010510: 7373 7472 290a 0a20 2020 2020 2020 2020  sstr)..         
-00010520: 2020 2062 6f64 795f 656c 656d 7320 3d20     body_elems = 
-00010530: 636c 732e 6765 745f 626f 6479 5f65 6c65  cls.get_body_ele
-00010540: 6d65 6e74 735f 6279 5f63 6c61 7373 2865  ments_by_class(e
-00010550: 6c65 6d2c 2068 6561 645f 7374 796c 6529  lem, head_style)
-00010560: 0a20 2020 2020 2020 2020 2020 2062 6f64  .            bod
-00010570: 795f 656c 656d 735f 7374 7220 3d20 275c  y_elems_str = '\
-00010580: 6e20 2020 2020 272e 6a6f 696e 285b 656c  n     '.join([el
-00010590: 656d 2e74 6578 7420 666f 7220 656c 656d  em.text for elem
-000105a0: 2069 6e20 626f 6479 5f65 6c65 6d73 5b3a   in body_elems[:
-000105b0: 335d 5d29 0a20 2020 2020 2020 2020 2020  3]]).           
-000105c0: 2070 7269 6e74 2866 227b 6865 6164 5f73   print(f"{head_s
-000105d0: 7479 6c65 7d3a 207b 6c65 6e28 626f 6479  tyle}: {len(body
-000105e0: 5f65 6c65 6d73 297d 207b 6373 7373 7472  _elems)} {cssstr
-000105f0: 7d5c 6e20 2020 2020 7b62 6f64 795f 656c  }\n     {body_el
-00010600: 656d 735f 7374 727d 2229 0a20 2020 2020  ems_str}").     
-00010610: 2020 2070 7072 696e 7428 6622 7369 7a65     pprint(f"size
-00010620: 207b 666f 6e74 5f73 697a 655f 6469 6374   {font_size_dict
-00010630: 7d22 290a 2020 2020 2020 2020 7072 696e  }").        prin
-00010640: 7428 290a 2020 2020 2020 2020 666f 7220  t().        for 
-00010650: 7369 7a65 2069 6e20 666f 6e74 5f73 697a  size in font_siz
-00010660: 655f 6469 6374 3a0a 2020 2020 2020 2020  e_dict:.        
-00010670: 2020 2020 666f 6e74 7320 3d20 666f 6e74      fonts = font
-00010680: 5f73 697a 655f 6469 6374 5b73 697a 655d  _size_dict[size]
-00010690: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-000106a0: 7479 7065 2866 6f6e 7473 2920 6973 206c  type(fonts) is l
-000106b0: 6973 743a 0a20 2020 2020 2020 2020 2020  ist:.           
-000106c0: 2020 2020 2070 7269 6e74 2866 2273 697a       print(f"siz
-000106d0: 6520 7b6c 656e 2866 6f6e 7473 297d 2022  e {len(fonts)} "
-000106e0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000106f0: 2020 666f 6e74 737a 203d 2027 5c6e 272e    fontsz = '\n'.
-00010700: 6a6f 696e 2866 6f6e 7473 290a 2020 2020  join(fonts).    
-00010710: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00010720: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-00010730: 6e74 737a 203d 2066 6f6e 7473 0a20 2020  ntsz = fonts.   
-00010740: 2020 2020 2020 2020 2070 7269 6e74 2866           print(f
-00010750: 2220 207b 7369 7a65 7d20 3d3e 2020 7b66  "  {size} =>  {f
-00010760: 6f6e 7473 7a7d 2229 0a20 2020 2020 2020  ontsz}").       
-00010770: 2070 7269 6e74 2829 0a20 2020 2020 2020   print().       
-00010780: 2070 7072 696e 7428 6622 6661 6d69 6c79   pprint(f"family
-00010790: 207b 6661 6d69 6c79 5f64 6963 747d 2229   {family_dict}")
-000107a0: 0a0a 2020 2020 4063 6c61 7373 6d65 7468  ..    @classmeth
-000107b0: 6f64 0a20 2020 2064 6566 2061 6e61 6c79  od.    def analy
-000107c0: 7a65 5f63 6f6f 7264 696e 6174 6573 2863  ze_coordinates(c
-000107d0: 6c73 2c20 656c 656d 293a 0a20 2020 2020  ls, elem):.     
-000107e0: 2020 2023 2068 6561 645f 7374 796c 655f     # head_style_
-000107f0: 656c 656d 7320 3d20 4874 6d6c 5374 796c  elems = HtmlStyl
-00010800: 652e 6765 745f 6865 6164 5f73 7479 6c65  e.get_head_style
-00010810: 7328 656c 656d 290a 2020 2020 2020 2020  s(elem).        
-00010820: 2320 7072 696e 7428 6622 6865 6164 2073  # print(f"head s
-00010830: 7479 6c65 2065 6c65 6d73 207b 6c65 6e28  tyle elems {len(
-00010840: 6865 6164 5f73 7479 6c65 5f65 6c65 6d73  head_style_elems
-00010850: 297d 2229 0a20 2020 2020 2020 2023 2062  )}").        # b
-00010860: 6f64 795f 7374 796c 6573 203d 2048 746d  ody_styles = Htm
-00010870: 6c53 7479 6c65 2e67 6574 5f62 6f64 795f  lStyle.get_body_
-00010880: 636c 6173 7372 6566 7328 656c 656d 290a  classrefs(elem).
-00010890: 2020 2020 2020 2020 2320 7072 696e 7428          # print(
-000108a0: 6622 626f 6479 2073 7479 6c65 7320 7b6c  f"body styles {l
-000108b0: 656e 2862 6f64 795f 7374 796c 6573 297d  en(body_styles)}
-000108c0: 2229 0a20 2020 2020 2020 206d 6178 6368  ").        maxch
-000108d0: 6172 203d 2035 300a 0a20 2020 2020 2020  ar = 50..       
-000108e0: 2063 6c73 2e67 6574 5f6c 7274 6228 656c   cls.get_lrtb(el
-000108f0: 656d 2c20 226c 6566 7422 290a 2020 2020  em, "left").    
-00010900: 2020 2020 636c 732e 6765 745f 6c72 7462      cls.get_lrtb
-00010910: 2865 6c65 6d2c 2022 7269 6768 7422 290a  (elem, "right").
-00010920: 2020 2020 2020 2020 636c 732e 6765 745f          cls.get_
-00010930: 6c72 7462 2865 6c65 6d2c 2022 7930 222c  lrtb(elem, "y0",
-00010940: 2063 6f6c 3d30 290a 2020 2020 2020 2020   col=0).        
-00010950: 636c 732e 6765 745f 6c72 7462 2865 6c65  cls.get_lrtb(ele
-00010960: 6d2c 2022 746f 7022 2c20 6d61 7267 696e  m, "top", margin
-00010970: 3d38 3029 0a0a 2020 2020 4063 6c61 7373  =80)..    @class
-00010980: 6d65 7468 6f64 0a20 2020 2064 6566 2067  method.    def g
-00010990: 6574 5f6c 7274 6228 636c 732c 2065 6c65  et_lrtb(cls, ele
-000109a0: 6d2c 2064 6972 6563 7469 6f6e 2c20 6d61  m, direction, ma
-000109b0: 7863 6861 723d 3530 2c20 6d69 6e5f 636f  xchar=50, min_co
-000109c0: 756e 743d 3130 2c20 6d61 785f 7465 7874  unt=10, max_text
-000109d0: 733d 332c 206d 6172 6769 6e3d 3830 2c20  s=3, margin=80, 
-000109e0: 6d65 6469 6162 6f78 3d5b 5b30 2c31 3030  mediabox=[[0,100
-000109f0: 305d 2c20 5b30 2c31 3030 305d 5d2c 2063  0], [0,1000]], c
-00010a00: 6f6c 3d31 2029 3a0a 2020 2020 2020 2020  ol=1 ):.        
-00010a10: 656c 656d 7320 3d20 4874 6d6c 4c69 622e  elems = HtmlLib.
-00010a20: 6765 745f 626f 6479 2865 6c65 6d29 2e78  get_body(elem).x
-00010a30: 7061 7468 2866 222e 2f2f 2a5b 407b 6469  path(f".//*[@{di
-00010a40: 7265 6374 696f 6e7d 5d22 290a 2020 2020  rection}]").    
-00010a50: 2020 2020 6469 6374 7820 3d20 6465 6661      dictx = defa
-00010a60: 756c 7464 6963 7428 6c69 7374 290a 2020  ultdict(list).  
-00010a70: 2020 2020 2020 666f 7220 656c 656d 2069        for elem i
-00010a80: 6e20 656c 656d 733a 0a20 2020 2020 2020  n elems:.       
-00010a90: 2020 2020 206c 6566 7420 3d20 4874 6d6c       left = Html
-00010aa0: 5574 696c 2e67 6574 5f66 6c6f 6174 2865  Util.get_float(e
-00010ab0: 6c65 6d2c 2064 6972 6563 7469 6f6e 290a  lem, direction).
-00010ac0: 2020 2020 2020 2020 2020 2020 6966 206c              if l
-00010ad0: 6566 743a 0a20 2020 2020 2020 2020 2020  eft:.           
-00010ae0: 2020 2020 2064 6963 7478 5b6c 6566 745d       dictx[left]
-00010af0: 2e61 7070 656e 6428 656c 656d 290a 2020  .append(elem).  
-00010b00: 2020 2020 2020 7072 696e 7428 6622 5c6e        print(f"\n
-00010b10: 7b64 6972 6563 7469 6f6e 7d22 290a 2020  {direction}").  
-00010b20: 2020 2020 2020 726f 7773 203d 205b 5d0a        rows = [].
-00010b30: 2020 2020 2020 2020 666f 7220 6b65 7920          for key 
-00010b40: 696e 2064 6963 7478 2e6b 6579 7328 293a  in dictx.keys():
-00010b50: 0a20 2020 2020 2020 2020 2020 2065 6c65  .            ele
-00010b60: 6d73 203d 2064 6963 7478 5b6b 6579 5d0a  ms = dictx[key].
-00010b70: 2020 2020 2020 2020 2020 2020 7465 7874              text
-00010b80: 7320 3d20 5b65 6c65 6d2e 7870 6174 6828  s = [elem.xpath(
-00010b90: 222e 2f2f 7465 7874 2829 2229 5b30 5d5b  ".//text()")[0][
-00010ba0: 3a6d 6178 6368 6172 5d20 666f 7220 656c  :maxchar] for el
-00010bb0: 656d 2069 6e20 656c 656d 735d 0a20 2020  em in elems].   
-00010bc0: 2020 2020 2020 2020 2065 6c65 6d63 6f75           elemcou
-00010bd0: 6e74 203d 206c 656e 2865 6c65 6d73 290a  nt = len(elems).
-00010be0: 2020 2020 2020 2020 2020 2020 6966 2065              if e
-00010bf0: 6c65 6d63 6f75 6e74 203e 206d 696e 5f63  lemcount > min_c
-00010c00: 6f75 6e74 3a0a 2020 2020 2020 2020 2020  ount:.          
-00010c10: 2020 2020 2020 7465 7874 735f 203d 2074        texts_ = t
-00010c20: 6578 7473 5b3a 6d61 785f 7465 7874 735d  exts[:max_texts]
-00010c30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010c40: 2070 7269 6e74 2866 227b 6b65 797d 3a20   print(f"{key}: 
-00010c50: 7b65 6c65 6d63 6f75 6e74 7d20 7b74 6578  {elemcount} {tex
-00010c60: 7473 5f7d 2229 0a20 2020 2020 2020 2020  ts_}").         
-00010c70: 2020 2020 2020 2072 6f77 732e 6170 7065         rows.appe
-00010c80: 6e64 285b 6b65 792c 2065 6c65 6d63 6f75  nd([key, elemcou
-00010c90: 6e74 2c20 7465 7874 735f 5d29 0a20 2020  nt, texts_]).   
-00010ca0: 2020 2020 2072 6f77 735f 203d 2073 6f72       rows_ = sor
-00010cb0: 7465 6428 726f 7773 2c20 6b65 793d 6c61  ted(rows, key=la
-00010cc0: 6d62 6461 2063 3a20 635b 636f 6c5d 290a  mbda c: c[col]).
-00010cd0: 2020 2020 2020 2020 7072 696e 7428 6622          print(f"
-00010ce0: 726f 7773 5c6e 7b72 6f77 735f 7d22 290a  rows\n{rows_}").
-00010cf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010d00: 2023 2073 6f72 7465 6428 7374 7564 656e   # sorted(studen
-00010d10: 745f 7475 706c 6573 2c20 6b65 793d 6c61  t_tuples, key=la
-00010d20: 6d62 6461 2073 7475 6465 6e74 3a20 7374  mbda student: st
-00010d30: 7564 656e 745b 325d 290a 0a20 2020 2040  udent[2])..    @
-00010d40: 636c 6173 736d 6574 686f 640a 2020 2020  classmethod.    
-00010d50: 6465 6620 6765 745f 626f 6479 5f65 6c65  def get_body_ele
-00010d60: 6d65 6e74 735f 6279 5f63 6c61 7373 2863  ments_by_class(c
-00010d70: 6c73 2c20 656c 656d 2c20 6865 6164 5f73  ls, elem, head_s
-00010d80: 7479 6c65 293a 0a20 2020 2020 2020 2069  tyle):.        i
-00010d90: 6620 6865 6164 5f73 7479 6c65 2e73 7461  f head_style.sta
-00010da0: 7274 7377 6974 6828 272e 2729 3a0a 2020  rtswith('.'):.  
-00010db0: 2020 2020 2020 2020 2020 6865 6164 5f73            head_s
-00010dc0: 7479 6c65 203d 2068 6561 645f 7374 796c  tyle = head_styl
-00010dd0: 655b 313a 5d0a 2020 2020 2020 2020 626f  e[1:].        bo
-00010de0: 6479 5f65 6c65 6d73 203d 2065 6c65 6d2e  dy_elems = elem.
-00010df0: 7870 6174 6828 6622 2e2f 626f 6479 2f2f  xpath(f"./body//
-00010e00: 2a5b 4063 6c61 7373 3d27 7b68 6561 645f  *[@class='{head_
-00010e10: 7374 796c 657d 275d 2229 0a20 2020 2020  style}']").     
-00010e20: 2020 2072 6574 7572 6e20 626f 6479 5f65     return body_e
-00010e30: 6c65 6d73 0a0a 2020 2020 4063 6c61 7373  lems..    @class
-00010e40: 6d65 7468 6f64 0a20 2020 2064 6566 2063  method.    def c
-00010e50: 6c65 616e 5f77 7269 7465 5f68 746d 6c28  lean_write_html(
-00010e60: 636c 732c 2069 6e5f 6874 6d6c 2c20 6f75  cls, in_html, ou
-00010e70: 745f 6874 6d6c 2c20 7072 6574 7479 5f70  t_html, pretty_p
-00010e80: 7269 6e74 3d54 7275 6529 3a0a 2020 2020  rint=True):.    
-00010e90: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00010ea0: 5061 7273 6520 7261 7720 4854 4d4c 2028  Parse raw HTML (
-00010eb0: 6e6f 7420 616c 7761 7973 2077 656c 6c2d  not always well-
-00010ec0: 666f 726d 6564 2920 2c20 6d61 6b65 2077  formed) , make w
-00010ed0: 656c 6c66 6f72 6d65 6420 616e 6420 6f70  ellformed and op
-00010ee0: 7469 6f6e 616c 6c79 2070 7265 7474 7920  tionally pretty 
-00010ef0: 7072 696e 740a 2020 2020 2020 2020 3a70  print.        :p
-00010f00: 6172 616d 2069 6e5f 6874 6d6c 3a20 696e  aram in_html: in
-00010f10: 7075 7420 6874 6d6c 2066 696c 650a 2020  put html file.  
-00010f20: 2020 2020 2020 3a70 6172 616d 206f 7574        :param out
-00010f30: 5f68 746d 6c3a 206f 7574 7075 7420 6669  _html: output fi
-00010f40: 6c65 0a20 2020 2020 2020 203a 7061 7261  le.        :para
-00010f50: 6d20 7072 6574 7479 5f70 7269 6e74 3a20  m pretty_print: 
-00010f60: 6f75 7470 7574 2066 6f72 6d61 740a 2020  output format.  
-00010f70: 2020 2020 2020 3a72 6574 7572 6e3a 2070        :return: p
-00010f80: 6172 7365 6420 6874 6d6c 2065 6c65 6d65  arsed html eleme
-00010f90: 6e74 0a20 2020 2020 2020 2022 2222 0a20  nt.        """. 
-00010fa0: 2020 2020 2020 2068 746d 6c5f 656c 656d         html_elem
-00010fb0: 203d 2063 6c73 2e70 6172 7365 5f68 746d   = cls.parse_htm
-00010fc0: 6c5f 6669 6c65 5f74 6f5f 786d 6c28 696e  l_file_to_xml(in
-00010fd0: 5f68 746d 6c29 0a20 2020 2020 2020 2063  _html).        c
-00010fe0: 6c73 2e77 7269 7465 5f68 746d 6c5f 656c  ls.write_html_el
-00010ff0: 656d 2868 746d 6c5f 656c 656d 2c20 6f75  em(html_elem, ou
-00011000: 745f 6874 6d6c 2c20 7072 6574 7479 5f70  t_html, pretty_p
-00011010: 7269 6e74 3d70 7265 7474 795f 7072 696e  rint=pretty_prin
-00011020: 7429 0a20 2020 2020 2020 2072 6574 7572  t).        retur
-00011030: 6e20 6874 6d6c 5f65 6c65 6d0a 0a20 2020  n html_elem..   
-00011040: 2040 636c 6173 736d 6574 686f 640a 2020   @classmethod.  
-00011050: 2020 6465 6620 7061 7273 655f 6874 6d6c    def parse_html
-00011060: 5f66 696c 655f 746f 5f78 6d6c 2863 6c73  _file_to_xml(cls
-00011070: 2c20 696e 5f68 746d 6c29 3a0a 2020 2020  , in_html):.    
-00011080: 2020 2020 2222 2272 6561 6420 756e 7469      """read unti
-00011090: 6479 2048 544d 4c20 696e 746f 2058 4d4c  dy HTML into XML
-000110a0: 0a20 2020 2020 2020 2075 7365 7320 4854  .        uses HT
-000110b0: 4d4c 5061 7273 6572 0a20 2020 2020 2020  MLParser.       
-000110c0: 203a 7061 7261 6d20 696e 5f68 746d 6c3a   :param in_html:
-000110d0: 2048 544d 4c20 6669 6c65 0a20 2020 2020   HTML file.     
-000110e0: 2020 203a 7265 7475 726e 3a20 7765 6c6c     :return: well
-000110f0: 5f66 6f72 6d65 6420 5848 544d 4c0a 2020  _formed XHTML.  
-00011100: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00011110: 2020 6874 6d6c 5f65 6c65 6d20 3d20 4554    html_elem = ET
-00011120: 2e70 6172 7365 2873 7472 2869 6e5f 6874  .parse(str(in_ht
-00011130: 6d6c 292c 2045 542e 4854 4d4c 5061 7273  ml), ET.HTMLPars
-00011140: 6572 2829 292e 7870 6174 6828 222f 2a22  er()).xpath("/*"
-00011150: 295b 305d 0a20 2020 2020 2020 2072 6574  )[0].        ret
-00011160: 7572 6e20 6874 6d6c 5f65 6c65 6d0a 0a20  urn html_elem.. 
-00011170: 2020 2040 636c 6173 736d 6574 686f 640a     @classmethod.
-00011180: 2020 2020 6465 6620 7772 6974 655f 6874      def write_ht
-00011190: 6d6c 5f65 6c65 6d28 636c 732c 2065 6c65  ml_elem(cls, ele
-000111a0: 6d2c 206f 7574 5f68 746d 6c2c 2070 7265  m, out_html, pre
-000111b0: 7474 795f 7072 696e 743d 4661 6c73 6529  tty_print=False)
-000111c0: 3a0a 2020 2020 2020 2020 2222 2277 7269  :.        """wri
-000111d0: 7465 2048 544d 4c20 7769 7468 206f 7074  te HTML with opt
-000111e0: 696f 6e61 6c20 7072 6574 7479 5f70 7269  ional pretty_pri
-000111f0: 6e74 0a20 2020 2020 2020 203a 7061 7261  nt.        :para
-00011200: 6d20 656c 656d 3a20 4854 4d4c 2065 6c65  m elem: HTML ele
-00011210: 6d65 6e74 0a20 2020 2020 2020 203a 7061  ment.        :pa
-00011220: 7261 6d20 6f75 745f 6874 6d6c 3a20 6569  ram out_html: ei
-00011230: 7468 6572 2061 2066 696c 6520 6f72 2073  ther a file or s
-00011240: 7973 2e73 7464 6f75 740a 2020 2020 2020  ys.stdout.      
-00011250: 2020 3a70 6172 616d 2070 7265 7474 795f    :param pretty_
-00011260: 7072 696e 743a 0a20 2020 2020 2020 2022  print:.        "
-00011270: 7265 7475 726e 3a20 4e6f 6e65 0a20 2020  return: None.   
-00011280: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00011290: 2069 6620 6f75 745f 6874 6d6c 203d 3d20   if out_html == 
-000112a0: 7379 732e 7374 646f 7574 3a0a 2020 2020  sys.stdout:.    
-000112b0: 2020 2020 2020 2020 7072 696e 7420 2845          print (E
-000112c0: 542e 746f 7374 7269 6e67 2865 6c65 6d2c  T.tostring(elem,
-000112d0: 2070 7265 7474 795f 7072 696e 743d 5472   pretty_print=Tr
-000112e0: 7565 2c20 656e 636f 6469 6e67 3d22 756e  ue, encoding="un
-000112f0: 6963 6f64 6522 2929 0a20 2020 2020 2020  icode")).       
-00011300: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00011310: 2020 2073 7320 3d20 4554 2e74 6f73 7472     ss = ET.tostr
-00011320: 696e 6728 656c 656d 2c20 7072 6574 7479  ing(elem, pretty
-00011330: 5f70 7269 6e74 3d70 7265 7474 795f 7072  _print=pretty_pr
-00011340: 696e 7429 0a20 2020 2020 2020 2020 2020  int).           
-00011350: 2050 6174 6828 6f75 745f 6874 6d6c 292e   Path(out_html).
-00011360: 7061 7265 6e74 2e6d 6b64 6972 2870 6172  parent.mkdir(par
-00011370: 656e 7473 3d54 7275 652c 2065 7869 7374  ents=True, exist
-00011380: 5f6f 6b3d 5472 7565 290a 2020 2020 2020  _ok=True).      
-00011390: 2020 2020 2020 7769 7468 206f 7065 6e28        with open(
-000113a0: 6f75 745f 6874 6d6c 2c20 2277 6222 2920  out_html, "wb") 
-000113b0: 6173 2066 3a0a 2020 2020 2020 2020 2020  as f:.          
-000113c0: 2020 2020 2020 662e 7772 6974 6528 7373        f.write(ss
-000113d0: 290a 0a20 2020 2040 636c 6173 736d 6574  )..    @classmet
-000113e0: 686f 640a 2020 2020 6465 6620 7265 6d6f  hod.    def remo
-000113f0: 7665 5f73 7479 6c65 5f61 7474 7269 6275  ve_style_attribu
-00011400: 7465 7328 636c 732c 2068 746d 6c5f 656c  tes(cls, html_el
-00011410: 656d 293a 0a20 2020 2020 2020 2022 2222  em):.        """
-00011420: 7265 6d6f 7665 2040 7374 796c 6520 6174  remove @style at
-00011430: 7472 6962 7574 6573 2066 726f 6d20 656c  tributes from el
-00011440: 656d 656e 7473 2069 6e20 6874 6d6c 5f65  ements in html_e
-00011450: 6c65 6d0a 2020 2020 2020 2020 3a70 6172  lem.        :par
-00011460: 616d 2068 746d 6c5f 656c 656d 3a20 656c  am html_elem: el
-00011470: 656d 656e 7420 746f 2073 7472 6970 0a20  ement to strip. 
-00011480: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00011490: 2020 2069 6620 6874 6d6c 5f65 6c65 6d20     if html_elem 
-000114a0: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-000114b0: 2020 2020 2072 6574 7572 6e0a 2020 2020       return.    
-000114c0: 2020 2020 7374 796c 655f 656c 656d 7320      style_elems 
-000114d0: 3d20 6874 6d6c 5f65 6c65 6d2e 7870 6174  = html_elem.xpat
-000114e0: 6828 222e 2f2f 2a5b 4073 7479 6c65 5d22  h(".//*[@style]"
-000114f0: 290a 2020 2020 2020 2020 666f 7220 7374  ).        for st
-00011500: 796c 655f 656c 656d 2069 6e20 7374 796c  yle_elem in styl
-00011510: 655f 656c 656d 733a 0a20 2020 2020 2020  e_elems:.       
-00011520: 2020 2020 2048 746d 6c55 7469 6c2e 7265       HtmlUtil.re
-00011530: 6d6f 7665 5f61 7474 7269 6275 7465 2873  move_attribute(s
-00011540: 7479 6c65 5f65 6c65 6d2c 2022 7374 796c  tyle_elem, "styl
-00011550: 6522 290a 0a20 2020 2040 636c 6173 736d  e")..    @classm
-00011560: 6574 686f 640a 2020 2020 6465 6620 7265  ethod.    def re
-00011570: 6d6f 7665 5f65 6c65 6d73 2863 6c73 2c20  move_elems(cls, 
-00011580: 6874 6d6c 5f65 6c65 6d2c 2078 7061 7468  html_elem, xpath
-00011590: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
-000115a0: 2222 220a 2020 2020 2020 2020 7265 6d6f  """.        remo
-000115b0: 7665 2065 6c65 6d65 6e74 7320 6279 2078  ve elements by x
-000115c0: 7061 7468 0a20 2020 2020 2020 203a 7061  path.        :pa
-000115d0: 7261 6d20 6874 6d6c 5f65 6c65 6d3a 2065  ram html_elem: e
-000115e0: 6c65 6d65 6e74 2074 6f20 7265 6d6f 7665  lement to remove
-000115f0: 2065 6c65 6d65 6e74 2066 726f 6d0a 2020   element from.  
-00011600: 2020 2020 2020 3a70 6172 616d 2078 7061        :param xpa
-00011610: 7468 3a0a 2020 2020 2020 2020 2222 220a  th:.        """.
-00011620: 2020 2020 2020 2020 6966 2068 746d 6c5f          if html_
-00011630: 656c 656d 2069 7320 4e6f 6e65 206f 7220  elem is None or 
-00011640: 7870 6174 6820 6973 204e 6f6e 653a 0a20  xpath is None:. 
-00011650: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00011660: 6e0a 2020 2020 2020 2020 656c 656d 7320  n.        elems 
-00011670: 3d20 6874 6d6c 5f65 6c65 6d2e 7870 6174  = html_elem.xpat
-00011680: 6828 7870 6174 6829 0a20 2020 2020 2020  h(xpath).       
-00011690: 2066 6f72 2065 6c65 6d20 696e 2065 6c65   for elem in ele
-000116a0: 6d73 3a0a 2020 2020 2020 2020 2020 2020  ms:.            
-000116b0: 4874 6d6c 5574 696c 2e72 656d 6f76 655f  HtmlUtil.remove_
-000116c0: 656c 656d 5f6b 6565 705f 7461 696c 2865  elem_keep_tail(e
-000116d0: 6c65 6d29 0a0a 2020 2020 4063 6c61 7373  lem)..    @class
-000116e0: 6d65 7468 6f64 0a20 2020 2064 6566 2072  method.    def r
-000116f0: 656d 6f76 655f 656c 656d 656e 745f 696e  emove_element_in
-00011700: 5f68 6965 7261 7263 6879 2863 6c73 2c20  _hierarchy(cls, 
-00011710: 656c 656d 293a 0a20 2020 2020 2020 2022  elem):.        "
-00011720: 2222 7265 6d6f 7665 7320 6469 7673 2066  ""removes divs f
-00011730: 726f 6d20 6e65 7374 696e 670a 2020 2020  rom nesting.    
-00011740: 2020 2020 4578 616d 706c 653a 0a20 2020      Example:.   
-00011750: 2020 2020 2020 2020 203c 6469 7620 6964           <div id
-00011760: 3d22 6431 223e 0a20 2020 2020 2020 2020  ="d1">.         
-00011770: 2020 2020 203c 6469 7620 6964 3d22 6432       <div id="d2
-00011780: 223e 0a20 2020 2020 2020 2020 2020 2020  ">.             
-00011790: 2020 203c 7370 616e 2069 643d 2273 3122     <span id="s1"
-000117a0: 3e62 6c61 683c 2f73 7061 6e3e 0a20 2020  >blah</span>.   
-000117b0: 2020 2020 2020 2020 2020 203c 2f64 6976             </div
-000117c0: 3e0a 2020 2020 2020 2020 2020 2020 3c2f  >.            </
-000117d0: 6469 763e 0a20 2020 2020 2020 2020 2020  div>.           
-000117e0: 2061 3220 6973 2070 6c61 7969 6e67 206e   a2 is playing n
-000117f0: 6f20 726f 6c65 2069 6e20 6772 6f75 7069  o role in groupi
-00011800: 6e67 2c20 736f 2063 616e 2062 6520 7265  ng, so can be re
-00011810: 6d6f 7665 6420 746f 2067 6976 653a 0a20  moved to give:. 
-00011820: 2020 2020 2020 2020 2020 203c 6469 7620             <div 
-00011830: 6964 3d22 6431 223e 0a20 2020 2020 2020  id="d1">.       
-00011840: 2020 2020 2020 203c 7370 616e 2069 643d         <span id=
-00011850: 2273 3122 3e62 6c61 683c 2f73 7061 6e3e  "s1">blah</span>
-00011860: 0a20 2020 2020 2020 2020 2020 203c 2f64  .            </d
-00011870: 6976 3e0a 2020 2020 2020 2020 2020 2020  iv>.            
-00011880: 5468 6973 2063 616e 2062 6520 7265 6375  This can be recu
-00011890: 7273 6976 6520 6275 7420 7370 616e 7320  rsive but spans 
-000118a0: 7368 6f75 6c64 2061 6c77 6179 7320 6861  should always ha
-000118b0: 7665 2064 6976 2070 6172 656e 7473 0a20  ve div parents. 
-000118c0: 2020 2020 2020 2020 2020 203a 7061 7261             :para
-000118d0: 6d20 656c 656d 3a20 656c 656d 2074 6f20  m elem: elem to 
-000118e0: 7265 6d6f 7665 2e20 4974 7320 6368 696c  remove. Its chil
-000118f0: 6472 656e 2061 7265 2074 7261 6e73 6665  dren are transfe
-00011900: 7265 6420 746f 2070 6172 656e 740a 2020  red to parent.  
-00011910: 2020 2020 2020 2020 2020 652e 672e 0a20            e.g.. 
-00011920: 2020 2020 2020 2020 2020 2070 2861 2c65             p(a,e
-00011930: 6c65 6d28 6c2c 6d2c 6e29 2c7a 2920 3d3e  lem(l,m,n),z) =>
-00011940: 2070 2861 2c6c 2c6d 2c6e 2c7a 290a 2020   p(a,l,m,n,z).  
-00011950: 2020 2020 2020 2020 2020 3a72 6574 7572            :retur
-00011960: 6e3a 4e6f 6e65 0a20 2020 2020 2020 2022  n:None.        "
-00011970: 2222 0a20 2020 2020 2020 2070 6172 656e  "".        paren
-00011980: 7420 3d20 656c 656d 2e67 6574 7061 7265  t = elem.getpare
-00011990: 6e74 2829 0a20 2020 2020 2020 2069 6620  nt().        if 
-000119a0: 7061 7265 6e74 2069 7320 4e6f 6e65 3a0a  parent is None:.
-000119b0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-000119c0: 7428 6622 656c 656d 2068 6173 206e 6f20  t(f"elem has no 
-000119d0: 7061 7265 6e74 2229 0a20 2020 2020 2020  parent").       
-000119e0: 2020 2020 2072 6574 7572 6e0a 2020 2020       return.    
-000119f0: 2020 2020 6964 7820 3d20 7061 7265 6e74      idx = parent
-00011a00: 2e69 6e64 6578 2865 6c65 6d29 0a20 2020  .index(elem).   
-00011a10: 2020 2020 2063 6869 6c64 5f65 6c65 6d73       child_elems
-00011a20: 203d 2065 6c65 6d2e 7870 6174 6828 222a   = elem.xpath("*
-00011a30: 2229 0a20 2020 2020 2020 2066 6f72 2063  ").        for c
-00011a40: 6869 6c64 5f65 6c65 6d20 696e 2063 6869  hild_elem in chi
-00011a50: 6c64 5f65 6c65 6d73 3a0a 2020 2020 2020  ld_elems:.      
-00011a60: 2020 2020 2020 7061 7265 6e74 2e69 6e73        parent.ins
-00011a70: 6572 7428 6964 782c 2063 6869 6c64 5f65  ert(idx, child_e
-00011a80: 6c65 6d29 0a20 2020 2020 2020 2070 6172  lem).        par
-00011a90: 656e 742e 7265 6d6f 7665 2865 6c65 6d29  ent.remove(elem)
-00011aa0: 0a0a 2020 2020 4063 6c61 7373 6d65 7468  ..    @classmeth
-00011ab0: 6f64 0a20 2020 2064 6566 2072 656d 6f76  od.    def remov
-00011ac0: 655f 656c 656d 656e 7473 5f69 6e5f 6869  e_elements_in_hi
-00011ad0: 6572 6172 6368 795f 6279 5f78 7061 7468  erarchy_by_xpath
-00011ae0: 2863 6c73 2c20 6874 6d6c 2c20 7870 6174  (cls, html, xpat
-00011af0: 6829 3a0a 2020 2020 2020 2020 2222 2266  h):.        """f
-00011b00: 696e 6473 2065 6c65 6d65 6e74 7320 6279  inds elements by
-00011b10: 2078 7061 7468 2061 6e64 2064 656c 6574   xpath and delet
-00011b20: 6573 2074 6865 6d20 7573 696e 6720 7265  es them using re
-00011b30: 6d6f 7665 5f65 6c65 6d65 6e74 735f 696e  move_elements_in
-00011b40: 5f68 6965 7261 7263 6879 2829 0a20 2020  _hierarchy().   
-00011b50: 2020 2020 203a 7061 7261 6d20 6874 6d6c       :param html
-00011b60: 3a20 656c 656d 656e 7473 2074 6f20 6465  : elements to de
-00011b70: 6c65 7465 2066 726f 6d0a 2020 2020 2020  lete from.      
-00011b80: 2020 3a70 6172 616d 2078 7061 7468 3a20    :param xpath: 
-00011b90: 7870 6174 6820 746f 2073 6561 7263 6820  xpath to search 
-00011ba0: 7769 7468 0a20 2020 2020 2020 203a 7265  with.        :re
-00011bb0: 7475 726e 3a20 656c 656d 7320 7468 6174  turn: elems that
-00011bc0: 2068 6176 6520 6265 656e 2064 656c 6574   have been delet
-00011bd0: 6564 0a20 2020 2020 2020 2022 2222 0a20  ed.        """. 
-00011be0: 2020 2020 2020 2065 6c65 6d73 203d 2068         elems = h
-00011bf0: 746d 6c2e 7870 6174 6828 7870 6174 6829  tml.xpath(xpath)
-00011c00: 0a20 2020 2020 2020 2066 6f72 2065 6c65  .        for ele
-00011c10: 6d20 696e 2065 6c65 6d73 3a0a 2020 2020  m in elems:.    
-00011c20: 2020 2020 2020 2020 4874 6d6c 5574 696c          HtmlUtil
-00011c30: 2e72 656d 6f76 655f 656c 656d 656e 745f  .remove_element_
-00011c40: 696e 5f68 6965 7261 7263 6879 2865 6c65  in_hierarchy(ele
-00011c50: 6d29 0a20 2020 2020 2020 2072 6574 7572  m).        retur
-00011c60: 6e20 656c 656d 730a 0a0a 636c 6173 7320  n elems...class 
-00011c70: 4874 6d6c 416e 6e6f 7461 746f 723a 0a20  HtmlAnnotator:. 
-00011c80: 2020 2022 2222 696e 6c69 6e65 2061 6e6e     """inline ann
-00011c90: 6f74 6174 6f72 2066 6f72 2048 544d 4c20  otator for HTML 
-00011ca0: 656c 656d 656e 7473 0a20 2020 2073 746f  elements.    sto
-00011cb0: 7265 7320 616e 6420 7275 6e73 2041 6e6e  res and runs Ann
-00011cc0: 6f74 6174 6f72 436f 6d6d 616e 6473 0a0a  otatorCommands..
-00011cd0: 2020 2020 616e 6e6f 7461 746f 7220 3d20      annotator = 
-00011ce0: 416e 6e6f 7461 746f 7228 290a 2020 2020  Annotator().    
-00011cf0: 636f 6d6d 616e 6420 3d20 416e 6e6f 7461  command = Annota
-00011d00: 746f 7243 6f6d 6d61 6e64 2868 746d 6c5f  torCommand(html_
-00011d10: 636c 6173 733d 2273 6563 7469 6f6e 5f74  class="section_t
-00011d20: 6974 6c65 222c 2072 6567 6578 3d22 5365  itle", regex="Se
-00011d30: 6374 696f 6e5c 5c73 2b28 3f50 3c69 643e  ction\\s+(?P<id>
-00011d40: 5c5c 642b 293a 5c5c 732b 283f 503c 7469  \\d+):\\s+(?P<ti
-00011d50: 746c 653e 2e2a 2922 2c20 6164 645f 6964  tle>.*)", add_id
-00011d60: 3d54 7275 652c 2061 6464 5f74 6974 6c65  =True, add_title
-00011d70: 3d54 7275 6529 0a20 2020 2061 6e6e 6f74  =True).    annot
-00011d80: 6174 6f72 2e61 6464 5f63 6f6d 6d61 6e64  ator.add_command
-00011d90: 2863 6f6d 6d61 6e64 290a 2020 2020 616e  (command).    an
-00011da0: 6e6f 7461 746f 722e 7275 6e5f 636f 6d6d  notator.run_comm
-00011db0: 616e 6473 2865 6c65 6d29 0a0a 2020 2020  ands(elem)..    
-00011dc0: 2222 220a 0a20 2020 2064 6566 205f 5f69  """..    def __i
-00011dd0: 6e69 745f 5f28 7365 6c66 293a 0a20 2020  nit__(self):.   
-00011de0: 2020 2020 2073 656c 662e 636f 6d6d 616e       self.comman
-00011df0: 6473 203d 205b 5d0a 0a20 2020 2064 6566  ds = []..    def
-00011e00: 2061 6464 5f63 6f6d 6d61 6e64 2873 656c   add_command(sel
-00011e10: 662c 2063 6f6d 6d61 6e64 293a 0a20 2020  f, command):.   
-00011e20: 2020 2020 2069 6620 636f 6d6d 616e 643a       if command:
-00011e30: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00011e40: 662e 636f 6d6d 616e 6473 2e61 7070 656e  f.commands.appen
-00011e50: 6428 636f 6d6d 616e 6429 0a0a 2020 2020  d(command)..    
-00011e60: 6465 6620 7275 6e5f 636f 6d6d 616e 6473  def run_commands
-00011e70: 2873 656c 662c 2074 6172 6765 745f 656c  (self, target_el
-00011e80: 656d 293a 0a20 2020 2020 2020 2022 2222  em):.        """
-00011e90: 0a20 2020 2020 2020 2069 7465 7261 7465  .        iterate
-00011ea0: 2063 6f6d 6d61 6e64 7320 286f 7264 6572   commands (order
-00011eb0: 2069 7320 6f72 6465 7220 6f66 2074 6865   is order of the
-00011ec0: 6972 2061 6464 6974 696f 6e0a 2020 2020  ir addition.    
-00011ed0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00011ee0: 666f 7220 636f 6d6d 616e 6420 696e 2073  for command in s
-00011ef0: 656c 662e 636f 6d6d 616e 6473 3a0a 2020  elf.commands:.  
-00011f00: 2020 2020 2020 2020 2020 636f 6d6d 616e            comman
-00011f10: 642e 7275 6e5f 636f 6d6d 616e 6428 7461  d.run_command(ta
-00011f20: 7267 6574 5f65 6c65 6d29 0a0a 2020 2020  rget_elem)..    
-00011f30: 4063 6c61 7373 6d65 7468 6f64 0a20 2020  @classmethod.   
-00011f40: 2064 6566 2063 7265 6174 655f 6970 6363   def create_ipcc
-00011f50: 5f61 6e6e 6f74 6174 6f72 2863 6c73 293a  _annotator(cls):
-00011f60: 0a20 2020 2020 2020 2022 2222 6120 7365  .        """a se
-00011f70: 7420 6f66 2067 656e 6572 616c 206f 7065  t of general ope
-00011f80: 7261 7469 6f6e 7320 666f 7220 4950 4343  rations for IPCC
-00011f90: 2222 220a 2020 2020 2020 2020 616e 6e6f  """.        anno
-00011fa0: 7461 746f 7220 3d20 4874 6d6c 416e 6e6f  tator = HtmlAnno
-00011fb0: 7461 746f 7228 290a 2020 2020 2020 2020  tator().        
-00011fc0: 616e 6e6f 7461 746f 722e 6164 645f 636f  annotator.add_co
-00011fd0: 6d6d 616e 6428 0a20 2020 2020 2020 2020  mmand(.         
-00011fe0: 2020 2041 6e6e 6f74 6174 6f72 436f 6d6d     AnnotatorComm
-00011ff0: 616e 6428 6874 6d6c 5f63 6c61 7373 3d22  and(html_class="
-00012000: 7365 6374 696f 6e5f 7469 746c 6522 2c20  section_title", 
-00012010: 7265 6765 783d 2253 6563 7469 6f6e 5c5c  regex="Section\\
-00012020: 732b 283f 503c 6964 3e5c 5c64 2b29 3a5c  s+(?P<id>\\d+):\
-00012030: 5c73 2b28 3f50 3c74 6974 6c65 3e2e 2a29  \s+(?P<title>.*)
-00012040: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
-00012050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012060: 6164 645f 6964 3d22 7365 6374 696f 6e5f  add_id="section_
-00012070: 7c22 2c20 6164 645f 7469 746c 653d 227c  |", add_title="|
-00012080: 222c 2073 7479 6c65 3d22 7b63 6f6c 6f72  ", style="{color
-00012090: 203a 2062 6c75 653b 2062 6163 6b67 726f   : blue; backgro
-000120a0: 756e 6420 3a20 7069 6e6b 3b7d 222c 0a20  und : pink;}",. 
-000120b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000120c0: 2020 2020 2020 2020 2020 2064 6573 633d             desc=
-000120d0: 2261 6464 2069 6420 616e 6420 7469 746c  "add id and titl
-000120e0: 6520 666f 7220 2753 6563 7469 6f6e 3a20  e for 'Section: 
-000120f0: 2e2e 2e27 2229 0a20 2020 2020 2020 2029  ...'").        )
-00012100: 0a20 2020 2020 2020 2061 6e6e 6f74 6174  .        annotat
-00012110: 6f72 2e61 6464 5f63 6f6d 6d61 6e64 280a  or.add_command(.
-00012120: 2020 2020 2020 2020 2020 2020 416e 6e6f              Anno
-00012130: 7461 746f 7243 6f6d 6d61 6e64 2868 746d  tatorCommand(htm
-00012140: 6c5f 636c 6173 733d 2273 7562 5f73 6563  l_class="sub_sec
-00012150: 7469 6f6e 5f74 6974 6c65 222c 2072 6567  tion_title", reg
-00012160: 6578 3d22 5c5c 732a 283f 503c 6964 3e5c  ex="\\s*(?P<id>\
-00012170: 5c64 2b5c 5c2e 5c5c 642b 295c 5c73 2b28  \d+\\.\\d+)\\s+(
-00012180: 3f50 3c74 6974 6c65 3e2e 2a29 222c 0a20  ?P<title>.*)",. 
-00012190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000121a0: 2020 2020 2020 2020 2020 2020 6164 645f              add_
-000121b0: 6964 3d22 7375 6273 6563 7469 6f6e 5f7c  id="subsection_|
-000121c0: 222c 2061 6464 5f74 6974 6c65 3d22 7c22  ", add_title="|"
-000121d0: 2c20 7374 796c 653d 227b 636f 6c6f 7220  , style="{color 
-000121e0: 3a20 6772 6565 6e3b 2062 6163 6b67 726f  : green; backgro
-000121f0: 756e 6420 3a20 7965 6c6c 6f77 3b7d 2229  und : yellow;}")
-00012200: 290a 2020 2020 2020 2020 616e 6e6f 7461  ).        annota
-00012210: 746f 722e 6164 645f 636f 6d6d 616e 6428  tor.add_command(
-00012220: 0a20 2020 2020 2020 2020 2020 2041 6e6e  .            Ann
-00012230: 6f74 6174 6f72 436f 6d6d 616e 6428 6874  otatorCommand(ht
-00012240: 6d6c 5f63 6c61 7373 3d22 7375 625f 7375  ml_class="sub_su
-00012250: 625f 7365 6374 696f 6e5f 7469 746c 6522  b_section_title"
-00012260: 2c20 7265 6765 783d 225e 5c5c 732a 283f  , regex="^\\s*(?
-00012270: 503c 6964 3e5c 5c64 2b5c 5c2e 5c5c 642b  P<id>\\d+\\.\\d+
-00012280: 5c5c 2e5c 5c64 2b29 5c5c 732b 283f 503c  \\.\\d+)\\s+(?P<
-00012290: 7469 746c 653e 2e2a 2922 2c0a 2020 2020  title>.*)",.    
-000122a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000122b0: 2020 2020 2020 2020 2061 6464 5f69 643d           add_id=
-000122c0: 2273 7562 7365 6374 696f 6e5f 7c22 2c20  "subsection_|", 
-000122d0: 6164 645f 7469 746c 653d 227c 222c 2073  add_title="|", s
-000122e0: 7479 6c65 3d22 7b63 6f6c 6f72 203a 2062  tyle="{color : b
-000122f0: 6c61 636b 3b20 6261 636b 6772 6f75 6e64  lack; background
-00012300: 203a 2023 6464 6464 6464 3b7d 2229 290a   : #dddddd;}")).
-00012310: 2020 2020 2020 2020 616e 6e6f 7461 746f          annotato
-00012320: 722e 6164 645f 636f 6d6d 616e 6428 0a20  r.add_command(. 
-00012330: 2020 2020 2020 2020 2020 2041 6e6e 6f74             Annot
-00012340: 6174 6f72 436f 6d6d 616e 6428 6874 6d6c  atorCommand(html
-00012350: 5f63 6c61 7373 3d22 636f 6e66 6964 656e  _class="confiden
-00012360: 6365 222c 0a20 2020 2020 2020 2020 2020  ce",.           
+0000ded0: 2020 2020 2063 6c73 2e72 656d 6f76 655f       cls.remove_
+0000dee0: 656c 656d 5f6b 6565 705f 7461 696c 2865  elem_keep_tail(e
+0000def0: 6c29 0a0a 2020 2020 4063 6c61 7373 6d65  l)..    @classme
+0000df00: 7468 6f64 0a20 2020 2064 6566 2072 656d  thod.    def rem
+0000df10: 6f76 655f 6865 6164 6572 735f 616e 645f  ove_headers_and_
+0000df20: 666f 6f74 6572 735f 7573 696e 675f 7064  footers_using_pd
+0000df30: 666d 696e 6572 5f63 6f6f 7264 7328 636c  fminer_coords(cl
+0000df40: 732c 2072 6566 5f65 6c65 6d2c 2070 6167  s, ref_elem, pag
+0000df50: 6573 697a 652c 2068 6561 6465 725f 6865  esize, header_he
+0000df60: 6967 6874 2c20 666f 6f74 6572 5f68 6569  ight, footer_hei
+0000df70: 6768 742c 0a20 2020 2020 2020 2020 2020  ght,.           
+0000df80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000df90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dfa0: 2020 2020 2020 2020 2020 2020 2020 6d61                ma
+0000dfb0: 726b 6572 5f78 7061 7468 2c20 7061 6765  rker_xpath, page
+0000dfc0: 5f74 6f70 733d 4e6f 6e65 293a 0a20 2020  _tops=None):.   
+0000dfd0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0000dfe0: 204e 4f54 2043 4f4d 504c 4554 4520 2d20   NOT COMPLETE - 
+0000dff0: 7468 6572 6520 6172 6520 6e6f 2066 6f6f  there are no foo
+0000e000: 7465 7273 2062 6563 6175 7365 206f 6620  ters because of 
+0000e010: 7468 6520 636f 6f72 6469 6e61 7465 2073  the coordinate s
+0000e020: 7973 7465 6d2e 0a0a 2020 2020 2020 2020  ystem...        
+0000e030: 4d61 7962 6520 6d6f 7665 2074 6f20 4854  Maybe move to HT
+0000e040: 4d4c 5469 6479 0a0a 2020 2020 2020 2020  MLTidy..        
+0000e050: 7468 6520 4074 6f70 2072 6570 7265 7365  the @top represe
+0000e060: 6e74 7320 7468 6520 792d 636f 6f72 6469  nts the y-coordi
+0000e070: 6e61 7465 2066 726f 6d20 7468 6520 7374  nate from the st
+0000e080: 6172 7420 6f66 2074 6865 2064 6f63 756d  art of the docum
+0000e090: 656e 7420 2870 6466 6d69 6e65 723f 292e  ent (pdfminer?).
+0000e0a0: 0a20 2020 2020 2020 2074 6869 7320 6d65  .        this me
+0000e0b0: 616e 7320 7765 2068 6176 6520 746f 2073  ans we have to s
+0000e0c0: 7562 7472 6163 7420 7061 6765 7369 7a65  ubtract pagesize
+0000e0d0: 7320 6672 6f6d 2069 742e 0a20 2020 2020  s from it..     
+0000e0e0: 2020 2022 2222 0a20 2020 2020 2020 2064     """.        d
+0000e0f0: 6562 7567 203d 2046 616c 7365 0a20 2020  ebug = False.   
+0000e100: 2020 2020 2065 6c65 6d73 203d 2072 6566       elems = ref
+0000e110: 5f65 6c65 6d2e 7870 6174 6828 6d61 726b  _elem.xpath(mark
+0000e120: 6572 5f78 7061 7468 290a 0a20 2020 2020  er_xpath)..     
+0000e130: 2020 206c 6173 745f 746f 7020 3d20 300a     last_top = 0.
+0000e140: 2020 2020 2020 2020 666f 7220 656c 656d          for elem
+0000e150: 2069 6e20 7265 665f 656c 656d 2e78 7061   in ref_elem.xpa
+0000e160: 7468 2822 2f2f 2a5b 4073 7479 6c65 5d22  th("//*[@style]"
+0000e170: 293a 0a20 2020 2020 2020 2020 2020 2079  ):.            y
+0000e180: 636f 6f72 6430 203d 2048 746d 6c55 7469  coord0 = HtmlUti
+0000e190: 6c2e 6765 745f 7930 2865 6c65 6d29 0a20  l.get_y0(elem). 
+0000e1a0: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
+0000e1b0: 7420 7963 6f6f 7264 303a 0a20 2020 2020  t ycoord0:.     
+0000e1c0: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
+0000e1d0: 6e75 650a 2020 2020 2020 2020 2020 2020  nue.            
+0000e1e0: 7465 7874 203d 2058 6d6c 4c69 622e 6765  text = XmlLib.ge
+0000e1f0: 745f 7465 7874 2865 6c65 6d29 2e73 7472  t_text(elem).str
+0000e200: 6970 2829 0a20 2020 2020 2020 2020 2020  ip().           
+0000e210: 2070 6167 655f 746f 705f 7920 3d20 4874   page_top_y = Ht
+0000e220: 6d6c 5574 696c 2e67 6574 5f6c 6172 6765  mlUtil.get_large
+0000e230: 7374 5f63 6f6f 7264 5f6c 6573 735f 7468  st_coord_less_th
+0000e240: 616e 2870 6167 655f 746f 7073 2c20 7963  an(page_tops, yc
+0000e250: 6f6f 7264 3029 0a20 2020 2020 2020 2020  oord0).         
+0000e260: 2020 2069 6620 7061 6765 5f74 6f70 5f79     if page_top_y
+0000e270: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+0000e280: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+0000e290: 6622 6361 6e6e 6f74 2066 696e 6420 7061  f"cannot find pa
+0000e2a0: 6765 2074 6f70 207b 7963 6f6f 7264 307d  ge top {ycoord0}
+0000e2b0: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+0000e2c0: 2020 2063 6f6e 7469 6e75 650a 2020 2020     continue.    
+0000e2d0: 2020 2020 2020 2020 7061 6765 5f74 6f70          page_top
+0000e2e0: 5f79 203d 2066 6c6f 6174 2870 6167 655f  _y = float(page_
+0000e2f0: 746f 705f 7929 0a20 2020 2020 2020 2020  top_y).         
+0000e300: 2020 2079 636f 6f72 6420 3d20 7963 6f6f     ycoord = ycoo
+0000e310: 7264 3020 2d20 7061 6765 5f74 6f70 5f79  rd0 - page_top_y
+0000e320: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+0000e330: 7072 696e 7428 6622 544f 5020 7b79 636f  print(f"TOP {yco
+0000e340: 6f72 6430 7d20 7b79 636f 6f72 647d 207b  ord0} {ycoord} {
+0000e350: 7061 6765 7369 7a65 7d20 7b79 636f 6f72  pagesize} {ycoor
+0000e360: 6420 2520 7061 6765 7369 7a65 7d22 290a  d % pagesize}").
+0000e370: 2020 2020 2020 2020 2020 2020 696e 5f74              in_t
+0000e380: 6f70 203d 2079 636f 6f72 6420 3c20 6865  op = ycoord < he
+0000e390: 6164 6572 5f68 6569 6768 740a 2020 2020  ader_height.    
+0000e3a0: 2020 2020 2020 2020 6966 2069 6e5f 746f          if in_to
+0000e3b0: 703a 0a20 2020 2020 2020 2020 2020 2020  p:.             
+0000e3c0: 2020 2069 6620 6465 6275 673a 0a20 2020     if debug:.   
+0000e3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e3e0: 2070 7269 6e74 2866 2254 4f50 2020 7b74   print(f"TOP  {t
+0000e3f0: 6578 747d 2229 0a20 2020 2020 2020 2020  ext}").         
+0000e400: 2020 2069 6e5f 626f 7474 6f6d 203d 2079     in_bottom = y
+0000e410: 636f 6f72 6420 3e20 7061 6765 7369 7a65  coord > pagesize
+0000e420: 5b30 5d20 2d20 666f 6f74 6572 5f68 6569  [0] - footer_hei
+0000e430: 6768 740a 2020 2020 2020 2020 2020 2020  ght.            
+0000e440: 6966 2069 6e5f 626f 7474 6f6d 3a0a 2020  if in_bottom:.  
+0000e450: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0000e460: 2064 6562 7567 3a0a 2020 2020 2020 2020   debug:.        
+0000e470: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+0000e480: 7428 6622 424f 5454 4f4d 2020 7b74 6578  t(f"BOTTOM  {tex
+0000e490: 747d 2229 0a20 2020 2020 2020 2020 2020  t}").           
+0000e4a0: 2069 6620 696e 5f74 6f70 206f 7220 696e   if in_top or in
+0000e4b0: 5f62 6f74 746f 6d3a 0a20 2020 2020 2020  _bottom:.       
+0000e4c0: 2020 2020 2020 2020 2069 6620 6c65 6e28           if len(
+0000e4d0: 7465 7874 2e73 7472 6970 2829 2920 3e20  text.strip()) > 
+0000e4e0: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
+0000e4f0: 2020 2020 2020 206c 6f67 6769 6e67 2e77         logging.w
+0000e500: 6172 6e69 6e67 2866 2272 656d 6f76 696e  arning(f"removin
+0000e510: 6720 746f 7020 7465 7874 207b 7465 7874  g top text {text
+0000e520: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
+0000e530: 2020 2020 636c 732e 7265 6d6f 7665 5f65      cls.remove_e
+0000e540: 6c65 6d5f 6b65 6570 5f74 6169 6c28 656c  lem_keep_tail(el
+0000e550: 656d 290a 2020 2020 2020 2020 2020 2020  em).            
+0000e560: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0000e570: 2020 2020 2020 2320 736b 6970 7065 640a        # skipped.
+0000e580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e590: 7061 7373 0a0a 2020 2020 4063 6c61 7373  pass..    @class
+0000e5a0: 6d65 7468 6f64 0a20 2020 2064 6566 2067  method.    def g
+0000e5b0: 6574 5f6c 6172 6765 7374 5f63 6f6f 7264  et_largest_coord
+0000e5c0: 5f6c 6573 735f 7468 616e 2863 6c73 2c20  _less_than(cls, 
+0000e5d0: 7061 6765 5f74 6f70 732c 2063 6f6f 7264  page_tops, coord
+0000e5e0: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
+0000e5f0: 2020 2020 2020 2069 7465 7261 7465 2074         iterate t
+0000e600: 6872 6f75 6768 2073 6f72 7465 6420 6c69  hrough sorted li
+0000e610: 7374 206f 6620 7061 6765 5f74 6f70 7320  st of page_tops 
+0000e620: 616e 6420 6669 6e64 2074 6865 206c 6172  and find the lar
+0000e630: 6765 7374 206c 6573 7320 7468 616e 2063  gest less than c
+0000e640: 6f6f 7264 0a20 2020 2020 2020 203a 7061  oord.        :pa
+0000e650: 7261 6d20 7061 6765 5f74 6f70 733a 2073  ram page_tops: s
+0000e660: 6f72 7465 6420 696e 6372 6561 7369 6e67  orted increasing
+0000e670: 206c 6973 7420 6f66 2070 6167 6520 746f   list of page to
+0000e680: 7073 0a20 2020 2020 2020 203a 7061 7261  ps.        :para
+0000e690: 6d20 636f 6f72 643a 2061 6374 7561 6c20  m coord: actual 
+0000e6a0: 636f 6f72 6469 6e61 7465 0a20 2020 2020  coordinate.     
+0000e6b0: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
+0000e6c0: 6620 7061 6765 5f74 6f70 7320 6973 204e  f page_tops is N
+0000e6d0: 6f6e 6520 6f72 2063 6f6f 7264 2069 7320  one or coord is 
+0000e6e0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+0000e6f0: 2020 7265 7475 726e 204e 6f6e 650a 2020    return None.  
+0000e700: 2020 2020 2020 666f 7220 692c 2070 6167        for i, pag
+0000e710: 655f 746f 7020 696e 2065 6e75 6d65 7261  e_top in enumera
+0000e720: 7465 2870 6167 655f 746f 7073 293a 0a20  te(page_tops):. 
+0000e730: 2020 2020 2020 2020 2020 2069 6620 666c             if fl
+0000e740: 6f61 7428 7061 6765 5f74 6f70 2920 3e20  oat(page_top) > 
+0000e750: 666c 6f61 7428 636f 6f72 6429 3a0a 2020  float(coord):.  
+0000e760: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0000e770: 2069 203d 3d20 303a 0a20 2020 2020 2020   i == 0:.       
+0000e780: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+0000e790: 7572 6e20 4e6f 6e65 0a20 2020 2020 2020  urn None.       
+0000e7a0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0000e7b0: 7061 6765 5f74 6f70 735b 6920 2d20 315d  page_tops[i - 1]
+0000e7c0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0000e7d0: 4e6f 6e65 0a0a 2020 2020 4063 6c61 7373  None..    @class
+0000e7e0: 6d65 7468 6f64 0a20 2020 2064 6566 2072  method.    def r
+0000e7f0: 656d 6f76 655f 6c68 5f6c 696e 655f 6e75  emove_lh_line_nu
+0000e800: 6d62 6572 7328 636c 732c 2072 6566 5f65  mbers(cls, ref_e
+0000e810: 6c65 6d29 3a0a 2020 2020 2020 2020 636c  lem):.        cl
+0000e820: 732e 6669 6e64 5f65 6c65 6d65 6e74 735f  s.find_elements_
+0000e830: 7769 7468 5f73 7479 6c65 2872 6566 5f65  with_style(ref_e
+0000e840: 6c65 6d2c 2022 2e2f 2f2a 5b40 7374 796c  lem, ".//*[@styl
+0000e850: 655d 222c 2022 6c65 6674 3c34 3922 2c20  e]", "left<49", 
+0000e860: 7265 6d6f 7665 3d54 7275 6529 0a20 2020  remove=True).   
+0000e870: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0000e880: 204d 6179 6265 206d 6f76 6520 746f 2048   Maybe move to H
+0000e890: 544d 4c54 6964 790a 2020 2020 2020 2020  TMLTidy.        
+0000e8a0: 2222 220a 0a20 2020 2040 636c 6173 736d  """..    @classm
+0000e8b0: 6574 686f 640a 2020 2020 6465 6620 7265  ethod.    def re
+0000e8c0: 6d6f 7665 5f61 7474 7269 6275 7465 2863  move_attribute(c
+0000e8d0: 6c73 2c20 656c 656d 2c20 6174 745f 6e61  ls, elem, att_na
+0000e8e0: 6d65 293a 0a20 2020 2020 2020 2022 2222  me):.        """
+0000e8f0: 0a20 2020 2020 2020 2072 656d 6f76 6573  .        removes
+0000e900: 2061 7474 7269 6275 7465 2077 6974 6820   attribute with 
+0000e910: 6769 7665 6e20 6e61 6d65 0a20 2020 2020  given name.     
+0000e920: 2020 2049 6620 6e6f 7420 7072 6573 656e     If not presen
+0000e930: 742c 206e 6f2d 6f70 0a20 2020 2020 2020  t, no-op.       
+0000e940: 203a 7061 7261 6d20 656c 656d 3a20 656c   :param elem: el
+0000e950: 656d 656e 7420 636f 6e74 6169 6e69 6e67  ement containing
+0000e960: 2061 7474 7269 6275 7465 0a20 2020 2020   attribute.     
+0000e970: 2020 203a 7061 7261 6d20 6174 745f 6e61     :param att_na
+0000e980: 6d65 3a20 6e61 6d65 206f 6620 6174 7472  me: name of attr
+0000e990: 6962 7574 650a 2020 2020 2020 2020 3a72  ibute.        :r
+0000e9a0: 6574 7572 6e3a 204e 6f6e 650a 2020 2020  eturn: None.    
+0000e9b0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0000e9c0: 2222 220a 2020 2020 2020 2020 726f 6f74  """.        root
+0000e9d0: 2e61 7474 7269 622e 706f 7028 2278 797a  .attrib.pop("xyz
+0000e9e0: 222c 204e 6f6e 6529 2022 2222 0a20 2020  ", None) """.   
+0000e9f0: 2020 2020 2069 6620 656c 656d 2069 7320       if elem is 
+0000ea00: 4e6f 6e65 206f 7220 6174 745f 6e61 6d65  None or att_name
+0000ea10: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+0000ea20: 2020 2020 2020 7265 7475 726e 0a20 2020        return.   
+0000ea30: 2020 2020 2065 6c65 6d2e 6174 7472 6962       elem.attrib
+0000ea40: 2e70 6f70 2861 7474 5f6e 616d 652c 204e  .pop(att_name, N
+0000ea50: 6f6e 6529 0a0a 2020 2020 4063 6c61 7373  one)..    @class
+0000ea60: 6d65 7468 6f64 0a20 2020 2064 6566 2072  method.    def r
+0000ea70: 656d 6f76 655f 7374 796c 655f 6174 7472  emove_style_attr
+0000ea80: 6962 7574 6528 636c 732c 2072 6566 5f65  ibute(cls, ref_e
+0000ea90: 6c65 6d2c 2073 7479 6c65 5f6e 616d 6529  lem, style_name)
+0000eaa0: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+0000eab0: 2020 2020 2020 4d61 7962 6520 6d6f 7665        Maybe move
+0000eac0: 2074 6f20 4854 4d4c 5469 6479 0a20 2020   to HTMLTidy.   
+0000ead0: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
+0000eae0: 2020 656c 656d 7320 3d20 7265 665f 656c    elems = ref_el
+0000eaf0: 656d 2e78 7061 7468 2822 2e2f 2f2a 2229  em.xpath(".//*")
+0000eb00: 0a20 2020 2020 2020 2066 6f72 2065 6c20  .        for el 
+0000eb10: 696e 2065 6c65 6d73 3a0a 2020 2020 2020  in elems:.      
+0000eb20: 2020 2020 2020 6373 735f 7374 796c 6520        css_style 
+0000eb30: 3d20 4353 5353 7479 6c65 2e63 7265 6174  = CSSStyle.creat
+0000eb40: 655f 6373 735f 7374 796c 655f 6672 6f6d  e_css_style_from
+0000eb50: 5f61 7474 7269 6275 7465 5f6f 665f 626f  _attribute_of_bo
+0000eb60: 6479 5f65 6c65 6d65 6e74 2865 6c29 0a20  dy_element(el). 
+0000eb70: 2020 2020 2020 2020 2020 2069 6620 6373             if cs
+0000eb80: 735f 7374 796c 652e 6e61 6d65 5f76 616c  s_style.name_val
+0000eb90: 7565 5f64 6963 742e 6765 7428 7374 796c  ue_dict.get(styl
+0000eba0: 655f 6e61 6d65 293a 0a20 2020 2020 2020  e_name):.       
+0000ebb0: 2020 2020 2020 2020 2063 7373 5f73 7479           css_sty
+0000ebc0: 6c65 2e6e 616d 655f 7661 6c75 655f 6469  le.name_value_di
+0000ebd0: 6374 2e70 6f70 2873 7479 6c65 5f6e 616d  ct.pop(style_nam
+0000ebe0: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
+0000ebf0: 2020 2063 7373 5f73 7479 6c65 2e61 7070     css_style.app
+0000ec00: 6c79 5f74 6f28 656c 290a 0a20 2020 2040  ly_to(el)..    @
+0000ec10: 636c 6173 736d 6574 686f 640a 2020 2020  classmethod.    
+0000ec20: 6465 6620 7265 6d6f 7665 5f6c 6172 6765  def remove_large
+0000ec30: 5f66 6f6e 7465 645f 656c 656d 656e 7473  _fonted_elements
+0000ec40: 2863 6c73 2c20 7265 665f 656c 656d 293a  (cls, ref_elem):
+0000ec50: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0000ec60: 2020 2020 204d 6179 6265 206d 6f76 6520       Maybe move 
+0000ec70: 746f 2048 544d 4c54 6964 790a 2020 2020  to HTMLTidy.    
+0000ec80: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0000ec90: 636c 732e 6669 6e64 5f65 6c65 6d65 6e74  cls.find_element
+0000eca0: 735f 7769 7468 5f73 7479 6c65 2872 6566  s_with_style(ref
+0000ecb0: 5f65 6c65 6d2c 2022 2e2f 2f2a 5b40 7374  _elem, ".//*[@st
+0000ecc0: 796c 655d 222c 2022 666f 6e74 2d73 697a  yle]", "font-siz
+0000ecd0: 653e 3330 222c 2072 656d 6f76 653d 5472  e>30", remove=Tr
+0000ece0: 7565 290a 0a20 2020 2040 636c 6173 736d  ue)..    @classm
+0000ecf0: 6574 686f 640a 2020 2020 6465 6620 6669  ethod.    def fi
+0000ed00: 6e64 5f63 6f6e 7374 616e 745f 636f 6f72  nd_constant_coor
+0000ed10: 6469 6e61 7465 5f6d 6172 6b65 7273 2863  dinate_markers(c
+0000ed20: 6c73 2c20 7265 665f 656c 656d 2c20 7870  ls, ref_elem, xp
+0000ed30: 6174 682c 2073 7479 6c65 3d22 746f 7022  ath, style="top"
+0000ed40: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
+0000ed50: 2020 2020 2020 2066 696e 6473 2061 206c         finds a l
+0000ed60: 696e 6520 7769 7468 2063 6f6e 7374 616e  ine with constan
+0000ed70: 7420 6469 6666 6572 656e 6365 2066 726f  t difference fro
+0000ed80: 6d20 746f 7020 6f66 2070 6167 650a 3c64  m top of page.<d
+0000ed90: 6976 2073 7479 6c65 3d22 746f 703a 2035  iv style="top: 5
+0000eda0: 3070 783b 223e 3c61 206e 616d 653d 2231  0px;"><a name="1
+0000edb0: 223e 5061 6765 2031 3c2f 613e 3c2f 6469  ">Page 1</a></di
+0000edc0: 763e 0a20 2020 2020 2020 2022 2222 0a20  v>.        """. 
+0000edd0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+0000ede0: 2020 204d 6179 6265 206d 6f76 6520 746f     Maybe move to
+0000edf0: 2048 544d 4c54 6964 790a 2020 2020 2020   HTMLTidy.      
+0000ee00: 2020 2222 220a 0a20 2020 2020 2020 2065    """..        e
+0000ee10: 6c65 6d73 203d 2072 6566 5f65 6c65 6d2e  lems = ref_elem.
+0000ee20: 7870 6174 6828 7870 6174 6829 0a20 2020  xpath(xpath).   
+0000ee30: 2020 2020 2063 6f6f 7264 7320 3d20 5b5d       coords = []
+0000ee40: 0a20 2020 2020 2020 2066 6f72 2065 6c65  .        for ele
+0000ee50: 6d20 696e 2065 6c65 6d73 3a0a 2020 2020  m in elems:.    
+0000ee60: 2020 2020 2020 2020 6373 735f 7374 796c          css_styl
+0000ee70: 6520 3d20 4353 5353 7479 6c65 2e63 7265  e = CSSStyle.cre
+0000ee80: 6174 655f 6373 735f 7374 796c 655f 6672  ate_css_style_fr
+0000ee90: 6f6d 5f61 7474 7269 6275 7465 5f6f 665f  om_attribute_of_
+0000eea0: 626f 6479 5f65 6c65 6d65 6e74 2865 6c65  body_element(ele
+0000eeb0: 6d29 0a20 2020 2020 2020 2020 2020 2063  m).            c
+0000eec0: 6f6f 7264 203d 2063 7373 5f73 7479 6c65  oord = css_style
+0000eed0: 2e6e 616d 655f 7661 6c75 655f 6469 6374  .name_value_dict
+0000eee0: 2e67 6574 2873 7479 6c65 290a 2020 2020  .get(style).    
+0000eef0: 2020 2020 2020 2020 6966 2063 6f6f 7264          if coord
+0000ef00: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000ef10: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
+0000ef20: 2020 2020 2020 2020 2020 2063 6f6f 7264             coord
+0000ef30: 732e 6170 7065 6e64 2866 6c6f 6174 2863  s.append(float(c
+0000ef40: 6f6f 7264 5b3a 2d32 5d29 290a 2020 2020  oord[:-2])).    
+0000ef50: 2020 2020 2020 2020 2020 2020 6578 6365              exce
+0000ef60: 7074 2045 7863 6570 7469 6f6e 3a0a 2020  pt Exception:.  
+0000ef70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ef80: 2020 6c6f 6767 696e 672e 7761 726e 696e    logging.warnin
+0000ef90: 6728 6622 6361 6e6e 6f74 2070 6172 7365  g(f"cannot parse
+0000efa0: 207b 636f 6f72 647d 2066 6f72 207b 7374   {coord} for {st
+0000efb0: 796c 657d 2229 0a20 2020 2020 2020 2069  yle}").        i
+0000efc0: 6620 6e6f 7420 636f 6f72 6473 3a0a 2020  f not coords:.  
+0000efd0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0000efe0: 204e 6f6e 652c 204e 6f6e 652c 205b 5d0a   None, None, [].
+0000eff0: 2020 2020 2020 2020 6e70 5f63 6f6f 7264          np_coord
+0000f000: 7320 3d20 6e70 2e61 7272 6179 2863 6f6f  s = np.array(coo
+0000f010: 7264 7329 0a0a 2020 2020 2020 2020 7820  rds)..        x 
+0000f020: 3d20 6e70 2e61 7272 6179 2872 616e 6765  = np.array(range
+0000f030: 286e 705f 636f 6f72 6473 2e73 697a 6529  (np_coords.size)
+0000f040: 292e 7265 7368 6170 6528 282d 312c 2031  ).reshape((-1, 1
+0000f050: 2929 0a20 2020 2020 2020 206d 6f64 656c  )).        model
+0000f060: 203d 204c 696e 6561 7252 6567 7265 7373   = LinearRegress
+0000f070: 696f 6e28 292e 6669 7428 782c 2063 6f6f  ion().fit(x, coo
+0000f080: 7264 7329 0a20 2020 2020 2020 2072 5f73  rds).        r_s
+0000f090: 7120 3d20 6d6f 6465 6c2e 7363 6f72 6528  q = model.score(
+0000f0a0: 782c 2063 6f6f 7264 7329 0a20 2020 2020  x, coords).     
+0000f0b0: 2020 2069 6620 725f 7371 203c 2030 2e39     if r_sq < 0.9
+0000f0c0: 383a 0a20 2020 2020 2020 2020 2020 206c  8:.            l
+0000f0d0: 6f67 6769 6e67 2e77 6172 6e69 6e67 2866  ogging.warning(f
+0000f0e0: 2263 616e 6e6f 7420 6361 6c63 756c 6174  "cannot calculat
+0000f0f0: 6520 6f66 6673 6574 2072 656c 6961 626c  e offset reliabl
+0000f100: 7922 290a 2020 2020 2020 2020 7265 7475  y").        retu
+0000f110: 726e 206d 6f64 656c 2e69 6e74 6572 6365  rn model.interce
+0000f120: 7074 5f2c 206d 6f64 656c 2e63 6f65 665f  pt_, model.coef_
+0000f130: 2c20 6e70 5f63 6f6f 7264 730a 0a20 2020  , np_coords..   
+0000f140: 2040 636c 6173 736d 6574 686f 640a 2020   @classmethod.  
+0000f150: 2020 6465 6620 7265 6d6f 7665 5f75 6e77    def remove_unw
+0000f160: 616e 7465 6473 2863 6c73 2c20 746f 705f  anteds(cls, top_
+0000f170: 656c 656d 2c20 756e 7761 6e74 6564 7329  elem, unwanteds)
+0000f180: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+0000f190: 2020 2020 2020 4d61 7962 6520 6d6f 7665        Maybe move
+0000f1a0: 2074 6f20 4854 4d4c 5469 6479 0a20 2020   to HTMLTidy.   
+0000f1b0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0000f1c0: 2069 6620 6e6f 7420 756e 7761 6e74 6564   if not unwanted
+0000f1d0: 733a 0a20 2020 2020 2020 2020 2020 206c  s:.            l
+0000f1e0: 6f67 6769 6e67 2e77 6172 6e69 6e67 2866  ogging.warning(f
+0000f1f0: 226e 6f20 756e 7761 6e74 6564 7320 746f  "no unwanteds to
+0000f200: 2072 656d 6f76 6522 290a 2020 2020 2020   remove").      
+0000f210: 2020 2020 2020 7265 7475 726e 0a20 2020        return.   
+0000f220: 2020 2020 2066 6f72 206b 6579 2069 6e20       for key in 
+0000f230: 756e 7761 6e74 6564 733a 0a20 2020 2020  unwanteds:.     
+0000f240: 2020 2020 2020 2075 6e77 616e 7465 6420         unwanted 
+0000f250: 3d20 756e 7761 6e74 6564 735b 6b65 795d  = unwanteds[key]
+0000f260: 0a20 2020 2020 2020 2020 2020 2078 7061  .            xpa
+0000f270: 7468 203d 2075 6e77 616e 7465 645b 555f  th = unwanted[U_
+0000f280: 5850 4154 485d 0a20 2020 2020 2020 2020  XPATH].         
+0000f290: 2020 2069 6620 7870 6174 683a 0a20 2020     if xpath:.   
+0000f2a0: 2020 2020 2020 2020 2020 2020 2072 6567               reg
+0000f2b0: 6578 203d 2075 6e77 616e 7465 645b 555f  ex = unwanted[U_
+0000f2c0: 5245 4745 585d 0a20 2020 2020 2020 2020  REGEX].         
+0000f2d0: 2020 2020 2020 2072 6567 6578 5f63 6f6d         regex_com
+0000f2e0: 7020 3d20 7265 2e63 6f6d 7069 6c65 2872  p = re.compile(r
+0000f2f0: 6567 6578 2920 6966 2072 6567 6578 2065  egex) if regex e
+0000f300: 6c73 6520 4e6f 6e65 0a20 2020 2020 2020  lse None.       
+0000f310: 2020 2020 2020 2020 2065 6c65 6d73 203d           elems =
+0000f320: 2074 6f70 5f65 6c65 6d2e 7870 6174 6828   top_elem.xpath(
+0000f330: 7870 6174 6829 0a20 2020 2020 2020 2020  xpath).         
+0000f340: 2020 2020 2020 2066 6f72 2065 6c65 6d20         for elem 
+0000f350: 696e 2065 6c65 6d73 3a0a 2020 2020 2020  in elems:.      
+0000f360: 2020 2020 2020 2020 2020 2020 2020 7465                te
+0000f370: 7874 203d 2048 746d 6c55 7469 6c2e 6765  xt = HtmlUtil.ge
+0000f380: 745f 7465 7874 5f63 6f6e 7465 6e74 2865  t_text_content(e
+0000f390: 6c65 6d29 0a20 2020 2020 2020 2020 2020  lem).           
+0000f3a0: 2020 2020 2020 2020 206d 6174 6368 6564           matched
+0000f3b0: 203d 2072 6567 6578 5f63 6f6d 702e 7365   = regex_comp.se
+0000f3c0: 6172 6368 2874 6578 7429 2069 6620 7265  arch(text) if re
+0000f3d0: 6765 785f 636f 6d70 2065 6c73 6520 5472  gex_comp else Tr
+0000f3e0: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
+0000f3f0: 2020 2020 2020 2069 6620 6d61 7463 6865         if matche
+0000f400: 643a 0a20 2020 2020 2020 2020 2020 2020  d:.             
+0000f410: 2020 2020 2020 2020 2020 2063 6c73 2e72             cls.r
+0000f420: 656d 6f76 655f 656c 656d 5f6b 6565 705f  emove_elem_keep_
+0000f430: 7461 696c 2865 6c65 6d29 0a0a 2020 2020  tail(elem)..    
+0000f440: 4063 6c61 7373 6d65 7468 6f64 0a20 2020  @classmethod.   
+0000f450: 2064 6566 2072 656d 6f76 655f 6e65 776c   def remove_newl
+0000f460: 696e 6573 2863 6c73 2c20 656c 656d 293a  ines(cls, elem):
+0000f470: 0a20 2020 2020 2020 2022 2222 7265 6d6f  .        """remo
+0000f480: 7665 205c 6e22 2222 0a20 2020 2020 2020  ve \n""".       
+0000f490: 2022 2222 0a20 2020 2020 2020 204d 6179   """.        May
+0000f4a0: 6265 206d 6f76 6520 746f 2048 544d 4c54  be move to HTMLT
+0000f4b0: 6964 790a 2020 2020 2020 2020 2222 220a  idy.        """.
+0000f4c0: 0a20 2020 2020 2020 2066 6f72 2065 6c20  .        for el 
+0000f4d0: 696e 2065 6c65 6d2e 7870 6174 6828 222e  in elem.xpath(".
+0000f4e0: 2f2f 2a5b 6e6f 7428 2a29 5d22 293a 0a20  //*[not(*)]"):. 
+0000f4f0: 2020 2020 2020 2020 2020 2074 6578 7420             text 
+0000f500: 3d20 4874 6d6c 5574 696c 2e67 6574 5f74  = HtmlUtil.get_t
+0000f510: 6578 745f 636f 6e74 656e 7428 656c 290a  ext_content(el).
+0000f520: 2020 2020 2020 2020 2020 2020 7465 7874              text
+0000f530: 3120 3d20 7465 7874 2e72 6570 6c61 6365  1 = text.replace
+0000f540: 2827 5c6e 272c 2027 2729 0a20 2020 2020  ('\n', '').     
+0000f550: 2020 2020 2020 2069 6620 7465 7874 3120         if text1 
+0000f560: 213d 2074 6578 743a 0a20 2020 2020 2020  != text:.       
+0000f570: 2020 2020 2020 2020 2065 6c2e 7465 7874           el.text
+0000f580: 203d 2074 6578 7431 0a0a 2020 2020 4063   = text1..    @c
+0000f590: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
+0000f5a0: 6566 2072 656d 6f76 655f 7374 796c 6528  ef remove_style(
+0000f5b0: 636c 732c 2078 7061 7468 5f72 6f6f 745f  cls, xpath_root_
+0000f5c0: 656c 656d 2c20 6e61 6d65 7329 3a0a 2020  elem, names):.  
+0000f5d0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0000f5e0: 2020 7265 6d6f 7665 7320 6e61 6d65 2d76    removes name-v
+0000f5f0: 616c 7565 2070 6169 7273 2066 726f 6d20  alue pairs from 
+0000f600: 6373 732d 7374 796c 6520 616e 6420 7265  css-style and re
+0000f610: 6170 706c 7920 746f 2078 7061 7468 2765  apply to xpath'e
+0000f620: 6420 656c 656d 656e 7473 2222 220a 2020  d elements""".  
+0000f630: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0000f640: 2020 4d61 7962 6520 6d6f 7665 2074 6f20    Maybe move to 
+0000f650: 4854 4d4c 5469 6479 0a20 2020 2020 2020  HTMLTidy.       
+0000f660: 2022 2222 0a0a 2020 2020 2020 2020 7870   """..        xp
+0000f670: 6174 6820 3d20 6622 2e2f 2f2a 5b40 7374  ath = f".//*[@st
+0000f680: 796c 655d 220a 2020 2020 2020 2020 7472  yle]".        tr
+0000f690: 793a 0a20 2020 2020 2020 2020 2020 2073  y:.            s
+0000f6a0: 7479 6c65 645f 656c 656d 7320 3d20 7870  tyled_elems = xp
+0000f6b0: 6174 685f 726f 6f74 5f65 6c65 6d2e 7870  ath_root_elem.xp
+0000f6c0: 6174 6828 7870 6174 6829 0a20 2020 2020  ath(xpath).     
+0000f6d0: 2020 2065 7863 6570 7420 4554 2e58 5061     except ET.XPa
+0000f6e0: 7468 4576 616c 4572 726f 7220 6173 2078  thEvalError as x
+0000f6f0: 7065 653a 0a20 2020 2020 2020 2020 2020  pee:.           
+0000f700: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
+0000f710: 7228 6622 4261 6420 7870 6174 6820 7b78  r(f"Bad xpath {x
+0000f720: 7061 7468 7d22 290a 0a20 2020 2020 2020  path}")..       
+0000f730: 2066 6f72 2073 7479 6c65 645f 656c 656d   for styled_elem
+0000f740: 2069 6e20 7374 796c 6564 5f65 6c65 6d73   in styled_elems
+0000f750: 3a0a 2020 2020 2020 2020 2020 2020 6373  :.            cs
+0000f760: 735f 7374 796c 6520 3d20 4353 5353 7479  s_style = CSSSty
+0000f770: 6c65 2e63 7265 6174 655f 6373 735f 7374  le.create_css_st
+0000f780: 796c 655f 6672 6f6d 5f61 7474 7269 6275  yle_from_attribu
+0000f790: 7465 5f6f 665f 626f 6479 5f65 6c65 6d65  te_of_body_eleme
+0000f7a0: 6e74 2873 7479 6c65 645f 656c 656d 290a  nt(styled_elem).
+0000f7b0: 2020 2020 2020 2020 2020 2020 6373 735f              css_
+0000f7c0: 7374 796c 652e 7265 6d6f 7665 286e 616d  style.remove(nam
+0000f7d0: 6573 290a 2020 2020 2020 2020 2020 2020  es).            
+0000f7e0: 6373 735f 7374 796c 652e 6170 706c 795f  css_style.apply_
+0000f7f0: 746f 2873 7479 6c65 645f 656c 656d 290a  to(styled_elem).
+0000f800: 2020 2020 2020 2020 2020 2020 7374 796c              styl
+0000f810: 6520 3d20 4874 6d6c 5374 796c 652e 6765  e = HtmlStyle.ge
+0000f820: 745f 6373 7373 7479 6c65 5f73 7472 696e  t_cssstyle_strin
+0000f830: 6728 7374 796c 6564 5f65 6c65 6d29 0a0a  g(styled_elem)..
+0000f840: 2020 2020 4063 6c61 7373 6d65 7468 6f64      @classmethod
+0000f850: 0a20 2020 2064 6566 2065 7874 7261 6374  .    def extract
+0000f860: 5f73 7562 7374 7269 6e67 7328 636c 732c  _substrings(cls,
+0000f870: 2065 6c65 6d2c 2078 7061 7468 3d4e 6f6e   elem, xpath=Non
+0000f880: 652c 2072 6567 6578 3d4e 6f6e 652c 2072  e, regex=None, r
+0000f890: 656d 6f76 653d 4661 6c73 652c 2069 6e63  emove=False, inc
+0000f8a0: 6c75 6465 5f6e 6f6e 653d 4661 6c73 652c  lude_none=False,
+0000f8b0: 2061 6464 5f69 643d 4661 6c73 6529 3a0a   add_id=False):.
+0000f8c0: 2020 2020 2020 2020 2222 2267 6574 7320          """gets 
+0000f8d0: 7375 6273 7472 696e 6720 6672 6f6d 2062  substring from b
+0000f8e0: 6f64 7920 6f66 2074 6578 7420 696e 2065  ody of text in e
+0000f8f0: 6c65 6d0a 2020 2020 2020 2020 7265 6765  lem.        rege
+0000f900: 7820 6f66 2066 6f72 6d20 283f 503c 7072  x of form (?P<pr
+0000f910: 653e 2928 3f50 3c62 6f64 793e 2928 3f50  e>)(?P<body>)(?P
+0000f920: 3c70 6f73 743e 290a 2020 2020 2020 2020  <post>).        
+0000f930: 7072 6520 616e 6420 6f72 2070 6f73 7420  pre and or post 
+0000f940: 6361 6e20 6265 206d 6973 7369 6e67 0a20  can be missing. 
+0000f950: 2020 2020 2020 2028 5468 6572 6520 7769         (There wi
+0000f960: 6c6c 2062 6520 6265 7474 6572 2077 6179  ll be better way
+0000f970: 7320 6f66 2064 6f69 6e67 2074 6869 7321  s of doing this!
+0000f980: 290a 2020 2020 2020 2020 3a70 6172 616d  ).        :param
+0000f990: 2065 6c65 6d3a 746f 2071 7565 7279 0a20   elem:to query. 
+0000f9a0: 2020 2020 2020 203a 7061 7261 6d20 7870         :param xp
+0000f9b0: 6174 683a 2074 6f20 6669 6e64 2064 6573  ath: to find des
+0000f9c0: 6365 6e64 616e 7420 7375 6265 6c65 6d65  cendant subeleme
+0000f9d0: 6e74 0a20 2020 2020 2020 203a 7061 7261  nt.        :para
+0000f9e0: 6d20 7265 6765 783a 2074 6f20 6669 6e64  m regex: to find
+0000f9f0: 2073 7472 696e 6720 696e 2073 7562 656c   string in subel
+0000fa00: 656d 656e 7420 286d 7573 7420 6861 7665  ement (must have
+0000fa10: 2033 2063 6170 7475 7265 2067 726f 7570   3 capture group
+0000fa20: 7329 0a20 2020 2020 2020 203a 7061 7261  s).        :para
+0000fa30: 6d20 7265 6d6f 7665 3a20 7265 6d6f 7665  m remove: remove
+0000fa40: 7320 626f 6479 2074 6578 7420 616e 6420  s body text and 
+0000fa50: 6a6f 696e 7320 7072 6520 746f 2070 6f73  joins pre to pos
+0000fa60: 7420 2875 7365 2077 6974 6820 6361 7265  t (use with care
+0000fa70: 2c20 6465 6661 756c 7420 4661 6c73 6529  , default False)
+0000fa80: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+0000fa90: 696e 636c 7564 655f 6e6f 6e65 3a20 4966  include_none: If
+0000faa0: 2074 7275 6520 696e 636c 7564 6520 6661   true include fa
+0000fab0: 696c 6564 206d 6174 6368 6573 2061 7320  iled matches as 
+0000fac0: 4e6f 6e65 3b20 6465 6661 756c 7420 4661  None; default Fa
+0000fad0: 6c73 650a 2020 2020 2020 2020 3a70 6172  lse.        :par
+0000fae0: 616d 5f61 6464 5f69 643a 2061 6464 2065  am_add_id: add e
+0000faf0: 7874 7261 6374 6564 2074 6578 7420 6173  xtracted text as
+0000fb00: 2061 7474 7269 6275 7465 206f 6e20 7375   attribute on su
+0000fb10: 6265 6c65 6d65 6e74 0a20 2020 2020 2020  belement.       
+0000fb20: 2069 6620 7072 6520 616e 6420 7461 696c   if pre and tail
+0000fb30: 2061 7265 2070 7265 7365 6e74 2c20 656c   are present, el
+0000fb40: 656d 2e74 6578 7420 3d3c 2070 7265 2b70  em.text =< pre+p
+0000fb50: 6f73 740a 2020 2020 2020 2020 6966 2070  ost.        if p
+0000fb60: 7265 2069 7320 6d69 7373 696e 6720 656c  re is missing el
+0000fb70: 656d 2e74 6578 7420 3d3e 2070 6f73 740a  em.text => post.
+0000fb80: 2020 2020 2020 2020 6966 2074 6169 6c20          if tail 
+0000fb90: 6973 206d 6973 7369 6e67 2065 6c65 6d2e  is missing elem.
+0000fba0: 7465 7874 203d 3e20 7072 650a 2020 2020  text => pre.    
+0000fbb0: 2020 2020 6966 2062 6f74 6820 6172 6520      if both are 
+0000fbc0: 6d69 7373 696e 6720 6e6f 2072 656d 6f76  missing no remov
+0000fbd0: 616c 0a20 2020 2020 2020 203a 7265 7475  al.        :retu
+0000fbe0: 726e 3a20 7265 6765 782e 6d61 7463 682e  rn: regex.match.
+0000fbf0: 6772 6f75 7069 6e64 6578 283f 503c 626f  groupindex(?P<bo
+0000fc00: 6479 3e29 2069 6620 6d61 7463 6865 6420  dy>) if matched 
+0000fc10: 656c 7365 204e 6f6e 650a 2020 2020 2020  else None.      
+0000fc20: 2020 2222 220a 2020 2020 2020 2020 7375    """.        su
+0000fc30: 625f 656c 656d 7320 3d20 656c 656d 2e78  b_elems = elem.x
+0000fc40: 7061 7468 2878 7061 7468 290a 2020 2020  path(xpath).    
+0000fc50: 2020 2020 7375 625f 656c 656d 203d 2073      sub_elem = s
+0000fc60: 7562 5f65 6c65 6d73 5b30 5d20 6966 206c  ub_elems[0] if l
+0000fc70: 656e 2873 7562 5f65 6c65 6d73 2920 3e20  en(sub_elems) > 
+0000fc80: 3020 656c 7365 204e 6f6e 650a 2020 2020  0 else None.    
+0000fc90: 2020 2020 7375 6273 7472 696e 6773 203d      substrings =
+0000fca0: 205b 5d0a 2020 2020 2020 2020 7265 3020   [].        re0 
+0000fcb0: 3d20 7265 2e63 6f6d 7069 6c65 2872 6567  = re.compile(reg
+0000fcc0: 6578 290a 2020 2020 2020 2020 666f 7220  ex).        for 
+0000fcd0: 7375 625f 656c 656d 2069 6e20 7375 625f  sub_elem in sub_
+0000fce0: 656c 656d 733a 0a20 2020 2020 2020 2020  elems:.         
+0000fcf0: 2020 2073 7562 7374 7269 6e67 203d 2063     substring = c
+0000fd00: 6c73 2e65 7874 7261 6374 5f73 7562 7374  ls.extract_subst
+0000fd10: 7269 6e67 2872 6530 2c20 7265 6d6f 7665  ring(re0, remove
+0000fd20: 2c20 7375 625f 656c 656d 290a 2020 2020  , sub_elem).    
+0000fd30: 2020 2020 2020 2020 6966 2073 7562 7374          if subst
+0000fd40: 7269 6e67 2061 6e64 2061 6464 5f69 643a  ring and add_id:
+0000fd50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000fd60: 2073 7562 5f65 6c65 6d2e 6174 7472 6962   sub_elem.attrib
+0000fd70: 5b22 6964 225d 203d 2073 7562 7374 7269  ["id"] = substri
+0000fd80: 6e67 0a20 2020 2020 2020 2020 2020 2069  ng.            i
+0000fd90: 6620 7375 6273 7472 696e 6720 6f72 2069  f substring or i
+0000fda0: 6e63 6c75 6465 5f6e 6f6e 653a 0a20 2020  nclude_none:.   
+0000fdb0: 2020 2020 2020 2020 2020 2020 2073 7562               sub
+0000fdc0: 7374 7269 6e67 732e 6170 7065 6e64 2873  strings.append(s
+0000fdd0: 7562 7374 7269 6e67 290a 2020 2020 2020  ubstring).      
+0000fde0: 2020 7265 7475 726e 2073 7562 7374 7269    return substri
+0000fdf0: 6e67 730a 0a20 2020 2040 636c 6173 736d  ngs..    @classm
+0000fe00: 6574 686f 640a 2020 2020 6465 6620 6578  ethod.    def ex
+0000fe10: 7472 6163 745f 7375 6273 7472 696e 6728  tract_substring(
+0000fe20: 636c 732c 2072 6530 2c20 7265 6d6f 7665  cls, re0, remove
+0000fe30: 2c20 7375 625f 656c 656d 293a 0a20 2020  , sub_elem):.   
+0000fe40: 2020 2020 206d 6174 6368 203d 2072 6530       match = re0
+0000fe50: 2e6d 6174 6368 2873 7562 5f65 6c65 6d2e  .match(sub_elem.
+0000fe60: 7465 7874 290a 2020 2020 2020 2020 7375  text).        su
+0000fe70: 6273 7472 696e 6720 3d20 4e6f 6e65 0a20  bstring = None. 
+0000fe80: 2020 2020 2020 2069 6620 6d61 7463 683a         if match:
+0000fe90: 0a20 2020 2020 2020 2020 2020 2073 7562  .            sub
+0000fea0: 7374 7269 6e67 203d 206d 6174 6368 2e67  string = match.g
+0000feb0: 726f 7570 2822 626f 6479 2229 0a20 2020  roup("body").   
+0000fec0: 2020 2020 2020 2020 2069 6620 7265 6d6f           if remo
+0000fed0: 7665 3a0a 2020 2020 2020 2020 2020 2020  ve:.            
+0000fee0: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+0000fef0: 2020 2020 2020 2020 2020 2020 2070 7265               pre
+0000ff00: 203d 206d 6174 6368 2e67 726f 7570 2822   = match.group("
+0000ff10: 7072 6522 290a 2020 2020 2020 2020 2020  pre").          
+0000ff20: 2020 2020 2020 2020 2020 706f 7374 203d            post =
+0000ff30: 206d 6174 6368 2e67 726f 7570 2822 706f   match.group("po
+0000ff40: 7374 2229 0a20 2020 2020 2020 2020 2020  st").           
+0000ff50: 2020 2020 2020 2020 2073 7562 5f65 6c65           sub_ele
+0000ff60: 6d2e 7465 7874 203d 2070 7265 202b 2070  m.text = pre + p
+0000ff70: 6f73 740a 2020 2020 2020 2020 2020 2020  ost.            
+0000ff80: 2020 2020 6578 6365 7074 3a0a 2020 2020      except:.    
+0000ff90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ffa0: 7061 7373 0a20 2020 2020 2020 2072 6574  pass.        ret
+0000ffb0: 7572 6e20 7375 6273 7472 696e 670a 0a20  urn substring.. 
+0000ffc0: 2020 2040 636c 6173 736d 6574 686f 640a     @classmethod.
+0000ffd0: 2020 2020 6465 6620 6765 745f 666c 6f61      def get_floa
+0000ffe0: 7428 636c 732c 2065 6c65 6d2c 2061 7474  t(cls, elem, att
+0000fff0: 7269 625f 6e61 6d65 293a 0a20 2020 2020  rib_name):.     
+00010000: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+00010010: 2020 2020 7661 6c20 3d20 656c 656d 2e61      val = elem.a
+00010020: 7474 7269 625b 6174 7472 6962 5f6e 616d  ttrib[attrib_nam
+00010030: 655d 0a20 2020 2020 2020 2020 2020 2072  e].            r
+00010040: 6574 7572 6e20 666c 6f61 7428 7661 6c29  eturn float(val)
+00010050: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
+00010060: 4578 6365 7074 696f 6e20 6173 2065 3a0a  Exception as e:.
+00010070: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00010080: 726e 204e 6f6e 650a 0a20 2020 2040 636c  rn None..    @cl
+00010090: 6173 736d 6574 686f 640a 2020 2020 6465  assmethod.    de
+000100a0: 6620 6368 6563 6b5f 7461 6728 636c 732c  f check_tag(cls,
+000100b0: 2065 6c65 6d2c 2074 6167 293a 0a20 2020   elem, tag):.   
+000100c0: 2020 2020 2022 2222 6368 6563 6b73 2074       """checks t
+000100d0: 6861 7420 656c 656d 2069 7320 616e 2045  hat elem is an E
+000100e0: 6c65 6d65 6e74 2077 6974 6820 6769 7665  lement with give
+000100f0: 6e20 7461 6722 2222 0a20 2020 2020 2020  n tag""".       
+00010100: 2072 6574 7572 6e20 7479 7065 2865 6c65   return type(ele
+00010110: 6d29 2069 7320 4554 2e5f 456c 656d 656e  m) is ET._Elemen
+00010120: 7420 616e 6420 656c 656d 2e74 6167 203d  t and elem.tag =
+00010130: 3d20 7461 670a 0a20 2020 2040 636c 6173  = tag..    @clas
+00010140: 736d 6574 686f 640a 2020 2020 6465 6620  smethod.    def 
+00010150: 6765 745f 6964 2863 6c73 2c20 6469 7629  get_id(cls, div)
+00010160: 3a0a 2020 2020 2020 2020 2222 2267 6574  :.        """get
+00010170: 7320 7661 6c75 6520 6f66 2022 6964 2220  s value of "id" 
+00010180: 6174 7472 6962 7574 650a 2020 2020 2020  attribute.      
+00010190: 2020 2222 220a 2020 2020 2020 2020 7265    """.        re
+000101a0: 7475 726e 204e 6f6e 6520 6966 2064 6976  turn None if div
+000101b0: 2069 7320 4e6f 6e65 2065 6c73 6520 6469   is None else di
+000101c0: 762e 6174 7472 6962 2e67 6574 2822 6964  v.attrib.get("id
+000101d0: 2229 0a0a 2020 2020 4063 6c61 7373 6d65  ")..    @classme
+000101e0: 7468 6f64 0a20 2020 2064 6566 2061 6e61  thod.    def ana
+000101f0: 6c79 7a65 5f73 7479 6c65 7328 636c 732c  lyze_styles(cls,
+00010200: 2065 6c65 6d29 3a0a 2020 2020 2020 2020   elem):.        
+00010210: 6865 6164 5f73 7479 6c65 5f65 6c65 6d73  head_style_elems
+00010220: 203d 2048 746d 6c53 7479 6c65 2e67 6574   = HtmlStyle.get
+00010230: 5f68 6561 645f 7374 796c 6573 2865 6c65  _head_styles(ele
+00010240: 6d29 0a20 2020 2020 2020 2070 7269 6e74  m).        print
+00010250: 2866 2268 6561 6420 7374 796c 6520 656c  (f"head style el
+00010260: 656d 7320 7b6c 656e 2868 6561 645f 7374  ems {len(head_st
+00010270: 796c 655f 656c 656d 7329 7d22 290a 2020  yle_elems)}").  
+00010280: 2020 2020 2020 626f 6479 5f63 6c61 7373        body_class
+00010290: 7265 6673 203d 2048 746d 6c53 7479 6c65  refs = HtmlStyle
+000102a0: 2e67 6574 5f62 6f64 795f 636c 6173 7372  .get_body_classr
+000102b0: 6566 7328 656c 656d 290a 2020 2020 2020  efs(elem).      
+000102c0: 2020 7072 696e 7428 6622 626f 6479 2063    print(f"body c
+000102d0: 6c61 7373 7265 6673 207b 6c65 6e28 626f  lassrefs {len(bo
+000102e0: 6479 5f63 6c61 7373 7265 6673 297d 2229  dy_classrefs)}")
+000102f0: 0a20 2020 2020 2020 2066 6f6e 745f 7369  .        font_si
+00010300: 7a65 5f64 6963 7420 3d20 6465 6661 756c  ze_dict = defaul
+00010310: 7464 6963 7428 6c69 7374 290a 2020 2020  tdict(list).    
+00010320: 2020 2020 6661 6d69 6c79 5f64 6963 7420      family_dict 
+00010330: 3d20 6465 6661 756c 7464 6963 7428 6c69  = defaultdict(li
+00010340: 7374 290a 2020 2020 2020 2020 666f 7220  st).        for 
+00010350: 6865 6164 5f73 7479 6c65 5f65 6c65 6d20  head_style_elem 
+00010360: 696e 2068 6561 645f 7374 796c 655f 656c  in head_style_el
+00010370: 656d 733a 0a20 2020 2020 2020 2020 2020  ems:.           
+00010380: 2068 6561 645f 7374 796c 652c 2063 7373   head_style, css
+00010390: 7374 7220 3d20 4874 6d6c 5374 796c 652e  str = HtmlStyle.
+000103a0: 6578 7472 6163 745f 636c 6173 7372 6566  extract_classref
+000103b0: 5f61 6e64 5f63 7373 7374 7269 6e67 5f66  _and_cssstring_f
+000103c0: 726f 6d5f 6874 6d6c 5f73 7479 6c65 2868  rom_html_style(h
+000103d0: 6561 645f 7374 796c 655f 656c 656d 290a  ead_style_elem).
+000103e0: 2020 2020 2020 2020 2020 2020 6373 735f              css_
+000103f0: 7374 796c 6520 3d20 4353 5353 7479 6c65  style = CSSStyle
+00010400: 2e63 7265 6174 655f 6373 735f 7374 796c  .create_css_styl
+00010410: 655f 6672 6f6d 5f63 7373 5f73 7472 696e  e_from_css_strin
+00010420: 6728 6373 7373 7472 290a 2020 2020 2020  g(cssstr).      
+00010430: 2020 2020 2020 666f 6e74 5f73 697a 6520        font_size 
+00010440: 3d20 6373 735f 7374 796c 652e 666f 6e74  = css_style.font
+00010450: 5f73 697a 650a 2020 2020 2020 2020 2020  _size.          
+00010460: 2020 666f 6e74 5f73 697a 655f 6469 6374    font_size_dict
+00010470: 5b73 7472 2866 6f6e 745f 7369 7a65 295d  [str(font_size)]
+00010480: 2e61 7070 656e 6428 6373 7373 7472 290a  .append(cssstr).
+00010490: 2020 2020 2020 2020 2020 2020 666f 6e74              font
+000104a0: 5f66 616d 696c 7920 3d20 6373 735f 7374  _family = css_st
+000104b0: 796c 652e 666f 6e74 5f66 616d 696c 790a  yle.font_family.
+000104c0: 2020 2020 2020 2020 2020 2020 6661 6d69              fami
+000104d0: 6c79 5f64 6963 745b 666f 6e74 5f66 616d  ly_dict[font_fam
+000104e0: 696c 795d 2e61 7070 656e 6428 6373 7373  ily].append(csss
+000104f0: 7472 290a 0a20 2020 2020 2020 2020 2020  tr)..           
+00010500: 2062 6f64 795f 656c 656d 7320 3d20 636c   body_elems = cl
+00010510: 732e 6765 745f 626f 6479 5f65 6c65 6d65  s.get_body_eleme
+00010520: 6e74 735f 6279 5f63 6c61 7373 2865 6c65  nts_by_class(ele
+00010530: 6d2c 2068 6561 645f 7374 796c 6529 0a20  m, head_style). 
+00010540: 2020 2020 2020 2020 2020 2062 6f64 795f             body_
+00010550: 656c 656d 735f 7374 7220 3d20 275c 6e20  elems_str = '\n 
+00010560: 2020 2020 272e 6a6f 696e 285b 656c 656d      '.join([elem
+00010570: 2e74 6578 7420 666f 7220 656c 656d 2069  .text for elem i
+00010580: 6e20 626f 6479 5f65 6c65 6d73 5b3a 335d  n body_elems[:3]
+00010590: 5d29 0a20 2020 2020 2020 2020 2020 2070  ]).            p
+000105a0: 7269 6e74 2866 227b 6865 6164 5f73 7479  rint(f"{head_sty
+000105b0: 6c65 7d3a 207b 6c65 6e28 626f 6479 5f65  le}: {len(body_e
+000105c0: 6c65 6d73 297d 207b 6373 7373 7472 7d5c  lems)} {cssstr}\
+000105d0: 6e20 2020 2020 7b62 6f64 795f 656c 656d  n     {body_elem
+000105e0: 735f 7374 727d 2229 0a20 2020 2020 2020  s_str}").       
+000105f0: 2070 7072 696e 7428 6622 7369 7a65 207b   pprint(f"size {
+00010600: 666f 6e74 5f73 697a 655f 6469 6374 7d22  font_size_dict}"
+00010610: 290a 2020 2020 2020 2020 7072 696e 7428  ).        print(
+00010620: 290a 2020 2020 2020 2020 666f 7220 7369  ).        for si
+00010630: 7a65 2069 6e20 666f 6e74 5f73 697a 655f  ze in font_size_
+00010640: 6469 6374 3a0a 2020 2020 2020 2020 2020  dict:.          
+00010650: 2020 666f 6e74 7320 3d20 666f 6e74 5f73    fonts = font_s
+00010660: 697a 655f 6469 6374 5b73 697a 655d 0a20  ize_dict[size]. 
+00010670: 2020 2020 2020 2020 2020 2069 6620 7479             if ty
+00010680: 7065 2866 6f6e 7473 2920 6973 206c 6973  pe(fonts) is lis
+00010690: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
+000106a0: 2020 2070 7269 6e74 2866 2273 697a 6520     print(f"size 
+000106b0: 7b6c 656e 2866 6f6e 7473 297d 2022 290a  {len(fonts)} ").
+000106c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000106d0: 666f 6e74 737a 203d 2027 5c6e 272e 6a6f  fontsz = '\n'.jo
+000106e0: 696e 2866 6f6e 7473 290a 2020 2020 2020  in(fonts).      
+000106f0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00010700: 2020 2020 2020 2020 2020 2020 666f 6e74              font
+00010710: 737a 203d 2066 6f6e 7473 0a20 2020 2020  sz = fonts.     
+00010720: 2020 2020 2020 2070 7269 6e74 2866 2220         print(f" 
+00010730: 207b 7369 7a65 7d20 3d3e 2020 7b66 6f6e   {size} =>  {fon
+00010740: 7473 7a7d 2229 0a20 2020 2020 2020 2070  tsz}").        p
+00010750: 7269 6e74 2829 0a20 2020 2020 2020 2070  rint().        p
+00010760: 7072 696e 7428 6622 6661 6d69 6c79 207b  print(f"family {
+00010770: 6661 6d69 6c79 5f64 6963 747d 2229 0a0a  family_dict}")..
+00010780: 2020 2020 4063 6c61 7373 6d65 7468 6f64      @classmethod
+00010790: 0a20 2020 2064 6566 2061 6e61 6c79 7a65  .    def analyze
+000107a0: 5f63 6f6f 7264 696e 6174 6573 2863 6c73  _coordinates(cls
+000107b0: 2c20 656c 656d 293a 0a20 2020 2020 2020  , elem):.       
+000107c0: 2023 2068 6561 645f 7374 796c 655f 656c   # head_style_el
+000107d0: 656d 7320 3d20 4874 6d6c 5374 796c 652e  ems = HtmlStyle.
+000107e0: 6765 745f 6865 6164 5f73 7479 6c65 7328  get_head_styles(
+000107f0: 656c 656d 290a 2020 2020 2020 2020 2320  elem).        # 
+00010800: 7072 696e 7428 6622 6865 6164 2073 7479  print(f"head sty
+00010810: 6c65 2065 6c65 6d73 207b 6c65 6e28 6865  le elems {len(he
+00010820: 6164 5f73 7479 6c65 5f65 6c65 6d73 297d  ad_style_elems)}
+00010830: 2229 0a20 2020 2020 2020 2023 2062 6f64  ").        # bod
+00010840: 795f 7374 796c 6573 203d 2048 746d 6c53  y_styles = HtmlS
+00010850: 7479 6c65 2e67 6574 5f62 6f64 795f 636c  tyle.get_body_cl
+00010860: 6173 7372 6566 7328 656c 656d 290a 2020  assrefs(elem).  
+00010870: 2020 2020 2020 2320 7072 696e 7428 6622        # print(f"
+00010880: 626f 6479 2073 7479 6c65 7320 7b6c 656e  body styles {len
+00010890: 2862 6f64 795f 7374 796c 6573 297d 2229  (body_styles)}")
+000108a0: 0a20 2020 2020 2020 206d 6178 6368 6172  .        maxchar
+000108b0: 203d 2035 300a 0a20 2020 2020 2020 2063   = 50..        c
+000108c0: 6c73 2e67 6574 5f6c 7274 6228 656c 656d  ls.get_lrtb(elem
+000108d0: 2c20 226c 6566 7422 290a 2020 2020 2020  , "left").      
+000108e0: 2020 636c 732e 6765 745f 6c72 7462 2865    cls.get_lrtb(e
+000108f0: 6c65 6d2c 2022 7269 6768 7422 290a 2020  lem, "right").  
+00010900: 2020 2020 2020 636c 732e 6765 745f 6c72        cls.get_lr
+00010910: 7462 2865 6c65 6d2c 2022 7930 222c 2063  tb(elem, "y0", c
+00010920: 6f6c 3d30 290a 2020 2020 2020 2020 636c  ol=0).        cl
+00010930: 732e 6765 745f 6c72 7462 2865 6c65 6d2c  s.get_lrtb(elem,
+00010940: 2022 746f 7022 2c20 6d61 7267 696e 3d38   "top", margin=8
+00010950: 3029 0a0a 2020 2020 4063 6c61 7373 6d65  0)..    @classme
+00010960: 7468 6f64 0a20 2020 2064 6566 2067 6574  thod.    def get
+00010970: 5f6c 7274 6228 636c 732c 2065 6c65 6d2c  _lrtb(cls, elem,
+00010980: 2064 6972 6563 7469 6f6e 2c20 6d61 7863   direction, maxc
+00010990: 6861 723d 3530 2c20 6d69 6e5f 636f 756e  har=50, min_coun
+000109a0: 743d 3130 2c20 6d61 785f 7465 7874 733d  t=10, max_texts=
+000109b0: 332c 206d 6172 6769 6e3d 3830 2c0a 2020  3, margin=80,.  
+000109c0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+000109d0: 6564 6961 626f 783d 5b5b 302c 2031 3030  ediabox=[[0, 100
+000109e0: 305d 2c20 5b30 2c20 3130 3030 5d5d 2c20  0], [0, 1000]], 
+000109f0: 636f 6c3d 3129 3a0a 2020 2020 2020 2020  col=1):.        
+00010a00: 656c 656d 7320 3d20 4874 6d6c 4c69 622e  elems = HtmlLib.
+00010a10: 6765 745f 626f 6479 2865 6c65 6d29 2e78  get_body(elem).x
+00010a20: 7061 7468 2866 222e 2f2f 2a5b 407b 6469  path(f".//*[@{di
+00010a30: 7265 6374 696f 6e7d 5d22 290a 2020 2020  rection}]").    
+00010a40: 2020 2020 6469 6374 7820 3d20 6465 6661      dictx = defa
+00010a50: 756c 7464 6963 7428 6c69 7374 290a 2020  ultdict(list).  
+00010a60: 2020 2020 2020 666f 7220 656c 656d 2069        for elem i
+00010a70: 6e20 656c 656d 733a 0a20 2020 2020 2020  n elems:.       
+00010a80: 2020 2020 206c 6566 7420 3d20 4874 6d6c       left = Html
+00010a90: 5574 696c 2e67 6574 5f66 6c6f 6174 2865  Util.get_float(e
+00010aa0: 6c65 6d2c 2064 6972 6563 7469 6f6e 290a  lem, direction).
+00010ab0: 2020 2020 2020 2020 2020 2020 6966 206c              if l
+00010ac0: 6566 743a 0a20 2020 2020 2020 2020 2020  eft:.           
+00010ad0: 2020 2020 2064 6963 7478 5b6c 6566 745d       dictx[left]
+00010ae0: 2e61 7070 656e 6428 656c 656d 290a 2020  .append(elem).  
+00010af0: 2020 2020 2020 7072 696e 7428 6622 5c6e        print(f"\n
+00010b00: 7b64 6972 6563 7469 6f6e 7d22 290a 2020  {direction}").  
+00010b10: 2020 2020 2020 726f 7773 203d 205b 5d0a        rows = [].
+00010b20: 2020 2020 2020 2020 666f 7220 6b65 7920          for key 
+00010b30: 696e 2064 6963 7478 2e6b 6579 7328 293a  in dictx.keys():
+00010b40: 0a20 2020 2020 2020 2020 2020 2065 6c65  .            ele
+00010b50: 6d73 203d 2064 6963 7478 5b6b 6579 5d0a  ms = dictx[key].
+00010b60: 2020 2020 2020 2020 2020 2020 7465 7874              text
+00010b70: 7320 3d20 5b65 6c65 6d2e 7870 6174 6828  s = [elem.xpath(
+00010b80: 222e 2f2f 7465 7874 2829 2229 5b30 5d5b  ".//text()")[0][
+00010b90: 3a6d 6178 6368 6172 5d20 666f 7220 656c  :maxchar] for el
+00010ba0: 656d 2069 6e20 656c 656d 735d 0a20 2020  em in elems].   
+00010bb0: 2020 2020 2020 2020 2065 6c65 6d63 6f75           elemcou
+00010bc0: 6e74 203d 206c 656e 2865 6c65 6d73 290a  nt = len(elems).
+00010bd0: 2020 2020 2020 2020 2020 2020 6966 2065              if e
+00010be0: 6c65 6d63 6f75 6e74 203e 206d 696e 5f63  lemcount > min_c
+00010bf0: 6f75 6e74 3a0a 2020 2020 2020 2020 2020  ount:.          
+00010c00: 2020 2020 2020 7465 7874 735f 203d 2074        texts_ = t
+00010c10: 6578 7473 5b3a 6d61 785f 7465 7874 735d  exts[:max_texts]
+00010c20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010c30: 2070 7269 6e74 2866 227b 6b65 797d 3a20   print(f"{key}: 
+00010c40: 7b65 6c65 6d63 6f75 6e74 7d20 7b74 6578  {elemcount} {tex
+00010c50: 7473 5f7d 2229 0a20 2020 2020 2020 2020  ts_}").         
+00010c60: 2020 2020 2020 2072 6f77 732e 6170 7065         rows.appe
+00010c70: 6e64 285b 6b65 792c 2065 6c65 6d63 6f75  nd([key, elemcou
+00010c80: 6e74 2c20 7465 7874 735f 5d29 0a20 2020  nt, texts_]).   
+00010c90: 2020 2020 2072 6f77 735f 203d 2073 6f72       rows_ = sor
+00010ca0: 7465 6428 726f 7773 2c20 6b65 793d 6c61  ted(rows, key=la
+00010cb0: 6d62 6461 2063 3a20 635b 636f 6c5d 290a  mbda c: c[col]).
+00010cc0: 2020 2020 2020 2020 7072 696e 7428 6622          print(f"
+00010cd0: 726f 7773 5c6e 7b72 6f77 735f 7d22 290a  rows\n{rows_}").
+00010ce0: 0a20 2020 2020 2020 2023 2073 6f72 7465  .        # sorte
+00010cf0: 6428 7374 7564 656e 745f 7475 706c 6573  d(student_tuples
+00010d00: 2c20 6b65 793d 6c61 6d62 6461 2073 7475  , key=lambda stu
+00010d10: 6465 6e74 3a20 7374 7564 656e 745b 325d  dent: student[2]
+00010d20: 290a 0a20 2020 2040 636c 6173 736d 6574  )..    @classmet
+00010d30: 686f 640a 2020 2020 6465 6620 6765 745f  hod.    def get_
+00010d40: 626f 6479 5f65 6c65 6d65 6e74 735f 6279  body_elements_by
+00010d50: 5f63 6c61 7373 2863 6c73 2c20 656c 656d  _class(cls, elem
+00010d60: 2c20 6865 6164 5f73 7479 6c65 293a 0a20  , head_style):. 
+00010d70: 2020 2020 2020 2069 6620 6865 6164 5f73         if head_s
+00010d80: 7479 6c65 2e73 7461 7274 7377 6974 6828  tyle.startswith(
+00010d90: 272e 2729 3a0a 2020 2020 2020 2020 2020  '.'):.          
+00010da0: 2020 6865 6164 5f73 7479 6c65 203d 2068    head_style = h
+00010db0: 6561 645f 7374 796c 655b 313a 5d0a 2020  ead_style[1:].  
+00010dc0: 2020 2020 2020 626f 6479 5f65 6c65 6d73        body_elems
+00010dd0: 203d 2065 6c65 6d2e 7870 6174 6828 6622   = elem.xpath(f"
+00010de0: 2e2f 626f 6479 2f2f 2a5b 4063 6c61 7373  ./body//*[@class
+00010df0: 3d27 7b68 6561 645f 7374 796c 657d 275d  ='{head_style}']
+00010e00: 2229 0a20 2020 2020 2020 2072 6574 7572  ").        retur
+00010e10: 6e20 626f 6479 5f65 6c65 6d73 0a0a 2020  n body_elems..  
+00010e20: 2020 4063 6c61 7373 6d65 7468 6f64 0a20    @classmethod. 
+00010e30: 2020 2064 6566 2063 6c65 616e 5f77 7269     def clean_wri
+00010e40: 7465 5f68 746d 6c28 636c 732c 2069 6e5f  te_html(cls, in_
+00010e50: 6874 6d6c 2c20 6f75 745f 6874 6d6c 2c20  html, out_html, 
+00010e60: 7072 6574 7479 5f70 7269 6e74 3d54 7275  pretty_print=Tru
+00010e70: 6529 3a0a 2020 2020 2020 2020 2222 220a  e):.        """.
+00010e80: 2020 2020 2020 2020 5061 7273 6520 7261          Parse ra
+00010e90: 7720 4854 4d4c 2028 6e6f 7420 616c 7761  w HTML (not alwa
+00010ea0: 7973 2077 656c 6c2d 666f 726d 6564 2920  ys well-formed) 
+00010eb0: 2c20 6d61 6b65 2077 656c 6c66 6f72 6d65  , make wellforme
+00010ec0: 6420 616e 6420 6f70 7469 6f6e 616c 6c79  d and optionally
+00010ed0: 2070 7265 7474 7920 7072 696e 740a 2020   pretty print.  
+00010ee0: 2020 2020 2020 3a70 6172 616d 2069 6e5f        :param in_
+00010ef0: 6874 6d6c 3a20 696e 7075 7420 6874 6d6c  html: input html
+00010f00: 2066 696c 650a 2020 2020 2020 2020 3a70   file.        :p
+00010f10: 6172 616d 206f 7574 5f68 746d 6c3a 206f  aram out_html: o
+00010f20: 7574 7075 7420 6669 6c65 0a20 2020 2020  utput file.     
+00010f30: 2020 203a 7061 7261 6d20 7072 6574 7479     :param pretty
+00010f40: 5f70 7269 6e74 3a20 6f75 7470 7574 2066  _print: output f
+00010f50: 6f72 6d61 740a 2020 2020 2020 2020 3a72  ormat.        :r
+00010f60: 6574 7572 6e3a 2070 6172 7365 6420 6874  eturn: parsed ht
+00010f70: 6d6c 2065 6c65 6d65 6e74 0a20 2020 2020  ml element.     
+00010f80: 2020 2022 2222 0a20 2020 2020 2020 2068     """.        h
+00010f90: 746d 6c5f 656c 656d 203d 2063 6c73 2e70  tml_elem = cls.p
+00010fa0: 6172 7365 5f68 746d 6c5f 6669 6c65 5f74  arse_html_file_t
+00010fb0: 6f5f 786d 6c28 696e 5f68 746d 6c29 0a20  o_xml(in_html). 
+00010fc0: 2020 2020 2020 2063 6c73 2e77 7269 7465         cls.write
+00010fd0: 5f68 746d 6c5f 656c 656d 2868 746d 6c5f  _html_elem(html_
+00010fe0: 656c 656d 2c20 6f75 745f 6874 6d6c 2c20  elem, out_html, 
+00010ff0: 7072 6574 7479 5f70 7269 6e74 3d70 7265  pretty_print=pre
+00011000: 7474 795f 7072 696e 7429 0a20 2020 2020  tty_print).     
+00011010: 2020 2072 6574 7572 6e20 6874 6d6c 5f65     return html_e
+00011020: 6c65 6d0a 0a20 2020 2040 636c 6173 736d  lem..    @classm
+00011030: 6574 686f 640a 2020 2020 6465 6620 7061  ethod.    def pa
+00011040: 7273 655f 6874 6d6c 5f66 696c 655f 746f  rse_html_file_to
+00011050: 5f78 6d6c 2863 6c73 2c20 696e 5f68 746d  _xml(cls, in_htm
+00011060: 6c29 3a0a 2020 2020 2020 2020 2222 2272  l):.        """r
+00011070: 6561 6420 756e 7469 6479 2048 544d 4c20  ead untidy HTML 
+00011080: 696e 746f 2058 4d4c 0a20 2020 2020 2020  into XML.       
+00011090: 2075 7365 7320 4854 4d4c 5061 7273 6572   uses HTMLParser
+000110a0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+000110b0: 696e 5f68 746d 6c3a 2048 544d 4c20 6669  in_html: HTML fi
+000110c0: 6c65 0a20 2020 2020 2020 203a 7265 7475  le.        :retu
+000110d0: 726e 3a20 7765 6c6c 5f66 6f72 6d65 6420  rn: well_formed 
+000110e0: 5848 544d 4c0a 2020 2020 2020 2020 2222  XHTML.        ""
+000110f0: 220a 2020 2020 2020 2020 6874 6d6c 5f65  ".        html_e
+00011100: 6c65 6d20 3d20 4554 2e70 6172 7365 2873  lem = ET.parse(s
+00011110: 7472 2869 6e5f 6874 6d6c 292c 2045 542e  tr(in_html), ET.
+00011120: 4854 4d4c 5061 7273 6572 2829 292e 7870  HTMLParser()).xp
+00011130: 6174 6828 222f 2a22 295b 305d 0a20 2020  ath("/*")[0].   
+00011140: 2020 2020 2072 6574 7572 6e20 6874 6d6c       return html
+00011150: 5f65 6c65 6d0a 0a20 2020 2040 636c 6173  _elem..    @clas
+00011160: 736d 6574 686f 640a 2020 2020 6465 6620  smethod.    def 
+00011170: 7772 6974 655f 6874 6d6c 5f65 6c65 6d28  write_html_elem(
+00011180: 636c 732c 2065 6c65 6d2c 206f 7574 5f68  cls, elem, out_h
+00011190: 746d 6c2c 2070 7265 7474 795f 7072 696e  tml, pretty_prin
+000111a0: 743d 4661 6c73 6529 3a0a 2020 2020 2020  t=False):.      
+000111b0: 2020 2222 2277 7269 7465 2048 544d 4c20    """write HTML 
+000111c0: 7769 7468 206f 7074 696f 6e61 6c20 7072  with optional pr
+000111d0: 6574 7479 5f70 7269 6e74 0a20 2020 2020  etty_print.     
+000111e0: 2020 203a 7061 7261 6d20 656c 656d 3a20     :param elem: 
+000111f0: 4854 4d4c 2065 6c65 6d65 6e74 0a20 2020  HTML element.   
+00011200: 2020 2020 203a 7061 7261 6d20 6f75 745f       :param out_
+00011210: 6874 6d6c 3a20 6569 7468 6572 2061 2066  html: either a f
+00011220: 696c 6520 6f72 2073 7973 2e73 7464 6f75  ile or sys.stdou
+00011230: 740a 2020 2020 2020 2020 3a70 6172 616d  t.        :param
+00011240: 2070 7265 7474 795f 7072 696e 743a 0a20   pretty_print:. 
+00011250: 2020 2020 2020 2022 7265 7475 726e 3a20         "return: 
+00011260: 4e6f 6e65 0a20 2020 2020 2020 2022 2222  None.        """
+00011270: 0a20 2020 2020 2020 2069 6620 6f75 745f  .        if out_
+00011280: 6874 6d6c 203d 3d20 7379 732e 7374 646f  html == sys.stdo
+00011290: 7574 3a0a 2020 2020 2020 2020 2020 2020  ut:.            
+000112a0: 7072 696e 7428 4554 2e74 6f73 7472 696e  print(ET.tostrin
+000112b0: 6728 656c 656d 2c20 7072 6574 7479 5f70  g(elem, pretty_p
+000112c0: 7269 6e74 3d54 7275 652c 2065 6e63 6f64  rint=True, encod
+000112d0: 696e 673d 2275 6e69 636f 6465 2229 290a  ing="unicode")).
+000112e0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+000112f0: 2020 2020 2020 2020 2020 7373 203d 2045            ss = E
+00011300: 542e 746f 7374 7269 6e67 2865 6c65 6d2c  T.tostring(elem,
+00011310: 2070 7265 7474 795f 7072 696e 743d 7072   pretty_print=pr
+00011320: 6574 7479 5f70 7269 6e74 290a 2020 2020  etty_print).    
+00011330: 2020 2020 2020 2020 5061 7468 286f 7574          Path(out
+00011340: 5f68 746d 6c29 2e70 6172 656e 742e 6d6b  _html).parent.mk
+00011350: 6469 7228 7061 7265 6e74 733d 5472 7565  dir(parents=True
+00011360: 2c20 6578 6973 745f 6f6b 3d54 7275 6529  , exist_ok=True)
+00011370: 0a20 2020 2020 2020 2020 2020 2077 6974  .            wit
+00011380: 6820 6f70 656e 286f 7574 5f68 746d 6c2c  h open(out_html,
+00011390: 2022 7762 2229 2061 7320 663a 0a20 2020   "wb") as f:.   
+000113a0: 2020 2020 2020 2020 2020 2020 2066 2e77               f.w
+000113b0: 7269 7465 2873 7329 0a0a 2020 2020 4063  rite(ss)..    @c
+000113c0: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
+000113d0: 6566 2072 656d 6f76 655f 7374 796c 655f  ef remove_style_
+000113e0: 6174 7472 6962 7574 6573 2863 6c73 2c20  attributes(cls, 
+000113f0: 6874 6d6c 5f65 6c65 6d29 3a0a 2020 2020  html_elem):.    
+00011400: 2020 2020 2222 2272 656d 6f76 6520 4073      """remove @s
+00011410: 7479 6c65 2061 7474 7269 6275 7465 7320  tyle attributes 
+00011420: 6672 6f6d 2065 6c65 6d65 6e74 7320 696e  from elements in
+00011430: 2068 746d 6c5f 656c 656d 0a20 2020 2020   html_elem.     
+00011440: 2020 203a 7061 7261 6d20 6874 6d6c 5f65     :param html_e
+00011450: 6c65 6d3a 2065 6c65 6d65 6e74 2074 6f20  lem: element to 
+00011460: 7374 7269 700a 2020 2020 2020 2020 2222  strip.        ""
+00011470: 220a 2020 2020 2020 2020 6966 2068 746d  ".        if htm
+00011480: 6c5f 656c 656d 2069 7320 4e6f 6e65 3a0a  l_elem is None:.
+00011490: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+000114a0: 726e 0a20 2020 2020 2020 2073 7479 6c65  rn.        style
+000114b0: 5f65 6c65 6d73 203d 2068 746d 6c5f 656c  _elems = html_el
+000114c0: 656d 2e78 7061 7468 2822 2e2f 2f2a 5b40  em.xpath(".//*[@
+000114d0: 7374 796c 655d 2229 0a20 2020 2020 2020  style]").       
+000114e0: 2066 6f72 2073 7479 6c65 5f65 6c65 6d20   for style_elem 
+000114f0: 696e 2073 7479 6c65 5f65 6c65 6d73 3a0a  in style_elems:.
+00011500: 2020 2020 2020 2020 2020 2020 4874 6d6c              Html
+00011510: 5574 696c 2e72 656d 6f76 655f 6174 7472  Util.remove_attr
+00011520: 6962 7574 6528 7374 796c 655f 656c 656d  ibute(style_elem
+00011530: 2c20 2273 7479 6c65 2229 0a0a 2020 2020  , "style")..    
+00011540: 4063 6c61 7373 6d65 7468 6f64 0a20 2020  @classmethod.   
+00011550: 2064 6566 2072 656d 6f76 655f 656c 656d   def remove_elem
+00011560: 7328 636c 732c 2068 746d 6c5f 656c 656d  s(cls, html_elem
+00011570: 2c20 7870 6174 683d 4e6f 6e65 293a 0a20  , xpath=None):. 
+00011580: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00011590: 2020 2072 656d 6f76 6520 656c 656d 656e     remove elemen
+000115a0: 7473 2062 7920 7870 6174 680a 2020 2020  ts by xpath.    
+000115b0: 2020 2020 3a70 6172 616d 2068 746d 6c5f      :param html_
+000115c0: 656c 656d 3a20 656c 656d 656e 7420 746f  elem: element to
+000115d0: 2072 656d 6f76 6520 656c 656d 656e 7420   remove element 
+000115e0: 6672 6f6d 0a20 2020 2020 2020 203a 7061  from.        :pa
+000115f0: 7261 6d20 7870 6174 683a 0a20 2020 2020  ram xpath:.     
+00011600: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
+00011610: 6620 6874 6d6c 5f65 6c65 6d20 6973 204e  f html_elem is N
+00011620: 6f6e 6520 6f72 2078 7061 7468 2069 7320  one or xpath is 
+00011630: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00011640: 2020 7265 7475 726e 0a20 2020 2020 2020    return.       
+00011650: 2065 6c65 6d73 203d 2068 746d 6c5f 656c   elems = html_el
+00011660: 656d 2e78 7061 7468 2878 7061 7468 290a  em.xpath(xpath).
+00011670: 2020 2020 2020 2020 666f 7220 656c 656d          for elem
+00011680: 2069 6e20 656c 656d 733a 0a20 2020 2020   in elems:.     
+00011690: 2020 2020 2020 2048 746d 6c55 7469 6c2e         HtmlUtil.
+000116a0: 7265 6d6f 7665 5f65 6c65 6d5f 6b65 6570  remove_elem_keep
+000116b0: 5f74 6169 6c28 656c 656d 290a 0a20 2020  _tail(elem)..   
+000116c0: 2040 636c 6173 736d 6574 686f 640a 2020   @classmethod.  
+000116d0: 2020 6465 6620 7265 6d6f 7665 5f65 6c65    def remove_ele
+000116e0: 6d65 6e74 5f69 6e5f 6869 6572 6172 6368  ment_in_hierarch
+000116f0: 7928 636c 732c 2065 6c65 6d29 3a0a 2020  y(cls, elem):.  
+00011700: 2020 2020 2020 2222 2272 656d 6f76 6573        """removes
+00011710: 2064 6976 7320 6672 6f6d 206e 6573 7469   divs from nesti
+00011720: 6e67 0a20 2020 2020 2020 2045 7861 6d70  ng.        Examp
+00011730: 6c65 3a0a 2020 2020 2020 2020 2020 2020  le:.            
+00011740: 3c64 6976 2069 643d 2264 3122 3e0a 2020  <div id="d1">.  
+00011750: 2020 2020 2020 2020 2020 2020 3c64 6976              <div
+00011760: 2069 643d 2264 3222 3e0a 2020 2020 2020   id="d2">.      
+00011770: 2020 2020 2020 2020 2020 3c73 7061 6e20            <span 
+00011780: 6964 3d22 7331 223e 626c 6168 3c2f 7370  id="s1">blah</sp
+00011790: 616e 3e0a 2020 2020 2020 2020 2020 2020  an>.            
+000117a0: 2020 3c2f 6469 763e 0a20 2020 2020 2020    </div>.       
+000117b0: 2020 2020 203c 2f64 6976 3e0a 2020 2020       </div>.    
+000117c0: 2020 2020 2020 2020 6132 2069 7320 706c          a2 is pl
+000117d0: 6179 696e 6720 6e6f 2072 6f6c 6520 696e  aying no role in
+000117e0: 2067 726f 7570 696e 672c 2073 6f20 6361   grouping, so ca
+000117f0: 6e20 6265 2072 656d 6f76 6564 2074 6f20  n be removed to 
+00011800: 6769 7665 3a0a 2020 2020 2020 2020 2020  give:.          
+00011810: 2020 3c64 6976 2069 643d 2264 3122 3e0a    <div id="d1">.
+00011820: 2020 2020 2020 2020 2020 2020 2020 3c73                <s
+00011830: 7061 6e20 6964 3d22 7331 223e 626c 6168  pan id="s1">blah
+00011840: 3c2f 7370 616e 3e0a 2020 2020 2020 2020  </span>.        
+00011850: 2020 2020 3c2f 6469 763e 0a20 2020 2020      </div>.     
+00011860: 2020 2020 2020 2054 6869 7320 6361 6e20         This can 
+00011870: 6265 2072 6563 7572 7369 7665 2062 7574  be recursive but
+00011880: 2073 7061 6e73 2073 686f 756c 6420 616c   spans should al
+00011890: 7761 7973 2068 6176 6520 6469 7620 7061  ways have div pa
+000118a0: 7265 6e74 730a 2020 2020 2020 2020 2020  rents.          
+000118b0: 2020 3a70 6172 616d 2065 6c65 6d3a 2065    :param elem: e
+000118c0: 6c65 6d20 746f 2072 656d 6f76 652e 2049  lem to remove. I
+000118d0: 7473 2063 6869 6c64 7265 6e20 6172 6520  ts children are 
+000118e0: 7472 616e 7366 6572 6564 2074 6f20 7061  transfered to pa
+000118f0: 7265 6e74 0a20 2020 2020 2020 2020 2020  rent.           
+00011900: 2065 2e67 2e0a 2020 2020 2020 2020 2020   e.g..          
+00011910: 2020 7028 612c 656c 656d 286c 2c6d 2c6e    p(a,elem(l,m,n
+00011920: 292c 7a29 203d 3e20 7028 612c 6c2c 6d2c  ),z) => p(a,l,m,
+00011930: 6e2c 7a29 0a20 2020 2020 2020 2020 2020  n,z).           
+00011940: 203a 7265 7475 726e 3a4e 6f6e 650a 2020   :return:None.  
+00011950: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00011960: 2020 7061 7265 6e74 203d 2065 6c65 6d2e    parent = elem.
+00011970: 6765 7470 6172 656e 7428 290a 2020 2020  getparent().    
+00011980: 2020 2020 6966 2070 6172 656e 7420 6973      if parent is
+00011990: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+000119a0: 2020 2070 7269 6e74 2866 2265 6c65 6d20     print(f"elem 
+000119b0: 6861 7320 6e6f 2070 6172 656e 7422 290a  has no parent").
+000119c0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+000119d0: 726e 0a20 2020 2020 2020 2069 6478 203d  rn.        idx =
+000119e0: 2070 6172 656e 742e 696e 6465 7828 656c   parent.index(el
+000119f0: 656d 290a 2020 2020 2020 2020 6368 696c  em).        chil
+00011a00: 645f 656c 656d 7320 3d20 656c 656d 2e78  d_elems = elem.x
+00011a10: 7061 7468 2822 2a22 290a 2020 2020 2020  path("*").      
+00011a20: 2020 666f 7220 6368 696c 645f 656c 656d    for child_elem
+00011a30: 2069 6e20 6368 696c 645f 656c 656d 733a   in child_elems:
+00011a40: 0a20 2020 2020 2020 2020 2020 2070 6172  .            par
+00011a50: 656e 742e 696e 7365 7274 2869 6478 2c20  ent.insert(idx, 
+00011a60: 6368 696c 645f 656c 656d 290a 2020 2020  child_elem).    
+00011a70: 2020 2020 7061 7265 6e74 2e72 656d 6f76      parent.remov
+00011a80: 6528 656c 656d 290a 0a20 2020 2040 636c  e(elem)..    @cl
+00011a90: 6173 736d 6574 686f 640a 2020 2020 6465  assmethod.    de
+00011aa0: 6620 7265 6d6f 7665 5f65 6c65 6d65 6e74  f remove_element
+00011ab0: 735f 696e 5f68 6965 7261 7263 6879 5f62  s_in_hierarchy_b
+00011ac0: 795f 7870 6174 6828 636c 732c 2068 746d  y_xpath(cls, htm
+00011ad0: 6c2c 2078 7061 7468 293a 0a20 2020 2020  l, xpath):.     
+00011ae0: 2020 2022 2222 6669 6e64 7320 656c 656d     """finds elem
+00011af0: 656e 7473 2062 7920 7870 6174 6820 616e  ents by xpath an
+00011b00: 6420 6465 6c65 7465 7320 7468 656d 2075  d deletes them u
+00011b10: 7369 6e67 2072 656d 6f76 655f 656c 656d  sing remove_elem
+00011b20: 656e 7473 5f69 6e5f 6869 6572 6172 6368  ents_in_hierarch
+00011b30: 7928 290a 2020 2020 2020 2020 3a70 6172  y().        :par
+00011b40: 616d 2068 746d 6c3a 2065 6c65 6d65 6e74  am html: element
+00011b50: 7320 746f 2064 656c 6574 6520 6672 6f6d  s to delete from
+00011b60: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+00011b70: 7870 6174 683a 2078 7061 7468 2074 6f20  xpath: xpath to 
+00011b80: 7365 6172 6368 2077 6974 680a 2020 2020  search with.    
+00011b90: 2020 2020 3a72 6574 7572 6e3a 2065 6c65      :return: ele
+00011ba0: 6d73 2074 6861 7420 6861 7665 2062 6565  ms that have bee
+00011bb0: 6e20 6465 6c65 7465 640a 2020 2020 2020  n deleted.      
+00011bc0: 2020 2222 220a 2020 2020 2020 2020 656c    """.        el
+00011bd0: 656d 7320 3d20 6874 6d6c 2e78 7061 7468  ems = html.xpath
+00011be0: 2878 7061 7468 290a 2020 2020 2020 2020  (xpath).        
+00011bf0: 666f 7220 656c 656d 2069 6e20 656c 656d  for elem in elem
+00011c00: 733a 0a20 2020 2020 2020 2020 2020 2048  s:.            H
+00011c10: 746d 6c55 7469 6c2e 7265 6d6f 7665 5f65  tmlUtil.remove_e
+00011c20: 6c65 6d65 6e74 5f69 6e5f 6869 6572 6172  lement_in_hierar
+00011c30: 6368 7928 656c 656d 290a 2020 2020 2020  chy(elem).      
+00011c40: 2020 7265 7475 726e 2065 6c65 6d73 0a0a    return elems..
+00011c50: 0a63 6c61 7373 2048 746d 6c41 6e6e 6f74  .class HtmlAnnot
+00011c60: 6174 6f72 3a0a 2020 2020 2222 2269 6e6c  ator:.    """inl
+00011c70: 696e 6520 616e 6e6f 7461 746f 7220 666f  ine annotator fo
+00011c80: 7220 4854 4d4c 2065 6c65 6d65 6e74 730a  r HTML elements.
+00011c90: 2020 2020 7374 6f72 6573 2061 6e64 2072      stores and r
+00011ca0: 756e 7320 416e 6e6f 7461 746f 7243 6f6d  uns AnnotatorCom
+00011cb0: 6d61 6e64 730a 0a20 2020 2061 6e6e 6f74  mands..    annot
+00011cc0: 6174 6f72 203d 2041 6e6e 6f74 6174 6f72  ator = Annotator
+00011cd0: 2829 0a20 2020 2063 6f6d 6d61 6e64 203d  ().    command =
+00011ce0: 2041 6e6e 6f74 6174 6f72 436f 6d6d 616e   AnnotatorComman
+00011cf0: 6428 6874 6d6c 5f63 6c61 7373 3d22 7365  d(html_class="se
+00011d00: 6374 696f 6e5f 7469 746c 6522 2c20 7265  ction_title", re
+00011d10: 6765 783d 2253 6563 7469 6f6e 5c5c 732b  gex="Section\\s+
+00011d20: 283f 503c 6964 3e5c 5c64 2b29 3a5c 5c73  (?P<id>\\d+):\\s
+00011d30: 2b28 3f50 3c74 6974 6c65 3e2e 2a29 222c  +(?P<title>.*)",
+00011d40: 2061 6464 5f69 643d 5472 7565 2c20 6164   add_id=True, ad
+00011d50: 645f 7469 746c 653d 5472 7565 290a 2020  d_title=True).  
+00011d60: 2020 616e 6e6f 7461 746f 722e 6164 645f    annotator.add_
+00011d70: 636f 6d6d 616e 6428 636f 6d6d 616e 6429  command(command)
+00011d80: 0a20 2020 2061 6e6e 6f74 6174 6f72 2e72  .    annotator.r
+00011d90: 756e 5f63 6f6d 6d61 6e64 7328 656c 656d  un_commands(elem
+00011da0: 290a 0a20 2020 2022 2222 0a0a 2020 2020  )..    """..    
+00011db0: 6465 6620 5f5f 696e 6974 5f5f 2873 656c  def __init__(sel
+00011dc0: 6629 3a0a 2020 2020 2020 2020 7365 6c66  f):.        self
+00011dd0: 2e63 6f6d 6d61 6e64 7320 3d20 5b5d 0a0a  .commands = []..
+00011de0: 2020 2020 6465 6620 6164 645f 636f 6d6d      def add_comm
+00011df0: 616e 6428 7365 6c66 2c20 636f 6d6d 616e  and(self, comman
+00011e00: 6429 3a0a 2020 2020 2020 2020 6966 2063  d):.        if c
+00011e10: 6f6d 6d61 6e64 3a0a 2020 2020 2020 2020  ommand:.        
+00011e20: 2020 2020 7365 6c66 2e63 6f6d 6d61 6e64      self.command
+00011e30: 732e 6170 7065 6e64 2863 6f6d 6d61 6e64  s.append(command
+00011e40: 290a 0a20 2020 2064 6566 2072 756e 5f63  )..    def run_c
+00011e50: 6f6d 6d61 6e64 7328 7365 6c66 2c20 7461  ommands(self, ta
+00011e60: 7267 6574 5f65 6c65 6d29 3a0a 2020 2020  rget_elem):.    
+00011e70: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00011e80: 6974 6572 6174 6520 636f 6d6d 616e 6473  iterate commands
+00011e90: 2028 6f72 6465 7220 6973 206f 7264 6572   (order is order
+00011ea0: 206f 6620 7468 6569 7220 6164 6469 7469   of their additi
+00011eb0: 6f6e 0a20 2020 2020 2020 2022 2222 0a20  on.        """. 
+00011ec0: 2020 2020 2020 2066 6f72 2063 6f6d 6d61         for comma
+00011ed0: 6e64 2069 6e20 7365 6c66 2e63 6f6d 6d61  nd in self.comma
+00011ee0: 6e64 733a 0a20 2020 2020 2020 2020 2020  nds:.           
+00011ef0: 2063 6f6d 6d61 6e64 2e72 756e 5f63 6f6d   command.run_com
+00011f00: 6d61 6e64 2874 6172 6765 745f 656c 656d  mand(target_elem
+00011f10: 290a 0a20 2020 2040 636c 6173 736d 6574  )..    @classmet
+00011f20: 686f 640a 2020 2020 6465 6620 6372 6561  hod.    def crea
+00011f30: 7465 5f69 7063 635f 616e 6e6f 7461 746f  te_ipcc_annotato
+00011f40: 7228 636c 7329 3a0a 2020 2020 2020 2020  r(cls):.        
+00011f50: 2222 2261 2073 6574 206f 6620 6765 6e65  """a set of gene
+00011f60: 7261 6c20 6f70 6572 6174 696f 6e73 2066  ral operations f
+00011f70: 6f72 2049 5043 4322 2222 0a20 2020 2020  or IPCC""".     
+00011f80: 2020 2061 6e6e 6f74 6174 6f72 203d 2048     annotator = H
+00011f90: 746d 6c41 6e6e 6f74 6174 6f72 2829 0a20  tmlAnnotator(). 
+00011fa0: 2020 2020 2020 2061 6e6e 6f74 6174 6f72         annotator
+00011fb0: 2e61 6464 5f63 6f6d 6d61 6e64 280a 2020  .add_command(.  
+00011fc0: 2020 2020 2020 2020 2020 416e 6e6f 7461            Annota
+00011fd0: 746f 7243 6f6d 6d61 6e64 2868 746d 6c5f  torCommand(html_
+00011fe0: 636c 6173 733d 2273 6563 7469 6f6e 5f74  class="section_t
+00011ff0: 6974 6c65 222c 2072 6567 6578 3d22 5365  itle", regex="Se
+00012000: 6374 696f 6e5c 5c73 2b28 3f50 3c69 643e  ction\\s+(?P<id>
+00012010: 5c5c 642b 293a 5c5c 732b 283f 503c 7469  \\d+):\\s+(?P<ti
+00012020: 746c 653e 2e2a 2922 2c0a 2020 2020 2020  tle>.*)",.      
+00012030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012040: 2020 2020 2020 2061 6464 5f69 643d 2273         add_id="s
+00012050: 6563 7469 6f6e 5f7c 222c 2061 6464 5f74  ection_|", add_t
+00012060: 6974 6c65 3d22 7c22 2c20 7374 796c 653d  itle="|", style=
+00012070: 227b 636f 6c6f 7220 3a20 626c 7565 3b20  "{color : blue; 
+00012080: 6261 636b 6772 6f75 6e64 203a 2070 696e  background : pin
+00012090: 6b3b 7d22 2c0a 2020 2020 2020 2020 2020  k;}",.          
+000120a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000120b0: 2020 2064 6573 633d 2261 6464 2069 6420     desc="add id 
+000120c0: 616e 6420 7469 746c 6520 666f 7220 2753  and title for 'S
+000120d0: 6563 7469 6f6e 3a20 2e2e 2e27 2229 0a20  ection: ...'"). 
+000120e0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+000120f0: 2061 6e6e 6f74 6174 6f72 2e61 6464 5f63   annotator.add_c
+00012100: 6f6d 6d61 6e64 280a 2020 2020 2020 2020  ommand(.        
+00012110: 2020 2020 416e 6e6f 7461 746f 7243 6f6d      AnnotatorCom
+00012120: 6d61 6e64 2868 746d 6c5f 636c 6173 733d  mand(html_class=
+00012130: 2273 7562 5f73 6563 7469 6f6e 5f74 6974  "sub_section_tit
+00012140: 6c65 222c 2072 6567 6578 3d22 5c5c 732a  le", regex="\\s*
+00012150: 283f 503c 6964 3e5c 5c64 2b5c 5c2e 5c5c  (?P<id>\\d+\\.\\
+00012160: 642b 295c 5c73 2b28 3f50 3c74 6974 6c65  d+)\\s+(?P<title
+00012170: 3e2e 2a29 222c 0a20 2020 2020 2020 2020  >.*)",.         
+00012180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012190: 2020 2020 6164 645f 6964 3d22 7375 6273      add_id="subs
+000121a0: 6563 7469 6f6e 5f7c 222c 2061 6464 5f74  ection_|", add_t
+000121b0: 6974 6c65 3d22 7c22 2c20 7374 796c 653d  itle="|", style=
+000121c0: 227b 636f 6c6f 7220 3a20 6772 6565 6e3b  "{color : green;
+000121d0: 2062 6163 6b67 726f 756e 6420 3a20 7965   background : ye
+000121e0: 6c6c 6f77 3b7d 2229 290a 2020 2020 2020  llow;}")).      
+000121f0: 2020 616e 6e6f 7461 746f 722e 6164 645f    annotator.add_
+00012200: 636f 6d6d 616e 6428 0a20 2020 2020 2020  command(.       
+00012210: 2020 2020 2041 6e6e 6f74 6174 6f72 436f       AnnotatorCo
+00012220: 6d6d 616e 6428 6874 6d6c 5f63 6c61 7373  mmand(html_class
+00012230: 3d22 7375 625f 7375 625f 7365 6374 696f  ="sub_sub_sectio
+00012240: 6e5f 7469 746c 6522 2c0a 2020 2020 2020  n_title",.      
+00012250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012260: 2020 2020 2020 2072 6567 6578 3d22 5e5c         regex="^\
+00012270: 5c73 2a28 3f50 3c69 643e 5c5c 642b 5c5c  \s*(?P<id>\\d+\\
+00012280: 2e5c 5c64 2b5c 5c2e 5c5c 642b 295c 5c73  .\\d+\\.\\d+)\\s
+00012290: 2b28 3f50 3c74 6974 6c65 3e2e 2a29 222c  +(?P<title>.*)",
+000122a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000122b0: 2020 2020 2020 2020 2020 2020 2020 6164                ad
+000122c0: 645f 6964 3d22 7375 6273 6563 7469 6f6e  d_id="subsection
+000122d0: 5f7c 222c 2061 6464 5f74 6974 6c65 3d22  _|", add_title="
+000122e0: 7c22 2c20 7374 796c 653d 227b 636f 6c6f  |", style="{colo
+000122f0: 7220 3a20 626c 6163 6b3b 2062 6163 6b67  r : black; backg
+00012300: 726f 756e 6420 3a20 2364 6464 6464 643b  round : #dddddd;
+00012310: 7d22 2929 0a20 2020 2020 2020 2061 6e6e  }")).        ann
+00012320: 6f74 6174 6f72 2e61 6464 5f63 6f6d 6d61  otator.add_comma
+00012330: 6e64 280a 2020 2020 2020 2020 2020 2020  nd(.            
+00012340: 416e 6e6f 7461 746f 7243 6f6d 6d61 6e64  AnnotatorCommand
+00012350: 2868 746d 6c5f 636c 6173 733d 2263 6f6e  (html_class="con
+00012360: 6669 6465 6e63 6522 2c0a 2020 2020 2020  fidence",.      
 00012370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012380: 2020 7265 6765 783d 225e 5c5c 732a 5c5c    regex="^\\s*\\
-00012390: 283f 283f 503c 7469 746c 653e 2876 6572  (?(?P<title>(ver
-000123a0: 7920 6869 6768 7c68 6967 687c 6d65 6469  y high|high|medi
-000123b0: 756d 7c6c 6f77 2920 636f 6e66 6964 656e  um|low) confiden
-000123c0: 6365 295c 5c29 3f22 2c0a 2020 2020 2020  ce)\\)?",.      
+00012380: 2020 2020 2020 2072 6567 6578 3d22 5e5c         regex="^\
+00012390: 5c73 2a5c 5c28 3f28 3f50 3c74 6974 6c65  \s*\\(?(?P<title
+000123a0: 3e28 7665 7279 2068 6967 687c 6869 6768  >(very high|high
+000123b0: 7c6d 6564 6975 6d7c 6c6f 7729 2063 6f6e  |medium|low) con
+000123c0: 6669 6465 6e63 6529 5c5c 293f 222c 0a20  fidence)\\)?",. 
 000123d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000123e0: 2020 2020 2020 2061 6464 5f69 643d 2263         add_id="c
-000123f0: 6f6e 6669 6465 6e63 655f 7c22 2c20 6164  onfidence_|", ad
-00012400: 645f 7469 746c 653d 227c 222c 2073 7479  d_title="|", sty
-00012410: 6c65 3d22 7b63 6f6c 6f72 203a 2062 6c61  le="{color : bla
-00012420: 636b 3b20 6261 636b 6772 6f75 6e64 203a  ck; background :
-00012430: 2023 6464 3838 6464 3b7d 2229 290a 2020   #dd88dd;}")).  
-00012440: 2020 2020 2020 616e 6e6f 7461 746f 722e        annotator.
-00012450: 6164 645f 636f 6d6d 616e 6428 0a20 2020  add_command(.   
-00012460: 2020 2020 2020 2020 2041 6e6e 6f74 6174           Annotat
-00012470: 6f72 436f 6d6d 616e 6428 6874 6d6c 5f63  orCommand(html_c
-00012480: 6c61 7373 3d22 7072 6f62 6162 696c 6974  lass="probabilit
-00012490: 7922 2c0a 2020 2020 2020 2020 2020 2020  y",.            
+000123e0: 2020 2020 2020 2020 2020 2020 6164 645f              add_
+000123f0: 6964 3d22 636f 6e66 6964 656e 6365 5f7c  id="confidence_|
+00012400: 222c 2061 6464 5f74 6974 6c65 3d22 7c22  ", add_title="|"
+00012410: 2c20 7374 796c 653d 227b 636f 6c6f 7220  , style="{color 
+00012420: 3a20 626c 6163 6b3b 2062 6163 6b67 726f  : black; backgro
+00012430: 756e 6420 3a20 2364 6438 3864 643b 7d22  und : #dd88dd;}"
+00012440: 2929 0a20 2020 2020 2020 2061 6e6e 6f74  )).        annot
+00012450: 6174 6f72 2e61 6464 5f63 6f6d 6d61 6e64  ator.add_command
+00012460: 280a 2020 2020 2020 2020 2020 2020 416e  (.            An
+00012470: 6e6f 7461 746f 7243 6f6d 6d61 6e64 2868  notatorCommand(h
+00012480: 746d 6c5f 636c 6173 733d 2270 726f 6261  tml_class="proba
+00012490: 6269 6c69 7479 222c 0a20 2020 2020 2020  bility",.       
 000124a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000124b0: 2072 6567 6578 3d22 5e5c 5c73 2a5c 5c28   regex="^\\s*\\(
-000124c0: 3f28 3f50 3c74 6974 6c65 3e28 6c69 6b65  ?(?P<title>(like
-000124d0: 6c79 7c76 6572 7920 6c69 6b65 6c79 7c65  ly|very likely|e
-000124e0: 7874 7265 6d65 6c79 206c 696b 656c 797c  xtremely likely|
-000124f0: 7669 7274 7561 6c6c 7920 6365 7274 6169  virtually certai
-00012500: 6e29 295c 5c29 3f22 2c0a 2020 2020 2020  n))\\)?",.      
+000124b0: 2020 2020 2020 7265 6765 783d 225e 5c5c        regex="^\\
+000124c0: 732a 5c5c 283f 283f 503c 7469 746c 653e  s*\\(?(?P<title>
+000124d0: 286c 696b 656c 797c 7665 7279 206c 696b  (likely|very lik
+000124e0: 656c 797c 6578 7472 656d 656c 7920 6c69  ely|extremely li
+000124f0: 6b65 6c79 7c76 6972 7475 616c 6c79 2063  kely|virtually c
+00012500: 6572 7461 696e 2929 5c5c 293f 222c 0a20  ertain))\\)?",. 
 00012510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012520: 2020 2020 2020 2061 6464 5f69 643d 2270         add_id="p
-00012530: 726f 6261 6269 6c69 7479 5f7c 222c 2061  robability_|", a
-00012540: 6464 5f74 6974 6c65 3d22 7c22 2c20 7374  dd_title="|", st
-00012550: 796c 653d 227b 636f 6c6f 7220 3a20 6379  yle="{color : cy
-00012560: 616e 3b20 6261 636b 6772 6f75 6e64 203a  an; background :
-00012570: 2023 6464 3838 3838 3b7d 2229 290a 2020   #dd8888;}")).  
-00012580: 2020 2020 2020 616e 6e6f 7461 746f 722e        annotator.
-00012590: 6164 645f 636f 6d6d 616e 6428 0a20 2020  add_command(.   
-000125a0: 2020 2020 2020 2020 2041 6e6e 6f74 6174           Annotat
-000125b0: 6f72 436f 6d6d 616e 6428 6874 6d6c 5f63  orCommand(html_c
-000125c0: 6c61 7373 3d22 7375 7065 7273 6372 6970  lass="superscrip
-000125d0: 7422 2c20 7363 7269 7074 3d22 7375 7065  t", script="supe
-000125e0: 7222 2c20 6164 645f 6964 3d22 7375 7065  r", add_id="supe
-000125f0: 725f 7c22 2c20 6164 645f 7469 746c 653d  r_|", add_title=
-00012600: 227c 222c 0a20 2020 2020 2020 2020 2020  "|",.           
+00012520: 2020 2020 2020 2020 2020 2020 6164 645f              add_
+00012530: 6964 3d22 7072 6f62 6162 696c 6974 795f  id="probability_
+00012540: 7c22 2c20 6164 645f 7469 746c 653d 227c  |", add_title="|
+00012550: 222c 2073 7479 6c65 3d22 7b63 6f6c 6f72  ", style="{color
+00012560: 203a 2063 7961 6e3b 2062 6163 6b67 726f   : cyan; backgro
+00012570: 756e 6420 3a20 2364 6438 3838 383b 7d22  und : #dd8888;}"
+00012580: 2929 0a20 2020 2020 2020 2061 6e6e 6f74  )).        annot
+00012590: 6174 6f72 2e61 6464 5f63 6f6d 6d61 6e64  ator.add_command
+000125a0: 280a 2020 2020 2020 2020 2020 2020 416e  (.            An
+000125b0: 6e6f 7461 746f 7243 6f6d 6d61 6e64 2868  notatorCommand(h
+000125c0: 746d 6c5f 636c 6173 733d 2273 7570 6572  tml_class="super
+000125d0: 7363 7269 7074 222c 2073 6372 6970 743d  script", script=
+000125e0: 2273 7570 6572 222c 2061 6464 5f69 643d  "super", add_id=
+000125f0: 2273 7570 6572 5f7c 222c 2061 6464 5f74  "super_|", add_t
+00012600: 6974 6c65 3d22 7c22 2c0a 2020 2020 2020  itle="|",.      
 00012610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012620: 2020 7374 796c 653d 227b 636f 6c6f 7220    style="{color 
-00012630: 3a20 626c 7565 3b20 6261 636b 6772 6f6f  : blue; backgroo
-00012640: 756e 643a 2079 656c 6c6f 777d 2229 290a  und: yellow}")).
-00012650: 2020 2020 2020 2020 616e 6e6f 7461 746f          annotato
-00012660: 722e 6164 645f 636f 6d6d 616e 6428 0a20  r.add_command(. 
-00012670: 2020 2020 2020 2020 2020 2041 6e6e 6f74             Annot
-00012680: 6174 6f72 436f 6d6d 616e 6428 6874 6d6c  atorCommand(html
-00012690: 5f63 6c61 7373 3d22 7374 6172 7422 2c20  _class="start", 
-000126a0: 7265 6765 783d 225c 5c73 2a5c 5c5b 3f53  regex="\\s*\\[?S
-000126b0: 5441 5254 5c5c 732a 283f 503c 7469 746c  TART\\s*(?P<titl
-000126c0: 653e 4649 4755 5245 7c54 4142 4c45 295c  e>FIGURE|TABLE)\
-000126d0: 5c73 2a28 3f50 3c69 643e 5c5c 642b 5c5c  \s*(?P<id>\\d+\\
-000126e0: 2e5c 5c64 2b29 5c5c 732a 2848 4552 4529  .\\d+)\\s*(HERE)
-000126f0: 3f5c 5c5d 3f22 2c0a 2020 2020 2020 2020  ?\\]?",.        
-00012700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012710: 2020 2020 2061 6464 5f69 643d 2273 7461       add_id="sta
-00012720: 7274 5f7c 222c 2061 6464 5f74 6974 6c65  rt_|", add_title
-00012730: 3d22 7374 6172 745f 7c22 2c20 7374 796c  ="start_|", styl
-00012740: 653d 227b 636f 6c6f 7220 3a20 6772 6565  e="{color : gree
-00012750: 6e3b 2062 6163 6b67 726f 756e 643a 2070  n; background: p
-00012760: 696e 6b7d 2229 290a 2020 2020 2020 2020  ink}")).        
-00012770: 616e 6e6f 7461 746f 722e 6164 645f 636f  annotator.add_co
-00012780: 6d6d 616e 6428 0a20 2020 2020 2020 2020  mmand(.         
-00012790: 2020 2041 6e6e 6f74 6174 6f72 436f 6d6d     AnnotatorComm
-000127a0: 616e 6428 6874 6d6c 5f63 6c61 7373 3d22  and(html_class="
-000127b0: 656e 6422 2c20 7265 6765 783d 225c 5c73  end", regex="\\s
-000127c0: 2a5c 5c5b 3f45 4e44 5c5c 732a 283f 503c  *\\[?END\\s*(?P<
-000127d0: 7469 746c 653e 4649 4755 5245 7c54 4142  title>FIGURE|TAB
-000127e0: 4c45 295c 5c73 2a28 3f50 3c69 643e 5c5c  LE)\\s*(?P<id>\\
-000127f0: 642b 5c5c 2e5c 5c64 2b29 5c5c 732a 2848  d+\\.\\d+)\\s*(H
-00012800: 4552 4529 3f5c 5c5d 3f22 2c0a 2020 2020  ERE)?\\]?",.    
-00012810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012820: 2020 2020 2020 2020 2061 6464 5f69 643d           add_id=
-00012830: 2265 6e64 5f7c 222c 2061 6464 5f74 6974  "end_|", add_tit
-00012840: 6c65 3d22 656e 645f 7c22 2c20 7374 796c  le="end_|", styl
-00012850: 653d 227b 636f 6c6f 7220 3a20 6772 6565  e="{color : gree
-00012860: 6e3b 2062 6163 6b67 726f 756e 643a 2062  n; background: b
-00012870: 6c75 657d 2229 290a 2020 2020 2020 2020  lue}")).        
-00012880: 616e 6e6f 7461 746f 722e 6164 645f 636f  annotator.add_co
-00012890: 6d6d 616e 6428 0a20 2020 2020 2020 2020  mmand(.         
-000128a0: 2020 2041 6e6e 6f74 6174 6f72 436f 6d6d     AnnotatorComm
-000128b0: 616e 6428 6874 6d6c 5f63 6c61 7373 3d22  and(html_class="
-000128c0: 7461 7267 6574 7322 2c20 7265 6765 783d  targets", regex=
-000128d0: 222e 2a5c 5c7b 283f 503c 7469 746c 653e  ".*\\{(?P<title>
-000128e0: 2e2b 295c 5c7d 2e2a 222c 0a20 2020 2020  .+)\\}.*",.     
-000128f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012900: 2020 2020 2020 2020 6164 645f 6964 3d22          add_id="
-00012910: 6368 756e 6b5f 7c22 2c20 6164 645f 7469  chunk_|", add_ti
-00012920: 746c 653d 227c 222c 2073 7479 6c65 3d22  tle="|", style="
-00012930: 7b63 6f6c 6f72 203a 2067 7265 656e 3b20  {color : green; 
-00012940: 6261 636b 6772 6f75 6e64 3a20 6f72 616e  background: oran
-00012950: 6765 7d22 2c0a 2020 2020 2020 2020 2020  ge}",.          
-00012960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012970: 2020 6465 7363 3d22 4950 4343 2074 6172    desc="IPCC tar
-00012980: 6765 7420 4944 7320 696e 2063 7572 6c79  get IDs in curly
-00012990: 2062 7261 636b 6574 7320 7b57 4731 2053   brackets {WG1 S
-000129a0: 504d 2041 2e31 2e32 2c20 5747 4949 2053  PM A.1.2, WGII S
-000129b0: 504d 2042 2e32 2e33 7d22 2929 0a20 2020  PM B.2.3}")).   
-000129c0: 2020 2020 2061 6e6e 6f74 6174 6f72 2e61       annotator.a
-000129d0: 6464 5f63 6f6d 6d61 6e64 280a 2020 2020  dd_command(.    
-000129e0: 2020 2020 2020 2020 416e 6e6f 7461 746f          Annotato
-000129f0: 7243 6f6d 6d61 6e64 2868 746d 6c5f 636c  rCommand(html_cl
-00012a00: 6173 733d 2263 7275 6674 222c 2072 6567  ass="cruft", reg
-00012a10: 6578 3d22 5e2e 2a28 5375 626a 6563 7420  ex="^.*(Subject 
-00012a20: 746f 2043 6f70 7920 4564 6974 207c 4164  to Copy Edit |Ad
-00012a30: 6f70 7465 6420 4c6f 6e67 6572 2052 6570  opted Longer Rep
-00012a40: 6f72 7420 4950 4343 2041 5236 2053 5952  ort IPCC AR6 SYR
-00012a50: 292e 2a24 222c 0a20 2020 2020 2020 2020  ).*$",.         
-00012a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012a70: 2020 2020 6164 645f 6964 3d22 6372 7566      add_id="cruf
-00012a80: 745f 7c22 2c20 6164 645f 7469 746c 653d  t_|", add_title=
-00012a90: 227c 222c 2064 656c 6574 653d 5472 7565  "|", delete=True
-00012aa0: 2c20 7374 796c 653d 227b 636f 6c6f 7220  , style="{color 
-00012ab0: 3a20 6772 6565 6e3b 2062 6163 6b67 726f  : green; backgro
-00012ac0: 756e 643a 2062 6c61 636b 7d22 2929 0a20  und: black}")). 
-00012ad0: 2020 2020 2020 2061 6e6e 6f74 6174 6f72         annotator
-00012ae0: 2e61 6464 5f63 6f6d 6d61 6e64 280a 2020  .add_command(.  
-00012af0: 2020 2020 2020 2020 2020 416e 6e6f 7461            Annota
-00012b00: 746f 7243 6f6d 6d61 6e64 2868 746d 6c5f  torCommand(html_
-00012b10: 636c 6173 733d 2270 6167 6522 2c20 7265  class="page", re
-00012b20: 6765 783d 225e 283f 503c 7469 746c 653e  gex="^(?P<title>
-00012b30: 705c 5c2e 5c5c 642b 2922 2c0a 2020 2020  p\\.\\d+)",.    
-00012b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012b50: 2020 2020 2020 2020 2020 6164 645f 7469            add_ti
-00012b60: 746c 653d 227c 222c 2073 7479 6c65 3d22  tle="|", style="
-00012b70: 7b63 6f6c 6f72 203a 2070 7572 706c 657d  {color : purple}
-00012b80: 2229 290a 2020 2020 2020 2020 616e 6e6f  ")).        anno
-00012b90: 7461 746f 722e 6164 645f 636f 6d6d 616e  tator.add_comman
-00012ba0: 6428 0a20 2020 2020 2020 2020 2020 2041  d(.            A
-00012bb0: 6e6e 6f74 6174 6f72 436f 6d6d 616e 6428  nnotatorCommand(
-00012bc0: 6874 6d6c 5f63 6c61 7373 3d22 6661 6374  html_class="fact
-00012bd0: 222c 2078 7061 7468 3d22 7365 6c66 3a3a  ", xpath="self::
-00012be0: 7370 616e 5b63 6f6e 7461 696e 7328 4063  span[contains(@c
-00012bf0: 6c61 7373 2c20 2763 6f6e 6669 6465 6e63  lass, 'confidenc
-00012c00: 6527 295d 2f70 7265 6365 6469 6e67 2d73  e')]/preceding-s
-00012c10: 6962 6c69 6e67 3a3a 7370 616e 5b31 5d22  ibling::span[1]"
-00012c20: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00012620: 2020 2020 2020 2073 7479 6c65 3d22 7b63         style="{c
+00012630: 6f6c 6f72 203a 2062 6c75 653b 2062 6163  olor : blue; bac
+00012640: 6b67 726f 6f75 6e64 3a20 7965 6c6c 6f77  kgroound: yellow
+00012650: 7d22 2929 0a20 2020 2020 2020 2061 6e6e  }")).        ann
+00012660: 6f74 6174 6f72 2e61 6464 5f63 6f6d 6d61  otator.add_comma
+00012670: 6e64 280a 2020 2020 2020 2020 2020 2020  nd(.            
+00012680: 416e 6e6f 7461 746f 7243 6f6d 6d61 6e64  AnnotatorCommand
+00012690: 2868 746d 6c5f 636c 6173 733d 2273 7461  (html_class="sta
+000126a0: 7274 222c 0a20 2020 2020 2020 2020 2020  rt",.           
+000126b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000126c0: 2020 7265 6765 783d 225c 5c73 2a5c 5c5b    regex="\\s*\\[
+000126d0: 3f53 5441 5254 5c5c 732a 283f 503c 7469  ?START\\s*(?P<ti
+000126e0: 746c 653e 4649 4755 5245 7c54 4142 4c45  tle>FIGURE|TABLE
+000126f0: 295c 5c73 2a28 3f50 3c69 643e 5c5c 642b  )\\s*(?P<id>\\d+
+00012700: 5c5c 2e5c 5c64 2b29 5c5c 732a 2848 4552  \\.\\d+)\\s*(HER
+00012710: 4529 3f5c 5c5d 3f22 2c0a 2020 2020 2020  E)?\\]?",.      
+00012720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012730: 2020 2020 2020 2061 6464 5f69 643d 2273         add_id="s
+00012740: 7461 7274 5f7c 222c 2061 6464 5f74 6974  tart_|", add_tit
+00012750: 6c65 3d22 7374 6172 745f 7c22 2c20 7374  le="start_|", st
+00012760: 796c 653d 227b 636f 6c6f 7220 3a20 6772  yle="{color : gr
+00012770: 6565 6e3b 2062 6163 6b67 726f 756e 643a  een; background:
+00012780: 2070 696e 6b7d 2229 290a 2020 2020 2020   pink}")).      
+00012790: 2020 616e 6e6f 7461 746f 722e 6164 645f    annotator.add_
+000127a0: 636f 6d6d 616e 6428 0a20 2020 2020 2020  command(.       
+000127b0: 2020 2020 2041 6e6e 6f74 6174 6f72 436f       AnnotatorCo
+000127c0: 6d6d 616e 6428 6874 6d6c 5f63 6c61 7373  mmand(html_class
+000127d0: 3d22 656e 6422 2c0a 2020 2020 2020 2020  ="end",.        
+000127e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000127f0: 2020 2020 2072 6567 6578 3d22 5c5c 732a       regex="\\s*
+00012800: 5c5c 5b3f 454e 445c 5c73 2a28 3f50 3c74  \\[?END\\s*(?P<t
+00012810: 6974 6c65 3e46 4947 5552 457c 5441 424c  itle>FIGURE|TABL
+00012820: 4529 5c5c 732a 283f 503c 6964 3e5c 5c64  E)\\s*(?P<id>\\d
+00012830: 2b5c 5c2e 5c5c 642b 295c 5c73 2a28 4845  +\\.\\d+)\\s*(HE
+00012840: 5245 293f 5c5c 5d3f 222c 0a20 2020 2020  RE)?\\]?",.     
+00012850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012860: 2020 2020 2020 2020 6164 645f 6964 3d22          add_id="
+00012870: 656e 645f 7c22 2c20 6164 645f 7469 746c  end_|", add_titl
+00012880: 653d 2265 6e64 5f7c 222c 2073 7479 6c65  e="end_|", style
+00012890: 3d22 7b63 6f6c 6f72 203a 2067 7265 656e  ="{color : green
+000128a0: 3b20 6261 636b 6772 6f75 6e64 3a20 626c  ; background: bl
+000128b0: 7565 7d22 2929 0a20 2020 2020 2020 2061  ue}")).        a
+000128c0: 6e6e 6f74 6174 6f72 2e61 6464 5f63 6f6d  nnotator.add_com
+000128d0: 6d61 6e64 280a 2020 2020 2020 2020 2020  mand(.          
+000128e0: 2020 416e 6e6f 7461 746f 7243 6f6d 6d61    AnnotatorComma
+000128f0: 6e64 2868 746d 6c5f 636c 6173 733d 2274  nd(html_class="t
+00012900: 6172 6765 7473 222c 2072 6567 6578 3d22  argets", regex="
+00012910: 2e2a 5c5c 7b28 3f50 3c74 6974 6c65 3e2e  .*\\{(?P<title>.
+00012920: 2b29 5c5c 7d2e 2a22 2c0a 2020 2020 2020  +)\\}.*",.      
+00012930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012940: 2020 2020 2020 2061 6464 5f69 643d 2263         add_id="c
+00012950: 6875 6e6b 5f7c 222c 2061 6464 5f74 6974  hunk_|", add_tit
+00012960: 6c65 3d22 7c22 2c20 7374 796c 653d 227b  le="|", style="{
+00012970: 636f 6c6f 7220 3a20 6772 6565 6e3b 2062  color : green; b
+00012980: 6163 6b67 726f 756e 643a 206f 7261 6e67  ackground: orang
+00012990: 657d 222c 0a20 2020 2020 2020 2020 2020  e}",.           
+000129a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000129b0: 2020 6465 7363 3d22 4950 4343 2074 6172    desc="IPCC tar
+000129c0: 6765 7420 4944 7320 696e 2063 7572 6c79  get IDs in curly
+000129d0: 2062 7261 636b 6574 7320 7b57 4731 2053   brackets {WG1 S
+000129e0: 504d 2041 2e31 2e32 2c20 5747 4949 2053  PM A.1.2, WGII S
+000129f0: 504d 2042 2e32 2e33 7d22 2929 0a20 2020  PM B.2.3}")).   
+00012a00: 2020 2020 2061 6e6e 6f74 6174 6f72 2e61       annotator.a
+00012a10: 6464 5f63 6f6d 6d61 6e64 280a 2020 2020  dd_command(.    
+00012a20: 2020 2020 2020 2020 416e 6e6f 7461 746f          Annotato
+00012a30: 7243 6f6d 6d61 6e64 2868 746d 6c5f 636c  rCommand(html_cl
+00012a40: 6173 733d 2263 7275 6674 222c 0a20 2020  ass="cruft",.   
+00012a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012a60: 2020 2020 2020 2020 2020 7265 6765 783d            regex=
+00012a70: 225e 2e2a 2853 7562 6a65 6374 2074 6f20  "^.*(Subject to 
+00012a80: 436f 7079 2045 6469 7420 7c41 646f 7074  Copy Edit |Adopt
+00012a90: 6564 204c 6f6e 6765 7220 5265 706f 7274  ed Longer Report
+00012aa0: 2049 5043 4320 4152 3620 5359 5229 2e2a   IPCC AR6 SYR).*
+00012ab0: 2422 2c0a 2020 2020 2020 2020 2020 2020  $",.            
+00012ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012ad0: 2061 6464 5f69 643d 2263 7275 6674 5f7c   add_id="cruft_|
+00012ae0: 222c 2061 6464 5f74 6974 6c65 3d22 7c22  ", add_title="|"
+00012af0: 2c20 6465 6c65 7465 3d54 7275 652c 2073  , delete=True, s
+00012b00: 7479 6c65 3d22 7b63 6f6c 6f72 203a 2067  tyle="{color : g
+00012b10: 7265 656e 3b20 6261 636b 6772 6f75 6e64  reen; background
+00012b20: 3a20 626c 6163 6b7d 2229 290a 2020 2020  : black}")).    
+00012b30: 2020 2020 616e 6e6f 7461 746f 722e 6164      annotator.ad
+00012b40: 645f 636f 6d6d 616e 6428 0a20 2020 2020  d_command(.     
+00012b50: 2020 2020 2020 2041 6e6e 6f74 6174 6f72         Annotator
+00012b60: 436f 6d6d 616e 6428 6874 6d6c 5f63 6c61  Command(html_cla
+00012b70: 7373 3d22 7061 6765 222c 2072 6567 6578  ss="page", regex
+00012b80: 3d22 5e28 3f50 3c74 6974 6c65 3e70 5c5c  ="^(?P<title>p\\
+00012b90: 2e5c 5c64 2b29 222c 0a20 2020 2020 2020  .\\d+)",.       
+00012ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012bb0: 2020 2020 2020 6164 645f 7469 746c 653d        add_title=
+00012bc0: 227c 222c 2073 7479 6c65 3d22 7b63 6f6c  "|", style="{col
+00012bd0: 6f72 203a 2070 7572 706c 657d 2229 290a  or : purple}")).
+00012be0: 2020 2020 2020 2020 616e 6e6f 7461 746f          annotato
+00012bf0: 722e 6164 645f 636f 6d6d 616e 6428 0a20  r.add_command(. 
+00012c00: 2020 2020 2020 2020 2020 2041 6e6e 6f74             Annot
+00012c10: 6174 6f72 436f 6d6d 616e 6428 6874 6d6c  atorCommand(html
+00012c20: 5f63 6c61 7373 3d22 6661 6374 222c 0a20  _class="fact",. 
 00012c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012c40: 7374 796c 653d 227b 636f 6c6f 7220 3a20  style="{color : 
-00012c50: 7075 7270 6c65 7d22 2929 0a20 2020 2020  purple}")).     
-00012c60: 2020 2061 6e6e 6f74 6174 6f72 2e61 6464     annotator.add
-00012c70: 5f63 6f6d 6d61 6e64 280a 2020 2020 2020  _command(.      
-00012c80: 2020 2020 2020 416e 6e6f 7461 746f 7243        AnnotatorC
-00012c90: 6f6d 6d61 6e64 2868 746d 6c5f 636c 6173  ommand(html_clas
-00012ca0: 733d 2267 726f 7570 222c 2067 726f 7570  s="group", group
-00012cb0: 5f78 7061 7468 3d22 6469 765b 7370 616e  _xpath="div[span
-00012cc0: 5b63 6f6e 7461 696e 7328 4063 6c61 7373  [contains(@class
-00012cd0: 2c20 2773 7461 7274 2729 5d5d 222c 0a20  , 'start')]]",. 
-00012ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012cf0: 2020 2020 2020 2020 2020 2020 656e 645f              end_
-00012d00: 7870 6174 683d 2273 656c 663a 3a64 6976  xpath="self::div
-00012d10: 5b73 7061 6e5b 636f 6e74 6169 6e73 2874  [span[contains(t
-00012d20: 6578 7428 292c 2745 4e44 2729 5d5d 222c  ext(),'END')]]",
-00012d30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012d40: 2020 2020 2020 2020 2020 2020 2064 6573               des
-00012d50: 633d 223f 6578 7472 6163 7473 2067 726f  c="?extracts gro
-00012d60: 7570 7320 616e 6420 6d6d 6f76 6573 2074  ups and mmoves t
-00012d70: 6f20 656e 6422 2929 0a20 2020 2020 2020  o end")).       
-00012d80: 2061 6e6e 6f74 6174 6f72 2e61 6464 5f63   annotator.add_c
-00012d90: 6f6d 6d61 6e64 280a 2020 2020 2020 2020  ommand(.        
-00012da0: 2020 2020 416e 6e6f 7461 746f 7243 6f6d      AnnotatorCom
-00012db0: 6d61 6e64 2868 746d 6c5f 636c 6173 733d  mand(html_class=
-00012dc0: 2273 7562 7375 6273 6563 7469 6f6e 222c  "subsubsection",
-00012dd0: 2067 726f 7570 5f78 7061 7468 3d22 6469   group_xpath="di
-00012de0: 765b 7370 616e 5b63 6f6e 7461 696e 7328  v[span[contains(
-00012df0: 4063 6c61 7373 2c20 2773 7562 7375 6273  @class, 'subsubs
-00012e00: 6563 7469 6f6e 5f74 6974 6c65 2729 5d5d  ection_title')]]
-00012e10: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
-00012e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012e30: 656e 645f 7870 6174 683d 2273 656c 663a  end_xpath="self:
-00012e40: 3a64 6976 5b73 7061 6e5b 636f 6e74 6169  :div[span[contai
-00012e50: 6e73 2874 6578 7428 292c 2773 6563 7469  ns(text(),'secti
-00012e60: 6f6e 5f74 6974 6c65 2729 5d5d 2229 290a  on_title')]]")).
-00012e70: 2020 2020 2020 2020 616e 6e6f 7461 746f          annotato
-00012e80: 722e 6164 645f 636f 6d6d 616e 6428 0a20  r.add_command(. 
-00012e90: 2020 2020 2020 2020 2020 2041 6e6e 6f74             Annot
-00012ea0: 6174 6f72 436f 6d6d 616e 6428 6874 6d6c  atorCommand(html
-00012eb0: 5f63 6c61 7373 3d22 666f 6f74 6e6f 7465  _class="footnote
-00012ec0: 222c 2078 7061 7468 3d22 2f2f 6469 765b  ", xpath="//div[
-00012ed0: 7370 616e 5b63 6f6e 7461 696e 7328 4073  span[contains(@s
-00012ee0: 7479 6c65 2c20 2766 6f6e 742d 7369 7a65  tyle, 'font-size
-00012ef0: 3a20 362e 3027 2920 616e 6420 6e75 6d62  : 6.0') and numb
-00012f00: 6572 282e 293d 6e75 6d62 6572 282e 295d  er(.)=number(.)]
-00012f10: 5d22 2c0a 2020 2020 2020 2020 2020 2020  ]",.            
-00012f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012f30: 2064 6573 633d 2268 6f72 7269 626c 6520   desc="horrible 
-00012f40: 6861 636b 2074 6573 7469 6e67 2066 6f6e  hack testing fon
-00012f50: 742d 7369 7a65 2229 290a 0a0a 2020 2020  t-size"))...    
-00012f60: 2020 2020 7265 7475 726e 2061 6e6e 6f74      return annot
-00012f70: 6174 6f72 0a0a 0a41 4e4e 5f53 504c 4954  ator...ANN_SPLIT
-00012f80: 203d 2022 7c22 0a4c 454e 5f54 4954 4c45   = "|".LEN_TITLE
-00012f90: 203d 2035 300a 636c 6173 7320 416e 6e6f   = 50.class Anno
-00012fa0: 7461 746f 7243 6f6d 6d61 6e64 3a0a 2020  tatorCommand:.  
-00012fb0: 2020 2222 2261 6e20 616e 6e6f 7461 7469    """an annotati
-00012fc0: 6f6e 2063 6f6d 6d61 6e64 0a20 2020 2065  on command.    e
-00012fd0: 2e67 2e0a 2020 2020 636f 6d6d 616e 6420  .g..    command 
-00012fe0: 3d20 416e 6e6f 7461 746f 7243 6f6d 6d61  = AnnotatorComma
-00012ff0: 6e64 2868 746d 6c5f 636c 6173 733d 2273  nd(html_class="s
-00013000: 6563 7469 6f6e 5f74 6974 6c65 222c 2072  ection_title", r
-00013010: 6567 6578 3d22 5365 6374 696f 6e5c 5c73  egex="Section\\s
-00013020: 2b28 3f50 3c69 643e 5c5c 642b 293a 5c5c  +(?P<id>\\d+):\\
-00013030: 732b 283f 503c 7469 746c 653e 2e2a 2922  s+(?P<title>.*)"
-00013040: 2c20 6164 645f 6964 3d54 7275 652c 2061  , add_id=True, a
-00013050: 6464 5f74 6974 6c65 3d54 7275 6529 0a20  dd_title=True). 
-00013060: 2020 2061 6e6e 6f74 6174 6f72 2e61 6464     annotator.add
-00013070: 5f63 6f6d 6d61 6e64 2863 6f6d 6d61 6e64  _command(command
-00013080: 290a 2020 2020 616e 6e6f 7461 746f 722e  ).    annotator.
-00013090: 7275 6e5f 636f 6d6d 616e 6473 0a0a 2020  run_commands..  
-000130a0: 2020 2222 220a 0a20 2020 2064 6566 205f    """..    def _
-000130b0: 5f69 6e69 745f 5f28 7365 6c66 2c20 6874  _init__(self, ht
-000130c0: 6d6c 5f63 6c61 7373 3d4e 6f6e 652c 2072  ml_class=None, r
-000130d0: 6567 6578 3d4e 6f6e 652c 2061 6464 5f69  egex=None, add_i
-000130e0: 643d 4e6f 6e65 2c20 6164 645f 7469 746c  d=None, add_titl
-000130f0: 653d 4e6f 6e65 2c20 7363 7269 7074 3d4e  e=None, script=N
-00013100: 6f6e 652c 2073 7479 6c65 3d4e 6f6e 652c  one, style=None,
-00013110: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013120: 2020 6465 6c65 7465 3d46 616c 7365 2c20    delete=False, 
-00013130: 7870 6174 683d 4e6f 6e65 2c20 6772 6f75  xpath=None, grou
-00013140: 705f 7870 6174 683d 4e6f 6e65 2c20 656e  p_xpath=None, en
-00013150: 645f 7870 6174 683d 4e6f 6e65 2c20 6465  d_xpath=None, de
-00013160: 7363 3d4e 6f6e 6529 3a0a 2020 2020 2020  sc=None):.      
-00013170: 2020 7365 6c66 2e68 746d 6c5f 636c 6173    self.html_clas
-00013180: 7320 3d20 6874 6d6c 5f63 6c61 7373 0a20  s = html_class. 
-00013190: 2020 2020 2020 2073 656c 662e 7265 203d         self.re =
-000131a0: 204e 6f6e 650a 2020 2020 2020 2020 6966   None.        if
-000131b0: 2072 6567 6578 3a0a 2020 2020 2020 2020   regex:.        
-000131c0: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-000131d0: 2020 2020 2020 2020 2073 656c 662e 7265           self.re
-000131e0: 203d 2072 652e 636f 6d70 696c 6528 7265   = re.compile(re
-000131f0: 6765 7829 0a20 2020 2020 2020 2020 2020  gex).           
-00013200: 2065 7863 6570 7420 4578 6365 7074 696f   except Exceptio
-00013210: 6e20 6173 2065 3a0a 2020 2020 2020 2020  n as e:.        
-00013220: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-00013230: 6c75 6545 7272 6f72 2866 2243 616e 6e6f  lueError(f"Canno
-00013240: 7420 636f 6d70 696c 6520 7265 6765 7820  t compile regex 
-00013250: 7b72 6567 6578 7d20 6265 6361 7573 6520  {regex} because 
-00013260: 7b65 7d22 290a 0a20 2020 2020 2020 2023  {e}")..        #
-00013270: 2061 6464 5f69 6420 616e 6420 6164 645f   add_id and add_
-00013280: 7469 746c 6520 6172 6520 6f66 2066 6f72  title are of for
-00013290: 6d20 666f 6f7c 6261 7220 7768 6572 6520  m foo|bar where 
-000132a0: 6578 7472 6163 7465 6420 6964 2072 6570  extracted id rep
-000132b0: 6c61 6365 7320 7c0a 2020 2020 2020 2020  laces |.        
-000132c0: 6966 2061 6464 5f69 643a 0a20 2020 2020  if add_id:.     
-000132d0: 2020 2020 2020 2061 6464 5f69 6420 3d20         add_id = 
-000132e0: 6164 645f 6964 2e73 706c 6974 2841 4e4e  add_id.split(ANN
-000132f0: 5f53 504c 4954 290a 2020 2020 2020 2020  _SPLIT).        
-00013300: 7365 6c66 2e61 6464 5f69 6420 3d20 4e6f  self.add_id = No
-00013310: 6e65 2069 6620 6e6f 7420 6164 645f 6964  ne if not add_id
-00013320: 206f 7220 6c65 6e28 6164 645f 6964 2920   or len(add_id) 
-00013330: 213d 2032 2065 6c73 6520 6164 645f 6964  != 2 else add_id
-00013340: 0a20 2020 2020 2020 2069 6620 6164 645f  .        if add_
-00013350: 7469 746c 653a 0a20 2020 2020 2020 2020  title:.         
-00013360: 2020 2061 6464 5f74 6974 6c65 203d 2061     add_title = a
-00013370: 6464 5f74 6974 6c65 2e73 706c 6974 2841  dd_title.split(A
-00013380: 4e4e 5f53 504c 4954 290a 2020 2020 2020  NN_SPLIT).      
-00013390: 2020 7365 6c66 2e61 6464 5f74 6974 6c65    self.add_title
-000133a0: 3d20 4e6f 6e65 2069 6620 6e6f 7420 6164  = None if not ad
-000133b0: 645f 7469 746c 6520 6f72 206c 656e 2861  d_title or len(a
-000133c0: 6464 5f74 6974 6c65 2920 213d 2032 2065  dd_title) != 2 e
-000133d0: 6c73 6520 6164 645f 7469 746c 650a 0a20  lse add_title.. 
-000133e0: 2020 2020 2020 2073 656c 662e 6874 6d6c         self.html
-000133f0: 5f63 6c61 7373 203d 2068 746d 6c5f 636c  _class = html_cl
-00013400: 6173 730a 2020 2020 2020 2020 7365 6c66  ass.        self
-00013410: 2e73 6372 6970 7420 3d20 7363 7269 7074  .script = script
-00013420: 0a20 2020 2020 2020 2073 656c 662e 7374  .        self.st
-00013430: 796c 6520 3d20 7374 796c 650a 2020 2020  yle = style.    
-00013440: 2020 2020 7365 6c66 2e64 656c 6574 6520      self.delete 
-00013450: 3d20 6465 6c65 7465 0a20 2020 2020 2020  = delete.       
-00013460: 2073 656c 662e 7870 6174 6820 3d20 7870   self.xpath = xp
-00013470: 6174 680a 2020 2020 2020 2020 7365 6c66  ath.        self
-00013480: 2e67 726f 7570 5f78 7061 7468 203d 2067  .group_xpath = g
-00013490: 726f 7570 5f78 7061 7468 0a20 2020 2020  roup_xpath.     
-000134a0: 2020 2073 656c 662e 656e 645f 7870 6174     self.end_xpat
-000134b0: 6820 3d20 656e 645f 7870 6174 680a 2020  h = end_xpath.  
-000134c0: 2020 2020 2020 7365 6c66 2e64 6573 6320        self.desc 
-000134d0: 3d20 6465 7363 0a0a 2320 636c 6173 7320  = desc..# class 
-000134e0: 416e 6e6f 7461 746f 7243 6f6d 6d61 6e64  AnnotatorCommand
-000134f0: 0a0a 2020 2020 6465 6620 7275 6e5f 636f  ..    def run_co
-00013500: 6d6d 616e 6428 7365 6c66 2c20 656c 656d  mmand(self, elem
-00013510: 293a 0a20 2020 2020 2020 2023 2070 7269  ):.        # pri
-00013520: 6e74 2866 2272 756e 5f63 6f6d 6d61 6e64  nt(f"run_command
-00013530: 202c 2074 6167 2c20 7b65 6c65 6d2e 7461   , tag, {elem.ta
-00013540: 677d 2070 6172 656e 743a 207b 656c 656d  g} parent: {elem
-00013550: 2e67 6574 7061 7265 6e74 2829 7d22 290a  .getparent()}").
-00013560: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-00013570: 7265 3a0a 2020 2020 2020 2020 2020 2020  re:.            
-00013580: 7365 6c66 2e72 756e 5f72 6567 6578 2865  self.run_regex(e
-00013590: 6c65 6d29 0a20 2020 2020 2020 2023 2065  lem).        # e
-000135a0: 6c69 6620 7365 6c66 2e65 7874 7261 6374  lif self.extract
-000135b0: 3a0a 2020 2020 2020 2020 2320 2020 2020  :.        #     
-000135c0: 7365 6c66 2e72 756e 5f65 7874 7261 6374  self.run_extract
-000135d0: 2865 6c65 6d29 0a20 2020 2020 2020 2065  (elem).        e
-000135e0: 6c69 6620 7365 6c66 2e78 7061 7468 203a  lif self.xpath :
-000135f0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00013600: 662e 7275 6e5f 7870 6174 6828 656c 656d  f.run_xpath(elem
-00013610: 290a 2020 2020 2020 2020 656c 6966 2073  ).        elif s
-00013620: 656c 662e 7363 7269 7074 203d 3d20 2273  elf.script == "s
-00013630: 7562 223a 0a20 2020 2020 2020 2020 2020  ub":.           
-00013640: 2073 656c 662e 7275 6e5f 7375 6273 6372   self.run_subscr
-00013650: 6970 7428 656c 656d 290a 2020 2020 2020  ipt(elem).      
-00013660: 2020 656c 6966 2073 656c 662e 7363 7269    elif self.scri
-00013670: 7074 203d 3d20 2273 7570 6572 223a 0a20  pt == "super":. 
-00013680: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00013690: 7275 6e5f 7375 7065 7273 6372 6970 7428  run_superscript(
-000136a0: 656c 656d 290a 2020 2020 2020 2020 656c  elem).        el
-000136b0: 6966 2073 656c 662e 6772 6f75 705f 7870  if self.group_xp
-000136c0: 6174 6820 6973 206e 6f74 204e 6f6e 653a  ath is not None:
-000136d0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-000136e0: 662e 7275 6e5f 6772 6f75 705f 7870 6174  f.run_group_xpat
-000136f0: 6828 656c 656d 290a 0a20 2020 2023 2063  h(elem)..    # c
-00013700: 6c61 7373 2041 6e6e 6f74 6174 6f72 436f  lass AnnotatorCo
-00013710: 6d6d 616e 640a 0a20 2020 2064 6566 2072  mmand..    def r
-00013720: 756e 5f72 6567 6578 2873 656c 662c 2065  un_regex(self, e
-00013730: 6c65 6d29 3a0a 2020 2020 2020 2020 7465  lem):.        te
-00013740: 7874 203d 2065 6c65 6d2e 7465 7874 0a20  xt = elem.text. 
-00013750: 2020 2020 2020 2069 6620 7465 7874 2069         if text i
-00013760: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-00013770: 2020 2020 7072 696e 7428 6622 7265 6765      print(f"rege
-00013780: 783a 204e 6f6e 6520 7465 7874 2069 6e20  x: None text in 
-00013790: 7b65 6c65 6d7d 207b 656c 656d 2e74 6167  {elem} {elem.tag
-000137a0: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
-000137b0: 7265 7475 726e 0a20 2020 2020 2020 206d  return.        m
-000137c0: 6174 6368 203d 204e 6f6e 650a 2020 2020  atch = None.    
-000137d0: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-000137e0: 2020 2020 206d 6174 6368 203d 2073 656c       match = sel
-000137f0: 662e 7265 2e6d 6174 6368 2874 6578 7429  f.re.match(text)
-00013800: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
-00013810: 4578 6365 7074 696f 6e20 6173 2065 3a0a  Exception as e:.
+00012c40: 2020 2020 2020 2020 2020 2020 7870 6174              xpat
+00012c50: 683d 2273 656c 663a 3a73 7061 6e5b 636f  h="self::span[co
+00012c60: 6e74 6169 6e73 2840 636c 6173 732c 2027  ntains(@class, '
+00012c70: 636f 6e66 6964 656e 6365 2729 5d2f 7072  confidence')]/pr
+00012c80: 6563 6564 696e 672d 7369 626c 696e 673a  eceding-sibling:
+00012c90: 3a73 7061 6e5b 315d 222c 0a20 2020 2020  :span[1]",.     
+00012ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012cb0: 2020 2020 2020 2020 7374 796c 653d 227b          style="{
+00012cc0: 636f 6c6f 7220 3a20 7075 7270 6c65 7d22  color : purple}"
+00012cd0: 2929 0a20 2020 2020 2020 2061 6e6e 6f74  )).        annot
+00012ce0: 6174 6f72 2e61 6464 5f63 6f6d 6d61 6e64  ator.add_command
+00012cf0: 280a 2020 2020 2020 2020 2020 2020 416e  (.            An
+00012d00: 6e6f 7461 746f 7243 6f6d 6d61 6e64 2868  notatorCommand(h
+00012d10: 746d 6c5f 636c 6173 733d 2267 726f 7570  tml_class="group
+00012d20: 222c 2067 726f 7570 5f78 7061 7468 3d22  ", group_xpath="
+00012d30: 6469 765b 7370 616e 5b63 6f6e 7461 696e  div[span[contain
+00012d40: 7328 4063 6c61 7373 2c20 2773 7461 7274  s(@class, 'start
+00012d50: 2729 5d5d 222c 0a20 2020 2020 2020 2020  ')]]",.         
+00012d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012d70: 2020 2020 656e 645f 7870 6174 683d 2273      end_xpath="s
+00012d80: 656c 663a 3a64 6976 5b73 7061 6e5b 636f  elf::div[span[co
+00012d90: 6e74 6169 6e73 2874 6578 7428 292c 2745  ntains(text(),'E
+00012da0: 4e44 2729 5d5d 222c 0a20 2020 2020 2020  ND')]]",.       
+00012db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012dc0: 2020 2020 2020 6465 7363 3d22 3f65 7874        desc="?ext
+00012dd0: 7261 6374 7320 6772 6f75 7073 2061 6e64  racts groups and
+00012de0: 206d 6d6f 7665 7320 746f 2065 6e64 2229   mmoves to end")
+00012df0: 290a 2020 2020 2020 2020 616e 6e6f 7461  ).        annota
+00012e00: 746f 722e 6164 645f 636f 6d6d 616e 6428  tor.add_command(
+00012e10: 0a20 2020 2020 2020 2020 2020 2041 6e6e  .            Ann
+00012e20: 6f74 6174 6f72 436f 6d6d 616e 6428 6874  otatorCommand(ht
+00012e30: 6d6c 5f63 6c61 7373 3d22 7375 6273 7562  ml_class="subsub
+00012e40: 7365 6374 696f 6e22 2c0a 2020 2020 2020  section",.      
+00012e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012e60: 2020 2020 2020 2067 726f 7570 5f78 7061         group_xpa
+00012e70: 7468 3d22 6469 765b 7370 616e 5b63 6f6e  th="div[span[con
+00012e80: 7461 696e 7328 4063 6c61 7373 2c20 2773  tains(@class, 's
+00012e90: 7562 7375 6273 6563 7469 6f6e 5f74 6974  ubsubsection_tit
+00012ea0: 6c65 2729 5d5d 222c 0a20 2020 2020 2020  le')]]",.       
+00012eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012ec0: 2020 2020 2020 656e 645f 7870 6174 683d        end_xpath=
+00012ed0: 2273 656c 663a 3a64 6976 5b73 7061 6e5b  "self::div[span[
+00012ee0: 636f 6e74 6169 6e73 2874 6578 7428 292c  contains(text(),
+00012ef0: 2773 6563 7469 6f6e 5f74 6974 6c65 2729  'section_title')
+00012f00: 5d5d 2229 290a 2020 2020 2020 2020 616e  ]]")).        an
+00012f10: 6e6f 7461 746f 722e 6164 645f 636f 6d6d  notator.add_comm
+00012f20: 616e 6428 0a20 2020 2020 2020 2020 2020  and(.           
+00012f30: 2041 6e6e 6f74 6174 6f72 436f 6d6d 616e   AnnotatorComman
+00012f40: 6428 6874 6d6c 5f63 6c61 7373 3d22 666f  d(html_class="fo
+00012f50: 6f74 6e6f 7465 222c 0a20 2020 2020 2020  otnote",.       
+00012f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012f70: 2020 2020 2020 7870 6174 683d 222f 2f64        xpath="//d
+00012f80: 6976 5b73 7061 6e5b 636f 6e74 6169 6e73  iv[span[contains
+00012f90: 2840 7374 796c 652c 2027 666f 6e74 2d73  (@style, 'font-s
+00012fa0: 697a 653a 2036 2e30 2729 2061 6e64 206e  ize: 6.0') and n
+00012fb0: 756d 6265 7228 2e29 3d6e 756d 6265 7228  umber(.)=number(
+00012fc0: 2e29 5d5d 222c 0a20 2020 2020 2020 2020  .)]]",.         
+00012fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012fe0: 2020 2020 6465 7363 3d22 686f 7272 6962      desc="horrib
+00012ff0: 6c65 2068 6163 6b20 7465 7374 696e 6720  le hack testing 
+00013000: 666f 6e74 2d73 697a 6522 2929 0a0a 2020  font-size"))..  
+00013010: 2020 2020 2020 7265 7475 726e 2061 6e6e        return ann
+00013020: 6f74 6174 6f72 0a0a 0a41 4e4e 5f53 504c  otator...ANN_SPL
+00013030: 4954 203d 2022 7c22 0a4c 454e 5f54 4954  IT = "|".LEN_TIT
+00013040: 4c45 203d 2035 300a 0a0a 636c 6173 7320  LE = 50...class 
+00013050: 416e 6e6f 7461 746f 7243 6f6d 6d61 6e64  AnnotatorCommand
+00013060: 3a0a 2020 2020 2222 2261 6e20 616e 6e6f  :.    """an anno
+00013070: 7461 7469 6f6e 2063 6f6d 6d61 6e64 0a20  tation command. 
+00013080: 2020 2065 2e67 2e0a 2020 2020 636f 6d6d     e.g..    comm
+00013090: 616e 6420 3d20 416e 6e6f 7461 746f 7243  and = AnnotatorC
+000130a0: 6f6d 6d61 6e64 2868 746d 6c5f 636c 6173  ommand(html_clas
+000130b0: 733d 2273 6563 7469 6f6e 5f74 6974 6c65  s="section_title
+000130c0: 222c 2072 6567 6578 3d22 5365 6374 696f  ", regex="Sectio
+000130d0: 6e5c 5c73 2b28 3f50 3c69 643e 5c5c 642b  n\\s+(?P<id>\\d+
+000130e0: 293a 5c5c 732b 283f 503c 7469 746c 653e  ):\\s+(?P<title>
+000130f0: 2e2a 2922 2c20 6164 645f 6964 3d54 7275  .*)", add_id=Tru
+00013100: 652c 2061 6464 5f74 6974 6c65 3d54 7275  e, add_title=Tru
+00013110: 6529 0a20 2020 2061 6e6e 6f74 6174 6f72  e).    annotator
+00013120: 2e61 6464 5f63 6f6d 6d61 6e64 2863 6f6d  .add_command(com
+00013130: 6d61 6e64 290a 2020 2020 616e 6e6f 7461  mand).    annota
+00013140: 746f 722e 7275 6e5f 636f 6d6d 616e 6473  tor.run_commands
+00013150: 0a0a 2020 2020 2222 220a 0a20 2020 2064  ..    """..    d
+00013160: 6566 205f 5f69 6e69 745f 5f28 7365 6c66  ef __init__(self
+00013170: 2c20 6874 6d6c 5f63 6c61 7373 3d4e 6f6e  , html_class=Non
+00013180: 652c 2072 6567 6578 3d4e 6f6e 652c 2061  e, regex=None, a
+00013190: 6464 5f69 643d 4e6f 6e65 2c20 6164 645f  dd_id=None, add_
+000131a0: 7469 746c 653d 4e6f 6e65 2c20 7363 7269  title=None, scri
+000131b0: 7074 3d4e 6f6e 652c 2073 7479 6c65 3d4e  pt=None, style=N
+000131c0: 6f6e 652c 0a20 2020 2020 2020 2020 2020  one,.           
+000131d0: 2020 2020 2020 6465 6c65 7465 3d46 616c        delete=Fal
+000131e0: 7365 2c20 7870 6174 683d 4e6f 6e65 2c20  se, xpath=None, 
+000131f0: 6772 6f75 705f 7870 6174 683d 4e6f 6e65  group_xpath=None
+00013200: 2c20 656e 645f 7870 6174 683d 4e6f 6e65  , end_xpath=None
+00013210: 2c20 6465 7363 3d4e 6f6e 6529 3a0a 2020  , desc=None):.  
+00013220: 2020 2020 2020 7365 6c66 2e68 746d 6c5f        self.html_
+00013230: 636c 6173 7320 3d20 6874 6d6c 5f63 6c61  class = html_cla
+00013240: 7373 0a20 2020 2020 2020 2073 656c 662e  ss.        self.
+00013250: 7265 203d 204e 6f6e 650a 2020 2020 2020  re = None.      
+00013260: 2020 6966 2072 6567 6578 3a0a 2020 2020    if regex:.    
+00013270: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
+00013280: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00013290: 662e 7265 203d 2072 652e 636f 6d70 696c  f.re = re.compil
+000132a0: 6528 7265 6765 7829 0a20 2020 2020 2020  e(regex).       
+000132b0: 2020 2020 2065 7863 6570 7420 4578 6365       except Exce
+000132c0: 7074 696f 6e20 6173 2065 3a0a 2020 2020  ption as e:.    
+000132d0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+000132e0: 6520 5661 6c75 6545 7272 6f72 2866 2243  e ValueError(f"C
+000132f0: 616e 6e6f 7420 636f 6d70 696c 6520 7265  annot compile re
+00013300: 6765 7820 7b72 6567 6578 7d20 6265 6361  gex {regex} beca
+00013310: 7573 6520 7b65 7d22 290a 0a20 2020 2020  use {e}")..     
+00013320: 2020 2023 2061 6464 5f69 6420 616e 6420     # add_id and 
+00013330: 6164 645f 7469 746c 6520 6172 6520 6f66  add_title are of
+00013340: 2066 6f72 6d20 666f 6f7c 6261 7220 7768   form foo|bar wh
+00013350: 6572 6520 6578 7472 6163 7465 6420 6964  ere extracted id
+00013360: 2072 6570 6c61 6365 7320 7c0a 2020 2020   replaces |.    
+00013370: 2020 2020 6966 2061 6464 5f69 643a 0a20      if add_id:. 
+00013380: 2020 2020 2020 2020 2020 2061 6464 5f69             add_i
+00013390: 6420 3d20 6164 645f 6964 2e73 706c 6974  d = add_id.split
+000133a0: 2841 4e4e 5f53 504c 4954 290a 2020 2020  (ANN_SPLIT).    
+000133b0: 2020 2020 7365 6c66 2e61 6464 5f69 6420      self.add_id 
+000133c0: 3d20 4e6f 6e65 2069 6620 6e6f 7420 6164  = None if not ad
+000133d0: 645f 6964 206f 7220 6c65 6e28 6164 645f  d_id or len(add_
+000133e0: 6964 2920 213d 2032 2065 6c73 6520 6164  id) != 2 else ad
+000133f0: 645f 6964 0a20 2020 2020 2020 2069 6620  d_id.        if 
+00013400: 6164 645f 7469 746c 653a 0a20 2020 2020  add_title:.     
+00013410: 2020 2020 2020 2061 6464 5f74 6974 6c65         add_title
+00013420: 203d 2061 6464 5f74 6974 6c65 2e73 706c   = add_title.spl
+00013430: 6974 2841 4e4e 5f53 504c 4954 290a 2020  it(ANN_SPLIT).  
+00013440: 2020 2020 2020 7365 6c66 2e61 6464 5f74        self.add_t
+00013450: 6974 6c65 203d 204e 6f6e 6520 6966 206e  itle = None if n
+00013460: 6f74 2061 6464 5f74 6974 6c65 206f 7220  ot add_title or 
+00013470: 6c65 6e28 6164 645f 7469 746c 6529 2021  len(add_title) !
+00013480: 3d20 3220 656c 7365 2061 6464 5f74 6974  = 2 else add_tit
+00013490: 6c65 0a0a 2020 2020 2020 2020 7365 6c66  le..        self
+000134a0: 2e68 746d 6c5f 636c 6173 7320 3d20 6874  .html_class = ht
+000134b0: 6d6c 5f63 6c61 7373 0a20 2020 2020 2020  ml_class.       
+000134c0: 2073 656c 662e 7363 7269 7074 203d 2073   self.script = s
+000134d0: 6372 6970 740a 2020 2020 2020 2020 7365  cript.        se
+000134e0: 6c66 2e73 7479 6c65 203d 2073 7479 6c65  lf.style = style
+000134f0: 0a20 2020 2020 2020 2073 656c 662e 6465  .        self.de
+00013500: 6c65 7465 203d 2064 656c 6574 650a 2020  lete = delete.  
+00013510: 2020 2020 2020 7365 6c66 2e78 7061 7468        self.xpath
+00013520: 203d 2078 7061 7468 0a20 2020 2020 2020   = xpath.       
+00013530: 2073 656c 662e 6772 6f75 705f 7870 6174   self.group_xpat
+00013540: 6820 3d20 6772 6f75 705f 7870 6174 680a  h = group_xpath.
+00013550: 2020 2020 2020 2020 7365 6c66 2e65 6e64          self.end
+00013560: 5f78 7061 7468 203d 2065 6e64 5f78 7061  _xpath = end_xpa
+00013570: 7468 0a20 2020 2020 2020 2073 656c 662e  th.        self.
+00013580: 6465 7363 203d 2064 6573 630a 0a20 2020  desc = desc..   
+00013590: 2023 2063 6c61 7373 2041 6e6e 6f74 6174   # class Annotat
+000135a0: 6f72 436f 6d6d 616e 640a 0a20 2020 2064  orCommand..    d
+000135b0: 6566 2072 756e 5f63 6f6d 6d61 6e64 2873  ef run_command(s
+000135c0: 656c 662c 2065 6c65 6d29 3a0a 2020 2020  elf, elem):.    
+000135d0: 2020 2020 2320 7072 696e 7428 6622 7275      # print(f"ru
+000135e0: 6e5f 636f 6d6d 616e 6420 2c20 7461 672c  n_command , tag,
+000135f0: 207b 656c 656d 2e74 6167 7d20 7061 7265   {elem.tag} pare
+00013600: 6e74 3a20 7b65 6c65 6d2e 6765 7470 6172  nt: {elem.getpar
+00013610: 656e 7428 297d 2229 0a20 2020 2020 2020  ent()}").       
+00013620: 2069 6620 7365 6c66 2e72 653a 0a20 2020   if self.re:.   
+00013630: 2020 2020 2020 2020 2073 656c 662e 7275           self.ru
+00013640: 6e5f 7265 6765 7828 656c 656d 290a 2020  n_regex(elem).  
+00013650: 2020 2020 2020 2320 656c 6966 2073 656c        # elif sel
+00013660: 662e 6578 7472 6163 743a 0a20 2020 2020  f.extract:.     
+00013670: 2020 2023 2020 2020 2073 656c 662e 7275     #     self.ru
+00013680: 6e5f 6578 7472 6163 7428 656c 656d 290a  n_extract(elem).
+00013690: 2020 2020 2020 2020 656c 6966 2073 656c          elif sel
+000136a0: 662e 7870 6174 683a 0a20 2020 2020 2020  f.xpath:.       
+000136b0: 2020 2020 2073 656c 662e 7275 6e5f 7870       self.run_xp
+000136c0: 6174 6828 656c 656d 290a 2020 2020 2020  ath(elem).      
+000136d0: 2020 656c 6966 2073 656c 662e 7363 7269    elif self.scri
+000136e0: 7074 203d 3d20 2273 7562 223a 0a20 2020  pt == "sub":.   
+000136f0: 2020 2020 2020 2020 2073 656c 662e 7275           self.ru
+00013700: 6e5f 7375 6273 6372 6970 7428 656c 656d  n_subscript(elem
+00013710: 290a 2020 2020 2020 2020 656c 6966 2073  ).        elif s
+00013720: 656c 662e 7363 7269 7074 203d 3d20 2273  elf.script == "s
+00013730: 7570 6572 223a 0a20 2020 2020 2020 2020  uper":.         
+00013740: 2020 2073 656c 662e 7275 6e5f 7375 7065     self.run_supe
+00013750: 7273 6372 6970 7428 656c 656d 290a 2020  rscript(elem).  
+00013760: 2020 2020 2020 656c 6966 2073 656c 662e        elif self.
+00013770: 6772 6f75 705f 7870 6174 6820 6973 206e  group_xpath is n
+00013780: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+00013790: 2020 2020 2073 656c 662e 7275 6e5f 6772       self.run_gr
+000137a0: 6f75 705f 7870 6174 6828 656c 656d 290a  oup_xpath(elem).
+000137b0: 0a20 2020 2023 2063 6c61 7373 2041 6e6e  .    # class Ann
+000137c0: 6f74 6174 6f72 436f 6d6d 616e 640a 0a20  otatorCommand.. 
+000137d0: 2020 2064 6566 2072 756e 5f72 6567 6578     def run_regex
+000137e0: 2873 656c 662c 2065 6c65 6d29 3a0a 2020  (self, elem):.  
+000137f0: 2020 2020 2020 7465 7874 203d 2065 6c65        text = ele
+00013800: 6d2e 7465 7874 0a20 2020 2020 2020 2069  m.text.        i
+00013810: 6620 7465 7874 2069 7320 4e6f 6e65 3a0a  f text is None:.
 00013820: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-00013830: 7428 6622 6d61 7463 6820 6661 696c 207b  t(f"match fail {
-00013840: 657d 2229 0a20 2020 2020 2020 2020 2020  e}").           
-00013850: 2072 6574 7572 6e0a 2020 2020 2020 2020   return.        
-00013860: 6966 206d 6174 6368 3a0a 2020 2020 2020  if match:.      
-00013870: 2020 2020 2020 6966 2073 656c 662e 6465        if self.de
-00013880: 6c65 7465 3a0a 2020 2020 2020 2020 2020  lete:.          
-00013890: 2020 2020 2020 7365 6c66 2e72 656d 6f76        self.remov
-000138a0: 655f 656c 656d 2865 6c65 6d29 0a20 2020  e_elem(elem).   
-000138b0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-000138c0: 7572 6e0a 2020 2020 2020 2020 2020 2020  urn.            
-000138d0: 6966 2073 656c 662e 6164 645f 6964 2061  if self.add_id a
-000138e0: 6e64 2022 6964 2220 696e 206d 6174 6368  nd "id" in match
-000138f0: 2e67 726f 7570 6469 6374 2829 3a0a 2020  .groupdict():.  
-00013900: 2020 2020 2020 2020 2020 2020 2020 656c                el
-00013910: 656d 2e61 7474 7269 625b 2269 6422 5d20  em.attrib["id"] 
-00013920: 3d20 7365 6c66 2e61 6464 5f69 645b 305d  = self.add_id[0]
-00013930: 202b 206d 6174 6368 2e67 726f 7570 2822   + match.group("
-00013940: 6964 2229 202b 2073 656c 662e 6164 645f  id") + self.add_
-00013950: 6964 5b31 5d0a 2020 2020 2020 2020 2020  id[1].          
-00013960: 2020 6966 2073 656c 662e 6164 645f 7469    if self.add_ti
-00013970: 746c 6520 616e 6420 2274 6974 6c65 2220  tle and "title" 
-00013980: 696e 206d 6174 6368 2e67 726f 7570 6469  in match.groupdi
-00013990: 6374 2829 3a0a 2020 2020 2020 2020 2020  ct():.          
-000139a0: 2020 2020 2020 656c 656d 2e61 7474 7269        elem.attri
-000139b0: 625b 2274 6974 6c65 225d 203d 2073 656c  b["title"] = sel
-000139c0: 662e 6164 645f 7469 746c 655b 305d 202b  f.add_title[0] +
-000139d0: 206d 6174 6368 2e67 726f 7570 2822 7469   match.group("ti
-000139e0: 746c 6522 2920 2b20 7365 6c66 2e61 6464  tle") + self.add
-000139f0: 5f74 6974 6c65 5b31 5d5b 3a4c 454e 5f54  _title[1][:LEN_T
-00013a00: 4954 4c45 5d0a 2020 2020 2020 2020 2020  ITLE].          
-00013a10: 2020 6966 2073 656c 662e 6874 6d6c 5f63    if self.html_c
-00013a20: 6c61 7373 3a0a 2020 2020 2020 2020 2020  lass:.          
-00013a30: 2020 2020 2020 7365 6c66 2e75 7064 6174        self.updat
-00013a40: 655f 636c 6173 7328 656c 656d 2c20 7365  e_class(elem, se
-00013a50: 6c66 2e68 746d 6c5f 636c 6173 7329 0a0a  lf.html_class)..
-00013a60: 2020 2020 2320 636c 6173 7320 416e 6e6f      # class Anno
-00013a70: 7461 746f 7243 6f6d 6d61 6e64 0a0a 2020  tatorCommand..  
-00013a80: 2020 6465 6620 7275 6e5f 7870 6174 6828    def run_xpath(
-00013a90: 7365 6c66 2c20 656c 656d 293a 0a20 2020  self, elem):.   
-00013aa0: 2020 2020 2078 705f 656c 656d 7320 3d20       xp_elems = 
-00013ab0: 656c 656d 2e78 7061 7468 2873 656c 662e  elem.xpath(self.
-00013ac0: 7870 6174 6829 0a20 2020 2020 2020 2069  xpath).        i
-00013ad0: 6620 6e6f 7420 7870 5f65 6c65 6d73 3a0a  f not xp_elems:.
-00013ae0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00013af0: 726e 0a20 2020 2020 2020 2066 6f72 2078  rn.        for x
-00013b00: 705f 656c 656d 2069 6e20 7870 5f65 6c65  p_elem in xp_ele
-00013b10: 6d73 3a0a 2020 2020 2020 2020 2020 2020  ms:.            
-00013b20: 6966 2073 656c 662e 6465 6c65 7465 3a0a  if self.delete:.
-00013b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013b40: 7870 5f65 6c65 6d2e 6765 7470 6172 656e  xp_elem.getparen
-00013b50: 7428 292e 7265 6d6f 7665 2878 705f 656c  t().remove(xp_el
-00013b60: 656d 290a 2020 2020 2020 2020 2020 2020  em).            
-00013b70: 2020 2020 7265 7475 726e 0a20 2020 2020      return.     
-00013b80: 2020 2020 2020 2069 6620 7365 6c66 2e68         if self.h
-00013b90: 746d 6c5f 636c 6173 733a 0a20 2020 2020  tml_class:.     
-00013ba0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00013bb0: 7570 6461 7465 5f63 6c61 7373 2878 705f  update_class(xp_
-00013bc0: 656c 656d 2c20 7365 6c66 2e68 746d 6c5f  elem, self.html_
-00013bd0: 636c 6173 7329 0a20 2020 2020 2020 2020  class).         
-00013be0: 2020 2020 2020 2074 6f73 7472 696e 6720         tostring 
-00013bf0: 3d20 4554 2e74 6f73 7472 696e 6728 7870  = ET.tostring(xp
-00013c00: 5f65 6c65 6d29 0a20 2020 2020 2020 2020  _elem).         
-00013c10: 2020 2020 2020 2070 6173 730a 0a20 2020         pass..   
-00013c20: 2023 2063 6c61 7373 2041 6e6e 6f74 6174   # class Annotat
-00013c30: 6f72 436f 6d6d 616e 640a 0a20 2020 2064  orCommand..    d
-00013c40: 6566 2075 7064 6174 655f 636c 6173 7328  ef update_class(
-00013c50: 7365 6c66 2c20 656c 656d 2c20 6874 6d6c  self, elem, html
-00013c60: 5f63 6c61 7373 293a 0a20 2020 2020 2020  _class):.       
-00013c70: 2063 6c61 7373 6573 203d 205b 5d0a 2020   classes = [].  
-00013c80: 2020 2020 2020 4874 6d6c 436c 6173 732e        HtmlClass.
-00013c90: 7365 745f 636c 6173 735f 6f6e 5f65 6c65  set_class_on_ele
-00013ca0: 6d65 6e74 2865 6c65 6d2c 2068 746d 6c5f  ment(elem, html_
-00013cb0: 636c 6173 7329 0a20 2020 2020 2020 2069  class).        i
-00013cc0: 6620 4661 6c73 653a 0a20 2020 2020 2020  f False:.       
-00013cd0: 2020 2020 2069 6620 656c 656d 2e61 7474       if elem.att
-00013ce0: 7269 622e 6765 7428 2263 6c61 7373 2229  rib.get("class")
-00013cf0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00013d00: 2020 636c 6173 7365 7320 3d20 656c 656d    classes = elem
-00013d10: 2e61 7474 7269 625b 2263 6c61 7373 225d  .attrib["class"]
-00013d20: 2e73 706c 6974 2822 2022 290a 2020 2020  .split(" ").    
-00013d30: 2020 2020 2020 2020 6966 2068 746d 6c5f          if html_
-00013d40: 636c 6173 7320 6e6f 7420 696e 2063 6c61  class not in cla
-00013d50: 7373 6573 3a0a 2020 2020 2020 2020 2020  sses:.          
-00013d60: 2020 2020 2020 636c 6173 7365 732e 6170        classes.ap
-00013d70: 7065 6e64 2868 746d 6c5f 636c 6173 7329  pend(html_class)
-00013d80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013d90: 2065 6c65 6d2e 6174 7472 6962 5b22 636c   elem.attrib["cl
-00013da0: 6173 7322 5d20 3d20 2220 222e 6a6f 696e  ass"] = " ".join
-00013db0: 2863 6c61 7373 6573 290a 0a20 2020 2064  (classes)..    d
-00013dc0: 6566 2072 756e 5f73 7562 7363 7269 7074  ef run_subscript
-00013dd0: 2873 656c 662c 2073 7061 6e29 3a0a 2020  (self, span):.  
-00013de0: 2020 2020 2020 6973 5f73 7562 203d 2048        is_sub = H
-00013df0: 746d 6c55 7469 6c2e 616e 6e6f 7461 7465  tmlUtil.annotate
-00013e00: 5f73 6372 6970 745f 7479 7065 2873 7061  _script_type(spa
-00013e10: 6e2c 2053 5363 7269 7074 2e53 5542 2c20  n, SScript.SUB, 
-00013e20: 7964 6f77 6e3d 4661 6c73 6529 0a20 2020  ydown=False).   
-00013e30: 2020 2020 2069 6620 6973 5f73 7562 3a0a       if is_sub:.
-00013e40: 2020 2020 2020 2020 2020 2020 7370 616e              span
-00013e50: 2e61 7474 7269 625b 2274 6974 6c65 225d  .attrib["title"]
-00013e60: 203d 2022 7375 6273 6372 6970 745f 7b73   = "subscript_{s
-00013e70: 7061 6e2e 7465 7874 7d22 0a20 2020 2020  pan.text}".     
-00013e80: 2020 2020 2020 2070 7269 6e74 2866 2253         print(f"S
-00013e90: 5542 207b 7370 616e 2e74 6578 747d 2229  UB {span.text}")
-00013ea0: 0a0a 2020 2020 2320 636c 6173 7320 416e  ..    # class An
-00013eb0: 6e6f 7461 746f 7243 6f6d 6d61 6e64 0a0a  notatorCommand..
-00013ec0: 2020 2020 6465 6620 7275 6e5f 7375 7065      def run_supe
-00013ed0: 7273 6372 6970 7428 7365 6c66 2c20 7370  rscript(self, sp
-00013ee0: 616e 293a 0a20 2020 2020 2020 2069 735f  an):.        is_
-00013ef0: 7375 7065 7220 3d20 4874 6d6c 5574 696c  super = HtmlUtil
-00013f00: 2e61 6e6e 6f74 6174 655f 7363 7269 7074  .annotate_script
-00013f10: 5f74 7970 6528 7370 616e 2c20 5353 6372  _type(span, SScr
-00013f20: 6970 742e 5355 502c 2079 646f 776e 3d46  ipt.SUP, ydown=F
-00013f30: 616c 7365 290a 2020 2020 2020 2020 6966  alse).        if
-00013f40: 2069 735f 7375 7065 723a 0a20 2020 2020   is_super:.     
-00013f50: 2020 2020 2020 2073 7061 6e2e 6174 7472         span.attr
-00013f60: 6962 5b22 7469 746c 6522 5d20 3d20 6622  ib["title"] = f"
-00013f70: 7375 7065 7273 6372 6970 745f 7b73 7061  superscript_{spa
-00013f80: 6e2e 7465 7874 7d22 0a0a 2020 2020 2320  n.text}"..    # 
-00013f90: 636c 6173 7320 416e 6e6f 7461 746f 7243  class AnnotatorC
-00013fa0: 6f6d 6d61 6e64 0a0a 2020 2020 6465 6620  ommand..    def 
-00013fb0: 7275 6e5f 6772 6f75 705f 7870 6174 6828  run_group_xpath(
-00013fc0: 7365 6c66 2c20 6368 696c 645f 656c 656d  self, child_elem
-00013fd0: 293a 0a20 2020 2020 2020 2022 2222 6772  ):.        """gr
-00013fe0: 6f75 7020 666f 6c6c 6f77 696e 6720 7369  oup following si
-00013ff0: 626c 696e 6773 206f 6620 656c 656d 2222  blings of elem""
-00014000: 220a 0a20 2020 2020 2020 2072 6573 756c  "..        resul
-00014010: 7420 3d20 4e6f 6e65 0a20 2020 2020 2020  t = None.       
-00014020: 2069 6620 6368 696c 645f 656c 656d 2069   if child_elem i
-00014030: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-00014040: 2020 2020 7265 7475 726e 204e 6f6e 650a      return None.
-00014050: 2020 2020 2020 2020 7061 7265 6e74 5f65          parent_e
-00014060: 6c65 6d20 3d20 6368 696c 645f 656c 656d  lem = child_elem
-00014070: 2e67 6574 7061 7265 6e74 2829 0a20 2020  .getparent().   
-00014080: 2020 2020 2069 6620 7061 7265 6e74 5f65       if parent_e
-00014090: 6c65 6d20 6973 204e 6f6e 653a 0a20 2020  lem is None:.   
-000140a0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-000140b0: 4e6f 6e65 0a20 2020 2020 2020 2067 726f  None.        gro
-000140c0: 7570 5f6c 6561 6473 203d 2070 6172 656e  up_leads = paren
-000140d0: 745f 656c 656d 2e78 7061 7468 2873 656c  t_elem.xpath(sel
-000140e0: 662e 6772 6f75 705f 7870 6174 6829 0a20  f.group_xpath). 
-000140f0: 2020 2020 2020 2069 6620 6c65 6e28 6772         if len(gr
-00014100: 6f75 705f 6c65 6164 7329 203e 2030 3a0a  oup_leads) > 0:.
-00014110: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-00014120: 7428 6622 6772 6f75 7020 6c65 6164 2063  t(f"group lead c
-00014130: 6f75 6e74 207b 6c65 6e28 6772 6f75 705f  ount {len(group_
-00014140: 6c65 6164 7329 7d20 7b73 656c 662e 6772  leads)} {self.gr
-00014150: 6f75 705f 7870 6174 687d 2229 0a20 2020  oup_xpath}").   
-00014160: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00014170: 2020 2020 2020 2070 6173 730a 2020 2020         pass.    
-00014180: 2020 2020 666f 7220 692c 2067 726f 7570      for i, group
-00014190: 5f6c 6561 6420 696e 2065 6e75 6d65 7261  _lead in enumera
-000141a0: 7465 2867 726f 7570 5f6c 6561 6473 293a  te(group_leads):
-000141b0: 0a20 2020 2020 2020 2020 2020 2023 2070  .            # p
-000141c0: 7269 6e74 2866 2267 726f 7570 206c 6561  rint(f"group lea
-000141d0: 6420 7b45 542e 746f 7374 7269 6e67 2867  d {ET.tostring(g
-000141e0: 726f 7570 5f6c 6561 6429 7d22 290a 2020  roup_lead)}").  
-000141f0: 2020 2020 2020 2020 2020 2320 656e 645f            # end_
-00014200: 6772 6f75 6f20 3d20 6772 6f75 705f 6c65  grouo = group_le
-00014210: 6164 735b 6920 2b20 315d 2069 6620 6920  ads[i + 1] if i 
-00014220: 3c20 6c65 6e28 6772 6f75 705f 6c65 6164  < len(group_lead
-00014230: 7329 202d 2031 2065 6c73 6520 4e6f 6e65  s) - 1 else None
-00014240: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00014250: 662e 6d61 6b65 5f67 726f 7570 2870 6172  f.make_group(par
-00014260: 656e 745f 656c 656d 2c20 6772 6f75 705f  ent_elem, group_
-00014270: 6c65 6164 290a 0a20 2020 2023 2063 6c61  lead)..    # cla
-00014280: 7373 2041 6e6e 6f74 6174 6f72 436f 6d6d  ss AnnotatorComm
-00014290: 616e 640a 0a20 2020 2064 6566 206d 616b  and..    def mak
-000142a0: 655f 6772 6f75 7028 7365 6c66 2c20 656c  e_group(self, el
-000142b0: 656d 2c20 6772 6f75 705f 6c65 6164 2c20  em, group_lead, 
-000142c0: 656e 645f 6772 6f75 703d 4e6f 6e65 293a  end_group=None):
-000142d0: 0a20 2020 2020 2020 2070 6172 656e 7420  .        parent 
-000142e0: 3d20 586d 6c4c 6962 2e67 6574 7061 7265  = XmlLib.getpare
-000142f0: 6e74 2865 6c65 6d2c 2064 6562 7567 3d54  nt(elem, debug=T
-00014300: 7275 6529 0a20 2020 2020 2020 2069 6620  rue).        if 
-00014310: 7061 7265 6e74 2069 7320 4e6f 6e65 3a0a  parent is None:.
-00014320: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-00014330: 6520 5661 6c75 6545 7272 6f72 2822 6e75  e ValueError("nu
-00014340: 6c6c 2070 6172 656e 7422 290a 2020 2020  ll parent").    
-00014350: 2020 2020 7369 626c 696e 6773 203d 2067      siblings = g
-00014360: 726f 7570 5f6c 6561 642e 7870 6174 6828  roup_lead.xpath(
-00014370: 2266 6f6c 6c6f 7769 6e67 2d73 6962 6c69  "following-sibli
-00014380: 6e67 3a3a 2a22 290a 2020 2020 2020 2020  ng::*").        
-00014390: 6966 206c 656e 2873 6962 6c69 6e67 7329  if len(siblings)
-000143a0: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
-000143b0: 2020 2070 7269 6e74 2866 226e 6f20 7369     print(f"no si
-000143c0: 626c 696e 6773 3a20 7b67 726f 7570 5f6c  blings: {group_l
-000143d0: 6561 642e 7465 7874 7d22 290a 2020 2020  ead.text}").    
-000143e0: 2020 2020 2020 2020 7061 7373 0a20 2020          pass.   
-000143f0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00014400: 2020 2020 2020 2070 7269 6e74 2866 2273         print(f"s
-00014410: 6962 6c69 6e67 7320 7b6c 656e 2873 6962  iblings {len(sib
-00014420: 6c69 6e67 7329 7d21 2121 2229 0a20 2020  lings)}!!!").   
-00014430: 2020 2020 2064 6976 203d 2045 542e 5375       div = ET.Su
-00014440: 6245 6c65 6d65 6e74 2870 6172 656e 742c  bElement(parent,
-00014450: 2022 6469 7622 290a 2020 2020 2020 2020   "div").        
-00014460: 6469 762e 6170 7065 6e64 2867 726f 7570  div.append(group
-00014470: 5f6c 6561 6429 0a20 2020 2020 2020 2064  _lead).        d
-00014480: 6976 2e61 7474 7269 625b 2274 6974 6c65  iv.attrib["title
-00014490: 225d 203d 2067 726f 7570 5f6c 6561 642e  "] = group_lead.
-000144a0: 7465 7874 2069 6620 6772 6f75 705f 6c65  text if group_le
-000144b0: 6164 2e74 6578 7420 656c 7365 2022 3f22  ad.text else "?"
-000144c0: 0a20 2020 2020 2020 2064 6976 2e61 7474  .        div.att
-000144d0: 7269 625b 2273 7479 6c65 225d 203d 2022  rib["style"] = "
-000144e0: 626f 7264 6572 3a62 6c61 636b 2064 6173  border:black das
-000144f0: 6865 6420 3270 783b 220a 2020 2020 2020  hed 2px;".      
-00014500: 2020 7870 203d 2073 656c 662e 656e 645f    xp = self.end_
-00014510: 7870 6174 680a 2020 2020 2020 2020 7870  xpath.        xp
-00014520: 203d 2022 7365 6c66 3a3a 6469 765b 7370   = "self::div[sp
-00014530: 616e 5b63 6f6e 7461 696e 7328 7465 7874  an[contains(text
-00014540: 2829 2c27 454e 4427 295d 5d22 0a20 2020  (),'END')]]".   
-00014550: 2020 2020 2023 2070 7269 6e74 2866 2265       # print(f"e
-00014560: 6e64 5f78 7061 7468 207b 7870 7d22 290a  nd_xpath {xp}").
-00014570: 2020 2020 2020 2020 666f 7220 7369 626c          for sibl
-00014580: 696e 6720 696e 2073 6962 6c69 6e67 733a  ing in siblings:
-00014590: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
-000145a0: 6e74 2866 2273 6962 6c69 6e67 3a20 7b27  nt(f"sibling: {'
-000145b0: 272e 6a6f 696e 2873 6962 6c69 6e67 2e69  '.join(sibling.i
-000145c0: 7465 7274 6578 7428 2929 7d22 290a 2020  tertext())}").  
-000145d0: 2020 2020 2020 2020 2020 656e 645f 7369            end_si
-000145e0: 6220 3d20 4e6f 6e65 0a20 2020 2020 2020  b = None.       
-000145f0: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
-00014600: 2020 2020 2020 2020 2020 656e 645f 7369            end_si
-00014610: 6220 3d20 7369 626c 696e 672e 7870 6174  b = sibling.xpat
-00014620: 6828 7870 290a 2020 2020 2020 2020 2020  h(xp).          
-00014630: 2020 6578 6365 7074 2045 7863 6570 7469    except Excepti
-00014640: 6f6e 2061 7320 653a 0a20 2020 2020 2020  on as e:.       
-00014650: 2020 2020 2020 2020 2070 7269 6e74 2866           print(f
-00014660: 2266 6169 6c65 6420 7870 6174 6820 7b78  "failed xpath {x
-00014670: 707d 207b 657d 2229 0a20 2020 2020 2020  p} {e}").       
-00014680: 2020 2020 2069 6620 656e 645f 7369 6220       if end_sib 
-00014690: 616e 6420 6c65 6e28 656e 645f 7369 6229  and len(end_sib)
-000146a0: 203e 2030 3a0a 2020 2020 2020 2020 2020   > 0:.          
-000146b0: 2020 2320 6966 2073 6962 6c69 6e67 2021    # if sibling !
-000146c0: 3d20 656e 645f 6772 6f75 703a 0a20 2020  = end_group:.   
-000146d0: 2020 2020 2020 2020 2023 2020 2020 2070           #     p
-000146e0: 7269 6e74 2866 2273 6962 6c69 6e67 207b  rint(f"sibling {
-000146f0: 7369 626c 696e 677d 2229 0a20 2020 2020  sibling}").     
-00014700: 2020 2020 2020 2020 2020 2062 7265 616b             break
-00014710: 0a20 2020 2020 2020 2020 2020 2064 6976  .            div
-00014720: 2e61 7070 656e 6428 7369 626c 696e 6729  .append(sibling)
-00014730: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00014740: 6469 760a 0a20 2020 2023 2063 6c61 7373  div..    # class
-00014750: 2041 6e6e 6f74 6174 6f72 436f 6d6d 616e   AnnotatorComman
-00014760: 640a 0a20 2020 2064 6566 2072 756e 5f65  d..    def run_e
-00014770: 7874 7261 6374 2873 656c 662c 2065 6c65  xtract(self, ele
-00014780: 6d29 3a0a 0a20 2020 2020 2020 2022 2222  m):..        """
-00014790: 6578 7472 6163 7420 6772 6f75 702e 206f  extract group. o
-000147a0: 7074 696e 616c 6c79 2077 7269 7465 2074  ptinally write t
-000147b0: 6f20 6669 6c65 2e20 6375 7272 656e 746c  o file. currentl
-000147c0: 7920 4e4f 2d4f 5022 2222 0a20 2020 2020  y NO-OP""".     
-000147d0: 2020 2070 7269 6e74 2866 2272 756e 5f65     print(f"run_e
-000147e0: 7874 7261 6374 2069 7320 4e4f 2d4f 5022  xtract is NO-OP"
-000147f0: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-00014800: 204e 6f6e 650a 0a20 2020 2023 2063 6c61   None..    # cla
-00014810: 7373 2041 6e6e 6f74 6174 6f72 436f 6d6d  ss AnnotatorComm
-00014820: 616e 640a 0a20 2020 2064 6566 2072 656d  and..    def rem
-00014830: 6f76 655f 656c 656d 2873 656c 662c 2065  ove_elem(self, e
-00014840: 6c65 6d2c 2064 6562 7567 3d46 616c 7365  lem, debug=False
-00014850: 293a 0a20 2020 2020 2020 2069 6620 656c  ):.        if el
-00014860: 656d 2069 7320 4e6f 6e65 3a0a 2020 2020  em is None:.    
-00014870: 2020 2020 2020 2020 7265 7475 726e 0a20          return. 
-00014880: 2020 2020 2020 2070 6172 656e 7420 3d20         parent = 
-00014890: 656c 656d 2e67 6574 7061 7265 6e74 2829  elem.getparent()
-000148a0: 0a20 2020 2020 2020 2069 6620 7061 7265  .        if pare
-000148b0: 6e74 2069 7320 4e6f 6e65 3a0a 2020 2020  nt is None:.    
-000148c0: 2020 2020 2020 2020 6966 2064 6562 7567          if debug
-000148d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000148e0: 2020 7072 696e 7428 6622 656c 656d 656e    print(f"elemen
-000148f0: 7420 7b65 6c65 6d7d 2068 6173 206e 6f20  t {elem} has no 
-00014900: 7061 7265 6e74 2229 0a20 2020 2020 2020  parent").       
-00014910: 2020 2020 2072 6574 7572 6e0a 2020 2020       return.    
-00014920: 2020 2020 7061 7265 6e74 2e72 656d 6f76      parent.remov
-00014930: 6528 656c 656d 290a 0a0a 0a53 5459 4c45  e(elem)....STYLE
-00014940: 5f43 5552 4c59 5f52 4520 3d20 7265 2e63  _CURLY_RE = re.c
-00014950: 6f6d 7069 6c65 2822 283f 503c 7072 653e  ompile("(?P<pre>
-00014960: 2e2a 297b 283f 503c 7661 6c75 653e 5b5e  .*){(?P<value>[^
-00014970: 7d5d 2a29 7d28 3f50 3c70 6f73 743e 2e2a  }]*)}(?P<post>.*
-00014980: 2922 290a 636c 6173 7320 4874 6d6c 5374  )").class HtmlSt
-00014990: 796c 653a 0a20 2020 2022 2222 0a20 2020  yle:.    """.   
-000149a0: 206d 6574 686f 6473 2074 6f20 7072 6f63   methods to proc
-000149b0: 6573 7320 7374 796c 6520 6174 7472 6962  ess style attrib
-000149c0: 7574 6573 2061 6e64 203c 7374 796c 653e  utes and <style>
-000149d0: 2065 6c65 6d65 6e74 730a 2020 2020 6e6f   elements.    no
-000149e0: 2069 6e73 7461 6e63 6520 6461 7461 0a20   instance data. 
-000149f0: 2020 2022 2222 0a0a 2020 2020 6465 6620     """..    def 
-00014a00: 5f5f 696e 6974 5f5f 2873 656c 662c 6373  __init__(self,cs
-00014a10: 735f 7374 7269 6e67 3d4e 6f6e 6529 3a0a  s_string=None):.
-00014a20: 2020 2020 2020 2020 7365 6c66 2e63 7373          self.css
-00014a30: 5f73 7472 696e 6720 3d20 6373 735f 7374  _string = css_st
-00014a40: 7269 6e67 0a0a 0a0a 2020 2020 4063 6c61  ring....    @cla
-00014a50: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
-00014a60: 2067 6574 5f63 7373 7374 796c 655f 7374   get_cssstyle_st
-00014a70: 7269 6e67 2863 6c73 2c20 656c 656d 293a  ring(cls, elem):
-00014a80: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00014a90: 2020 2020 2063 6f6e 7665 6e69 656e 6365       convenience
-00014aa0: 206d 6574 686f 6420 746f 2067 6574 2065   method to get e
-00014ab0: 6c65 6d65 6e74 2073 7479 6c65 0a20 2020  lement style.   
-00014ac0: 2020 2020 203a 7061 7261 6d20 656c 656d       :param elem
-00014ad0: 3a20 746f 2067 6574 2073 7479 6c65 2066  : to get style f
-00014ae0: 726f 6d0a 2020 2020 2020 2020 3a72 6574  rom.        :ret
-00014af0: 7572 6e3a 2073 7479 6c65 206f 7220 4e6f  urn: style or No
-00014b00: 6e65 0a20 2020 2020 2020 2022 2222 0a20  ne.        """. 
-00014b10: 2020 2020 2020 2072 6574 7572 6e20 656c         return el
-00014b20: 656d 2e61 7474 7269 622e 6765 7428 2273  em.attrib.get("s
-00014b30: 7479 6c65 2229 0a0a 2320 636c 6173 7320  tyle")..# class 
-00014b40: 4874 6d6c 5374 796c 650a 0a20 2020 2040  HtmlStyle..    @
-00014b50: 636c 6173 736d 6574 686f 640a 2020 2020  classmethod.    
-00014b60: 6465 6620 7365 745f 7374 796c 6528 636c  def set_style(cl
-00014b70: 732c 2065 6c65 6d2c 2076 616c 7565 293a  s, elem, value):
-00014b80: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00014b90: 2020 2020 2063 6f6e 7665 6e69 656e 6365       convenience
-00014ba0: 206d 6574 686f 6420 746f 2073 6574 2073   method to set s
-00014bb0: 7479 6c65 206f 6e20 656c 656d 656e 740a  tyle on element.
-00014bc0: 2020 2020 2020 2020 3a70 6172 616d 2065          :param e
-00014bd0: 6c65 6d3a 656c 656d 656e 7420 746f 2073  lem:element to s
-00014be0: 6574 2073 7479 6c65 206f 6e0a 2020 2020  et style on.    
-00014bf0: 2020 2020 3a70 6172 616d 2076 616c 7565      :param value
-00014c00: 3a20 6373 7320 7374 7269 6e67 3b20 6966  : css string; if
-00014c10: 2022 2220 6f72 204e 6f6e 6520 7265 6d6c   "" or None reml
-00014c20: 7665 7320 6174 7472 6962 7574 650a 2020  ves attribute.  
-00014c30: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00014c40: 2020 6966 2065 6c65 6d20 6973 206e 6f74    if elem is not
-00014c50: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00014c60: 2020 2058 6d6c 4c69 622e 7365 745f 6174     XmlLib.set_at
-00014c70: 746e 616d 655f 7661 6c75 6528 656c 656d  tname_value(elem
-00014c80: 2c20 2273 7479 6c65 222c 2076 616c 7565  , "style", value
-00014c90: 290a 0a20 2020 2023 2063 6c61 7373 2048  )..    # class H
-00014ca0: 746d 6c53 7479 6c65 0a0a 2020 2020 4063  tmlStyle..    @c
-00014cb0: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
-00014cc0: 6566 2065 7874 7261 6374 5f61 6c6c 5f73  ef extract_all_s
-00014cd0: 7479 6c65 5f61 7474 7269 6275 7465 735f  tyle_attributes_
-00014ce0: 746f 5f68 6561 6428 636c 732c 2068 746d  to_head(cls, htm
-00014cf0: 6c5f 656c 656d 293a 0a20 2020 2020 2020  l_elem):.       
-00014d00: 2022 2222 0a20 2020 2020 2020 2046 696e   """.        Fin
-00014d10: 6473 2061 6c6c 2065 6c65 6d65 6e74 7320  ds all elements 
-00014d20: 7769 7468 2040 7374 796c 6520 6174 7472  with @style attr
-00014d30: 6962 7574 6520 616e 6420 6578 7461 6374  ibute and extact
-00014d40: 7320 7468 6520 7464 7874 2073 7479 6c65  s the tdxt style
-00014d50: 7320 746f 203c 6865 6164 3e0a 2020 2020  s to <head>.    
-00014d60: 2020 2020 416c 736f 2073 6574 7320 626f      Also sets bo
-00014d70: 6479 2073 7479 6c65 7320 746f 206e 6f72  dy styles to nor
-00014d80: 6d61 6c0a 2020 2020 2020 2020 3a70 6172  mal.        :par
-00014d90: 616d 2068 746d 6c5f 656c 656d 3a20 746f  am html_elem: to
-00014da0: 7461 6c20 6874 6d6c 206f 626a 6563 7420  tal html object 
-00014db0: 746f 206e 6f72 6d61 6c69 7a65 2e20 4d75  to normalize. Mu
-00014dc0: 7374 2068 6176 6520 3c68 6561 643e 2061  st have <head> a
-00014dd0: 6e64 203c 626f 6479 3e0a 2020 2020 2020  nd <body>.      
-00014de0: 2020 2222 220a 2020 2020 2020 2020 4874    """.        Ht
-00014df0: 6d6c 5374 796c 652e 7265 6d6f 7665 5f65  mlStyle.remove_e
-00014e00: 6d70 7479 5f73 7479 6c65 7328 6874 6d6c  mpty_styles(html
-00014e10: 5f65 6c65 6d29 0a20 2020 2020 2020 2073  _elem).        s
-00014e20: 7479 6c65 645f 656c 656d 7320 3d20 6874  tyled_elems = ht
-00014e30: 6d6c 5f65 6c65 6d2e 7870 6174 6828 222e  ml_elem.xpath(".
-00014e40: 2f2f 2a5b 4073 7479 6c65 5d22 290a 2020  //*[@style]").  
-00014e50: 2020 2020 2020 666f 7220 692c 2073 7479        for i, sty
-00014e60: 6c65 645f 656c 656d 2069 6e20 656e 756d  led_elem in enum
-00014e70: 6572 6174 6528 7374 796c 6564 5f65 6c65  erate(styled_ele
-00014e80: 6d73 293a 0a20 2020 2020 2020 2020 2020  ms):.           
-00014e90: 2063 6c61 7373 7265 6620 3d20 6622 737b   classref = f"s{
-00014ea0: 697d 220a 2020 2020 2020 2020 2020 2020  i}".            
-00014eb0: 4874 6d6c 5374 796c 652e 6164 645f 656c  HtmlStyle.add_el
-00014ec0: 656d 656e 745f 7769 7468 5f73 7479 6c65  ement_with_style
-00014ed0: 2863 6c61 7373 7265 662c 2068 746d 6c5f  (classref, html_
-00014ee0: 656c 656d 2c20 7374 796c 6564 5f65 6c65  elem, styled_ele
-00014ef0: 6d29 0a20 2020 2020 2020 2023 2064 6f65  m).        # doe
-00014f00: 7320 7468 6973 2064 6f20 616e 7974 6869  s this do anythi
-00014f10: 6e67 3f3f 3f0a 2020 2020 2020 2020 626f  ng???.        bo
-00014f20: 6479 203d 2068 746d 6c5f 656c 656d 2e78  dy = html_elem.x
-00014f30: 7061 7468 2822 2f68 746d 6c2f 626f 6479  path("/html/body
-00014f40: 2229 0a20 2020 2020 2020 2069 6620 6c65  ").        if le
-00014f50: 6e28 626f 6479 2920 213d 2031 3a0a 2020  n(body) != 1:.  
-00014f60: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00014f70: 5661 6c75 6545 7272 6f72 2866 2264 6f63  ValueError(f"doc
-00014f80: 756d 656e 7420 7368 6f75 6c64 2068 6176  ument should hav
-00014f90: 6520 6578 6163 746c 7920 3120 626f 6479  e exactly 1 body
-00014fa0: 2074 6167 2229 0a20 2020 2020 2020 2073   tag").        s
-00014fb0: 7479 6c65 203d 2043 5353 5374 796c 6528  tyle = CSSStyle(
-00014fc0: 290a 2020 2020 2020 2020 7374 796c 652e  ).        style.
-00014fd0: 6372 6561 7465 5f63 7373 5f73 7479 6c65  create_css_style
-00014fe0: 5f66 726f 6d5f 6373 735f 7374 7269 6e67  _from_css_string
-00014ff0: 280a 2020 2020 2020 2020 2020 2020 2266  (.            "f
-00015000: 6f6e 742d 7374 796c 653a 206e 6f72 6d61  ont-style: norma
-00015010: 6c3b 2022 0a20 2020 2020 2020 2020 2020  l; ".           
-00015020: 2022 666f 6e74 2d77 6569 6768 743a 206e   "font-weight: n
-00015030: 6f72 6d61 6c3b 2022 0a20 2020 2020 2020  ormal; ".       
-00015040: 2020 2020 2022 666f 6e74 2d73 7472 6574       "font-stret
-00015050: 6368 6564 3a20 6e6f 726d 616c 3b20 220a  ched: normal; ".
-00015060: 2020 2020 2020 2020 2020 2020 226f 7061              "opa
-00015070: 6369 7479 3a20 313b 2022 0a20 2020 2020  city: 1; ".     
-00015080: 2020 2020 2020 2022 636f 6c6f 723a 2062         "color: b
-00015090: 6c61 636b 3b22 0a20 2020 2020 2020 2029  lack;".        )
-000150a0: 0a0a 2020 2020 2320 636c 6173 7320 4874  ..    # class Ht
-000150b0: 6d6c 5374 796c 650a 0a20 2020 2040 636c  mlStyle..    @cl
-000150c0: 6173 736d 6574 686f 640a 2020 2020 6465  assmethod.    de
-000150d0: 6620 6164 645f 656c 656d 656e 745f 7769  f add_element_wi
-000150e0: 7468 5f73 7479 6c65 2863 6c73 2c20 636c  th_style(cls, cl
-000150f0: 6173 7372 6566 2c20 6874 6d6c 5f65 6c65  assref, html_ele
-00015100: 6d2c 2073 7479 6c65 645f 656c 656d 293a  m, styled_elem):
-00015110: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00015120: 2020 2020 2061 6464 730a 2020 2020 2020       adds.      
-00015130: 2020 2222 220a 2020 2020 2020 2020 6865    """.        he
-00015140: 6164 203d 2068 746d 6c5f 656c 656d 2e78  ad = html_elem.x
-00015150: 7061 7468 2822 2f68 746d 6c2f 6865 6164  path("/html/head
-00015160: 2229 5b30 5d0a 2020 2020 2020 2020 656c  ")[0].        el
-00015170: 656d 5f73 7479 6c65 203d 2048 746d 6c53  em_style = HtmlS
-00015180: 7479 6c65 2e67 6574 5f63 7373 7374 796c  tyle.get_cssstyl
-00015190: 655f 7374 7269 6e67 2873 7479 6c65 645f  e_string(styled_
-000151a0: 656c 656d 290a 2020 2020 2020 2020 6966  elem).        if
-000151b0: 2065 6c65 6d5f 7374 796c 6520 6973 204e   elem_style is N
-000151c0: 6f6e 6520 6f72 2065 6c65 6d5f 7374 796c  one or elem_styl
-000151d0: 6520 3d3d 2022 223a 0a20 2020 2020 2020  e == "":.       
-000151e0: 2020 2020 2072 6574 7572 6e0a 2020 2020       return.    
-000151f0: 2020 2020 6373 7320 3d20 4353 5353 7479      css = CSSSty
-00015200: 6c65 2e63 7265 6174 655f 6373 735f 7374  le.create_css_st
-00015210: 796c 655f 6672 6f6d 5f63 7373 5f73 7472  yle_from_css_str
-00015220: 696e 6728 656c 656d 5f73 7479 6c65 290a  ing(elem_style).
-00015230: 2020 2020 2020 2020 6966 2063 7373 2069          if css i
-00015240: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-00015250: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
-00015260: 7272 6f72 2866 2263 7373 2069 7320 4e6f  rror(f"css is No
-00015270: 6e65 2229 0a0a 2020 2020 2020 2020 6578  ne")..        ex
-00015280: 7472 6163 7465 645f 7374 796c 655f 656c  tracted_style_el
-00015290: 656d 2c20 7265 6d61 696e 696e 675f 7374  em, remaining_st
-000152a0: 796c 652c 206e 6577 5f63 6c61 7373 203d  yle, new_class =
-000152b0: 2063 7373 2e65 7874 7261 6374 5f74 6578   css.extract_tex
-000152c0: 745f 7374 796c 6573 5f69 6e74 6f5f 636c  t_styles_into_cl
-000152d0: 6173 7328 636c 6173 7372 6566 290a 2020  ass(classref).  
-000152e0: 2020 2020 2020 6966 2065 7874 7261 6374        if extract
-000152f0: 6564 5f73 7479 6c65 5f65 6c65 6d20 6973  ed_style_elem is
-00015300: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
-00015310: 2020 2020 2020 2048 746d 6c53 7479 6c65         HtmlStyle
-00015320: 2e73 6574 5f73 7479 6c65 2873 7479 6c65  .set_style(style
-00015330: 645f 656c 656d 2c20 7265 6d61 696e 696e  d_elem, remainin
-00015340: 675f 7374 796c 6529 0a20 2020 2020 2020  g_style).       
-00015350: 2020 2020 2048 746d 6c43 6c61 7373 2e73       HtmlClass.s
-00015360: 6574 5f63 6c61 7373 5f6f 6e5f 656c 656d  et_class_on_elem
-00015370: 656e 7428 7374 796c 6564 5f65 6c65 6d2c  ent(styled_elem,
-00015380: 2063 6c61 7373 7265 662c 2072 6570 6c61   classref, repla
-00015390: 6365 3d46 616c 7365 290a 2020 2020 2020  ce=False).      
-000153a0: 2020 2020 2020 6865 6164 2e61 7070 656e        head.appen
-000153b0: 6428 6578 7472 6163 7465 645f 7374 796c  d(extracted_styl
-000153c0: 655f 656c 656d 290a 0a20 2020 2023 2063  e_elem)..    # c
-000153d0: 6c61 7373 2048 746d 6c53 7479 6c65 0a0a  lass HtmlStyle..
-000153e0: 2020 2020 4063 6c61 7373 6d65 7468 6f64      @classmethod
-000153f0: 0a20 2020 2064 6566 2072 656d 6f76 655f  .    def remove_
-00015400: 656d 7074 795f 7374 796c 6573 2863 6c73  empty_styles(cls
-00015410: 2c20 6874 6d6c 5f65 6c65 6d29 3a0a 2020  , html_elem):.  
-00015420: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00015430: 2020 7265 6d6f 7665 7320 616c 6c20 656d    removes all em
-00015440: 7074 7920 7374 796c 6520 6174 7472 6962  pty style attrib
-00015450: 7574 6573 2028 7374 796c 653d 2222 290a  utes (style="").
-00015460: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00015470: 2020 2020 656d 7074 795f 7374 796c 6564      empty_styled
-00015480: 5f65 6c65 6d73 203d 2068 746d 6c5f 656c  _elems = html_el
-00015490: 656d 2e78 7061 7468 2822 2e2f 2f2a 5b6e  em.xpath(".//*[n
-000154a0: 6f72 6d61 6c69 7a65 2d73 7061 6365 2840  ormalize-space(@
-000154b0: 7374 796c 6529 3d27 275d 2229 0a20 2020  style)='']").   
-000154c0: 2020 2020 2066 6f72 2065 6c65 6d20 696e       for elem in
-000154d0: 2065 6d70 7479 5f73 7479 6c65 645f 656c   empty_styled_el
-000154e0: 656d 733a 0a20 2020 2020 2020 2020 2020  ems:.           
-000154f0: 2048 746d 6c53 7479 6c65 2e64 656c 6574   HtmlStyle.delet
-00015500: 655f 7374 796c 6528 656c 656d 290a 0a20  e_style(elem).. 
-00015510: 2020 2023 2063 6c61 7373 2048 746d 6c53     # class HtmlS
-00015520: 7479 6c65 0a0a 2020 2020 4063 6c61 7373  tyle..    @class
-00015530: 6d65 7468 6f64 0a20 2020 2064 6566 2064  method.    def d
-00015540: 656c 6574 655f 7374 796c 6528 636c 732c  elete_style(cls,
-00015550: 2065 6c65 6d29 3a0a 2020 2020 2020 2020   elem):.        
-00015560: 2222 220a 2020 2020 2020 2020 636f 6e76  """.        conv
-00015570: 656e 6965 6e6e 6365 206d 6574 686f 6420  eniennce method 
-00015580: 746f 2064 656c 6574 6520 7374 796c 6520  to delete style 
-00015590: 6174 7472 6962 7574 650a 2020 2020 2020  attribute.      
-000155a0: 2020 2222 220a 2020 2020 2020 2020 586d    """.        Xm
-000155b0: 6c4c 6962 2e72 656d 6f76 655f 6174 7472  lLib.remove_attr
-000155c0: 6962 7574 6528 656c 656d 2c20 2273 7479  ibute(elem, "sty
-000155d0: 6c65 2229 0a0a 2020 2020 2320 5448 4553  le")..    # THES
-000155e0: 4520 4341 4e20 4245 434f 4d45 2049 4e53  E CAN BECOME INS
-000155f0: 5441 4e43 4520 4d45 5448 4f44 530a 0a20  TANCE METHODS.. 
-00015600: 2020 2023 2063 6c61 7373 2048 746d 6c53     # class HtmlS
-00015610: 7479 6c65 0a0a 2020 2020 4063 6c61 7373  tyle..    @class
-00015620: 6d65 7468 6f64 0a20 2020 2064 6566 206e  method.    def n
-00015630: 6f72 6d61 6c69 7a65 5f68 6561 645f 7374  ormalize_head_st
-00015640: 796c 6573 2863 6c73 2c20 656c 656d 2c20  yles(cls, elem, 
-00015650: 6974 616c 6963 5f62 6f6c 643d 5472 7565  italic_bold=True
-00015660: 2c20 6f75 7464 6972 3d4e 6f6e 6529 3a0a  , outdir=None):.
-00015670: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00015680: 2020 2020 6372 6561 7465 7320 6d75 6c74      creates mult
-00015690: 6964 6963 7420 666f 7420 6865 6164 2073  idict fot head s
-000156a0: 7479 6c65 730a 2020 2020 2020 2020 3a70  tyles.        :p
-000156b0: 6172 616d 2065 6c65 6d3a 2064 6f63 756d  aram elem: docum
-000156c0: 656e 7420 746f 2061 6e61 6c79 7365 0a20  ent to analyse. 
-000156d0: 2020 2020 2020 203a 7265 7475 726e 3a20         :return: 
-000156e0: 6469 6374 206f 6620 636c 6173 7372 6566  dict of classref
-000156f0: 5f73 6574 7320 696e 6465 7865 6420 6279  _sets indexed by
-00015700: 2073 7479 6c65 2073 7472 696e 6773 0a0a   style strings..
-00015710: 2020 2020 2020 2020 652e 672e 2069 7465          e.g. ite
-00015720: 6d20 7b66 6f6e 742d 6661 6d69 6c79 3a20  m {font-family: 
-00015730: 5469 6d65 734e 6577 526f 6d61 6e50 534d  TimesNewRomanPSM
-00015740: 543b 2066 6f6e 742d 7369 7a65 3a20 3670  T; font-size: 6p
-00015750: 783b 7d3a 205b 272e 7331 3727 2c20 272e  x;}: ['.s17', '.
-00015760: 7331 3927 2c20 272e 7332 3127 2c20 272e  s19', '.s21', '.
-00015770: 7332 3727 2c20 272e 7335 272c 2027 2e73  s27', '.s5', '.s
-00015780: 3727 5d0a 2020 2020 2020 2020 2222 220a  7'].        """.
-00015790: 2020 2020 2020 2020 7374 796c 655f 746f          style_to
-000157a0: 5f63 6c61 7373 7265 665f 7365 7420 3d20  _classref_set = 
-000157b0: 6465 6661 756c 7464 6963 7428 7365 7429  defaultdict(set)
-000157c0: 0a20 2020 2020 2020 2068 6561 645f 7374  .        head_st
-000157d0: 796c 6573 203d 2048 746d 6c53 7479 6c65  yles = HtmlStyle
-000157e0: 2e67 6574 5f68 6561 645f 7374 796c 6573  .get_head_styles
-000157f0: 2865 6c65 6d29 0a20 2020 2020 2020 2023  (elem).        #
-00015800: 2077 6520 7573 6520 6f6e 6520 636c 6173   we use one clas
-00015810: 7372 6566 202d 2073 7479 6c65 2070 6572  sref - style per
-00015820: 2048 544d 4c20 7374 796c 650a 2020 2020   HTML style.    
-00015830: 2020 2020 666f 7220 6874 6d6c 5f73 7479      for html_sty
-00015840: 6c65 2069 6e20 6865 6164 5f73 7479 6c65  le in head_style
-00015850: 733a 0a20 2020 2020 2020 2020 2020 2023  s:.            #
-00015860: 2063 6f6e 7369 7374 7320 6f66 2063 6c61   consists of cla
-00015870: 7373 7265 6620 736e 6420 7374 796c 655f  ssref snd style_
-00015880: 7374 7269 6e67 0a20 2020 2020 2020 2020  string.         
-00015890: 2020 2063 6c61 7373 7265 662c 2073 7479     classref, sty
-000158a0: 6c65 5f73 203d 2063 6c73 2e65 7874 7261  le_s = cls.extra
-000158b0: 6374 5f63 6c61 7373 7265 665f 616e 645f  ct_classref_and_
-000158c0: 6373 7373 7472 696e 675f 6672 6f6d 5f68  cssstring_from_h
-000158d0: 746d 6c5f 7374 796c 6528 6874 6d6c 5f73  tml_style(html_s
-000158e0: 7479 6c65 290a 2020 2020 2020 2020 2020  tyle).          
-000158f0: 2020 7374 796c 655f 7661 6c75 6520 3d20    style_value = 
-00015900: 7374 796c 655f 730a 2020 2020 2020 2020  style_s.        
-00015910: 2020 2020 6966 2069 7461 6c69 635f 626f      if italic_bo
-00015920: 6c64 3a0a 2020 2020 2020 2020 2020 2020  ld:.            
-00015930: 2020 2020 6e65 775f 6373 735f 7320 3d20      new_css_s = 
-00015940: 416d 6946 6f6e 742e 6372 6561 7465 5f66  AmiFont.create_f
-00015950: 6f6e 745f 6564 6974 6564 5f73 7479 6c65  ont_edited_style
-00015960: 5f66 726f 6d5f 6373 735f 7374 796c 655f  _from_css_style_
-00015970: 6f62 6a65 6374 2873 7479 6c65 5f73 290a  object(style_s).
-00015980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015990: 6373 735f 7374 796c 6520 3d20 4353 5353  css_style = CSSS
-000159a0: 7479 6c65 2e63 7265 6174 655f 6373 735f  tyle.create_css_
-000159b0: 7374 796c 655f 6672 6f6d 5f63 7373 5f73  style_from_css_s
-000159c0: 7472 696e 6728 6e65 775f 6373 735f 7329  tring(new_css_s)
-000159d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000159e0: 2069 6620 6373 735f 7374 796c 6520 6973   if css_style is
-000159f0: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
-00015a00: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00015a10: 7373 5f73 7479 6c65 2e65 7874 7261 6374  ss_style.extract
-00015a20: 5f62 6f6c 645f 6974 616c 6963 5f66 726f  _bold_italic_fro
-00015a30: 6d5f 666f 6e74 5f66 616d 696c 7928 290a  m_font_family().
-00015a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015a50: 2020 2020 7374 796c 655f 7661 6c75 6520      style_value 
-00015a60: 3d20 6373 735f 7374 796c 652e 6765 745f  = css_style.get_
-00015a70: 6373 735f 7661 6c75 6528 7772 6170 5f77  css_value(wrap_w
-00015a80: 6974 685f 6375 726c 793d 5472 7565 290a  ith_curly=True).
-00015a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015aa0: 2020 2020 4874 6d6c 5374 796c 652e 7265      HtmlStyle.re
-00015ab0: 706c 6163 655f 6375 726c 7928 6874 6d6c  place_curly(html
-00015ac0: 5f73 7479 6c65 2c20 7374 796c 655f 7661  _style, style_va
-00015ad0: 6c75 6529 0a20 2020 2020 2020 2020 2020  lue).           
-00015ae0: 2068 746d 6c5f 7374 796c 652e 6174 7472   html_style.attr
-00015af0: 6962 5b43 4c41 5353 5245 465d 203d 2063  ib[CLASSREF] = c
-00015b00: 6c61 7373 7265 660a 2020 2020 2020 2020  lassref.        
-00015b10: 2020 2020 7374 796c 655f 746f 5f63 6c61      style_to_cla
-00015b20: 7373 7265 665f 7365 745b 7374 796c 655f  ssref_set[style_
-00015b30: 7661 6c75 655d 2e61 6464 2863 6c61 7373  value].add(class
-00015b40: 7265 6629 0a20 2020 2020 2020 2069 6620  ref).        if 
-00015b50: 6f75 7464 6972 3a0a 2020 2020 2020 2020  outdir:.        
-00015b60: 2020 2020 4874 6d6c 4c69 622e 7772 6974      HtmlLib.writ
-00015b70: 655f 6874 6d6c 5f66 696c 6528 656c 656d  e_html_file(elem
-00015b80: 2c20 5061 7468 286f 7574 6469 722c 2022  , Path(outdir, "
-00015b90: 6e6f 726d 616c 697a 6564 2e68 746d 6c22  normalized.html"
-00015ba0: 2929 0a20 2020 2020 2020 2072 6574 7572  )).        retur
-00015bb0: 6e20 7374 796c 655f 746f 5f63 6c61 7373  n style_to_class
-00015bc0: 7265 665f 7365 740a 0a20 2020 2040 636c  ref_set..    @cl
-00015bd0: 6173 736d 6574 686f 640a 2020 2020 6465  assmethod.    de
-00015be0: 6620 6765 745f 6865 6164 5f73 7479 6c65  f get_head_style
-00015bf0: 7328 636c 732c 2065 6c65 6d29 3a0a 2020  s(cls, elem):.  
-00015c00: 2020 2020 2020 2222 2267 6574 2061 6c6c        """get all
-00015c10: 203c 7374 796c 653e 2065 6c65 6d65 6e74   <style> element
-00015c20: 7320 6666 726f 6d20 3c68 6561 643e 0a20  s ffrom <head>. 
-00015c30: 2020 2020 2020 203a 7061 7461 6d20 656c         :patam el
-00015c40: 656d 3a20 6874 6d6c 2065 6c65 6d6e 656e  em: html elemnen
-00015c50: 7420 746f 2073 6561 7263 680a 2020 2020  t to search.    
-00015c60: 2020 2020 3a72 6574 7572 6e3a 2073 7479      :return: sty
-00015c70: 6c65 2065 6c65 6d65 6e74 7320 656c 7365  le elements else
-00015c80: 205b 5d20 6966 2065 6c65 6d20 6973 204e   [] if elem is N
-00015c90: 6f6e 650a 2020 2020 2020 2020 2222 220a  one.        """.
-00015ca0: 2020 2020 2020 2020 7265 7475 726e 205b          return [
-00015cb0: 5d20 6966 2065 6c65 6d20 6973 204e 6f6e  ] if elem is Non
-00015cc0: 6520 656c 7365 2065 6c65 6d2e 7870 6174  e else elem.xpat
-00015cd0: 6828 222f 6874 6d6c 2f68 6561 642f 7374  h("/html/head/st
-00015ce0: 796c 6522 290a 0a20 2020 2040 636c 6173  yle")..    @clas
-00015cf0: 736d 6574 686f 640a 2020 2020 6465 6620  smethod.    def 
-00015d00: 6578 7472 6163 745f 636c 6173 7372 6566  extract_classref
-00015d10: 5f61 6e64 5f63 7373 7374 7269 6e67 5f66  _and_cssstring_f
-00015d20: 726f 6d5f 7374 796c 655f 7465 7874 2863  rom_style_text(c
-00015d30: 6c73 2c20 6874 6d6c 5f73 7479 6c65 5f73  ls, html_style_s
-00015d40: 7472 696e 6729 3a0a 2020 2020 2020 2020  tring):.        
-00015d50: 2222 2270 6172 7365 7320 7465 7874 2069  """parses text i
-00015d60: 6e20 6874 6d6c 203c 7374 796c 653e 2069  n html <style> i
-00015d70: 6e74 6f20 636c 6173 7372 6566 2061 6e64  nto classref and
-00015d80: 2063 7373 7374 7269 6e67 0a20 2020 2020   cssstring.     
-00015d90: 2020 206f 6e6c 7920 6f6e 6520 7374 796c     only one styl
-00015da0: 6520 7065 7220 6874 6d6c 2065 6c65 6d65  e per html eleme
-00015db0: 6e74 0a20 2020 2020 2020 203a 7061 7261  nt.        :para
-00015dc0: 6d20 6874 6d6c 5f73 7479 6c65 5f73 7472  m html_style_str
-00015dd0: 696e 673a 206f 6620 666f 726d 203c 7365  ing: of form <se
-00015de0: 6c65 6374 6f72 3e20 7b3c 7661 6c75 653e  lector> {<value>
-00015df0: 7d0a 2020 2020 2020 2020 3a72 6574 7572  }.        :retur
-00015e00: 6e20 7365 6c65 6374 6f72 202c 2076 616c  n selector , val
-00015e10: 7565 0a20 2020 2020 2020 2022 2222 0a0a  ue.        """..
-00015e20: 2020 2020 2020 2020 7374 796c 655f 7265          style_re
-00015e30: 203d 2072 652e 636f 6d70 696c 6528 225c   = re.compile("\
-00015e40: 5c73 2a28 3f50 3c63 6c61 7373 7265 663e  \s*(?P<classref>
-00015e50: 5b5e 5c5c 735d 2a29 5c5c 732b 7b5c 5c73  [^\\s]*)\\s+{\\s
-00015e60: 2a28 3f50 3c63 7373 7374 7269 6e67 3e2e  *(?P<cssstring>.
-00015e70: 2a29 7d5c 5c73 2a22 290a 2020 2020 2020  *)}\\s*").      
-00015e80: 2020 6d61 7463 6820 3d20 7374 796c 655f    match = style_
-00015e90: 7265 2e6d 6174 6368 2868 746d 6c5f 7374  re.match(html_st
-00015ea0: 796c 655f 7374 7269 6e67 290a 2020 2020  yle_string).    
-00015eb0: 2020 2020 6966 206e 6f74 206d 6174 6368      if not match
-00015ec0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-00015ed0: 7475 726e 204e 6f6e 652c 204e 6f6e 650a  turn None, None.
-00015ee0: 2020 2020 2020 2020 7265 7475 726e 206d          return m
-00015ef0: 6174 6368 2e67 726f 7570 2822 636c 6173  atch.group("clas
-00015f00: 7372 6566 2229 2c20 6d61 7463 682e 6772  sref"), match.gr
-00015f10: 6f75 7028 2263 7373 7374 7269 6e67 2229  oup("cssstring")
-00015f20: 0a0a 2020 2020 2320 636c 6173 7320 4874  ..    # class Ht
-00015f30: 6d6c 5374 796c 650a 0a20 2020 2040 636c  mlStyle..    @cl
-00015f40: 6173 736d 6574 686f 640a 2020 2020 6465  assmethod.    de
-00015f50: 6620 6578 7472 6163 745f 7374 796c 6573  f extract_styles
-00015f60: 5f61 6e64 5f6e 6f72 6d61 6c69 7a65 5f63  _and_normalize_c
-00015f70: 6c61 7373 7265 6673 2863 6c73 2c20 6874  lassrefs(cls, ht
-00015f80: 6d6c 5f65 6c65 6d2c 2066 6f6e 745f 7374  ml_elem, font_st
-00015f90: 796c 6573 3d46 616c 7365 2c20 6f75 7464  yles=False, outd
-00015fa0: 6972 3d4e 6f6e 6529 3a0a 2020 2020 2020  ir=None):.      
-00015fb0: 2020 2222 220a 2020 2020 2020 2020 4578    """.        Ex
-00015fc0: 7472 6163 7420 7374 796c 6573 2066 726f  tract styles fro
-00015fd0: 6d20 646f 6375 6d65 6e74 0a20 2020 2020  m document.     
-00015fe0: 2020 206d 6f76 6520 746f 2068 6561 6420     move to head 
-00015ff0: 616e 6420 6e6f 726d 616c 697a 6520 636c  and normalize cl
-00016000: 6173 7372 6566 730a 2020 2020 2020 2020  assrefs.        
-00016010: 6465 6c65 7465 2072 6564 756e 6461 6e74  delete redundant
-00016020: 2063 6c61 7373 7265 6673 2061 6e64 2073   classrefs and s
-00016030: 7479 6c65 730a 2020 2020 2020 2020 6d61  tyles.        ma
-00016040: 7020 646f 6375 6d65 6e74 2069 6e73 7461  p document insta
-00016050: 6d63 6573 206f 6620 7374 796c 6573 206f  mces of styles o
-00016060: 6e74 6f20 6e6f 726d 616c 697a 6564 2063  nto normalized c
-00016070: 6c61 7373 7265 6673 0a20 2020 2020 2020  lassrefs.       
-00016080: 203a 7061 7261 6d20 6874 6d6c 5f65 6c65   :param html_ele
-00016090: 6d3a 2068 746d 6c20 646f 6375 6d65 6e74  m: html document
-000160a0: 2074 6f20 6e6f 726d 616c 697a 650a 0a20   to normalize.. 
-000160b0: 2020 2020 2020 2053 686f 756c 6420 6265         Should be
-000160c0: 2069 6e20 616e 206f 626a 6563 740a 2020   in an object.  
-000160d0: 2020 2020 2020 544f 444f 0a53 6f6d 6520        TODO.Some 
-000160e0: 7370 616e 7320 6172 6520 6e6f 7420 6a6f  spans are not jo
-000160f0: 696e 6564 2c20 7831 206f 6e20 6f6e 6520  ined, x1 on one 
-00016100: 7370 616e 2061 6e64 2078 3020 6f6e 2066  span and x0 on f
-00016110: 6f6c 6c6f 7769 6e67 2061 7265 2065 7175  ollowing are equ
-00016120: 616c 0a20 2020 2020 2020 203c 6469 7620  al.        <div 
-00016130: 6c65 6674 3d22 3134 312e 3732 2220 7269  left="141.72" ri
-00016140: 6768 743d 2231 3933 2e33 2220 746f 703d  ght="193.3" top=
-00016150: 2236 3332 2e32 3222 3e3c 7370 616e 2078  "632.22"><span x
-00016160: 303d 2231 3431 2e37 3222 2079 303d 2236  0="141.72" y0="6
-00016170: 3332 2e32 3222 2078 313d 2231 3933 2e33  32.22" x1="193.3
-00016180: 2220 7374 796c 653d 2278 303a 2031 3431  " style="x0: 141
-00016190: 2e37 323b 2078 313a 2031 3435 2e30 333b  .72; x1: 145.03;
-000161a0: 2079 303a 2036 3332 2e32 323b 2079 313a   y0: 632.22; y1:
-000161b0: 2036 3432 2e31 383b 2077 6964 7468 3a20   642.18; width: 
-000161c0: 332e 3332 3b22 2063 6c61 7373 3d22 7331  3.32;" class="s1
-000161d0: 3022 3e28 6129 416e 20e2 809c 3c2f 7370  0">(a)An ...</sp
-000161e0: 616e 3e0a 2020 2020 2020 2020 3c73 7061  an>.        <spa
-000161f0: 6e20 7830 3d22 3232 342e 3034 2220 7930  n x0="224.04" y0
-00016200: 3d22 3632 302e 3232 2220 7831 3d22 3338  ="620.22" x1="38
-00016210: 372e 3934 2220 7374 796c 653d 2278 303a  7.94" style="x0:
-00016220: 2032 3234 2e30 343b 2078 313a 2032 3239   224.04; x1: 229
-00016230: 2e30 323b 2079 303a 2036 3230 2e32 323b  .02; y0: 620.22;
-00016240: 2079 313a 2036 3330 2e31 383b 2077 6964   y1: 630.18; wid
-00016250: 7468 3a20 342e 3938 3b22 2063 6c61 7373  th: 4.98;" class
-00016260: 3d22 7331 3022 3e70 6172 6167 7261 7068  ="s10">paragraph
-00016270: 7320 34e2 8092 362c 2074 6865 7365 2072  s 4...6, these r
-00016280: 756c 6573 2c20 6d6f 6461 6c69 7469 6573  ules, modalities
-00016290: 2061 3c2f 7370 616e 3e0a 2020 2020 2020   a</span>.      
-000162a0: 2020 3c73 7061 6e20 7830 3d22 3338 372e    <span x0="387.
-000162b0: 3936 2220 7930 3d22 3632 302e 3232 2220  96" y0="620.22" 
-000162c0: 7831 3d22 3438 342e 3238 2220 7374 796c  x1="484.28" styl
-000162d0: 653d 2278 303a 2033 3837 2e39 363b 2078  e="x0: 387.96; x
-000162e0: 313a 2033 3932 2e39 343b 2079 303a 2036  1: 392.94; y0: 6
-000162f0: 3230 2e32 323b 2079 313a 2036 3330 2e31  20.22; y1: 630.1
-00016300: 383b 2077 6964 7468 3a20 342e 3938 3b22  8; width: 4.98;"
-00016310: 2063 6c61 7373 3d22 7331 3022 3e6e 6420   class="s10">nd 
-00016320: 7072 6f63 6564 7572 6573 2c20 616e 6420  procedures, and 
-00016330: 616e 7920 6675 7274 6865 7220 7265 6c65  any further rele
-00016340: 7661 6e74 2064 6563 6973 696f 6e73 206f  vant decisions o
-00016350: 6620 7468 6520 436f 6e66 6572 656e 6365  f the Conference
-00016360: 206f 6620 7468 6520 5061 7274 6965 7320   of the Parties 
-00016370: 7365 7276 696e 6720 6173 2074 6865 206d  serving as the m
-00016380: 6565 7469 6e67 206f 6620 7468 6520 5061  eeting of the Pa
-00016390: 7274 6965 7320 746f 2074 6865 2050 6172  rties to the Par
-000163a0: 6973 2041 6772 6565 6d65 6e74 2028 434d  is Agreement (CM
-000163b0: 4129 3b20 3c2f 7370 616e 3e3c 2f64 6976  A); </span></div
-000163c0: 3e0a 2020 2020 2020 2020 2222 220a 0a20  >.        """.. 
-000163d0: 2020 2020 2020 2023 2068 746d 6c5f 656c         # html_el
-000163e0: 656d 203d 2068 746d 6c5f 656c 656d 2e78  em = html_elem.x
-000163f0: 7061 7468 2822 2f2a 2229 5b30 5d20 6966  path("/*")[0] if
-00016400: 2074 7970 6528 6874 6d6c 5f65 6c65 6d29   type(html_elem)
-00016410: 2069 7320 5f45 6c65 6d65 6e74 5472 6565   is _ElementTree
-00016420: 2065 6c73 6520 6874 6d6c 5f65 6c65 6d0a   else html_elem.
-00016430: 2020 2020 2020 2020 636c 732e 6578 7472          cls.extr
-00016440: 6163 745f 616c 6c5f 7374 796c 655f 6174  act_all_style_at
-00016450: 7472 6962 7574 6573 5f74 6f5f 6865 6164  tributes_to_head
-00016460: 2868 746d 6c5f 656c 656d 290a 2020 2020  (html_elem).    
-00016470: 2020 2020 6966 206f 7574 6469 723a 0a20      if outdir:. 
-00016480: 2020 2020 2020 2020 2020 2048 746d 6c4c             HtmlL
-00016490: 6962 2e77 7269 7465 5f68 746d 6c5f 6669  ib.write_html_fi
-000164a0: 6c65 2868 746d 6c5f 656c 656d 2c20 5061  le(html_elem, Pa
-000164b0: 7468 286f 7574 6469 722c 2022 7374 796c  th(outdir, "styl
-000164c0: 6573 312e 6874 6d6c 2229 2c20 6465 6275  es1.html"), debu
-000164d0: 673d 5472 7565 290a 2020 2020 2020 2020  g=True).        
-000164e0: 7374 796c 655f 746f 5f63 6c61 7373 7265  style_to_classre
-000164f0: 665f 7365 7420 3d20 636c 732e 6e6f 726d  f_set = cls.norm
-00016500: 616c 697a 655f 6865 6164 5f73 7479 6c65  alize_head_style
-00016510: 7328 6874 6d6c 5f65 6c65 6d2c 206f 7574  s(html_elem, out
-00016520: 6469 723d 6f75 7464 6972 290a 2020 2020  dir=outdir).    
-00016530: 2020 2020 636c 6173 7372 6566 5f69 6e64      classref_ind
-00016540: 6578 203d 2063 6c73 2e63 7265 6174 655f  ex = cls.create_
-00016550: 636c 6173 7372 6566 5f69 6e64 6578 2873  classref_index(s
-00016560: 7479 6c65 5f74 6f5f 636c 6173 7372 6566  tyle_to_classref
-00016570: 5f73 6574 290a 2020 2020 2020 2020 6465  _set).        de
-00016580: 6c65 7461 626c 655f 636c 6173 7372 6566  letable_classref
-00016590: 7320 3d20 636c 732e 6765 745f 7265 6475  s = cls.get_redu
-000165a0: 6e64 616e 745f 636c 6173 7372 6566 7328  ndant_classrefs(
-000165b0: 636c 6173 7372 6566 5f69 6e64 6578 290a  classref_index).
-000165c0: 2020 2020 2020 2020 636c 732e 6465 6c65          cls.dele
-000165d0: 7465 5f72 6564 756e 6461 6e74 5f73 7479  te_redundant_sty
-000165e0: 6c65 7328 6465 6c65 7461 626c 655f 636c  les(deletable_cl
-000165f0: 6173 7372 6566 732c 2068 746d 6c5f 656c  assrefs, html_el
-00016600: 656d 290a 2020 2020 2020 2020 636c 732e  em).        cls.
-00016610: 6e6f 726d 616c 697a 655f 636c 6173 7372  normalize_classr
-00016620: 6566 735f 6f6e 5f65 6c65 6d65 6e74 7328  efs_on_elements(
-00016630: 6874 6d6c 5f65 6c65 6d2c 2063 6c61 7373  html_elem, class
-00016640: 7265 665f 696e 6465 7829 0a20 2020 2020  ref_index).     
-00016650: 2020 2069 6620 666f 6e74 5f73 7479 6c65     if font_style
-00016660: 733a 0a20 2020 2020 2020 2020 2020 2063  s:.            c
-00016670: 6c73 2e63 7265 6174 655f 6162 6272 6576  ls.create_abbrev
-00016680: 6961 7465 645f 666f 6e74 5f73 7479 6c65  iated_font_style
-00016690: 7328 6874 6d6c 5f65 6c65 6d29 0a0a 2020  s(html_elem)..  
-000166a0: 2020 2320 636c 6173 7320 4874 6d6c 5374    # class HtmlSt
-000166b0: 796c 650a 0a20 2020 2040 636c 6173 736d  yle..    @classm
-000166c0: 6574 686f 640a 2020 2020 6465 6620 6e6f  ethod.    def no
-000166d0: 726d 616c 697a 655f 636c 6173 7372 6566  rmalize_classref
-000166e0: 735f 6f6e 5f65 6c65 6d65 6e74 7328 636c  s_on_elements(cl
-000166f0: 732c 2068 746d 6c5f 656c 656d 2c20 636c  s, html_elem, cl
-00016700: 6173 7372 6566 5f69 6e64 6578 293a 0a20  assref_index):. 
-00016710: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00016720: 2020 2046 696e 6473 2061 6c6c 2065 6c6d     Finds all elm
-00016730: 656e 7473 2077 6974 6820 4063 6c61 7373  ents with @class
-00016740: 2061 7474 7269 6275 7465 2061 6e64 206e   attribute and n
-00016750: 6f72 6d61 6c69 7a65 2074 6f20 6d69 6e69  ormalize to mini
-00016760: 6d61 6c20 7365 740a 2020 2020 2020 2020  mal set.        
-00016770: 2222 220a 2020 2020 2020 2020 636c 6173  """.        clas
-00016780: 7365 645f 656c 656d 7320 3d20 6874 6d6c  sed_elems = html
-00016790: 5f65 6c65 6d2e 7870 6174 6828 222f 2f2a  _elem.xpath("//*
-000167a0: 5b40 636c 6173 735d 2229 0a20 2020 2020  [@class]").     
-000167b0: 2020 2066 6f72 2063 6c61 7373 6564 5f65     for classed_e
-000167c0: 6c65 6d20 696e 2063 6c61 7373 6564 5f65  lem in classed_e
-000167d0: 6c65 6d73 3a0a 2020 2020 2020 2020 2020  lems:.          
-000167e0: 2020 6874 6d6c 5f63 6c61 7373 203d 2048    html_class = H
-000167f0: 746d 6c43 6c61 7373 2e63 7265 6174 655f  tmlClass.create_
-00016800: 6672 6f6d 5f63 6c61 7373 6564 5f65 6c65  from_classed_ele
-00016810: 6d65 6e74 2863 6c61 7373 6564 5f65 6c65  ment(classed_ele
-00016820: 6d29 0a20 2020 2020 2020 2020 2020 2063  m).            c
-00016830: 6c61 7373 7265 6620 3d20 6874 6d6c 5f63  lassref = html_c
-00016840: 6c61 7373 2e63 7265 6174 655f 636c 6173  lass.create_clas
-00016850: 7372 6566 2829 0a20 2020 2020 2020 2020  sref().         
-00016860: 2020 206e 6f72 6d61 6c69 7a65 645f 636c     normalized_cl
-00016870: 6173 7372 6566 203d 2048 746d 6c43 6c61  assref = HtmlCla
-00016880: 7373 2e72 656d 6f76 655f 646f 7428 636c  ss.remove_dot(cl
-00016890: 6173 7372 6566 5f69 6e64 6578 2e67 6574  assref_index.get
-000168a0: 2863 6c61 7373 7265 6629 290a 2020 2020  (classref)).    
-000168b0: 2020 2020 2020 2020 636c 6173 7372 6566          classref
-000168c0: 203d 2048 746d 6c43 6c61 7373 2e72 656d   = HtmlClass.rem
-000168d0: 6f76 655f 646f 7428 636c 6173 7372 6566  ove_dot(classref
-000168e0: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-000168f0: 206e 6f72 6d61 6c69 7a65 645f 636c 6173   normalized_clas
-00016900: 7372 6566 2021 3d20 636c 6173 7372 6566  sref != classref
-00016910: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00016920: 2020 6874 6d6c 5f63 6c61 7373 2e72 6570    html_class.rep
-00016930: 6c61 6365 5f63 6c61 7373 2863 6c61 7373  lace_class(class
-00016940: 7265 662c 206e 6f72 6d61 6c69 7a65 645f  ref, normalized_
-00016950: 636c 6173 7372 6566 290a 2020 2020 2020  classref).      
-00016960: 2020 2020 2020 2020 2020 6966 2068 746d            if htm
-00016970: 6c5f 636c 6173 732e 636c 6173 735f 7374  l_class.class_st
-00016980: 7269 6e67 3a0a 2020 2020 2020 2020 2020  ring:.          
-00016990: 2020 2020 2020 2020 2020 4874 6d6c 436c            HtmlCl
-000169a0: 6173 732e 7365 745f 636c 6173 735f 6f6e  ass.set_class_on
-000169b0: 5f65 6c65 6d65 6e74 2863 6c61 7373 6564  _element(classed
-000169c0: 5f65 6c65 6d2c 2068 746d 6c5f 636c 6173  _elem, html_clas
-000169d0: 732e 636c 6173 735f 7374 7269 6e67 290a  s.class_string).
-000169e0: 0a20 2020 2023 2063 6c61 7373 2048 746d  .    # class Htm
-000169f0: 6c53 7479 6c65 0a0a 2020 2020 4063 6c61  lStyle..    @cla
-00016a00: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
-00016a10: 2064 656c 6574 655f 7265 6475 6e64 616e   delete_redundan
-00016a20: 745f 7374 796c 6573 2863 6c73 2c20 6465  t_styles(cls, de
-00016a30: 6c65 7461 626c 655f 636c 6173 7372 6566  letable_classref
-00016a40: 732c 2068 746d 6c5f 656c 656d 293a 0a20  s, html_elem):. 
-00016a50: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00016a60: 2020 2064 656c 6574 6573 2072 6564 756e     deletes redun
-00016a70: 6461 6e74 203c 7374 796c 653e 7320 696e  dant <style>s in
-00016a80: 2068 6561 640a 2020 2020 2020 2020 2222   head.        ""
-00016a90: 220a 2020 2020 2020 2020 7374 796c 6573  ".        styles
-00016aa0: 5f77 6974 685f 636c 6173 7372 6566 7320  _with_classrefs 
-00016ab0: 3d20 6874 6d6c 5f65 6c65 6d2e 7870 6174  = html_elem.xpat
-00016ac0: 6828 222f 6874 6d6c 2f68 6561 642f 7374  h("/html/head/st
-00016ad0: 796c 655b 4063 6c61 7373 7265 665d 2229  yle[@classref]")
-00016ae0: 0a20 2020 2020 2020 2066 6f72 2073 7479  .        for sty
-00016af0: 6c65 2069 6e20 7374 796c 6573 5f77 6974  le in styles_wit
-00016b00: 685f 636c 6173 7372 6566 733a 0a20 2020  h_classrefs:.   
-00016b10: 2020 2020 2020 2020 2063 6c61 7373 7265           classre
-00016b20: 6620 3d20 7374 796c 652e 6174 7472 6962  f = style.attrib
-00016b30: 2e67 6574 2843 4c41 5353 5245 4629 0a20  .get(CLASSREF). 
-00016b40: 2020 2020 2020 2020 2020 2069 6620 636c             if cl
-00016b50: 6173 7372 6566 2069 6e20 6465 6c65 7461  assref in deleta
-00016b60: 626c 655f 636c 6173 7372 6566 733a 0a20  ble_classrefs:. 
-00016b70: 2020 2020 2020 2020 2020 2020 2020 2058                 X
-00016b80: 6d6c 4c69 622e 7265 6d6f 7665 5f65 6c65  mlLib.remove_ele
-00016b90: 6d65 6e74 2873 7479 6c65 290a 0a20 2020  ment(style)..   
-00016ba0: 2023 2063 6c61 7373 2048 746d 6c53 7479   # class HtmlSty
-00016bb0: 6c65 0a0a 2020 2020 4063 6c61 7373 6d65  le..    @classme
-00016bc0: 7468 6f64 0a20 2020 2064 6566 2067 6574  thod.    def get
-00016bd0: 5f72 6564 756e 6461 6e74 5f63 6c61 7373  _redundant_class
-00016be0: 7265 6673 2863 6c73 2c20 636c 6173 7372  refs(cls, classr
-00016bf0: 6566 5f69 6e64 6578 293a 0a20 2020 2020  ef_index):.     
-00016c00: 2020 2022 2222 0a20 2020 2020 2020 206d     """.        m
-00016c10: 616b 6573 206c 6973 7420 6f66 2072 6564  akes list of red
-00016c20: 756e 6461 6e74 2063 6c61 7373 7265 6673  undant classrefs
-00016c30: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-00016c40: 636c 6173 7372 6566 5f69 6e64 6578 3a20  classref_index: 
-00016c50: 6469 6374 696f 6e61 7279 206d 6170 7069  dictionary mappi
-00016c60: 6e67 2063 6c61 7373 7265 6673 206f 6e74  ng classrefs ont
-00016c70: 6f20 6e6f 726d 616c 697a 6564 2063 6c61  o normalized cla
-00016c80: 7373 7265 660a 2020 2020 2020 2020 3a72  ssref.        :r
-00016c90: 6574 7572 6e3a 206c 6973 7420 6f66 2072  eturn: list of r
-00016ca0: 6564 756e 6461 6e74 2063 6c61 7373 7265  edundant classre
-00016cb0: 6673 0a20 2020 2020 2020 2022 2222 0a20  fs.        """. 
-00016cc0: 2020 2020 2020 2072 6564 756e 6461 6e74         redundant
-00016cd0: 5f63 6c61 7373 7265 6673 203d 205b 5d0a  _classrefs = [].
-00016ce0: 2020 2020 2020 2020 666f 7220 6974 656d          for item
-00016cf0: 2069 6e20 636c 6173 7372 6566 5f69 6e64   in classref_ind
-00016d00: 6578 2e69 7465 6d73 2829 3a0a 2020 2020  ex.items():.    
-00016d10: 2020 2020 2020 2020 6966 2069 7465 6d5b          if item[
-00016d20: 305d 2021 3d20 6974 656d 5b31 5d3a 0a20  0] != item[1]:. 
-00016d30: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00016d40: 6564 756e 6461 6e74 5f63 6c61 7373 7265  edundant_classre
-00016d50: 6673 2e61 7070 656e 6428 6974 656d 5b30  fs.append(item[0
-00016d60: 5d29 0a20 2020 2020 2020 2072 6574 7572  ]).        retur
-00016d70: 6e20 7265 6475 6e64 616e 745f 636c 6173  n redundant_clas
-00016d80: 7372 6566 730a 0a20 2020 2023 2063 6c61  srefs..    # cla
-00016d90: 7373 2048 746d 6c53 7479 6c65 0a0a 2020  ss HtmlStyle..  
-00016da0: 2020 4063 6c61 7373 6d65 7468 6f64 0a20    @classmethod. 
-00016db0: 2020 2064 6566 2063 7265 6174 655f 636c     def create_cl
-00016dc0: 6173 7372 6566 5f69 6e64 6578 2863 6c73  assref_index(cls
-00016dd0: 2c20 7374 796c 655f 746f 5f63 6c61 7373  , style_to_class
-00016de0: 7265 665f 7365 7429 3a0a 2020 2020 2020  ref_set):.      
-00016df0: 2020 2222 220a 2020 2020 2020 2020 6d61    """.        ma
-00016e00: 7073 2061 6c6c 2069 7465 6d73 2069 6e20  ps all items in 
-00016e10: 636c 6173 7372 6566 2073 6574 7320 6f6e  classref sets on
-00016e20: 746f 2028 6172 6269 7472 6172 696c 7929  to (arbitrarily)
-00016e30: 2074 6865 2066 6972 7374 0a20 2020 2020   the first.     
-00016e40: 2020 203a 7061 7261 6d20 7374 796c 655f     :param style_
-00016e50: 746f 5f63 6c61 7373 7265 665f 7365 743a  to_classref_set:
-00016e60: 2063 6c61 7373 7265 665f 7365 7473 206d   classref_sets m
-00016e70: 6d61 7070 6564 2062 7920 7374 796c 6520  mapped by style 
-00016e80: 7661 6c75 650a 2020 2020 2020 2020 3a72  value.        :r
-00016e90: 6574 7572 6e3a 6469 6374 206d 6170 7069  eturn:dict mappi
-00016ea0: 6e67 2072 6564 756e 6461 6e74 2063 6c61  ng redundant cla
-00016eb0: 7373 7265 6673 206f 6e74 6f20 6e6f 726d  ssrefs onto norm
-00016ec0: 616c 697a 6564 2063 6c61 7373 7265 660a  alized classref.
-00016ed0: 2020 2020 2020 2020 4d61 7920 6265 6e65          May bene
-00016ee0: 6669 7420 6672 6f6d 2062 6569 6e67 2069  fit from being i
-00016ef0: 6e20 6120 636c 6173 730a 2020 2020 2020  n a class.      
-00016f00: 2020 2222 220a 2020 2020 2020 2020 636c    """.        cl
-00016f10: 6173 7372 6566 5f69 6e64 6578 203d 2064  assref_index = d
-00016f20: 6963 7428 290a 2020 2020 2020 2020 666f  ict().        fo
-00016f30: 7220 6974 656d 2069 6e20 7374 796c 655f  r item in style_
-00016f40: 746f 5f63 6c61 7373 7265 665f 7365 742e  to_classref_set.
-00016f50: 6974 656d 7328 293a 0a20 2020 2020 2020  items():.       
-00016f60: 2020 2020 2063 6c61 7373 7265 665f 6c69       classref_li
-00016f70: 7374 203d 206c 6973 7428 736f 7274 6564  st = list(sorted
-00016f80: 2869 7465 6d5b 315d 2929 0a20 2020 2020  (item[1])).     
-00016f90: 2020 2020 2020 2063 6c61 7373 7265 6630         classref0
-00016fa0: 203d 206c 6973 7428 636c 6173 7372 6566   = list(classref
-00016fb0: 5f6c 6973 7429 5b30 5d0a 2020 2020 2020  _list)[0].      
-00016fc0: 2020 2020 2020 666f 7220 636c 6173 7372        for classr
-00016fd0: 6566 2069 6e20 636c 6173 7372 6566 5f6c  ef in classref_l
-00016fe0: 6973 743a 0a20 2020 2020 2020 2020 2020  ist:.           
-00016ff0: 2020 2020 2063 6c61 7373 7265 665f 696e       classref_in
-00017000: 6465 785b 636c 6173 7372 6566 5d20 3d20  dex[classref] = 
-00017010: 636c 6173 7372 6566 300a 2020 2020 2020  classref0.      
-00017020: 2020 7265 7475 726e 2063 6c61 7373 7265    return classre
-00017030: 665f 696e 6465 780a 0a20 2020 2023 2063  f_index..    # c
-00017040: 6c61 7373 2048 746d 6c53 7479 6c65 0a0a  lass HtmlStyle..
-00017050: 2020 2020 4063 6c61 7373 6d65 7468 6f64      @classmethod
-00017060: 0a20 2020 2064 6566 2061 6464 5f68 6561  .    def add_hea
-00017070: 645f 7374 796c 6573 5f6f 7269 6728 636c  d_styles_orig(cl
-00017080: 732c 2068 746d 6c5f 656c 656d 2c20 7374  s, html_elem, st
-00017090: 796c 6573 2c20 6e6f 726d 616c 697a 655f  yles, normalize_
-000170a0: 666f 6e74 3d54 7275 6529 3a0a 2020 2020  font=True):.    
-000170b0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-000170c0: 7468 6973 2069 7320 6372 7564 650a 2020  this is crude.  
-000170d0: 2020 2020 2020 2773 7479 6c65 206f 6620        'style of 
-000170e0: 666f 726d 0a20 2020 2020 2020 2020 2020  form.           
-000170f0: 2022 6469 7622 2c20 5b28 2262 6f72 6465   "div", [("borde
-00017100: 7222 2c20 2272 6564 2073 6f6c 6964 2030  r", "red solid 0
-00017110: 2e35 7078 2229 2c20 2822 6261 636b 6772  .5px"), ("backgr
-00017120: 6f75 6e64 222c 2022 7965 6c6c 6f77 295d  ound", "yellow)]
-00017130: 290a 2020 2020 2020 2020 2222 220a 2020  ).        """.  
-00017140: 2020 2020 2020 666f 7220 7374 796c 6520        for style 
-00017150: 696e 2073 7479 6c65 733a 0a20 2020 2020  in styles:.     
-00017160: 2020 2020 2020 2023 2070 7269 6e74 2866         # print(f
-00017170: 2273 7479 6c65 207b 7374 796c 657d 2229  "style {style}")
-00017180: 0a20 2020 2020 2020 2020 2020 2048 746d  .            Htm
-00017190: 6c4c 6962 2e61 6464 5f68 6561 645f 7374  lLib.add_head_st
-000171a0: 796c 6528 6874 6d6c 5f65 6c65 6d2c 2073  yle(html_elem, s
-000171b0: 7479 6c65 5b30 5d2c 2073 7479 6c65 5b31  tyle[0], style[1
-000171c0: 5d29 0a0a 2020 2020 4063 6c61 7373 6d65  ])..    @classme
-000171d0: 7468 6f64 0a20 2020 2064 6566 2061 6464  thod.    def add
-000171e0: 5f68 6561 645f 7374 796c 6573 2863 6c73  _head_styles(cls
-000171f0: 2c20 6874 6d6c 5f65 6c65 6d2c 2073 7479  , html_elem, sty
-00017200: 6c65 5f74 6578 7473 2c20 6e6f 726d 616c  le_texts, normal
-00017210: 697a 655f 666f 6e74 3d54 7275 6529 3a0a  ize_font=True):.
-00017220: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00017230: 2020 2020 6164 6473 2074 6578 7420 6f66      adds text of
-00017240: 2066 6f72 6d0a 2020 2020 2020 2020 6c6f   form.        lo
-00017250: 6361 746f 7220 6373 730a 2020 2020 2020  cator css.      
-00017260: 2020 652e 672e 2073 7061 6e2e 7465 6d70    e.g. span.temp
-00017270: 207b 6261 636b 6772 6f75 6e64 3a20 7265   {background: re
-00017280: 643b 2066 6f6e 742d 7369 7a65 3a20 3132  d; font-size: 12
-00017290: 7078 3b7d 0a20 2020 2020 2020 2022 2222  px;}.        """
-000172a0: 0a20 2020 2020 2020 2068 746d 6c5f 6865  .        html_he
-000172b0: 6164 203d 2048 746d 6c4c 6962 2e67 6574  ad = HtmlLib.get
-000172c0: 5f68 6561 6428 6874 6d6c 5f65 6c65 6d29  _head(html_elem)
-000172d0: 0a20 2020 2020 2020 2066 6f72 2073 7479  .        for sty
-000172e0: 6c65 5f74 2069 6e20 7374 796c 655f 7465  le_t in style_te
-000172f0: 7874 733a 0a20 2020 2020 2020 2020 2020  xts:.           
-00017300: 2073 7479 6c65 203d 2045 542e 5375 6245   style = ET.SubE
-00017310: 6c65 6d65 6e74 2868 746d 6c5f 6865 6164  lement(html_head
-00017320: 2c20 2273 7479 6c65 2229 0a20 2020 2020  , "style").     
-00017330: 2020 2020 2020 2073 7479 6c65 2e74 6578         style.tex
-00017340: 7420 3d20 7374 796c 655f 740a 0a23 2054  t = style_t..# T
-00017350: 4f44 4f0a 2320 6372 6561 7465 5f66 6f6e  ODO.# create_fon
-00017360: 745f 6564 6974 6564 5f73 7479 6c65 5f66  t_edited_style_f
-00017370: 726f 6d5f 6373 735f 7374 796c 655f 6f62  rom_css_style_ob
-00017380: 6a65 6374 0a0a 2020 2020 4063 6c61 7373  ject..    @class
-00017390: 6d65 7468 6f64 0a20 2020 2064 6566 2074  method.    def t
-000173a0: 7261 6e73 6665 725f 6865 6164 5f73 7479  ransfer_head_sty
-000173b0: 6c65 7328 636c 732c 2068 746d 6c5f 656c  les(cls, html_el
-000173c0: 656d 2c20 6e65 775f 6874 6d6c 293a 0a20  em, new_html):. 
-000173d0: 2020 2020 2020 2022 2222 636f 7069 6573         """copies
-000173e0: 2068 746d 6c2f 6865 6164 2f22 2222 0a20   html/head/""". 
-000173f0: 2020 2020 2020 206e 6577 5f73 7479 6c65         new_style
-00017400: 5f65 6c65 6d20 3d20 4874 6d6c 4772 6f75  _elem = HtmlGrou
-00017410: 702e 6372 6561 7465 5f68 6561 645f 7374  p.create_head_st
-00017420: 796c 655f 656c 656d 286e 6577 5f68 746d  yle_elem(new_htm
-00017430: 6c2c 2074 6169 6c3d 225c 6e22 290a 2020  l, tail="\n").  
-00017440: 2020 2020 2020 7374 796c 6573 203d 2048        styles = H
-00017450: 746d 6c53 7479 6c65 2e67 6574 5f68 6561  tmlStyle.get_hea
-00017460: 645f 7374 796c 6573 2868 746d 6c5f 656c  d_styles(html_el
-00017470: 656d 290a 2020 2020 2020 2020 666f 7220  em).        for 
-00017480: 7374 796c 6520 696e 2073 7479 6c65 733a  style in styles:
-00017490: 0a20 2020 2020 2020 2020 2020 206e 6577  .            new
-000174a0: 5f73 7479 6c65 5f65 6c65 6d2e 6765 7470  _style_elem.getp
-000174b0: 6172 656e 7428 292e 6170 7065 6e64 2863  arent().append(c
-000174c0: 6f70 792e 6465 6570 636f 7079 2873 7479  opy.deepcopy(sty
-000174d0: 6c65 2929 0a0a 2020 2020 4063 6c61 7373  le))..    @class
-000174e0: 6d65 7468 6f64 0a20 2020 2064 6566 2065  method.    def e
-000174f0: 7874 7261 6374 5f63 6c61 7373 7265 665f  xtract_classref_
-00017500: 616e 645f 6373 7373 7472 696e 675f 6672  and_cssstring_fr
-00017510: 6f6d 5f68 746d 6c5f 7374 796c 6528 636c  om_html_style(cl
-00017520: 732c 2068 746d 6c5f 7374 796c 655f 656c  s, html_style_el
-00017530: 656d 293a 0a20 2020 2020 2020 2069 6620  em):.        if 
-00017540: 6874 6d6c 5f73 7479 6c65 5f65 6c65 6d20  html_style_elem 
-00017550: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-00017560: 2020 2020 2072 6574 7572 6e20 4e6f 6e65       return None
-00017570: 2c20 4e6f 6e65 0a20 2020 2020 2020 2072  , None.        r
-00017580: 6574 7572 6e20 636c 732e 6578 7472 6163  eturn cls.extrac
-00017590: 745f 636c 6173 7372 6566 5f61 6e64 5f63  t_classref_and_c
-000175a0: 7373 7374 7269 6e67 5f66 726f 6d5f 7374  ssstring_from_st
-000175b0: 796c 655f 7465 7874 2868 746d 6c5f 7374  yle_text(html_st
-000175c0: 796c 655f 656c 656d 2e74 6578 7429 0a0a  yle_elem.text)..
-000175d0: 2020 2020 4063 6c61 7373 6d65 7468 6f64      @classmethod
-000175e0: 0a20 2020 2064 6566 2063 7265 6174 655f  .    def create_
-000175f0: 636c 6173 7372 6566 5f63 7373 7374 7269  classref_cssstri
-00017600: 6e67 5f74 6162 6c65 2863 6c73 2c20 6874  ng_table(cls, ht
-00017610: 6d6c 5f73 7479 6c65 7329 3a0a 2020 2020  ml_styles):.    
-00017620: 2020 2020 7461 626c 6520 3d20 5b5d 0a20      table = []. 
-00017630: 2020 2020 2020 2066 6f72 2068 746d 6c5f         for html_
-00017640: 7374 796c 6520 696e 2068 746d 6c5f 7374  style in html_st
-00017650: 796c 6573 3a0a 2020 2020 2020 2020 2020  yles:.          
-00017660: 2020 7461 626c 652e 6170 7065 6e64 2848    table.append(H
-00017670: 746d 6c53 7479 6c65 2e65 7874 7261 6374  tmlStyle.extract
-00017680: 5f63 6c61 7373 7265 665f 616e 645f 6373  _classref_and_cs
-00017690: 7373 7472 696e 675f 6672 6f6d 5f68 746d  sstring_from_htm
-000176a0: 6c5f 7374 796c 6528 6874 6d6c 5f73 7479  l_style(html_sty
-000176b0: 6c65 2929 0a20 2020 2020 2020 2072 6574  le)).        ret
-000176c0: 7572 6e20 7461 626c 650a 0a20 2020 2040  urn table..    @
-000176d0: 636c 6173 736d 6574 686f 640a 2020 2020  classmethod.    
-000176e0: 6465 6620 7265 706c 6163 655f 6375 726c  def replace_curl
-000176f0: 7928 636c 732c 2065 6c65 6d2c 206e 6577  y(cls, elem, new
-00017700: 5f63 7572 6c79 293a 0a20 2020 2020 2020  _curly):.       
-00017710: 2022 2222 0a20 2020 2020 2020 2072 6570   """.        rep
-00017720: 6c61 6365 2063 6f6e 7465 6e74 7320 6f66  lace contents of
-00017730: 207b 2e2e 2e7d 0a20 2020 2020 2020 203a   {...}.        :
-00017740: 7061 7261 6d20 656c 656d 3a20 6874 6d6c  param elem: html
-00017750: 203c 7374 796c 653e 2065 6c65 6d65 6e74   <style> element
-00017760: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-00017770: 656c 656d 3a20 6e65 7720 636f 6e74 656e  elem: new conten
-00017780: 740a 2020 2020 2020 2020 2222 220a 0a20  t.        """.. 
-00017790: 2020 2020 2020 2069 6620 656c 656d 2069         if elem i
-000177a0: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-000177b0: 2020 2020 2020 2020 6d61 7463 6820 3d20          match = 
-000177c0: 5354 594c 455f 4355 524c 595f 5245 2e6d  STYLE_CURLY_RE.m
-000177d0: 6174 6368 2865 6c65 6d2e 7465 7874 290a  atch(elem.text).
-000177e0: 2020 2020 2020 2020 2020 2020 6966 206d              if m
-000177f0: 6174 6368 3a0a 2020 2020 2020 2020 2020  atch:.          
-00017800: 2020 2020 2020 6e65 775f 7465 7874 203d        new_text =
-00017810: 206d 6174 6368 2e67 726f 7570 2822 7072   match.group("pr
-00017820: 6522 2920 2b20 6e65 775f 6375 726c 7920  e") + new_curly 
-00017830: 2b20 6d61 7463 682e 6772 6f75 7028 2270  + match.group("p
-00017840: 6f73 7422 290a 2020 2020 2020 2020 2020  ost").          
-00017850: 2020 2020 2020 656c 656d 2e74 6578 7420        elem.text 
-00017860: 3d20 6e65 775f 7465 7874 0a0a 2020 2020  = new_text..    
-00017870: 4063 6c61 7373 6d65 7468 6f64 0a20 2020  @classmethod.   
-00017880: 2064 6566 206c 6f6f 6b75 705f 6865 6164   def lookup_head
-00017890: 5f73 7479 6c65 5f62 795f 636c 6173 7372  _style_by_classr
-000178a0: 6566 2863 6c73 2c20 656c 656d 293a 0a20  ef(cls, elem):. 
-000178b0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-000178c0: 2020 203a 7061 7261 6d20 656c 656d 3a20     :param elem: 
-000178d0: 656c 656d 656e 7473 2077 6974 6820 4063  elements with @c
-000178e0: 6c61 7373 2061 7474 7269 6275 7465 0a20  lass attribute. 
-000178f0: 2020 2020 2020 203a 7265 7475 726e 3a20         :return: 
-00017900: 4353 5353 7479 6c65 206f 626a 6563 7420  CSSStyle object 
-00017910: 7769 7468 2048 746d 6c53 7479 6c65 0a20  with HtmlStyle. 
-00017920: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00017930: 2020 2063 6c61 7a7a 203d 2065 6c65 6d2e     clazz = elem.
-00017940: 6765 7428 2263 6c61 7373 2229 0a20 2020  get("class").   
-00017950: 2020 2020 2063 7373 5f73 7479 6c65 203d       css_style =
-00017960: 2048 746d 6c53 7479 6c65 2e6c 6f6f 6b75   HtmlStyle.looku
-00017970: 705f 6865 6164 5f73 7479 6c65 5f62 795f  p_head_style_by_
-00017980: 636c 6173 7328 656c 656d 2c20 636c 617a  class(elem, claz
-00017990: 7a29 0a20 2020 2020 2020 2072 6574 7572  z).        retur
-000179a0: 6e20 6373 735f 7374 796c 650a 0a20 2020  n css_style..   
-000179b0: 2040 636c 6173 736d 6574 686f 640a 2020   @classmethod.  
-000179c0: 2020 6465 6620 6c6f 6f6b 7570 5f68 6561    def lookup_hea
-000179d0: 645f 7374 796c 655f 6279 5f63 6c61 7373  d_style_by_class
-000179e0: 2863 6c73 2c20 6874 6d6c 2c20 636c 617a  (cls, html, claz
-000179f0: 7a29 3a0a 2020 2020 2020 2020 2222 220a  z):.        """.
-00017a00: 2020 2020 2020 2020 3a70 6172 616d 2068          :param h
-00017a10: 746d 6c3a 2048 544d 4c20 656c 656d 656e  tml: HTML elemen
-00017a20: 7420 7769 7468 2068 6561 642f 7374 796c  t with head/styl
-00017a30: 650a 2020 2020 2020 2020 3a70 6172 616d  e.        :param
-00017a40: 2063 6c61 7a7a 3a20 636c 6173 7320 746f   clazz: class to
-00017a50: 2072 6574 6972 7665 2073 7479 6c65 2065   retirve style e
-00017a60: 6c65 6d65 6e74 0a20 2020 2020 2020 2022  lement.        "
-00017a70: 2222 0a20 2020 2020 2020 2073 7479 6c65  "".        style
-00017a80: 7320 3d20 6874 6d6c 2e78 7061 7468 2866  s = html.xpath(f
-00017a90: 222f 6874 6d6c 2f68 6561 642f 7374 796c  "/html/head/styl
-00017aa0: 655b 636f 6e74 6169 6e73 282e 2c27 2e7b  e[contains(.,'.{
-00017ab0: 636c 617a 7a7d 2027 295d 2229 0a20 2020  clazz} ')]").   
-00017ac0: 2020 2020 2069 6620 6c65 6e28 7374 796c       if len(styl
-00017ad0: 6573 2920 3d3d 2030 3a0a 2020 2020 2020  es) == 0:.      
-00017ae0: 2020 2020 2020 7072 696e 7428 6622 6e6f        print(f"no
-00017af0: 2073 7479 6c65 7320 666f 7220 7b63 6c61   styles for {cla
-00017b00: 7a7a 7d22 290a 2020 2020 2020 2020 2020  zz}").          
-00017b10: 2020 7265 7475 726e 204e 6f6e 650a 2020    return None.  
-00017b20: 2020 2020 2020 6865 6164 5f73 7479 6c65        head_style
-00017b30: 203d 2073 7479 6c65 735b 305d 0a20 2020   = styles[0].   
-00017b40: 2020 2020 205f 2c20 6373 735f 7374 796c       _, css_styl
-00017b50: 6520 3d20 4353 5353 7479 6c65 2e63 7265  e = CSSStyle.cre
-00017b60: 6174 655f 6373 735f 7374 796c 655f 6672  ate_css_style_fr
-00017b70: 6f6d 5f68 746d 6c5f 6865 6164 5f73 7479  om_html_head_sty
-00017b80: 6c65 5f65 6c65 6d28 6865 6164 5f73 7479  le_elem(head_sty
-00017b90: 6c65 290a 2020 2020 2020 2020 7265 7475  le).        retu
-00017ba0: 726e 2063 7373 5f73 7479 6c65 0a0a 2020  rn css_style..  
-00017bb0: 2020 4063 6c61 7373 6d65 7468 6f64 0a20    @classmethod. 
-00017bc0: 2020 2064 6566 2069 735f 626f 6c64 2863     def is_bold(c
-00017bd0: 6c73 2c20 656c 656d 293a 0a20 2020 2020  ls, elem):.     
-00017be0: 2020 2022 2222 0a20 2020 2020 2020 2066     """.        f
-00017bf0: 696e 6473 2040 636c 6173 7320 696e 2065  inds @class in e
-00017c00: 6c65 6d20 616e 6420 6c6f 6f6b 7320 7570  lem and looks up
-00017c10: 2073 7479 6c65 2069 6e20 6874 6d6c 2f68   style in html/h
-00017c20: 6561 640a 2020 2020 2020 2020 2222 220a  ead.        """.
-00017c30: 2020 2020 2020 2020 6966 2065 6c65 6d20          if elem 
-00017c40: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-00017c50: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
-00017c60: 650a 2020 2020 2020 2020 6373 735f 7374  e.        css_st
-00017c70: 796c 6520 3d20 4874 6d6c 5374 796c 652e  yle = HtmlStyle.
-00017c80: 6c6f 6f6b 7570 5f68 6561 645f 7374 796c  lookup_head_styl
-00017c90: 655f 6279 5f63 6c61 7373 7265 6628 656c  e_by_classref(el
-00017ca0: 656d 290a 2020 2020 2020 2020 6966 206e  em).        if n
-00017cb0: 6f74 2063 7373 5f73 7479 6c65 3a0a 2020  ot css_style:.  
-00017cc0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-00017cd0: 6622 6e6f 2073 7479 6c65 2072 6573 6f6c  f"no style resol
-00017ce0: 7665 6420 666f 7220 7b45 542e 746f 7374  ved for {ET.tost
-00017cf0: 7269 6e67 2865 6c65 6d29 7d22 290a 2020  ring(elem)}").  
-00017d00: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00017d10: 2046 616c 7365 0a20 2020 2020 2020 2072   False.        r
-00017d20: 6574 7572 6e20 6373 735f 7374 796c 652e  eturn css_style.
-00017d30: 6973 5f62 6f6c 640a 0a20 2020 2040 636c  is_bold..    @cl
-00017d40: 6173 736d 6574 686f 640a 2020 2020 6465  assmethod.    de
-00017d50: 6620 6973 5f69 7461 6c69 6328 636c 732c  f is_italic(cls,
-00017d60: 2065 6c65 6d29 3a0a 2020 2020 2020 2020   elem):.        
-00017d70: 2222 220a 2020 2020 2020 2020 6669 6e64  """.        find
-00017d80: 7320 4063 6c61 7373 2069 6e20 656c 656d  s @class in elem
-00017d90: 2061 6e64 206c 6f6f 6b73 2075 7020 7374   and looks up st
-00017da0: 796c 6520 696e 2068 746d 6c2f 6865 6164  yle in html/head
-00017db0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00017dc0: 2020 2020 2069 6620 656c 656d 2069 7320       if elem is 
-00017dd0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00017de0: 2020 7265 7475 726e 2046 616c 7365 0a20    return False. 
-00017df0: 2020 2020 2020 2063 7373 5f73 7479 6c65         css_style
-00017e00: 203d 2048 746d 6c53 7479 6c65 2e6c 6f6f   = HtmlStyle.loo
-00017e10: 6b75 705f 6865 6164 5f73 7479 6c65 5f62  kup_head_style_b
-00017e20: 795f 636c 6173 7372 6566 2865 6c65 6d29  y_classref(elem)
-00017e30: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-00017e40: 6373 735f 7374 796c 653a 0a20 2020 2020  css_style:.     
-00017e50: 2020 2020 2020 2070 7269 6e74 2866 226e         print(f"n
-00017e60: 6f20 7374 796c 6520 7265 736f 6c76 6564  o style resolved
-00017e70: 2066 6f72 207b 4554 2e74 6f73 7472 696e   for {ET.tostrin
-00017e80: 6728 656c 656d 297d 2229 0a20 2020 2020  g(elem)}").     
-00017e90: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
-00017ea0: 6c73 650a 2020 2020 2020 2020 7265 7475  lse.        retu
-00017eb0: 726e 2063 7373 5f73 7479 6c65 2e69 735f  rn css_style.is_
-00017ec0: 6974 616c 6963 0a0a 2020 2020 4063 6c61  italic..    @cla
-00017ed0: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
-00017ee0: 2067 6574 5f62 6f64 795f 636c 6173 7372   get_body_classr
-00017ef0: 6566 7328 636c 732c 2068 746d 6c5f 656c  efs(cls, html_el
-00017f00: 656d 293a 0a20 2020 2020 2020 2022 2222  em):.        """
-00017f10: 7365 6172 6368 6573 2061 6c6c 2062 6f64  searches all bod
-00017f20: 7920 656c 656d 656e 7473 2066 6f72 2040  y elements for @
-00017f30: 636c 6173 7320 6174 7472 6962 7574 6573  class attributes
-00017f40: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-00017f50: 6874 6d6c 5f65 6c65 6d3a 2068 746d 6c20  html_elem: html 
-00017f60: 656c 656d 656e 740a 2020 2020 2020 2020  element.        
-00017f70: 3a72 6574 7572 6e3a 2061 6c6c 2062 6f64  :return: all bod
-00017f80: 7920 656c 656d 656e 7473 2077 6974 6820  y elements with 
-00017f90: 4063 6c61 7373 2061 7474 7269 6275 7465  @class attribute
-00017fa0: 730a 2020 2020 2020 2020 2222 220a 2020  s.        """.  
-00017fb0: 2020 2020 2020 626f 6479 203d 2048 746d        body = Htm
-00017fc0: 6c4c 6962 2e67 6574 5f62 6f64 7928 6874  lLib.get_body(ht
-00017fd0: 6d6c 5f65 6c65 6d29 0a20 2020 2020 2020  ml_elem).       
-00017fe0: 2072 6574 7572 6e20 5b5d 2069 6620 626f   return [] if bo
-00017ff0: 6479 2069 7320 4e6f 6e65 2065 6c73 6520  dy is None else 
-00018000: 626f 6479 2e78 7061 7468 2822 2e2f 2f2a  body.xpath(".//*
-00018010: 5b40 636c 6173 735d 2229 0a0a 2020 2020  [@class]")..    
-00018020: 4063 6c61 7373 6d65 7468 6f64 0a20 2020  @classmethod.   
-00018030: 2064 6566 2063 7265 6174 655f 6162 6272   def create_abbr
-00018040: 6576 6961 7465 645f 666f 6e74 5f73 7479  eviated_font_sty
-00018050: 6c65 7328 636c 732c 2068 746d 6c5f 656c  les(cls, html_el
-00018060: 656d 293a 0a20 2020 2020 2020 2022 2222  em):.        """
-00018070: 6372 6561 7465 7320 7265 6164 6162 6c65  creates readable
-00018080: 2073 7479 6c65 6e61 6d65 730a 2020 2020   stylenames.    
-00018090: 2020 2020 2e73 3020 7b66 6f6e 742d 6661      .s0 {font-fa
-000180a0: 6d69 6c79 3a20 5469 6d65 734e 6577 526f  mily: TimesNewRo
-000180b0: 6d61 6e50 534d 543b 2066 6f6e 742d 7369  manPSMT; font-si
-000180c0: 7a65 3a20 3132 2e30 3b20 666f 6e74 2d77  ze: 12.0; font-w
-000180d0: 6569 6768 743a 2062 6f6c 643b 2066 6f6e  eight: bold; fon
-000180e0: 742d 6e61 6d65 3a20 5469 6d65 734e 6577  t-name: TimesNew
-000180f0: 526f 6d61 6e50 534d 543b 0a20 2020 2020  RomanPSMT;.     
-00018100: 2020 2069 7320 7472 616e 7366 6f72 6d65     is transforme
-00018110: 6420 746f 0a20 2020 2020 2020 202e 7469  d to.        .ti
-00018120: 6d65 736e 6577 726f 6d61 6e70 736d 745f  mesnewromanpsmt_
-00018130: 3132 7e30 5f62 6f6c 640a 2020 2020 2020  12~0_bold.      
-00018140: 2020 2222 220a 2020 2020 2020 2020 7374    """.        st
-00018150: 796c 655f 636f 6e76 6572 7465 7220 3d20  yle_converter = 
-00018160: 636c 732e 6372 6561 7465 5f73 7479 6c65  cls.create_style
-00018170: 5f63 6f6e 7665 7274 6572 2868 746d 6c5f  _converter(html_
-00018180: 656c 656d 290a 2020 2020 2020 2020 7374  elem).        st
-00018190: 796c 6564 5f65 6c65 6d73 203d 2068 746d  yled_elems = htm
-000181a0: 6c5f 656c 656d 2e78 7061 7468 2822 2e2f  l_elem.xpath("./
-000181b0: 2f2a 5b40 636c 6173 735d 2229 0a20 2020  /*[@class]").   
-000181c0: 2020 2020 2066 6f72 2065 6c65 6d20 696e       for elem in
-000181d0: 2073 7479 6c65 645f 656c 656d 733a 0a20   styled_elems:. 
-000181e0: 2020 2020 2020 2020 2020 2063 6c61 7a7a             clazz
-000181f0: 203d 2065 6c65 6d2e 6174 7472 6962 5b22   = elem.attrib["
-00018200: 636c 6173 7322 5d0a 2020 2020 2020 2020  class"].        
-00018210: 2020 2020 6e65 775f 636c 6173 7320 3d20      new_class = 
-00018220: 7374 796c 655f 636f 6e76 6572 7465 722e  style_converter.
-00018230: 6765 7428 636c 617a 7a29 0a20 2020 2020  get(clazz).     
-00018240: 2020 2020 2020 2069 6620 6e65 775f 636c         if new_cl
-00018250: 6173 7320 6973 204e 6f6e 653a 0a20 2020  ass is None:.   
-00018260: 2020 2020 2020 2020 2020 2020 2070 7269               pri
-00018270: 6e74 2866 2263 616e 6e6f 7420 6669 6e64  nt(f"cannot find
-00018280: 2072 6570 6c61 6365 2066 6f72 207b 636c   replace for {cl
-00018290: 617a 7a7d 2229 0a20 2020 2020 2020 2020  azz}").         
-000182a0: 2020 2020 2020 2063 6f6e 7469 6e75 650a         continue.
-000182b0: 2020 2020 2020 2020 2020 2020 6874 6d6c              html
-000182c0: 5f63 6c61 7373 203d 2048 746d 6c43 6c61  _class = HtmlCla
-000182d0: 7373 2863 6c61 7a7a 290a 2020 2020 2020  ss(clazz).      
-000182e0: 2020 2020 2020 6874 6d6c 5f63 6c61 7373        html_class
-000182f0: 2e72 6570 6c61 6365 5f63 6c61 7373 2863  .replace_class(c
-00018300: 6c61 7a7a 2c20 6e65 775f 636c 6173 7329  lazz, new_class)
-00018310: 0a20 2020 2020 2020 2020 2020 2065 6c65  .            ele
-00018320: 6d2e 6174 7472 6962 5b22 636c 6173 7322  m.attrib["class"
-00018330: 5d20 3d20 6e65 775f 636c 6173 730a 2020  ] = new_class.  
-00018340: 2020 2020 2020 2020 2020 2320 7072 696e            # prin
-00018350: 7428 6622 7265 706c 6163 6564 207b 636c  t(f"replaced {cl
-00018360: 617a 7a7d 2062 7920 7b6e 6577 5f63 6c61  azz} by {new_cla
-00018370: 7373 7d22 290a 0a20 2020 2040 636c 6173  ss}")..    @clas
-00018380: 736d 6574 686f 640a 2020 2020 6465 6620  smethod.    def 
-00018390: 6372 6561 7465 5f73 7479 6c65 5f63 6f6e  create_style_con
-000183a0: 7665 7274 6572 2863 6c73 2c20 6874 6d6c  verter(cls, html
-000183b0: 5f65 6c65 6d29 3a0a 2020 2020 2020 2020  _elem):.        
-000183c0: 7374 796c 6573 203d 2048 746d 6c53 7479  styles = HtmlSty
-000183d0: 6c65 2e67 6574 5f68 6561 645f 7374 796c  le.get_head_styl
-000183e0: 6573 2868 746d 6c5f 656c 656d 290a 2020  es(html_elem).  
-000183f0: 2020 2020 2020 7374 796c 655f 636f 6e76        style_conv
-00018400: 6572 7465 7220 3d20 6469 6374 2829 0a20  erter = dict(). 
-00018410: 2020 2020 2020 2066 6f72 2073 7479 6c65         for style
-00018420: 2069 6e20 7374 796c 6573 3a0a 2020 2020   in styles:.    
-00018430: 2020 2020 2020 2020 646f 745f 7374 796c          dot_styl
-00018440: 652c 2063 7373 203d 2048 746d 6c53 7479  e, css = HtmlSty
-00018450: 6c65 2e65 7874 7261 6374 5f63 6c61 7373  le.extract_class
-00018460: 7265 665f 616e 645f 6373 7373 7472 696e  ref_and_cssstrin
-00018470: 675f 6672 6f6d 5f68 746d 6c5f 7374 796c  g_from_html_styl
-00018480: 6528 7374 796c 6529 0a20 2020 2020 2020  e(style).       
-00018490: 2020 2020 2023 2070 7269 6e74 2866 227b       # print(f"{
-000184a0: 646f 745f 7374 796c 657d 207b 6373 737d  dot_style} {css}
-000184b0: 2229 0a20 2020 2020 2020 2020 2020 2063  ").            c
-000184c0: 7373 5f73 7479 6c65 203d 2043 5353 5374  ss_style = CSSSt
-000184d0: 796c 652e 6372 6561 7465 5f63 7373 5f73  yle.create_css_s
-000184e0: 7479 6c65 5f66 726f 6d5f 6373 735f 7374  tyle_from_css_st
-000184f0: 7269 6e67 2863 7373 290a 2020 2020 2020  ring(css).      
-00018500: 2020 2020 2020 2320 7072 696e 7428 0a20        # print(. 
-00018510: 2020 2020 2020 2020 2020 2023 2020 2020             #    
-00018520: 2066 2266 6f6e 743a 207b 6373 735f 7374   f"font: {css_st
-00018530: 796c 652e 666f 6e74 5f66 616d 696c 797d  yle.font_family}
-00018540: 2073 697a 6520 7b63 7373 5f73 7479 6c65   size {css_style
-00018550: 2e66 6f6e 745f 7369 7a65 7d20 626f 6c64  .font_size} bold
-00018560: 207b 6373 735f 7374 796c 652e 6973 5f62   {css_style.is_b
-00018570: 6f6c 647d 2069 7461 6c69 6320 7b63 7373  old} italic {css
-00018580: 5f73 7479 6c65 2e69 735f 6974 616c 6963  _style.is_italic
-00018590: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
-000185a0: 635f 7374 796c 6520 3d20 2222 0a20 2020  c_style = "".   
-000185b0: 2020 2020 2020 2020 2069 6620 6373 735f           if css_
-000185c0: 7374 796c 652e 666f 6e74 5f66 616d 696c  style.font_famil
-000185d0: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
-000185e0: 2020 2063 5f73 7479 6c65 202b 3d20 6373     c_style += cs
-000185f0: 735f 7374 796c 652e 666f 6e74 5f66 616d  s_style.font_fam
-00018600: 696c 792e 6c6f 7765 7228 290a 2020 2020  ily.lower().    
-00018610: 2020 2020 2020 2020 6966 2063 7373 5f73          if css_s
-00018620: 7479 6c65 2e66 6f6e 745f 7369 7a65 3a0a  tyle.font_size:.
-00018630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018640: 635f 7374 796c 6520 2b3d 2022 5f22 202b  c_style += "_" +
-00018650: 2073 7472 2863 7373 5f73 7479 6c65 2e66   str(css_style.f
-00018660: 6f6e 745f 7369 7a65 292e 7265 706c 6163  ont_size).replac
-00018670: 6528 222e 222c 2022 5f22 290a 2020 2020  e(".", "_").    
-00018680: 2020 2020 2020 2020 6966 2063 7373 5f73          if css_s
-00018690: 7479 6c65 2e69 735f 626f 6c64 3a0a 2020  tyle.is_bold:.  
-000186a0: 2020 2020 2020 2020 2020 2020 2020 635f                c_
-000186b0: 7374 796c 6520 2b3d 2022 5f22 202b 2022  style += "_" + "
-000186c0: 6222 0a20 2020 2020 2020 2020 2020 2069  b".            i
-000186d0: 6620 6373 735f 7374 796c 652e 6973 5f69  f css_style.is_i
-000186e0: 7461 6c69 633a 0a20 2020 2020 2020 2020  talic:.         
-000186f0: 2020 2020 2020 2063 5f73 7479 6c65 202b         c_style +
-00018700: 3d20 225f 2220 2b20 2269 220a 2020 2020  = "_" + "i".    
-00018710: 2020 2020 2020 2020 6966 2063 5f73 7479          if c_sty
-00018720: 6c65 2e73 7461 7274 7377 6974 6828 225f  le.startswith("_
-00018730: 2229 3a0a 2020 2020 2020 2020 2020 2020  "):.            
-00018740: 2020 2020 635f 7374 796c 6520 3d20 635f      c_style = c_
-00018750: 7374 796c 655b 313a 5d0a 2020 2020 2020  style[1:].      
-00018760: 2020 2020 2020 2320 7072 696e 7428 6622        # print(f"
-00018770: 635f 7374 796c 6520 7b63 5f73 7479 6c65  c_style {c_style
-00018780: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
-00018790: 6966 2063 5f73 7479 6c65 2021 3d20 2222  if c_style != ""
-000187a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000187b0: 2020 7374 796c 655f 636f 6e76 6572 7465    style_converte
-000187c0: 725b 646f 745f 7374 796c 655b 313a 5d5d  r[dot_style[1:]]
-000187d0: 203d 2063 5f73 7479 6c65 0a20 2020 2020   = c_style.     
-000187e0: 2020 2020 2020 2020 2020 2063 6c73 2e73             cls.s
-000187f0: 6574 5f63 6c61 7373 7265 665f 616e 645f  et_classref_and_
-00018800: 6373 7328 7374 796c 652c 2063 5f73 7479  css(style, c_sty
-00018810: 6c65 2c20 6373 7329 0a0a 2020 2020 2020  le, css)..      
-00018820: 2020 7265 7475 726e 2073 7479 6c65 5f63    return style_c
-00018830: 6f6e 7665 7274 6572 0a0a 2020 2020 4063  onverter..    @c
-00018840: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
-00018850: 6566 2073 6574 5f63 6c61 7373 7265 665f  ef set_classref_
-00018860: 616e 645f 6373 7328 636c 732c 2073 7479  and_css(cls, sty
-00018870: 6c65 5f65 6c65 6d2c 2063 5f73 7479 6c65  le_elem, c_style
-00018880: 2c20 6373 7329 3a0a 2020 2020 2020 2020  , css):.        
-00018890: 7374 796c 655f 656c 656d 2e61 7474 7269  style_elem.attri
-000188a0: 625b 2263 6c61 7373 7265 6622 5d20 3d20  b["classref"] = 
-000188b0: 222e 2220 2b20 635f 7374 796c 650a 2020  "." + c_style.  
-000188c0: 2020 2020 2020 7374 796c 655f 656c 656d        style_elem
-000188d0: 2e74 6578 7420 3d20 222e 2220 2b20 635f  .text = "." + c_
-000188e0: 7374 796c 6520 2b20 2220 7b22 202b 2063  style + " {" + c
-000188f0: 7373 202b 2022 7d22 0a0a 0a63 6c61 7373  ss + "}"...class
-00018900: 2048 746d 6c43 6c61 7373 3a0a 2020 2020   HtmlClass:.    
-00018910: 2222 220a 2020 2020 6d65 7468 6f64 7320  """.    methods 
-00018920: 746f 2070 726f 6365 7373 2063 6c61 7373  to process class
-00018930: 202a 6174 7472 6962 7574 6573 2a20 6f6e   *attributes* on
-00018940: 2048 544d 4c20 656c 656d 6e74 7320 616e   HTML elemnts an
-00018950: 6420 7379 6e63 2077 6974 6820 7374 796c  d sync with styl
-00018960: 650a 2020 2020 496e 6974 6961 6c6c 7920  e.    Initially 
-00018970: 6d61 696e 6c79 2040 636c 6173 736d 6574  mainly @classmet
-00018980: 686f 6420 6275 7420 6164 6469 6e67 2069  hod but adding i
-00018990: 6e73 7461 6d63 6573 2074 6f20 6d61 6e61  nstamces to mana
-000189a0: 6765 2065 6469 7469 6e67 0a20 2020 2074  ge editing.    t
-000189b0: 6865 2040 636c 6173 7320 6174 7472 6962  he @class attrib
-000189c0: 7574 650a 2020 2020 2222 220a 0a20 2020  ute.    """..   
-000189d0: 2064 6566 205f 5f69 6e69 745f 5f28 7365   def __init__(se
-000189e0: 6c66 2c20 636c 6173 7373 7472 3d4e 6f6e  lf, classstr=Non
-000189f0: 6529 3a0a 0a20 2020 2020 2020 2073 656c  e):..        sel
-00018a00: 662e 636c 6173 7365 7320 3d20 7365 7428  f.classes = set(
-00018a10: 290a 2020 2020 2020 2020 6966 2063 6c61  ).        if cla
-00018a20: 7373 7374 723a 0a20 2020 2020 2020 2020  ssstr:.         
-00018a30: 2020 2069 6620 7479 7065 2863 6c61 7373     if type(class
-00018a40: 7374 7229 2069 7320 7374 723a 0a20 2020  str) is str:.   
-00018a50: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00018a60: 662e 636c 6173 7365 732e 7570 6461 7465  f.classes.update
-00018a70: 2863 6c61 7373 7374 722e 7370 6c69 7428  (classstr.split(
-00018a80: 2929 0a20 2020 2020 2020 2020 2020 2065  )).            e
-00018a90: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00018aa0: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
-00018ab0: 4572 726f 7228 6622 6361 6e20 6f6e 6c79  Error(f"can only
-00018ac0: 2063 7265 6174 6520 4874 6d6c 436c 6173   create HtmlClas
-00018ad0: 7320 6672 6f6d 2073 7472 696e 6773 2c20  s from strings, 
-00018ae0: 666f 756e 6420 7b74 7970 6528 636c 6173  found {type(clas
-00018af0: 7373 7472 297d 203a 207b 636c 6173 7373  sstr)} : {classs
-00018b00: 7472 7d22 290a 0a23 2063 6c61 7373 2048  tr}")..# class H
-00018b10: 746d 6c43 6c61 7373 3a0a 0a20 2020 2040  tmlClass:..    @
-00018b20: 636c 6173 736d 6574 686f 640a 2020 2020  classmethod.    
-00018b30: 6465 6620 6372 6561 7465 5f66 726f 6d5f  def create_from_
-00018b40: 636c 6173 7365 645f 656c 656d 656e 7428  classed_element(
-00018b50: 636c 732c 2065 6c65 6d29 3a0a 2020 2020  cls, elem):.    
-00018b60: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00018b70: 6765 7420 636c 6173 7320 7661 6c75 6520  get class value 
-00018b80: 6672 6f6d 2065 6c65 6d65 6e74 2061 6e64  from element and
-00018b90: 2063 6372 6561 7465 2048 746d 6c43 6c61   ccreate HtmlCla
-00018ba0: 7373 0a20 2020 2020 2020 203a 7061 7261  ss.        :para
-00018bb0: 6d20 656c 656d 3a20 656c 656d 656e 7473  m elem: elements
-00018bc0: 2077 6974 6820 4063 6c61 7373 2061 7474   with @class att
-00018bd0: 7269 6275 7465 0a20 2020 2020 2020 203a  ribute.        :
-00018be0: 7265 7475 726e 3a20 4874 6d6c 436c 6173  return: HtmlClas
-00018bf0: 7320 656c 656d 656e 7420 6f72 204e 6f6e  s element or Non
-00018c00: 650a 2020 2020 2020 2020 2222 220a 2020  e.        """.  
-00018c10: 2020 2020 2020 636c 617a 7a20 3d20 4874        clazz = Ht
-00018c20: 6d6c 436c 6173 732e 6765 745f 636c 6173  mlClass.get_clas
-00018c30: 735f 7374 7269 6e67 5f6f 6e5f 656c 656d  s_string_on_elem
-00018c40: 656e 7428 656c 656d 290a 2020 2020 2020  ent(elem).      
-00018c50: 2020 7265 7475 726e 204e 6f6e 6520 6966    return None if
-00018c60: 206e 6f74 2063 6c61 7a7a 2065 6c73 6520   not clazz else 
-00018c70: 4874 6d6c 436c 6173 7328 636c 617a 7a29  HtmlClass(clazz)
-00018c80: 0a0a 2020 2020 2320 636c 6173 7320 4874  ..    # class Ht
-00018c90: 6d6c 436c 6173 733a 0a0a 2020 2020 4070  mlClass:..    @p
-00018ca0: 726f 7065 7274 790a 2020 2020 6465 6620  roperty.    def 
-00018cb0: 636c 6173 735f 7374 7269 6e67 2873 656c  class_string(sel
-00018cc0: 6629 3a0a 2020 2020 2020 2020 2222 220a  f):.        """.
-00018cd0: 2020 2020 2020 2020 7265 7475 726e 2074          return t
-00018ce0: 6865 2063 6c61 7373 5f73 7472 696e 6720  he class_string 
-00018cf0: 2863 7265 6174 6573 2066 726f 6d20 6c61  (creates from la
-00018d00: 7465 7374 2073 656c 662e 636c 6173 7365  test self.classe
-00018d10: 7329 0a20 2020 2020 2020 203a 7265 7475  s).        :retu
-00018d20: 726e 3a20 7374 7269 6e67 206f 6620 616c  rn: string of al
-00018d30: 7068 6162 6574 6963 6361 6c6c 7920 736f  phabeticcally so
-00018d40: 7274 6564 2073 7065 6365 2d73 6570 6172  rted spece-separ
-00018d50: 6174 6564 2063 6c61 7373 6573 0a20 2020  ated classes.   
-00018d60: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00018d70: 2072 6574 7572 6e20 2222 2069 6620 6e6f   return "" if no
-00018d80: 7420 7365 6c66 2e63 6c61 7373 6573 2065  t self.classes e
-00018d90: 6c73 6520 2220 222e 6a6f 696e 2873 6f72  lse " ".join(sor
-00018da0: 7465 6428 6c69 7374 2873 656c 662e 636c  ted(list(self.cl
-00018db0: 6173 7365 7329 2929 0a0a 2020 2020 6465  asses)))..    de
-00018dc0: 6620 6164 645f 636c 6173 7328 7365 6c66  f add_class(self
-00018dd0: 2c20 636c 617a 7a29 3a0a 2020 2020 2020  , clazz):.      
-00018de0: 2020 2222 220a 2020 2020 2020 2020 6164    """.        ad
-00018df0: 6420 636c 6173 7320 746f 2063 6c61 7373  d class to class
-00018e00: 5f73 7472 696e 670a 2020 2020 2020 2020  _string.        
-00018e10: 3a70 6172 616d 2063 6c61 7a7a 3a20 636c  :param clazz: cl
-00018e20: 6173 7320 746f 2061 6464 2028 6d75 7374  ass to add (must
-00018e30: 2062 6520 6e6f 6e2d 656d 7074 7920 7374   be non-empty st
-00018e40: 7269 6e67 0a20 2020 2020 2020 2069 6620  ring.        if 
-00018e50: 636c 617a 7a20 6973 0a20 2020 2020 2020  clazz is.       
-00018e60: 2022 2222 0a20 2020 2020 2020 2069 6620   """.        if 
-00018e70: 636c 617a 7a20 616e 6420 6c65 6e28 636c  clazz and len(cl
-00018e80: 617a 7a2e 7374 7269 7028 2929 203e 2030  azz.strip()) > 0
-00018e90: 2061 6e64 2063 6c61 7a7a 206e 6f74 2069   and clazz not i
-00018ea0: 6e20 7365 6c66 2e63 6c61 7373 6573 3a0a  n self.classes:.
-00018eb0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00018ec0: 2e63 6c61 7373 6573 2e61 6464 2863 6c61  .classes.add(cla
-00018ed0: 7a7a 2e73 7472 6970 2829 290a 0a20 2020  zz.strip())..   
-00018ee0: 2023 2063 6c61 7373 2048 746d 6c43 6c61   # class HtmlCla
-00018ef0: 7373 3a0a 0a20 2020 2064 6566 2068 6173  ss:..    def has
-00018f00: 5f63 6c61 7373 2873 656c 662c 2063 6c61  _class(self, cla
-00018f10: 7a7a 293a 0a20 2020 2020 2020 2022 2222  zz):.        """
-00018f20: 0a20 2020 2020 2020 2064 6f65 7320 636c  .        does cl
-00018f30: 6173 7320 6578 6973 7420 696e 2063 6c61  ass exist in cla
-00018f40: 7373 6573 0a20 2020 2020 2020 203a 7061  sses.        :pa
-00018f50: 7261 6d20 636c 617a 7a3a 0a20 2020 2020  ram clazz:.     
-00018f60: 2020 2022 2222 0a20 2020 2020 2020 2072     """.        r
-00018f70: 6574 7572 6e20 636c 617a 7a20 696e 2073  eturn clazz in s
-00018f80: 656c 662e 636c 6173 7365 730a 0a20 2020  elf.classes..   
-00018f90: 2023 2063 6c61 7373 2048 746d 6c43 6c61   # class HtmlCla
-00018fa0: 7373 3a0a 0a20 2020 2064 6566 2072 6570  ss:..    def rep
-00018fb0: 6c61 6365 5f63 6c61 7373 2873 656c 662c  lace_class(self,
-00018fc0: 2063 6c61 7a7a 5f6f 6c64 2c20 636c 617a   clazz_old, claz
-00018fd0: 7a3d 4e6f 6e65 293a 0a20 2020 2020 2020  z=None):.       
-00018fe0: 2022 2222 0a20 2020 2020 2020 2072 656d   """.        rem
-00018ff0: 6f76 6520 636c 617a 7a5f 6f6c 6420 3b20  ove clazz_old ; 
-00019000: 6966 2063 6c61 7a7a 2069 7320 6e6f 7420  if clazz is not 
-00019010: 4e6f 6e65 2061 6464 2069 7420 6173 206e  None add it as n
-00019020: 6577 2063 6c61 7373 0a20 2020 2020 2020  ew class.       
-00019030: 2028 6966 2063 6c61 7a7a 2069 7320 616c   (if clazz is al
-00019040: 7265 6164 7920 7072 6573 656e 742c 206e  ready present, n
-00019050: 6f2d 6f70 290a 2020 2020 2020 2020 2222  o-op).        ""
-00019060: 220a 2020 2020 2020 2020 6966 2063 6c61  ".        if cla
-00019070: 7a7a 5f6f 6c64 2069 6e20 7365 6c66 2e63  zz_old in self.c
-00019080: 6c61 7373 6573 3a0a 2020 2020 2020 2020  lasses:.        
-00019090: 2020 2020 7365 6c66 2e72 656d 6f76 6528      self.remove(
-000190a0: 636c 617a 7a5f 6f6c 6429 0a20 2020 2020  clazz_old).     
-000190b0: 2020 2020 2020 2069 6620 636c 617a 7a3a         if clazz:
-000190c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000190d0: 2073 656c 662e 6164 645f 636c 6173 7328   self.add_class(
-000190e0: 636c 617a 7a29 0a0a 2020 2020 2320 636c  clazz)..    # cl
-000190f0: 6173 7320 4874 6d6c 436c 6173 733a 0a0a  ass HtmlClass:..
-00019100: 2020 2020 6465 6620 7265 6d6f 7665 2873      def remove(s
-00019110: 656c 662c 2063 6c61 7a7a 293a 0a20 2020  elf, clazz):.   
-00019120: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00019130: 2072 656d 6f76 6520 636c 6173 7320 6672   remove class fr
-00019140: 6f6d 2073 7472 696e 670a 2020 2020 2020  om string.      
-00019150: 2020 3a70 6172 616d 2063 6c61 7a7a 3a20    :param clazz: 
-00019160: 636c 6173 7320 7374 7269 6e67 2074 6f20  class string to 
-00019170: 7265 6d6f 7665 0a20 2020 2020 2020 2069  remove.        i
-00019180: 6620 206e 6f74 2070 7265 7365 6e74 2c20  f  not present, 
-00019190: 6e6f 2d6f 700a 2020 2020 2020 2020 2222  no-op.        ""
-000191a0: 220a 2020 2020 2020 2020 6966 2063 6c61  ".        if cla
-000191b0: 7a7a 2069 6e20 7365 6c66 2e63 6c61 7373  zz in self.class
-000191c0: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
-000191d0: 7365 6c66 2e63 6c61 7373 6573 2e72 656d  self.classes.rem
-000191e0: 6f76 6528 636c 617a 7a29 0a0a 2020 2020  ove(clazz)..    
-000191f0: 2320 636c 6173 7320 4874 6d6c 436c 6173  # class HtmlClas
-00019200: 733a 0a0a 2020 2020 4063 6c61 7373 6d65  s:..    @classme
-00019210: 7468 6f64 0a20 2020 2064 6566 2067 6574  thod.    def get
-00019220: 5f63 6c61 7373 5f73 7472 696e 675f 6f6e  _class_string_on
-00019230: 5f65 6c65 6d65 6e74 2863 6c73 2c20 656c  _element(cls, el
-00019240: 656d 293a 0a20 2020 2020 2020 2022 2222  em):.        """
-00019250: 0a20 2020 2020 2020 2063 6f6e 7665 6e69  .        conveni
-00019260: 656e 6365 206d 6574 686f 6420 746f 2067  ence method to g
-00019270: 6574 2065 6c65 6d65 6e74 2073 7479 6c65  et element style
-00019280: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-00019290: 656c 656d 3a20 746f 2067 6574 2073 7479  elem: to get sty
-000192a0: 6c65 2066 726f 6d0a 2020 2020 2020 2020  le from.        
-000192b0: 3a72 6574 7572 6e3a 2073 7479 6c65 206f  :return: style o
-000192c0: 7220 4e6f 6e65 0a20 2020 2020 2020 2022  r None.        "
-000192d0: 2222 0a0a 2020 2020 2020 2020 7265 7475  ""..        retu
-000192e0: 726e 2065 6c65 6d2e 6174 7472 6962 2e67  rn elem.attrib.g
-000192f0: 6574 2822 636c 6173 7322 2920 6966 2074  et("class") if t
-00019300: 7970 6528 656c 656d 2920 6973 205f 456c  ype(elem) is _El
-00019310: 656d 656e 7420 656c 7365 204e 6f6e 650a  ement else None.
-00019320: 0a20 2020 2023 2063 6c61 7373 2048 746d  .    # class Htm
-00019330: 6c43 6c61 7373 3a0a 0a20 2020 2040 636c  lClass:..    @cl
-00019340: 6173 736d 6574 686f 640a 2020 2020 6465  assmethod.    de
-00019350: 6620 7365 745f 636c 6173 735f 6f6e 5f65  f set_class_on_e
-00019360: 6c65 6d65 6e74 2863 6c73 2c20 656c 656d  lement(cls, elem
-00019370: 2c20 7661 6c75 652c 2072 6570 6c61 6365  , value, replace
-00019380: 3d54 7275 6529 3a0a 2020 2020 2020 2020  =True):.        
-00019390: 2222 220a 2020 2020 2020 2020 636f 6e76  """.        conv
-000193a0: 656e 6965 6e63 6520 6d65 7468 6f64 2074  enience method t
-000193b0: 6f20 7365 7420 636c 6173 7320 6f6e 2065  o set class on e
-000193c0: 6c65 6d65 6e74 0a20 2020 2020 2020 203a  lement.        :
-000193d0: 7061 7261 6d20 656c 656d 3a65 6c65 6d65  param elem:eleme
-000193e0: 6e74 2074 6f20 7365 7420 636c 6173 7320  nt to set class 
-000193f0: 6f6e 0a20 2020 2020 2020 203a 7061 7261  on.        :para
-00019400: 6d20 7661 6c75 653a 2068 746d 6c20 636c  m value: html cl
-00019410: 6173 730a 2020 2020 2020 2020 3a70 6172  ass.        :par
-00019420: 616d 2072 6570 6c61 6365 3a69 6620 5472  am replace:if Tr
-00019430: 7565 2072 6570 6c61 6365 2c20 656c 7365  ue replace, else
-00019440: 2061 6464 2074 6f20 6578 6973 7469 6e67   add to existing
-00019450: 2061 7474 7269 6275 7465 0a20 2020 2020   attribute.     
-00019460: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
-00019470: 6620 656c 656d 2069 7320 6e6f 7420 4e6f  f elem is not No
-00019480: 6e65 2061 6e64 2076 616c 7565 3a0a 2020  ne and value:.  
-00019490: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-000194a0: 2072 6570 6c61 6365 3a0a 2020 2020 2020   replace:.      
-000194b0: 2020 2020 2020 2020 2020 6f6c 645f 636c            old_cl
-000194c0: 6173 7320 3d20 4874 6d6c 436c 6173 732e  ass = HtmlClass.
-000194d0: 6765 745f 636c 6173 735f 7374 7269 6e67  get_class_string
-000194e0: 5f6f 6e5f 656c 656d 656e 7428 656c 656d  _on_element(elem
-000194f0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00019500: 2020 6966 206f 6c64 5f63 6c61 7373 3a0a    if old_class:.
-00019510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019520: 2020 2020 6966 2076 616c 7565 206e 6f74      if value not
-00019530: 2069 6e20 6f6c 645f 636c 6173 733a 0a20   in old_class:. 
-00019540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019550: 2020 2020 2020 206f 6c64 5f63 6c61 7373         old_class
-00019560: 202b 3d20 2220 2220 2b20 7661 6c75 650a   += " " + value.
-00019570: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00019580: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00019590: 2020 6f6c 645f 636c 6173 7320 3d20 7661    old_class = va
-000195a0: 6c75 650a 2020 2020 2020 2020 2020 2020  lue.            
-000195b0: 656c 656d 2e61 7474 7269 625b 2263 6c61  elem.attrib["cla
-000195c0: 7373 225d 203d 2076 616c 7565 0a0a 2020  ss"] = value..  
-000195d0: 2020 2320 636c 6173 7320 4874 6d6c 436c    # class HtmlCl
-000195e0: 6173 733a 0a0a 2020 2020 6465 6620 6372  ass:..    def cr
-000195f0: 6561 7465 5f63 6c61 7373 7265 6628 7365  eate_classref(se
-00019600: 6c66 293a 0a20 2020 2020 2020 2022 2222  lf):.        """
-00019610: 0a20 2020 2020 2020 2063 7265 6174 6520  .        create 
-00019620: 636c 6173 7372 6566 2073 7472 696e 6720  classref string 
-00019630: 2870 7265 7065 6e64 2022 2e22 290a 2020  (prepend ".").  
-00019640: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00019650: 2020 7265 7475 726e 2022 2e22 202b 2073    return "." + s
-00019660: 656c 662e 636c 6173 735f 7374 7269 6e67  elf.class_string
-00019670: 0a0a 2020 2020 2320 636c 6173 7320 4874  ..    # class Ht
-00019680: 6d6c 436c 6173 733a 0a0a 2020 2020 4063  mlClass:..    @c
-00019690: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
-000196a0: 6566 2072 656d 6f76 655f 646f 7428 7365  ef remove_dot(se
-000196b0: 6c66 2c20 7374 7269 6e67 293a 0a20 2020  lf, string):.   
-000196c0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-000196d0: 2072 656d 6f76 6520 646f 7420 2822 2e22   remove dot ("."
-000196e0: 2920 2d20 696e 2068 746d 6c2f 6865 6164  ) - in html/head
-000196f0: 2f73 7479 6c65 2065 6c65 6d65 6e74 0a20  /style element. 
-00019700: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00019710: 2020 2072 6574 7572 6e20 7374 7269 6e67     return string
-00019720: 5b31 3a5d 2069 6620 7374 7269 6e67 2061  [1:] if string a
-00019730: 6e64 2073 7472 696e 675b 3a31 5d20 3d3d  nd string[:1] ==
-00019740: 2022 2e22 2065 6c73 6520 7374 7269 6e67   "." else string
-00019750: 0a0a 0a63 6c61 7373 2048 746d 6c54 7265  ...class HtmlTre
-00019760: 653a 0a20 2020 2022 2222 6275 696c 6473  e:.    """builds
-00019770: 2061 2074 7265 6520 6672 6f6d 2061 2066   a tree from a f
-00019780: 6c61 7420 7365 7420 6f66 2048 746d 6c20  lat set of Html 
-00019790: 656c 656d 6e65 7473 2222 220a 0a20 2020  elemnets"""..   
-000197a0: 2023 2066 6f72 2074 6865 2073 6563 7469   # for the secti
-000197b0: 6f6e 5f72 6563 730a 2020 2020 4348 4150  on_recs.    CHAP
-000197c0: 5f54 4f50 203d 2022 4348 4150 5f54 4f50  _TOP = "CHAP_TOP
-000197d0: 220a 2020 2020 4348 4150 5f53 4543 5449  ".    CHAP_SECTI
-000197e0: 4f4e 5320 3d20 2243 4841 505f 5345 4354  ONS = "CHAP_SECT
-000197f0: 494f 4e53 220a 2020 2020 4348 4150 5f53  IONS".    CHAP_S
-00019800: 5542 5345 4354 5320 3d20 2243 4841 505f  UBSECTS = "CHAP_
-00019810: 5355 4253 4543 5453 220a 0a20 2020 2023  SUBSECTS"..    #
-00019820: 2043 6861 7074 6572 0a20 2020 2054 5245   Chapter.    TRE
-00019830: 455f 524f 4f54 203d 2022 7472 6565 5f72  E_ROOT = "tree_r
-00019840: 6f6f 7422 0a20 2020 2043 4c41 5353 203d  oot".    CLASS =
-00019850: 2022 636c 6173 7322 0a20 2020 2050 5245   "class".    PRE
-00019860: 5f43 4841 5053 4543 203d 2022 7072 655f  _CHAPSEC = "pre_
-00019870: 6368 6170 7365 6322 0a0a 2020 2020 2320  chapsec"..    # 
-00019880: 7365 6374 696f 6e73 0a20 2020 2043 4841  sections.    CHA
-00019890: 5053 4543 203d 2022 6368 6170 7365 6322  PSEC = "chapsec"
-000198a0: 0a20 2020 2054 4f50 5f44 4956 203d 2022  .    TOP_DIV = "
-000198b0: 746f 705f 6469 7622 0a0a 2020 2020 2320  top_div"..    # 
-000198c0: 5850 6174 6873 0a20 2020 2041 4c4c 5f44  XPaths.    ALL_D
-000198d0: 4956 5f58 5041 5448 5320 3d20 222e 2f2f  IV_XPATHS = ".//
-000198e0: 6469 7622 0a0a 2320 636c 6173 7320 4874  div"..# class Ht
-000198f0: 6d6c 5472 6565 0a0a 2020 2020 4063 6c61  mlTree..    @cla
-00019900: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
-00019910: 206d 616b 655f 7365 6374 696f 6e73 5f61   make_sections_a
-00019920: 6e64 5f6f 7574 7075 7428 636c 732c 2065  nd_output(cls, e
-00019930: 6c65 6d2c 206f 7574 7075 745f 6469 722c  lem, output_dir,
-00019940: 2072 6563 735f 6279 5f73 6563 7469 6f6e   recs_by_section
-00019950: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
-00019960: 2222 2266 696e 6420 6465 6369 6d61 6c20  """find decimal 
-00019970: 6e75 6d62 6572 2066 6f72 2074 7265 650a  number for tree.
-00019980: 2020 2020 2020 2020 5468 6953 2069 7320          ThiS is 
-00019990: 4845 4156 494c 5920 6261 7365 6420 6f6e  HEAVILY based on
-000199a0: 2049 5043 430a 2020 2020 2020 2020 6375   IPCC.        cu
-000199b0: 7272 656e 746c 7920 6361 6c6c 6564 2069  rrently called i
-000199c0: 6e20 7469 6479 5f66 6c6f 7728 290a 2020  n tidy_flow().  
-000199d0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-000199e0: 2020 6d61 726b 6572 7320 3d20 5b22 4368    markers = ["Ch
-000199f0: 6170 7465 7222 2c0a 2020 2020 2020 2020  apter",.        
-00019a00: 2020 2020 2020 2020 2020 2023 2022 5461             # "Ta
-00019a10: 626c 6520 6f66 2043 6f6e 7465 6e74 7322  ble of Contents"
-00019a20: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00019a30: 2020 2020 2022 5461 626c 6520 6f66 222c       "Table of",
-00019a40: 2020 2320 6f6e 6520 6973 2063 6f6e 6361    # one is conca
-00019a50: 7465 6e61 7465 6420 2843 6861 7074 6572  tenated (Chapter
-00019a60: 3031 2920 736f 2061 6262 7265 7669 6174  01) so abbreviat
-00019a70: 652c 2075 6e77 6569 6768 7465 6420 4368  e, unweighted Ch
-00019a80: 6170 3136 0a20 2020 2020 2020 2020 2020  ap16.           
-00019a90: 2020 2020 2020 2020 2320 2245 7865 6375          # "Execu
-00019aa0: 7469 7665 2053 756d 6d61 7279 222c 0a20  tive Summary",. 
-00019ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019ac0: 2020 2245 7865 6375 7469 7665 222c 2020    "Executive",  
-00019ad0: 2320 6361 7365 2076 6172 6961 7469 6f6e  # case variation
-00019ae0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00019af0: 2020 2020 2320 2246 7265 7175 656e 746c      # "Frequentl
-00019b00: 7920 4173 6b65 6420 5175 6573 7469 6f6e  y Asked Question
-00019b10: 7322 2c20 2320 6e6f 7420 696e 2043 6861  s", # not in Cha
-00019b20: 7074 6572 3031 0a20 2020 2020 2020 2020  pter01.         
-00019b30: 2020 2020 2020 2020 2020 2246 7265 7175            "Frequ
-00019b40: 656e 746c 7922 2c20 2023 2063 6173 6520  ently",  # case 
-00019b50: 7661 7269 6174 696f 6e0a 2020 2020 2020  variation.      
-00019b60: 2020 2020 2020 2020 2020 2020 2022 5265               "Re
-00019b70: 6665 7265 6e63 6573 222c 0a20 2020 2020  ferences",.     
-00019b80: 2020 2020 2020 2020 2020 2020 2020 5d0a                ].
-00019b90: 2020 2020 2020 2020 6973 5f62 6f6c 6420          is_bold 
-00019ba0: 3d20 5472 7565 0a20 2020 2020 2020 2066  = True.        f
-00019bb0: 6f6e 745f 7369 7a65 5f72 616e 6765 203d  ont_size_range =
-00019bc0: 2028 3132 2c20 3939 3929 0a20 2020 2020   (12, 999).     
-00019bd0: 2020 2066 6f72 206d 6172 6b65 7220 696e     for marker in
-00019be0: 206d 6172 6b65 7273 3a0a 2020 2020 2020   markers:.      
-00019bf0: 2020 2020 2020 6d61 726b 6564 5f64 6976        marked_div
-00019c00: 2c20 6469 7673 203d 2063 6c73 2e67 6574  , divs = cls.get
-00019c10: 5f64 6976 5f73 7061 6e5f 7374 6172 7469  _div_span_starti
-00019c20: 6e67 5f77 6974 6828 656c 656d 2c20 6d61  ng_with(elem, ma
-00019c30: 726b 6572 2c20 6973 5f62 6f6c 642c 2066  rker, is_bold, f
-00019c40: 6f6e 745f 7369 7a65 5f72 616e 6765 3d66  ont_size_range=f
-00019c50: 6f6e 745f 7369 7a65 5f72 616e 6765 290a  ont_size_range).
-00019c60: 2020 2020 2020 2020 2020 2020 6966 206d              if m
-00019c70: 6172 6b65 645f 6469 7620 6973 206e 6f74  arked_div is not
-00019c80: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00019c90: 2020 2020 2020 206c 6420 3d20 6c65 6e28         ld = len(
-00019ca0: 6469 7673 2920 6966 2064 6976 7320 656c  divs) if divs el
-00019cb0: 7365 2030 0a20 2020 2020 2020 2020 2020  se 0.           
-00019cc0: 2020 2020 206c 6f67 6769 6e67 2e77 6172       logging.war
-00019cd0: 6e69 6e67 2866 2243 616e 6e6f 7420 6669  ning(f"Cannot fi
-00019ce0: 6e64 206d 6172 6b65 7220 5b7b 6d61 726b  nd marker [{mark
-00019cf0: 6572 7d5d 2066 6f75 6e64 207b 6c64 7d20  er}] found {ld} 
-00019d00: 6d61 726b 6572 7322 290a 0a20 2020 2020  markers")..     
-00019d10: 2020 2063 6c61 7373 5f64 6963 7420 3d20     class_dict = 
-00019d20: 7b63 6c73 2e43 4841 5053 4543 3a20 636c  {cls.CHAPSEC: cl
-00019d30: 732e 5052 455f 4348 4150 5345 432c 0a20  s.PRE_CHAPSEC,. 
-00019d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019d50: 2020 2020 2063 6c73 2e54 4f50 5f44 4956       cls.TOP_DIV
-00019d60: 3a20 636c 732e 5452 4545 5f52 4f4f 542c  : cls.TREE_ROOT,
-00019d70: 207d 0a20 2020 2020 2020 2072 6563 203d   }.        rec =
-00019d80: 2072 6563 735f 6279 5f73 6563 7469 6f6e   recs_by_section
-00019d90: 2e67 6574 2863 6c73 2e43 4841 505f 544f  .get(cls.CHAP_TO
-00019da0: 5029 0a20 2020 2020 2020 2061 7373 6572  P).        asser
-00019db0: 7420 7265 6320 6973 206e 6f74 204e 6f6e  t rec is not Non
-00019dc0: 652c 2066 2277 616e 7465 6420 6e6f 6e2d  e, f"wanted non-
-00019dd0: 4e6f 6e65 207b 636c 732e 4348 4150 5f54  None {cls.CHAP_T
-00019de0: 4f50 7d20 7265 6322 0a20 2020 2020 2020  OP} rec".       
-00019df0: 2064 6563 696d 616c 5f64 6976 7320 3d20   decimal_divs = 
-00019e00: 636c 732e 6765 745f 6469 765f 7370 616e  cls.get_div_span
-00019e10: 735f 7769 7468 5f64 6563 696d 616c 7328  s_with_decimals(
-00019e20: 656c 656d 2c0a 2020 2020 2020 2020 2020  elem,.          
-00019e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019e50: 2020 2020 2020 2020 2020 2020 2069 735f               is_
-00019e60: 626f 6c64 2c0a 2020 2020 2020 2020 2020  bold,.          
-00019e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019e90: 2020 2020 2020 2020 2020 2020 2066 6f6e               fon
-00019ea0: 745f 7369 7a65 5f72 616e 6765 3d66 6f6e  t_size_range=fon
-00019eb0: 745f 7369 7a65 5f72 616e 6765 2c0a 2020  t_size_range,.  
-00019ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019ef0: 2020 2020 2073 6563 7469 6f6e 5f72 6563       section_rec
-00019f00: 3d72 6563 2c20 636c 6173 735f 6469 6374  =rec, class_dict
-00019f10: 3d63 6c61 7373 5f64 6963 7429 0a20 2020  =class_dict).   
-00019f20: 2020 2020 2063 6c73 2e63 7265 6174 655f       cls.create_
-00019f30: 6669 6c65 6e61 6d65 5f61 6e64 5f6f 7574  filename_and_out
-00019f40: 7075 7428 6465 6369 6d61 6c5f 6469 7673  put(decimal_divs
-00019f50: 2c20 6f75 7470 7574 5f64 6972 290a 0a20  , output_dir).. 
-00019f60: 2020 2023 2063 6c61 7373 2048 746d 6c54     # class HtmlT
-00019f70: 7265 650a 0a20 2020 2040 636c 6173 736d  ree..    @classm
-00019f80: 6574 686f 640a 2020 2020 6465 6620 6372  ethod.    def cr
-00019f90: 6561 7465 5f66 696c 656e 616d 655f 616e  eate_filename_an
-00019fa0: 645f 6f75 7470 7574 2863 6c73 2c20 6465  d_output(cls, de
-00019fb0: 6369 6d61 6c5f 6469 7673 2c20 6f75 7470  cimal_divs, outp
-00019fc0: 7574 5f64 6972 2c0a 2020 2020 2020 2020  ut_dir,.        
-00019fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019fe0: 2020 2020 2020 2020 2020 206f 7269 673d             orig=
-00019ff0: 2220 215c 2223 2425 2627 2829 2a2b 2c2f  " !\"#$%&'()*+,/
-0001a000: 3a3b 3c3d 3e3f 405b 5c5c 5d5e 607b 7c7d  :;<=>?@[\\]^`{|}
-0001a010: 7e22 2c20 7265 703d 225f 2229 3a0a 2020  ~", rep="_"):.  
-0001a020: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0001a030: 2020 6372 6561 7465 2066 696c 656e 616d    create filenam
-0001a040: 6520 6672 6f6d 2073 6563 7469 6f6e 206e  e from section n
-0001a050: 616d 652c 2072 6570 6c61 6365 2070 756e  ame, replace pun
-0001a060: 6374 2063 6861 7261 6374 6572 730a 2020  ct characters.  
-0001a070: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0001a080: 2020 6966 206f 7574 7075 745f 6469 723a    if output_dir:
-0001a090: 0a20 2020 2020 2020 2020 2020 206f 7574  .            out
-0001a0a0: 7075 745f 6469 7220 3d20 5061 7468 286f  put_dir = Path(o
-0001a0b0: 7574 7075 745f 6469 7229 0a20 2020 2020  utput_dir).     
-0001a0c0: 2020 2020 2020 206f 7574 7075 745f 6469         output_di
-0001a0d0: 722e 6d6b 6469 7228 6578 6973 745f 6f6b  r.mkdir(exist_ok
-0001a0e0: 3d54 7275 6529 0a0a 2020 2020 2020 2020  =True)..        
-0001a0f0: 2020 2020 7075 6e63 745f 6d61 736b 203d      punct_mask =
-0001a100: 2055 7469 6c2e 6d61 6b65 5f74 7261 6e73   Util.make_trans
-0001a110: 6c61 7465 5f6d 6173 6b5f 746f 5f63 6861  late_mask_to_cha
-0001a120: 7228 6f72 6967 2c20 7265 7029 0a20 2020  r(orig, rep).   
-0001a130: 2020 2020 2020 2020 2066 6f72 2069 2c20           for i, 
-0001a140: 6368 696c 645f 6469 7620 696e 2065 6e75  child_div in enu
-0001a150: 6d65 7261 7465 2864 6563 696d 616c 5f64  merate(decimal_d
-0001a160: 6976 7329 3a0a 2020 2020 2020 2020 2020  ivs):.          
-0001a170: 2020 2020 2020 636c 732e 6372 6561 7465        cls.create
-0001a180: 5f66 696c 656e 616d 655f 7265 6d6f 7665  _filename_remove
-0001a190: 5f70 756e 6374 5f61 6e64 5f6f 7574 7075  _punct_and_outpu
-0001a1a0: 7428 6368 696c 645f 6469 762c 206f 7574  t(child_div, out
-0001a1b0: 7075 745f 6469 722c 2070 756e 6374 5f6d  put_dir, punct_m
-0001a1c0: 6173 6b29 0a0a 2020 2020 2320 636c 6173  ask)..    # clas
-0001a1d0: 7320 4874 6d6c 5472 6565 0a0a 2020 2020  s HtmlTree..    
-0001a1e0: 4063 6c61 7373 6d65 7468 6f64 0a20 2020  @classmethod.   
-0001a1f0: 2064 6566 2063 7265 6174 655f 6669 6c65   def create_file
-0001a200: 6e61 6d65 5f72 656d 6f76 655f 7075 6e63  name_remove_punc
-0001a210: 745f 616e 645f 6f75 7470 7574 2863 6c73  t_and_output(cls
-0001a220: 2c20 6368 696c 645f 6469 762c 206f 7574  , child_div, out
-0001a230: 7075 745f 6469 722c 2070 756e 6374 5f6d  put_dir, punct_m
-0001a240: 6173 6b29 3a0a 2020 2020 2020 2020 2222  ask):.        ""
-0001a250: 226e 6f74 2073 7572 6520 7768 6174 2074  "not sure what t
-0001a260: 6869 7320 646f 6573 203f 4874 6d6c 5574  his does ?HtmlUt
-0001a270: 696c 2e4d 4152 4b45 5220 2222 220a 2020  il.MARKER """.  
-0001a280: 2020 2020 2020 6966 2048 746d 6c55 7469        if HtmlUti
-0001a290: 6c2e 4d41 524b 4552 2069 6e20 6368 696c  l.MARKER in chil
-0001a2a0: 645f 6469 762e 6174 7472 6962 3a0a 2020  d_div.attrib:.  
-0001a2b0: 2020 2020 2020 2020 2020 6d61 726b 6572            marker
-0001a2c0: 203d 2063 6869 6c64 5f64 6976 2e61 7474   = child_div.att
-0001a2d0: 7269 625b 4874 6d6c 5574 696c 2e4d 4152  rib[HtmlUtil.MAR
-0001a2e0: 4b45 525d 0a20 2020 2020 2020 2020 2020  KER].           
-0001a2f0: 206d 6172 6b65 7220 3d20 6d61 726b 6572   marker = marker
-0001a300: 2e73 7472 6970 2829 2e6c 6f77 6572 2829  .strip().lower()
-0001a310: 2020 2320 6e61 6d65 2066 726f 6d20 7465    # name from te
-0001a320: 7874 2063 6f6e 7465 6e74 0a20 2020 2020  xt content.     
-0001a330: 2020 2020 2020 206d 6172 6b65 722e 7472         marker.tr
-0001a340: 616e 736c 6174 6528 7075 6e63 745f 6d61  anslate(punct_ma
-0001a350: 736b 290a 2020 2020 2020 2020 2020 2020  sk).            
-0001a360: 7061 7468 203d 2050 6174 6828 6f75 7470  path = Path(outp
-0001a370: 7574 5f64 6972 2c20 6622 7b6d 6172 6b65  ut_dir, f"{marke
-0001a380: 727d 2e68 746d 6c22 290a 2020 2020 2020  r}.html").      
-0001a390: 2020 2020 2020 7769 7468 206f 7065 6e28        with open(
-0001a3a0: 7061 7468 2c20 2277 6222 2920 6173 2066  path, "wb") as f
-0001a3b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001a3c0: 2020 662e 7772 6974 6528 4554 2e74 6f73    f.write(ET.tos
-0001a3d0: 7472 696e 6728 6368 696c 645f 6469 762c  tring(child_div,
-0001a3e0: 2070 7265 7474 795f 7072 696e 743d 5472   pretty_print=Tr
-0001a3f0: 7565 2929 0a0a 2020 2020 2320 636c 6173  ue))..    # clas
-0001a400: 7320 4874 6d6c 5472 6565 0a0a 2020 2020  s HtmlTree..    
-0001a410: 4063 6c61 7373 6d65 7468 6f64 0a20 2020  @classmethod.   
-0001a420: 2064 6566 2067 6574 5f64 6976 5f73 7061   def get_div_spa
-0001a430: 6e5f 7374 6172 7469 6e67 5f77 6974 6828  n_starting_with(
-0001a440: 636c 732c 2065 6c65 6d2c 2073 7472 672c  cls, elem, strg,
-0001a450: 2069 735f 626f 6c64 3d46 616c 7365 2c20   is_bold=False, 
-0001a460: 666f 6e74 5f73 697a 655f 7261 6e67 653d  font_size_range=
-0001a470: 4e6f 6e65 293a 0a20 2020 2020 2020 2072  None):.        r
-0001a480: 6573 756c 7420 3d20 4e6f 6e65 0a20 2020  esult = None.   
-0001a490: 2020 2020 2078 7061 7468 203d 2066 222e       xpath = f".
-0001a4a0: 2f2f 6469 765b 7370 616e 5b73 7461 7274  //div[span[start
-0001a4b0: 732d 7769 7468 282e 2c27 7b73 7472 677d  s-with(.,'{strg}
-0001a4c0: 2729 5d5d 220a 2020 2020 2020 2020 6469  ')]]".        di
-0001a4d0: 7673 203d 2065 6c65 6d2e 7870 6174 6828  vs = elem.xpath(
-0001a4e0: 7870 6174 6829 0a20 2020 2020 2020 2069  xpath).        i
-0001a4f0: 6620 6c65 6e28 6469 7673 2920 3d3d 2030  f len(divs) == 0
-0001a500: 3a0a 2020 2020 2020 2020 2020 2020 6c6f  :.            lo
-0001a510: 6767 696e 672e 7761 726e 696e 6728 6622  gging.warning(f"
-0001a520: 4e6f 2064 6976 7320 7769 7468 207b 7374  No divs with {st
-0001a530: 7267 7d22 290a 2020 2020 2020 2020 2020  rg}").          
-0001a540: 2020 7265 7475 726e 2072 6573 756c 742c    return result,
-0001a550: 204e 6f6e 650a 2020 2020 2020 2020 6e65   None.        ne
-0001a560: 775f 6469 7673 203d 205b 5d0a 2020 2020  w_divs = [].    
-0001a570: 2020 2020 666f 7220 6469 7620 696e 2064      for div in d
-0001a580: 6976 733a 0a20 2020 2020 2020 2020 2020  ivs:.           
-0001a590: 2073 7061 6e73 203d 2064 6976 2e78 7061   spans = div.xpa
-0001a5a0: 7468 2822 2e2f 7370 616e 2229 0a20 2020  th("./span").   
-0001a5b0: 2020 2020 2020 2020 2069 6620 7370 616e           if span
-0001a5c0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-0001a5d0: 2020 2063 7373 5f73 7479 6c65 203d 2043     css_style = C
-0001a5e0: 5353 5374 796c 652e 6372 6561 7465 5f63  SSStyle.create_c
-0001a5f0: 7373 5f73 7479 6c65 5f66 726f 6d5f 6174  ss_style_from_at
-0001a600: 7472 6962 7574 655f 6f66 5f62 6f64 795f  tribute_of_body_
-0001a610: 656c 656d 656e 7428 7370 616e 735b 305d  element(spans[0]
-0001a620: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001a630: 2020 6966 206e 6f74 2028 6973 5f62 6f6c    if not (is_bol
-0001a640: 6420 616e 6420 6373 735f 7374 796c 652e  d and css_style.
-0001a650: 6973 5f62 6f6c 645f 6e61 6d65 2829 293a  is_bold_name()):
-0001a660: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001a670: 2020 2020 2063 6f6e 7469 6e75 650a 2020       continue.  
-0001a680: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0001a690: 206e 6f74 2028 666f 6e74 5f73 697a 655f   not (font_size_
-0001a6a0: 7261 6e67 6520 616e 6420 636c 732e 696e  range and cls.in
-0001a6b0: 5f72 616e 6765 2863 7373 5f73 7479 6c65  _range(css_style
-0001a6c0: 2e66 6f6e 745f 7369 7a65 2c20 666f 6e74  .font_size, font
-0001a6d0: 5f73 697a 655f 7261 6e67 6529 293a 0a20  _size_range)):. 
-0001a6e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a6f0: 2020 2063 6f6e 7469 6e75 650a 2020 2020     continue.    
-0001a700: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
-0001a710: 6469 7673 2e61 7070 656e 6428 6469 7629  divs.append(div)
-0001a720: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001a730: 2070 6173 730a 2020 2020 2020 2020 6469   pass.        di
-0001a740: 7673 203d 206e 6577 5f64 6976 730a 2020  vs = new_divs.  
-0001a750: 2020 2020 2020 2320 616c 736f 2074 6573        # also tes
-0001a760: 7420 666f 6e74 2068 6572 6520 4e59 490a  t font here NYI.
-0001a770: 2020 2020 2020 2020 6966 206c 656e 2864          if len(d
-0001a780: 6976 7329 203d 3d20 303a 0a20 2020 2020  ivs) == 0:.     
-0001a790: 2020 2020 2020 206c 6f67 6769 6e67 2e77         logging.w
-0001a7a0: 6172 6e69 6e67 2866 2263 616e 6e6f 7420  arning(f"cannot 
-0001a7b0: 6669 6e64 2064 6976 3a20 6c65 6e3d 7b6c  find div: len={l
-0001a7c0: 656e 2864 6976 7329 7d22 290a 2020 2020  en(divs)}").    
-0001a7d0: 2020 2020 656c 6966 206c 656e 2864 6976      elif len(div
-0001a7e0: 7329 203e 2031 3a0a 2020 2020 2020 2020  s) > 1:.        
-0001a7f0: 2020 2020 6c6f 6767 696e 672e 7761 726e      logging.warn
-0001a800: 696e 6728 6622 746f 6f20 6d61 6e79 2064  ing(f"too many d
-0001a810: 6976 733a 206c 656e 3d7b 6c65 6e28 6469  ivs: len={len(di
-0001a820: 7673 297d 2229 0a20 2020 2020 2020 2065  vs)}").        e
-0001a830: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0001a840: 2072 6573 756c 7420 3d20 6469 7673 5b30   result = divs[0
-0001a850: 5d0a 2020 2020 2020 2020 2020 2020 7265  ].            re
-0001a860: 7375 6c74 2e61 7474 7269 625b 226d 6172  sult.attrib["mar
-0001a870: 6b65 7222 5d20 3d20 7374 7267 0a20 2020  ker"] = strg.   
-0001a880: 2020 2020 2072 6574 7572 6e20 7265 7375       return resu
-0001a890: 6c74 2c20 6469 7673 0a0a 2020 2020 2320  lt, divs..    # 
-0001a8a0: 636c 6173 7320 4874 6d6c 5472 6565 0a0a  class HtmlTree..
-0001a8b0: 2020 2020 4063 6c61 7373 6d65 7468 6f64      @classmethod
-0001a8c0: 0a20 2020 2064 6566 2067 6574 5f64 6976  .    def get_div
-0001a8d0: 5f73 7061 6e73 5f77 6974 685f 6465 6369  _spans_with_deci
-0001a8e0: 6d61 6c73 2863 6c73 2c20 656c 656d 2c20  mals(cls, elem, 
-0001a8f0: 6973 5f62 6f6c 643d 4e6f 6e65 2c20 666f  is_bold=None, fo
-0001a900: 6e74 5f73 697a 655f 7261 6e67 653d 4e6f  nt_size_range=No
-0001a910: 6e65 2c20 636c 6173 735f 6469 6374 3d4e  ne, class_dict=N
-0001a920: 6f6e 652c 2073 6563 7469 6f6e 5f72 6563  one, section_rec
-0001a930: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
-0001a940: 2222 224d 6174 6368 6573 2064 6976 2f73  """Matches div/s
-0001a950: 7061 6e20 7374 6172 7469 6e67 2077 6974  pan starting wit
-0001a960: 6820 6120 6465 6369 6d61 6c20 696e 6465  h a decimal inde
-0001a970: 780a 2020 2020 2020 2020 642e 6420 6f72  x.        d.d or
-0001a980: 2064 2e64 2e64 0a20 2020 2020 2020 2022   d.d.d.        "
-0001a990: 2222 0a20 2020 2020 2020 2072 6573 756c  "".        resul
-0001a9a0: 7420 3d20 4e6f 6e65 0a20 2020 2020 2020  t = None.       
-0001a9b0: 2023 2066 6972 7374 2061 6464 2061 6c6c   # first add all
-0001a9c0: 206d 6174 6368 696e 6720 6e75 6d62 6572   matching number
-0001a9d0: 6564 2064 6976 7320 746f 2070 7265 5f63  ed divs to pre_c
-0001a9e0: 6861 7073 6563 0a20 2020 2020 2020 2069  hapsec.        i
-0001a9f0: 6620 6e6f 7420 636c 6173 735f 6469 6374  f not class_dict
-0001aa00: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
-0001aa10: 6973 6520 5661 6c75 6545 7272 6f72 2866  ise ValueError(f
-0001aa20: 226d 6973 7369 6e67 2063 6c61 7373 5f64  "missing class_d
-0001aa30: 6963 7422 290a 2020 2020 2020 2020 746f  ict").        to
-0001aa40: 705f 6469 7620 3d20 4554 2e53 7562 456c  p_div = ET.SubEl
-0001aa50: 656d 656e 7428 656c 656d 2c20 485f 4449  ement(elem, H_DI
-0001aa60: 5629 0a20 2020 2020 2020 2074 6f70 5f64  V).        top_d
-0001aa70: 6976 2e61 7474 7269 625b 636c 732e 434c  iv.attrib[cls.CL
-0001aa80: 4153 535d 203d 2063 6c61 7373 5f64 6963  ASS] = class_dic
-0001aa90: 742e 6765 7428 4874 6d6c 5472 6565 2e54  t.get(HtmlTree.T
-0001aaa0: 4f50 5f44 4956 290a 2020 2020 2020 2020  OP_DIV).        
-0001aab0: 7072 655f 6368 6170 7365 6320 3d20 4554  pre_chapsec = ET
-0001aac0: 2e53 7562 456c 656d 656e 7428 746f 705f  .SubElement(top_
-0001aad0: 6469 762c 2048 5f44 4956 290a 2020 2020  div, H_DIV).    
-0001aae0: 2020 2020 7072 655f 6368 6170 7365 632e      pre_chapsec.
-0001aaf0: 6174 7472 6962 5b63 6c73 2e43 4c41 5353  attrib[cls.CLASS
-0001ab00: 5d20 3d20 636c 6173 735f 6469 6374 2e67  ] = class_dict.g
-0001ab10: 6574 2848 746d 6c54 7265 652e 4348 4150  et(HtmlTree.CHAP
-0001ab20: 5345 4329 0a20 2020 2020 2020 2063 7572  SEC).        cur
-0001ab30: 7265 6e74 5f64 6976 203d 2070 7265 5f63  rent_div = pre_c
-0001ab40: 6861 7073 6563 0a0a 2020 2020 2020 2020  hapsec..        
-0001ab50: 2320 6974 6572 6174 6520 6f76 6572 2061  # iterate over a
-0001ab60: 6c6c 2064 6976 732c 206f 6e6c 7920 6170  ll divs, only ap
-0001ab70: 7065 6e64 2074 686f 7365 2077 6974 6820  pend those with 
-0001ab80: 6465 6369 6d61 6c0a 2020 2020 2020 2020  decimal.        
-0001ab90: 6469 7673 203d 2065 6c65 6d2e 7870 6174  divs = elem.xpat
-0001aba0: 6828 636c 732e 414c 4c5f 4449 565f 5850  h(cls.ALL_DIV_XP
-0001abb0: 4154 4853 290a 2020 2020 2020 2020 6465  ATHS).        de
-0001abc0: 6369 6d61 6c5f 636f 756e 7420 3d20 300a  cimal_count = 0.
-0001abd0: 2020 2020 2020 2020 7465 7874 7320 3d20          texts = 
-0001abe0: 5b5d 2020 2320 6a75 7374 2061 2063 6865  []  # just a che
-0001abf0: 636b 2061 7420 7072 6573 656e 740a 2020  ck at present.  
-0001ac00: 2020 2020 2020 666f 7220 6469 7620 696e        for div in
-0001ac10: 2064 6976 733a 0a20 2020 2020 2020 2020   divs:.         
-0001ac20: 2020 2073 7061 6e73 203d 2064 6976 2e78     spans = div.x
-0001ac30: 7061 7468 2822 2e2f 7370 616e 2229 0a20  path("./span"). 
-0001ac40: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-0001ac50: 7420 7370 616e 733a 0a20 2020 2020 2020  t spans:.       
-0001ac60: 2020 2020 2020 2020 2023 206e 6f20 7370           # no sp
-0001ac70: 616e 732c 2063 6f6e 6361 7465 6e61 7465  ans, concatenate
-0001ac80: 2077 6974 6820 7369 626c 696e 6773 0a20   with siblings. 
-0001ac90: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0001aca0: 6620 6469 7620 3d3d 2063 7572 7265 6e74  f div == current
-0001acb0: 5f64 6976 3a0a 2020 2020 2020 2020 2020  _div:.          
-0001acc0: 2020 2020 2020 2020 2020 6c6f 6767 696e            loggin
-0001acd0: 672e 7761 726e 696e 6728 2266 2063 616e  g.warning("f can
-0001ace0: 6e6f 7420 6170 7065 6e64 2064 6976 207b  not append div {
-0001acf0: 6469 767d 2074 6f20 6974 7365 6c66 2229  div} to itself")
-0001ad00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001ad10: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0001ad20: 2020 2020 2020 2020 2020 2074 7279 3a0a             try:.
-0001ad30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ad40: 2020 2020 2020 2020 6375 7272 656e 745f          current_
-0001ad50: 6469 762e 6170 7065 6e64 2864 6976 290a  div.append(div).
-0001ad60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ad70: 2020 2020 6578 6365 7074 2056 616c 7565      except Value
-0001ad80: 4572 726f 7220 6173 2076 653a 0a20 2020  Error as ve:.   
-0001ad90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ada0: 2020 2020 206c 6f67 6769 6e67 2e65 7272       logging.err
-0001adb0: 6f72 2866 2245 7272 6f72 207b 7665 7d22  or(f"Error {ve}"
-0001adc0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001add0: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
-0001ade0: 2020 2020 2020 2020 2020 2063 7572 7265             curre
-0001adf0: 6e74 5f64 6976 2e61 7070 656e 6428 6469  nt_div.append(di
-0001ae00: 7629 0a20 2020 2020 2020 2020 2020 2020  v).             
-0001ae10: 2020 2065 7863 6570 7420 4578 6365 7074     except Except
-0001ae20: 696f 6e20 6173 2065 3a0a 2020 2020 2020  ion as e:.      
-0001ae30: 2020 2020 2020 2020 2020 2020 2020 6c6f                lo
-0001ae40: 6767 696e 672e 6572 726f 7228 6622 4255  gging.error(f"BU
-0001ae50: 4720 736b 6970 7065 6422 290a 2020 2020  G skipped").    
-0001ae60: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
-0001ae70: 696e 7565 0a20 2020 2020 2020 2020 2020  inue.           
-0001ae80: 2063 7373 5f73 7479 6c65 203d 2043 5353   css_style = CSS
-0001ae90: 5374 796c 652e 6372 6561 7465 5f63 7373  Style.create_css
-0001aea0: 5f73 7479 6c65 5f66 726f 6d5f 6174 7472  _style_from_attr
-0001aeb0: 6962 7574 655f 6f66 5f62 6f64 795f 656c  ibute_of_body_el
-0001aec0: 656d 656e 7428 7370 616e 735b 305d 2920  ement(spans[0]) 
-0001aed0: 2023 206e 6f72 6d61 6c6c 7920 636f 6d65   # normally come
-0001aee0: 7320 6669 7273 740a 2020 2020 2020 2020  s first.        
-0001aef0: 2020 2020 2320 6368 6563 6b20 7765 6967      # check weig
-0001af00: 6874 2c20 6966 206e 6f6e 6520 6170 7065  ht, if none appe
-0001af10: 6e64 2074 6f20 7369 626c 696e 6773 0a20  nd to siblings. 
-0001af20: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-0001af30: 7420 2869 735f 626f 6c64 2061 6e64 2063  t (is_bold and c
-0001af40: 7373 5f73 7479 6c65 2e69 735f 626f 6c64  ss_style.is_bold
-0001af50: 5f6e 616d 6528 2929 3a0a 2020 2020 2020  _name()):.      
-0001af60: 2020 2020 2020 2020 2020 6375 7272 656e            curren
-0001af70: 745f 6469 762e 6170 7065 6e64 2864 6976  t_div.append(div
-0001af80: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001af90: 2020 636f 6e74 696e 7565 0a20 2020 2020    continue.     
-0001afa0: 2020 2020 2020 2023 2063 6865 636b 2066         # check f
-0001afb0: 6f6e 742d 7369 7a65 2c20 6966 206e 6f6e  ont-size, if non
-0001afc0: 6520 6170 7065 6e64 2074 6f20 7369 626c  e append to sibl
-0001afd0: 696e 6773 0a20 2020 2020 2020 2020 2020  ings.           
-0001afe0: 2069 6620 6e6f 7420 2866 6f6e 745f 7369   if not (font_si
-0001aff0: 7a65 5f72 616e 6765 2061 6e64 2063 6c73  ze_range and cls
-0001b000: 2e69 6e5f 7261 6e67 6528 6373 735f 7374  .in_range(css_st
-0001b010: 796c 652e 666f 6e74 5f73 697a 652c 2066  yle.font_size, f
-0001b020: 6f6e 745f 7369 7a65 5f72 616e 6765 2929  ont_size_range))
-0001b030: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001b040: 2020 6375 7272 656e 745f 6469 762e 6170    current_div.ap
-0001b050: 7065 6e64 2864 6976 290a 2020 2020 2020  pend(div).      
-0001b060: 2020 2020 2020 2020 2020 636f 6e74 696e            contin
-0001b070: 7565 0a20 2020 2020 2020 2020 2020 2023  ue.            #
-0001b080: 2073 7061 6e20 636f 6e74 656e 740a 2020   span content.  
-0001b090: 2020 2020 2020 2020 2020 7465 7874 203d            text =
-0001b0a0: 2048 746d 6c55 7469 6c2e 6765 745f 7465   HtmlUtil.get_te
-0001b0b0: 7874 5f63 6f6e 7465 6e74 2873 7061 6e73  xt_content(spans
-0001b0c0: 5b30 5d29 0a20 2020 2020 2020 2020 2020  [0]).           
-0001b0d0: 206d 6174 6368 6564 203d 2046 616c 7365   matched = False
-0001b0e0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0001b0f0: 7365 6374 696f 6e5f 7265 632e 6d61 7463  section_rec.matc
-0001b100: 6828 7465 7874 293a 0a20 2020 2020 2020  h(text):.       
-0001b110: 2020 2020 2020 2020 2074 6f70 5f64 6976           top_div
-0001b120: 2e61 7070 656e 6428 6375 7272 656e 745f  .append(current_
-0001b130: 6469 7629 0a20 2020 2020 2020 2020 2020  div).           
-0001b140: 2020 2020 2074 6578 7473 2e61 7070 656e       texts.appen
-0001b150: 6428 7465 7874 290a 2020 2020 2020 2020  d(text).        
-0001b160: 2020 2020 2020 2020 6469 762e 6174 7472          div.attr
-0001b170: 6962 5b48 746d 6c55 7469 6c2e 4d41 524b  ib[HtmlUtil.MARK
-0001b180: 4552 5d20 3d20 7465 7874 0a20 2020 2020  ER] = text.     
-0001b190: 2020 2020 2020 2020 2020 2063 7572 7265             curre
-0001b1a0: 6e74 5f64 6976 203d 2064 6976 0a20 2020  nt_div = div.   
-0001b1b0: 2020 2020 2020 2020 2020 2020 2064 6563               dec
-0001b1c0: 696d 616c 5f63 6f75 6e74 202b 3d20 310a  imal_count += 1.
-0001b1d0: 2020 2020 2020 2020 2020 2020 656c 7365              else
-0001b1e0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001b1f0: 2020 6375 7272 656e 745f 6469 762e 6170    current_div.ap
-0001b200: 7065 6e64 2864 6976 290a 2020 2020 2020  pend(div).      
-0001b210: 2020 7265 7475 726e 2074 6f70 5f64 6976    return top_div
-0001b220: 0a0a 2020 2020 2320 636c 6173 7320 4874  ..    # class Ht
-0001b230: 6d6c 5472 6565 0a0a 2020 2020 4063 6c61  mlTree..    @cla
-0001b240: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
-0001b250: 2069 6e5f 7261 6e67 6528 636c 732c 206e   in_range(cls, n
-0001b260: 756d 2c20 6e75 6d5f 7261 6e67 6529 3a0a  um, num_range):.
-0001b270: 2020 2020 2020 2020 2222 2269 7320 6120          """is a 
-0001b280: 6e75 6d62 6572 2069 6e20 6120 6e75 6d65  number in a nume
-0001b290: 7269 6320 7261 6e67 6522 2222 0a20 2020  ric range""".   
-0001b2a0: 2020 2020 2061 7373 6572 7420 6e75 6d5f       assert num_
-0001b2b0: 7261 6e67 6520 6f72 206c 656e 286e 756d  range or len(num
-0001b2c0: 5f72 616e 6765 2920 3d3d 2032 2c20 6622  _range) == 2, f"
-0001b2d0: 7261 6e67 6520 6d75 7374 2068 6176 6520  range must have 
-0001b2e0: 3220 656c 656d 656e 7473 220a 2020 2020  2 elements".    
-0001b2f0: 2020 2020 6173 7365 7274 206e 756d 5f72      assert num_r
-0001b300: 616e 6765 5b30 5d20 3c3d 206e 756d 5f72  ange[0] <= num_r
-0001b310: 616e 6765 5b31 5d2c 2066 2266 6f6e 745f  ange[1], f"font_
-0001b320: 7369 7a65 5f72 616e 6765 206d 7573 7420  size_range must 
-0001b330: 6265 2028 6c6f 7765 722c 6869 6768 6572  be (lower,higher
-0001b340: 2922 0a20 2020 2020 2020 2061 7373 6572  )".        asser
-0001b350: 7420 666c 6f61 7428 6e75 6d5f 7261 6e67  t float(num_rang
-0001b360: 655b 305d 290a 2020 2020 2020 2020 7265  e[0]).        re
-0001b370: 7375 6c74 203d 206e 756d 5f72 616e 6765  sult = num_range
-0001b380: 5b30 5d20 3c3d 206e 756d 203c 3d20 6e75  [0] <= num <= nu
-0001b390: 6d5f 7261 6e67 655b 315d 0a20 2020 2020  m_range[1].     
-0001b3a0: 2020 2072 6574 7572 6e20 7265 7375 6c74     return result
-0001b3b0: 0a0a 2020 2020 2320 636c 6173 7320 4874  ..    # class Ht
-0001b3c0: 6d6c 5472 6565 0a0a 2020 2020 4063 6c61  mlTree..    @cla
-0001b3d0: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
-0001b3e0: 2067 6574 5f64 6563 696d 616c 5f73 6563   get_decimal_sec
-0001b3f0: 7469 6f6e 7328 636c 732c 2068 746d 6c5f  tions(cls, html_
-0001b400: 656c 656d 2c20 7870 6174 683d 4e6f 6e65  elem, xpath=None
-0001b410: 2c20 7265 6765 783d 4e6f 6e65 293a 0a20  , regex=None):. 
-0001b420: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0001b430: 2020 2067 6574 7320 6465 6369 6d61 6c20     gets decimal 
-0001b440: 7365 6374 696f 6e73 2069 6e20 656c 656d  sections in elem
-0001b450: 7320 6f66 2066 6f72 6d20 312e 322c 2065  s of form 1.2, e
-0001b460: 7463 0a20 2020 2020 2020 203a 7061 7261  tc.        :para
-0001b470: 6d20 6874 6d6c 5f65 6c65 6d3a 2065 6c65  m html_elem: ele
-0001b480: 6d65 6e74 2074 6f20 7365 6172 6368 2066  ment to search f
-0001b490: 6f72 2073 6563 7469 6f6e 730a 2020 2020  or sections.    
-0001b4a0: 2020 2020 3a70 6172 616d 2078 7061 7468      :param xpath
-0001b4b0: 3a20 7365 6374 696e 7320 6d61 7920 6861  : sectins may ha
-0001b4c0: 7665 2062 6565 6e20 6c61 6265 6c6c 6564  ve been labelled
-0001b4d0: 2077 6974 6820 4063 6c61 7373 206f 7220   with @class or 
-0001b4e0: 7369 6d69 6c61 720a 2020 2020 2020 2020  similar.        
-0001b4f0: 3a70 6172 616d 2072 6567 6578 3a20 7365  :param regex: se
-0001b500: 6374 696f 6e73 206d 6179 2062 6520 6469  ctions may be di
-0001b510: 7363 6f76 6572 6162 6c65 2062 7920 7265  scoverable by re
-0001b520: 6765 782b 636f 6e74 656e 740a 2020 2020  gex+content.    
-0001b530: 2020 2020 3a72 6574 7572 6e3a 206c 6973      :return: lis
-0001b540: 7420 6f66 2073 6563 7469 6f6e 7320 286d  t of sections (m
-0001b550: 6179 2062 6520 656d 7074 7929 206f 7220  ay be empty) or 
-0001b560: 4e6f 6e65 0a20 2020 2020 2020 2049 7420  None.        It 
-0001b570: 6973 206c 696b 656c 7920 7468 6174 2061  is likely that a
-0001b580: 2063 6f6d 6269 6e61 7469 6f6e 206f 6620   combination of 
-0001b590: 7870 6174 6820 616e 6420 7265 6765 7820  xpath and regex 
-0001b5a0: 7769 6c6c 2062 6520 7573 6564 2061 7320  will be used as 
-0001b5b0: 7870 6174 680a 2020 2020 2020 2020 6d61  xpath.        ma
-0001b5c0: 7920 6e6f 7420 6861 7665 2072 6567 6578  y not have regex
-0001b5d0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0001b5e0: 2020 2020 2069 6620 6874 6d6c 5f65 6c65       if html_ele
-0001b5f0: 6d20 6973 204e 6f6e 653a 0a20 2020 2020  m is None:.     
-0001b600: 2020 2020 2020 2072 6574 7572 6e20 4e6f         return No
-0001b610: 6e65 0a20 2020 2020 2020 2073 6563 7469  ne.        secti
-0001b620: 6f6e 7320 3d20 5b5d 0a20 2020 2020 2020  ons = [].       
-0001b630: 2069 6620 7870 6174 683a 0a20 2020 2020   if xpath:.     
-0001b640: 2020 2020 2020 2073 6563 7469 6f6e 7320         sections 
-0001b650: 3d20 6874 6d6c 5f65 6c65 6d2e 7870 6174  = html_elem.xpat
-0001b660: 6828 7870 6174 6829 0a20 2020 2020 2020  h(xpath).       
-0001b670: 2069 6620 7265 6765 783a 0a20 2020 2020   if regex:.     
-0001b680: 2020 2020 2020 206c 6f67 6769 6e67 2e77         logging.w
-0001b690: 6172 6e69 6e67 2866 2272 6567 6578 206e  arning(f"regex n
-0001b6a0: 6f74 2079 6574 2064 6576 656c 6f70 6564  ot yet developed
-0001b6b0: 2066 6f72 2073 6563 7469 6f6e 7322 290a   for sections").
-0001b6c0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-0001b6d0: 6563 7469 6f6e 730a 0a0a 5245 4353 5f42  ections...RECS_B
-0001b6e0: 595f 5345 4354 494f 4e20 3d20 7b0a 2020  Y_SECTION = {.  
-0001b6f0: 2020 2320 4874 6d6c 5472 6565 2e43 4841    # HtmlTree.CHA
-0001b700: 505f 544f 503a 2049 5043 435f 4348 4150  P_TOP: IPCC_CHAP
-0001b710: 5f54 4f50 5f52 4543 2c20 2320 7368 6f75  _TOP_REC, # shou
-0001b720: 6c64 2062 6520 696e 6a65 6374 6564 2062  ld be injected b
-0001b730: 7920 7573 6572 0a20 2020 2048 746d 6c54  y user.    HtmlT
-0001b740: 7265 652e 4348 4150 5f54 4f50 3a20 4348  ree.CHAP_TOP: CH
-0001b750: 4150 5f54 4f50 5f52 4543 2c20 2320 7368  AP_TOP_REC, # sh
-0001b760: 6f75 6c64 2062 6520 696e 6a65 6374 6564  ould be injected
-0001b770: 2062 7920 7573 6572 0a20 2020 2048 746d   by user.    Htm
-0001b780: 6c54 7265 652e 4348 4150 5f53 4543 5449  lTree.CHAP_SECTI
-0001b790: 4f4e 533a 2053 4543 5449 4f4e 535f 4445  ONS: SECTIONS_DE
-0001b7a0: 4349 4d41 4c5f 5245 432c 0a20 2020 2048  CIMAL_REC,.    H
-0001b7b0: 746d 6c54 7265 652e 4348 4150 5f53 5542  tmlTree.CHAP_SUB
-0001b7c0: 5345 4354 533a 2053 5542 5345 4354 535f  SECTS: SUBSECTS_
-0001b7d0: 4445 4349 4d41 4c5f 5245 432c 0a7d 0a0a  DECIMAL_REC,.}..
-0001b7e0: 0a63 6c61 7373 2048 544d 4c53 6561 7263  .class HTMLSearc
-0001b7f0: 6865 723a 0a20 2020 2022 2222 0a20 2020  her:.    """.   
-0001b800: 2049 2074 6869 6e6b 2074 6869 7320 6475   I think this du
-0001b810: 706c 6963 6174 6573 2073 6f6d 6520 6f66  plicates some of
-0001b820: 204e 6f64 6545 7874 7261 6374 6f72 2e0a   NodeExtractor..
-0001b830: 2020 2020 2222 220a 2020 2020 2222 220a      """.    """.
-0001b840: 2020 2020 6d65 7468 6f64 7320 666f 7220      methods for 
-0001b850: 6669 6e64 696e 6720 6368 756e 6b73 2061  finding chunks a
-0001b860: 6e64 2073 7472 696e 6773 2069 6e20 4854  nd strings in HT
-0001b870: 4d4c 2065 6c65 6d65 6e74 730a 0a20 2020  ML elements..   
-0001b880: 2045 7861 6d70 6c65 2074 6578 743a 0a20   Example text:. 
-0001b890: 2020 203c 7370 616e 3e6f 6273 6572 7665     <span>observe
-0001b8a0: 6420 696e 6372 6561 7365 7320 696e 2074  d increases in t
-0001b8b0: 6865 206d 6f73 7420 7265 6365 6e74 2079  he most recent y
-0001b8c0: 6561 7273 2028 4d69 6e78 2065 7420 616c  ears (Minx et al
-0001b8d0: 2e2c 2032 3032 313b 2055 4e45 502c 2032  ., 2021; UNEP, 2
-0001b8e0: 3032 3061 292e 0a20 2020 2032 3031 3920  020a)..    2019 
-0001b8f0: 4748 4720 656d 6973 7369 6f6e 7320 6c65  GHG emissions le
-0001b900: 7665 6c73 2077 6572 6520 6869 6768 6572  vels were higher
-0001b910: 2063 6f6d 7061 7265 6420 746f 2031 3020   compared to 10 
-0001b920: 616e 6420 3330 2079 6561 7273 2061 676f  and 30 years ago
-0001b930: 2028 6869 6768 2063 6f6e 6669 6465 6e63   (high confidenc
-0001b940: 6529 3a20 6162 6f75 7420 3132 2520 2836  e): about 12% (6
-0001b950: 2e35 2047 7443 4f32 6571 290a 2020 2020  .5 GtCO2eq).    
-0001b960: 6869 6768 6572 2074 6861 6e20 696e 2032  higher than in 2
-0001b970: 3031 3020 2835 33c2 b135 2e37 2047 7443  010 (53..5.7 GtC
-0001b980: 4f32 6571 2920 2841 5235 2072 6566 6572  O2eq) (AR5 refer
-0001b990: 656e 6365 2079 6561 7229 2061 6e64 2061  ence year) and a
-0001b9a0: 626f 7574 2035 3425 2028 3231 2047 7443  bout 54% (21 GtC
-0001b9b0: 4f32 6571 2920 6869 6768 6572 2074 6861  O2eq) higher tha
-0001b9c0: 6e20 696e 2031 3939 300a 2020 2020 2833  n in 1990.    (3
-0001b9d0: 38c2 b134 2e38 2047 7443 4f32 6571 2920  8..4.8 GtCO2eq) 
-0001b9e0: 284b 796f 746f 2050 726f 746f 636f 6c20  (Kyoto Protocol 
-0001b9f0: 7265 6665 7265 6e63 6520 7965 6172 2061  reference year a
-0001ba00: 6e64 2066 7265 7175 656e 7420 4e44 4320  nd frequent NDC 
-0001ba10: 7265 6665 7265 6e63 6529 3c2f 7370 616e  reference)</span
-0001ba20: 3e0a 2020 2020 2222 220a 2020 2020 2222  >.    """.    ""
-0001ba30: 220a 2020 2020 2222 220a 0a20 2020 2023  ".    """..    #
-0001ba40: 2066 6f72 2074 6578 7420 7365 6172 6368   for text search
-0001ba50: 0a20 2020 2044 4546 4155 4c54 5f58 5041  .    DEFAULT_XPA
-0001ba60: 5448 203d 2022 2f2f 7465 7874 2829 220a  TH = "//text()".
-0001ba70: 2020 2020 4348 554e 4b5f 5245 203d 2022      CHUNK_RE = "
-0001ba80: 6368 756e 6b5f 7265 2220 2023 2066 696e  chunk_re"  # fin
-0001ba90: 6473 2074 6578 7420 6368 756e 6b73 2069  ds text chunks i
-0001baa0: 6e20 7465 7874 0a20 2020 2053 504c 4954  n text.    SPLIT
-0001bab0: 5445 525f 5245 203d 2022 7370 6c69 7474  TER_RE = "splitt
-0001bac0: 6572 5f72 6522 2020 2320 7370 6c69 7473  er_re"  # splits
-0001bad0: 2074 686f 7365 2063 6875 6e6b 7320 2865   those chunks (e
-0001bae0: 2c67 2c20 636f 6d6d 612d 7365 7061 7261  ,g, comma-separa
-0001baf0: 7465 6420 6c69 7374 730a 2020 2020 5355  ted lists.    SU
-0001bb00: 424e 4f44 455f 5245 203d 2022 7375 625f  BNODE_RE = "sub_
-0001bb10: 6e6f 6465 5f72 655f 6c69 7374 2220 2023  node_re_list"  #
-0001bb20: 206d 6174 6368 6573 2074 6865 2063 6f6d   matches the com
-0001bb30: 706f 6e65 6e74 7320 6f66 2074 6865 2073  ponents of the s
-0001bb40: 706c 6974 206c 6973 7473 0a20 2020 2055  plit lists.    U
-0001bb50: 4e4d 4154 4348 4544 203d 2022 756e 6d61  NMATCHED = "unma
-0001bb60: 7463 6865 6422 2020 2320 6164 6473 2075  tched"  # adds u
-0001bb70: 6e6d 6174 6368 6564 206e 6f64 6573 0a20  nmatched nodes. 
-0001bb80: 2020 2058 5041 5448 203d 2022 7870 6174     XPATH = "xpat
-0001bb90: 6822 0a0a 2020 2020 6465 6620 5f5f 696e  h"..    def __in
-0001bba0: 6974 5f5f 2873 656c 662c 2078 7061 7468  it__(self, xpath
-0001bbb0: 5f64 6963 743d 4e6f 6e65 2c20 6469 6374  _dict=None, dict
-0001bbc0: 783d 4e6f 6e65 293a 0a20 2020 2020 2020  x=None):.       
-0001bbd0: 2073 656c 662e 6368 756e 6b5f 6e6f 6465   self.chunk_node
-0001bbe0: 5f64 6963 7420 3d20 6469 6374 2829 0a20  _dict = dict(). 
-0001bbf0: 2020 2020 2020 2073 656c 662e 7870 6174         self.xpat
-0001bc00: 685f 6469 6374 203d 2064 6963 7428 2920  h_dict = dict() 
-0001bc10: 6966 2078 7061 7468 5f64 6963 7420 6973  if xpath_dict is
-0001bc20: 204e 6f6e 6520 656c 7365 2063 6f70 792e   None else copy.
-0001bc30: 6465 6570 636f 7079 2878 7061 7468 5f64  deepcopy(xpath_d
-0001bc40: 6963 7429 0a20 2020 2020 2020 2073 656c  ict).        sel
-0001bc50: 662e 6368 756e 6b5f 6469 6374 203d 2064  f.chunk_dict = d
-0001bc60: 6963 7428 290a 2020 2020 2020 2020 7365  ict().        se
-0001bc70: 6c66 2e73 706c 6974 7465 725f 6469 6374  lf.splitter_dict
-0001bc80: 203d 2064 6963 7428 290a 2020 2020 2020   = dict().      
-0001bc90: 2020 7365 6c66 2e73 7562 6e6f 6465 5f64    self.subnode_d
-0001bca0: 6963 7420 3d20 6469 6374 2829 0a20 2020  ict = dict().   
-0001bcb0: 2020 2020 2073 656c 662e 6469 6374 7820       self.dictx 
-0001bcc0: 3d20 6469 6374 2829 2069 6620 6469 6374  = dict() if dict
-0001bcd0: 7820 6973 204e 6f6e 6520 656c 7365 2063  x is None else c
-0001bce0: 6f70 792e 6465 6570 636f 7079 2864 6963  opy.deepcopy(dic
-0001bcf0: 7478 290a 0a20 2020 2064 6566 2073 6561  tx)..    def sea
-0001bd00: 7263 685f 7061 7468 5f63 6875 6e6b 5f6e  rch_path_chunk_n
-0001bd10: 6f64 6528 7365 6c66 2c20 6874 6d6c 5f70  ode(self, html_p
-0001bd20: 6174 6829 3a0a 2020 2020 2020 2020 6173  ath):.        as
-0001bd30: 7365 7274 2068 746d 6c5f 7061 7468 2e65  sert html_path.e
-0001bd40: 7869 7374 7328 292c 2066 227b 6874 6d6c  xists(), f"{html
-0001bd50: 5f70 6174 687d 2073 686f 756c 6420 6578  _path} should ex
-0001bd60: 6973 7422 0a20 2020 2020 2020 2074 7265  ist".        tre
-0001bd70: 6520 3d20 4554 2e70 6172 7365 2873 7472  e = ET.parse(str
-0001bd80: 2868 746d 6c5f 7061 7468 2929 0a0a 2020  (html_path))..  
-0001bd90: 2020 2020 2020 7365 6c66 2e78 7061 7468        self.xpath
-0001bda0: 7320 3d20 7365 6c66 2e78 7061 7468 5f64  s = self.xpath_d
-0001bdb0: 6963 742e 6765 7428 7365 6c66 2e58 5041  ict.get(self.XPA
-0001bdc0: 5448 290a 2020 2020 2020 2020 6966 206e  TH).        if n
-0001bdd0: 6f74 2073 656c 662e 7870 6174 6873 3a0a  ot self.xpaths:.
-0001bde0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-0001bdf0: 6520 5661 6c75 6545 7272 6f72 2866 2245  e ValueError(f"E
-0001be00: 5252 4f52 206d 7573 7420 6769 7665 2078  RROR must give x
-0001be10: 7061 7468 2229 0a20 2020 2020 2020 2066  path").        f
-0001be20: 6f72 2078 7061 7468 2069 6e20 7365 6c66  or xpath in self
-0001be30: 2e78 7061 7468 733a 0a20 2020 2020 2020  .xpaths:.       
-0001be40: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
-0001be50: 2020 2020 2020 2020 2020 6d61 7463 685f            match_
-0001be60: 656c 656d 656e 7473 203d 2074 7265 652e  elements = tree.
-0001be70: 7870 6174 6828 7870 6174 6829 0a20 2020  xpath(xpath).   
-0001be80: 2020 2020 2020 2020 2065 7863 6570 7420           except 
-0001be90: 4578 6365 7074 696f 6e20 6173 2065 3a0a  Exception as e:.
-0001bea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001beb0: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-0001bec0: 2866 2245 5252 4f52 2078 7061 7468 207b  (f"ERROR xpath {
-0001bed0: 7870 6174 687d 207b 657d 2229 0a0a 2020  xpath} {e}")..  
-0001bee0: 2020 2020 2020 7365 6c66 2e65 6c65 6d65        self.eleme
-0001bef0: 6e74 5f6c 6973 7420 3d20 6c69 7374 2829  nt_list = list()
-0001bf00: 0a20 2020 2020 2020 2066 6f72 2078 7061  .        for xpa
-0001bf10: 7468 2069 6e20 7365 6c66 2e78 7061 7468  th in self.xpath
-0001bf20: 733a 0a20 2020 2020 2020 2020 2020 206d  s:.            m
+00013830: 7428 6622 7265 6765 783a 204e 6f6e 6520  t(f"regex: None 
+00013840: 7465 7874 2069 6e20 7b65 6c65 6d7d 207b  text in {elem} {
+00013850: 656c 656d 2e74 6167 7d22 290a 2020 2020  elem.tag}").    
+00013860: 2020 2020 2020 2020 7265 7475 726e 0a20          return. 
+00013870: 2020 2020 2020 206d 6174 6368 203d 204e         match = N
+00013880: 6f6e 650a 2020 2020 2020 2020 7472 793a  one.        try:
+00013890: 0a20 2020 2020 2020 2020 2020 206d 6174  .            mat
+000138a0: 6368 203d 2073 656c 662e 7265 2e6d 6174  ch = self.re.mat
+000138b0: 6368 2874 6578 7429 0a20 2020 2020 2020  ch(text).       
+000138c0: 2065 7863 6570 7420 4578 6365 7074 696f   except Exceptio
+000138d0: 6e20 6173 2065 3a0a 2020 2020 2020 2020  n as e:.        
+000138e0: 2020 2020 7072 696e 7428 6622 6d61 7463      print(f"matc
+000138f0: 6820 6661 696c 207b 657d 2229 0a20 2020  h fail {e}").   
+00013900: 2020 2020 2020 2020 2072 6574 7572 6e0a           return.
+00013910: 2020 2020 2020 2020 6966 206d 6174 6368          if match
+00013920: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+00013930: 2073 656c 662e 6465 6c65 7465 3a0a 2020   self.delete:.  
+00013940: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00013950: 6c66 2e72 656d 6f76 655f 656c 656d 2865  lf.remove_elem(e
+00013960: 6c65 6d29 0a20 2020 2020 2020 2020 2020  lem).           
+00013970: 2020 2020 2072 6574 7572 6e0a 2020 2020       return.    
+00013980: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00013990: 6164 645f 6964 2061 6e64 2022 6964 2220  add_id and "id" 
+000139a0: 696e 206d 6174 6368 2e67 726f 7570 6469  in match.groupdi
+000139b0: 6374 2829 3a0a 2020 2020 2020 2020 2020  ct():.          
+000139c0: 2020 2020 2020 656c 656d 2e61 7474 7269        elem.attri
+000139d0: 625b 2269 6422 5d20 3d20 7365 6c66 2e61  b["id"] = self.a
+000139e0: 6464 5f69 645b 305d 202b 206d 6174 6368  dd_id[0] + match
+000139f0: 2e67 726f 7570 2822 6964 2229 202b 2073  .group("id") + s
+00013a00: 656c 662e 6164 645f 6964 5b31 5d0a 2020  elf.add_id[1].  
+00013a10: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
+00013a20: 662e 6164 645f 7469 746c 6520 616e 6420  f.add_title and 
+00013a30: 2274 6974 6c65 2220 696e 206d 6174 6368  "title" in match
+00013a40: 2e67 726f 7570 6469 6374 2829 3a0a 2020  .groupdict():.  
+00013a50: 2020 2020 2020 2020 2020 2020 2020 656c                el
+00013a60: 656d 2e61 7474 7269 625b 2274 6974 6c65  em.attrib["title
+00013a70: 225d 203d 2073 656c 662e 6164 645f 7469  "] = self.add_ti
+00013a80: 746c 655b 305d 202b 206d 6174 6368 2e67  tle[0] + match.g
+00013a90: 726f 7570 2822 7469 746c 6522 2920 2b20  roup("title") + 
+00013aa0: 7365 6c66 2e61 6464 5f74 6974 6c65 5b31  self.add_title[1
+00013ab0: 5d5b 3a4c 454e 5f54 4954 4c45 5d0a 2020  ][:LEN_TITLE].  
+00013ac0: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
+00013ad0: 662e 6874 6d6c 5f63 6c61 7373 3a0a 2020  f.html_class:.  
+00013ae0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00013af0: 6c66 2e75 7064 6174 655f 636c 6173 7328  lf.update_class(
+00013b00: 656c 656d 2c20 7365 6c66 2e68 746d 6c5f  elem, self.html_
+00013b10: 636c 6173 7329 0a0a 2020 2020 2320 636c  class)..    # cl
+00013b20: 6173 7320 416e 6e6f 7461 746f 7243 6f6d  ass AnnotatorCom
+00013b30: 6d61 6e64 0a0a 2020 2020 6465 6620 7275  mand..    def ru
+00013b40: 6e5f 7870 6174 6828 7365 6c66 2c20 656c  n_xpath(self, el
+00013b50: 656d 293a 0a20 2020 2020 2020 2078 705f  em):.        xp_
+00013b60: 656c 656d 7320 3d20 656c 656d 2e78 7061  elems = elem.xpa
+00013b70: 7468 2873 656c 662e 7870 6174 6829 0a20  th(self.xpath). 
+00013b80: 2020 2020 2020 2069 6620 6e6f 7420 7870         if not xp
+00013b90: 5f65 6c65 6d73 3a0a 2020 2020 2020 2020  _elems:.        
+00013ba0: 2020 2020 7265 7475 726e 0a20 2020 2020      return.     
+00013bb0: 2020 2066 6f72 2078 705f 656c 656d 2069     for xp_elem i
+00013bc0: 6e20 7870 5f65 6c65 6d73 3a0a 2020 2020  n xp_elems:.    
+00013bd0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00013be0: 6465 6c65 7465 3a0a 2020 2020 2020 2020  delete:.        
+00013bf0: 2020 2020 2020 2020 7870 5f65 6c65 6d2e          xp_elem.
+00013c00: 6765 7470 6172 656e 7428 292e 7265 6d6f  getparent().remo
+00013c10: 7665 2878 705f 656c 656d 290a 2020 2020  ve(xp_elem).    
+00013c20: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00013c30: 726e 0a20 2020 2020 2020 2020 2020 2069  rn.            i
+00013c40: 6620 7365 6c66 2e68 746d 6c5f 636c 6173  f self.html_clas
+00013c50: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+00013c60: 2020 2073 656c 662e 7570 6461 7465 5f63     self.update_c
+00013c70: 6c61 7373 2878 705f 656c 656d 2c20 7365  lass(xp_elem, se
+00013c80: 6c66 2e68 746d 6c5f 636c 6173 7329 0a20  lf.html_class). 
+00013c90: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+00013ca0: 6f73 7472 696e 6720 3d20 4554 2e74 6f73  ostring = ET.tos
+00013cb0: 7472 696e 6728 7870 5f65 6c65 6d29 0a20  tring(xp_elem). 
+00013cc0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00013cd0: 6173 730a 0a20 2020 2023 2063 6c61 7373  ass..    # class
+00013ce0: 2041 6e6e 6f74 6174 6f72 436f 6d6d 616e   AnnotatorComman
+00013cf0: 640a 0a20 2020 2064 6566 2075 7064 6174  d..    def updat
+00013d00: 655f 636c 6173 7328 7365 6c66 2c20 656c  e_class(self, el
+00013d10: 656d 2c20 6874 6d6c 5f63 6c61 7373 293a  em, html_class):
+00013d20: 0a20 2020 2020 2020 2063 6c61 7373 6573  .        classes
+00013d30: 203d 205b 5d0a 2020 2020 2020 2020 4874   = [].        Ht
+00013d40: 6d6c 436c 6173 732e 7365 745f 636c 6173  mlClass.set_clas
+00013d50: 735f 6f6e 5f65 6c65 6d65 6e74 2865 6c65  s_on_element(ele
+00013d60: 6d2c 2068 746d 6c5f 636c 6173 7329 0a20  m, html_class). 
+00013d70: 2020 2020 2020 2069 6620 4661 6c73 653a         if False:
+00013d80: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00013d90: 656c 656d 2e61 7474 7269 622e 6765 7428  elem.attrib.get(
+00013da0: 2263 6c61 7373 2229 3a0a 2020 2020 2020  "class"):.      
+00013db0: 2020 2020 2020 2020 2020 636c 6173 7365            classe
+00013dc0: 7320 3d20 656c 656d 2e61 7474 7269 625b  s = elem.attrib[
+00013dd0: 2263 6c61 7373 225d 2e73 706c 6974 2822  "class"].split("
+00013de0: 2022 290a 2020 2020 2020 2020 2020 2020   ").            
+00013df0: 6966 2068 746d 6c5f 636c 6173 7320 6e6f  if html_class no
+00013e00: 7420 696e 2063 6c61 7373 6573 3a0a 2020  t in classes:.  
+00013e10: 2020 2020 2020 2020 2020 2020 2020 636c                cl
+00013e20: 6173 7365 732e 6170 7065 6e64 2868 746d  asses.append(htm
+00013e30: 6c5f 636c 6173 7329 0a20 2020 2020 2020  l_class).       
+00013e40: 2020 2020 2020 2020 2065 6c65 6d2e 6174           elem.at
+00013e50: 7472 6962 5b22 636c 6173 7322 5d20 3d20  trib["class"] = 
+00013e60: 2220 222e 6a6f 696e 2863 6c61 7373 6573  " ".join(classes
+00013e70: 290a 0a20 2020 2064 6566 2072 756e 5f73  )..    def run_s
+00013e80: 7562 7363 7269 7074 2873 656c 662c 2073  ubscript(self, s
+00013e90: 7061 6e29 3a0a 2020 2020 2020 2020 6973  pan):.        is
+00013ea0: 5f73 7562 203d 2048 746d 6c55 7469 6c2e  _sub = HtmlUtil.
+00013eb0: 616e 6e6f 7461 7465 5f73 6372 6970 745f  annotate_script_
+00013ec0: 7479 7065 2873 7061 6e2c 2053 5363 7269  type(span, SScri
+00013ed0: 7074 2e53 5542 2c20 7964 6f77 6e3d 4661  pt.SUB, ydown=Fa
+00013ee0: 6c73 6529 0a20 2020 2020 2020 2069 6620  lse).        if 
+00013ef0: 6973 5f73 7562 3a0a 2020 2020 2020 2020  is_sub:.        
+00013f00: 2020 2020 7370 616e 2e61 7474 7269 625b      span.attrib[
+00013f10: 2274 6974 6c65 225d 203d 2022 7375 6273  "title"] = "subs
+00013f20: 6372 6970 745f 7b73 7061 6e2e 7465 7874  cript_{span.text
+00013f30: 7d22 0a20 2020 2020 2020 2020 2020 2070  }".            p
+00013f40: 7269 6e74 2866 2253 5542 207b 7370 616e  rint(f"SUB {span
+00013f50: 2e74 6578 747d 2229 0a0a 2020 2020 2320  .text}")..    # 
+00013f60: 636c 6173 7320 416e 6e6f 7461 746f 7243  class AnnotatorC
+00013f70: 6f6d 6d61 6e64 0a0a 2020 2020 6465 6620  ommand..    def 
+00013f80: 7275 6e5f 7375 7065 7273 6372 6970 7428  run_superscript(
+00013f90: 7365 6c66 2c20 7370 616e 293a 0a20 2020  self, span):.   
+00013fa0: 2020 2020 2069 735f 7375 7065 7220 3d20       is_super = 
+00013fb0: 4874 6d6c 5574 696c 2e61 6e6e 6f74 6174  HtmlUtil.annotat
+00013fc0: 655f 7363 7269 7074 5f74 7970 6528 7370  e_script_type(sp
+00013fd0: 616e 2c20 5353 6372 6970 742e 5355 502c  an, SScript.SUP,
+00013fe0: 2079 646f 776e 3d46 616c 7365 290a 2020   ydown=False).  
+00013ff0: 2020 2020 2020 6966 2069 735f 7375 7065        if is_supe
+00014000: 723a 0a20 2020 2020 2020 2020 2020 2073  r:.            s
+00014010: 7061 6e2e 6174 7472 6962 5b22 7469 746c  pan.attrib["titl
+00014020: 6522 5d20 3d20 6622 7375 7065 7273 6372  e"] = f"superscr
+00014030: 6970 745f 7b73 7061 6e2e 7465 7874 7d22  ipt_{span.text}"
+00014040: 0a0a 2020 2020 2320 636c 6173 7320 416e  ..    # class An
+00014050: 6e6f 7461 746f 7243 6f6d 6d61 6e64 0a0a  notatorCommand..
+00014060: 2020 2020 6465 6620 7275 6e5f 6772 6f75      def run_grou
+00014070: 705f 7870 6174 6828 7365 6c66 2c20 6368  p_xpath(self, ch
+00014080: 696c 645f 656c 656d 293a 0a20 2020 2020  ild_elem):.     
+00014090: 2020 2022 2222 6772 6f75 7020 666f 6c6c     """group foll
+000140a0: 6f77 696e 6720 7369 626c 696e 6773 206f  owing siblings o
+000140b0: 6620 656c 656d 2222 220a 0a20 2020 2020  f elem"""..     
+000140c0: 2020 2072 6573 756c 7420 3d20 4e6f 6e65     result = None
+000140d0: 0a20 2020 2020 2020 2069 6620 6368 696c  .        if chil
+000140e0: 645f 656c 656d 2069 7320 4e6f 6e65 3a0a  d_elem is None:.
+000140f0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00014100: 726e 204e 6f6e 650a 2020 2020 2020 2020  rn None.        
+00014110: 7061 7265 6e74 5f65 6c65 6d20 3d20 6368  parent_elem = ch
+00014120: 696c 645f 656c 656d 2e67 6574 7061 7265  ild_elem.getpare
+00014130: 6e74 2829 0a20 2020 2020 2020 2069 6620  nt().        if 
+00014140: 7061 7265 6e74 5f65 6c65 6d20 6973 204e  parent_elem is N
+00014150: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+00014160: 2072 6574 7572 6e20 4e6f 6e65 0a20 2020   return None.   
+00014170: 2020 2020 2067 726f 7570 5f6c 6561 6473       group_leads
+00014180: 203d 2070 6172 656e 745f 656c 656d 2e78   = parent_elem.x
+00014190: 7061 7468 2873 656c 662e 6772 6f75 705f  path(self.group_
+000141a0: 7870 6174 6829 0a20 2020 2020 2020 2069  xpath).        i
+000141b0: 6620 6c65 6e28 6772 6f75 705f 6c65 6164  f len(group_lead
+000141c0: 7329 203e 2030 3a0a 2020 2020 2020 2020  s) > 0:.        
+000141d0: 2020 2020 7072 696e 7428 6622 6772 6f75      print(f"grou
+000141e0: 7020 6c65 6164 2063 6f75 6e74 207b 6c65  p lead count {le
+000141f0: 6e28 6772 6f75 705f 6c65 6164 7329 7d20  n(group_leads)} 
+00014200: 7b73 656c 662e 6772 6f75 705f 7870 6174  {self.group_xpat
+00014210: 687d 2229 0a20 2020 2020 2020 2065 6c73  h}").        els
+00014220: 653a 0a20 2020 2020 2020 2020 2020 2070  e:.            p
+00014230: 6173 730a 2020 2020 2020 2020 666f 7220  ass.        for 
+00014240: 692c 2067 726f 7570 5f6c 6561 6420 696e  i, group_lead in
+00014250: 2065 6e75 6d65 7261 7465 2867 726f 7570   enumerate(group
+00014260: 5f6c 6561 6473 293a 0a20 2020 2020 2020  _leads):.       
+00014270: 2020 2020 2023 2070 7269 6e74 2866 2267       # print(f"g
+00014280: 726f 7570 206c 6561 6420 7b45 542e 746f  roup lead {ET.to
+00014290: 7374 7269 6e67 2867 726f 7570 5f6c 6561  string(group_lea
+000142a0: 6429 7d22 290a 2020 2020 2020 2020 2020  d)}").          
+000142b0: 2020 2320 656e 645f 6772 6f75 6f20 3d20    # end_grouo = 
+000142c0: 6772 6f75 705f 6c65 6164 735b 6920 2b20  group_leads[i + 
+000142d0: 315d 2069 6620 6920 3c20 6c65 6e28 6772  1] if i < len(gr
+000142e0: 6f75 705f 6c65 6164 7329 202d 2031 2065  oup_leads) - 1 e
+000142f0: 6c73 6520 4e6f 6e65 0a20 2020 2020 2020  lse None.       
+00014300: 2020 2020 2073 656c 662e 6d61 6b65 5f67       self.make_g
+00014310: 726f 7570 2870 6172 656e 745f 656c 656d  roup(parent_elem
+00014320: 2c20 6772 6f75 705f 6c65 6164 290a 0a20  , group_lead).. 
+00014330: 2020 2023 2063 6c61 7373 2041 6e6e 6f74     # class Annot
+00014340: 6174 6f72 436f 6d6d 616e 640a 0a20 2020  atorCommand..   
+00014350: 2064 6566 206d 616b 655f 6772 6f75 7028   def make_group(
+00014360: 7365 6c66 2c20 656c 656d 2c20 6772 6f75  self, elem, grou
+00014370: 705f 6c65 6164 2c20 656e 645f 6772 6f75  p_lead, end_grou
+00014380: 703d 4e6f 6e65 293a 0a20 2020 2020 2020  p=None):.       
+00014390: 2070 6172 656e 7420 3d20 586d 6c4c 6962   parent = XmlLib
+000143a0: 2e67 6574 7061 7265 6e74 2865 6c65 6d2c  .getparent(elem,
+000143b0: 2064 6562 7567 3d54 7275 6529 0a20 2020   debug=True).   
+000143c0: 2020 2020 2069 6620 7061 7265 6e74 2069       if parent i
+000143d0: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+000143e0: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+000143f0: 7272 6f72 2822 6e75 6c6c 2070 6172 656e  rror("null paren
+00014400: 7422 290a 2020 2020 2020 2020 7369 626c  t").        sibl
+00014410: 696e 6773 203d 2067 726f 7570 5f6c 6561  ings = group_lea
+00014420: 642e 7870 6174 6828 2266 6f6c 6c6f 7769  d.xpath("followi
+00014430: 6e67 2d73 6962 6c69 6e67 3a3a 2a22 290a  ng-sibling::*").
+00014440: 2020 2020 2020 2020 6966 206c 656e 2873          if len(s
+00014450: 6962 6c69 6e67 7329 203d 3d20 303a 0a20  iblings) == 0:. 
+00014460: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+00014470: 2866 226e 6f20 7369 626c 696e 6773 3a20  (f"no siblings: 
+00014480: 7b67 726f 7570 5f6c 6561 642e 7465 7874  {group_lead.text
+00014490: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
+000144a0: 7061 7373 0a20 2020 2020 2020 2065 6c73  pass.        els
+000144b0: 653a 0a20 2020 2020 2020 2020 2020 2070  e:.            p
+000144c0: 7269 6e74 2866 2273 6962 6c69 6e67 7320  rint(f"siblings 
+000144d0: 7b6c 656e 2873 6962 6c69 6e67 7329 7d21  {len(siblings)}!
+000144e0: 2121 2229 0a20 2020 2020 2020 2064 6976  !!").        div
+000144f0: 203d 2045 542e 5375 6245 6c65 6d65 6e74   = ET.SubElement
+00014500: 2870 6172 656e 742c 2022 6469 7622 290a  (parent, "div").
+00014510: 2020 2020 2020 2020 6469 762e 6170 7065          div.appe
+00014520: 6e64 2867 726f 7570 5f6c 6561 6429 0a20  nd(group_lead). 
+00014530: 2020 2020 2020 2064 6976 2e61 7474 7269         div.attri
+00014540: 625b 2274 6974 6c65 225d 203d 2067 726f  b["title"] = gro
+00014550: 7570 5f6c 6561 642e 7465 7874 2069 6620  up_lead.text if 
+00014560: 6772 6f75 705f 6c65 6164 2e74 6578 7420  group_lead.text 
+00014570: 656c 7365 2022 3f22 0a20 2020 2020 2020  else "?".       
+00014580: 2064 6976 2e61 7474 7269 625b 2273 7479   div.attrib["sty
+00014590: 6c65 225d 203d 2022 626f 7264 6572 3a62  le"] = "border:b
+000145a0: 6c61 636b 2064 6173 6865 6420 3270 783b  lack dashed 2px;
+000145b0: 220a 2020 2020 2020 2020 7870 203d 2073  ".        xp = s
+000145c0: 656c 662e 656e 645f 7870 6174 680a 2020  elf.end_xpath.  
+000145d0: 2020 2020 2020 7870 203d 2022 7365 6c66        xp = "self
+000145e0: 3a3a 6469 765b 7370 616e 5b63 6f6e 7461  ::div[span[conta
+000145f0: 696e 7328 7465 7874 2829 2c27 454e 4427  ins(text(),'END'
+00014600: 295d 5d22 0a20 2020 2020 2020 2023 2070  )]]".        # p
+00014610: 7269 6e74 2866 2265 6e64 5f78 7061 7468  rint(f"end_xpath
+00014620: 207b 7870 7d22 290a 2020 2020 2020 2020   {xp}").        
+00014630: 666f 7220 7369 626c 696e 6720 696e 2073  for sibling in s
+00014640: 6962 6c69 6e67 733a 0a20 2020 2020 2020  iblings:.       
+00014650: 2020 2020 2070 7269 6e74 2866 2273 6962       print(f"sib
+00014660: 6c69 6e67 3a20 7b27 272e 6a6f 696e 2873  ling: {''.join(s
+00014670: 6962 6c69 6e67 2e69 7465 7274 6578 7428  ibling.itertext(
+00014680: 2929 7d22 290a 2020 2020 2020 2020 2020  ))}").          
+00014690: 2020 656e 645f 7369 6220 3d20 4e6f 6e65    end_sib = None
+000146a0: 0a20 2020 2020 2020 2020 2020 2074 7279  .            try
+000146b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000146c0: 2020 656e 645f 7369 6220 3d20 7369 626c    end_sib = sibl
+000146d0: 696e 672e 7870 6174 6828 7870 290a 2020  ing.xpath(xp).  
+000146e0: 2020 2020 2020 2020 2020 6578 6365 7074            except
+000146f0: 2045 7863 6570 7469 6f6e 2061 7320 653a   Exception as e:
+00014700: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014710: 2070 7269 6e74 2866 2266 6169 6c65 6420   print(f"failed 
+00014720: 7870 6174 6820 7b78 707d 207b 657d 2229  xpath {xp} {e}")
+00014730: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00014740: 656e 645f 7369 6220 616e 6420 6c65 6e28  end_sib and len(
+00014750: 656e 645f 7369 6229 203e 2030 3a0a 2020  end_sib) > 0:.  
+00014760: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00014770: 6966 2073 6962 6c69 6e67 2021 3d20 656e  if sibling != en
+00014780: 645f 6772 6f75 703a 0a20 2020 2020 2020  d_group:.       
+00014790: 2020 2020 2020 2020 2023 2020 2020 2070           #     p
+000147a0: 7269 6e74 2866 2273 6962 6c69 6e67 207b  rint(f"sibling {
+000147b0: 7369 626c 696e 677d 2229 0a20 2020 2020  sibling}").     
+000147c0: 2020 2020 2020 2020 2020 2062 7265 616b             break
+000147d0: 0a20 2020 2020 2020 2020 2020 2064 6976  .            div
+000147e0: 2e61 7070 656e 6428 7369 626c 696e 6729  .append(sibling)
+000147f0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00014800: 6469 760a 0a20 2020 2023 2063 6c61 7373  div..    # class
+00014810: 2041 6e6e 6f74 6174 6f72 436f 6d6d 616e   AnnotatorComman
+00014820: 640a 0a20 2020 2064 6566 2072 756e 5f65  d..    def run_e
+00014830: 7874 7261 6374 2873 656c 662c 2065 6c65  xtract(self, ele
+00014840: 6d29 3a0a 0a20 2020 2020 2020 2022 2222  m):..        """
+00014850: 6578 7472 6163 7420 6772 6f75 702e 206f  extract group. o
+00014860: 7074 696e 616c 6c79 2077 7269 7465 2074  ptinally write t
+00014870: 6f20 6669 6c65 2e20 6375 7272 656e 746c  o file. currentl
+00014880: 7920 4e4f 2d4f 5022 2222 0a20 2020 2020  y NO-OP""".     
+00014890: 2020 2070 7269 6e74 2866 2272 756e 5f65     print(f"run_e
+000148a0: 7874 7261 6374 2069 7320 4e4f 2d4f 5022  xtract is NO-OP"
+000148b0: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+000148c0: 204e 6f6e 650a 0a20 2020 2023 2063 6c61   None..    # cla
+000148d0: 7373 2041 6e6e 6f74 6174 6f72 436f 6d6d  ss AnnotatorComm
+000148e0: 616e 640a 0a20 2020 2064 6566 2072 656d  and..    def rem
+000148f0: 6f76 655f 656c 656d 2873 656c 662c 2065  ove_elem(self, e
+00014900: 6c65 6d2c 2064 6562 7567 3d46 616c 7365  lem, debug=False
+00014910: 293a 0a20 2020 2020 2020 2069 6620 656c  ):.        if el
+00014920: 656d 2069 7320 4e6f 6e65 3a0a 2020 2020  em is None:.    
+00014930: 2020 2020 2020 2020 7265 7475 726e 0a20          return. 
+00014940: 2020 2020 2020 2070 6172 656e 7420 3d20         parent = 
+00014950: 656c 656d 2e67 6574 7061 7265 6e74 2829  elem.getparent()
+00014960: 0a20 2020 2020 2020 2069 6620 7061 7265  .        if pare
+00014970: 6e74 2069 7320 4e6f 6e65 3a0a 2020 2020  nt is None:.    
+00014980: 2020 2020 2020 2020 6966 2064 6562 7567          if debug
+00014990: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000149a0: 2020 7072 696e 7428 6622 656c 656d 656e    print(f"elemen
+000149b0: 7420 7b65 6c65 6d7d 2068 6173 206e 6f20  t {elem} has no 
+000149c0: 7061 7265 6e74 2229 0a20 2020 2020 2020  parent").       
+000149d0: 2020 2020 2072 6574 7572 6e0a 2020 2020       return.    
+000149e0: 2020 2020 7061 7265 6e74 2e72 656d 6f76      parent.remov
+000149f0: 6528 656c 656d 290a 0a0a 5354 594c 455f  e(elem)...STYLE_
+00014a00: 4355 524c 595f 5245 203d 2072 652e 636f  CURLY_RE = re.co
+00014a10: 6d70 696c 6528 2228 3f50 3c70 7265 3e2e  mpile("(?P<pre>.
+00014a20: 2a29 7b28 3f50 3c76 616c 7565 3e5b 5e7d  *){(?P<value>[^}
+00014a30: 5d2a 297d 283f 503c 706f 7374 3e2e 2a29  ]*)}(?P<post>.*)
+00014a40: 2229 0a0a 0a63 6c61 7373 2048 746d 6c53  ")...class HtmlS
+00014a50: 7479 6c65 3a0a 2020 2020 2222 220a 2020  tyle:.    """.  
+00014a60: 2020 6d65 7468 6f64 7320 746f 2070 726f    methods to pro
+00014a70: 6365 7373 2073 7479 6c65 2061 7474 7269  cess style attri
+00014a80: 6275 7465 7320 616e 6420 3c73 7479 6c65  butes and <style
+00014a90: 3e20 656c 656d 656e 7473 0a20 2020 206e  > elements.    n
+00014aa0: 6f20 696e 7374 616e 6365 2064 6174 610a  o instance data.
+00014ab0: 2020 2020 2222 220a 0a20 2020 2064 6566      """..    def
+00014ac0: 205f 5f69 6e69 745f 5f28 7365 6c66 2c20   __init__(self, 
+00014ad0: 6373 735f 7374 7269 6e67 3d4e 6f6e 6529  css_string=None)
+00014ae0: 3a0a 2020 2020 2020 2020 7365 6c66 2e63  :.        self.c
+00014af0: 7373 5f73 7472 696e 6720 3d20 6373 735f  ss_string = css_
+00014b00: 7374 7269 6e67 0a0a 2020 2020 4063 6c61  string..    @cla
+00014b10: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
+00014b20: 2067 6574 5f63 7373 7374 796c 655f 7374   get_cssstyle_st
+00014b30: 7269 6e67 2863 6c73 2c20 656c 656d 293a  ring(cls, elem):
+00014b40: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00014b50: 2020 2020 2063 6f6e 7665 6e69 656e 6365       convenience
+00014b60: 206d 6574 686f 6420 746f 2067 6574 2065   method to get e
+00014b70: 6c65 6d65 6e74 2073 7479 6c65 0a20 2020  lement style.   
+00014b80: 2020 2020 203a 7061 7261 6d20 656c 656d       :param elem
+00014b90: 3a20 746f 2067 6574 2073 7479 6c65 2066  : to get style f
+00014ba0: 726f 6d0a 2020 2020 2020 2020 3a72 6574  rom.        :ret
+00014bb0: 7572 6e3a 2073 7479 6c65 206f 7220 4e6f  urn: style or No
+00014bc0: 6e65 0a20 2020 2020 2020 2022 2222 0a20  ne.        """. 
+00014bd0: 2020 2020 2020 2072 6574 7572 6e20 656c         return el
+00014be0: 656d 2e61 7474 7269 622e 6765 7428 2273  em.attrib.get("s
+00014bf0: 7479 6c65 2229 0a0a 2020 2020 2320 636c  tyle")..    # cl
+00014c00: 6173 7320 4874 6d6c 5374 796c 650a 0a20  ass HtmlStyle.. 
+00014c10: 2020 2040 636c 6173 736d 6574 686f 640a     @classmethod.
+00014c20: 2020 2020 6465 6620 7365 745f 7374 796c      def set_styl
+00014c30: 6528 636c 732c 2065 6c65 6d2c 2076 616c  e(cls, elem, val
+00014c40: 7565 293a 0a20 2020 2020 2020 2022 2222  ue):.        """
+00014c50: 0a20 2020 2020 2020 2063 6f6e 7665 6e69  .        conveni
+00014c60: 656e 6365 206d 6574 686f 6420 746f 2073  ence method to s
+00014c70: 6574 2073 7479 6c65 206f 6e20 656c 656d  et style on elem
+00014c80: 656e 740a 2020 2020 2020 2020 3a70 6172  ent.        :par
+00014c90: 616d 2065 6c65 6d3a 656c 656d 656e 7420  am elem:element 
+00014ca0: 746f 2073 6574 2073 7479 6c65 206f 6e0a  to set style on.
+00014cb0: 2020 2020 2020 2020 3a70 6172 616d 2076          :param v
+00014cc0: 616c 7565 3a20 6373 7320 7374 7269 6e67  alue: css string
+00014cd0: 3b20 6966 2022 2220 6f72 204e 6f6e 6520  ; if "" or None 
+00014ce0: 7265 6d6c 7665 7320 6174 7472 6962 7574  remlves attribut
+00014cf0: 650a 2020 2020 2020 2020 2222 220a 2020  e.        """.  
+00014d00: 2020 2020 2020 6966 2065 6c65 6d20 6973        if elem is
+00014d10: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+00014d20: 2020 2020 2020 2058 6d6c 4c69 622e 7365         XmlLib.se
+00014d30: 745f 6174 746e 616d 655f 7661 6c75 6528  t_attname_value(
+00014d40: 656c 656d 2c20 2273 7479 6c65 222c 2076  elem, "style", v
+00014d50: 616c 7565 290a 0a20 2020 2023 2063 6c61  alue)..    # cla
+00014d60: 7373 2048 746d 6c53 7479 6c65 0a0a 2020  ss HtmlStyle..  
+00014d70: 2020 4063 6c61 7373 6d65 7468 6f64 0a20    @classmethod. 
+00014d80: 2020 2064 6566 2065 7874 7261 6374 5f61     def extract_a
+00014d90: 6c6c 5f73 7479 6c65 5f61 7474 7269 6275  ll_style_attribu
+00014da0: 7465 735f 746f 5f68 6561 6428 636c 732c  tes_to_head(cls,
+00014db0: 2068 746d 6c5f 656c 656d 293a 0a20 2020   html_elem):.   
+00014dc0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00014dd0: 2046 696e 6473 2061 6c6c 2065 6c65 6d65   Finds all eleme
+00014de0: 6e74 7320 7769 7468 2040 7374 796c 6520  nts with @style 
+00014df0: 6174 7472 6962 7574 6520 616e 6420 6578  attribute and ex
+00014e00: 7461 6374 7320 7468 6520 7464 7874 2073  tacts the tdxt s
+00014e10: 7479 6c65 7320 746f 203c 6865 6164 3e0a  tyles to <head>.
+00014e20: 2020 2020 2020 2020 416c 736f 2073 6574          Also set
+00014e30: 7320 626f 6479 2073 7479 6c65 7320 746f  s body styles to
+00014e40: 206e 6f72 6d61 6c0a 2020 2020 2020 2020   normal.        
+00014e50: 3a70 6172 616d 2068 746d 6c5f 656c 656d  :param html_elem
+00014e60: 3a20 746f 7461 6c20 6874 6d6c 206f 626a  : total html obj
+00014e70: 6563 7420 746f 206e 6f72 6d61 6c69 7a65  ect to normalize
+00014e80: 2e20 4d75 7374 2068 6176 6520 3c68 6561  . Must have <hea
+00014e90: 643e 2061 6e64 203c 626f 6479 3e0a 2020  d> and <body>.  
+00014ea0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00014eb0: 2020 4874 6d6c 5374 796c 652e 7265 6d6f    HtmlStyle.remo
+00014ec0: 7665 5f65 6d70 7479 5f73 7479 6c65 7328  ve_empty_styles(
+00014ed0: 6874 6d6c 5f65 6c65 6d29 0a20 2020 2020  html_elem).     
+00014ee0: 2020 2073 7479 6c65 645f 656c 656d 7320     styled_elems 
+00014ef0: 3d20 6874 6d6c 5f65 6c65 6d2e 7870 6174  = html_elem.xpat
+00014f00: 6828 222e 2f2f 2a5b 4073 7479 6c65 5d22  h(".//*[@style]"
+00014f10: 290a 2020 2020 2020 2020 666f 7220 692c  ).        for i,
+00014f20: 2073 7479 6c65 645f 656c 656d 2069 6e20   styled_elem in 
+00014f30: 656e 756d 6572 6174 6528 7374 796c 6564  enumerate(styled
+00014f40: 5f65 6c65 6d73 293a 0a20 2020 2020 2020  _elems):.       
+00014f50: 2020 2020 2063 6c61 7373 7265 6620 3d20       classref = 
+00014f60: 6622 737b 697d 220a 2020 2020 2020 2020  f"s{i}".        
+00014f70: 2020 2020 4874 6d6c 5374 796c 652e 6164      HtmlStyle.ad
+00014f80: 645f 656c 656d 656e 745f 7769 7468 5f73  d_element_with_s
+00014f90: 7479 6c65 2863 6c61 7373 7265 662c 2068  tyle(classref, h
+00014fa0: 746d 6c5f 656c 656d 2c20 7374 796c 6564  tml_elem, styled
+00014fb0: 5f65 6c65 6d29 0a20 2020 2020 2020 2023  _elem).        #
+00014fc0: 2064 6f65 7320 7468 6973 2064 6f20 616e   does this do an
+00014fd0: 7974 6869 6e67 3f3f 3f0a 2020 2020 2020  ything???.      
+00014fe0: 2020 626f 6479 203d 2068 746d 6c5f 656c    body = html_el
+00014ff0: 656d 2e78 7061 7468 2822 2f68 746d 6c2f  em.xpath("/html/
+00015000: 626f 6479 2229 0a20 2020 2020 2020 2069  body").        i
+00015010: 6620 6c65 6e28 626f 6479 2920 213d 2031  f len(body) != 1
+00015020: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
+00015030: 6973 6520 5661 6c75 6545 7272 6f72 2866  ise ValueError(f
+00015040: 2264 6f63 756d 656e 7420 7368 6f75 6c64  "document should
+00015050: 2068 6176 6520 6578 6163 746c 7920 3120   have exactly 1 
+00015060: 626f 6479 2074 6167 2229 0a20 2020 2020  body tag").     
+00015070: 2020 2073 7479 6c65 203d 2043 5353 5374     style = CSSSt
+00015080: 796c 6528 290a 2020 2020 2020 2020 7374  yle().        st
+00015090: 796c 652e 6372 6561 7465 5f63 7373 5f73  yle.create_css_s
+000150a0: 7479 6c65 5f66 726f 6d5f 6373 735f 7374  tyle_from_css_st
+000150b0: 7269 6e67 280a 2020 2020 2020 2020 2020  ring(.          
+000150c0: 2020 2266 6f6e 742d 7374 796c 653a 206e    "font-style: n
+000150d0: 6f72 6d61 6c3b 2022 0a20 2020 2020 2020  ormal; ".       
+000150e0: 2020 2020 2022 666f 6e74 2d77 6569 6768       "font-weigh
+000150f0: 743a 206e 6f72 6d61 6c3b 2022 0a20 2020  t: normal; ".   
+00015100: 2020 2020 2020 2020 2022 666f 6e74 2d73           "font-s
+00015110: 7472 6574 6368 6564 3a20 6e6f 726d 616c  tretched: normal
+00015120: 3b20 220a 2020 2020 2020 2020 2020 2020  ; ".            
+00015130: 226f 7061 6369 7479 3a20 313b 2022 0a20  "opacity: 1; ". 
+00015140: 2020 2020 2020 2020 2020 2022 636f 6c6f             "colo
+00015150: 723a 2062 6c61 636b 3b22 0a20 2020 2020  r: black;".     
+00015160: 2020 2029 0a0a 2020 2020 2320 636c 6173     )..    # clas
+00015170: 7320 4874 6d6c 5374 796c 650a 0a20 2020  s HtmlStyle..   
+00015180: 2040 636c 6173 736d 6574 686f 640a 2020   @classmethod.  
+00015190: 2020 6465 6620 6164 645f 656c 656d 656e    def add_elemen
+000151a0: 745f 7769 7468 5f73 7479 6c65 2863 6c73  t_with_style(cls
+000151b0: 2c20 636c 6173 7372 6566 2c20 6874 6d6c  , classref, html
+000151c0: 5f65 6c65 6d2c 2073 7479 6c65 645f 656c  _elem, styled_el
+000151d0: 656d 293a 0a20 2020 2020 2020 2022 2222  em):.        """
+000151e0: 0a20 2020 2020 2020 2061 6464 730a 2020  .        adds.  
+000151f0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00015200: 2020 6865 6164 203d 2068 746d 6c5f 656c    head = html_el
+00015210: 656d 2e78 7061 7468 2822 2f68 746d 6c2f  em.xpath("/html/
+00015220: 6865 6164 2229 5b30 5d0a 2020 2020 2020  head")[0].      
+00015230: 2020 656c 656d 5f73 7479 6c65 203d 2048    elem_style = H
+00015240: 746d 6c53 7479 6c65 2e67 6574 5f63 7373  tmlStyle.get_css
+00015250: 7374 796c 655f 7374 7269 6e67 2873 7479  style_string(sty
+00015260: 6c65 645f 656c 656d 290a 2020 2020 2020  led_elem).      
+00015270: 2020 6966 2065 6c65 6d5f 7374 796c 6520    if elem_style 
+00015280: 6973 204e 6f6e 6520 6f72 2065 6c65 6d5f  is None or elem_
+00015290: 7374 796c 6520 3d3d 2022 223a 0a20 2020  style == "":.   
+000152a0: 2020 2020 2020 2020 2072 6574 7572 6e0a           return.
+000152b0: 2020 2020 2020 2020 6373 7320 3d20 4353          css = CS
+000152c0: 5353 7479 6c65 2e63 7265 6174 655f 6373  SStyle.create_cs
+000152d0: 735f 7374 796c 655f 6672 6f6d 5f63 7373  s_style_from_css
+000152e0: 5f73 7472 696e 6728 656c 656d 5f73 7479  _string(elem_sty
+000152f0: 6c65 290a 2020 2020 2020 2020 6966 2063  le).        if c
+00015300: 7373 2069 7320 4e6f 6e65 3a0a 2020 2020  ss is None:.    
+00015310: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+00015320: 6c75 6545 7272 6f72 2866 2263 7373 2069  lueError(f"css i
+00015330: 7320 4e6f 6e65 2229 0a0a 2020 2020 2020  s None")..      
+00015340: 2020 6578 7472 6163 7465 645f 7374 796c    extracted_styl
+00015350: 655f 656c 656d 2c20 7265 6d61 696e 696e  e_elem, remainin
+00015360: 675f 7374 796c 652c 206e 6577 5f63 6c61  g_style, new_cla
+00015370: 7373 203d 2063 7373 2e65 7874 7261 6374  ss = css.extract
+00015380: 5f74 6578 745f 7374 796c 6573 5f69 6e74  _text_styles_int
+00015390: 6f5f 636c 6173 7328 636c 6173 7372 6566  o_class(classref
+000153a0: 290a 2020 2020 2020 2020 6966 2065 7874  ).        if ext
+000153b0: 7261 6374 6564 5f73 7479 6c65 5f65 6c65  racted_style_ele
+000153c0: 6d20 6973 206e 6f74 204e 6f6e 653a 0a20  m is not None:. 
+000153d0: 2020 2020 2020 2020 2020 2048 746d 6c53             HtmlS
+000153e0: 7479 6c65 2e73 6574 5f73 7479 6c65 2873  tyle.set_style(s
+000153f0: 7479 6c65 645f 656c 656d 2c20 7265 6d61  tyled_elem, rema
+00015400: 696e 696e 675f 7374 796c 6529 0a20 2020  ining_style).   
+00015410: 2020 2020 2020 2020 2048 746d 6c43 6c61           HtmlCla
+00015420: 7373 2e73 6574 5f63 6c61 7373 5f6f 6e5f  ss.set_class_on_
+00015430: 656c 656d 656e 7428 7374 796c 6564 5f65  element(styled_e
+00015440: 6c65 6d2c 2063 6c61 7373 7265 662c 2072  lem, classref, r
+00015450: 6570 6c61 6365 3d46 616c 7365 290a 2020  eplace=False).  
+00015460: 2020 2020 2020 2020 2020 6865 6164 2e61            head.a
+00015470: 7070 656e 6428 6578 7472 6163 7465 645f  ppend(extracted_
+00015480: 7374 796c 655f 656c 656d 290a 0a20 2020  style_elem)..   
+00015490: 2023 2063 6c61 7373 2048 746d 6c53 7479   # class HtmlSty
+000154a0: 6c65 0a0a 2020 2020 4063 6c61 7373 6d65  le..    @classme
+000154b0: 7468 6f64 0a20 2020 2064 6566 2072 656d  thod.    def rem
+000154c0: 6f76 655f 656d 7074 795f 7374 796c 6573  ove_empty_styles
+000154d0: 2863 6c73 2c20 6874 6d6c 5f65 6c65 6d29  (cls, html_elem)
+000154e0: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+000154f0: 2020 2020 2020 7265 6d6f 7665 7320 616c        removes al
+00015500: 6c20 656d 7074 7920 7374 796c 6520 6174  l empty style at
+00015510: 7472 6962 7574 6573 2028 7374 796c 653d  tributes (style=
+00015520: 2222 290a 2020 2020 2020 2020 2222 220a  "").        """.
+00015530: 2020 2020 2020 2020 656d 7074 795f 7374          empty_st
+00015540: 796c 6564 5f65 6c65 6d73 203d 2068 746d  yled_elems = htm
+00015550: 6c5f 656c 656d 2e78 7061 7468 2822 2e2f  l_elem.xpath("./
+00015560: 2f2a 5b6e 6f72 6d61 6c69 7a65 2d73 7061  /*[normalize-spa
+00015570: 6365 2840 7374 796c 6529 3d27 275d 2229  ce(@style)='']")
+00015580: 0a20 2020 2020 2020 2066 6f72 2065 6c65  .        for ele
+00015590: 6d20 696e 2065 6d70 7479 5f73 7479 6c65  m in empty_style
+000155a0: 645f 656c 656d 733a 0a20 2020 2020 2020  d_elems:.       
+000155b0: 2020 2020 2048 746d 6c53 7479 6c65 2e64       HtmlStyle.d
+000155c0: 656c 6574 655f 7374 796c 6528 656c 656d  elete_style(elem
+000155d0: 290a 0a20 2020 2023 2063 6c61 7373 2048  )..    # class H
+000155e0: 746d 6c53 7479 6c65 0a0a 2020 2020 4063  tmlStyle..    @c
+000155f0: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
+00015600: 6566 2064 656c 6574 655f 7374 796c 6528  ef delete_style(
+00015610: 636c 732c 2065 6c65 6d29 3a0a 2020 2020  cls, elem):.    
+00015620: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00015630: 636f 6e76 656e 6965 6e6e 6365 206d 6574  conveniennce met
+00015640: 686f 6420 746f 2064 656c 6574 6520 7374  hod to delete st
+00015650: 796c 6520 6174 7472 6962 7574 650a 2020  yle attribute.  
+00015660: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00015670: 2020 586d 6c4c 6962 2e72 656d 6f76 655f    XmlLib.remove_
+00015680: 6174 7472 6962 7574 6528 656c 656d 2c20  attribute(elem, 
+00015690: 2273 7479 6c65 2229 0a0a 2020 2020 2320  "style")..    # 
+000156a0: 5448 4553 4520 4341 4e20 4245 434f 4d45  THESE CAN BECOME
+000156b0: 2049 4e53 5441 4e43 4520 4d45 5448 4f44   INSTANCE METHOD
+000156c0: 530a 0a20 2020 2023 2063 6c61 7373 2048  S..    # class H
+000156d0: 746d 6c53 7479 6c65 0a0a 2020 2020 4063  tmlStyle..    @c
+000156e0: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
+000156f0: 6566 206e 6f72 6d61 6c69 7a65 5f68 6561  ef normalize_hea
+00015700: 645f 7374 796c 6573 2863 6c73 2c20 656c  d_styles(cls, el
+00015710: 656d 2c20 6974 616c 6963 5f62 6f6c 643d  em, italic_bold=
+00015720: 5472 7565 2c20 6f75 7464 6972 3d4e 6f6e  True, outdir=Non
+00015730: 6529 3a0a 2020 2020 2020 2020 2222 220a  e):.        """.
+00015740: 2020 2020 2020 2020 6372 6561 7465 7320          creates 
+00015750: 6d75 6c74 6964 6963 7420 666f 7420 6865  multidict fot he
+00015760: 6164 2073 7479 6c65 730a 2020 2020 2020  ad styles.      
+00015770: 2020 3a70 6172 616d 2065 6c65 6d3a 2064    :param elem: d
+00015780: 6f63 756d 656e 7420 746f 2061 6e61 6c79  ocument to analy
+00015790: 7365 0a20 2020 2020 2020 203a 7265 7475  se.        :retu
+000157a0: 726e 3a20 6469 6374 206f 6620 636c 6173  rn: dict of clas
+000157b0: 7372 6566 5f73 6574 7320 696e 6465 7865  sref_sets indexe
+000157c0: 6420 6279 2073 7479 6c65 2073 7472 696e  d by style strin
+000157d0: 6773 0a0a 2020 2020 2020 2020 652e 672e  gs..        e.g.
+000157e0: 2069 7465 6d20 7b66 6f6e 742d 6661 6d69   item {font-fami
+000157f0: 6c79 3a20 5469 6d65 734e 6577 526f 6d61  ly: TimesNewRoma
+00015800: 6e50 534d 543b 2066 6f6e 742d 7369 7a65  nPSMT; font-size
+00015810: 3a20 3670 783b 7d3a 205b 272e 7331 3727  : 6px;}: ['.s17'
+00015820: 2c20 272e 7331 3927 2c20 272e 7332 3127  , '.s19', '.s21'
+00015830: 2c20 272e 7332 3727 2c20 272e 7335 272c  , '.s27', '.s5',
+00015840: 2027 2e73 3727 5d0a 2020 2020 2020 2020   '.s7'].        
+00015850: 2222 220a 2020 2020 2020 2020 7374 796c  """.        styl
+00015860: 655f 746f 5f63 6c61 7373 7265 665f 7365  e_to_classref_se
+00015870: 7420 3d20 6465 6661 756c 7464 6963 7428  t = defaultdict(
+00015880: 7365 7429 0a20 2020 2020 2020 2068 6561  set).        hea
+00015890: 645f 7374 796c 6573 203d 2048 746d 6c53  d_styles = HtmlS
+000158a0: 7479 6c65 2e67 6574 5f68 6561 645f 7374  tyle.get_head_st
+000158b0: 796c 6573 2865 6c65 6d29 0a20 2020 2020  yles(elem).     
+000158c0: 2020 2023 2077 6520 7573 6520 6f6e 6520     # we use one 
+000158d0: 636c 6173 7372 6566 202d 2073 7479 6c65  classref - style
+000158e0: 2070 6572 2048 544d 4c20 7374 796c 650a   per HTML style.
+000158f0: 2020 2020 2020 2020 666f 7220 6874 6d6c          for html
+00015900: 5f73 7479 6c65 2069 6e20 6865 6164 5f73  _style in head_s
+00015910: 7479 6c65 733a 0a20 2020 2020 2020 2020  tyles:.         
+00015920: 2020 2023 2063 6f6e 7369 7374 7320 6f66     # consists of
+00015930: 2063 6c61 7373 7265 6620 736e 6420 7374   classref snd st
+00015940: 796c 655f 7374 7269 6e67 0a20 2020 2020  yle_string.     
+00015950: 2020 2020 2020 2063 6c61 7373 7265 662c         classref,
+00015960: 2073 7479 6c65 5f73 203d 2063 6c73 2e65   style_s = cls.e
+00015970: 7874 7261 6374 5f63 6c61 7373 7265 665f  xtract_classref_
+00015980: 616e 645f 6373 7373 7472 696e 675f 6672  and_cssstring_fr
+00015990: 6f6d 5f68 746d 6c5f 7374 796c 6528 6874  om_html_style(ht
+000159a0: 6d6c 5f73 7479 6c65 290a 2020 2020 2020  ml_style).      
+000159b0: 2020 2020 2020 7374 796c 655f 7661 6c75        style_valu
+000159c0: 6520 3d20 7374 796c 655f 730a 2020 2020  e = style_s.    
+000159d0: 2020 2020 2020 2020 6966 2069 7461 6c69          if itali
+000159e0: 635f 626f 6c64 3a0a 2020 2020 2020 2020  c_bold:.        
+000159f0: 2020 2020 2020 2020 6e65 775f 6373 735f          new_css_
+00015a00: 7320 3d20 416d 6946 6f6e 742e 6372 6561  s = AmiFont.crea
+00015a10: 7465 5f66 6f6e 745f 6564 6974 6564 5f73  te_font_edited_s
+00015a20: 7479 6c65 5f66 726f 6d5f 6373 735f 7374  tyle_from_css_st
+00015a30: 796c 655f 6f62 6a65 6374 2873 7479 6c65  yle_object(style
+00015a40: 5f73 290a 2020 2020 2020 2020 2020 2020  _s).            
+00015a50: 2020 2020 6373 735f 7374 796c 6520 3d20      css_style = 
+00015a60: 4353 5353 7479 6c65 2e63 7265 6174 655f  CSSStyle.create_
+00015a70: 6373 735f 7374 796c 655f 6672 6f6d 5f63  css_style_from_c
+00015a80: 7373 5f73 7472 696e 6728 6e65 775f 6373  ss_string(new_cs
+00015a90: 735f 7329 0a20 2020 2020 2020 2020 2020  s_s).           
+00015aa0: 2020 2020 2069 6620 6373 735f 7374 796c       if css_styl
+00015ab0: 6520 6973 206e 6f74 204e 6f6e 653a 0a20  e is not None:. 
+00015ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015ad0: 2020 2063 7373 5f73 7479 6c65 2e65 7874     css_style.ext
+00015ae0: 7261 6374 5f62 6f6c 645f 6974 616c 6963  ract_bold_italic
+00015af0: 5f66 726f 6d5f 666f 6e74 5f66 616d 696c  _from_font_famil
+00015b00: 7928 290a 2020 2020 2020 2020 2020 2020  y().            
+00015b10: 2020 2020 2020 2020 7374 796c 655f 7661          style_va
+00015b20: 6c75 6520 3d20 6373 735f 7374 796c 652e  lue = css_style.
+00015b30: 6765 745f 6373 735f 7661 6c75 6528 7772  get_css_value(wr
+00015b40: 6170 5f77 6974 685f 6375 726c 793d 5472  ap_with_curly=Tr
+00015b50: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
+00015b60: 2020 2020 2020 2020 4874 6d6c 5374 796c          HtmlStyl
+00015b70: 652e 7265 706c 6163 655f 6375 726c 7928  e.replace_curly(
+00015b80: 6874 6d6c 5f73 7479 6c65 2c20 7374 796c  html_style, styl
+00015b90: 655f 7661 6c75 6529 0a20 2020 2020 2020  e_value).       
+00015ba0: 2020 2020 2068 746d 6c5f 7374 796c 652e       html_style.
+00015bb0: 6174 7472 6962 5b43 4c41 5353 5245 465d  attrib[CLASSREF]
+00015bc0: 203d 2063 6c61 7373 7265 660a 2020 2020   = classref.    
+00015bd0: 2020 2020 2020 2020 7374 796c 655f 746f          style_to
+00015be0: 5f63 6c61 7373 7265 665f 7365 745b 7374  _classref_set[st
+00015bf0: 796c 655f 7661 6c75 655d 2e61 6464 2863  yle_value].add(c
+00015c00: 6c61 7373 7265 6629 0a20 2020 2020 2020  lassref).       
+00015c10: 2069 6620 6f75 7464 6972 3a0a 2020 2020   if outdir:.    
+00015c20: 2020 2020 2020 2020 4874 6d6c 4c69 622e          HtmlLib.
+00015c30: 7772 6974 655f 6874 6d6c 5f66 696c 6528  write_html_file(
+00015c40: 656c 656d 2c20 5061 7468 286f 7574 6469  elem, Path(outdi
+00015c50: 722c 2022 6e6f 726d 616c 697a 6564 2e68  r, "normalized.h
+00015c60: 746d 6c22 2929 0a20 2020 2020 2020 2072  tml")).        r
+00015c70: 6574 7572 6e20 7374 796c 655f 746f 5f63  eturn style_to_c
+00015c80: 6c61 7373 7265 665f 7365 740a 0a20 2020  lassref_set..   
+00015c90: 2040 636c 6173 736d 6574 686f 640a 2020   @classmethod.  
+00015ca0: 2020 6465 6620 6765 745f 6865 6164 5f73    def get_head_s
+00015cb0: 7479 6c65 7328 636c 732c 2065 6c65 6d29  tyles(cls, elem)
+00015cc0: 3a0a 2020 2020 2020 2020 2222 2267 6574  :.        """get
+00015cd0: 2061 6c6c 203c 7374 796c 653e 2065 6c65   all <style> ele
+00015ce0: 6d65 6e74 7320 6666 726f 6d20 3c68 6561  ments ffrom <hea
+00015cf0: 643e 0a20 2020 2020 2020 203a 7061 7461  d>.        :pata
+00015d00: 6d20 656c 656d 3a20 6874 6d6c 2065 6c65  m elem: html ele
+00015d10: 6d6e 656e 7420 746f 2073 6561 7263 680a  mnent to search.
+00015d20: 2020 2020 2020 2020 3a72 6574 7572 6e3a          :return:
+00015d30: 2073 7479 6c65 2065 6c65 6d65 6e74 7320   style elements 
+00015d40: 656c 7365 205b 5d20 6966 2065 6c65 6d20  else [] if elem 
+00015d50: 6973 204e 6f6e 650a 2020 2020 2020 2020  is None.        
+00015d60: 2222 220a 2020 2020 2020 2020 7265 7475  """.        retu
+00015d70: 726e 205b 5d20 6966 2065 6c65 6d20 6973  rn [] if elem is
+00015d80: 204e 6f6e 6520 656c 7365 2065 6c65 6d2e   None else elem.
+00015d90: 7870 6174 6828 222f 6874 6d6c 2f68 6561  xpath("/html/hea
+00015da0: 642f 7374 796c 6522 290a 0a20 2020 2040  d/style")..    @
+00015db0: 636c 6173 736d 6574 686f 640a 2020 2020  classmethod.    
+00015dc0: 6465 6620 6578 7472 6163 745f 636c 6173  def extract_clas
+00015dd0: 7372 6566 5f61 6e64 5f63 7373 7374 7269  sref_and_cssstri
+00015de0: 6e67 5f66 726f 6d5f 7374 796c 655f 7465  ng_from_style_te
+00015df0: 7874 2863 6c73 2c20 6874 6d6c 5f73 7479  xt(cls, html_sty
+00015e00: 6c65 5f73 7472 696e 6729 3a0a 2020 2020  le_string):.    
+00015e10: 2020 2020 2222 2270 6172 7365 7320 7465      """parses te
+00015e20: 7874 2069 6e20 6874 6d6c 203c 7374 796c  xt in html <styl
+00015e30: 653e 2069 6e74 6f20 636c 6173 7372 6566  e> into classref
+00015e40: 2061 6e64 2063 7373 7374 7269 6e67 0a20   and cssstring. 
+00015e50: 2020 2020 2020 206f 6e6c 7920 6f6e 6520         only one 
+00015e60: 7374 796c 6520 7065 7220 6874 6d6c 2065  style per html e
+00015e70: 6c65 6d65 6e74 0a20 2020 2020 2020 203a  lement.        :
+00015e80: 7061 7261 6d20 6874 6d6c 5f73 7479 6c65  param html_style
+00015e90: 5f73 7472 696e 673a 206f 6620 666f 726d  _string: of form
+00015ea0: 203c 7365 6c65 6374 6f72 3e20 7b3c 7661   <selector> {<va
+00015eb0: 6c75 653e 7d0a 2020 2020 2020 2020 3a72  lue>}.        :r
+00015ec0: 6574 7572 6e20 7365 6c65 6374 6f72 202c  eturn selector ,
+00015ed0: 2076 616c 7565 0a20 2020 2020 2020 2022   value.        "
+00015ee0: 2222 0a0a 2020 2020 2020 2020 7374 796c  ""..        styl
+00015ef0: 655f 7265 203d 2072 652e 636f 6d70 696c  e_re = re.compil
+00015f00: 6528 225c 5c73 2a28 3f50 3c63 6c61 7373  e("\\s*(?P<class
+00015f10: 7265 663e 5b5e 5c5c 735d 2a29 5c5c 732b  ref>[^\\s]*)\\s+
+00015f20: 7b5c 5c73 2a28 3f50 3c63 7373 7374 7269  {\\s*(?P<cssstri
+00015f30: 6e67 3e2e 2a29 7d5c 5c73 2a22 290a 2020  ng>.*)}\\s*").  
+00015f40: 2020 2020 2020 6d61 7463 6820 3d20 7374        match = st
+00015f50: 796c 655f 7265 2e6d 6174 6368 2868 746d  yle_re.match(htm
+00015f60: 6c5f 7374 796c 655f 7374 7269 6e67 290a  l_style_string).
+00015f70: 2020 2020 2020 2020 6966 206e 6f74 206d          if not m
+00015f80: 6174 6368 3a0a 2020 2020 2020 2020 2020  atch:.          
+00015f90: 2020 7265 7475 726e 204e 6f6e 652c 204e    return None, N
+00015fa0: 6f6e 650a 2020 2020 2020 2020 7265 7475  one.        retu
+00015fb0: 726e 206d 6174 6368 2e67 726f 7570 2822  rn match.group("
+00015fc0: 636c 6173 7372 6566 2229 2c20 6d61 7463  classref"), matc
+00015fd0: 682e 6772 6f75 7028 2263 7373 7374 7269  h.group("cssstri
+00015fe0: 6e67 2229 0a0a 2020 2020 2320 636c 6173  ng")..    # clas
+00015ff0: 7320 4874 6d6c 5374 796c 650a 0a20 2020  s HtmlStyle..   
+00016000: 2040 636c 6173 736d 6574 686f 640a 2020   @classmethod.  
+00016010: 2020 6465 6620 6578 7472 6163 745f 7374    def extract_st
+00016020: 796c 6573 5f61 6e64 5f6e 6f72 6d61 6c69  yles_and_normali
+00016030: 7a65 5f63 6c61 7373 7265 6673 2863 6c73  ze_classrefs(cls
+00016040: 2c20 6874 6d6c 5f65 6c65 6d2c 2066 6f6e  , html_elem, fon
+00016050: 745f 7374 796c 6573 3d46 616c 7365 2c20  t_styles=False, 
+00016060: 6f75 7464 6972 3d4e 6f6e 6529 3a0a 2020  outdir=None):.  
+00016070: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00016080: 2020 4578 7472 6163 7420 7374 796c 6573    Extract styles
+00016090: 2066 726f 6d20 646f 6375 6d65 6e74 0a20   from document. 
+000160a0: 2020 2020 2020 206d 6f76 6520 746f 2068         move to h
+000160b0: 6561 6420 616e 6420 6e6f 726d 616c 697a  ead and normaliz
+000160c0: 6520 636c 6173 7372 6566 730a 2020 2020  e classrefs.    
+000160d0: 2020 2020 6465 6c65 7465 2072 6564 756e      delete redun
+000160e0: 6461 6e74 2063 6c61 7373 7265 6673 2061  dant classrefs a
+000160f0: 6e64 2073 7479 6c65 730a 2020 2020 2020  nd styles.      
+00016100: 2020 6d61 7020 646f 6375 6d65 6e74 2069    map document i
+00016110: 6e73 7461 6d63 6573 206f 6620 7374 796c  nstamces of styl
+00016120: 6573 206f 6e74 6f20 6e6f 726d 616c 697a  es onto normaliz
+00016130: 6564 2063 6c61 7373 7265 6673 0a20 2020  ed classrefs.   
+00016140: 2020 2020 203a 7061 7261 6d20 6874 6d6c       :param html
+00016150: 5f65 6c65 6d3a 2068 746d 6c20 646f 6375  _elem: html docu
+00016160: 6d65 6e74 2074 6f20 6e6f 726d 616c 697a  ment to normaliz
+00016170: 650a 0a20 2020 2020 2020 2053 686f 756c  e..        Shoul
+00016180: 6420 6265 2069 6e20 616e 206f 626a 6563  d be in an objec
+00016190: 740a 2020 2020 2020 2020 544f 444f 0a53  t.        TODO.S
+000161a0: 6f6d 6520 7370 616e 7320 6172 6520 6e6f  ome spans are no
+000161b0: 7420 6a6f 696e 6564 2c20 7831 206f 6e20  t joined, x1 on 
+000161c0: 6f6e 6520 7370 616e 2061 6e64 2078 3020  one span and x0 
+000161d0: 6f6e 2066 6f6c 6c6f 7769 6e67 2061 7265  on following are
+000161e0: 2065 7175 616c 0a20 2020 2020 2020 203c   equal.        <
+000161f0: 6469 7620 6c65 6674 3d22 3134 312e 3732  div left="141.72
+00016200: 2220 7269 6768 743d 2231 3933 2e33 2220  " right="193.3" 
+00016210: 746f 703d 2236 3332 2e32 3222 3e3c 7370  top="632.22"><sp
+00016220: 616e 2078 303d 2231 3431 2e37 3222 2079  an x0="141.72" y
+00016230: 303d 2236 3332 2e32 3222 2078 313d 2231  0="632.22" x1="1
+00016240: 3933 2e33 2220 7374 796c 653d 2278 303a  93.3" style="x0:
+00016250: 2031 3431 2e37 323b 2078 313a 2031 3435   141.72; x1: 145
+00016260: 2e30 333b 2079 303a 2036 3332 2e32 323b  .03; y0: 632.22;
+00016270: 2079 313a 2036 3432 2e31 383b 2077 6964   y1: 642.18; wid
+00016280: 7468 3a20 332e 3332 3b22 2063 6c61 7373  th: 3.32;" class
+00016290: 3d22 7331 3022 3e28 6129 416e 20e2 809c  ="s10">(a)An ...
+000162a0: 3c2f 7370 616e 3e0a 2020 2020 2020 2020  </span>.        
+000162b0: 3c73 7061 6e20 7830 3d22 3232 342e 3034  <span x0="224.04
+000162c0: 2220 7930 3d22 3632 302e 3232 2220 7831  " y0="620.22" x1
+000162d0: 3d22 3338 372e 3934 2220 7374 796c 653d  ="387.94" style=
+000162e0: 2278 303a 2032 3234 2e30 343b 2078 313a  "x0: 224.04; x1:
+000162f0: 2032 3239 2e30 323b 2079 303a 2036 3230   229.02; y0: 620
+00016300: 2e32 323b 2079 313a 2036 3330 2e31 383b  .22; y1: 630.18;
+00016310: 2077 6964 7468 3a20 342e 3938 3b22 2063   width: 4.98;" c
+00016320: 6c61 7373 3d22 7331 3022 3e70 6172 6167  lass="s10">parag
+00016330: 7261 7068 7320 34e2 8092 362c 2074 6865  raphs 4...6, the
+00016340: 7365 2072 756c 6573 2c20 6d6f 6461 6c69  se rules, modali
+00016350: 7469 6573 2061 3c2f 7370 616e 3e0a 2020  ties a</span>.  
+00016360: 2020 2020 2020 3c73 7061 6e20 7830 3d22        <span x0="
+00016370: 3338 372e 3936 2220 7930 3d22 3632 302e  387.96" y0="620.
+00016380: 3232 2220 7831 3d22 3438 342e 3238 2220  22" x1="484.28" 
+00016390: 7374 796c 653d 2278 303a 2033 3837 2e39  style="x0: 387.9
+000163a0: 363b 2078 313a 2033 3932 2e39 343b 2079  6; x1: 392.94; y
+000163b0: 303a 2036 3230 2e32 323b 2079 313a 2036  0: 620.22; y1: 6
+000163c0: 3330 2e31 383b 2077 6964 7468 3a20 342e  30.18; width: 4.
+000163d0: 3938 3b22 2063 6c61 7373 3d22 7331 3022  98;" class="s10"
+000163e0: 3e6e 6420 7072 6f63 6564 7572 6573 2c20  >nd procedures, 
+000163f0: 616e 6420 616e 7920 6675 7274 6865 7220  and any further 
+00016400: 7265 6c65 7661 6e74 2064 6563 6973 696f  relevant decisio
+00016410: 6e73 206f 6620 7468 6520 436f 6e66 6572  ns of the Confer
+00016420: 656e 6365 206f 6620 7468 6520 5061 7274  ence of the Part
+00016430: 6965 7320 7365 7276 696e 6720 6173 2074  ies serving as t
+00016440: 6865 206d 6565 7469 6e67 206f 6620 7468  he meeting of th
+00016450: 6520 5061 7274 6965 7320 746f 2074 6865  e Parties to the
+00016460: 2050 6172 6973 2041 6772 6565 6d65 6e74   Paris Agreement
+00016470: 2028 434d 4129 3b20 3c2f 7370 616e 3e3c   (CMA); </span><
+00016480: 2f64 6976 3e0a 2020 2020 2020 2020 2222  /div>.        ""
+00016490: 220a 0a20 2020 2020 2020 2023 2068 746d  "..        # htm
+000164a0: 6c5f 656c 656d 203d 2068 746d 6c5f 656c  l_elem = html_el
+000164b0: 656d 2e78 7061 7468 2822 2f2a 2229 5b30  em.xpath("/*")[0
+000164c0: 5d20 6966 2074 7970 6528 6874 6d6c 5f65  ] if type(html_e
+000164d0: 6c65 6d29 2069 7320 5f45 6c65 6d65 6e74  lem) is _Element
+000164e0: 5472 6565 2065 6c73 6520 6874 6d6c 5f65  Tree else html_e
+000164f0: 6c65 6d0a 2020 2020 2020 2020 636c 732e  lem.        cls.
+00016500: 6578 7472 6163 745f 616c 6c5f 7374 796c  extract_all_styl
+00016510: 655f 6174 7472 6962 7574 6573 5f74 6f5f  e_attributes_to_
+00016520: 6865 6164 2868 746d 6c5f 656c 656d 290a  head(html_elem).
+00016530: 2020 2020 2020 2020 6966 206f 7574 6469          if outdi
+00016540: 723a 0a20 2020 2020 2020 2020 2020 2048  r:.            H
+00016550: 746d 6c4c 6962 2e77 7269 7465 5f68 746d  tmlLib.write_htm
+00016560: 6c5f 6669 6c65 2868 746d 6c5f 656c 656d  l_file(html_elem
+00016570: 2c20 5061 7468 286f 7574 6469 722c 2022  , Path(outdir, "
+00016580: 7374 796c 6573 312e 6874 6d6c 2229 2c20  styles1.html"), 
+00016590: 6465 6275 673d 5472 7565 290a 2020 2020  debug=True).    
+000165a0: 2020 2020 7374 796c 655f 746f 5f63 6c61      style_to_cla
+000165b0: 7373 7265 665f 7365 7420 3d20 636c 732e  ssref_set = cls.
+000165c0: 6e6f 726d 616c 697a 655f 6865 6164 5f73  normalize_head_s
+000165d0: 7479 6c65 7328 6874 6d6c 5f65 6c65 6d2c  tyles(html_elem,
+000165e0: 206f 7574 6469 723d 6f75 7464 6972 290a   outdir=outdir).
+000165f0: 2020 2020 2020 2020 636c 6173 7372 6566          classref
+00016600: 5f69 6e64 6578 203d 2063 6c73 2e63 7265  _index = cls.cre
+00016610: 6174 655f 636c 6173 7372 6566 5f69 6e64  ate_classref_ind
+00016620: 6578 2873 7479 6c65 5f74 6f5f 636c 6173  ex(style_to_clas
+00016630: 7372 6566 5f73 6574 290a 2020 2020 2020  sref_set).      
+00016640: 2020 6465 6c65 7461 626c 655f 636c 6173    deletable_clas
+00016650: 7372 6566 7320 3d20 636c 732e 6765 745f  srefs = cls.get_
+00016660: 7265 6475 6e64 616e 745f 636c 6173 7372  redundant_classr
+00016670: 6566 7328 636c 6173 7372 6566 5f69 6e64  efs(classref_ind
+00016680: 6578 290a 2020 2020 2020 2020 636c 732e  ex).        cls.
+00016690: 6465 6c65 7465 5f72 6564 756e 6461 6e74  delete_redundant
+000166a0: 5f73 7479 6c65 7328 6465 6c65 7461 626c  _styles(deletabl
+000166b0: 655f 636c 6173 7372 6566 732c 2068 746d  e_classrefs, htm
+000166c0: 6c5f 656c 656d 290a 2020 2020 2020 2020  l_elem).        
+000166d0: 636c 732e 6e6f 726d 616c 697a 655f 636c  cls.normalize_cl
+000166e0: 6173 7372 6566 735f 6f6e 5f65 6c65 6d65  assrefs_on_eleme
+000166f0: 6e74 7328 6874 6d6c 5f65 6c65 6d2c 2063  nts(html_elem, c
+00016700: 6c61 7373 7265 665f 696e 6465 7829 0a20  lassref_index). 
+00016710: 2020 2020 2020 2069 6620 666f 6e74 5f73         if font_s
+00016720: 7479 6c65 733a 0a20 2020 2020 2020 2020  tyles:.         
+00016730: 2020 2063 6c73 2e63 7265 6174 655f 6162     cls.create_ab
+00016740: 6272 6576 6961 7465 645f 666f 6e74 5f73  breviated_font_s
+00016750: 7479 6c65 7328 6874 6d6c 5f65 6c65 6d29  tyles(html_elem)
+00016760: 0a0a 2020 2020 2320 636c 6173 7320 4874  ..    # class Ht
+00016770: 6d6c 5374 796c 650a 0a20 2020 2040 636c  mlStyle..    @cl
+00016780: 6173 736d 6574 686f 640a 2020 2020 6465  assmethod.    de
+00016790: 6620 6e6f 726d 616c 697a 655f 636c 6173  f normalize_clas
+000167a0: 7372 6566 735f 6f6e 5f65 6c65 6d65 6e74  srefs_on_element
+000167b0: 7328 636c 732c 2068 746d 6c5f 656c 656d  s(cls, html_elem
+000167c0: 2c20 636c 6173 7372 6566 5f69 6e64 6578  , classref_index
+000167d0: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
+000167e0: 2020 2020 2020 2046 696e 6473 2061 6c6c         Finds all
+000167f0: 2065 6c6d 656e 7473 2077 6974 6820 4063   elments with @c
+00016800: 6c61 7373 2061 7474 7269 6275 7465 2061  lass attribute a
+00016810: 6e64 206e 6f72 6d61 6c69 7a65 2074 6f20  nd normalize to 
+00016820: 6d69 6e69 6d61 6c20 7365 740a 2020 2020  minimal set.    
+00016830: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00016840: 636c 6173 7365 645f 656c 656d 7320 3d20  classed_elems = 
+00016850: 6874 6d6c 5f65 6c65 6d2e 7870 6174 6828  html_elem.xpath(
+00016860: 222f 2f2a 5b40 636c 6173 735d 2229 0a20  "//*[@class]"). 
+00016870: 2020 2020 2020 2066 6f72 2063 6c61 7373         for class
+00016880: 6564 5f65 6c65 6d20 696e 2063 6c61 7373  ed_elem in class
+00016890: 6564 5f65 6c65 6d73 3a0a 2020 2020 2020  ed_elems:.      
+000168a0: 2020 2020 2020 6874 6d6c 5f63 6c61 7373        html_class
+000168b0: 203d 2048 746d 6c43 6c61 7373 2e63 7265   = HtmlClass.cre
+000168c0: 6174 655f 6672 6f6d 5f63 6c61 7373 6564  ate_from_classed
+000168d0: 5f65 6c65 6d65 6e74 2863 6c61 7373 6564  _element(classed
+000168e0: 5f65 6c65 6d29 0a20 2020 2020 2020 2020  _elem).         
+000168f0: 2020 2063 6c61 7373 7265 6620 3d20 6874     classref = ht
+00016900: 6d6c 5f63 6c61 7373 2e63 7265 6174 655f  ml_class.create_
+00016910: 636c 6173 7372 6566 2829 0a20 2020 2020  classref().     
+00016920: 2020 2020 2020 206e 6f72 6d61 6c69 7a65         normalize
+00016930: 645f 636c 6173 7372 6566 203d 2048 746d  d_classref = Htm
+00016940: 6c43 6c61 7373 2e72 656d 6f76 655f 646f  lClass.remove_do
+00016950: 7428 636c 6173 7372 6566 5f69 6e64 6578  t(classref_index
+00016960: 2e67 6574 2863 6c61 7373 7265 6629 290a  .get(classref)).
+00016970: 2020 2020 2020 2020 2020 2020 636c 6173              clas
+00016980: 7372 6566 203d 2048 746d 6c43 6c61 7373  sref = HtmlClass
+00016990: 2e72 656d 6f76 655f 646f 7428 636c 6173  .remove_dot(clas
+000169a0: 7372 6566 290a 2020 2020 2020 2020 2020  sref).          
+000169b0: 2020 6966 206e 6f72 6d61 6c69 7a65 645f    if normalized_
+000169c0: 636c 6173 7372 6566 2021 3d20 636c 6173  classref != clas
+000169d0: 7372 6566 3a0a 2020 2020 2020 2020 2020  sref:.          
+000169e0: 2020 2020 2020 6874 6d6c 5f63 6c61 7373        html_class
+000169f0: 2e72 6570 6c61 6365 5f63 6c61 7373 2863  .replace_class(c
+00016a00: 6c61 7373 7265 662c 206e 6f72 6d61 6c69  lassref, normali
+00016a10: 7a65 645f 636c 6173 7372 6566 290a 2020  zed_classref).  
+00016a20: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00016a30: 2068 746d 6c5f 636c 6173 732e 636c 6173   html_class.clas
+00016a40: 735f 7374 7269 6e67 3a0a 2020 2020 2020  s_string:.      
+00016a50: 2020 2020 2020 2020 2020 2020 2020 4874                Ht
+00016a60: 6d6c 436c 6173 732e 7365 745f 636c 6173  mlClass.set_clas
+00016a70: 735f 6f6e 5f65 6c65 6d65 6e74 2863 6c61  s_on_element(cla
+00016a80: 7373 6564 5f65 6c65 6d2c 2068 746d 6c5f  ssed_elem, html_
+00016a90: 636c 6173 732e 636c 6173 735f 7374 7269  class.class_stri
+00016aa0: 6e67 290a 0a20 2020 2023 2063 6c61 7373  ng)..    # class
+00016ab0: 2048 746d 6c53 7479 6c65 0a0a 2020 2020   HtmlStyle..    
+00016ac0: 4063 6c61 7373 6d65 7468 6f64 0a20 2020  @classmethod.   
+00016ad0: 2064 6566 2064 656c 6574 655f 7265 6475   def delete_redu
+00016ae0: 6e64 616e 745f 7374 796c 6573 2863 6c73  ndant_styles(cls
+00016af0: 2c20 6465 6c65 7461 626c 655f 636c 6173  , deletable_clas
+00016b00: 7372 6566 732c 2068 746d 6c5f 656c 656d  srefs, html_elem
+00016b10: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
+00016b20: 2020 2020 2020 2064 656c 6574 6573 2072         deletes r
+00016b30: 6564 756e 6461 6e74 203c 7374 796c 653e  edundant <style>
+00016b40: 7320 696e 2068 6561 640a 2020 2020 2020  s in head.      
+00016b50: 2020 2222 220a 2020 2020 2020 2020 7374    """.        st
+00016b60: 796c 6573 5f77 6974 685f 636c 6173 7372  yles_with_classr
+00016b70: 6566 7320 3d20 6874 6d6c 5f65 6c65 6d2e  efs = html_elem.
+00016b80: 7870 6174 6828 222f 6874 6d6c 2f68 6561  xpath("/html/hea
+00016b90: 642f 7374 796c 655b 4063 6c61 7373 7265  d/style[@classre
+00016ba0: 665d 2229 0a20 2020 2020 2020 2066 6f72  f]").        for
+00016bb0: 2073 7479 6c65 2069 6e20 7374 796c 6573   style in styles
+00016bc0: 5f77 6974 685f 636c 6173 7372 6566 733a  _with_classrefs:
+00016bd0: 0a20 2020 2020 2020 2020 2020 2063 6c61  .            cla
+00016be0: 7373 7265 6620 3d20 7374 796c 652e 6174  ssref = style.at
+00016bf0: 7472 6962 2e67 6574 2843 4c41 5353 5245  trib.get(CLASSRE
+00016c00: 4629 0a20 2020 2020 2020 2020 2020 2069  F).            i
+00016c10: 6620 636c 6173 7372 6566 2069 6e20 6465  f classref in de
+00016c20: 6c65 7461 626c 655f 636c 6173 7372 6566  letable_classref
+00016c30: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+00016c40: 2020 2058 6d6c 4c69 622e 7265 6d6f 7665     XmlLib.remove
+00016c50: 5f65 6c65 6d65 6e74 2873 7479 6c65 290a  _element(style).
+00016c60: 0a20 2020 2023 2063 6c61 7373 2048 746d  .    # class Htm
+00016c70: 6c53 7479 6c65 0a0a 2020 2020 4063 6c61  lStyle..    @cla
+00016c80: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
+00016c90: 2067 6574 5f72 6564 756e 6461 6e74 5f63   get_redundant_c
+00016ca0: 6c61 7373 7265 6673 2863 6c73 2c20 636c  lassrefs(cls, cl
+00016cb0: 6173 7372 6566 5f69 6e64 6578 293a 0a20  assref_index):. 
+00016cc0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00016cd0: 2020 206d 616b 6573 206c 6973 7420 6f66     makes list of
+00016ce0: 2072 6564 756e 6461 6e74 2063 6c61 7373   redundant class
+00016cf0: 7265 6673 0a20 2020 2020 2020 203a 7061  refs.        :pa
+00016d00: 7261 6d20 636c 6173 7372 6566 5f69 6e64  ram classref_ind
+00016d10: 6578 3a20 6469 6374 696f 6e61 7279 206d  ex: dictionary m
+00016d20: 6170 7069 6e67 2063 6c61 7373 7265 6673  apping classrefs
+00016d30: 206f 6e74 6f20 6e6f 726d 616c 697a 6564   onto normalized
+00016d40: 2063 6c61 7373 7265 660a 2020 2020 2020   classref.      
+00016d50: 2020 3a72 6574 7572 6e3a 206c 6973 7420    :return: list 
+00016d60: 6f66 2072 6564 756e 6461 6e74 2063 6c61  of redundant cla
+00016d70: 7373 7265 6673 0a20 2020 2020 2020 2022  ssrefs.        "
+00016d80: 2222 0a20 2020 2020 2020 2072 6564 756e  "".        redun
+00016d90: 6461 6e74 5f63 6c61 7373 7265 6673 203d  dant_classrefs =
+00016da0: 205b 5d0a 2020 2020 2020 2020 666f 7220   [].        for 
+00016db0: 6974 656d 2069 6e20 636c 6173 7372 6566  item in classref
+00016dc0: 5f69 6e64 6578 2e69 7465 6d73 2829 3a0a  _index.items():.
+00016dd0: 2020 2020 2020 2020 2020 2020 6966 2069              if i
+00016de0: 7465 6d5b 305d 2021 3d20 6974 656d 5b31  tem[0] != item[1
+00016df0: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
+00016e00: 2020 2072 6564 756e 6461 6e74 5f63 6c61     redundant_cla
+00016e10: 7373 7265 6673 2e61 7070 656e 6428 6974  ssrefs.append(it
+00016e20: 656d 5b30 5d29 0a20 2020 2020 2020 2072  em[0]).        r
+00016e30: 6574 7572 6e20 7265 6475 6e64 616e 745f  eturn redundant_
+00016e40: 636c 6173 7372 6566 730a 0a20 2020 2023  classrefs..    #
+00016e50: 2063 6c61 7373 2048 746d 6c53 7479 6c65   class HtmlStyle
+00016e60: 0a0a 2020 2020 4063 6c61 7373 6d65 7468  ..    @classmeth
+00016e70: 6f64 0a20 2020 2064 6566 2063 7265 6174  od.    def creat
+00016e80: 655f 636c 6173 7372 6566 5f69 6e64 6578  e_classref_index
+00016e90: 2863 6c73 2c20 7374 796c 655f 746f 5f63  (cls, style_to_c
+00016ea0: 6c61 7373 7265 665f 7365 7429 3a0a 2020  lassref_set):.  
+00016eb0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00016ec0: 2020 6d61 7073 2061 6c6c 2069 7465 6d73    maps all items
+00016ed0: 2069 6e20 636c 6173 7372 6566 2073 6574   in classref set
+00016ee0: 7320 6f6e 746f 2028 6172 6269 7472 6172  s onto (arbitrar
+00016ef0: 696c 7929 2074 6865 2066 6972 7374 0a20  ily) the first. 
+00016f00: 2020 2020 2020 203a 7061 7261 6d20 7374         :param st
+00016f10: 796c 655f 746f 5f63 6c61 7373 7265 665f  yle_to_classref_
+00016f20: 7365 743a 2063 6c61 7373 7265 665f 7365  set: classref_se
+00016f30: 7473 206d 6d61 7070 6564 2062 7920 7374  ts mmapped by st
+00016f40: 796c 6520 7661 6c75 650a 2020 2020 2020  yle value.      
+00016f50: 2020 3a72 6574 7572 6e3a 6469 6374 206d    :return:dict m
+00016f60: 6170 7069 6e67 2072 6564 756e 6461 6e74  apping redundant
+00016f70: 2063 6c61 7373 7265 6673 206f 6e74 6f20   classrefs onto 
+00016f80: 6e6f 726d 616c 697a 6564 2063 6c61 7373  normalized class
+00016f90: 7265 660a 2020 2020 2020 2020 4d61 7920  ref.        May 
+00016fa0: 6265 6e65 6669 7420 6672 6f6d 2062 6569  benefit from bei
+00016fb0: 6e67 2069 6e20 6120 636c 6173 730a 2020  ng in a class.  
+00016fc0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00016fd0: 2020 636c 6173 7372 6566 5f69 6e64 6578    classref_index
+00016fe0: 203d 2064 6963 7428 290a 2020 2020 2020   = dict().      
+00016ff0: 2020 666f 7220 6974 656d 2069 6e20 7374    for item in st
+00017000: 796c 655f 746f 5f63 6c61 7373 7265 665f  yle_to_classref_
+00017010: 7365 742e 6974 656d 7328 293a 0a20 2020  set.items():.   
+00017020: 2020 2020 2020 2020 2063 6c61 7373 7265           classre
+00017030: 665f 6c69 7374 203d 206c 6973 7428 736f  f_list = list(so
+00017040: 7274 6564 2869 7465 6d5b 315d 2929 0a20  rted(item[1])). 
+00017050: 2020 2020 2020 2020 2020 2063 6c61 7373             class
+00017060: 7265 6630 203d 206c 6973 7428 636c 6173  ref0 = list(clas
+00017070: 7372 6566 5f6c 6973 7429 5b30 5d0a 2020  sref_list)[0].  
+00017080: 2020 2020 2020 2020 2020 666f 7220 636c            for cl
+00017090: 6173 7372 6566 2069 6e20 636c 6173 7372  assref in classr
+000170a0: 6566 5f6c 6973 743a 0a20 2020 2020 2020  ef_list:.       
+000170b0: 2020 2020 2020 2020 2063 6c61 7373 7265           classre
+000170c0: 665f 696e 6465 785b 636c 6173 7372 6566  f_index[classref
+000170d0: 5d20 3d20 636c 6173 7372 6566 300a 2020  ] = classref0.  
+000170e0: 2020 2020 2020 7265 7475 726e 2063 6c61        return cla
+000170f0: 7373 7265 665f 696e 6465 780a 0a20 2020  ssref_index..   
+00017100: 2023 2063 6c61 7373 2048 746d 6c53 7479   # class HtmlSty
+00017110: 6c65 0a0a 2020 2020 4063 6c61 7373 6d65  le..    @classme
+00017120: 7468 6f64 0a20 2020 2064 6566 2061 6464  thod.    def add
+00017130: 5f68 6561 645f 7374 796c 6573 5f6f 7269  _head_styles_ori
+00017140: 6728 636c 732c 2068 746d 6c5f 656c 656d  g(cls, html_elem
+00017150: 2c20 7374 796c 6573 2c20 6e6f 726d 616c  , styles, normal
+00017160: 697a 655f 666f 6e74 3d54 7275 6529 3a0a  ize_font=True):.
+00017170: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00017180: 2020 2020 7468 6973 2069 7320 6372 7564      this is crud
+00017190: 650a 2020 2020 2020 2020 2773 7479 6c65  e.        'style
+000171a0: 206f 6620 666f 726d 0a20 2020 2020 2020   of form.       
+000171b0: 2020 2020 2022 6469 7622 2c20 5b28 2262       "div", [("b
+000171c0: 6f72 6465 7222 2c20 2272 6564 2073 6f6c  order", "red sol
+000171d0: 6964 2030 2e35 7078 2229 2c20 2822 6261  id 0.5px"), ("ba
+000171e0: 636b 6772 6f75 6e64 222c 2022 7965 6c6c  ckground", "yell
+000171f0: 6f77 295d 290a 2020 2020 2020 2020 2222  ow)]).        ""
+00017200: 220a 2020 2020 2020 2020 666f 7220 7374  ".        for st
+00017210: 796c 6520 696e 2073 7479 6c65 733a 0a20  yle in styles:. 
+00017220: 2020 2020 2020 2020 2020 2023 2070 7269             # pri
+00017230: 6e74 2866 2273 7479 6c65 207b 7374 796c  nt(f"style {styl
+00017240: 657d 2229 0a20 2020 2020 2020 2020 2020  e}").           
+00017250: 2048 746d 6c4c 6962 2e61 6464 5f68 6561   HtmlLib.add_hea
+00017260: 645f 7374 796c 6528 6874 6d6c 5f65 6c65  d_style(html_ele
+00017270: 6d2c 2073 7479 6c65 5b30 5d2c 2073 7479  m, style[0], sty
+00017280: 6c65 5b31 5d29 0a0a 2020 2020 4063 6c61  le[1])..    @cla
+00017290: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
+000172a0: 2061 6464 5f68 6561 645f 7374 796c 6573   add_head_styles
+000172b0: 2863 6c73 2c20 6874 6d6c 5f65 6c65 6d2c  (cls, html_elem,
+000172c0: 2073 7479 6c65 5f74 6578 7473 2c20 6e6f   style_texts, no
+000172d0: 726d 616c 697a 655f 666f 6e74 3d54 7275  rmalize_font=Tru
+000172e0: 6529 3a0a 2020 2020 2020 2020 2222 220a  e):.        """.
+000172f0: 2020 2020 2020 2020 6164 6473 2074 6578          adds tex
+00017300: 7420 6f66 2066 6f72 6d0a 2020 2020 2020  t of form.      
+00017310: 2020 6c6f 6361 746f 7220 6373 730a 2020    locator css.  
+00017320: 2020 2020 2020 652e 672e 2073 7061 6e2e        e.g. span.
+00017330: 7465 6d70 207b 6261 636b 6772 6f75 6e64  temp {background
+00017340: 3a20 7265 643b 2066 6f6e 742d 7369 7a65  : red; font-size
+00017350: 3a20 3132 7078 3b7d 0a20 2020 2020 2020  : 12px;}.       
+00017360: 2022 2222 0a20 2020 2020 2020 2068 746d   """.        htm
+00017370: 6c5f 6865 6164 203d 2048 746d 6c4c 6962  l_head = HtmlLib
+00017380: 2e67 6574 5f68 6561 6428 6874 6d6c 5f65  .get_head(html_e
+00017390: 6c65 6d29 0a20 2020 2020 2020 2066 6f72  lem).        for
+000173a0: 2073 7479 6c65 5f74 2069 6e20 7374 796c   style_t in styl
+000173b0: 655f 7465 7874 733a 0a20 2020 2020 2020  e_texts:.       
+000173c0: 2020 2020 2073 7479 6c65 203d 2045 542e       style = ET.
+000173d0: 5375 6245 6c65 6d65 6e74 2868 746d 6c5f  SubElement(html_
+000173e0: 6865 6164 2c20 2273 7479 6c65 2229 0a20  head, "style"). 
+000173f0: 2020 2020 2020 2020 2020 2073 7479 6c65             style
+00017400: 2e74 6578 7420 3d20 7374 796c 655f 740a  .text = style_t.
+00017410: 0a20 2020 2023 2054 4f44 4f0a 2020 2020  .    # TODO.    
+00017420: 2320 6372 6561 7465 5f66 6f6e 745f 6564  # create_font_ed
+00017430: 6974 6564 5f73 7479 6c65 5f66 726f 6d5f  ited_style_from_
+00017440: 6373 735f 7374 796c 655f 6f62 6a65 6374  css_style_object
+00017450: 0a0a 2020 2020 4063 6c61 7373 6d65 7468  ..    @classmeth
+00017460: 6f64 0a20 2020 2064 6566 2074 7261 6e73  od.    def trans
+00017470: 6665 725f 6865 6164 5f73 7479 6c65 7328  fer_head_styles(
+00017480: 636c 732c 2068 746d 6c5f 656c 656d 2c20  cls, html_elem, 
+00017490: 6e65 775f 6874 6d6c 293a 0a20 2020 2020  new_html):.     
+000174a0: 2020 2022 2222 636f 7069 6573 2068 746d     """copies htm
+000174b0: 6c2f 6865 6164 2f22 2222 0a20 2020 2020  l/head/""".     
+000174c0: 2020 206e 6577 5f73 7479 6c65 5f65 6c65     new_style_ele
+000174d0: 6d20 3d20 4874 6d6c 4772 6f75 702e 6372  m = HtmlGroup.cr
+000174e0: 6561 7465 5f68 6561 645f 7374 796c 655f  eate_head_style_
+000174f0: 656c 656d 286e 6577 5f68 746d 6c2c 2074  elem(new_html, t
+00017500: 6169 6c3d 225c 6e22 290a 2020 2020 2020  ail="\n").      
+00017510: 2020 7374 796c 6573 203d 2048 746d 6c53    styles = HtmlS
+00017520: 7479 6c65 2e67 6574 5f68 6561 645f 7374  tyle.get_head_st
+00017530: 796c 6573 2868 746d 6c5f 656c 656d 290a  yles(html_elem).
+00017540: 2020 2020 2020 2020 666f 7220 7374 796c          for styl
+00017550: 6520 696e 2073 7479 6c65 733a 0a20 2020  e in styles:.   
+00017560: 2020 2020 2020 2020 206e 6577 5f73 7479           new_sty
+00017570: 6c65 5f65 6c65 6d2e 6765 7470 6172 656e  le_elem.getparen
+00017580: 7428 292e 6170 7065 6e64 2863 6f70 792e  t().append(copy.
+00017590: 6465 6570 636f 7079 2873 7479 6c65 2929  deepcopy(style))
+000175a0: 0a0a 2020 2020 4063 6c61 7373 6d65 7468  ..    @classmeth
+000175b0: 6f64 0a20 2020 2064 6566 2065 7874 7261  od.    def extra
+000175c0: 6374 5f63 6c61 7373 7265 665f 616e 645f  ct_classref_and_
+000175d0: 6373 7373 7472 696e 675f 6672 6f6d 5f68  cssstring_from_h
+000175e0: 746d 6c5f 7374 796c 6528 636c 732c 2068  tml_style(cls, h
+000175f0: 746d 6c5f 7374 796c 655f 656c 656d 293a  tml_style_elem):
+00017600: 0a20 2020 2020 2020 2069 6620 6874 6d6c  .        if html
+00017610: 5f73 7479 6c65 5f65 6c65 6d20 6973 204e  _style_elem is N
+00017620: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+00017630: 2072 6574 7572 6e20 4e6f 6e65 2c20 4e6f   return None, No
+00017640: 6e65 0a20 2020 2020 2020 2072 6574 7572  ne.        retur
+00017650: 6e20 636c 732e 6578 7472 6163 745f 636c  n cls.extract_cl
+00017660: 6173 7372 6566 5f61 6e64 5f63 7373 7374  assref_and_cssst
+00017670: 7269 6e67 5f66 726f 6d5f 7374 796c 655f  ring_from_style_
+00017680: 7465 7874 2868 746d 6c5f 7374 796c 655f  text(html_style_
+00017690: 656c 656d 2e74 6578 7429 0a0a 2020 2020  elem.text)..    
+000176a0: 4063 6c61 7373 6d65 7468 6f64 0a20 2020  @classmethod.   
+000176b0: 2064 6566 2063 7265 6174 655f 636c 6173   def create_clas
+000176c0: 7372 6566 5f63 7373 7374 7269 6e67 5f74  sref_cssstring_t
+000176d0: 6162 6c65 2863 6c73 2c20 6874 6d6c 5f73  able(cls, html_s
+000176e0: 7479 6c65 7329 3a0a 2020 2020 2020 2020  tyles):.        
+000176f0: 7461 626c 6520 3d20 5b5d 0a20 2020 2020  table = [].     
+00017700: 2020 2066 6f72 2068 746d 6c5f 7374 796c     for html_styl
+00017710: 6520 696e 2068 746d 6c5f 7374 796c 6573  e in html_styles
+00017720: 3a0a 2020 2020 2020 2020 2020 2020 7461  :.            ta
+00017730: 626c 652e 6170 7065 6e64 2848 746d 6c53  ble.append(HtmlS
+00017740: 7479 6c65 2e65 7874 7261 6374 5f63 6c61  tyle.extract_cla
+00017750: 7373 7265 665f 616e 645f 6373 7373 7472  ssref_and_cssstr
+00017760: 696e 675f 6672 6f6d 5f68 746d 6c5f 7374  ing_from_html_st
+00017770: 796c 6528 6874 6d6c 5f73 7479 6c65 2929  yle(html_style))
+00017780: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00017790: 7461 626c 650a 0a20 2020 2040 636c 6173  table..    @clas
+000177a0: 736d 6574 686f 640a 2020 2020 6465 6620  smethod.    def 
+000177b0: 7265 706c 6163 655f 6375 726c 7928 636c  replace_curly(cl
+000177c0: 732c 2065 6c65 6d2c 206e 6577 5f63 7572  s, elem, new_cur
+000177d0: 6c79 293a 0a20 2020 2020 2020 2022 2222  ly):.        """
+000177e0: 0a20 2020 2020 2020 2072 6570 6c61 6365  .        replace
+000177f0: 2063 6f6e 7465 6e74 7320 6f66 207b 2e2e   contents of {..
+00017800: 2e7d 0a20 2020 2020 2020 203a 7061 7261  .}.        :para
+00017810: 6d20 656c 656d 3a20 6874 6d6c 203c 7374  m elem: html <st
+00017820: 796c 653e 2065 6c65 6d65 6e74 0a20 2020  yle> element.   
+00017830: 2020 2020 203a 7061 7261 6d20 656c 656d       :param elem
+00017840: 3a20 6e65 7720 636f 6e74 656e 740a 2020  : new content.  
+00017850: 2020 2020 2020 2222 220a 0a20 2020 2020        """..     
+00017860: 2020 2069 6620 656c 656d 2069 7320 6e6f     if elem is no
+00017870: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+00017880: 2020 2020 6d61 7463 6820 3d20 5354 594c      match = STYL
+00017890: 455f 4355 524c 595f 5245 2e6d 6174 6368  E_CURLY_RE.match
+000178a0: 2865 6c65 6d2e 7465 7874 290a 2020 2020  (elem.text).    
+000178b0: 2020 2020 2020 2020 6966 206d 6174 6368          if match
+000178c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000178d0: 2020 6e65 775f 7465 7874 203d 206d 6174    new_text = mat
+000178e0: 6368 2e67 726f 7570 2822 7072 6522 2920  ch.group("pre") 
+000178f0: 2b20 6e65 775f 6375 726c 7920 2b20 6d61  + new_curly + ma
+00017900: 7463 682e 6772 6f75 7028 2270 6f73 7422  tch.group("post"
+00017910: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00017920: 2020 656c 656d 2e74 6578 7420 3d20 6e65    elem.text = ne
+00017930: 775f 7465 7874 0a0a 2020 2020 4063 6c61  w_text..    @cla
+00017940: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
+00017950: 206c 6f6f 6b75 705f 6865 6164 5f73 7479   lookup_head_sty
+00017960: 6c65 5f62 795f 636c 6173 7372 6566 2863  le_by_classref(c
+00017970: 6c73 2c20 656c 656d 293a 0a20 2020 2020  ls, elem):.     
+00017980: 2020 2022 2222 0a20 2020 2020 2020 203a     """.        :
+00017990: 7061 7261 6d20 656c 656d 3a20 656c 656d  param elem: elem
+000179a0: 656e 7473 2077 6974 6820 4063 6c61 7373  ents with @class
+000179b0: 2061 7474 7269 6275 7465 0a20 2020 2020   attribute.     
+000179c0: 2020 203a 7265 7475 726e 3a20 4353 5353     :return: CSSS
+000179d0: 7479 6c65 206f 626a 6563 7420 7769 7468  tyle object with
+000179e0: 2048 746d 6c53 7479 6c65 0a20 2020 2020   HtmlStyle.     
+000179f0: 2020 2022 2222 0a20 2020 2020 2020 2063     """.        c
+00017a00: 6c61 7a7a 203d 2065 6c65 6d2e 6765 7428  lazz = elem.get(
+00017a10: 2263 6c61 7373 2229 0a20 2020 2020 2020  "class").       
+00017a20: 2063 7373 5f73 7479 6c65 203d 2048 746d   css_style = Htm
+00017a30: 6c53 7479 6c65 2e6c 6f6f 6b75 705f 6865  lStyle.lookup_he
+00017a40: 6164 5f73 7479 6c65 5f62 795f 636c 6173  ad_style_by_clas
+00017a50: 7328 656c 656d 2c20 636c 617a 7a29 0a20  s(elem, clazz). 
+00017a60: 2020 2020 2020 2072 6574 7572 6e20 6373         return cs
+00017a70: 735f 7374 796c 650a 0a20 2020 2040 636c  s_style..    @cl
+00017a80: 6173 736d 6574 686f 640a 2020 2020 6465  assmethod.    de
+00017a90: 6620 6c6f 6f6b 7570 5f68 6561 645f 7374  f lookup_head_st
+00017aa0: 796c 655f 6279 5f63 6c61 7373 2863 6c73  yle_by_class(cls
+00017ab0: 2c20 6874 6d6c 2c20 636c 617a 7a29 3a0a  , html, clazz):.
+00017ac0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00017ad0: 2020 2020 3a70 6172 616d 2068 746d 6c3a      :param html:
+00017ae0: 2048 544d 4c20 656c 656d 656e 7420 7769   HTML element wi
+00017af0: 7468 2068 6561 642f 7374 796c 650a 2020  th head/style.  
+00017b00: 2020 2020 2020 3a70 6172 616d 2063 6c61        :param cla
+00017b10: 7a7a 3a20 636c 6173 7320 746f 2072 6574  zz: class to ret
+00017b20: 6972 7665 2073 7479 6c65 2065 6c65 6d65  irve style eleme
+00017b30: 6e74 0a20 2020 2020 2020 2022 2222 0a20  nt.        """. 
+00017b40: 2020 2020 2020 2073 7479 6c65 7320 3d20         styles = 
+00017b50: 6874 6d6c 2e78 7061 7468 2866 222f 6874  html.xpath(f"/ht
+00017b60: 6d6c 2f68 6561 642f 7374 796c 655b 636f  ml/head/style[co
+00017b70: 6e74 6169 6e73 282e 2c27 2e7b 636c 617a  ntains(.,'.{claz
+00017b80: 7a7d 2027 295d 2229 0a20 2020 2020 2020  z} ')]").       
+00017b90: 2069 6620 6c65 6e28 7374 796c 6573 2920   if len(styles) 
+00017ba0: 3d3d 2030 3a0a 2020 2020 2020 2020 2020  == 0:.          
+00017bb0: 2020 7072 696e 7428 6622 6e6f 2073 7479    print(f"no sty
+00017bc0: 6c65 7320 666f 7220 7b63 6c61 7a7a 7d22  les for {clazz}"
+00017bd0: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
+00017be0: 7475 726e 204e 6f6e 650a 2020 2020 2020  turn None.      
+00017bf0: 2020 6865 6164 5f73 7479 6c65 203d 2073    head_style = s
+00017c00: 7479 6c65 735b 305d 0a20 2020 2020 2020  tyles[0].       
+00017c10: 205f 2c20 6373 735f 7374 796c 6520 3d20   _, css_style = 
+00017c20: 4353 5353 7479 6c65 2e63 7265 6174 655f  CSSStyle.create_
+00017c30: 6373 735f 7374 796c 655f 6672 6f6d 5f68  css_style_from_h
+00017c40: 746d 6c5f 6865 6164 5f73 7479 6c65 5f65  tml_head_style_e
+00017c50: 6c65 6d28 6865 6164 5f73 7479 6c65 290a  lem(head_style).
+00017c60: 2020 2020 2020 2020 7265 7475 726e 2063          return c
+00017c70: 7373 5f73 7479 6c65 0a0a 2020 2020 4063  ss_style..    @c
+00017c80: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
+00017c90: 6566 2069 735f 626f 6c64 2863 6c73 2c20  ef is_bold(cls, 
+00017ca0: 656c 656d 293a 0a20 2020 2020 2020 2022  elem):.        "
+00017cb0: 2222 0a20 2020 2020 2020 2066 696e 6473  "".        finds
+00017cc0: 2040 636c 6173 7320 696e 2065 6c65 6d20   @class in elem 
+00017cd0: 616e 6420 6c6f 6f6b 7320 7570 2073 7479  and looks up sty
+00017ce0: 6c65 2069 6e20 6874 6d6c 2f68 6561 640a  le in html/head.
+00017cf0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00017d00: 2020 2020 6966 2065 6c65 6d20 6973 204e      if elem is N
+00017d10: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+00017d20: 2072 6574 7572 6e20 4661 6c73 650a 2020   return False.  
+00017d30: 2020 2020 2020 6373 735f 7374 796c 6520        css_style 
+00017d40: 3d20 4874 6d6c 5374 796c 652e 6c6f 6f6b  = HtmlStyle.look
+00017d50: 7570 5f68 6561 645f 7374 796c 655f 6279  up_head_style_by
+00017d60: 5f63 6c61 7373 7265 6628 656c 656d 290a  _classref(elem).
+00017d70: 2020 2020 2020 2020 6966 206e 6f74 2063          if not c
+00017d80: 7373 5f73 7479 6c65 3a0a 2020 2020 2020  ss_style:.      
+00017d90: 2020 2020 2020 7072 696e 7428 6622 6e6f        print(f"no
+00017da0: 2073 7479 6c65 2072 6573 6f6c 7665 6420   style resolved 
+00017db0: 666f 7220 7b45 542e 746f 7374 7269 6e67  for {ET.tostring
+00017dc0: 2865 6c65 6d29 7d22 290a 2020 2020 2020  (elem)}").      
+00017dd0: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
+00017de0: 7365 0a20 2020 2020 2020 2072 6574 7572  se.        retur
+00017df0: 6e20 6373 735f 7374 796c 652e 6973 5f62  n css_style.is_b
+00017e00: 6f6c 640a 0a20 2020 2040 636c 6173 736d  old..    @classm
+00017e10: 6574 686f 640a 2020 2020 6465 6620 6973  ethod.    def is
+00017e20: 5f69 7461 6c69 6328 636c 732c 2065 6c65  _italic(cls, ele
+00017e30: 6d29 3a0a 2020 2020 2020 2020 2222 220a  m):.        """.
+00017e40: 2020 2020 2020 2020 6669 6e64 7320 4063          finds @c
+00017e50: 6c61 7373 2069 6e20 656c 656d 2061 6e64  lass in elem and
+00017e60: 206c 6f6f 6b73 2075 7020 7374 796c 6520   looks up style 
+00017e70: 696e 2068 746d 6c2f 6865 6164 0a20 2020  in html/head.   
+00017e80: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00017e90: 2069 6620 656c 656d 2069 7320 4e6f 6e65   if elem is None
+00017ea0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+00017eb0: 7475 726e 2046 616c 7365 0a20 2020 2020  turn False.     
+00017ec0: 2020 2063 7373 5f73 7479 6c65 203d 2048     css_style = H
+00017ed0: 746d 6c53 7479 6c65 2e6c 6f6f 6b75 705f  tmlStyle.lookup_
+00017ee0: 6865 6164 5f73 7479 6c65 5f62 795f 636c  head_style_by_cl
+00017ef0: 6173 7372 6566 2865 6c65 6d29 0a20 2020  assref(elem).   
+00017f00: 2020 2020 2069 6620 6e6f 7420 6373 735f       if not css_
+00017f10: 7374 796c 653a 0a20 2020 2020 2020 2020  style:.         
+00017f20: 2020 2070 7269 6e74 2866 226e 6f20 7374     print(f"no st
+00017f30: 796c 6520 7265 736f 6c76 6564 2066 6f72  yle resolved for
+00017f40: 207b 4554 2e74 6f73 7472 696e 6728 656c   {ET.tostring(el
+00017f50: 656d 297d 2229 0a20 2020 2020 2020 2020  em)}").         
+00017f60: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
+00017f70: 2020 2020 2020 2020 7265 7475 726e 2063          return c
+00017f80: 7373 5f73 7479 6c65 2e69 735f 6974 616c  ss_style.is_ital
+00017f90: 6963 0a0a 2020 2020 4063 6c61 7373 6d65  ic..    @classme
+00017fa0: 7468 6f64 0a20 2020 2064 6566 2067 6574  thod.    def get
+00017fb0: 5f62 6f64 795f 636c 6173 7372 6566 7328  _body_classrefs(
+00017fc0: 636c 732c 2068 746d 6c5f 656c 656d 293a  cls, html_elem):
+00017fd0: 0a20 2020 2020 2020 2022 2222 7365 6172  .        """sear
+00017fe0: 6368 6573 2061 6c6c 2062 6f64 7920 656c  ches all body el
+00017ff0: 656d 656e 7473 2066 6f72 2040 636c 6173  ements for @clas
+00018000: 7320 6174 7472 6962 7574 6573 0a20 2020  s attributes.   
+00018010: 2020 2020 203a 7061 7261 6d20 6874 6d6c       :param html
+00018020: 5f65 6c65 6d3a 2068 746d 6c20 656c 656d  _elem: html elem
+00018030: 656e 740a 2020 2020 2020 2020 3a72 6574  ent.        :ret
+00018040: 7572 6e3a 2061 6c6c 2062 6f64 7920 656c  urn: all body el
+00018050: 656d 656e 7473 2077 6974 6820 4063 6c61  ements with @cla
+00018060: 7373 2061 7474 7269 6275 7465 730a 2020  ss attributes.  
+00018070: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00018080: 2020 626f 6479 203d 2048 746d 6c4c 6962    body = HtmlLib
+00018090: 2e67 6574 5f62 6f64 7928 6874 6d6c 5f65  .get_body(html_e
+000180a0: 6c65 6d29 0a20 2020 2020 2020 2072 6574  lem).        ret
+000180b0: 7572 6e20 5b5d 2069 6620 626f 6479 2069  urn [] if body i
+000180c0: 7320 4e6f 6e65 2065 6c73 6520 626f 6479  s None else body
+000180d0: 2e78 7061 7468 2822 2e2f 2f2a 5b40 636c  .xpath(".//*[@cl
+000180e0: 6173 735d 2229 0a0a 2020 2020 4063 6c61  ass]")..    @cla
+000180f0: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
+00018100: 2063 7265 6174 655f 6162 6272 6576 6961   create_abbrevia
+00018110: 7465 645f 666f 6e74 5f73 7479 6c65 7328  ted_font_styles(
+00018120: 636c 732c 2068 746d 6c5f 656c 656d 293a  cls, html_elem):
+00018130: 0a20 2020 2020 2020 2022 2222 6372 6561  .        """crea
+00018140: 7465 7320 7265 6164 6162 6c65 2073 7479  tes readable sty
+00018150: 6c65 6e61 6d65 730a 2020 2020 2020 2020  lenames.        
+00018160: 2e73 3020 7b66 6f6e 742d 6661 6d69 6c79  .s0 {font-family
+00018170: 3a20 5469 6d65 734e 6577 526f 6d61 6e50  : TimesNewRomanP
+00018180: 534d 543b 2066 6f6e 742d 7369 7a65 3a20  SMT; font-size: 
+00018190: 3132 2e30 3b20 666f 6e74 2d77 6569 6768  12.0; font-weigh
+000181a0: 743a 2062 6f6c 643b 2066 6f6e 742d 6e61  t: bold; font-na
+000181b0: 6d65 3a20 5469 6d65 734e 6577 526f 6d61  me: TimesNewRoma
+000181c0: 6e50 534d 543b 0a20 2020 2020 2020 2069  nPSMT;.        i
+000181d0: 7320 7472 616e 7366 6f72 6d65 6420 746f  s transformed to
+000181e0: 0a20 2020 2020 2020 202e 7469 6d65 736e  .        .timesn
+000181f0: 6577 726f 6d61 6e70 736d 745f 3132 7e30  ewromanpsmt_12~0
+00018200: 5f62 6f6c 640a 2020 2020 2020 2020 2222  _bold.        ""
+00018210: 220a 2020 2020 2020 2020 7374 796c 655f  ".        style_
+00018220: 636f 6e76 6572 7465 7220 3d20 636c 732e  converter = cls.
+00018230: 6372 6561 7465 5f73 7479 6c65 5f63 6f6e  create_style_con
+00018240: 7665 7274 6572 2868 746d 6c5f 656c 656d  verter(html_elem
+00018250: 290a 2020 2020 2020 2020 7374 796c 6564  ).        styled
+00018260: 5f65 6c65 6d73 203d 2068 746d 6c5f 656c  _elems = html_el
+00018270: 656d 2e78 7061 7468 2822 2e2f 2f2a 5b40  em.xpath(".//*[@
+00018280: 636c 6173 735d 2229 0a20 2020 2020 2020  class]").       
+00018290: 2066 6f72 2065 6c65 6d20 696e 2073 7479   for elem in sty
+000182a0: 6c65 645f 656c 656d 733a 0a20 2020 2020  led_elems:.     
+000182b0: 2020 2020 2020 2063 6c61 7a7a 203d 2065         clazz = e
+000182c0: 6c65 6d2e 6174 7472 6962 5b22 636c 6173  lem.attrib["clas
+000182d0: 7322 5d0a 2020 2020 2020 2020 2020 2020  s"].            
+000182e0: 6e65 775f 636c 6173 7320 3d20 7374 796c  new_class = styl
+000182f0: 655f 636f 6e76 6572 7465 722e 6765 7428  e_converter.get(
+00018300: 636c 617a 7a29 0a20 2020 2020 2020 2020  clazz).         
+00018310: 2020 2069 6620 6e65 775f 636c 6173 7320     if new_class 
+00018320: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+00018330: 2020 2020 2020 2020 2070 7269 6e74 2866           print(f
+00018340: 2263 616e 6e6f 7420 6669 6e64 2072 6570  "cannot find rep
+00018350: 6c61 6365 2066 6f72 207b 636c 617a 7a7d  lace for {clazz}
+00018360: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+00018370: 2020 2063 6f6e 7469 6e75 650a 2020 2020     continue.    
+00018380: 2020 2020 2020 2020 6874 6d6c 5f63 6c61          html_cla
+00018390: 7373 203d 2048 746d 6c43 6c61 7373 2863  ss = HtmlClass(c
+000183a0: 6c61 7a7a 290a 2020 2020 2020 2020 2020  lazz).          
+000183b0: 2020 6874 6d6c 5f63 6c61 7373 2e72 6570    html_class.rep
+000183c0: 6c61 6365 5f63 6c61 7373 2863 6c61 7a7a  lace_class(clazz
+000183d0: 2c20 6e65 775f 636c 6173 7329 0a20 2020  , new_class).   
+000183e0: 2020 2020 2020 2020 2065 6c65 6d2e 6174           elem.at
+000183f0: 7472 6962 5b22 636c 6173 7322 5d20 3d20  trib["class"] = 
+00018400: 6e65 775f 636c 6173 730a 2020 2020 2020  new_class.      
+00018410: 2020 2020 2020 2320 7072 696e 7428 6622        # print(f"
+00018420: 7265 706c 6163 6564 207b 636c 617a 7a7d  replaced {clazz}
+00018430: 2062 7920 7b6e 6577 5f63 6c61 7373 7d22   by {new_class}"
+00018440: 290a 0a20 2020 2040 636c 6173 736d 6574  )..    @classmet
+00018450: 686f 640a 2020 2020 6465 6620 6372 6561  hod.    def crea
+00018460: 7465 5f73 7479 6c65 5f63 6f6e 7665 7274  te_style_convert
+00018470: 6572 2863 6c73 2c20 6874 6d6c 5f65 6c65  er(cls, html_ele
+00018480: 6d29 3a0a 2020 2020 2020 2020 7374 796c  m):.        styl
+00018490: 6573 203d 2048 746d 6c53 7479 6c65 2e67  es = HtmlStyle.g
+000184a0: 6574 5f68 6561 645f 7374 796c 6573 2868  et_head_styles(h
+000184b0: 746d 6c5f 656c 656d 290a 2020 2020 2020  tml_elem).      
+000184c0: 2020 7374 796c 655f 636f 6e76 6572 7465    style_converte
+000184d0: 7220 3d20 6469 6374 2829 0a20 2020 2020  r = dict().     
+000184e0: 2020 2066 6f72 2073 7479 6c65 2069 6e20     for style in 
+000184f0: 7374 796c 6573 3a0a 2020 2020 2020 2020  styles:.        
+00018500: 2020 2020 646f 745f 7374 796c 652c 2063      dot_style, c
+00018510: 7373 203d 2048 746d 6c53 7479 6c65 2e65  ss = HtmlStyle.e
+00018520: 7874 7261 6374 5f63 6c61 7373 7265 665f  xtract_classref_
+00018530: 616e 645f 6373 7373 7472 696e 675f 6672  and_cssstring_fr
+00018540: 6f6d 5f68 746d 6c5f 7374 796c 6528 7374  om_html_style(st
+00018550: 796c 6529 0a20 2020 2020 2020 2020 2020  yle).           
+00018560: 2023 2070 7269 6e74 2866 227b 646f 745f   # print(f"{dot_
+00018570: 7374 796c 657d 207b 6373 737d 2229 0a20  style} {css}"). 
+00018580: 2020 2020 2020 2020 2020 2063 7373 5f73             css_s
+00018590: 7479 6c65 203d 2043 5353 5374 796c 652e  tyle = CSSStyle.
+000185a0: 6372 6561 7465 5f63 7373 5f73 7479 6c65  create_css_style
+000185b0: 5f66 726f 6d5f 6373 735f 7374 7269 6e67  _from_css_string
+000185c0: 2863 7373 290a 2020 2020 2020 2020 2020  (css).          
+000185d0: 2020 2320 7072 696e 7428 0a20 2020 2020    # print(.     
+000185e0: 2020 2020 2020 2023 2020 2020 2066 2266         #     f"f
+000185f0: 6f6e 743a 207b 6373 735f 7374 796c 652e  ont: {css_style.
+00018600: 666f 6e74 5f66 616d 696c 797d 2073 697a  font_family} siz
+00018610: 6520 7b63 7373 5f73 7479 6c65 2e66 6f6e  e {css_style.fon
+00018620: 745f 7369 7a65 7d20 626f 6c64 207b 6373  t_size} bold {cs
+00018630: 735f 7374 796c 652e 6973 5f62 6f6c 647d  s_style.is_bold}
+00018640: 2069 7461 6c69 6320 7b63 7373 5f73 7479   italic {css_sty
+00018650: 6c65 2e69 735f 6974 616c 6963 7d22 290a  le.is_italic}").
+00018660: 2020 2020 2020 2020 2020 2020 635f 7374              c_st
+00018670: 796c 6520 3d20 2222 0a20 2020 2020 2020  yle = "".       
+00018680: 2020 2020 2069 6620 6373 735f 7374 796c       if css_styl
+00018690: 652e 666f 6e74 5f66 616d 696c 793a 0a20  e.font_family:. 
+000186a0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+000186b0: 5f73 7479 6c65 202b 3d20 6373 735f 7374  _style += css_st
+000186c0: 796c 652e 666f 6e74 5f66 616d 696c 792e  yle.font_family.
+000186d0: 6c6f 7765 7228 290a 2020 2020 2020 2020  lower().        
+000186e0: 2020 2020 6966 2063 7373 5f73 7479 6c65      if css_style
+000186f0: 2e66 6f6e 745f 7369 7a65 3a0a 2020 2020  .font_size:.    
+00018700: 2020 2020 2020 2020 2020 2020 635f 7374              c_st
+00018710: 796c 6520 2b3d 2022 5f22 202b 2073 7472  yle += "_" + str
+00018720: 2863 7373 5f73 7479 6c65 2e66 6f6e 745f  (css_style.font_
+00018730: 7369 7a65 292e 7265 706c 6163 6528 222e  size).replace(".
+00018740: 222c 2022 5f22 290a 2020 2020 2020 2020  ", "_").        
+00018750: 2020 2020 6966 2063 7373 5f73 7479 6c65      if css_style
+00018760: 2e69 735f 626f 6c64 3a0a 2020 2020 2020  .is_bold:.      
+00018770: 2020 2020 2020 2020 2020 635f 7374 796c            c_styl
+00018780: 6520 2b3d 2022 5f22 202b 2022 6222 0a20  e += "_" + "b". 
+00018790: 2020 2020 2020 2020 2020 2069 6620 6373             if cs
+000187a0: 735f 7374 796c 652e 6973 5f69 7461 6c69  s_style.is_itali
+000187b0: 633a 0a20 2020 2020 2020 2020 2020 2020  c:.             
+000187c0: 2020 2063 5f73 7479 6c65 202b 3d20 225f     c_style += "_
+000187d0: 2220 2b20 2269 220a 2020 2020 2020 2020  " + "i".        
+000187e0: 2020 2020 6966 2063 5f73 7479 6c65 2e73      if c_style.s
+000187f0: 7461 7274 7377 6974 6828 225f 2229 3a0a  tartswith("_"):.
+00018800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018810: 635f 7374 796c 6520 3d20 635f 7374 796c  c_style = c_styl
+00018820: 655b 313a 5d0a 2020 2020 2020 2020 2020  e[1:].          
+00018830: 2020 2320 7072 696e 7428 6622 635f 7374    # print(f"c_st
+00018840: 796c 6520 7b63 5f73 7479 6c65 7d22 290a  yle {c_style}").
+00018850: 2020 2020 2020 2020 2020 2020 6966 2063              if c
+00018860: 5f73 7479 6c65 2021 3d20 2222 3a0a 2020  _style != "":.  
+00018870: 2020 2020 2020 2020 2020 2020 2020 7374                st
+00018880: 796c 655f 636f 6e76 6572 7465 725b 646f  yle_converter[do
+00018890: 745f 7374 796c 655b 313a 5d5d 203d 2063  t_style[1:]] = c
+000188a0: 5f73 7479 6c65 0a20 2020 2020 2020 2020  _style.         
+000188b0: 2020 2020 2020 2063 6c73 2e73 6574 5f63         cls.set_c
+000188c0: 6c61 7373 7265 665f 616e 645f 6373 7328  lassref_and_css(
+000188d0: 7374 796c 652c 2063 5f73 7479 6c65 2c20  style, c_style, 
+000188e0: 6373 7329 0a0a 2020 2020 2020 2020 7265  css)..        re
+000188f0: 7475 726e 2073 7479 6c65 5f63 6f6e 7665  turn style_conve
+00018900: 7274 6572 0a0a 2020 2020 4063 6c61 7373  rter..    @class
+00018910: 6d65 7468 6f64 0a20 2020 2064 6566 2073  method.    def s
+00018920: 6574 5f63 6c61 7373 7265 665f 616e 645f  et_classref_and_
+00018930: 6373 7328 636c 732c 2073 7479 6c65 5f65  css(cls, style_e
+00018940: 6c65 6d2c 2063 5f73 7479 6c65 2c20 6373  lem, c_style, cs
+00018950: 7329 3a0a 2020 2020 2020 2020 7374 796c  s):.        styl
+00018960: 655f 656c 656d 2e61 7474 7269 625b 2263  e_elem.attrib["c
+00018970: 6c61 7373 7265 6622 5d20 3d20 222e 2220  lassref"] = "." 
+00018980: 2b20 635f 7374 796c 650a 2020 2020 2020  + c_style.      
+00018990: 2020 7374 796c 655f 656c 656d 2e74 6578    style_elem.tex
+000189a0: 7420 3d20 222e 2220 2b20 635f 7374 796c  t = "." + c_styl
+000189b0: 6520 2b20 2220 7b22 202b 2063 7373 202b  e + " {" + css +
+000189c0: 2022 7d22 0a0a 0a63 6c61 7373 2048 746d   "}"...class Htm
+000189d0: 6c43 6c61 7373 3a0a 2020 2020 2222 220a  lClass:.    """.
+000189e0: 2020 2020 6d65 7468 6f64 7320 746f 2070      methods to p
+000189f0: 726f 6365 7373 2063 6c61 7373 202a 6174  rocess class *at
+00018a00: 7472 6962 7574 6573 2a20 6f6e 2048 544d  tributes* on HTM
+00018a10: 4c20 656c 656d 6e74 7320 616e 6420 7379  L elemnts and sy
+00018a20: 6e63 2077 6974 6820 7374 796c 650a 2020  nc with style.  
+00018a30: 2020 496e 6974 6961 6c6c 7920 6d61 696e    Initially main
+00018a40: 6c79 2040 636c 6173 736d 6574 686f 6420  ly @classmethod 
+00018a50: 6275 7420 6164 6469 6e67 2069 6e73 7461  but adding insta
+00018a60: 6d63 6573 2074 6f20 6d61 6e61 6765 2065  mces to manage e
+00018a70: 6469 7469 6e67 0a20 2020 2074 6865 2040  diting.    the @
+00018a80: 636c 6173 7320 6174 7472 6962 7574 650a  class attribute.
+00018a90: 2020 2020 2222 220a 0a20 2020 2064 6566      """..    def
+00018aa0: 205f 5f69 6e69 745f 5f28 7365 6c66 2c20   __init__(self, 
+00018ab0: 636c 6173 7373 7472 3d4e 6f6e 6529 3a0a  classstr=None):.
+00018ac0: 0a20 2020 2020 2020 2073 656c 662e 636c  .        self.cl
+00018ad0: 6173 7365 7320 3d20 7365 7428 290a 2020  asses = set().  
+00018ae0: 2020 2020 2020 6966 2063 6c61 7373 7374        if classst
+00018af0: 723a 0a20 2020 2020 2020 2020 2020 2069  r:.            i
+00018b00: 6620 7479 7065 2863 6c61 7373 7374 7229  f type(classstr)
+00018b10: 2069 7320 7374 723a 0a20 2020 2020 2020   is str:.       
+00018b20: 2020 2020 2020 2020 2073 656c 662e 636c           self.cl
+00018b30: 6173 7365 732e 7570 6461 7465 2863 6c61  asses.update(cla
+00018b40: 7373 7374 722e 7370 6c69 7428 2929 0a20  ssstr.split()). 
+00018b50: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00018b60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00018b70: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
+00018b80: 7228 6622 6361 6e20 6f6e 6c79 2063 7265  r(f"can only cre
+00018b90: 6174 6520 4874 6d6c 436c 6173 7320 6672  ate HtmlClass fr
+00018ba0: 6f6d 2073 7472 696e 6773 2c20 666f 756e  om strings, foun
+00018bb0: 6420 7b74 7970 6528 636c 6173 7373 7472  d {type(classstr
+00018bc0: 297d 203a 207b 636c 6173 7373 7472 7d22  )} : {classstr}"
+00018bd0: 290a 0a20 2020 2023 2063 6c61 7373 2048  )..    # class H
+00018be0: 746d 6c43 6c61 7373 3a0a 0a20 2020 2040  tmlClass:..    @
+00018bf0: 636c 6173 736d 6574 686f 640a 2020 2020  classmethod.    
+00018c00: 6465 6620 6372 6561 7465 5f66 726f 6d5f  def create_from_
+00018c10: 636c 6173 7365 645f 656c 656d 656e 7428  classed_element(
+00018c20: 636c 732c 2065 6c65 6d29 3a0a 2020 2020  cls, elem):.    
+00018c30: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00018c40: 6765 7420 636c 6173 7320 7661 6c75 6520  get class value 
+00018c50: 6672 6f6d 2065 6c65 6d65 6e74 2061 6e64  from element and
+00018c60: 2063 6372 6561 7465 2048 746d 6c43 6c61   ccreate HtmlCla
+00018c70: 7373 0a20 2020 2020 2020 203a 7061 7261  ss.        :para
+00018c80: 6d20 656c 656d 3a20 656c 656d 656e 7473  m elem: elements
+00018c90: 2077 6974 6820 4063 6c61 7373 2061 7474   with @class att
+00018ca0: 7269 6275 7465 0a20 2020 2020 2020 203a  ribute.        :
+00018cb0: 7265 7475 726e 3a20 4874 6d6c 436c 6173  return: HtmlClas
+00018cc0: 7320 656c 656d 656e 7420 6f72 204e 6f6e  s element or Non
+00018cd0: 650a 2020 2020 2020 2020 2222 220a 2020  e.        """.  
+00018ce0: 2020 2020 2020 636c 617a 7a20 3d20 4874        clazz = Ht
+00018cf0: 6d6c 436c 6173 732e 6765 745f 636c 6173  mlClass.get_clas
+00018d00: 735f 7374 7269 6e67 5f6f 6e5f 656c 656d  s_string_on_elem
+00018d10: 656e 7428 656c 656d 290a 2020 2020 2020  ent(elem).      
+00018d20: 2020 7265 7475 726e 204e 6f6e 6520 6966    return None if
+00018d30: 206e 6f74 2063 6c61 7a7a 2065 6c73 6520   not clazz else 
+00018d40: 4874 6d6c 436c 6173 7328 636c 617a 7a29  HtmlClass(clazz)
+00018d50: 0a0a 2020 2020 2320 636c 6173 7320 4874  ..    # class Ht
+00018d60: 6d6c 436c 6173 733a 0a0a 2020 2020 4070  mlClass:..    @p
+00018d70: 726f 7065 7274 790a 2020 2020 6465 6620  roperty.    def 
+00018d80: 636c 6173 735f 7374 7269 6e67 2873 656c  class_string(sel
+00018d90: 6629 3a0a 2020 2020 2020 2020 2222 220a  f):.        """.
+00018da0: 2020 2020 2020 2020 7265 7475 726e 2074          return t
+00018db0: 6865 2063 6c61 7373 5f73 7472 696e 6720  he class_string 
+00018dc0: 2863 7265 6174 6573 2066 726f 6d20 6c61  (creates from la
+00018dd0: 7465 7374 2073 656c 662e 636c 6173 7365  test self.classe
+00018de0: 7329 0a20 2020 2020 2020 203a 7265 7475  s).        :retu
+00018df0: 726e 3a20 7374 7269 6e67 206f 6620 616c  rn: string of al
+00018e00: 7068 6162 6574 6963 6361 6c6c 7920 736f  phabeticcally so
+00018e10: 7274 6564 2073 7065 6365 2d73 6570 6172  rted spece-separ
+00018e20: 6174 6564 2063 6c61 7373 6573 0a20 2020  ated classes.   
+00018e30: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00018e40: 2072 6574 7572 6e20 2222 2069 6620 6e6f   return "" if no
+00018e50: 7420 7365 6c66 2e63 6c61 7373 6573 2065  t self.classes e
+00018e60: 6c73 6520 2220 222e 6a6f 696e 2873 6f72  lse " ".join(sor
+00018e70: 7465 6428 6c69 7374 2873 656c 662e 636c  ted(list(self.cl
+00018e80: 6173 7365 7329 2929 0a0a 2020 2020 6465  asses)))..    de
+00018e90: 6620 6164 645f 636c 6173 7328 7365 6c66  f add_class(self
+00018ea0: 2c20 636c 617a 7a29 3a0a 2020 2020 2020  , clazz):.      
+00018eb0: 2020 2222 220a 2020 2020 2020 2020 6164    """.        ad
+00018ec0: 6420 636c 6173 7320 746f 2063 6c61 7373  d class to class
+00018ed0: 5f73 7472 696e 670a 2020 2020 2020 2020  _string.        
+00018ee0: 3a70 6172 616d 2063 6c61 7a7a 3a20 636c  :param clazz: cl
+00018ef0: 6173 7320 746f 2061 6464 2028 6d75 7374  ass to add (must
+00018f00: 2062 6520 6e6f 6e2d 656d 7074 7920 7374   be non-empty st
+00018f10: 7269 6e67 0a20 2020 2020 2020 2069 6620  ring.        if 
+00018f20: 636c 617a 7a20 6973 0a20 2020 2020 2020  clazz is.       
+00018f30: 2022 2222 0a20 2020 2020 2020 2069 6620   """.        if 
+00018f40: 636c 617a 7a20 616e 6420 6c65 6e28 636c  clazz and len(cl
+00018f50: 617a 7a2e 7374 7269 7028 2929 203e 2030  azz.strip()) > 0
+00018f60: 2061 6e64 2063 6c61 7a7a 206e 6f74 2069   and clazz not i
+00018f70: 6e20 7365 6c66 2e63 6c61 7373 6573 3a0a  n self.classes:.
+00018f80: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00018f90: 2e63 6c61 7373 6573 2e61 6464 2863 6c61  .classes.add(cla
+00018fa0: 7a7a 2e73 7472 6970 2829 290a 0a20 2020  zz.strip())..   
+00018fb0: 2023 2063 6c61 7373 2048 746d 6c43 6c61   # class HtmlCla
+00018fc0: 7373 3a0a 0a20 2020 2064 6566 2068 6173  ss:..    def has
+00018fd0: 5f63 6c61 7373 2873 656c 662c 2063 6c61  _class(self, cla
+00018fe0: 7a7a 293a 0a20 2020 2020 2020 2022 2222  zz):.        """
+00018ff0: 0a20 2020 2020 2020 2064 6f65 7320 636c  .        does cl
+00019000: 6173 7320 6578 6973 7420 696e 2063 6c61  ass exist in cla
+00019010: 7373 6573 0a20 2020 2020 2020 203a 7061  sses.        :pa
+00019020: 7261 6d20 636c 617a 7a3a 0a20 2020 2020  ram clazz:.     
+00019030: 2020 2022 2222 0a20 2020 2020 2020 2072     """.        r
+00019040: 6574 7572 6e20 636c 617a 7a20 696e 2073  eturn clazz in s
+00019050: 656c 662e 636c 6173 7365 730a 0a20 2020  elf.classes..   
+00019060: 2023 2063 6c61 7373 2048 746d 6c43 6c61   # class HtmlCla
+00019070: 7373 3a0a 0a20 2020 2064 6566 2072 6570  ss:..    def rep
+00019080: 6c61 6365 5f63 6c61 7373 2873 656c 662c  lace_class(self,
+00019090: 2063 6c61 7a7a 5f6f 6c64 2c20 636c 617a   clazz_old, claz
+000190a0: 7a3d 4e6f 6e65 293a 0a20 2020 2020 2020  z=None):.       
+000190b0: 2022 2222 0a20 2020 2020 2020 2072 656d   """.        rem
+000190c0: 6f76 6520 636c 617a 7a5f 6f6c 6420 3b20  ove clazz_old ; 
+000190d0: 6966 2063 6c61 7a7a 2069 7320 6e6f 7420  if clazz is not 
+000190e0: 4e6f 6e65 2061 6464 2069 7420 6173 206e  None add it as n
+000190f0: 6577 2063 6c61 7373 0a20 2020 2020 2020  ew class.       
+00019100: 2028 6966 2063 6c61 7a7a 2069 7320 616c   (if clazz is al
+00019110: 7265 6164 7920 7072 6573 656e 742c 206e  ready present, n
+00019120: 6f2d 6f70 290a 2020 2020 2020 2020 2222  o-op).        ""
+00019130: 220a 2020 2020 2020 2020 6966 2063 6c61  ".        if cla
+00019140: 7a7a 5f6f 6c64 2069 6e20 7365 6c66 2e63  zz_old in self.c
+00019150: 6c61 7373 6573 3a0a 2020 2020 2020 2020  lasses:.        
+00019160: 2020 2020 7365 6c66 2e72 656d 6f76 6528      self.remove(
+00019170: 636c 617a 7a5f 6f6c 6429 0a20 2020 2020  clazz_old).     
+00019180: 2020 2020 2020 2069 6620 636c 617a 7a3a         if clazz:
+00019190: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000191a0: 2073 656c 662e 6164 645f 636c 6173 7328   self.add_class(
+000191b0: 636c 617a 7a29 0a0a 2020 2020 2320 636c  clazz)..    # cl
+000191c0: 6173 7320 4874 6d6c 436c 6173 733a 0a0a  ass HtmlClass:..
+000191d0: 2020 2020 6465 6620 7265 6d6f 7665 2873      def remove(s
+000191e0: 656c 662c 2063 6c61 7a7a 293a 0a20 2020  elf, clazz):.   
+000191f0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00019200: 2072 656d 6f76 6520 636c 6173 7320 6672   remove class fr
+00019210: 6f6d 2073 7472 696e 670a 2020 2020 2020  om string.      
+00019220: 2020 3a70 6172 616d 2063 6c61 7a7a 3a20    :param clazz: 
+00019230: 636c 6173 7320 7374 7269 6e67 2074 6f20  class string to 
+00019240: 7265 6d6f 7665 0a20 2020 2020 2020 2069  remove.        i
+00019250: 6620 206e 6f74 2070 7265 7365 6e74 2c20  f  not present, 
+00019260: 6e6f 2d6f 700a 2020 2020 2020 2020 2222  no-op.        ""
+00019270: 220a 2020 2020 2020 2020 6966 2063 6c61  ".        if cla
+00019280: 7a7a 2069 6e20 7365 6c66 2e63 6c61 7373  zz in self.class
+00019290: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
+000192a0: 7365 6c66 2e63 6c61 7373 6573 2e72 656d  self.classes.rem
+000192b0: 6f76 6528 636c 617a 7a29 0a0a 2020 2020  ove(clazz)..    
+000192c0: 2320 636c 6173 7320 4874 6d6c 436c 6173  # class HtmlClas
+000192d0: 733a 0a0a 2020 2020 4063 6c61 7373 6d65  s:..    @classme
+000192e0: 7468 6f64 0a20 2020 2064 6566 2067 6574  thod.    def get
+000192f0: 5f63 6c61 7373 5f73 7472 696e 675f 6f6e  _class_string_on
+00019300: 5f65 6c65 6d65 6e74 2863 6c73 2c20 656c  _element(cls, el
+00019310: 656d 293a 0a20 2020 2020 2020 2022 2222  em):.        """
+00019320: 0a20 2020 2020 2020 2063 6f6e 7665 6e69  .        conveni
+00019330: 656e 6365 206d 6574 686f 6420 746f 2067  ence method to g
+00019340: 6574 2065 6c65 6d65 6e74 2073 7479 6c65  et element style
+00019350: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+00019360: 656c 656d 3a20 746f 2067 6574 2073 7479  elem: to get sty
+00019370: 6c65 2066 726f 6d0a 2020 2020 2020 2020  le from.        
+00019380: 3a72 6574 7572 6e3a 2073 7479 6c65 206f  :return: style o
+00019390: 7220 4e6f 6e65 0a20 2020 2020 2020 2022  r None.        "
+000193a0: 2222 0a0a 2020 2020 2020 2020 7265 7475  ""..        retu
+000193b0: 726e 2065 6c65 6d2e 6174 7472 6962 2e67  rn elem.attrib.g
+000193c0: 6574 2822 636c 6173 7322 2920 6966 2074  et("class") if t
+000193d0: 7970 6528 656c 656d 2920 6973 205f 456c  ype(elem) is _El
+000193e0: 656d 656e 7420 656c 7365 204e 6f6e 650a  ement else None.
+000193f0: 0a20 2020 2023 2063 6c61 7373 2048 746d  .    # class Htm
+00019400: 6c43 6c61 7373 3a0a 0a20 2020 2040 636c  lClass:..    @cl
+00019410: 6173 736d 6574 686f 640a 2020 2020 6465  assmethod.    de
+00019420: 6620 7365 745f 636c 6173 735f 6f6e 5f65  f set_class_on_e
+00019430: 6c65 6d65 6e74 2863 6c73 2c20 656c 656d  lement(cls, elem
+00019440: 2c20 7661 6c75 652c 2072 6570 6c61 6365  , value, replace
+00019450: 3d54 7275 6529 3a0a 2020 2020 2020 2020  =True):.        
+00019460: 2222 220a 2020 2020 2020 2020 636f 6e76  """.        conv
+00019470: 656e 6965 6e63 6520 6d65 7468 6f64 2074  enience method t
+00019480: 6f20 7365 7420 636c 6173 7320 6f6e 2065  o set class on e
+00019490: 6c65 6d65 6e74 0a20 2020 2020 2020 203a  lement.        :
+000194a0: 7061 7261 6d20 656c 656d 3a65 6c65 6d65  param elem:eleme
+000194b0: 6e74 2074 6f20 7365 7420 636c 6173 7320  nt to set class 
+000194c0: 6f6e 0a20 2020 2020 2020 203a 7061 7261  on.        :para
+000194d0: 6d20 7661 6c75 653a 2068 746d 6c20 636c  m value: html cl
+000194e0: 6173 730a 2020 2020 2020 2020 3a70 6172  ass.        :par
+000194f0: 616d 2072 6570 6c61 6365 3a69 6620 5472  am replace:if Tr
+00019500: 7565 2072 6570 6c61 6365 2c20 656c 7365  ue replace, else
+00019510: 2061 6464 2074 6f20 6578 6973 7469 6e67   add to existing
+00019520: 2061 7474 7269 6275 7465 0a20 2020 2020   attribute.     
+00019530: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
+00019540: 6620 656c 656d 2069 7320 6e6f 7420 4e6f  f elem is not No
+00019550: 6e65 2061 6e64 2076 616c 7565 3a0a 2020  ne and value:.  
+00019560: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+00019570: 2072 6570 6c61 6365 3a0a 2020 2020 2020   replace:.      
+00019580: 2020 2020 2020 2020 2020 6f6c 645f 636c            old_cl
+00019590: 6173 7320 3d20 4874 6d6c 436c 6173 732e  ass = HtmlClass.
+000195a0: 6765 745f 636c 6173 735f 7374 7269 6e67  get_class_string
+000195b0: 5f6f 6e5f 656c 656d 656e 7428 656c 656d  _on_element(elem
+000195c0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000195d0: 2020 6966 206f 6c64 5f63 6c61 7373 3a0a    if old_class:.
+000195e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000195f0: 2020 2020 6966 2076 616c 7565 206e 6f74      if value not
+00019600: 2069 6e20 6f6c 645f 636c 6173 733a 0a20   in old_class:. 
+00019610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019620: 2020 2020 2020 206f 6c64 5f63 6c61 7373         old_class
+00019630: 202b 3d20 2220 2220 2b20 7661 6c75 650a   += " " + value.
+00019640: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00019650: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00019660: 2020 6f6c 645f 636c 6173 7320 3d20 7661    old_class = va
+00019670: 6c75 650a 2020 2020 2020 2020 2020 2020  lue.            
+00019680: 656c 656d 2e61 7474 7269 625b 2263 6c61  elem.attrib["cla
+00019690: 7373 225d 203d 2076 616c 7565 0a0a 2020  ss"] = value..  
+000196a0: 2020 2320 636c 6173 7320 4874 6d6c 436c    # class HtmlCl
+000196b0: 6173 733a 0a0a 2020 2020 6465 6620 6372  ass:..    def cr
+000196c0: 6561 7465 5f63 6c61 7373 7265 6628 7365  eate_classref(se
+000196d0: 6c66 293a 0a20 2020 2020 2020 2022 2222  lf):.        """
+000196e0: 0a20 2020 2020 2020 2063 7265 6174 6520  .        create 
+000196f0: 636c 6173 7372 6566 2073 7472 696e 6720  classref string 
+00019700: 2870 7265 7065 6e64 2022 2e22 290a 2020  (prepend ".").  
+00019710: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00019720: 2020 7265 7475 726e 2022 2e22 202b 2073    return "." + s
+00019730: 656c 662e 636c 6173 735f 7374 7269 6e67  elf.class_string
+00019740: 0a0a 2020 2020 2320 636c 6173 7320 4874  ..    # class Ht
+00019750: 6d6c 436c 6173 733a 0a0a 2020 2020 4063  mlClass:..    @c
+00019760: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
+00019770: 6566 2072 656d 6f76 655f 646f 7428 7365  ef remove_dot(se
+00019780: 6c66 2c20 7374 7269 6e67 293a 0a20 2020  lf, string):.   
+00019790: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+000197a0: 2072 656d 6f76 6520 646f 7420 2822 2e22   remove dot ("."
+000197b0: 2920 2d20 696e 2068 746d 6c2f 6865 6164  ) - in html/head
+000197c0: 2f73 7479 6c65 2065 6c65 6d65 6e74 0a20  /style element. 
+000197d0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+000197e0: 2020 2072 6574 7572 6e20 7374 7269 6e67     return string
+000197f0: 5b31 3a5d 2069 6620 7374 7269 6e67 2061  [1:] if string a
+00019800: 6e64 2073 7472 696e 675b 3a31 5d20 3d3d  nd string[:1] ==
+00019810: 2022 2e22 2065 6c73 6520 7374 7269 6e67   "." else string
+00019820: 0a0a 0a63 6c61 7373 2048 746d 6c54 7265  ...class HtmlTre
+00019830: 653a 0a20 2020 2022 2222 6275 696c 6473  e:.    """builds
+00019840: 2061 2074 7265 6520 6672 6f6d 2061 2066   a tree from a f
+00019850: 6c61 7420 7365 7420 6f66 2048 746d 6c20  lat set of Html 
+00019860: 656c 656d 6e65 7473 2222 220a 0a20 2020  elemnets"""..   
+00019870: 2023 2066 6f72 2074 6865 2073 6563 7469   # for the secti
+00019880: 6f6e 5f72 6563 730a 2020 2020 4348 4150  on_recs.    CHAP
+00019890: 5f54 4f50 203d 2022 4348 4150 5f54 4f50  _TOP = "CHAP_TOP
+000198a0: 220a 2020 2020 4348 4150 5f53 4543 5449  ".    CHAP_SECTI
+000198b0: 4f4e 5320 3d20 2243 4841 505f 5345 4354  ONS = "CHAP_SECT
+000198c0: 494f 4e53 220a 2020 2020 4348 4150 5f53  IONS".    CHAP_S
+000198d0: 5542 5345 4354 5320 3d20 2243 4841 505f  UBSECTS = "CHAP_
+000198e0: 5355 4253 4543 5453 220a 0a20 2020 2023  SUBSECTS"..    #
+000198f0: 2043 6861 7074 6572 0a20 2020 2054 5245   Chapter.    TRE
+00019900: 455f 524f 4f54 203d 2022 7472 6565 5f72  E_ROOT = "tree_r
+00019910: 6f6f 7422 0a20 2020 2043 4c41 5353 203d  oot".    CLASS =
+00019920: 2022 636c 6173 7322 0a20 2020 2050 5245   "class".    PRE
+00019930: 5f43 4841 5053 4543 203d 2022 7072 655f  _CHAPSEC = "pre_
+00019940: 6368 6170 7365 6322 0a0a 2020 2020 2320  chapsec"..    # 
+00019950: 7365 6374 696f 6e73 0a20 2020 2043 4841  sections.    CHA
+00019960: 5053 4543 203d 2022 6368 6170 7365 6322  PSEC = "chapsec"
+00019970: 0a20 2020 2054 4f50 5f44 4956 203d 2022  .    TOP_DIV = "
+00019980: 746f 705f 6469 7622 0a0a 2020 2020 2320  top_div"..    # 
+00019990: 5850 6174 6873 0a20 2020 2041 4c4c 5f44  XPaths.    ALL_D
+000199a0: 4956 5f58 5041 5448 5320 3d20 222e 2f2f  IV_XPATHS = ".//
+000199b0: 6469 7622 0a0a 2020 2020 2320 636c 6173  div"..    # clas
+000199c0: 7320 4874 6d6c 5472 6565 0a0a 2020 2020  s HtmlTree..    
+000199d0: 4063 6c61 7373 6d65 7468 6f64 0a20 2020  @classmethod.   
+000199e0: 2064 6566 206d 616b 655f 7365 6374 696f   def make_sectio
+000199f0: 6e73 5f61 6e64 5f6f 7574 7075 7428 636c  ns_and_output(cl
+00019a00: 732c 2065 6c65 6d2c 206f 7574 7075 745f  s, elem, output_
+00019a10: 6469 722c 2072 6563 735f 6279 5f73 6563  dir, recs_by_sec
+00019a20: 7469 6f6e 3d4e 6f6e 6529 3a0a 2020 2020  tion=None):.    
+00019a30: 2020 2020 2222 2266 696e 6420 6465 6369      """find deci
+00019a40: 6d61 6c20 6e75 6d62 6572 2066 6f72 2074  mal number for t
+00019a50: 7265 650a 2020 2020 2020 2020 5468 6953  ree.        ThiS
+00019a60: 2069 7320 4845 4156 494c 5920 6261 7365   is HEAVILY base
+00019a70: 6420 6f6e 2049 5043 430a 2020 2020 2020  d on IPCC.      
+00019a80: 2020 6375 7272 656e 746c 7920 6361 6c6c    currently call
+00019a90: 6564 2069 6e20 7469 6479 5f66 6c6f 7728  ed in tidy_flow(
+00019aa0: 290a 2020 2020 2020 2020 2222 220a 2020  ).        """.  
+00019ab0: 2020 2020 2020 6d61 726b 6572 7320 3d20        markers = 
+00019ac0: 5b22 4368 6170 7465 7222 2c0a 2020 2020  ["Chapter",.    
+00019ad0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00019ae0: 2022 5461 626c 6520 6f66 2043 6f6e 7465   "Table of Conte
+00019af0: 6e74 7322 2c0a 2020 2020 2020 2020 2020  nts",.          
+00019b00: 2020 2020 2020 2020 2022 5461 626c 6520           "Table 
+00019b10: 6f66 222c 2020 2320 6f6e 6520 6973 2063  of",  # one is c
+00019b20: 6f6e 6361 7465 6e61 7465 6420 2843 6861  oncatenated (Cha
+00019b30: 7074 6572 3031 2920 736f 2061 6262 7265  pter01) so abbre
+00019b40: 7669 6174 652c 2075 6e77 6569 6768 7465  viate, unweighte
+00019b50: 6420 4368 6170 3136 0a20 2020 2020 2020  d Chap16.       
+00019b60: 2020 2020 2020 2020 2020 2020 2320 2245              # "E
+00019b70: 7865 6375 7469 7665 2053 756d 6d61 7279  xecutive Summary
+00019b80: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
+00019b90: 2020 2020 2020 2245 7865 6375 7469 7665        "Executive
+00019ba0: 222c 2020 2320 6361 7365 2076 6172 6961  ",  # case varia
+00019bb0: 7469 6f6e 0a20 2020 2020 2020 2020 2020  tion.           
+00019bc0: 2020 2020 2020 2020 2320 2246 7265 7175          # "Frequ
+00019bd0: 656e 746c 7920 4173 6b65 6420 5175 6573  ently Asked Ques
+00019be0: 7469 6f6e 7322 2c20 2320 6e6f 7420 696e  tions", # not in
+00019bf0: 2043 6861 7074 6572 3031 0a20 2020 2020   Chapter01.     
+00019c00: 2020 2020 2020 2020 2020 2020 2020 2246                "F
+00019c10: 7265 7175 656e 746c 7922 2c20 2023 2063  requently",  # c
+00019c20: 6173 6520 7661 7269 6174 696f 6e0a 2020  ase variation.  
+00019c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019c40: 2022 5265 6665 7265 6e63 6573 222c 0a20   "References",. 
+00019c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019c60: 2020 5d0a 2020 2020 2020 2020 6973 5f62    ].        is_b
+00019c70: 6f6c 6420 3d20 5472 7565 0a20 2020 2020  old = True.     
+00019c80: 2020 2066 6f6e 745f 7369 7a65 5f72 616e     font_size_ran
+00019c90: 6765 203d 2028 3132 2c20 3939 3929 0a20  ge = (12, 999). 
+00019ca0: 2020 2020 2020 2066 6f72 206d 6172 6b65         for marke
+00019cb0: 7220 696e 206d 6172 6b65 7273 3a0a 2020  r in markers:.  
+00019cc0: 2020 2020 2020 2020 2020 6d61 726b 6564            marked
+00019cd0: 5f64 6976 2c20 6469 7673 203d 2063 6c73  _div, divs = cls
+00019ce0: 2e67 6574 5f64 6976 5f73 7061 6e5f 7374  .get_div_span_st
+00019cf0: 6172 7469 6e67 5f77 6974 6828 656c 656d  arting_with(elem
+00019d00: 2c20 6d61 726b 6572 2c20 6973 5f62 6f6c  , marker, is_bol
+00019d10: 642c 2066 6f6e 745f 7369 7a65 5f72 616e  d, font_size_ran
+00019d20: 6765 3d66 6f6e 745f 7369 7a65 5f72 616e  ge=font_size_ran
+00019d30: 6765 290a 2020 2020 2020 2020 2020 2020  ge).            
+00019d40: 6966 206d 6172 6b65 645f 6469 7620 6973  if marked_div is
+00019d50: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+00019d60: 2020 2020 2020 2020 2020 206c 6420 3d20             ld = 
+00019d70: 6c65 6e28 6469 7673 2920 6966 2064 6976  len(divs) if div
+00019d80: 7320 656c 7365 2030 0a20 2020 2020 2020  s else 0.       
+00019d90: 2020 2020 2020 2020 206c 6f67 6769 6e67           logging
+00019da0: 2e77 6172 6e69 6e67 2866 2243 616e 6e6f  .warning(f"Canno
+00019db0: 7420 6669 6e64 206d 6172 6b65 7220 5b7b  t find marker [{
+00019dc0: 6d61 726b 6572 7d5d 2066 6f75 6e64 207b  marker}] found {
+00019dd0: 6c64 7d20 6d61 726b 6572 7322 290a 0a20  ld} markers").. 
+00019de0: 2020 2020 2020 2063 6c61 7373 5f64 6963         class_dic
+00019df0: 7420 3d20 7b63 6c73 2e43 4841 5053 4543  t = {cls.CHAPSEC
+00019e00: 3a20 636c 732e 5052 455f 4348 4150 5345  : cls.PRE_CHAPSE
+00019e10: 432c 0a20 2020 2020 2020 2020 2020 2020  C,.             
+00019e20: 2020 2020 2020 2020 2063 6c73 2e54 4f50           cls.TOP
+00019e30: 5f44 4956 3a20 636c 732e 5452 4545 5f52  _DIV: cls.TREE_R
+00019e40: 4f4f 542c 207d 0a20 2020 2020 2020 2072  OOT, }.        r
+00019e50: 6563 203d 2072 6563 735f 6279 5f73 6563  ec = recs_by_sec
+00019e60: 7469 6f6e 2e67 6574 2863 6c73 2e43 4841  tion.get(cls.CHA
+00019e70: 505f 544f 5029 0a20 2020 2020 2020 2061  P_TOP).        a
+00019e80: 7373 6572 7420 7265 6320 6973 206e 6f74  ssert rec is not
+00019e90: 204e 6f6e 652c 2066 2277 616e 7465 6420   None, f"wanted 
+00019ea0: 6e6f 6e2d 4e6f 6e65 207b 636c 732e 4348  non-None {cls.CH
+00019eb0: 4150 5f54 4f50 7d20 7265 6322 0a20 2020  AP_TOP} rec".   
+00019ec0: 2020 2020 2064 6563 696d 616c 5f64 6976       decimal_div
+00019ed0: 7320 3d20 636c 732e 6765 745f 6469 765f  s = cls.get_div_
+00019ee0: 7370 616e 735f 7769 7468 5f64 6563 696d  spans_with_decim
+00019ef0: 616c 7328 656c 656d 2c0a 2020 2020 2020  als(elem,.      
+00019f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019f30: 2069 735f 626f 6c64 2c0a 2020 2020 2020   is_bold,.      
+00019f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019f70: 2066 6f6e 745f 7369 7a65 5f72 616e 6765   font_size_range
+00019f80: 3d66 6f6e 745f 7369 7a65 5f72 616e 6765  =font_size_range
+00019f90: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00019fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019fc0: 2020 2020 2020 2020 2073 6563 7469 6f6e           section
+00019fd0: 5f72 6563 3d72 6563 2c20 636c 6173 735f  _rec=rec, class_
+00019fe0: 6469 6374 3d63 6c61 7373 5f64 6963 7429  dict=class_dict)
+00019ff0: 0a20 2020 2020 2020 2063 6c73 2e63 7265  .        cls.cre
+0001a000: 6174 655f 6669 6c65 6e61 6d65 5f61 6e64  ate_filename_and
+0001a010: 5f6f 7574 7075 7428 6465 6369 6d61 6c5f  _output(decimal_
+0001a020: 6469 7673 2c20 6f75 7470 7574 5f64 6972  divs, output_dir
+0001a030: 290a 0a20 2020 2023 2063 6c61 7373 2048  )..    # class H
+0001a040: 746d 6c54 7265 650a 0a20 2020 2040 636c  tmlTree..    @cl
+0001a050: 6173 736d 6574 686f 640a 2020 2020 6465  assmethod.    de
+0001a060: 6620 6372 6561 7465 5f66 696c 656e 616d  f create_filenam
+0001a070: 655f 616e 645f 6f75 7470 7574 2863 6c73  e_and_output(cls
+0001a080: 2c20 6465 6369 6d61 6c5f 6469 7673 2c20  , decimal_divs, 
+0001a090: 6f75 7470 7574 5f64 6972 2c0a 2020 2020  output_dir,.    
+0001a0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a0b0: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+0001a0c0: 7269 673d 2220 215c 2223 2425 2627 2829  rig=" !\"#$%&'()
+0001a0d0: 2a2b 2c2f 3a3b 3c3d 3e3f 405b 5c5c 5d5e  *+,/:;<=>?@[\\]^
+0001a0e0: 607b 7c7d 7e22 2c20 7265 703d 225f 2229  `{|}~", rep="_")
+0001a0f0: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+0001a100: 2020 2020 2020 6372 6561 7465 2066 696c        create fil
+0001a110: 656e 616d 6520 6672 6f6d 2073 6563 7469  ename from secti
+0001a120: 6f6e 206e 616d 652c 2072 6570 6c61 6365  on name, replace
+0001a130: 2070 756e 6374 2063 6861 7261 6374 6572   punct character
+0001a140: 730a 2020 2020 2020 2020 2222 220a 2020  s.        """.  
+0001a150: 2020 2020 2020 6966 206f 7574 7075 745f        if output_
+0001a160: 6469 723a 0a20 2020 2020 2020 2020 2020  dir:.           
+0001a170: 206f 7574 7075 745f 6469 7220 3d20 5061   output_dir = Pa
+0001a180: 7468 286f 7574 7075 745f 6469 7229 0a20  th(output_dir). 
+0001a190: 2020 2020 2020 2020 2020 206f 7574 7075             outpu
+0001a1a0: 745f 6469 722e 6d6b 6469 7228 6578 6973  t_dir.mkdir(exis
+0001a1b0: 745f 6f6b 3d54 7275 6529 0a0a 2020 2020  t_ok=True)..    
+0001a1c0: 2020 2020 2020 2020 7075 6e63 745f 6d61          punct_ma
+0001a1d0: 736b 203d 2055 7469 6c2e 6d61 6b65 5f74  sk = Util.make_t
+0001a1e0: 7261 6e73 6c61 7465 5f6d 6173 6b5f 746f  ranslate_mask_to
+0001a1f0: 5f63 6861 7228 6f72 6967 2c20 7265 7029  _char(orig, rep)
+0001a200: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+0001a210: 2069 2c20 6368 696c 645f 6469 7620 696e   i, child_div in
+0001a220: 2065 6e75 6d65 7261 7465 2864 6563 696d   enumerate(decim
+0001a230: 616c 5f64 6976 7329 3a0a 2020 2020 2020  al_divs):.      
+0001a240: 2020 2020 2020 2020 2020 636c 732e 6372            cls.cr
+0001a250: 6561 7465 5f66 696c 656e 616d 655f 7265  eate_filename_re
+0001a260: 6d6f 7665 5f70 756e 6374 5f61 6e64 5f6f  move_punct_and_o
+0001a270: 7574 7075 7428 6368 696c 645f 6469 762c  utput(child_div,
+0001a280: 206f 7574 7075 745f 6469 722c 2070 756e   output_dir, pun
+0001a290: 6374 5f6d 6173 6b29 0a0a 2020 2020 2320  ct_mask)..    # 
+0001a2a0: 636c 6173 7320 4874 6d6c 5472 6565 0a0a  class HtmlTree..
+0001a2b0: 2020 2020 4063 6c61 7373 6d65 7468 6f64      @classmethod
+0001a2c0: 0a20 2020 2064 6566 2063 7265 6174 655f  .    def create_
+0001a2d0: 6669 6c65 6e61 6d65 5f72 656d 6f76 655f  filename_remove_
+0001a2e0: 7075 6e63 745f 616e 645f 6f75 7470 7574  punct_and_output
+0001a2f0: 2863 6c73 2c20 6368 696c 645f 6469 762c  (cls, child_div,
+0001a300: 206f 7574 7075 745f 6469 722c 2070 756e   output_dir, pun
+0001a310: 6374 5f6d 6173 6b29 3a0a 2020 2020 2020  ct_mask):.      
+0001a320: 2020 2222 226e 6f74 2073 7572 6520 7768    """not sure wh
+0001a330: 6174 2074 6869 7320 646f 6573 203f 4874  at this does ?Ht
+0001a340: 6d6c 5574 696c 2e4d 4152 4b45 5220 2222  mlUtil.MARKER ""
+0001a350: 220a 2020 2020 2020 2020 6966 2048 746d  ".        if Htm
+0001a360: 6c55 7469 6c2e 4d41 524b 4552 2069 6e20  lUtil.MARKER in 
+0001a370: 6368 696c 645f 6469 762e 6174 7472 6962  child_div.attrib
+0001a380: 3a0a 2020 2020 2020 2020 2020 2020 6d61  :.            ma
+0001a390: 726b 6572 203d 2063 6869 6c64 5f64 6976  rker = child_div
+0001a3a0: 2e61 7474 7269 625b 4874 6d6c 5574 696c  .attrib[HtmlUtil
+0001a3b0: 2e4d 4152 4b45 525d 0a20 2020 2020 2020  .MARKER].       
+0001a3c0: 2020 2020 206d 6172 6b65 7220 3d20 6d61       marker = ma
+0001a3d0: 726b 6572 2e73 7472 6970 2829 2e6c 6f77  rker.strip().low
+0001a3e0: 6572 2829 2020 2320 6e61 6d65 2066 726f  er()  # name fro
+0001a3f0: 6d20 7465 7874 2063 6f6e 7465 6e74 0a20  m text content. 
+0001a400: 2020 2020 2020 2020 2020 206d 6172 6b65             marke
+0001a410: 722e 7472 616e 736c 6174 6528 7075 6e63  r.translate(punc
+0001a420: 745f 6d61 736b 290a 2020 2020 2020 2020  t_mask).        
+0001a430: 2020 2020 7061 7468 203d 2050 6174 6828      path = Path(
+0001a440: 6f75 7470 7574 5f64 6972 2c20 6622 7b6d  output_dir, f"{m
+0001a450: 6172 6b65 727d 2e68 746d 6c22 290a 2020  arker}.html").  
+0001a460: 2020 2020 2020 2020 2020 7769 7468 206f            with o
+0001a470: 7065 6e28 7061 7468 2c20 2277 6222 2920  pen(path, "wb") 
+0001a480: 6173 2066 3a0a 2020 2020 2020 2020 2020  as f:.          
+0001a490: 2020 2020 2020 662e 7772 6974 6528 4554        f.write(ET
+0001a4a0: 2e74 6f73 7472 696e 6728 6368 696c 645f  .tostring(child_
+0001a4b0: 6469 762c 2070 7265 7474 795f 7072 696e  div, pretty_prin
+0001a4c0: 743d 5472 7565 2929 0a0a 2020 2020 2320  t=True))..    # 
+0001a4d0: 636c 6173 7320 4874 6d6c 5472 6565 0a0a  class HtmlTree..
+0001a4e0: 2020 2020 4063 6c61 7373 6d65 7468 6f64      @classmethod
+0001a4f0: 0a20 2020 2064 6566 2067 6574 5f64 6976  .    def get_div
+0001a500: 5f73 7061 6e5f 7374 6172 7469 6e67 5f77  _span_starting_w
+0001a510: 6974 6828 636c 732c 2065 6c65 6d2c 2073  ith(cls, elem, s
+0001a520: 7472 672c 2069 735f 626f 6c64 3d46 616c  trg, is_bold=Fal
+0001a530: 7365 2c20 666f 6e74 5f73 697a 655f 7261  se, font_size_ra
+0001a540: 6e67 653d 4e6f 6e65 293a 0a20 2020 2020  nge=None):.     
+0001a550: 2020 2072 6573 756c 7420 3d20 4e6f 6e65     result = None
+0001a560: 0a20 2020 2020 2020 2078 7061 7468 203d  .        xpath =
+0001a570: 2066 222e 2f2f 6469 765b 7370 616e 5b73   f".//div[span[s
+0001a580: 7461 7274 732d 7769 7468 282e 2c27 7b73  tarts-with(.,'{s
+0001a590: 7472 677d 2729 5d5d 220a 2020 2020 2020  trg}')]]".      
+0001a5a0: 2020 6469 7673 203d 2065 6c65 6d2e 7870    divs = elem.xp
+0001a5b0: 6174 6828 7870 6174 6829 0a20 2020 2020  ath(xpath).     
+0001a5c0: 2020 2069 6620 6c65 6e28 6469 7673 2920     if len(divs) 
+0001a5d0: 3d3d 2030 3a0a 2020 2020 2020 2020 2020  == 0:.          
+0001a5e0: 2020 6c6f 6767 696e 672e 7761 726e 696e    logging.warnin
+0001a5f0: 6728 6622 4e6f 2064 6976 7320 7769 7468  g(f"No divs with
+0001a600: 207b 7374 7267 7d22 290a 2020 2020 2020   {strg}").      
+0001a610: 2020 2020 2020 7265 7475 726e 2072 6573        return res
+0001a620: 756c 742c 204e 6f6e 650a 2020 2020 2020  ult, None.      
+0001a630: 2020 6e65 775f 6469 7673 203d 205b 5d0a    new_divs = [].
+0001a640: 2020 2020 2020 2020 666f 7220 6469 7620          for div 
+0001a650: 696e 2064 6976 733a 0a20 2020 2020 2020  in divs:.       
+0001a660: 2020 2020 2073 7061 6e73 203d 2064 6976       spans = div
+0001a670: 2e78 7061 7468 2822 2e2f 7370 616e 2229  .xpath("./span")
+0001a680: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0001a690: 7370 616e 733a 0a20 2020 2020 2020 2020  spans:.         
+0001a6a0: 2020 2020 2020 2063 7373 5f73 7479 6c65         css_style
+0001a6b0: 203d 2043 5353 5374 796c 652e 6372 6561   = CSSStyle.crea
+0001a6c0: 7465 5f63 7373 5f73 7479 6c65 5f66 726f  te_css_style_fro
+0001a6d0: 6d5f 6174 7472 6962 7574 655f 6f66 5f62  m_attribute_of_b
+0001a6e0: 6f64 795f 656c 656d 656e 7428 7370 616e  ody_element(span
+0001a6f0: 735b 305d 290a 2020 2020 2020 2020 2020  s[0]).          
+0001a700: 2020 2020 2020 6966 206e 6f74 2028 6973        if not (is
+0001a710: 5f62 6f6c 6420 616e 6420 6373 735f 7374  _bold and css_st
+0001a720: 796c 652e 6973 5f62 6f6c 645f 6e61 6d65  yle.is_bold_name
+0001a730: 2829 293a 0a20 2020 2020 2020 2020 2020  ()):.           
+0001a740: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
+0001a750: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+0001a760: 2020 6966 206e 6f74 2028 666f 6e74 5f73    if not (font_s
+0001a770: 697a 655f 7261 6e67 6520 616e 6420 636c  ize_range and cl
+0001a780: 732e 696e 5f72 616e 6765 2863 7373 5f73  s.in_range(css_s
+0001a790: 7479 6c65 2e66 6f6e 745f 7369 7a65 2c20  tyle.font_size, 
+0001a7a0: 666f 6e74 5f73 697a 655f 7261 6e67 6529  font_size_range)
+0001a7b0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0001a7c0: 2020 2020 2020 2063 6f6e 7469 6e75 650a         continue.
+0001a7d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a7e0: 6e65 775f 6469 7673 2e61 7070 656e 6428  new_divs.append(
+0001a7f0: 6469 7629 0a20 2020 2020 2020 2020 2020  div).           
+0001a800: 2020 2020 2070 6173 730a 2020 2020 2020       pass.      
+0001a810: 2020 6469 7673 203d 206e 6577 5f64 6976    divs = new_div
+0001a820: 730a 2020 2020 2020 2020 2320 616c 736f  s.        # also
+0001a830: 2074 6573 7420 666f 6e74 2068 6572 6520   test font here 
+0001a840: 4e59 490a 2020 2020 2020 2020 6966 206c  NYI.        if l
+0001a850: 656e 2864 6976 7329 203d 3d20 303a 0a20  en(divs) == 0:. 
+0001a860: 2020 2020 2020 2020 2020 206c 6f67 6769             loggi
+0001a870: 6e67 2e77 6172 6e69 6e67 2866 2263 616e  ng.warning(f"can
+0001a880: 6e6f 7420 6669 6e64 2064 6976 3a20 6c65  not find div: le
+0001a890: 6e3d 7b6c 656e 2864 6976 7329 7d22 290a  n={len(divs)}").
+0001a8a0: 2020 2020 2020 2020 656c 6966 206c 656e          elif len
+0001a8b0: 2864 6976 7329 203e 2031 3a0a 2020 2020  (divs) > 1:.    
+0001a8c0: 2020 2020 2020 2020 6c6f 6767 696e 672e          logging.
+0001a8d0: 7761 726e 696e 6728 6622 746f 6f20 6d61  warning(f"too ma
+0001a8e0: 6e79 2064 6976 733a 206c 656e 3d7b 6c65  ny divs: len={le
+0001a8f0: 6e28 6469 7673 297d 2229 0a20 2020 2020  n(divs)}").     
+0001a900: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0001a910: 2020 2020 2072 6573 756c 7420 3d20 6469       result = di
+0001a920: 7673 5b30 5d0a 2020 2020 2020 2020 2020  vs[0].          
+0001a930: 2020 7265 7375 6c74 2e61 7474 7269 625b    result.attrib[
+0001a940: 226d 6172 6b65 7222 5d20 3d20 7374 7267  "marker"] = strg
+0001a950: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0001a960: 7265 7375 6c74 2c20 6469 7673 0a0a 2020  result, divs..  
+0001a970: 2020 2320 636c 6173 7320 4874 6d6c 5472    # class HtmlTr
+0001a980: 6565 0a0a 2020 2020 4063 6c61 7373 6d65  ee..    @classme
+0001a990: 7468 6f64 0a20 2020 2064 6566 2067 6574  thod.    def get
+0001a9a0: 5f64 6976 5f73 7061 6e73 5f77 6974 685f  _div_spans_with_
+0001a9b0: 6465 6369 6d61 6c73 2863 6c73 2c20 656c  decimals(cls, el
+0001a9c0: 656d 2c20 6973 5f62 6f6c 643d 4e6f 6e65  em, is_bold=None
+0001a9d0: 2c20 666f 6e74 5f73 697a 655f 7261 6e67  , font_size_rang
+0001a9e0: 653d 4e6f 6e65 2c20 636c 6173 735f 6469  e=None, class_di
+0001a9f0: 6374 3d4e 6f6e 652c 2073 6563 7469 6f6e  ct=None, section
+0001aa00: 5f72 6563 3d4e 6f6e 6529 3a0a 2020 2020  _rec=None):.    
+0001aa10: 2020 2020 2222 224d 6174 6368 6573 2064      """Matches d
+0001aa20: 6976 2f73 7061 6e20 7374 6172 7469 6e67  iv/span starting
+0001aa30: 2077 6974 6820 6120 6465 6369 6d61 6c20   with a decimal 
+0001aa40: 696e 6465 780a 2020 2020 2020 2020 642e  index.        d.
+0001aa50: 6420 6f72 2064 2e64 2e64 0a20 2020 2020  d or d.d.d.     
+0001aa60: 2020 2022 2222 0a20 2020 2020 2020 2072     """.        r
+0001aa70: 6573 756c 7420 3d20 4e6f 6e65 0a20 2020  esult = None.   
+0001aa80: 2020 2020 2023 2066 6972 7374 2061 6464       # first add
+0001aa90: 2061 6c6c 206d 6174 6368 696e 6720 6e75   all matching nu
+0001aaa0: 6d62 6572 6564 2064 6976 7320 746f 2070  mbered divs to p
+0001aab0: 7265 5f63 6861 7073 6563 0a20 2020 2020  re_chapsec.     
+0001aac0: 2020 2069 6620 6e6f 7420 636c 6173 735f     if not class_
+0001aad0: 6469 6374 3a0a 2020 2020 2020 2020 2020  dict:.          
+0001aae0: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
+0001aaf0: 6f72 2866 226d 6973 7369 6e67 2063 6c61  or(f"missing cla
+0001ab00: 7373 5f64 6963 7422 290a 2020 2020 2020  ss_dict").      
+0001ab10: 2020 746f 705f 6469 7620 3d20 4554 2e53    top_div = ET.S
+0001ab20: 7562 456c 656d 656e 7428 656c 656d 2c20  ubElement(elem, 
+0001ab30: 485f 4449 5629 0a20 2020 2020 2020 2074  H_DIV).        t
+0001ab40: 6f70 5f64 6976 2e61 7474 7269 625b 636c  op_div.attrib[cl
+0001ab50: 732e 434c 4153 535d 203d 2063 6c61 7373  s.CLASS] = class
+0001ab60: 5f64 6963 742e 6765 7428 4874 6d6c 5472  _dict.get(HtmlTr
+0001ab70: 6565 2e54 4f50 5f44 4956 290a 2020 2020  ee.TOP_DIV).    
+0001ab80: 2020 2020 7072 655f 6368 6170 7365 6320      pre_chapsec 
+0001ab90: 3d20 4554 2e53 7562 456c 656d 656e 7428  = ET.SubElement(
+0001aba0: 746f 705f 6469 762c 2048 5f44 4956 290a  top_div, H_DIV).
+0001abb0: 2020 2020 2020 2020 7072 655f 6368 6170          pre_chap
+0001abc0: 7365 632e 6174 7472 6962 5b63 6c73 2e43  sec.attrib[cls.C
+0001abd0: 4c41 5353 5d20 3d20 636c 6173 735f 6469  LASS] = class_di
+0001abe0: 6374 2e67 6574 2848 746d 6c54 7265 652e  ct.get(HtmlTree.
+0001abf0: 4348 4150 5345 4329 0a20 2020 2020 2020  CHAPSEC).       
+0001ac00: 2063 7572 7265 6e74 5f64 6976 203d 2070   current_div = p
+0001ac10: 7265 5f63 6861 7073 6563 0a0a 2020 2020  re_chapsec..    
+0001ac20: 2020 2020 2320 6974 6572 6174 6520 6f76      # iterate ov
+0001ac30: 6572 2061 6c6c 2064 6976 732c 206f 6e6c  er all divs, onl
+0001ac40: 7920 6170 7065 6e64 2074 686f 7365 2077  y append those w
+0001ac50: 6974 6820 6465 6369 6d61 6c0a 2020 2020  ith decimal.    
+0001ac60: 2020 2020 6469 7673 203d 2065 6c65 6d2e      divs = elem.
+0001ac70: 7870 6174 6828 636c 732e 414c 4c5f 4449  xpath(cls.ALL_DI
+0001ac80: 565f 5850 4154 4853 290a 2020 2020 2020  V_XPATHS).      
+0001ac90: 2020 6465 6369 6d61 6c5f 636f 756e 7420    decimal_count 
+0001aca0: 3d20 300a 2020 2020 2020 2020 7465 7874  = 0.        text
+0001acb0: 7320 3d20 5b5d 2020 2320 6a75 7374 2061  s = []  # just a
+0001acc0: 2063 6865 636b 2061 7420 7072 6573 656e   check at presen
+0001acd0: 740a 2020 2020 2020 2020 666f 7220 6469  t.        for di
+0001ace0: 7620 696e 2064 6976 733a 0a20 2020 2020  v in divs:.     
+0001acf0: 2020 2020 2020 2073 7061 6e73 203d 2064         spans = d
+0001ad00: 6976 2e78 7061 7468 2822 2e2f 7370 616e  iv.xpath("./span
+0001ad10: 2229 0a20 2020 2020 2020 2020 2020 2069  ").            i
+0001ad20: 6620 6e6f 7420 7370 616e 733a 0a20 2020  f not spans:.   
+0001ad30: 2020 2020 2020 2020 2020 2020 2023 206e               # n
+0001ad40: 6f20 7370 616e 732c 2063 6f6e 6361 7465  o spans, concate
+0001ad50: 6e61 7465 2077 6974 6820 7369 626c 696e  nate with siblin
+0001ad60: 6773 0a20 2020 2020 2020 2020 2020 2020  gs.             
+0001ad70: 2020 2069 6620 6469 7620 3d3d 2063 7572     if div == cur
+0001ad80: 7265 6e74 5f64 6976 3a0a 2020 2020 2020  rent_div:.      
+0001ad90: 2020 2020 2020 2020 2020 2020 2020 6c6f                lo
+0001ada0: 6767 696e 672e 7761 726e 696e 6728 2266  gging.warning("f
+0001adb0: 2063 616e 6e6f 7420 6170 7065 6e64 2064   cannot append d
+0001adc0: 6976 207b 6469 767d 2074 6f20 6974 7365  iv {div} to itse
+0001add0: 6c66 2229 0a20 2020 2020 2020 2020 2020  lf").           
+0001ade0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0001adf0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+0001ae00: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+0001ae10: 2020 2020 2020 2020 2020 2020 6375 7272              curr
+0001ae20: 656e 745f 6469 762e 6170 7065 6e64 2864  ent_div.append(d
+0001ae30: 6976 290a 2020 2020 2020 2020 2020 2020  iv).            
+0001ae40: 2020 2020 2020 2020 6578 6365 7074 2056          except V
+0001ae50: 616c 7565 4572 726f 7220 6173 2076 653a  alueError as ve:
+0001ae60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001ae70: 2020 2020 2020 2020 206c 6f67 6769 6e67           logging
+0001ae80: 2e65 7272 6f72 2866 2245 7272 6f72 207b  .error(f"Error {
+0001ae90: 7665 7d22 290a 2020 2020 2020 2020 2020  ve}").          
+0001aea0: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+0001aeb0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0001aec0: 7572 7265 6e74 5f64 6976 2e61 7070 656e  urrent_div.appen
+0001aed0: 6428 6469 7629 0a20 2020 2020 2020 2020  d(div).         
+0001aee0: 2020 2020 2020 2065 7863 6570 7420 4578         except Ex
+0001aef0: 6365 7074 696f 6e20 6173 2065 3a0a 2020  ception as e:.  
+0001af00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001af10: 2020 6c6f 6767 696e 672e 6572 726f 7228    logging.error(
+0001af20: 6622 4255 4720 736b 6970 7065 6422 290a  f"BUG skipped").
+0001af30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001af40: 636f 6e74 696e 7565 0a20 2020 2020 2020  continue.       
+0001af50: 2020 2020 2063 7373 5f73 7479 6c65 203d       css_style =
+0001af60: 2043 5353 5374 796c 652e 6372 6561 7465   CSSStyle.create
+0001af70: 5f63 7373 5f73 7479 6c65 5f66 726f 6d5f  _css_style_from_
+0001af80: 6174 7472 6962 7574 655f 6f66 5f62 6f64  attribute_of_bod
+0001af90: 795f 656c 656d 656e 7428 7370 616e 735b  y_element(spans[
+0001afa0: 305d 2920 2023 206e 6f72 6d61 6c6c 7920  0])  # normally 
+0001afb0: 636f 6d65 7320 6669 7273 740a 2020 2020  comes first.    
+0001afc0: 2020 2020 2020 2020 2320 6368 6563 6b20          # check 
+0001afd0: 7765 6967 6874 2c20 6966 206e 6f6e 6520  weight, if none 
+0001afe0: 6170 7065 6e64 2074 6f20 7369 626c 696e  append to siblin
+0001aff0: 6773 0a20 2020 2020 2020 2020 2020 2069  gs.            i
+0001b000: 6620 6e6f 7420 2869 735f 626f 6c64 2061  f not (is_bold a
+0001b010: 6e64 2063 7373 5f73 7479 6c65 2e69 735f  nd css_style.is_
+0001b020: 626f 6c64 5f6e 616d 6528 2929 3a0a 2020  bold_name()):.  
+0001b030: 2020 2020 2020 2020 2020 2020 2020 6375                cu
+0001b040: 7272 656e 745f 6469 762e 6170 7065 6e64  rrent_div.append
+0001b050: 2864 6976 290a 2020 2020 2020 2020 2020  (div).          
+0001b060: 2020 2020 2020 636f 6e74 696e 7565 0a20        continue. 
+0001b070: 2020 2020 2020 2020 2020 2023 2063 6865             # che
+0001b080: 636b 2066 6f6e 742d 7369 7a65 2c20 6966  ck font-size, if
+0001b090: 206e 6f6e 6520 6170 7065 6e64 2074 6f20   none append to 
+0001b0a0: 7369 626c 696e 6773 0a20 2020 2020 2020  siblings.       
+0001b0b0: 2020 2020 2069 6620 6e6f 7420 2866 6f6e       if not (fon
+0001b0c0: 745f 7369 7a65 5f72 616e 6765 2061 6e64  t_size_range and
+0001b0d0: 2063 6c73 2e69 6e5f 7261 6e67 6528 6373   cls.in_range(cs
+0001b0e0: 735f 7374 796c 652e 666f 6e74 5f73 697a  s_style.font_siz
+0001b0f0: 652c 2066 6f6e 745f 7369 7a65 5f72 616e  e, font_size_ran
+0001b100: 6765 2929 3a0a 2020 2020 2020 2020 2020  ge)):.          
+0001b110: 2020 2020 2020 6375 7272 656e 745f 6469        current_di
+0001b120: 762e 6170 7065 6e64 2864 6976 290a 2020  v.append(div).  
+0001b130: 2020 2020 2020 2020 2020 2020 2020 636f                co
+0001b140: 6e74 696e 7565 0a20 2020 2020 2020 2020  ntinue.         
+0001b150: 2020 2023 2073 7061 6e20 636f 6e74 656e     # span conten
+0001b160: 740a 2020 2020 2020 2020 2020 2020 7465  t.            te
+0001b170: 7874 203d 2048 746d 6c55 7469 6c2e 6765  xt = HtmlUtil.ge
+0001b180: 745f 7465 7874 5f63 6f6e 7465 6e74 2873  t_text_content(s
+0001b190: 7061 6e73 5b30 5d29 0a20 2020 2020 2020  pans[0]).       
+0001b1a0: 2020 2020 206d 6174 6368 6564 203d 2046       matched = F
+0001b1b0: 616c 7365 0a20 2020 2020 2020 2020 2020  alse.           
+0001b1c0: 2069 6620 7365 6374 696f 6e5f 7265 632e   if section_rec.
+0001b1d0: 6d61 7463 6828 7465 7874 293a 0a20 2020  match(text):.   
+0001b1e0: 2020 2020 2020 2020 2020 2020 2074 6f70               top
+0001b1f0: 5f64 6976 2e61 7070 656e 6428 6375 7272  _div.append(curr
+0001b200: 656e 745f 6469 7629 0a20 2020 2020 2020  ent_div).       
+0001b210: 2020 2020 2020 2020 2074 6578 7473 2e61           texts.a
+0001b220: 7070 656e 6428 7465 7874 290a 2020 2020  ppend(text).    
+0001b230: 2020 2020 2020 2020 2020 2020 6469 762e              div.
+0001b240: 6174 7472 6962 5b48 746d 6c55 7469 6c2e  attrib[HtmlUtil.
+0001b250: 4d41 524b 4552 5d20 3d20 7465 7874 0a20  MARKER] = text. 
+0001b260: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0001b270: 7572 7265 6e74 5f64 6976 203d 2064 6976  urrent_div = div
+0001b280: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001b290: 2064 6563 696d 616c 5f63 6f75 6e74 202b   decimal_count +
+0001b2a0: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
+0001b2b0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0001b2c0: 2020 2020 2020 6375 7272 656e 745f 6469        current_di
+0001b2d0: 762e 6170 7065 6e64 2864 6976 290a 2020  v.append(div).  
+0001b2e0: 2020 2020 2020 7265 7475 726e 2074 6f70        return top
+0001b2f0: 5f64 6976 0a0a 2020 2020 2320 636c 6173  _div..    # clas
+0001b300: 7320 4874 6d6c 5472 6565 0a0a 2020 2020  s HtmlTree..    
+0001b310: 4063 6c61 7373 6d65 7468 6f64 0a20 2020  @classmethod.   
+0001b320: 2064 6566 2069 6e5f 7261 6e67 6528 636c   def in_range(cl
+0001b330: 732c 206e 756d 2c20 6e75 6d5f 7261 6e67  s, num, num_rang
+0001b340: 6529 3a0a 2020 2020 2020 2020 2222 2269  e):.        """i
+0001b350: 7320 6120 6e75 6d62 6572 2069 6e20 6120  s a number in a 
+0001b360: 6e75 6d65 7269 6320 7261 6e67 6522 2222  numeric range"""
+0001b370: 0a20 2020 2020 2020 2061 7373 6572 7420  .        assert 
+0001b380: 6e75 6d5f 7261 6e67 6520 6f72 206c 656e  num_range or len
+0001b390: 286e 756d 5f72 616e 6765 2920 3d3d 2032  (num_range) == 2
+0001b3a0: 2c20 6622 7261 6e67 6520 6d75 7374 2068  , f"range must h
+0001b3b0: 6176 6520 3220 656c 656d 656e 7473 220a  ave 2 elements".
+0001b3c0: 2020 2020 2020 2020 6173 7365 7274 206e          assert n
+0001b3d0: 756d 5f72 616e 6765 5b30 5d20 3c3d 206e  um_range[0] <= n
+0001b3e0: 756d 5f72 616e 6765 5b31 5d2c 2066 2266  um_range[1], f"f
+0001b3f0: 6f6e 745f 7369 7a65 5f72 616e 6765 206d  ont_size_range m
+0001b400: 7573 7420 6265 2028 6c6f 7765 722c 6869  ust be (lower,hi
+0001b410: 6768 6572 2922 0a20 2020 2020 2020 2061  gher)".        a
+0001b420: 7373 6572 7420 666c 6f61 7428 6e75 6d5f  ssert float(num_
+0001b430: 7261 6e67 655b 305d 290a 2020 2020 2020  range[0]).      
+0001b440: 2020 7265 7375 6c74 203d 206e 756d 5f72    result = num_r
+0001b450: 616e 6765 5b30 5d20 3c3d 206e 756d 203c  ange[0] <= num <
+0001b460: 3d20 6e75 6d5f 7261 6e67 655b 315d 0a20  = num_range[1]. 
+0001b470: 2020 2020 2020 2072 6574 7572 6e20 7265         return re
+0001b480: 7375 6c74 0a0a 2020 2020 2320 636c 6173  sult..    # clas
+0001b490: 7320 4874 6d6c 5472 6565 0a0a 2020 2020  s HtmlTree..    
+0001b4a0: 4063 6c61 7373 6d65 7468 6f64 0a20 2020  @classmethod.   
+0001b4b0: 2064 6566 2067 6574 5f64 6563 696d 616c   def get_decimal
+0001b4c0: 5f73 6563 7469 6f6e 7328 636c 732c 2068  _sections(cls, h
+0001b4d0: 746d 6c5f 656c 656d 2c20 7870 6174 683d  tml_elem, xpath=
+0001b4e0: 4e6f 6e65 2c20 7265 6765 783d 4e6f 6e65  None, regex=None
+0001b4f0: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
+0001b500: 2020 2020 2020 2067 6574 7320 6465 6369         gets deci
+0001b510: 6d61 6c20 7365 6374 696f 6e73 2069 6e20  mal sections in 
+0001b520: 656c 656d 7320 6f66 2066 6f72 6d20 312e  elems of form 1.
+0001b530: 322c 2065 7463 0a20 2020 2020 2020 203a  2, etc.        :
+0001b540: 7061 7261 6d20 6874 6d6c 5f65 6c65 6d3a  param html_elem:
+0001b550: 2065 6c65 6d65 6e74 2074 6f20 7365 6172   element to sear
+0001b560: 6368 2066 6f72 2073 6563 7469 6f6e 730a  ch for sections.
+0001b570: 2020 2020 2020 2020 3a70 6172 616d 2078          :param x
+0001b580: 7061 7468 3a20 7365 6374 696e 7320 6d61  path: sectins ma
+0001b590: 7920 6861 7665 2062 6565 6e20 6c61 6265  y have been labe
+0001b5a0: 6c6c 6564 2077 6974 6820 4063 6c61 7373  lled with @class
+0001b5b0: 206f 7220 7369 6d69 6c61 720a 2020 2020   or similar.    
+0001b5c0: 2020 2020 3a70 6172 616d 2072 6567 6578      :param regex
+0001b5d0: 3a20 7365 6374 696f 6e73 206d 6179 2062  : sections may b
+0001b5e0: 6520 6469 7363 6f76 6572 6162 6c65 2062  e discoverable b
+0001b5f0: 7920 7265 6765 782b 636f 6e74 656e 740a  y regex+content.
+0001b600: 2020 2020 2020 2020 3a72 6574 7572 6e3a          :return:
+0001b610: 206c 6973 7420 6f66 2073 6563 7469 6f6e   list of section
+0001b620: 7320 286d 6179 2062 6520 656d 7074 7929  s (may be empty)
+0001b630: 206f 7220 4e6f 6e65 0a20 2020 2020 2020   or None.       
+0001b640: 2049 7420 6973 206c 696b 656c 7920 7468   It is likely th
+0001b650: 6174 2061 2063 6f6d 6269 6e61 7469 6f6e  at a combination
+0001b660: 206f 6620 7870 6174 6820 616e 6420 7265   of xpath and re
+0001b670: 6765 7820 7769 6c6c 2062 6520 7573 6564  gex will be used
+0001b680: 2061 7320 7870 6174 680a 2020 2020 2020   as xpath.      
+0001b690: 2020 6d61 7920 6e6f 7420 6861 7665 2072    may not have r
+0001b6a0: 6567 6578 0a20 2020 2020 2020 2022 2222  egex.        """
+0001b6b0: 0a20 2020 2020 2020 2069 6620 6874 6d6c  .        if html
+0001b6c0: 5f65 6c65 6d20 6973 204e 6f6e 653a 0a20  _elem is None:. 
+0001b6d0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0001b6e0: 6e20 4e6f 6e65 0a20 2020 2020 2020 2073  n None.        s
+0001b6f0: 6563 7469 6f6e 7320 3d20 5b5d 0a20 2020  ections = [].   
+0001b700: 2020 2020 2069 6620 7870 6174 683a 0a20       if xpath:. 
+0001b710: 2020 2020 2020 2020 2020 2073 6563 7469             secti
+0001b720: 6f6e 7320 3d20 6874 6d6c 5f65 6c65 6d2e  ons = html_elem.
+0001b730: 7870 6174 6828 7870 6174 6829 0a20 2020  xpath(xpath).   
+0001b740: 2020 2020 2069 6620 7265 6765 783a 0a20       if regex:. 
+0001b750: 2020 2020 2020 2020 2020 206c 6f67 6769             loggi
+0001b760: 6e67 2e77 6172 6e69 6e67 2866 2272 6567  ng.warning(f"reg
+0001b770: 6578 206e 6f74 2079 6574 2064 6576 656c  ex not yet devel
+0001b780: 6f70 6564 2066 6f72 2073 6563 7469 6f6e  oped for section
+0001b790: 7322 290a 2020 2020 2020 2020 7265 7475  s").        retu
+0001b7a0: 726e 2073 6563 7469 6f6e 730a 0a0a 5245  rn sections...RE
+0001b7b0: 4353 5f42 595f 5345 4354 494f 4e20 3d20  CS_BY_SECTION = 
+0001b7c0: 7b0a 2020 2020 2320 4874 6d6c 5472 6565  {.    # HtmlTree
+0001b7d0: 2e43 4841 505f 544f 503a 2049 5043 435f  .CHAP_TOP: IPCC_
+0001b7e0: 4348 4150 5f54 4f50 5f52 4543 2c20 2320  CHAP_TOP_REC, # 
+0001b7f0: 7368 6f75 6c64 2062 6520 696e 6a65 6374  should be inject
+0001b800: 6564 2062 7920 7573 6572 0a20 2020 2048  ed by user.    H
+0001b810: 746d 6c54 7265 652e 4348 4150 5f54 4f50  tmlTree.CHAP_TOP
+0001b820: 3a20 4348 4150 5f54 4f50 5f52 4543 2c20  : CHAP_TOP_REC, 
+0001b830: 2023 2073 686f 756c 6420 6265 2069 6e6a   # should be inj
+0001b840: 6563 7465 6420 6279 2075 7365 720a 2020  ected by user.  
+0001b850: 2020 4874 6d6c 5472 6565 2e43 4841 505f    HtmlTree.CHAP_
+0001b860: 5345 4354 494f 4e53 3a20 5345 4354 494f  SECTIONS: SECTIO
+0001b870: 4e53 5f44 4543 494d 414c 5f52 4543 2c0a  NS_DECIMAL_REC,.
+0001b880: 2020 2020 4874 6d6c 5472 6565 2e43 4841      HtmlTree.CHA
+0001b890: 505f 5355 4253 4543 5453 3a20 5355 4253  P_SUBSECTS: SUBS
+0001b8a0: 4543 5453 5f44 4543 494d 414c 5f52 4543  ECTS_DECIMAL_REC
+0001b8b0: 2c0a 7d0a 0a0a 636c 6173 7320 4854 4d4c  ,.}...class HTML
+0001b8c0: 5365 6172 6368 6572 3a0a 2020 2020 2222  Searcher:.    ""
+0001b8d0: 220a 2020 2020 4920 7468 696e 6b20 7468  ".    I think th
+0001b8e0: 6973 2064 7570 6c69 6361 7465 7320 736f  is duplicates so
+0001b8f0: 6d65 206f 6620 4e6f 6465 4578 7472 6163  me of NodeExtrac
+0001b900: 746f 722e 0a20 2020 2022 2222 0a20 2020  tor..    """.   
+0001b910: 2022 2222 0a20 2020 206d 6574 686f 6473   """.    methods
+0001b920: 2066 6f72 2066 696e 6469 6e67 2063 6875   for finding chu
+0001b930: 6e6b 7320 616e 6420 7374 7269 6e67 7320  nks and strings 
+0001b940: 696e 2048 544d 4c20 656c 656d 656e 7473  in HTML elements
+0001b950: 0a0a 2020 2020 4578 616d 706c 6520 7465  ..    Example te
+0001b960: 7874 3a0a 2020 2020 3c73 7061 6e3e 6f62  xt:.    <span>ob
+0001b970: 7365 7276 6564 2069 6e63 7265 6173 6573  served increases
+0001b980: 2069 6e20 7468 6520 6d6f 7374 2072 6563   in the most rec
+0001b990: 656e 7420 7965 6172 7320 284d 696e 7820  ent years (Minx 
+0001b9a0: 6574 2061 6c2e 2c20 3230 3231 3b20 554e  et al., 2021; UN
+0001b9b0: 4550 2c20 3230 3230 6129 2e0a 2020 2020  EP, 2020a)..    
+0001b9c0: 3230 3139 2047 4847 2065 6d69 7373 696f  2019 GHG emissio
+0001b9d0: 6e73 206c 6576 656c 7320 7765 7265 2068  ns levels were h
+0001b9e0: 6967 6865 7220 636f 6d70 6172 6564 2074  igher compared t
+0001b9f0: 6f20 3130 2061 6e64 2033 3020 7965 6172  o 10 and 30 year
+0001ba00: 7320 6167 6f20 2868 6967 6820 636f 6e66  s ago (high conf
+0001ba10: 6964 656e 6365 293a 2061 626f 7574 2031  idence): about 1
+0001ba20: 3225 2028 362e 3520 4774 434f 3265 7129  2% (6.5 GtCO2eq)
+0001ba30: 0a20 2020 2068 6967 6865 7220 7468 616e  .    higher than
+0001ba40: 2069 6e20 3230 3130 2028 3533 c2b1 352e   in 2010 (53..5.
+0001ba50: 3720 4774 434f 3265 7129 2028 4152 3520  7 GtCO2eq) (AR5 
+0001ba60: 7265 6665 7265 6e63 6520 7965 6172 2920  reference year) 
+0001ba70: 616e 6420 6162 6f75 7420 3534 2520 2832  and about 54% (2
+0001ba80: 3120 4774 434f 3265 7129 2068 6967 6865  1 GtCO2eq) highe
+0001ba90: 7220 7468 616e 2069 6e20 3139 3930 0a20  r than in 1990. 
+0001baa0: 2020 2028 3338 c2b1 342e 3820 4774 434f     (38..4.8 GtCO
+0001bab0: 3265 7129 2028 4b79 6f74 6f20 5072 6f74  2eq) (Kyoto Prot
+0001bac0: 6f63 6f6c 2072 6566 6572 656e 6365 2079  ocol reference y
+0001bad0: 6561 7220 616e 6420 6672 6571 7565 6e74  ear and frequent
+0001bae0: 204e 4443 2072 6566 6572 656e 6365 293c   NDC reference)<
+0001baf0: 2f73 7061 6e3e 0a20 2020 2022 2222 0a20  /span>.    """. 
+0001bb00: 2020 2022 2222 0a20 2020 2022 2222 0a0a     """.    """..
+0001bb10: 2020 2020 2320 666f 7220 7465 7874 2073      # for text s
+0001bb20: 6561 7263 680a 2020 2020 4445 4641 554c  earch.    DEFAUL
+0001bb30: 545f 5850 4154 4820 3d20 222f 2f74 6578  T_XPATH = "//tex
+0001bb40: 7428 2922 0a20 2020 2043 4855 4e4b 5f52  t()".    CHUNK_R
+0001bb50: 4520 3d20 2263 6875 6e6b 5f72 6522 2020  E = "chunk_re"  
+0001bb60: 2320 6669 6e64 7320 7465 7874 2063 6875  # finds text chu
+0001bb70: 6e6b 7320 696e 2074 6578 740a 2020 2020  nks in text.    
+0001bb80: 5350 4c49 5454 4552 5f52 4520 3d20 2273  SPLITTER_RE = "s
+0001bb90: 706c 6974 7465 725f 7265 2220 2023 2073  plitter_re"  # s
+0001bba0: 706c 6974 7320 7468 6f73 6520 6368 756e  plits those chun
+0001bbb0: 6b73 2028 652c 672c 2063 6f6d 6d61 2d73  ks (e,g, comma-s
+0001bbc0: 6570 6172 6174 6564 206c 6973 7473 0a20  eparated lists. 
+0001bbd0: 2020 2053 5542 4e4f 4445 5f52 4520 3d20     SUBNODE_RE = 
+0001bbe0: 2273 7562 5f6e 6f64 655f 7265 5f6c 6973  "sub_node_re_lis
+0001bbf0: 7422 2020 2320 6d61 7463 6865 7320 7468  t"  # matches th
+0001bc00: 6520 636f 6d70 6f6e 656e 7473 206f 6620  e components of 
+0001bc10: 7468 6520 7370 6c69 7420 6c69 7374 730a  the split lists.
+0001bc20: 2020 2020 554e 4d41 5443 4845 4420 3d20      UNMATCHED = 
+0001bc30: 2275 6e6d 6174 6368 6564 2220 2023 2061  "unmatched"  # a
+0001bc40: 6464 7320 756e 6d61 7463 6865 6420 6e6f  dds unmatched no
+0001bc50: 6465 730a 2020 2020 5850 4154 4820 3d20  des.    XPATH = 
+0001bc60: 2278 7061 7468 220a 0a20 2020 2064 6566  "xpath"..    def
+0001bc70: 205f 5f69 6e69 745f 5f28 7365 6c66 2c20   __init__(self, 
+0001bc80: 7870 6174 685f 6469 6374 3d4e 6f6e 652c  xpath_dict=None,
+0001bc90: 2064 6963 7478 3d4e 6f6e 6529 3a0a 2020   dictx=None):.  
+0001bca0: 2020 2020 2020 7365 6c66 2e63 6875 6e6b        self.chunk
+0001bcb0: 5f6e 6f64 655f 6469 6374 203d 2064 6963  _node_dict = dic
+0001bcc0: 7428 290a 2020 2020 2020 2020 7365 6c66  t().        self
+0001bcd0: 2e78 7061 7468 5f64 6963 7420 3d20 6469  .xpath_dict = di
+0001bce0: 6374 2829 2069 6620 7870 6174 685f 6469  ct() if xpath_di
+0001bcf0: 6374 2069 7320 4e6f 6e65 2065 6c73 6520  ct is None else 
+0001bd00: 636f 7079 2e64 6565 7063 6f70 7928 7870  copy.deepcopy(xp
+0001bd10: 6174 685f 6469 6374 290a 2020 2020 2020  ath_dict).      
+0001bd20: 2020 7365 6c66 2e63 6875 6e6b 5f64 6963    self.chunk_dic
+0001bd30: 7420 3d20 6469 6374 2829 0a20 2020 2020  t = dict().     
+0001bd40: 2020 2073 656c 662e 7370 6c69 7474 6572     self.splitter
+0001bd50: 5f64 6963 7420 3d20 6469 6374 2829 0a20  _dict = dict(). 
+0001bd60: 2020 2020 2020 2073 656c 662e 7375 626e         self.subn
+0001bd70: 6f64 655f 6469 6374 203d 2064 6963 7428  ode_dict = dict(
+0001bd80: 290a 2020 2020 2020 2020 7365 6c66 2e64  ).        self.d
+0001bd90: 6963 7478 203d 2064 6963 7428 2920 6966  ictx = dict() if
+0001bda0: 2064 6963 7478 2069 7320 4e6f 6e65 2065   dictx is None e
+0001bdb0: 6c73 6520 636f 7079 2e64 6565 7063 6f70  lse copy.deepcop
+0001bdc0: 7928 6469 6374 7829 0a0a 2020 2020 6465  y(dictx)..    de
+0001bdd0: 6620 7365 6172 6368 5f70 6174 685f 6368  f search_path_ch
+0001bde0: 756e 6b5f 6e6f 6465 2873 656c 662c 2068  unk_node(self, h
+0001bdf0: 746d 6c5f 7061 7468 293a 0a20 2020 2020  tml_path):.     
+0001be00: 2020 2061 7373 6572 7420 6874 6d6c 5f70     assert html_p
+0001be10: 6174 682e 6578 6973 7473 2829 2c20 6622  ath.exists(), f"
+0001be20: 7b68 746d 6c5f 7061 7468 7d20 7368 6f75  {html_path} shou
+0001be30: 6c64 2065 7869 7374 220a 2020 2020 2020  ld exist".      
+0001be40: 2020 7472 6565 203d 2045 542e 7061 7273    tree = ET.pars
+0001be50: 6528 7374 7228 6874 6d6c 5f70 6174 6829  e(str(html_path)
+0001be60: 290a 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+0001be70: 7870 6174 6873 203d 2073 656c 662e 7870  xpaths = self.xp
+0001be80: 6174 685f 6469 6374 2e67 6574 2873 656c  ath_dict.get(sel
+0001be90: 662e 5850 4154 4829 0a20 2020 2020 2020  f.XPATH).       
+0001bea0: 2069 6620 6e6f 7420 7365 6c66 2e78 7061   if not self.xpa
+0001beb0: 7468 733a 0a20 2020 2020 2020 2020 2020  ths:.           
+0001bec0: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
+0001bed0: 7228 6622 4552 524f 5220 6d75 7374 2067  r(f"ERROR must g
+0001bee0: 6976 6520 7870 6174 6822 290a 2020 2020  ive xpath").    
+0001bef0: 2020 2020 666f 7220 7870 6174 6820 696e      for xpath in
+0001bf00: 2073 656c 662e 7870 6174 6873 3a0a 2020   self.xpaths:.  
+0001bf10: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
+0001bf20: 2020 2020 2020 2020 2020 2020 2020 206d                 m
 0001bf30: 6174 6368 5f65 6c65 6d65 6e74 7320 3d20  atch_elements = 
 0001bf40: 7472 6565 2e78 7061 7468 2878 7061 7468  tree.xpath(xpath
-0001bf50: 290a 2020 2020 2020 2020 2020 2020 666f  ).            fo
-0001bf60: 7220 6d61 7463 685f 656c 656d 656e 7420  r match_element 
-0001bf70: 696e 206d 6174 6368 5f65 6c65 6d65 6e74  in match_element
-0001bf80: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-0001bf90: 2020 2074 203d 2074 7970 6528 6d61 7463     t = type(matc
-0001bfa0: 685f 656c 656d 656e 7429 0a20 2020 2020  h_element).     
-0001bfb0: 2020 2020 2020 2020 2020 2069 6620 7420             if t 
-0001bfc0: 6973 206e 6f74 205f 456c 656d 656e 743a  is not _Element:
-0001bfd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001bfe0: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
-0001bff0: 4572 726f 7228 6622 6e6f 7420 616e 2065  Error(f"not an e
-0001c000: 6c65 6d65 6e74 207b 747d 207b 6d61 7463  lement {t} {matc
-0001c010: 685f 656c 656d 656e 747d 2229 0a20 2020  h_element}").   
-0001c020: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0001c030: 662e 656c 656d 656e 745f 6c69 7374 2e61  f.element_list.a
-0001c040: 7070 656e 6428 6d61 7463 685f 656c 656d  ppend(match_elem
-0001c050: 656e 7429 0a0a 2020 2020 2020 2020 666f  ent)..        fo
-0001c060: 7220 656c 656d 656e 7420 696e 2073 656c  r element in sel
-0001c070: 662e 656c 656d 656e 745f 6c69 7374 3a0a  f.element_list:.
-0001c080: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-0001c090: 7465 7874 2069 6e20 656c 656d 656e 742e  text in element.
-0001c0a0: 7870 6174 6828 222e 2f74 6578 7428 2922  xpath("./text()"
-0001c0b0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0001c0c0: 2020 2070 6173 730a 2020 2020 2020 2020     pass.        
-0001c0d0: 2020 2020 2020 2020 2320 6e6f 6465 7374          # nodest
-0001c0e0: 7220 3d20 7365 6c66 2e73 656c 6563 745f  r = self.select_
-0001c0f0: 6368 756e 6b73 5f73 7562 6368 756e 6b73  chunks_subchunks
-0001c100: 5f6e 6f64 6573 2874 6578 7429 0a0a 2020  _nodes(text)..  
-0001c110: 2020 6465 6620 7365 6c65 6374 5f63 6875    def select_chu
-0001c120: 6e6b 735f 7375 6263 6875 6e6b 735f 6e6f  nks_subchunks_no
-0001c130: 6465 7328 7365 6c66 2c20 7465 7874 2c20  des(self, text, 
-0001c140: 7370 6c69 7474 6572 5f72 653d 4e6f 6e65  splitter_re=None
-0001c150: 2c20 6e6f 6465 5f72 653d 4e6f 6e65 293a  , node_re=None):
-0001c160: 0a20 2020 2020 2020 2023 2063 6875 6e6b  .        # chunk
-0001c170: 5f72 652c 2073 706c 6974 7465 725f 7265  _re, splitter_re
-0001c180: 2c20 6e6f 6465 5f72 655f 6c69 6174 2c20  , node_re_liat, 
-0001c190: 6164 645f 756e 6d61 7463 6865 6420 3d20  add_unmatched = 
-0001c1a0: 4661 6c73 6529 3a0a 2020 2020 2020 2020  False):.        
-0001c1b0: 2222 220a 2020 2020 2020 2020 4d6f 7665  """.        Move
-0001c1c0: 2074 6f20 6120 636c 6173 7320 616e 6420   to a class and 
-0001c1d0: 7265 6661 6374 6f72 2074 6f20 7573 6520  refactor to use 
-0001c1e0: 6469 6374 696f 6e61 7279 0a20 2020 2020  dictionary.     
-0001c1f0: 2020 204e 4f54 2059 4554 2055 5345 440a     NOT YET USED.
-0001c200: 2020 2020 2020 2020 3a70 6172 616d 2073          :param s
-0001c210: 706c 6974 7465 725f 7265 3a20 7265 6765  plitter_re: rege
-0001c220: 7820 666f 7220 7370 6c69 7474 696e 6720  x for splitting 
-0001c230: 736d 616c 6c65 7220 6368 756e 6b73 0a20  smaller chunks. 
-0001c240: 2020 2020 2020 203a 7061 7261 6d20 6e6f         :param no
-0001c250: 6465 5f72 653a 2072 6567 6578 2074 6f20  de_re: regex to 
-0001c260: 6669 6e64 2068 7970 6572 6e6f 6465 730a  find hypernodes.
-0001c270: 2020 2020 2020 2020 2222 220a 0a20 2020          """..   
-0001c280: 2020 2020 2063 6875 6e6b 5f72 6573 203d       chunk_res =
-0001c290: 2073 656c 662e 6368 756e 6b5f 6469 6374   self.chunk_dict
-0001c2a0: 2e67 6574 2873 656c 662e 4348 554e 4b5f  .get(self.CHUNK_
-0001c2b0: 5245 290a 2020 2020 2020 2020 7370 6c69  RE).        spli
-0001c2c0: 7474 6572 5f72 6573 203d 2073 656c 662e  tter_res = self.
-0001c2d0: 7370 6c69 7474 6572 5f64 6963 742e 6765  splitter_dict.ge
-0001c2e0: 7428 7365 6c66 2e53 504c 4954 5445 525f  t(self.SPLITTER_
-0001c2f0: 5245 290a 2020 2020 2020 2020 6e6f 6465  RE).        node
-0001c300: 5f72 6573 203d 2073 656c 662e 6368 756e  _res = self.chun
-0001c310: 6b5f 6e6f 6465 5f64 6963 742e 6765 7428  k_node_dict.get(
-0001c320: 7365 6c66 2e53 5542 4e4f 4445 5f52 4529  self.SUBNODE_RE)
-0001c330: 0a0a 2020 2020 2020 2020 6164 645f 756e  ..        add_un
-0001c340: 6d61 7463 6865 6420 3d20 7365 6c66 2e63  matched = self.c
-0001c350: 6875 6e6b 5f6e 6f64 655f 6469 6374 2e67  hunk_node_dict.g
-0001c360: 6574 2873 656c 662e 554e 4d41 5443 4845  et(self.UNMATCHE
-0001c370: 4429 0a20 2020 2020 2020 2070 7472 203d  D).        ptr =
-0001c380: 2030 0a20 2020 2020 2020 2077 6869 6c65   0.        while
-0001c390: 2054 7275 653a 0a20 2020 2020 2020 2020   True:.         
-0001c3a0: 2020 2066 6f72 2063 6875 6e6b 5f72 6520     for chunk_re 
-0001c3b0: 696e 2063 6875 6e6b 5f72 6573 3a0a 2020  in chunk_res:.  
-0001c3c0: 2020 2020 2020 2020 2020 2020 2020 6d61                ma
-0001c3d0: 7463 6820 3d20 7265 2e73 6561 7263 6828  tch = re.search(
-0001c3e0: 6368 756e 6b5f 7265 2c20 7465 7874 5b70  chunk_re, text[p
-0001c3f0: 7472 3a5d 290a 2020 2020 2020 2020 2020  tr:]).          
-0001c400: 2020 2020 2020 6966 206e 6f74 206d 6174        if not mat
-0001c410: 6368 3a0a 2020 2020 2020 2020 2020 2020  ch:.            
-0001c420: 2020 2020 2020 2020 6272 6561 6b0a 2020          break.  
-0001c430: 2020 2020 2020 2020 2020 2020 2020 7074                pt
-0001c440: 7220 2b3d 206d 6174 6368 2e73 7061 6e28  r += match.span(
-0001c450: 295b 315d 0a20 2020 2020 2020 2020 2020  )[1].           
-0001c460: 2020 2020 206e 6f64 6573 7472 203d 206d       nodestr = m
-0001c470: 6174 6368 2e67 726f 7570 2831 290a 0a20  atch.group(1).. 
-0001c480: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-0001c490: 6f64 6573 203d 2072 652e 7370 6c69 7428  odes = re.split(
-0001c4a0: 7370 6c69 7474 6572 5f72 652c 206e 6f64  splitter_re, nod
-0001c4b0: 6573 7472 290a 2020 2020 2020 2020 2020  estr).          
-0001c4c0: 2020 2020 2020 6e6f 6465 5f64 6963 7420        node_dict 
-0001c4d0: 3d20 6465 6661 756c 7464 6963 7428 6c69  = defaultdict(li
-0001c4e0: 7374 290a 2020 2020 2020 2020 2020 2020  st).            
-0001c4f0: 2020 2020 666f 7220 6e6f 6465 2069 6e20      for node in 
-0001c500: 6e6f 6465 733a 0a20 2020 2020 2020 2020  nodes:.         
-0001c510: 2020 2020 2020 2020 2020 206d 203d 2072             m = r
-0001c520: 652e 7365 6172 6368 286e 6f64 655f 7265  e.search(node_re
-0001c530: 2c20 6e6f 6465 290a 2020 2020 2020 2020  , node).        
-0001c540: 2020 2020 2020 2020 2020 2020 6966 206d              if m
-0001c550: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001c560: 2020 2020 2020 2020 2020 6e6f 6465 5f64            node_d
-0001c570: 6963 745b 6e6f 6465 5f72 655d 2e61 7070  ict[node_re].app
-0001c580: 656e 6428 6e6f 6465 290a 2020 2020 2020  end(node).      
-0001c590: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0001c5a0: 206e 6f74 206d 2061 6e64 2061 6464 5f75   not m and add_u
-0001c5b0: 6e6d 6174 6368 6564 3a0a 2020 2020 2020  nmatched:.      
-0001c5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c5d0: 2020 6e6f 6465 5f64 6963 745b 7365 6c66    node_dict[self
-0001c5e0: 2e55 4e4d 4154 4348 4544 5d2e 6170 7065  .UNMATCHED].appe
-0001c5f0: 6e64 286e 6f64 6529 0a20 2020 2020 2020  nd(node).       
-0001c600: 2020 2020 2020 2020 2066 6f72 2069 7465           for ite
-0001c610: 6d20 696e 206e 6f64 655f 6469 6374 2e69  m in node_dict.i
-0001c620: 7465 6d73 2829 3a0a 2020 2020 2020 2020  tems():.        
-0001c630: 2020 2020 2020 2020 2020 2020 2320 7072              # pr
-0001c640: 696e 7428 6622 6974 656d 207b 6974 656d  int(f"item {item
-0001c650: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
-0001c660: 2020 2020 2020 2020 7061 7373 0a0a 2020          pass..  
-0001c670: 2020 6465 6620 6164 645f 7870 6174 6828    def add_xpath(
-0001c680: 7365 6c66 2c20 7469 746c 652c 2078 7061  self, title, xpa
-0001c690: 7468 293a 0a20 2020 2020 2020 2022 2222  th):.        """
-0001c6a0: 0a20 2020 2020 2020 2073 6574 2078 7061  .        set xpa
-0001c6b0: 7468 2066 6f72 2065 7874 7261 6374 696e  th for extractin
-0001c6c0: 6720 4854 4d4c 206e 6f64 6573 2e0a 2020  g HTML nodes..  
-0001c6d0: 2020 2020 2020 3a70 6172 616d 2074 6974        :param tit
-0001c6e0: 6c65 3a20 7469 746c 6520 6f66 2078 7061  le: title of xpa
-0001c6f0: 7468 0a20 2020 2020 2020 203a 7061 7261  th.        :para
-0001c700: 6d20 7870 6174 683a 2061 6374 7320 6f6e  m xpath: acts on
-0001c710: 2063 7572 7265 6e74 206e 6f64 6573 6574   current nodeset
-0001c720: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0001c730: 2020 2020 2058 6d6c 4c69 622e 7661 6c69       XmlLib.vali
-0001c740: 6461 7465 5f78 7061 7468 2878 7061 7468  date_xpath(xpath
-0001c750: 290a 2020 2020 2020 2020 7365 6c66 2e61  ).        self.a
-0001c760: 6464 5f69 7465 6d5f 746f 5f61 7272 6179  dd_item_to_array
-0001c770: 5f64 6963 7428 7365 6c66 2e78 7061 7468  _dict(self.xpath
-0001c780: 5f64 6963 742c 2074 6974 6c65 2c20 7870  _dict, title, xp
-0001c790: 6174 6829 0a0a 2020 2020 6465 6620 7661  ath)..    def va
-0001c7a0: 6c69 6461 7465 5f78 7061 7468 2873 656c  lidate_xpath(sel
-0001c7b0: 662c 2078 7061 7468 293a 0a20 2020 2020  f, xpath):.     
-0001c7c0: 2020 2022 2222 0a20 2020 2020 2020 2063     """.        c
-0001c7d0: 7275 6465 2073 796e 7461 7820 7661 6c69  rude syntax vali
-0001c7e0: 6461 7469 6f6e 206f 6620 7870 6174 6820  dation of xpath 
-0001c7f0: 7374 7269 6e67 2e0a 2020 2020 2020 2020  string..        
-0001c800: 7465 7374 7320 7870 6174 6820 6f6e 2061  tests xpath on a
-0001c810: 2074 7269 7669 616c 2065 6c65 6d65 6e74   trivial element
-0001c820: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-0001c830: 7870 6174 683a 0a20 2020 2020 2020 2022  xpath:.        "
-0001c840: 2222 0a20 2020 2020 2020 2074 7265 6520  "".        tree 
-0001c850: 3d20 4554 2e66 726f 6d73 7472 696e 6728  = ET.fromstring(
-0001c860: 223c 666f 6f2f 3e22 290a 2020 2020 2020  "<foo/>").      
-0001c870: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
-0001c880: 2020 2074 7265 652e 7870 6174 6828 7870     tree.xpath(xp
-0001c890: 6174 6829 0a20 2020 2020 2020 2065 7863  ath).        exc
-0001c8a0: 6570 7420 4554 2e58 5061 7468 4576 616c  ept ET.XPathEval
-0001c8b0: 4572 726f 7220 6173 2065 3a0a 2020 2020  Error as e:.    
-0001c8c0: 2020 2020 2020 2020 6c6f 6767 696e 672e          logging.
-0001c8d0: 6572 726f 7228 6622 6261 6420 5850 6174  error(f"bad XPat
-0001c8e0: 6820 7b78 7061 7468 7d2c 207b 657d 2229  h {xpath}, {e}")
-0001c8f0: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-0001c900: 7365 2065 0a0a 2020 2020 6465 6620 6164  se e..    def ad
-0001c910: 645f 6368 756e 6b5f 7265 2873 656c 662c  d_chunk_re(self,
-0001c920: 2063 6875 6e6b 5f72 6529 3a0a 2020 2020   chunk_re):.    
-0001c930: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0001c940: 6164 6420 6368 756e 6b20 7265 6765 7820  add chunk regex 
-0001c950: 666f 7220 6578 7472 6163 7469 6e67 2063  for extracting c
-0001c960: 6875 6e6b 732e 0a20 2020 2020 2020 203a  hunks..        :
-0001c970: 7061 7261 6d20 6368 756e 6b5f 7265 3a20  param chunk_re: 
-0001c980: 6163 7473 206f 6e20 6375 7272 656e 7420  acts on current 
-0001c990: 6e6f 6465 7365 740a 2020 2020 2020 2020  nodeset.        
-0001c9a0: 2222 220a 2020 2020 2020 2020 7365 6c66  """.        self
-0001c9b0: 2e61 6464 5f69 7465 6d5f 746f 5f61 7272  .add_item_to_arr
-0001c9c0: 6179 5f64 6963 7428 7365 6c66 2e63 6875  ay_dict(self.chu
-0001c9d0: 6e6b 5f64 6963 742c 2073 656c 662e 4348  nk_dict, self.CH
-0001c9e0: 554e 4b5f 5245 2c20 6368 756e 6b5f 7265  UNK_RE, chunk_re
-0001c9f0: 290a 2020 2020 2020 2020 7365 6c66 2e76  ).        self.v
-0001ca00: 616c 6964 6174 655f 7265 2863 6875 6e6b  alidate_re(chunk
-0001ca10: 5f72 6529 0a0a 2020 2020 6465 6620 6164  _re)..    def ad
-0001ca20: 645f 7370 6c69 7474 6572 5f72 6528 7365  d_splitter_re(se
-0001ca30: 6c66 2c20 7370 6c69 7474 6572 5f72 6529  lf, splitter_re)
-0001ca40: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-0001ca50: 2020 2020 2020 6164 6420 7370 6c69 7474        add splitt
-0001ca60: 6572 2072 6567 6578 2066 6f72 2065 7874  er regex for ext
-0001ca70: 7261 6374 696e 6720 6c69 7374 7320 696e  racting lists in
-0001ca80: 2063 6875 6e6b 732e 0a20 2020 2020 2020   chunks..       
-0001ca90: 203a 7061 7261 6d20 7370 6c69 7474 6572   :param splitter
-0001caa0: 5f72 653a 2061 6374 7320 6f6e 2063 7572  _re: acts on cur
-0001cab0: 7265 6e74 206e 6f64 6573 6574 0a20 2020  rent nodeset.   
-0001cac0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0001cad0: 2073 656c 662e 6164 645f 6974 656d 5f74   self.add_item_t
-0001cae0: 6f5f 6172 7261 795f 6469 6374 2873 656c  o_array_dict(sel
-0001caf0: 662e 7370 6c69 7474 6572 5f64 6963 742c  f.splitter_dict,
-0001cb00: 2073 656c 662e 5350 4c49 5454 4552 5f52   self.SPLITTER_R
-0001cb10: 452c 2073 706c 6974 7465 725f 7265 290a  E, splitter_re).
-0001cb20: 2020 2020 2020 2020 7365 6c66 2e76 616c          self.val
-0001cb30: 6964 6174 655f 7265 2873 706c 6974 7465  idate_re(splitte
-0001cb40: 725f 7265 290a 0a20 2020 2064 6566 2061  r_re)..    def a
-0001cb50: 6464 5f73 7562 6e6f 6465 5f6b 6579 5f72  dd_subnode_key_r
-0001cb60: 6528 7365 6c66 2c20 6e61 6d65 2c20 7375  e(self, name, su
-0001cb70: 626e 6f64 655f 7265 293a 0a20 2020 2020  bnode_re):.     
-0001cb80: 2020 2022 2222 0a20 2020 2020 2020 2061     """.        a
-0001cb90: 6464 206e 616d 6564 2073 7562 6e6f 6465  dd named subnode
-0001cba0: 2072 6567 6578 2066 6f72 2070 6172 7369   regex for parsi
-0001cbb0: 6e67 206c 6973 7420 6974 656d 7320 6672  ng list items fr
-0001cbc0: 6f6d 2073 706c 6974 7469 6e67 0a20 2020  om splitting.   
-0001cbd0: 2020 2020 203a 7061 7261 6d20 6e61 6d65       :param name
-0001cbe0: 3a20 6e61 6d65 206f 6620 7265 2069 6e20  : name of re in 
-0001cbf0: 6469 6374 0a20 2020 2020 2020 203a 7061  dict.        :pa
-0001cc00: 7261 6d20 7375 626e 6f64 655f 7265 3a20  ram subnode_re: 
-0001cc10: 7265 6765 7820 746f 2073 746f 7265 0a20  regex to store. 
-0001cc20: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0001cc30: 2020 2073 656c 662e 6164 645f 6e61 6d65     self.add_name
-0001cc40: 645f 7661 6c75 6528 6e61 6d65 2c20 7375  d_value(name, su
-0001cc50: 626e 6f64 655f 7265 290a 0a20 2020 2064  bnode_re)..    d
-0001cc60: 6566 2061 6464 5f6e 616d 6564 5f76 616c  ef add_named_val
-0001cc70: 7565 2873 656c 662c 206e 616d 652c 2073  ue(self, name, s
-0001cc80: 7562 6e6f 6465 5f72 6529 3a0a 2020 2020  ubnode_re):.    
-0001cc90: 2020 2020 7365 6c66 2e61 6464 5f69 7465      self.add_ite
-0001cca0: 6d5f 746f 5f61 7272 6179 5f64 6963 7428  m_to_array_dict(
-0001ccb0: 7365 6c66 2e63 6875 6e6b 5f64 6963 742c  self.chunk_dict,
-0001ccc0: 206e 616d 652c 2073 7562 6e6f 6465 5f72   name, subnode_r
-0001ccd0: 6529 0a20 2020 2020 2020 2073 656c 662e  e).        self.
-0001cce0: 7661 6c69 6461 7465 5f72 6528 7375 626e  validate_re(subn
-0001ccf0: 6f64 655f 7265 290a 0a20 2020 2064 6566  ode_re)..    def
-0001cd00: 2073 6574 5f75 6e6d 6174 6368 6564 5f66   set_unmatched_f
-0001cd10: 6c61 6728 7365 6c66 2c20 756e 6d61 7463  lag(self, unmatc
-0001cd20: 6865 6429 3a0a 2020 2020 2020 2020 2222  hed):.        ""
-0001cd30: 220a 2020 2020 2020 2020 7365 7420 554e  ".        set UN
-0001cd40: 4d41 5443 4845 4420 626f 6f6c 6561 6e2e  MATCHED boolean.
-0001cd50: 2049 6620 7472 7565 2061 6464 7320 616c   If true adds al
-0001cd60: 6c20 756e 6d61 7463 6865 6420 7661 6c75  l unmatched valu
-0001cd70: 6573 2074 6f20 6469 6374 2075 6e64 6572  es to dict under
-0001cd80: 2055 4e4d 4154 4348 4544 0a20 2020 2020   UNMATCHED.     
-0001cd90: 2020 203a 7061 7261 6d20 756e 6d61 7463     :param unmatc
-0001cda0: 6865 643a 2061 6374 7320 6f6e 2063 7572  hed: acts on cur
-0001cdb0: 7265 6e74 206e 6f64 6573 6574 0a20 2020  rent nodeset.   
-0001cdc0: 2020 2020 203a 7061 7261 6d20 6d61 7463       :param matc
-0001cdd0: 685f 7479 7065 3a20 6164 6469 7469 6f6e  h_type: addition
-0001cde0: 616c 2064 6562 7567 2074 6f20 6e61 6d65  al debug to name
-0001cdf0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0001ce00: 2020 2020 2073 656c 662e 6368 756e 6b5f       self.chunk_
-0001ce10: 6469 6374 5b73 656c 662e 554e 4d41 5443  dict[self.UNMATC
-0001ce20: 4845 445d 203d 2075 6e6d 6174 6368 6564  HED] = unmatched
-0001ce30: 0a0a 2020 2020 6465 6620 7661 6c69 6461  ..    def valida
-0001ce40: 7465 5f72 6528 7365 6c66 2c20 7265 6765  te_re(self, rege
-0001ce50: 7829 3a0a 2020 2020 2020 2020 2222 220a  x):.        """.
-0001ce60: 2020 2020 2020 2020 3a70 6172 616d 2072          :param r
-0001ce70: 6567 6578 3a20 7265 6765 7820 746f 2062  egex: regex to b
-0001ce80: 6520 7661 6c69 6461 7465 640a 2020 2020  e validated.    
-0001ce90: 2020 2020 3a65 7863 6570 743a 2074 6872      :except: thr
-0001cea0: 6f77 7320 4578 6365 7074 696f 6e20 666f  ows Exception fo
-0001ceb0: 7220 6261 6420 7265 6765 780a 2020 2020  r bad regex.    
-0001cec0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0001ced0: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
-0001cee0: 2072 652e 636f 6d70 696c 6528 7265 6765   re.compile(rege
-0001cef0: 7829 0a20 2020 2020 2020 2065 7863 6570  x).        excep
-0001cf00: 7420 4578 6365 7074 696f 6e20 6173 2065  t Exception as e
-0001cf10: 3a0a 2020 2020 2020 2020 2020 2020 6c6f  :.            lo
-0001cf20: 6767 696e 672e 6572 726f 7228 6622 6261  gging.error(f"ba
-0001cf30: 6420 7265 6765 7820 7b72 6567 6578 7d22  d regex {regex}"
-0001cf40: 290a 2020 2020 2020 2020 2020 2020 7261  ).            ra
-0001cf50: 6973 6520 650a 0a20 2020 2064 6566 2061  ise e..    def a
-0001cf60: 6464 5f69 7465 6d5f 746f 5f61 7272 6179  dd_item_to_array
-0001cf70: 5f64 6963 7428 7365 6c66 2c20 7468 655f  _dict(self, the_
-0001cf80: 6469 6374 2c20 6b65 792c 2076 616c 7565  dict, key, value
-0001cf90: 293a 0a20 2020 2020 2020 2069 6620 6e6f  ):.        if no
-0001cfa0: 7420 7468 655f 6469 6374 2e67 6574 286b  t the_dict.get(k
-0001cfb0: 6579 293a 0a20 2020 2020 2020 2020 2020  ey):.           
-0001cfc0: 2074 6865 5f64 6963 745b 6b65 795d 203d   the_dict[key] =
-0001cfd0: 205b 5d0a 2020 2020 2020 2020 7468 655f   [].        the_
-0001cfe0: 6469 6374 5b6b 6579 5d2e 6170 7065 6e64  dict[key].append
-0001cff0: 2876 616c 7565 290a 0a0a 0a63 6c61 7373  (value)....class
-0001d000: 2055 524c 4361 6368 653a 0a20 2020 2064   URLCache:.    d
-0001d010: 6566 205f 5f69 6e69 745f 5f28 7365 6c66  ef __init__(self
-0001d020: 293a 0a20 2020 2020 2020 2073 656c 662e  ):.        self.
-0001d030: 7572 6c5f 6469 6374 203d 2064 6963 7428  url_dict = dict(
-0001d040: 290a 0a20 2020 2064 6566 2072 6561 645f  )..    def read_
-0001d050: 786d 6c5f 656c 656d 656e 745f 6672 6f6d  xml_element_from
-0001d060: 5f67 6974 6875 6228 7365 6c66 2c20 6769  _github(self, gi
-0001d070: 7468 7562 5f75 726c 2c20 6465 6c61 793d  thub_url, delay=
-0001d080: 3129 3a0a 2020 2020 2020 2020 2222 2272  1):.        """r
-0001d090: 6574 7269 6576 6573 2061 6e64 2070 6172  etrieves and par
-0001d0a0: 7365 7320 636f 6e74 656e 7420 6f66 2055  ses content of U
-0001d0b0: 524c 2e20 4361 6368 6573 2069 7420 6966  RL. Caches it if
-0001d0c0: 2066 6f75 6e64 0a20 2020 2020 2020 2072   found.        r
-0001d0d0: 6574 7572 6e73 2061 2064 6565 7063 6f70  eturns a deepcop
-0001d0e0: 7920 6173 2065 6c65 6d6e 7420 6973 206c  y as elemnt is l
-0001d0f0: 696b 656c 7920 746f 2062 6520 6564 6974  ikely to be edit
-0001d100: 6564 2222 220a 2020 2020 2020 2020 6874  ed""".        ht
-0001d110: 6d6c 5f65 6c65 6d20 3d20 7365 6c66 2e75  ml_elem = self.u
-0001d120: 726c 5f64 6963 742e 6765 7428 6769 7468  rl_dict.get(gith
-0001d130: 7562 5f75 726c 290a 2020 2020 2020 2020  ub_url).        
-0001d140: 6966 2068 746d 6c5f 656c 656d 2069 7320  if html_elem is 
-0001d150: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-0001d160: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
-0001d170: 2020 2020 2020 2068 746d 6c5f 656c 656d         html_elem
-0001d180: 203d 2058 6d6c 4c69 622e 7265 6164 5f78   = XmlLib.read_x
-0001d190: 6d6c 5f65 6c65 6d65 6e74 5f66 726f 6d5f  ml_element_from_
-0001d1a0: 6769 7468 7562 2867 6974 6875 625f 7572  github(github_ur
-0001d1b0: 6c3d 6769 7468 7562 5f75 726c 290a 2020  l=github_url).  
-0001d1c0: 2020 2020 2020 2020 2020 2020 2020 7469                ti
-0001d1d0: 6d65 2e73 6c65 6570 2864 656c 6179 290a  me.sleep(delay).
-0001d1e0: 2020 2020 2020 2020 2020 2020 6578 6365              exce
-0001d1f0: 7074 2045 7863 6570 7469 6f6e 2061 7320  pt Exception as 
-0001d200: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0001d210: 2020 2070 7269 6e74 2866 2263 616e 6e6f     print(f"canno
-0001d220: 7420 7265 6164 207b 6769 7468 7562 5f75  t read {github_u
-0001d230: 726c 7d20 6265 6361 7573 6520 7b65 7d22  rl} because {e}"
-0001d240: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001d250: 2020 7265 7475 726e 204e 6f6e 650a 2020    return None.  
-0001d260: 2020 2020 2020 2020 2020 7365 6c66 2e75            self.u
-0001d270: 726c 5f64 6963 745b 6769 7468 7562 5f75  rl_dict[github_u
-0001d280: 726c 5d20 3d20 6874 6d6c 5f65 6c65 6d0a  rl] = html_elem.
-0001d290: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0001d2a0: 2020 2020 2020 2020 2020 2320 7072 696e            # prin
-0001d2b0: 7428 6622 2066 6f75 6e64 2069 6e20 6361  t(f" found in ca
-0001d2c0: 6368 6521 2229 0a20 2020 2020 2020 2020  che!").         
-0001d2d0: 2020 2070 6173 730a 2020 2020 2020 2020     pass.        
-0001d2e0: 7265 7475 726e 2063 6f70 792e 6465 6570  return copy.deep
-0001d2f0: 636f 7079 2868 746d 6c5f 656c 656d 290a  copy(html_elem).
-0001d300: 0a0a 4944 203d 2022 6964 220a 4f42 4a45  ..ID = "id".OBJE
-0001d310: 4354 203d 226f 626a 6563 7422 0a53 5441  CT ="object".STA
-0001d320: 5254 454e 4420 3d20 2273 7461 7274 5f65  RTEND = "start_e
-0001d330: 6e64 220a 0a63 6c61 7373 2046 6c6f 6174  nd"..class Float
-0001d340: 426f 756e 6461 7279 4469 6374 3a0a 0a20  BoundaryDict:.. 
-0001d350: 2020 2064 6566 205f 5f69 6e69 745f 5f28     def __init__(
-0001d360: 7365 6c66 2c20 6874 6d6c 5f65 6c65 6d2c  self, html_elem,
-0001d370: 206f 7574 6469 723d 4e6f 6e65 293a 0a20   outdir=None):. 
-0001d380: 2020 2020 2020 2073 656c 662e 666c 6f61         self.floa
-0001d390: 745f 626f 756e 6461 7279 5f64 6963 7420  t_boundary_dict 
-0001d3a0: 3d20 6465 6661 756c 7464 6963 7428 6c69  = defaultdict(li
-0001d3b0: 7374 290a 2020 2020 2020 2020 7365 6c66  st).        self
-0001d3c0: 2e68 746d 6c5f 656c 656d 203d 2068 746d  .html_elem = htm
-0001d3d0: 6c5f 656c 656d 0a20 2020 2020 2020 2073  l_elem.        s
-0001d3e0: 656c 662e 6f75 7464 6972 203d 206f 7574  elf.outdir = out
-0001d3f0: 6469 720a 0a20 2020 2064 6566 2061 6464  dir..    def add
-0001d400: 5f6f 626a 6563 7428 7365 6c66 2c20 666c  _object(self, fl
-0001d410: 6f61 745f 626f 756e 6461 7279 293a 0a20  oat_boundary):. 
-0001d420: 2020 2020 2020 206b 6579 203d 2066 6c6f         key = flo
-0001d430: 6174 5f62 6f75 6e64 6172 792e 6b65 790a  at_boundary.key.
-0001d440: 2020 2020 2020 2020 7365 6c66 2e66 6c6f          self.flo
-0001d450: 6174 5f62 6f75 6e64 6172 795f 6469 6374  at_boundary_dict
-0001d460: 5b6b 6579 5d2e 6170 7065 6e64 2866 6c6f  [key].append(flo
-0001d470: 6174 5f62 6f75 6e64 6172 7929 0a0a 2020  at_boundary)..  
-0001d480: 2020 6465 6620 6164 645f 666c 6f61 745f    def add_float_
-0001d490: 626f 756e 6461 7269 6573 2873 656c 662c  boundaries(self,
-0001d4a0: 2066 6c6f 6174 5f62 6f75 6e64 6172 6965   float_boundarie
-0001d4b0: 7329 3a0a 2020 2020 2020 2020 666f 7220  s):.        for 
-0001d4c0: 666c 6f61 745f 626f 756e 6461 7279 2069  float_boundary i
-0001d4d0: 6e20 666c 6f61 745f 626f 756e 6461 7269  n float_boundari
-0001d4e0: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
-0001d4f0: 7365 6c66 2e61 6464 5f6f 626a 6563 7428  self.add_object(
-0001d500: 666c 6f61 745f 626f 756e 6461 7279 290a  float_boundary).
-0001d510: 0a20 2020 2064 6566 2065 7874 7261 6374  .    def extract
-0001d520: 5f63 6f6e 7465 6e74 735f 6f66 5f62 7261  _contents_of_bra
-0001d530: 636b 6574 6564 5f62 6f75 6e64 6172 6965  cketed_boundarie
-0001d540: 735f 616e 645f 7772 6974 6528 7365 6c66  s_and_write(self
-0001d550: 293a 0a20 2020 2020 2020 2066 6f72 2066  ):.        for f
-0001d560: 625f 6c69 7374 2069 6e20 7365 6c66 2e66  b_list in self.f
-0001d570: 6c6f 6174 5f62 6f75 6e64 6172 795f 6469  loat_boundary_di
-0001d580: 6374 2e76 616c 7565 7328 293a 0a20 2020  ct.values():.   
-0001d590: 2020 2020 2020 2020 2069 6620 6c65 6e28           if len(
-0001d5a0: 6662 5f6c 6973 7429 203d 3d20 323a 0a20  fb_list) == 2:. 
-0001d5b0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0001d5c0: 2070 7269 6e74 2866 2246 4220 7b66 625f   print(f"FB {fb_
-0001d5d0: 6c69 7374 7d20 7b66 625f 6c69 7374 5b30  list} {fb_list[0
-0001d5e0: 5d2e 6469 765f 6964 7d20 7b66 625f 6c69  ].div_id} {fb_li
-0001d5f0: 7374 5b31 5d2e 6469 765f 6964 7d22 290a  st[1].div_id}").
-0001d600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d610: 6e65 775f 6469 7620 3d20 7365 6c66 2e64  new_div = self.d
-0001d620: 656c 6574 655f 6265 7477 6565 6e28 6662  elete_between(fb
-0001d630: 5f6c 6973 745b 305d 2e64 6976 5f69 642c  _list[0].div_id,
-0001d640: 2066 625f 6c69 7374 5b31 5d2e 6469 765f   fb_list[1].div_
-0001d650: 6964 290a 2020 2020 2020 2020 2020 2020  id).            
-0001d660: 2020 2020 666c 6f61 745f 6e61 6d65 203d      float_name =
-0001d670: 2066 625f 6c69 7374 5b30 5d2e 6b65 790a   fb_list[0].key.
-0001d680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d690: 6e65 775f 6469 762e 6174 7472 6962 5b22  new_div.attrib["
-0001d6a0: 6e61 6d65 225d 203d 2066 6c6f 6174 5f6e  name"] = float_n
-0001d6b0: 616d 650a 2020 2020 2020 2020 2020 2020  ame.            
-0001d6c0: 2020 2020 6e65 775f 6874 6d6c 5f65 6c65      new_html_ele
-0001d6d0: 6d20 3d20 4874 6d6c 4c69 622e 6372 6561  m = HtmlLib.crea
-0001d6e0: 7465 5f6e 6577 5f68 746d 6c5f 7769 7468  te_new_html_with
-0001d6f0: 5f6f 6c64 5f73 7479 6c65 7328 7365 6c66  _old_styles(self
-0001d700: 2e68 746d 6c5f 656c 656d 290a 2020 2020  .html_elem).    
-0001d710: 2020 2020 2020 2020 2020 2020 4874 6d6c              Html
-0001d720: 4c69 622e 6765 745f 626f 6479 286e 6577  Lib.get_body(new
-0001d730: 5f68 746d 6c5f 656c 656d 292e 6170 7065  _html_elem).appe
-0001d740: 6e64 286e 6577 5f64 6976 290a 2020 2020  nd(new_div).    
-0001d750: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-0001d760: 656c 662e 6f75 7464 6972 3a0a 2020 2020  elf.outdir:.    
-0001d770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d780: 5061 7468 2873 656c 662e 6f75 7464 6972  Path(self.outdir
-0001d790: 292e 6d6b 6469 7228 6578 6973 745f 6f6b  ).mkdir(exist_ok
-0001d7a0: 3d54 7275 652c 2070 6172 656e 7473 3d46  =True, parents=F
-0001d7b0: 616c 7365 290a 2020 2020 2020 2020 2020  alse).          
-0001d7c0: 2020 2020 2020 2020 2020 6669 6c65 5f73            file_s
-0001d7d0: 7465 6d20 3d20 666c 6f61 745f 6e61 6d65  tem = float_name
-0001d7e0: 2e6c 6f77 6572 2829 2e72 6570 6c61 6365  .lower().replace
-0001d7f0: 2822 5c5c 732a 222c 2022 2229 0a20 2020  ("\\s*", "").   
-0001d800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d810: 2058 6d6c 4c69 622e 7772 6974 655f 786d   XmlLib.write_xm
-0001d820: 6c28 6e65 775f 6874 6d6c 5f65 6c65 6d2c  l(new_html_elem,
-0001d830: 2050 6174 6828 7365 6c66 2e6f 7574 6469   Path(self.outdi
-0001d840: 722c 2066 696c 655f 7374 656d 202b 2022  r, file_stem + "
-0001d850: 2e68 746d 6c22 2929 0a0a 2020 2020 6465  .html"))..    de
-0001d860: 6620 6465 6c65 7465 5f62 6574 7765 656e  f delete_between
-0001d870: 2873 656c 662c 2064 6976 5f69 6430 2c20  (self, div_id0, 
-0001d880: 6469 765f 6964 3129 3a0a 2020 2020 2020  div_id1):.      
-0001d890: 2020 656c 656d 3020 3d20 7365 6c66 2e68    elem0 = self.h
-0001d8a0: 746d 6c5f 656c 656d 2e78 7061 7468 2866  tml_elem.xpath(f
-0001d8b0: 222e 2f2f 6469 765b 4069 643d 277b 6469  ".//div[@id='{di
-0001d8c0: 765f 6964 307d 275d 2229 5b30 5d0a 2020  v_id0}']")[0].  
-0001d8d0: 2020 2020 2020 656c 656d 3120 3d20 7365        elem1 = se
-0001d8e0: 6c66 2e68 746d 6c5f 656c 656d 2e78 7061  lf.html_elem.xpa
-0001d8f0: 7468 2866 222e 2f2f 6469 765b 4069 643d  th(f".//div[@id=
-0001d900: 277b 6469 765f 6964 317d 275d 2229 5b30  '{div_id1}']")[0
-0001d910: 5d0a 2020 2020 2020 2020 666f 6c6c 6f77  ].        follow
-0001d920: 696e 6720 3d20 656c 656d 302e 7870 6174  ing = elem0.xpat
-0001d930: 6828 2266 6f6c 6c6f 7769 6e67 3a3a 2a22  h("following::*"
-0001d940: 290a 2020 2020 2020 2020 6e65 775f 6469  ).        new_di
-0001d950: 7620 3d20 4554 2e45 6c65 6d65 6e74 2822  v = ET.Element("
-0001d960: 6469 7622 290a 2020 2020 2020 2020 6e65  div").        ne
-0001d970: 775f 6469 762e 6174 7472 6962 5b22 6964  w_div.attrib["id
-0001d980: 225d 203d 2064 6976 5f69 6430 0a20 2020  "] = div_id0.   
-0001d990: 2020 2020 2066 6f72 2066 6f6c 6c6f 7720       for follow 
-0001d9a0: 696e 2066 6f6c 6c6f 7769 6e67 3a0a 2020  in following:.  
-0001d9b0: 2020 2020 2020 2020 2020 6964 5f20 3d20            id_ = 
-0001d9c0: 666f 6c6c 6f77 2e61 7474 7269 625b 2769  follow.attrib['i
-0001d9d0: 6427 5d0a 2020 2020 2020 2020 2020 2020  d'].            
-0001d9e0: 6e65 775f 6469 762e 6170 7065 6e64 2866  new_div.append(f
-0001d9f0: 6f6c 6c6f 7729 0a20 2020 2020 2020 2020  ollow).         
-0001da00: 2020 2023 2066 6f6c 6c6f 772e 6765 7470     # follow.getp
-0001da10: 6172 656e 7428 292e 7265 6d6f 7665 2866  arent().remove(f
-0001da20: 6f6c 6c6f 7729 0a20 2020 2020 2020 2020  ollow).         
-0001da30: 2020 2069 6620 6964 5f20 3d3d 2064 6976     if id_ == div
-0001da40: 5f69 6431 3a0a 2020 2020 2020 2020 2020  _id1:.          
-0001da50: 2020 2020 2020 7072 696e 7428 2245 5849        print("EXI
-0001da60: 5422 290a 2020 2020 2020 2020 2020 2020  T").            
-0001da70: 2020 2020 6272 6561 6b0a 2020 2020 2020      break.      
-0001da80: 2020 7265 7475 726e 206e 6577 5f64 6976    return new_div
-0001da90: 0a0a 0a0a 636c 6173 7320 466c 6f61 7442  ....class FloatB
-0001daa0: 6f75 6e64 6172 793a 0a20 2020 2022 2222  oundary:.    """
-0001dab0: 0a20 2020 2048 6f6c 6473 0a20 2020 2022  .    Holds.    "
-0001dac0: 2222 0a20 2020 2049 5043 435f 424f 554e  "".    IPCC_BOUN
-0001dad0: 4441 5259 203d 2022 5c5c 5b3f 2220 5c0a  DARY = "\\[?" \.
-0001dae0: 2020 2020 2020 2020 2020 2020 6622 283f              f"(?
-0001daf0: 503c 7b53 5441 5254 454e 447d 3e53 5441  P<{STARTEND}>STA
-0001db00: 5254 7c45 4e44 295c 5c73 2a22 205c 0a20  RT|END)\\s*" \. 
-0001db10: 2020 2020 2020 2020 2020 2066 2228 3f50             f"(?P
-0001db20: 3c7b 4f42 4a45 4354 7d3e 2e2a 424f 587c  <{OBJECT}>.*BOX|
-0001db30: 4649 4755 5245 7c54 4142 4c45 295c 5c73  FIGURE|TABLE)\\s
-0001db40: 2a22 205c 0a20 2020 2020 2020 2020 2020  *" \.           
-0001db50: 2066 2228 3f50 3c7b 4944 7d3e 283f 3a28   f"(?P<{ID}>(?:(
-0001db60: 3f3a 5b41 2d5a 302d 395d 2b7c 5c5c 642b  ?:[A-Z0-9]+|\\d+
-0001db70: 293f 283f 3a5c 5c2e 5c5c 642b 292a 2929  )?(?:\\.\\d+)*))
-0001db80: 5c5c 732a 283f 3a48 4552 4529 5c5c 5d3f  \\s*(?:HERE)\\]?
-0001db90: 220a 0a20 2020 2023 205b 5354 4152 5420  "..    # [START 
-0001dba0: 4352 4f53 532d 5345 4354 494f 4e20 424f  CROSS-SECTION BO
-0001dbb0: 582e 3120 4845 5245 5d0a 0a20 2020 2064  X.1 HERE]..    d
-0001dbc0: 6566 205f 5f69 6e69 745f 5f28 7365 6c66  ef __init__(self
-0001dbd0: 293a 0a20 2020 2020 2020 2073 656c 662e  ):.        self.
-0001dbe0: 6772 6f75 705f 6469 6374 203d 2064 6963  group_dict = dic
-0001dbf0: 7428 290a 2020 2020 2020 2020 7365 6c66  t().        self
-0001dc00: 2e73 7461 7274 203d 204e 6f6e 650a 2020  .start = None.  
-0001dc10: 2020 2020 2020 7365 6c66 2e65 6e64 203d        self.end =
-0001dc20: 204e 6f6e 650a 2020 2020 2020 2020 7365   None.        se
-0001dc30: 6c66 2e64 6976 5f69 6420 3d20 4e6f 6e65  lf.div_id = None
-0001dc40: 0a0a 2020 2020 6465 6620 5f5f 7374 725f  ..    def __str_
-0001dc50: 5f28 7365 6c66 293a 0a20 2020 2020 2020  _(self):.       
-0001dc60: 2072 6574 7572 6e20 7365 6c66 2e67 726f   return self.gro
-0001dc70: 7570 5f64 6963 742e 6765 7428 5354 4152  up_dict.get(STAR
-0001dc80: 5445 4e44 2920 2b20 223b 2220 2b20 2073  TEND) + ";" +  s
-0001dc90: 656c 662e 6772 6f75 705f 6469 6374 2e67  elf.group_dict.g
-0001dca0: 6574 284f 424a 4543 5429 202b 2022 3b22  et(OBJECT) + ";"
-0001dcb0: 202b 2020 7365 6c66 2e67 726f 7570 5f64   +  self.group_d
-0001dcc0: 6963 742e 6765 7428 4944 290a 0a20 2020  ict.get(ID)..   
-0001dcd0: 2064 6566 205f 5f72 6570 725f 5f28 7365   def __repr__(se
-0001dce0: 6c66 293a 0a20 2020 2020 2020 2072 6574  lf):.        ret
-0001dcf0: 7572 6e20 7365 6c66 2e5f 5f73 7472 5f5f  urn self.__str__
-0001dd00: 2829 0a0a 2020 2020 6465 6620 6164 6428  ()..    def add(
-0001dd10: 7365 6c66 2c20 6e61 6d65 2c20 7661 6c75  self, name, valu
-0001dd20: 6529 3a0a 2020 2020 2020 2020 7365 6c66  e):.        self
-0001dd30: 2e67 726f 7570 5f64 6963 745b 6e61 6d65  .group_dict[name
-0001dd40: 5d20 3d20 7661 6c75 650a 0a20 2020 2040  ] = value..    @
-0001dd50: 7072 6f70 6572 7479 0a20 2020 2064 6566  property.    def
-0001dd60: 206b 6579 2873 656c 6629 3a0a 2020 2020   key(self):.    
-0001dd70: 2020 2020 7265 7475 726e 2073 7472 2873      return str(s
-0001dd80: 656c 662e 6772 6f75 705f 6469 6374 5b4f  elf.group_dict[O
-0001dd90: 424a 4543 545d 2920 2b20 7374 7228 7365  BJECT]) + str(se
-0001dda0: 6c66 2e67 726f 7570 5f64 6963 745b 4944  lf.group_dict[ID
-0001ddb0: 5d29 0a0a 2020 2020 4070 726f 7065 7274  ])..    @propert
-0001ddc0: 790a 2020 2020 6465 6620 7374 6172 745f  y.    def start_
-0001ddd0: 656e 6428 7365 6c66 293a 0a20 2020 2020  end(self):.     
-0001dde0: 2020 2072 6574 7572 6e20 7365 6c66 2e67     return self.g
-0001ddf0: 726f 7570 5f64 6963 745b 5354 4152 5445  roup_dict[STARTE
-0001de00: 4e44 5d0a 0a20 2020 2040 636c 6173 736d  ND]..    @classm
-0001de10: 6574 686f 640a 2020 2020 6465 6620 6578  ethod.    def ex
-0001de20: 7472 6163 745f 666c 6f61 7473 5f61 6e64  tract_floats_and
-0001de30: 5f62 6f75 6e64 6172 6965 7328 636c 732c  _boundaries(cls,
-0001de40: 2068 746d 6c5f 656c 656d 2c20 7061 636b   html_elem, pack
-0001de50: 6167 652c 206f 7574 6469 723d 4e6f 6e65  age, outdir=None
-0001de60: 293a 0a20 2020 2020 2020 2072 6567 6578  ):.        regex
-0001de70: 203d 2046 6c6f 6174 426f 756e 6461 7279   = FloatBoundary
-0001de80: 2e49 5043 435f 424f 554e 4441 5259 0a20  .IPCC_BOUNDARY. 
-0001de90: 2020 2020 2020 2066 6c6f 6174 5f62 6f75         float_bou
-0001dea0: 6e64 6172 6965 7320 3d20 466c 6f61 7445  ndaries = FloatE
-0001deb0: 7874 7261 6374 6f72 2829 2e65 7874 7261  xtractor().extra
-0001dec0: 6374 5f66 6c6f 6174 5f62 6f75 6e64 6172  ct_float_boundar
-0001ded0: 6965 7328 6874 6d6c 5f65 6c65 6d2c 2072  ies(html_elem, r
-0001dee0: 6567 6578 290a 2020 2020 2020 2020 666c  egex).        fl
-0001def0: 6f61 745f 626f 756e 6461 7279 5f64 6963  oat_boundary_dic
-0001df00: 7420 3d20 466c 6f61 7442 6f75 6e64 6172  t = FloatBoundar
-0001df10: 7944 6963 7428 6874 6d6c 5f65 6c65 6d2c  yDict(html_elem,
-0001df20: 206f 7574 6469 723d 6f75 7464 6972 290a   outdir=outdir).
-0001df30: 2020 2020 2020 2020 666c 6f61 745f 626f          float_bo
-0001df40: 756e 6461 7279 5f64 6963 742e 6164 645f  undary_dict.add_
-0001df50: 666c 6f61 745f 626f 756e 6461 7269 6573  float_boundaries
-0001df60: 2866 6c6f 6174 5f62 6f75 6e64 6172 6965  (float_boundarie
-0001df70: 7329 0a20 2020 2020 2020 2066 6c6f 6174  s).        float
-0001df80: 5f62 6f75 6e64 6172 795f 6469 6374 2e65  _boundary_dict.e
-0001df90: 7874 7261 6374 5f63 6f6e 7465 6e74 735f  xtract_contents_
-0001dfa0: 6f66 5f62 7261 636b 6574 6564 5f62 6f75  of_bracketed_bou
-0001dfb0: 6e64 6172 6965 735f 616e 645f 7772 6974  ndaries_and_writ
-0001dfc0: 6528 290a 2020 2020 2020 2020 7265 7475  e().        retu
-0001dfd0: 726e 2068 746d 6c5f 656c 656d 0a0a 0a63  rn html_elem...c
-0001dfe0: 6c61 7373 2046 6c6f 6174 4578 7472 6163  lass FloatExtrac
-0001dff0: 746f 723a 0a20 2020 2022 2222 6578 7472  tor:.    """extr
-0001e000: 6163 7473 2066 6c6f 6174 7320 2862 6f78  acts floats (box
-0001e010: 6573 2c20 6669 6775 7265 732c 2065 7463  es, figures, etc
-0001e020: 2e29 2075 7369 6e67 2073 7461 7274 2f65  .) using start/e
-0001e030: 6e64 2072 6567 6578 6573 0a20 2020 2022  nd regexes.    "
-0001e040: 2222 0a0a 2020 2020 6465 6620 5f5f 696e  ""..    def __in
-0001e050: 6974 5f5f 2873 656c 662c 2072 6567 6578  it__(self, regex
-0001e060: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
-0001e070: 7365 6c66 2e72 6567 6578 203d 2072 6567  self.regex = reg
-0001e080: 6578 0a0a 2020 2020 6465 6620 6578 7472  ex..    def extr
-0001e090: 6163 745f 666c 6f61 745f 626f 756e 6461  act_float_bounda
-0001e0a0: 7269 6573 2873 656c 662c 2068 746d 6c5f  ries(self, html_
-0001e0b0: 656c 656d 2c20 7265 6765 785f 7374 7229  elem, regex_str)
-0001e0c0: 3a0a 2020 2020 2020 2020 666c 6f61 745f  :.        float_
-0001e0d0: 626f 756e 6461 7269 6573 203d 205b 5d0a  boundaries = [].
-0001e0e0: 2020 2020 2020 2020 7265 6765 7820 3d20          regex = 
-0001e0f0: 7265 2e63 6f6d 7069 6c65 2872 6567 6578  re.compile(regex
-0001e100: 5f73 7472 290a 2020 2020 2020 2020 2320  _str).        # 
-0001e110: 7072 696e 7428 6622 2072 6567 6578 207b  print(f" regex {
-0001e120: 7265 6765 787d 2229 0a20 2020 2020 2020  regex}").       
-0001e130: 2064 6976 7320 3d20 6874 6d6c 5f65 6c65   divs = html_ele
-0001e140: 6d2e 7870 6174 6828 222e 2f2f 6469 7622  m.xpath(".//div"
-0001e150: 290a 2020 2020 2020 2020 666f 7220 6469  ).        for di
-0001e160: 7620 696e 2064 6976 733a 0a20 2020 2020  v in divs:.     
-0001e170: 2020 2020 2020 2073 7061 6e73 203d 2064         spans = d
-0001e180: 6976 2e78 7061 7468 2822 2e2f 7370 616e  iv.xpath("./span
-0001e190: 2229 0a20 2020 2020 2020 2020 2020 2066  ").            f
-0001e1a0: 6f72 2073 7061 6e20 696e 2073 7061 6e73  or span in spans
-0001e1b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001e1c0: 2020 6d61 7463 6820 3d20 7265 2e73 6561    match = re.sea
-0001e1d0: 7263 6828 7265 6765 782c 2073 7061 6e2e  rch(regex, span.
-0001e1e0: 7465 7874 290a 2020 2020 2020 2020 2020  text).          
-0001e1f0: 2020 2020 2020 6966 206d 6174 6368 3a0a        if match:.
-0001e200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e210: 2020 2020 666c 6f61 745f 626f 756e 6461      float_bounda
-0001e220: 7279 203d 2046 6c6f 6174 426f 756e 6461  ry = FloatBounda
-0001e230: 7279 2829 0a20 2020 2020 2020 2020 2020  ry().           
-0001e240: 2020 2020 2020 2020 2066 6c6f 6174 5f62           float_b
-0001e250: 6f75 6e64 6172 792e 6469 765f 6964 203d  oundary.div_id =
-0001e260: 2064 6976 2e61 7474 7269 625b 2269 6422   div.attrib["id"
-0001e270: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-0001e280: 2020 2020 2020 666f 7220 6669 656c 6420        for field 
-0001e290: 696e 205b 5354 4152 5445 4e44 2c20 4f42  in [STARTEND, OB
-0001e2a0: 4a45 4354 2c20 4944 5d3a 0a20 2020 2020  JECT, ID]:.     
-0001e2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e2c0: 2020 2066 6c6f 6174 5f62 6f75 6e64 6172     float_boundar
-0001e2d0: 792e 6164 6428 6669 656c 642c 206d 6174  y.add(field, mat
-0001e2e0: 6368 2e67 726f 7570 2866 6965 6c64 2929  ch.group(field))
-0001e2f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001e300: 2020 2020 2066 6c6f 6174 5f62 6f75 6e64       float_bound
-0001e310: 6172 6965 732e 6170 7065 6e64 2866 6c6f  aries.append(flo
-0001e320: 6174 5f62 6f75 6e64 6172 7929 0a20 2020  at_boundary).   
-0001e330: 2020 2020 2072 6574 7572 6e20 666c 6f61       return floa
-0001e340: 745f 626f 756e 6461 7269 6573 0a0a 0a0a  t_boundaries....
-0001e350: 636c 6173 7320 4353 5353 7479 6c65 3a0a  class CSSStyle:.
-0001e360: 2020 2020 2222 220a 2020 2020 636f 6d6d      """.    comm
-0001e370: 6f6e 2073 7562 7365 7420 6f66 2043 5353  on subset of CSS
-0001e380: 2073 7479 6c65 732f 636f 6d6d 616e 6473   styles/commands
-0001e390: 0a20 2020 2022 2222 0a20 2020 2023 2061  .    """.    # a
-0001e3a0: 6c6c 2061 7265 206c 6f77 6572 6361 7365  ll are lowercase
-0001e3b0: 0a20 2020 2042 4f4c 4420 3d20 2262 6f6c  .    BOLD = "bol
-0001e3c0: 6422 0a20 2020 2042 4f52 4445 5220 3d20  d".    BORDER = 
-0001e3d0: 2262 6f72 6465 7222 0a20 2020 2042 4f54  "border".    BOT
-0001e3e0: 544f 4d20 3d20 2262 6f74 746f 6d22 0a20  TOM = "bottom". 
-0001e3f0: 2020 2043 4f4c 4f52 203d 2022 636f 6c6f     COLOR = "colo
-0001e400: 7222 0a20 2020 2044 4f54 5f42 203d 2022  r".    DOT_B = "
-0001e410: 2e42 220a 2020 2020 4649 4c4c 203d 2022  .B".    FILL = "
-0001e420: 6669 6c6c 220a 2020 2020 5354 524f 4b45  fill".    STROKE
-0001e430: 203d 2022 7374 726f 6b65 220a 2020 2020   = "stroke".    
-0001e440: 464f 4e54 5f46 414d 494c 5920 3d20 2266  FONT_FAMILY = "f
-0001e450: 6f6e 742d 6661 6d69 6c79 220a 2020 2020  ont-family".    
-0001e460: 464f 4e54 5f53 495a 4520 3d20 2266 6f6e  FONT_SIZE = "fon
-0001e470: 742d 7369 7a65 220a 2020 2020 464f 4e54  t-size".    FONT
-0001e480: 5f53 5459 4c45 203d 2022 666f 6e74 2d73  _STYLE = "font-s
-0001e490: 7479 6c65 220a 2020 2020 464f 4e54 5f53  tyle".    FONT_S
-0001e4a0: 5452 4554 4348 4544 203d 2022 666f 6e74  TRETCHED = "font
-0001e4b0: 2d73 7472 6574 6368 6564 220a 2020 2020  -stretched".    
-0001e4c0: 464f 4e54 5f57 4549 4748 5420 3d20 2266  FONT_WEIGHT = "f
-0001e4d0: 6f6e 742d 7765 6967 6874 220a 2020 2020  ont-weight".    
-0001e4e0: 4845 4947 4854 203d 2022 6865 6967 6874  HEIGHT = "height
-0001e4f0: 220a 2020 2020 4954 414c 4943 203d 2022  ".    ITALIC = "
-0001e500: 6974 616c 6963 220a 2020 2020 4c45 4654  italic".    LEFT
-0001e510: 203d 2022 6c65 6674 220a 2020 2020 4c49   = "left".    LI
-0001e520: 4748 5420 3d20 226c 6967 6874 220a 2020  GHT = "light".  
-0001e530: 2020 4e4f 524d 414c 203d 2022 6e6f 726d    NORMAL = "norm
-0001e540: 616c 220a 2020 2020 4f50 4143 4954 5920  al".    OPACITY 
-0001e550: 3d20 226f 7061 6369 7479 220a 2020 2020  = "opacity".    
-0001e560: 504f 5349 5449 4f4e 203d 2022 706f 7369  POSITION = "posi
-0001e570: 7469 6f6e 220a 2020 2020 5058 203d 2022  tion".    PX = "
-0001e580: 7078 220a 2020 2020 5354 594c 4520 3d20  px".    STYLE = 
-0001e590: 2273 7479 6c65 220a 2020 2020 544f 5020  "style".    TOP 
-0001e5a0: 3d20 2274 6f70 220a 2020 2020 5749 4454  = "top".    WIDT
-0001e5b0: 4820 3d20 2277 6964 7468 220a 0a20 2020  H = "width"..   
-0001e5c0: 2057 4549 4748 545f 5245 203d 2022 285b   WEIGHT_RE = "([
-0001e5d0: 2d2e 5d3f 426f 6c64 7c5b 2e5d 5b42 625d  -.]?Bold|[.][Bb]
-0001e5e0: 2429 220a 2020 2020 5354 594c 455f 5245  $)".    STYLE_RE
-0001e5f0: 203d 2022 285b 2d2e 5d3f 4974 616c 283a   = "([-.]?Ital(:
-0001e600: 3f69 6329 7c5b 2d2e 5d3f 4f62 6c69 7175  ?ic)|[-.]?Obliqu
-0001e610: 657c 5b2e 5d5b 4969 5d24 2922 0a0a 2020  e|[.][Ii]$)"..  
-0001e620: 2020 5445 5854 5f53 5459 4c45 5f43 4f4d    TEXT_STYLE_COM
-0001e630: 504f 4e45 4e54 5320 3d20 5b46 4f4e 545f  PONENTS = [FONT_
-0001e640: 5354 594c 452c 2046 4f4e 545f 5745 4947  STYLE, FONT_WEIG
-0001e650: 4854 2c20 464f 4e54 5f46 414d 494c 592c  HT, FONT_FAMILY,
-0001e660: 2046 4f4e 545f 5349 5a45 2c20 434f 4c4f   FONT_SIZE, COLO
-0001e670: 522c 204f 5041 4349 5459 5d0a 0a20 2020  R, OPACITY]..   
-0001e680: 2064 6566 205f 5f69 6e69 745f 5f28 7365   def __init__(se
-0001e690: 6c66 293a 0a20 2020 2020 2020 2073 656c  lf):.        sel
-0001e6a0: 662e 6e61 6d65 5f76 616c 7565 5f64 6963  f.name_value_dic
-0001e6b0: 7420 3d20 6469 6374 2829 0a0a 2020 2020  t = dict()..    
-0001e6c0: 6465 6620 5f5f 7374 725f 5f28 7365 6c66  def __str__(self
-0001e6d0: 293a 0a20 2020 2020 2020 2073 203d 2022  ):.        s = "
-0001e6e0: 220a 2020 2020 2020 2020 666f 7220 6b2c  ".        for k,
-0001e6f0: 2076 2069 6e20 7365 6c66 2e6e 616d 655f   v in self.name_
-0001e700: 7661 6c75 655f 6469 6374 2e69 7465 6d73  value_dict.items
-0001e710: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
-0001e720: 7320 2b3d 2066 227b 6b7d 3a7b 767d 3b20  s += f"{k}:{v}; 
-0001e730: 220a 2020 2020 2020 2020 7320 3d20 732e  ".        s = s.
-0001e740: 7374 7269 7028 290a 2020 2020 2020 2020  strip().        
-0001e750: 7265 7475 726e 2073 0a0a 2020 2020 6465  return s..    de
-0001e760: 6620 5f5f 7265 7072 5f5f 2873 656c 6629  f __repr__(self)
-0001e770: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-0001e780: 2066 227b 7365 6c66 2e6e 616d 655f 7661   f"{self.name_va
-0001e790: 6c75 655f 6469 6374 7d22 0a0a 2320 2020  lue_dict}"..#   
-0001e7a0: 2063 6c61 7373 2043 5353 5374 796c 653a   class CSSStyle:
-0001e7b0: 0a0a 2020 2020 4063 6c61 7373 6d65 7468  ..    @classmeth
-0001e7c0: 6f64 0a20 2020 2064 6566 2063 7265 6174  od.    def creat
-0001e7d0: 655f 6373 735f 7374 796c 655f 6672 6f6d  e_css_style_from
-0001e7e0: 5f61 7474 7269 6275 7465 5f6f 665f 626f  _attribute_of_bo
-0001e7f0: 6479 5f65 6c65 6d65 6e74 2863 6c73 2c20  dy_element(cls, 
-0001e800: 656c 656d 293a 0a20 2020 2020 2020 2022  elem):.        "
-0001e810: 2222 6372 6561 7465 2043 5353 5374 796c  ""create CSSStyl
-0001e820: 6520 6f62 6a65 6374 2066 726f 6d20 656c  e object from el
-0001e830: 656d 0a20 2020 2020 2020 203a 7061 7261  em.        :para
-0001e840: 6d20 656c 656d 3a0a 2020 2020 2020 2020  m elem:.        
-0001e850: 2222 220a 2020 2020 2020 2020 6966 2065  """.        if e
-0001e860: 6c65 6d20 6973 204e 6f6e 653a 0a20 2020  lem is None:.   
-0001e870: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0001e880: 4e6f 6e65 0a20 2020 2020 2020 2061 7373  None.        ass
-0001e890: 6572 7420 7479 7065 2865 6c65 6d29 2069  ert type(elem) i
-0001e8a0: 7320 5f45 6c65 6d65 6e74 2c20 6622 666f  s _Element, f"fo
-0001e8b0: 756e 6420 7b74 7970 6528 656c 656d 297d  und {type(elem)}
-0001e8c0: 220a 2020 2020 2020 2020 6373 735f 7374  ".        css_st
-0001e8d0: 796c 6520 3d20 4353 5353 7479 6c65 2829  yle = CSSStyle()
-0001e8e0: 0a20 2020 2020 2020 2073 7479 6c65 5f61  .        style_a
-0001e8f0: 7474 7661 6c20 3d20 656c 656d 2e67 6574  ttval = elem.get
-0001e900: 2843 5353 5374 796c 652e 5354 594c 4529  (CSSStyle.STYLE)
-0001e910: 0a20 2020 2020 2020 2063 7373 5f73 7479  .        css_sty
-0001e920: 6c65 2e6e 616d 655f 7661 6c75 655f 6469  le.name_value_di
-0001e930: 6374 203d 2063 6c73 2e63 7265 6174 655f  ct = cls.create_
-0001e940: 6469 6374 5f66 726f 6d5f 6e61 6d65 5f76  dict_from_name_v
-0001e950: 616c 7565 5f61 7272 6179 5f73 7472 696e  alue_array_strin
-0001e960: 6728 7374 796c 655f 6174 7476 616c 290a  g(style_attval).
-0001e970: 2020 2020 2020 2020 7265 7475 726e 2063          return c
-0001e980: 7373 5f73 7479 6c65 0a0a 2020 2020 2320  ss_style..    # 
-0001e990: 2020 2063 6c61 7373 2043 5353 5374 796c     class CSSStyl
-0001e9a0: 653a 0a0a 2020 2020 4063 6c61 7373 6d65  e:..    @classme
-0001e9b0: 7468 6f64 0a20 2020 2064 6566 2063 7265  thod.    def cre
-0001e9c0: 6174 655f 6469 6374 5f66 726f 6d5f 6e61  ate_dict_from_na
-0001e9d0: 6d65 5f76 616c 7565 5f61 7272 6179 5f73  me_value_array_s
-0001e9e0: 7472 696e 6728 636c 732c 2073 7479 6c65  tring(cls, style
-0001e9f0: 5f73 7472 2c20 7265 6d6f 7665 5f63 7572  _str, remove_cur
-0001ea00: 6c79 3d54 7275 6529 3a0a 2020 2020 2020  ly=True):.      
-0001ea10: 2020 2222 220a 2020 2020 2020 2020 6173    """.        as
-0001ea20: 7375 6d65 7320 7374 7269 6e67 206f 6620  sumes string of 
-0001ea30: 7479 7065 2022 613a 2062 3b20 633a 2064  type "a: b; c: d
-0001ea40: 3b22 206f 7074 696f 6e61 6c6c 7920 656e  ;" optionally en
-0001ea50: 636c 6f73 6564 2069 6e20 7b2e 2e2e 7d0a  closed in {...}.
-0001ea60: 2020 2020 2020 2020 3a70 6172 616d 2073          :param s
-0001ea70: 7479 6c65 5f73 7472 3a20 0a20 2020 2020  tyle_str: .     
-0001ea80: 2020 2022 2222 0a20 2020 2020 2020 2072     """.        r
-0001ea90: 655f 7374 7220 3d20 2228 3f50 3c70 7265  e_str = "(?P<pre
-0001eaa0: 3e2e 2a29 7b28 3f50 3c63 7572 6c79 3e2e  >.*){(?P<curly>.
-0001eab0: 2a29 7d28 3f50 3c70 6f73 743e 2e2a 2922  *)}(?P<post>.*)"
-0001eac0: 0a20 2020 2020 2020 2063 7572 6c79 5f72  .        curly_r
-0001ead0: 6520 3d20 7265 2e63 6f6d 7069 6c65 2872  e = re.compile(r
-0001eae0: 655f 7374 7229 0a20 2020 2020 2020 206e  e_str).        n
-0001eaf0: 616d 655f 7661 6c75 655f 6469 6374 203d  ame_value_dict =
-0001eb00: 2064 6963 7428 290a 2020 2020 2020 2020   dict().        
-0001eb10: 6966 2074 7970 6528 7374 796c 655f 7374  if type(style_st
-0001eb20: 7229 2069 7320 4353 5353 7479 6c65 3a0a  r) is CSSStyle:.
-0001eb30: 2020 2020 2020 2020 2020 2020 7374 796c              styl
-0001eb40: 655f 7374 7220 3d20 7374 796c 655f 7374  e_str = style_st
-0001eb50: 722e 6765 745f 6373 735f 7661 6c75 6528  r.get_css_value(
-0001eb60: 7374 796c 655f 7374 7229 0a20 2020 2020  style_str).     
-0001eb70: 2020 2069 6620 7374 796c 655f 7374 723a     if style_str:
-0001eb80: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0001eb90: 7265 6d6f 7665 5f63 7572 6c79 3a0a 2020  remove_curly:.  
-0001eba0: 2020 2020 2020 2020 2020 2020 2020 6d61                ma
-0001ebb0: 7463 6820 3d20 6375 726c 795f 7265 2e6d  tch = curly_re.m
-0001ebc0: 6174 6368 2873 7479 6c65 5f73 7472 290a  atch(style_str).
-0001ebd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ebe0: 6966 206d 6174 6368 3a0a 2020 2020 2020  if match:.      
-0001ebf0: 2020 2020 2020 2020 2020 2020 2020 7374                st
-0001ec00: 796c 655f 7374 7220 3d20 6d61 7463 682e  yle_str = match.
-0001ec10: 6772 6f75 7028 2263 7572 6c79 2229 0a20  group("curly"). 
-0001ec20: 2020 2020 2020 2020 2020 206e 616d 655f             name_
-0001ec30: 7661 6c75 655f 6469 6374 203d 2063 6c73  value_dict = cls
-0001ec40: 2e63 7265 6174 655f 6e61 6d65 5f76 616c  .create_name_val
-0001ec50: 7565 5f64 6963 7428 7374 796c 655f 7374  ue_dict(style_st
-0001ec60: 7229 0a20 2020 2020 2020 2072 6574 7572  r).        retur
-0001ec70: 6e20 6e61 6d65 5f76 616c 7565 5f64 6963  n name_value_dic
-0001ec80: 740a 0a20 2020 2040 636c 6173 736d 6574  t..    @classmet
-0001ec90: 686f 640a 2020 2020 6465 6620 6372 6561  hod.    def crea
-0001eca0: 7465 5f6e 616d 655f 7661 6c75 655f 6469  te_name_value_di
-0001ecb0: 6374 2863 6c73 2c20 7374 796c 655f 7374  ct(cls, style_st
-0001ecc0: 7229 3a0a 2020 2020 2020 2020 6e61 6d65  r):.        name
-0001ecd0: 5f76 616c 7565 5f64 6963 7420 3d20 6469  _value_dict = di
-0001ece0: 6374 2829 0a20 2020 2020 2020 2073 7479  ct().        sty
-0001ecf0: 6c65 5f73 7472 203d 2073 7479 6c65 5f73  le_str = style_s
-0001ed00: 7472 2e73 7472 6970 2829 0a20 2020 2020  tr.strip().     
-0001ed10: 2020 2073 7479 6c65 7320 3d20 7374 796c     styles = styl
-0001ed20: 655f 7374 722e 7370 6c69 7428 223b 2229  e_str.split(";")
-0001ed30: 0a20 2020 2020 2020 2066 6f72 2073 7479  .        for sty
-0001ed40: 6c65 2069 6e20 7374 796c 6573 3a0a 2020  le in styles:.  
-0001ed50: 2020 2020 2020 2020 2020 7374 796c 6520            style 
-0001ed60: 3d20 7374 796c 652e 7374 7269 7028 290a  = style.strip().
-0001ed70: 2020 2020 2020 2020 2020 2020 6966 206c              if l
-0001ed80: 656e 2873 7479 6c65 2920 3e20 303a 0a20  en(style) > 0:. 
-0001ed90: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0001eda0: 7320 3d20 7374 796c 652e 7370 6c69 7428  s = style.split(
-0001edb0: 223a 2229 0a20 2020 2020 2020 2020 2020  ":").           
-0001edc0: 2020 2020 2069 6620 6c65 6e28 7373 2920       if len(ss) 
-0001edd0: 213d 2032 3a0a 2020 2020 2020 2020 2020  != 2:.          
-0001ede0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-0001edf0: 4b65 7945 7272 6f72 2866 2262 6164 2073  KeyError(f"bad s
-0001ee00: 7479 6c65 207b 7374 796c 657d 2069 6e20  tyle {style} in 
-0001ee10: 4353 533a 207b 7374 796c 655f 7374 727d  CSS: {style_str}
-0001ee20: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-0001ee30: 2020 206e 616d 6520 3d20 7373 5b30 5d2e     name = ss[0].
-0001ee40: 7374 7269 7028 290a 2020 2020 2020 2020  strip().        
-0001ee50: 2020 2020 2020 2020 6966 206e 616d 6520          if name 
-0001ee60: 696e 206e 616d 655f 7661 6c75 655f 6469  in name_value_di
-0001ee70: 6374 3a0a 2020 2020 2020 2020 2020 2020  ct:.            
-0001ee80: 2020 2020 2020 2020 7261 6973 6520 4b65          raise Ke
-0001ee90: 7945 7272 6f72 2866 227b 6e61 6d65 7d20  yError(f"{name} 
-0001eea0: 6475 706c 6963 6174 6564 2069 6e20 4353  duplicated in CS
-0001eeb0: 533a 207b 7374 796c 655f 7374 727d 2229  S: {style_str}")
-0001eec0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001eed0: 206e 616d 655f 7661 6c75 655f 6469 6374   name_value_dict
-0001eee0: 5b6e 616d 655d 203d 2073 735b 315d 2e73  [name] = ss[1].s
-0001eef0: 7472 6970 2829 0a20 2020 2020 2020 2072  trip().        r
-0001ef00: 6574 7572 6e20 6e61 6d65 5f76 616c 7565  eturn name_value
-0001ef10: 5f64 6963 740a 0a20 2020 2023 2020 2020  _dict..    #    
-0001ef20: 636c 6173 7320 4353 5353 7479 6c65 3a0a  class CSSStyle:.
-0001ef30: 0a20 2020 2040 636c 6173 736d 6574 686f  .    @classmetho
-0001ef40: 640a 2020 2020 6465 6620 6372 6561 7465  d.    def create
-0001ef50: 5f63 7373 5f73 7479 6c65 5f66 726f 6d5f  _css_style_from_
-0001ef60: 6373 735f 7374 7269 6e67 2863 6c73 2c20  css_string(cls, 
-0001ef70: 6373 735f 7374 7269 6e67 2c20 7265 6d6f  css_string, remo
-0001ef80: 7665 5f70 7265 6669 783d 5472 7565 293a  ve_prefix=True):
-0001ef90: 0a20 2020 2020 2020 2022 2222 6372 6561  .        """crea
-0001efa0: 7465 7320 4353 5353 7479 6c65 206f 626a  tes CSSStyle obj
-0001efb0: 6563 7420 6672 6f6d 2043 5353 2073 7472  ect from CSS str
-0001efc0: 696e 6722 2222 0a20 2020 2020 2020 2063  ing""".        c
-0001efd0: 7373 5f73 7479 6c65 203d 204e 6f6e 650a  ss_style = None.
-0001efe0: 2020 2020 2020 2020 6966 2063 7373 5f73          if css_s
-0001eff0: 7472 696e 673a 0a20 2020 2020 2020 2020  tring:.         
-0001f000: 2020 2063 7373 5f73 7479 6c65 203d 2043     css_style = C
-0001f010: 5353 5374 796c 6528 290a 2020 2020 2020  SSStyle().      
-0001f020: 2020 2020 2020 6373 735f 7374 796c 652e        css_style.
-0001f030: 6e61 6d65 5f76 616c 7565 5f64 6963 7420  name_value_dict 
-0001f040: 3d20 636c 732e 6372 6561 7465 5f64 6963  = cls.create_dic
-0001f050: 745f 6672 6f6d 5f6e 616d 655f 7661 6c75  t_from_name_valu
-0001f060: 655f 6172 7261 795f 7374 7269 6e67 2863  e_array_string(c
-0001f070: 7373 5f73 7472 696e 6729 0a20 2020 2020  ss_string).     
-0001f080: 2020 2020 2020 2069 6620 7265 6d6f 7665         if remove
-0001f090: 5f70 7265 6669 783a 0a20 2020 2020 2020  _prefix:.       
-0001f0a0: 2020 2020 2020 2020 2066 6f6e 745f 6661           font_fa
-0001f0b0: 6d69 6c79 203d 2063 7373 5f73 7479 6c65  mily = css_style
-0001f0c0: 2e6e 616d 655f 7661 6c75 655f 6469 6374  .name_value_dict
-0001f0d0: 2e67 6574 2843 5353 5374 796c 652e 464f  .get(CSSStyle.FO
-0001f0e0: 4e54 5f46 414d 494c 5929 0a20 2020 2020  NT_FAMILY).     
-0001f0f0: 2020 2020 2020 2020 2020 2066 6f6e 745f             font_
-0001f100: 6661 6d69 6c79 3120 3d20 416d 6946 6f6e  family1 = AmiFon
-0001f110: 742e 7472 696d 5f70 6466 5f70 7265 6669  t.trim_pdf_prefi
-0001f120: 7828 666f 6e74 5f66 616d 696c 7929 0a20  x(font_family). 
-0001f130: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0001f140: 6620 666f 6e74 5f66 616d 696c 7931 2061  f font_family1 a
-0001f150: 6e64 2066 6f6e 745f 6661 6d69 6c79 3120  nd font_family1 
-0001f160: 213d 2066 6f6e 745f 6661 6d69 6c79 3a0a  != font_family:.
-0001f170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f180: 2020 2020 6373 735f 7374 796c 652e 6e61      css_style.na
-0001f190: 6d65 5f76 616c 7565 5f64 6963 745b 4353  me_value_dict[CS
-0001f1a0: 5353 7479 6c65 2e46 4f4e 545f 4641 4d49  SStyle.FONT_FAMI
-0001f1b0: 4c59 5d20 3d20 666f 6e74 5f66 616d 696c  LY] = font_famil
-0001f1c0: 7931 0a20 2020 2020 2020 2072 6574 7572  y1.        retur
-0001f1d0: 6e20 6373 735f 7374 796c 650a 0a20 2020  n css_style..   
-0001f1e0: 2064 6566 205f 5f65 715f 5f28 7365 6c66   def __eq__(self
-0001f1f0: 2c20 6f74 6865 7229 3a0a 2020 2020 2020  , other):.      
-0001f200: 2020 2222 220a 2020 2020 2020 2020 7465    """.        te
-0001f210: 7374 7320 7768 6574 6865 7220 7365 6c66  sts whether self
-0001f220: 2061 6e64 206f 7468 6572 2068 6176 6520   and other have 
-0001f230: 6571 7561 6c20 6469 6374 696f 6e61 7269  equal dictionari
-0001f240: 6573 0a20 2020 2020 2020 2022 2222 0a20  es.        """. 
-0001f250: 2020 2020 2020 2069 6620 7479 7065 286f         if type(o
-0001f260: 7468 6572 2920 6973 2043 5353 5374 796c  ther) is CSSStyl
-0001f270: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
-0001f280: 6574 7572 6e20 7365 6c66 2e6e 616d 655f  eturn self.name_
-0001f290: 7661 6c75 655f 6469 6374 203d 3d20 6f74  value_dict == ot
-0001f2a0: 6865 722e 6e61 6d65 5f76 616c 7565 5f64  her.name_value_d
-0001f2b0: 6963 740a 2020 2020 2020 2020 7265 7475  ict.        retu
-0001f2c0: 726e 2046 616c 7365 0a0a 0a20 2020 2064  rn False...    d
-0001f2d0: 6566 2073 6574 5f61 7474 7269 6275 7465  ef set_attribute
-0001f2e0: 2873 656c 662c 2070 726f 7065 7274 792c  (self, property,
-0001f2f0: 2076 616c 7565 293a 0a20 2020 2020 2020   value):.       
-0001f300: 2022 2222 0a20 2020 2020 2020 2073 6574   """.        set
-0001f310: 7320 6e61 6d65 2d76 616c 7565 2070 6169  s name-value pai
-0001f320: 7220 696e 2043 5353 5374 796c 650a 2020  r in CSSStyle.  
-0001f330: 2020 2020 2020 6967 6e6f 7265 7320 656d        ignores em
-0001f340: 7074 7920 7661 6c75 6573 206f 7220 4e6f  pty values or No
-0001f350: 6e65 0a20 2020 2020 2020 2022 2222 0a20  ne.        """. 
-0001f360: 2020 2020 2020 2069 6620 7661 6c75 6520         if value 
-0001f370: 616e 6420 6c65 6e28 7374 7228 7661 6c75  and len(str(valu
-0001f380: 6529 2920 3e20 303a 0a20 2020 2020 2020  e)) > 0:.       
-0001f390: 2020 2020 2073 656c 662e 6e61 6d65 5f76       self.name_v
-0001f3a0: 616c 7565 5f64 6963 745b 7072 6f70 6572  alue_dict[proper
-0001f3b0: 7479 5d20 3d20 7661 6c75 650a 0a20 2020  ty] = value..   
-0001f3c0: 2064 6566 2073 6574 5f66 616d 696c 7928   def set_family(
-0001f3d0: 7365 6c66 2c20 6661 6d69 6c79 293a 0a20  self, family):. 
-0001f3e0: 2020 2020 2020 2069 6620 6661 6d69 6c79         if family
-0001f3f0: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
-0001f400: 6c66 2e73 6574 5f61 7474 7269 6275 7465  lf.set_attribute
-0001f410: 2843 5353 5374 796c 652e 464f 4e54 5f46  (CSSStyle.FONT_F
-0001f420: 414d 494c 592c 2066 616d 696c 7929 0a0a  AMILY, family)..
-0001f430: 2020 2020 6465 6620 7365 745f 666f 6e74      def set_font
-0001f440: 5f77 6569 6768 7428 7365 6c66 2c20 7765  _weight(self, we
-0001f450: 6967 6874 293a 0a20 2020 2020 2020 2077  ight):.        w
-0001f460: 6569 6768 7420 3d20 7765 6967 6874 2e6c  eight = weight.l
-0001f470: 6f77 6572 2829 0a20 2020 2020 2020 2069  ower().        i
-0001f480: 6620 7765 6967 6874 3a0a 2020 2020 2020  f weight:.      
-0001f490: 2020 2020 2020 6966 2077 6569 6768 7420        if weight 
-0001f4a0: 3d3d 2043 5353 5374 796c 652e 4e4f 524d  == CSSStyle.NORM
-0001f4b0: 414c 3a0a 2020 2020 2020 2020 2020 2020  AL:.            
-0001f4c0: 2020 2020 7365 6c66 2e73 6574 5f61 7474      self.set_att
-0001f4d0: 7269 6275 7465 2843 5353 5374 796c 652e  ribute(CSSStyle.
-0001f4e0: 464f 4e54 5f57 4549 4748 542c 2043 5353  FONT_WEIGHT, CSS
-0001f4f0: 5374 796c 652e 4e4f 524d 414c 290a 2020  Style.NORMAL).  
-0001f500: 2020 2020 2020 2020 2020 6966 2077 6569            if wei
-0001f510: 6768 7420 3d3d 2043 5353 5374 796c 652e  ght == CSSStyle.
-0001f520: 424f 4c44 3a0a 2020 2020 2020 2020 2020  BOLD:.          
-0001f530: 2020 2020 2020 7365 6c66 2e73 6574 5f61        self.set_a
-0001f540: 7474 7269 6275 7465 2843 5353 5374 796c  ttribute(CSSStyl
-0001f550: 652e 464f 4e54 5f57 4549 4748 542c 2043  e.FONT_WEIGHT, C
-0001f560: 5353 5374 796c 652e 424f 4c44 290a 2020  SSStyle.BOLD).  
-0001f570: 2020 2020 2020 2020 2020 6966 2077 6569            if wei
-0001f580: 6768 7420 3d3d 2043 5353 5374 796c 652e  ght == CSSStyle.
-0001f590: 4c49 4748 543a 0a20 2020 2020 2020 2020  LIGHT:.         
-0001f5a0: 2020 2020 2020 2073 656c 662e 7365 745f         self.set_
-0001f5b0: 6174 7472 6962 7574 6528 4353 5353 7479  attribute(CSSSty
-0001f5c0: 6c65 2e46 4f4e 545f 5745 4947 4854 2c20  le.FONT_WEIGHT, 
-0001f5d0: 4353 5353 7479 6c65 2e4c 4947 4854 290a  CSSStyle.LIGHT).
-0001f5e0: 0a20 2020 2064 6566 2073 6574 5f66 6f6e  .    def set_fon
-0001f5f0: 745f 7374 796c 6528 7365 6c66 2c20 7374  t_style(self, st
-0001f600: 796c 6529 3a0a 2020 2020 2020 2020 6966  yle):.        if
-0001f610: 2073 7479 6c65 3a0a 2020 2020 2020 2020   style:.        
-0001f620: 2020 2020 6966 2073 7479 6c65 2e6c 6f77      if style.low
-0001f630: 6572 2829 203d 3d20 4353 5353 7479 6c65  er() == CSSStyle
-0001f640: 2e4e 4f52 4d41 4c2e 6c6f 7765 7228 293a  .NORMAL.lower():
-0001f650: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001f660: 2073 656c 662e 7365 745f 6174 7472 6962   self.set_attrib
-0001f670: 7574 6528 4353 5353 7479 6c65 2e46 4f4e  ute(CSSStyle.FON
-0001f680: 545f 5354 594c 452c 2043 5353 5374 796c  T_STYLE, CSSStyl
-0001f690: 652e 4e4f 524d 414c 290a 2020 2020 2020  e.NORMAL).      
-0001f6a0: 2020 2020 2020 6966 2073 7479 6c65 2e6c        if style.l
-0001f6b0: 6f77 6572 2829 203d 3d20 4353 5353 7479  ower() == CSSSty
-0001f6c0: 6c65 2e49 5441 4c49 432e 6c6f 7765 7228  le.ITALIC.lower(
-0001f6d0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0001f6e0: 2020 2073 656c 662e 7365 745f 6174 7472     self.set_attr
-0001f6f0: 6962 7574 6528 4353 5353 7479 6c65 2e46  ibute(CSSStyle.F
-0001f700: 4f4e 545f 5354 594c 452c 2043 5353 5374  ONT_STYLE, CSSSt
-0001f710: 796c 652e 4954 414c 4943 290a 0a20 2020  yle.ITALIC)..   
-0001f720: 2064 6566 2067 6574 5f61 7474 7269 6275   def get_attribu
-0001f730: 7465 2873 656c 662c 2070 726f 7065 7274  te(self, propert
-0001f740: 7929 3a0a 2020 2020 2020 2020 2222 220a  y):.        """.
-0001f750: 2020 2020 2020 2020 6765 7473 2076 616c          gets val
-0001f760: 7565 2066 6f72 206e 616d 6520 696e 2043  ue for name in C
-0001f770: 5353 5374 796c 650a 2020 2020 2020 2020  SSStyle.        
-0001f780: 6967 6e6f 7265 7320 656d 7074 7920 7661  ignores empty va
-0001f790: 6c75 6573 206f 7220 4e6f 6e65 0a20 2020  lues or None.   
-0001f7a0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0001f7b0: 2072 6574 7572 6e20 7365 6c66 2e6e 616d   return self.nam
-0001f7c0: 655f 7661 6c75 655f 6469 6374 2061 6e64  e_value_dict and
-0001f7d0: 2073 656c 662e 6e61 6d65 5f76 616c 7565   self.name_value
-0001f7e0: 5f64 6963 742e 6765 7428 7072 6f70 6572  _dict.get(proper
-0001f7f0: 7479 290a 0a20 2020 2023 2020 2020 636c  ty)..    #    cl
-0001f800: 6173 7320 4353 5353 7479 6c65 3a0a 0a20  ass CSSStyle:.. 
-0001f810: 2020 2064 6566 2067 6574 5f66 6f6e 745f     def get_font_
-0001f820: 7374 796c 655f 6174 7472 6962 7574 6573  style_attributes
-0001f830: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-0001f840: 2222 220a 2020 2020 2020 2020 6765 7473  """.        gets
-0001f850: 2074 7570 6c65 206f 6620 3420 666f 6e74   tuple of 4 font
-0001f860: 2061 7474 7269 6275 7465 7320 2873 697a   attributes (siz
-0001f870: 652c 206e 6f6e 7374 726f 6b65 2c20 7374  e, nonstroke, st
-0001f880: 726f 6b65 2c20 666f 6e74 6e61 6d65 290a  roke, fontname).
-0001f890: 2020 2020 2020 2020 2222 220a 0a20 2020          """..   
-0001f8a0: 2020 2020 2069 6620 7365 6c66 2e6e 616d       if self.nam
-0001f8b0: 655f 7661 6c75 655f 6469 6374 2069 7320  e_value_dict is 
-0001f8c0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-0001f8d0: 2020 7265 7475 726e 2028 4e6f 6e65 2c20    return (None, 
-0001f8e0: 4e6f 6e65 2c20 4e6f 6e65 2c20 4e6f 6e65  None, None, None
-0001f8f0: 2c20 4e6f 6e65 290a 2020 2020 2020 2020  , None).        
-0001f900: 7265 7475 726e 2028 0a20 2020 2020 2020  return (.       
-0001f910: 2020 2020 2023 2073 656c 662e 6e61 6d65       # self.name
-0001f920: 5f76 616c 7565 5f64 6963 742e 6765 7428  _value_dict.get(
-0001f930: 4353 5353 7479 6c65 2e57 4944 5448 292c  CSSStyle.WIDTH),
-0001f940: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0001f950: 662e 6765 745f 6174 7472 6962 7574 6528  f.get_attribute(
-0001f960: 4353 5353 7479 6c65 2e46 4f4e 545f 5349  CSSStyle.FONT_SI
-0001f970: 5a45 292c 0a20 2020 2020 2020 2020 2020  ZE),.           
-0001f980: 2073 656c 662e 6765 745f 6174 7472 6962   self.get_attrib
-0001f990: 7574 6528 4353 5353 7479 6c65 2e46 494c  ute(CSSStyle.FIL
-0001f9a0: 4c29 2c0a 2020 2020 2020 2020 2020 2020  L),.            
-0001f9b0: 7365 6c66 2e67 6574 5f61 7474 7269 6275  self.get_attribu
-0001f9c0: 7465 2843 5353 5374 796c 652e 5354 524f  te(CSSStyle.STRO
-0001f9d0: 4b45 292c 0a20 2020 2020 2020 2020 2020  KE),.           
-0001f9e0: 2073 656c 662e 6765 745f 6174 7472 6962   self.get_attrib
-0001f9f0: 7574 6528 4353 5353 7479 6c65 2e46 4f4e  ute(CSSStyle.FON
-0001fa00: 545f 4641 4d49 4c59 290a 2020 2020 2020  T_FAMILY).      
-0001fa10: 2020 290a 0a20 2020 2023 2020 2020 636c    )..    #    cl
-0001fa20: 6173 7320 4353 5353 7479 6c65 3a0a 0a20  ass CSSStyle:.. 
-0001fa30: 2020 2064 6566 2072 656d 6f76 6528 7365     def remove(se
-0001fa40: 6c66 2c20 6e61 6d65 293a 0a20 2020 2020  lf, name):.     
-0001fa50: 2020 2022 2222 0a20 2020 2020 2020 2072     """.        r
-0001fa60: 656d 6f76 6573 206e 616d 6564 2069 7465  emoves named ite
-0001fa70: 6d20 6672 6f6d 2043 5353 5374 796c 650a  m from CSSStyle.
-0001fa80: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0001fa90: 2020 2020 6966 2074 7970 6528 6e61 6d65      if type(name
-0001faa0: 2920 6973 206c 6973 743a 0a20 2020 2020  ) is list:.     
-0001fab0: 2020 2020 2020 2066 6f72 206e 2069 6e20         for n in 
-0001fac0: 6e61 6d65 3a0a 2020 2020 2020 2020 2020  name:.          
-0001fad0: 2020 2020 2020 7365 6c66 2e72 656d 6f76        self.remov
-0001fae0: 6528 6e29 0a20 2020 2020 2020 2065 6c69  e(n).        eli
-0001faf0: 6620 6e61 6d65 2069 6e20 7365 6c66 2e6e  f name in self.n
-0001fb00: 616d 655f 7661 6c75 655f 6469 6374 3a0a  ame_value_dict:.
-0001fb10: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0001fb20: 2e6e 616d 655f 7661 6c75 655f 6469 6374  .name_value_dict
-0001fb30: 2e70 6f70 286e 616d 652c 204e 6f6e 6529  .pop(name, None)
-0001fb40: 0a0a 2020 2020 6465 6620 6170 706c 795f  ..    def apply_
-0001fb50: 746f 2873 656c 662c 2065 6c65 6d29 3a0a  to(self, elem):.
-0001fb60: 2020 2020 2020 2020 2222 220a 0a20 2020          """..   
+0001bf50: 290a 2020 2020 2020 2020 2020 2020 6578  ).            ex
+0001bf60: 6365 7074 2045 7863 6570 7469 6f6e 2061  cept Exception a
+0001bf70: 7320 653a 0a20 2020 2020 2020 2020 2020  s e:.           
+0001bf80: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+0001bf90: 4572 726f 7228 6622 4552 524f 5220 7870  Error(f"ERROR xp
+0001bfa0: 6174 6820 7b78 7061 7468 7d20 7b65 7d22  ath {xpath} {e}"
+0001bfb0: 290a 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+0001bfc0: 656c 656d 656e 745f 6c69 7374 203d 206c  element_list = l
+0001bfd0: 6973 7428 290a 2020 2020 2020 2020 666f  ist().        fo
+0001bfe0: 7220 7870 6174 6820 696e 2073 656c 662e  r xpath in self.
+0001bff0: 7870 6174 6873 3a0a 2020 2020 2020 2020  xpaths:.        
+0001c000: 2020 2020 6d61 7463 685f 656c 656d 656e      match_elemen
+0001c010: 7473 203d 2074 7265 652e 7870 6174 6828  ts = tree.xpath(
+0001c020: 7870 6174 6829 0a20 2020 2020 2020 2020  xpath).         
+0001c030: 2020 2066 6f72 206d 6174 6368 5f65 6c65     for match_ele
+0001c040: 6d65 6e74 2069 6e20 6d61 7463 685f 656c  ment in match_el
+0001c050: 656d 656e 7473 3a0a 2020 2020 2020 2020  ements:.        
+0001c060: 2020 2020 2020 2020 7420 3d20 7479 7065          t = type
+0001c070: 286d 6174 6368 5f65 6c65 6d65 6e74 290a  (match_element).
+0001c080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c090: 6966 2074 2069 7320 6e6f 7420 5f45 6c65  if t is not _Ele
+0001c0a0: 6d65 6e74 3a0a 2020 2020 2020 2020 2020  ment:.          
+0001c0b0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+0001c0c0: 5661 6c75 6545 7272 6f72 2866 226e 6f74  ValueError(f"not
+0001c0d0: 2061 6e20 656c 656d 656e 7420 7b74 7d20   an element {t} 
+0001c0e0: 7b6d 6174 6368 5f65 6c65 6d65 6e74 7d22  {match_element}"
+0001c0f0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001c100: 2020 7365 6c66 2e65 6c65 6d65 6e74 5f6c    self.element_l
+0001c110: 6973 742e 6170 7065 6e64 286d 6174 6368  ist.append(match
+0001c120: 5f65 6c65 6d65 6e74 290a 0a20 2020 2020  _element)..     
+0001c130: 2020 2066 6f72 2065 6c65 6d65 6e74 2069     for element i
+0001c140: 6e20 7365 6c66 2e65 6c65 6d65 6e74 5f6c  n self.element_l
+0001c150: 6973 743a 0a20 2020 2020 2020 2020 2020  ist:.           
+0001c160: 2066 6f72 2074 6578 7420 696e 2065 6c65   for text in ele
+0001c170: 6d65 6e74 2e78 7061 7468 2822 2e2f 7465  ment.xpath("./te
+0001c180: 7874 2829 2229 3a0a 2020 2020 2020 2020  xt()"):.        
+0001c190: 2020 2020 2020 2020 7061 7373 0a20 2020          pass.   
+0001c1a0: 2020 2020 2020 2020 2020 2020 2023 206e               # n
+0001c1b0: 6f64 6573 7472 203d 2073 656c 662e 7365  odestr = self.se
+0001c1c0: 6c65 6374 5f63 6875 6e6b 735f 7375 6263  lect_chunks_subc
+0001c1d0: 6875 6e6b 735f 6e6f 6465 7328 7465 7874  hunks_nodes(text
+0001c1e0: 290a 0a20 2020 2064 6566 2073 656c 6563  )..    def selec
+0001c1f0: 745f 6368 756e 6b73 5f73 7562 6368 756e  t_chunks_subchun
+0001c200: 6b73 5f6e 6f64 6573 2873 656c 662c 2074  ks_nodes(self, t
+0001c210: 6578 742c 2073 706c 6974 7465 725f 7265  ext, splitter_re
+0001c220: 3d4e 6f6e 652c 206e 6f64 655f 7265 3d4e  =None, node_re=N
+0001c230: 6f6e 6529 3a0a 2020 2020 2020 2020 2320  one):.        # 
+0001c240: 6368 756e 6b5f 7265 2c20 7370 6c69 7474  chunk_re, splitt
+0001c250: 6572 5f72 652c 206e 6f64 655f 7265 5f6c  er_re, node_re_l
+0001c260: 6961 742c 2061 6464 5f75 6e6d 6174 6368  iat, add_unmatch
+0001c270: 6564 203d 2046 616c 7365 293a 0a20 2020  ed = False):.   
+0001c280: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0001c290: 204d 6f76 6520 746f 2061 2063 6c61 7373   Move to a class
+0001c2a0: 2061 6e64 2072 6566 6163 746f 7220 746f   and refactor to
+0001c2b0: 2075 7365 2064 6963 7469 6f6e 6172 790a   use dictionary.
+0001c2c0: 2020 2020 2020 2020 4e4f 5420 5945 5420          NOT YET 
+0001c2d0: 5553 4544 0a20 2020 2020 2020 203a 7061  USED.        :pa
+0001c2e0: 7261 6d20 7370 6c69 7474 6572 5f72 653a  ram splitter_re:
+0001c2f0: 2072 6567 6578 2066 6f72 2073 706c 6974   regex for split
+0001c300: 7469 6e67 2073 6d61 6c6c 6572 2063 6875  ting smaller chu
+0001c310: 6e6b 730a 2020 2020 2020 2020 3a70 6172  nks.        :par
+0001c320: 616d 206e 6f64 655f 7265 3a20 7265 6765  am node_re: rege
+0001c330: 7820 746f 2066 696e 6420 6879 7065 726e  x to find hypern
+0001c340: 6f64 6573 0a20 2020 2020 2020 2022 2222  odes.        """
+0001c350: 0a0a 2020 2020 2020 2020 6368 756e 6b5f  ..        chunk_
+0001c360: 7265 7320 3d20 7365 6c66 2e63 6875 6e6b  res = self.chunk
+0001c370: 5f64 6963 742e 6765 7428 7365 6c66 2e43  _dict.get(self.C
+0001c380: 4855 4e4b 5f52 4529 0a20 2020 2020 2020  HUNK_RE).       
+0001c390: 2073 706c 6974 7465 725f 7265 7320 3d20   splitter_res = 
+0001c3a0: 7365 6c66 2e73 706c 6974 7465 725f 6469  self.splitter_di
+0001c3b0: 6374 2e67 6574 2873 656c 662e 5350 4c49  ct.get(self.SPLI
+0001c3c0: 5454 4552 5f52 4529 0a20 2020 2020 2020  TTER_RE).       
+0001c3d0: 206e 6f64 655f 7265 7320 3d20 7365 6c66   node_res = self
+0001c3e0: 2e63 6875 6e6b 5f6e 6f64 655f 6469 6374  .chunk_node_dict
+0001c3f0: 2e67 6574 2873 656c 662e 5355 424e 4f44  .get(self.SUBNOD
+0001c400: 455f 5245 290a 0a20 2020 2020 2020 2061  E_RE)..        a
+0001c410: 6464 5f75 6e6d 6174 6368 6564 203d 2073  dd_unmatched = s
+0001c420: 656c 662e 6368 756e 6b5f 6e6f 6465 5f64  elf.chunk_node_d
+0001c430: 6963 742e 6765 7428 7365 6c66 2e55 4e4d  ict.get(self.UNM
+0001c440: 4154 4348 4544 290a 2020 2020 2020 2020  ATCHED).        
+0001c450: 7074 7220 3d20 300a 2020 2020 2020 2020  ptr = 0.        
+0001c460: 7768 696c 6520 5472 7565 3a0a 2020 2020  while True:.    
+0001c470: 2020 2020 2020 2020 666f 7220 6368 756e          for chun
+0001c480: 6b5f 7265 2069 6e20 6368 756e 6b5f 7265  k_re in chunk_re
+0001c490: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+0001c4a0: 2020 206d 6174 6368 203d 2072 652e 7365     match = re.se
+0001c4b0: 6172 6368 2863 6875 6e6b 5f72 652c 2074  arch(chunk_re, t
+0001c4c0: 6578 745b 7074 723a 5d29 0a20 2020 2020  ext[ptr:]).     
+0001c4d0: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
+0001c4e0: 7420 6d61 7463 683a 0a20 2020 2020 2020  t match:.       
+0001c4f0: 2020 2020 2020 2020 2020 2020 2062 7265               bre
+0001c500: 616b 0a20 2020 2020 2020 2020 2020 2020  ak.             
+0001c510: 2020 2070 7472 202b 3d20 6d61 7463 682e     ptr += match.
+0001c520: 7370 616e 2829 5b31 5d0a 2020 2020 2020  span()[1].      
+0001c530: 2020 2020 2020 2020 2020 6e6f 6465 7374            nodest
+0001c540: 7220 3d20 6d61 7463 682e 6772 6f75 7028  r = match.group(
+0001c550: 3129 0a0a 2020 2020 2020 2020 2020 2020  1)..            
+0001c560: 2020 2020 6e6f 6465 7320 3d20 7265 2e73      nodes = re.s
+0001c570: 706c 6974 2873 706c 6974 7465 725f 7265  plit(splitter_re
+0001c580: 2c20 6e6f 6465 7374 7229 0a20 2020 2020  , nodestr).     
+0001c590: 2020 2020 2020 2020 2020 206e 6f64 655f             node_
+0001c5a0: 6469 6374 203d 2064 6566 6175 6c74 6469  dict = defaultdi
+0001c5b0: 6374 286c 6973 7429 0a20 2020 2020 2020  ct(list).       
+0001c5c0: 2020 2020 2020 2020 2066 6f72 206e 6f64           for nod
+0001c5d0: 6520 696e 206e 6f64 6573 3a0a 2020 2020  e in nodes:.    
+0001c5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c5f0: 6d20 3d20 7265 2e73 6561 7263 6828 6e6f  m = re.search(no
+0001c600: 6465 5f72 652c 206e 6f64 6529 0a20 2020  de_re, node).   
+0001c610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c620: 2069 6620 6d3a 0a20 2020 2020 2020 2020   if m:.         
+0001c630: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+0001c640: 6f64 655f 6469 6374 5b6e 6f64 655f 7265  ode_dict[node_re
+0001c650: 5d2e 6170 7065 6e64 286e 6f64 6529 0a20  ].append(node). 
+0001c660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c670: 2020 2069 6620 6e6f 7420 6d20 616e 6420     if not m and 
+0001c680: 6164 645f 756e 6d61 7463 6865 643a 0a20  add_unmatched:. 
+0001c690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c6a0: 2020 2020 2020 206e 6f64 655f 6469 6374         node_dict
+0001c6b0: 5b73 656c 662e 554e 4d41 5443 4845 445d  [self.UNMATCHED]
+0001c6c0: 2e61 7070 656e 6428 6e6f 6465 290a 2020  .append(node).  
+0001c6d0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+0001c6e0: 7220 6974 656d 2069 6e20 6e6f 6465 5f64  r item in node_d
+0001c6f0: 6963 742e 6974 656d 7328 293a 0a20 2020  ict.items():.   
+0001c700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c710: 2023 2070 7269 6e74 2866 2269 7465 6d20   # print(f"item 
+0001c720: 7b69 7465 6d7d 2229 0a20 2020 2020 2020  {item}").       
+0001c730: 2020 2020 2020 2020 2020 2020 2070 6173               pas
+0001c740: 730a 0a20 2020 2064 6566 2061 6464 5f78  s..    def add_x
+0001c750: 7061 7468 2873 656c 662c 2074 6974 6c65  path(self, title
+0001c760: 2c20 7870 6174 6829 3a0a 2020 2020 2020  , xpath):.      
+0001c770: 2020 2222 220a 2020 2020 2020 2020 7365    """.        se
+0001c780: 7420 7870 6174 6820 666f 7220 6578 7472  t xpath for extr
+0001c790: 6163 7469 6e67 2048 544d 4c20 6e6f 6465  acting HTML node
+0001c7a0: 732e 0a20 2020 2020 2020 203a 7061 7261  s..        :para
+0001c7b0: 6d20 7469 746c 653a 2074 6974 6c65 206f  m title: title o
+0001c7c0: 6620 7870 6174 680a 2020 2020 2020 2020  f xpath.        
+0001c7d0: 3a70 6172 616d 2078 7061 7468 3a20 6163  :param xpath: ac
+0001c7e0: 7473 206f 6e20 6375 7272 656e 7420 6e6f  ts on current no
+0001c7f0: 6465 7365 740a 2020 2020 2020 2020 2222  deset.        ""
+0001c800: 220a 2020 2020 2020 2020 586d 6c4c 6962  ".        XmlLib
+0001c810: 2e76 616c 6964 6174 655f 7870 6174 6828  .validate_xpath(
+0001c820: 7870 6174 6829 0a20 2020 2020 2020 2073  xpath).        s
+0001c830: 656c 662e 6164 645f 6974 656d 5f74 6f5f  elf.add_item_to_
+0001c840: 6172 7261 795f 6469 6374 2873 656c 662e  array_dict(self.
+0001c850: 7870 6174 685f 6469 6374 2c20 7469 746c  xpath_dict, titl
+0001c860: 652c 2078 7061 7468 290a 0a20 2020 2064  e, xpath)..    d
+0001c870: 6566 2076 616c 6964 6174 655f 7870 6174  ef validate_xpat
+0001c880: 6828 7365 6c66 2c20 7870 6174 6829 3a0a  h(self, xpath):.
+0001c890: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0001c8a0: 2020 2020 6372 7564 6520 7379 6e74 6178      crude syntax
+0001c8b0: 2076 616c 6964 6174 696f 6e20 6f66 2078   validation of x
+0001c8c0: 7061 7468 2073 7472 696e 672e 0a20 2020  path string..   
+0001c8d0: 2020 2020 2074 6573 7473 2078 7061 7468       tests xpath
+0001c8e0: 206f 6e20 6120 7472 6976 6961 6c20 656c   on a trivial el
+0001c8f0: 656d 656e 740a 2020 2020 2020 2020 3a70  ement.        :p
+0001c900: 6172 616d 2078 7061 7468 3a0a 2020 2020  aram xpath:.    
+0001c910: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0001c920: 7472 6565 203d 2045 542e 6672 6f6d 7374  tree = ET.fromst
+0001c930: 7269 6e67 2822 3c66 6f6f 2f3e 2229 0a20  ring("<foo/>"). 
+0001c940: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
+0001c950: 2020 2020 2020 2020 7472 6565 2e78 7061          tree.xpa
+0001c960: 7468 2878 7061 7468 290a 2020 2020 2020  th(xpath).      
+0001c970: 2020 6578 6365 7074 2045 542e 5850 6174    except ET.XPat
+0001c980: 6845 7661 6c45 7272 6f72 2061 7320 653a  hEvalError as e:
+0001c990: 0a20 2020 2020 2020 2020 2020 206c 6f67  .            log
+0001c9a0: 6769 6e67 2e65 7272 6f72 2866 2262 6164  ging.error(f"bad
+0001c9b0: 2058 5061 7468 207b 7870 6174 687d 2c20   XPath {xpath}, 
+0001c9c0: 7b65 7d22 290a 2020 2020 2020 2020 2020  {e}").          
+0001c9d0: 2020 7261 6973 6520 650a 0a20 2020 2064    raise e..    d
+0001c9e0: 6566 2061 6464 5f63 6875 6e6b 5f72 6528  ef add_chunk_re(
+0001c9f0: 7365 6c66 2c20 6368 756e 6b5f 7265 293a  self, chunk_re):
+0001ca00: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0001ca10: 2020 2020 2061 6464 2063 6875 6e6b 2072       add chunk r
+0001ca20: 6567 6578 2066 6f72 2065 7874 7261 6374  egex for extract
+0001ca30: 696e 6720 6368 756e 6b73 2e0a 2020 2020  ing chunks..    
+0001ca40: 2020 2020 3a70 6172 616d 2063 6875 6e6b      :param chunk
+0001ca50: 5f72 653a 2061 6374 7320 6f6e 2063 7572  _re: acts on cur
+0001ca60: 7265 6e74 206e 6f64 6573 6574 0a20 2020  rent nodeset.   
+0001ca70: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0001ca80: 2073 656c 662e 6164 645f 6974 656d 5f74   self.add_item_t
+0001ca90: 6f5f 6172 7261 795f 6469 6374 2873 656c  o_array_dict(sel
+0001caa0: 662e 6368 756e 6b5f 6469 6374 2c20 7365  f.chunk_dict, se
+0001cab0: 6c66 2e43 4855 4e4b 5f52 452c 2063 6875  lf.CHUNK_RE, chu
+0001cac0: 6e6b 5f72 6529 0a20 2020 2020 2020 2073  nk_re).        s
+0001cad0: 656c 662e 7661 6c69 6461 7465 5f72 6528  elf.validate_re(
+0001cae0: 6368 756e 6b5f 7265 290a 0a20 2020 2064  chunk_re)..    d
+0001caf0: 6566 2061 6464 5f73 706c 6974 7465 725f  ef add_splitter_
+0001cb00: 7265 2873 656c 662c 2073 706c 6974 7465  re(self, splitte
+0001cb10: 725f 7265 293a 0a20 2020 2020 2020 2022  r_re):.        "
+0001cb20: 2222 0a20 2020 2020 2020 2061 6464 2073  "".        add s
+0001cb30: 706c 6974 7465 7220 7265 6765 7820 666f  plitter regex fo
+0001cb40: 7220 6578 7472 6163 7469 6e67 206c 6973  r extracting lis
+0001cb50: 7473 2069 6e20 6368 756e 6b73 2e0a 2020  ts in chunks..  
+0001cb60: 2020 2020 2020 3a70 6172 616d 2073 706c        :param spl
+0001cb70: 6974 7465 725f 7265 3a20 6163 7473 206f  itter_re: acts o
+0001cb80: 6e20 6375 7272 656e 7420 6e6f 6465 7365  n current nodese
+0001cb90: 740a 2020 2020 2020 2020 2222 220a 2020  t.        """.  
+0001cba0: 2020 2020 2020 7365 6c66 2e61 6464 5f69        self.add_i
+0001cbb0: 7465 6d5f 746f 5f61 7272 6179 5f64 6963  tem_to_array_dic
+0001cbc0: 7428 7365 6c66 2e73 706c 6974 7465 725f  t(self.splitter_
+0001cbd0: 6469 6374 2c20 7365 6c66 2e53 504c 4954  dict, self.SPLIT
+0001cbe0: 5445 525f 5245 2c20 7370 6c69 7474 6572  TER_RE, splitter
+0001cbf0: 5f72 6529 0a20 2020 2020 2020 2073 656c  _re).        sel
+0001cc00: 662e 7661 6c69 6461 7465 5f72 6528 7370  f.validate_re(sp
+0001cc10: 6c69 7474 6572 5f72 6529 0a0a 2020 2020  litter_re)..    
+0001cc20: 6465 6620 6164 645f 7375 626e 6f64 655f  def add_subnode_
+0001cc30: 6b65 795f 7265 2873 656c 662c 206e 616d  key_re(self, nam
+0001cc40: 652c 2073 7562 6e6f 6465 5f72 6529 3a0a  e, subnode_re):.
+0001cc50: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0001cc60: 2020 2020 6164 6420 6e61 6d65 6420 7375      add named su
+0001cc70: 626e 6f64 6520 7265 6765 7820 666f 7220  bnode regex for 
+0001cc80: 7061 7273 696e 6720 6c69 7374 2069 7465  parsing list ite
+0001cc90: 6d73 2066 726f 6d20 7370 6c69 7474 696e  ms from splittin
+0001cca0: 670a 2020 2020 2020 2020 3a70 6172 616d  g.        :param
+0001ccb0: 206e 616d 653a 206e 616d 6520 6f66 2072   name: name of r
+0001ccc0: 6520 696e 2064 6963 740a 2020 2020 2020  e in dict.      
+0001ccd0: 2020 3a70 6172 616d 2073 7562 6e6f 6465    :param subnode
+0001cce0: 5f72 653a 2072 6567 6578 2074 6f20 7374  _re: regex to st
+0001ccf0: 6f72 650a 2020 2020 2020 2020 2222 220a  ore.        """.
+0001cd00: 2020 2020 2020 2020 7365 6c66 2e61 6464          self.add
+0001cd10: 5f6e 616d 6564 5f76 616c 7565 286e 616d  _named_value(nam
+0001cd20: 652c 2073 7562 6e6f 6465 5f72 6529 0a0a  e, subnode_re)..
+0001cd30: 2020 2020 6465 6620 6164 645f 6e61 6d65      def add_name
+0001cd40: 645f 7661 6c75 6528 7365 6c66 2c20 6e61  d_value(self, na
+0001cd50: 6d65 2c20 7375 626e 6f64 655f 7265 293a  me, subnode_re):
+0001cd60: 0a20 2020 2020 2020 2073 656c 662e 6164  .        self.ad
+0001cd70: 645f 6974 656d 5f74 6f5f 6172 7261 795f  d_item_to_array_
+0001cd80: 6469 6374 2873 656c 662e 6368 756e 6b5f  dict(self.chunk_
+0001cd90: 6469 6374 2c20 6e61 6d65 2c20 7375 626e  dict, name, subn
+0001cda0: 6f64 655f 7265 290a 2020 2020 2020 2020  ode_re).        
+0001cdb0: 7365 6c66 2e76 616c 6964 6174 655f 7265  self.validate_re
+0001cdc0: 2873 7562 6e6f 6465 5f72 6529 0a0a 2020  (subnode_re)..  
+0001cdd0: 2020 6465 6620 7365 745f 756e 6d61 7463    def set_unmatc
+0001cde0: 6865 645f 666c 6167 2873 656c 662c 2075  hed_flag(self, u
+0001cdf0: 6e6d 6174 6368 6564 293a 0a20 2020 2020  nmatched):.     
+0001ce00: 2020 2022 2222 0a20 2020 2020 2020 2073     """.        s
+0001ce10: 6574 2055 4e4d 4154 4348 4544 2062 6f6f  et UNMATCHED boo
+0001ce20: 6c65 616e 2e20 4966 2074 7275 6520 6164  lean. If true ad
+0001ce30: 6473 2061 6c6c 2075 6e6d 6174 6368 6564  ds all unmatched
+0001ce40: 2076 616c 7565 7320 746f 2064 6963 7420   values to dict 
+0001ce50: 756e 6465 7220 554e 4d41 5443 4845 440a  under UNMATCHED.
+0001ce60: 2020 2020 2020 2020 3a70 6172 616d 2075          :param u
+0001ce70: 6e6d 6174 6368 6564 3a20 6163 7473 206f  nmatched: acts o
+0001ce80: 6e20 6375 7272 656e 7420 6e6f 6465 7365  n current nodese
+0001ce90: 740a 2020 2020 2020 2020 3a70 6172 616d  t.        :param
+0001cea0: 206d 6174 6368 5f74 7970 653a 2061 6464   match_type: add
+0001ceb0: 6974 696f 6e61 6c20 6465 6275 6720 746f  itional debug to
+0001cec0: 206e 616d 650a 2020 2020 2020 2020 2222   name.        ""
+0001ced0: 220a 2020 2020 2020 2020 7365 6c66 2e63  ".        self.c
+0001cee0: 6875 6e6b 5f64 6963 745b 7365 6c66 2e55  hunk_dict[self.U
+0001cef0: 4e4d 4154 4348 4544 5d20 3d20 756e 6d61  NMATCHED] = unma
+0001cf00: 7463 6865 640a 0a20 2020 2064 6566 2076  tched..    def v
+0001cf10: 616c 6964 6174 655f 7265 2873 656c 662c  alidate_re(self,
+0001cf20: 2072 6567 6578 293a 0a20 2020 2020 2020   regex):.       
+0001cf30: 2022 2222 0a20 2020 2020 2020 203a 7061   """.        :pa
+0001cf40: 7261 6d20 7265 6765 783a 2072 6567 6578  ram regex: regex
+0001cf50: 2074 6f20 6265 2076 616c 6964 6174 6564   to be validated
+0001cf60: 0a20 2020 2020 2020 203a 6578 6365 7074  .        :except
+0001cf70: 3a20 7468 726f 7773 2045 7863 6570 7469  : throws Excepti
+0001cf80: 6f6e 2066 6f72 2062 6164 2072 6567 6578  on for bad regex
+0001cf90: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0001cfa0: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+0001cfb0: 2020 2020 2020 7265 2e63 6f6d 7069 6c65        re.compile
+0001cfc0: 2872 6567 6578 290a 2020 2020 2020 2020  (regex).        
+0001cfd0: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
+0001cfe0: 2061 7320 653a 0a20 2020 2020 2020 2020   as e:.         
+0001cff0: 2020 206c 6f67 6769 6e67 2e65 7272 6f72     logging.error
+0001d000: 2866 2262 6164 2072 6567 6578 207b 7265  (f"bad regex {re
+0001d010: 6765 787d 2229 0a20 2020 2020 2020 2020  gex}").         
+0001d020: 2020 2072 6169 7365 2065 0a0a 2020 2020     raise e..    
+0001d030: 6465 6620 6164 645f 6974 656d 5f74 6f5f  def add_item_to_
+0001d040: 6172 7261 795f 6469 6374 2873 656c 662c  array_dict(self,
+0001d050: 2074 6865 5f64 6963 742c 206b 6579 2c20   the_dict, key, 
+0001d060: 7661 6c75 6529 3a0a 2020 2020 2020 2020  value):.        
+0001d070: 6966 206e 6f74 2074 6865 5f64 6963 742e  if not the_dict.
+0001d080: 6765 7428 6b65 7929 3a0a 2020 2020 2020  get(key):.      
+0001d090: 2020 2020 2020 7468 655f 6469 6374 5b6b        the_dict[k
+0001d0a0: 6579 5d20 3d20 5b5d 0a20 2020 2020 2020  ey] = [].       
+0001d0b0: 2074 6865 5f64 6963 745b 6b65 795d 2e61   the_dict[key].a
+0001d0c0: 7070 656e 6428 7661 6c75 6529 0a0a 0a63  ppend(value)...c
+0001d0d0: 6c61 7373 2055 524c 4361 6368 653a 0a20  lass URLCache:. 
+0001d0e0: 2020 2064 6566 205f 5f69 6e69 745f 5f28     def __init__(
+0001d0f0: 7365 6c66 293a 0a20 2020 2020 2020 2073  self):.        s
+0001d100: 656c 662e 7572 6c5f 6469 6374 203d 2064  elf.url_dict = d
+0001d110: 6963 7428 290a 0a20 2020 2064 6566 2072  ict()..    def r
+0001d120: 6561 645f 786d 6c5f 656c 656d 656e 745f  ead_xml_element_
+0001d130: 6672 6f6d 5f67 6974 6875 6228 7365 6c66  from_github(self
+0001d140: 2c20 6769 7468 7562 5f75 726c 2c20 6465  , github_url, de
+0001d150: 6c61 793d 3129 3a0a 2020 2020 2020 2020  lay=1):.        
+0001d160: 2222 2272 6574 7269 6576 6573 2061 6e64  """retrieves and
+0001d170: 2070 6172 7365 7320 636f 6e74 656e 7420   parses content 
+0001d180: 6f66 2055 524c 2e20 4361 6368 6573 2069  of URL. Caches i
+0001d190: 7420 6966 2066 6f75 6e64 0a20 2020 2020  t if found.     
+0001d1a0: 2020 2072 6574 7572 6e73 2061 2064 6565     returns a dee
+0001d1b0: 7063 6f70 7920 6173 2065 6c65 6d6e 7420  pcopy as elemnt 
+0001d1c0: 6973 206c 696b 656c 7920 746f 2062 6520  is likely to be 
+0001d1d0: 6564 6974 6564 2222 220a 2020 2020 2020  edited""".      
+0001d1e0: 2020 6874 6d6c 5f65 6c65 6d20 3d20 7365    html_elem = se
+0001d1f0: 6c66 2e75 726c 5f64 6963 742e 6765 7428  lf.url_dict.get(
+0001d200: 6769 7468 7562 5f75 726c 290a 2020 2020  github_url).    
+0001d210: 2020 2020 6966 2068 746d 6c5f 656c 656d      if html_elem
+0001d220: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+0001d230: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+0001d240: 2020 2020 2020 2020 2020 2068 746d 6c5f             html_
+0001d250: 656c 656d 203d 2058 6d6c 4c69 622e 7265  elem = XmlLib.re
+0001d260: 6164 5f78 6d6c 5f65 6c65 6d65 6e74 5f66  ad_xml_element_f
+0001d270: 726f 6d5f 6769 7468 7562 2867 6974 6875  rom_github(githu
+0001d280: 625f 7572 6c3d 6769 7468 7562 5f75 726c  b_url=github_url
+0001d290: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001d2a0: 2020 7469 6d65 2e73 6c65 6570 2864 656c    time.sleep(del
+0001d2b0: 6179 290a 2020 2020 2020 2020 2020 2020  ay).            
+0001d2c0: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
+0001d2d0: 2061 7320 653a 0a20 2020 2020 2020 2020   as e:.         
+0001d2e0: 2020 2020 2020 2070 7269 6e74 2866 2263         print(f"c
+0001d2f0: 616e 6e6f 7420 7265 6164 207b 6769 7468  annot read {gith
+0001d300: 7562 5f75 726c 7d20 6265 6361 7573 6520  ub_url} because 
+0001d310: 7b65 7d22 290a 2020 2020 2020 2020 2020  {e}").          
+0001d320: 2020 2020 2020 7265 7475 726e 204e 6f6e        return Non
+0001d330: 650a 2020 2020 2020 2020 2020 2020 7365  e.            se
+0001d340: 6c66 2e75 726c 5f64 6963 745b 6769 7468  lf.url_dict[gith
+0001d350: 7562 5f75 726c 5d20 3d20 6874 6d6c 5f65  ub_url] = html_e
+0001d360: 6c65 6d0a 2020 2020 2020 2020 656c 7365  lem.        else
+0001d370: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
+0001d380: 7072 696e 7428 6622 2066 6f75 6e64 2069  print(f" found i
+0001d390: 6e20 6361 6368 6521 2229 0a20 2020 2020  n cache!").     
+0001d3a0: 2020 2020 2020 2070 6173 730a 2020 2020         pass.    
+0001d3b0: 2020 2020 7265 7475 726e 2063 6f70 792e      return copy.
+0001d3c0: 6465 6570 636f 7079 2868 746d 6c5f 656c  deepcopy(html_el
+0001d3d0: 656d 290a 0a0a 4944 203d 2022 6964 220a  em)...ID = "id".
+0001d3e0: 4f42 4a45 4354 203d 2022 6f62 6a65 6374  OBJECT = "object
+0001d3f0: 220a 5354 4152 5445 4e44 203d 2022 7374  ".STARTEND = "st
+0001d400: 6172 745f 656e 6422 0a0a 0a63 6c61 7373  art_end"...class
+0001d410: 2046 6c6f 6174 426f 756e 6461 7279 4469   FloatBoundaryDi
+0001d420: 6374 3a0a 0a20 2020 2064 6566 205f 5f69  ct:..    def __i
+0001d430: 6e69 745f 5f28 7365 6c66 2c20 6874 6d6c  nit__(self, html
+0001d440: 5f65 6c65 6d2c 206f 7574 6469 723d 4e6f  _elem, outdir=No
+0001d450: 6e65 293a 0a20 2020 2020 2020 2073 656c  ne):.        sel
+0001d460: 662e 666c 6f61 745f 626f 756e 6461 7279  f.float_boundary
+0001d470: 5f64 6963 7420 3d20 6465 6661 756c 7464  _dict = defaultd
+0001d480: 6963 7428 6c69 7374 290a 2020 2020 2020  ict(list).      
+0001d490: 2020 7365 6c66 2e68 746d 6c5f 656c 656d    self.html_elem
+0001d4a0: 203d 2068 746d 6c5f 656c 656d 0a20 2020   = html_elem.   
+0001d4b0: 2020 2020 2073 656c 662e 6f75 7464 6972       self.outdir
+0001d4c0: 203d 206f 7574 6469 720a 0a20 2020 2064   = outdir..    d
+0001d4d0: 6566 2061 6464 5f6f 626a 6563 7428 7365  ef add_object(se
+0001d4e0: 6c66 2c20 666c 6f61 745f 626f 756e 6461  lf, float_bounda
+0001d4f0: 7279 293a 0a20 2020 2020 2020 206b 6579  ry):.        key
+0001d500: 203d 2066 6c6f 6174 5f62 6f75 6e64 6172   = float_boundar
+0001d510: 792e 6b65 790a 2020 2020 2020 2020 7365  y.key.        se
+0001d520: 6c66 2e66 6c6f 6174 5f62 6f75 6e64 6172  lf.float_boundar
+0001d530: 795f 6469 6374 5b6b 6579 5d2e 6170 7065  y_dict[key].appe
+0001d540: 6e64 2866 6c6f 6174 5f62 6f75 6e64 6172  nd(float_boundar
+0001d550: 7929 0a0a 2020 2020 6465 6620 6164 645f  y)..    def add_
+0001d560: 666c 6f61 745f 626f 756e 6461 7269 6573  float_boundaries
+0001d570: 2873 656c 662c 2066 6c6f 6174 5f62 6f75  (self, float_bou
+0001d580: 6e64 6172 6965 7329 3a0a 2020 2020 2020  ndaries):.      
+0001d590: 2020 666f 7220 666c 6f61 745f 626f 756e    for float_boun
+0001d5a0: 6461 7279 2069 6e20 666c 6f61 745f 626f  dary in float_bo
+0001d5b0: 756e 6461 7269 6573 3a0a 2020 2020 2020  undaries:.      
+0001d5c0: 2020 2020 2020 7365 6c66 2e61 6464 5f6f        self.add_o
+0001d5d0: 626a 6563 7428 666c 6f61 745f 626f 756e  bject(float_boun
+0001d5e0: 6461 7279 290a 0a20 2020 2064 6566 2065  dary)..    def e
+0001d5f0: 7874 7261 6374 5f63 6f6e 7465 6e74 735f  xtract_contents_
+0001d600: 6f66 5f62 7261 636b 6574 6564 5f62 6f75  of_bracketed_bou
+0001d610: 6e64 6172 6965 735f 616e 645f 7772 6974  ndaries_and_writ
+0001d620: 6528 7365 6c66 293a 0a20 2020 2020 2020  e(self):.       
+0001d630: 2066 6f72 2066 625f 6c69 7374 2069 6e20   for fb_list in 
+0001d640: 7365 6c66 2e66 6c6f 6174 5f62 6f75 6e64  self.float_bound
+0001d650: 6172 795f 6469 6374 2e76 616c 7565 7328  ary_dict.values(
+0001d660: 293a 0a20 2020 2020 2020 2020 2020 2069  ):.            i
+0001d670: 6620 6c65 6e28 6662 5f6c 6973 7429 203d  f len(fb_list) =
+0001d680: 3d20 323a 0a20 2020 2020 2020 2020 2020  = 2:.           
+0001d690: 2020 2020 2023 2070 7269 6e74 2866 2246       # print(f"F
+0001d6a0: 4220 7b66 625f 6c69 7374 7d20 7b66 625f  B {fb_list} {fb_
+0001d6b0: 6c69 7374 5b30 5d2e 6469 765f 6964 7d20  list[0].div_id} 
+0001d6c0: 7b66 625f 6c69 7374 5b31 5d2e 6469 765f  {fb_list[1].div_
+0001d6d0: 6964 7d22 290a 2020 2020 2020 2020 2020  id}").          
+0001d6e0: 2020 2020 2020 6e65 775f 6469 7620 3d20        new_div = 
+0001d6f0: 7365 6c66 2e64 656c 6574 655f 6265 7477  self.delete_betw
+0001d700: 6565 6e28 6662 5f6c 6973 745b 305d 2e64  een(fb_list[0].d
+0001d710: 6976 5f69 642c 2066 625f 6c69 7374 5b31  iv_id, fb_list[1
+0001d720: 5d2e 6469 765f 6964 290a 2020 2020 2020  ].div_id).      
+0001d730: 2020 2020 2020 2020 2020 666c 6f61 745f            float_
+0001d740: 6e61 6d65 203d 2066 625f 6c69 7374 5b30  name = fb_list[0
+0001d750: 5d2e 6b65 790a 2020 2020 2020 2020 2020  ].key.          
+0001d760: 2020 2020 2020 6e65 775f 6469 762e 6174        new_div.at
+0001d770: 7472 6962 5b22 6e61 6d65 225d 203d 2066  trib["name"] = f
+0001d780: 6c6f 6174 5f6e 616d 650a 2020 2020 2020  loat_name.      
+0001d790: 2020 2020 2020 2020 2020 6e65 775f 6874            new_ht
+0001d7a0: 6d6c 5f65 6c65 6d20 3d20 4874 6d6c 4c69  ml_elem = HtmlLi
+0001d7b0: 622e 6372 6561 7465 5f6e 6577 5f68 746d  b.create_new_htm
+0001d7c0: 6c5f 7769 7468 5f6f 6c64 5f73 7479 6c65  l_with_old_style
+0001d7d0: 7328 7365 6c66 2e68 746d 6c5f 656c 656d  s(self.html_elem
+0001d7e0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001d7f0: 2020 4874 6d6c 4c69 622e 6765 745f 626f    HtmlLib.get_bo
+0001d800: 6479 286e 6577 5f68 746d 6c5f 656c 656d  dy(new_html_elem
+0001d810: 292e 6170 7065 6e64 286e 6577 5f64 6976  ).append(new_div
+0001d820: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001d830: 2020 6966 2073 656c 662e 6f75 7464 6972    if self.outdir
+0001d840: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001d850: 2020 2020 2020 5061 7468 2873 656c 662e        Path(self.
+0001d860: 6f75 7464 6972 292e 6d6b 6469 7228 6578  outdir).mkdir(ex
+0001d870: 6973 745f 6f6b 3d54 7275 652c 2070 6172  ist_ok=True, par
+0001d880: 656e 7473 3d46 616c 7365 290a 2020 2020  ents=False).    
+0001d890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d8a0: 6669 6c65 5f73 7465 6d20 3d20 666c 6f61  file_stem = floa
+0001d8b0: 745f 6e61 6d65 2e6c 6f77 6572 2829 2e72  t_name.lower().r
+0001d8c0: 6570 6c61 6365 2822 5c5c 732a 222c 2022  eplace("\\s*", "
+0001d8d0: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+0001d8e0: 2020 2020 2020 2058 6d6c 4c69 622e 7772         XmlLib.wr
+0001d8f0: 6974 655f 786d 6c28 6e65 775f 6874 6d6c  ite_xml(new_html
+0001d900: 5f65 6c65 6d2c 2050 6174 6828 7365 6c66  _elem, Path(self
+0001d910: 2e6f 7574 6469 722c 2066 696c 655f 7374  .outdir, file_st
+0001d920: 656d 202b 2022 2e68 746d 6c22 2929 0a0a  em + ".html"))..
+0001d930: 2020 2020 6465 6620 6465 6c65 7465 5f62      def delete_b
+0001d940: 6574 7765 656e 2873 656c 662c 2064 6976  etween(self, div
+0001d950: 5f69 6430 2c20 6469 765f 6964 3129 3a0a  _id0, div_id1):.
+0001d960: 2020 2020 2020 2020 656c 656d 3020 3d20          elem0 = 
+0001d970: 7365 6c66 2e68 746d 6c5f 656c 656d 2e78  self.html_elem.x
+0001d980: 7061 7468 2866 222e 2f2f 6469 765b 4069  path(f".//div[@i
+0001d990: 643d 277b 6469 765f 6964 307d 275d 2229  d='{div_id0}']")
+0001d9a0: 5b30 5d0a 2020 2020 2020 2020 656c 656d  [0].        elem
+0001d9b0: 3120 3d20 7365 6c66 2e68 746d 6c5f 656c  1 = self.html_el
+0001d9c0: 656d 2e78 7061 7468 2866 222e 2f2f 6469  em.xpath(f".//di
+0001d9d0: 765b 4069 643d 277b 6469 765f 6964 317d  v[@id='{div_id1}
+0001d9e0: 275d 2229 5b30 5d0a 2020 2020 2020 2020  ']")[0].        
+0001d9f0: 666f 6c6c 6f77 696e 6720 3d20 656c 656d  following = elem
+0001da00: 302e 7870 6174 6828 2266 6f6c 6c6f 7769  0.xpath("followi
+0001da10: 6e67 3a3a 2a22 290a 2020 2020 2020 2020  ng::*").        
+0001da20: 6e65 775f 6469 7620 3d20 4554 2e45 6c65  new_div = ET.Ele
+0001da30: 6d65 6e74 2822 6469 7622 290a 2020 2020  ment("div").    
+0001da40: 2020 2020 6e65 775f 6469 762e 6174 7472      new_div.attr
+0001da50: 6962 5b22 6964 225d 203d 2064 6976 5f69  ib["id"] = div_i
+0001da60: 6430 0a20 2020 2020 2020 2066 6f72 2066  d0.        for f
+0001da70: 6f6c 6c6f 7720 696e 2066 6f6c 6c6f 7769  ollow in followi
+0001da80: 6e67 3a0a 2020 2020 2020 2020 2020 2020  ng:.            
+0001da90: 6964 5f20 3d20 666f 6c6c 6f77 2e61 7474  id_ = follow.att
+0001daa0: 7269 625b 2769 6427 5d0a 2020 2020 2020  rib['id'].      
+0001dab0: 2020 2020 2020 6e65 775f 6469 762e 6170        new_div.ap
+0001dac0: 7065 6e64 2866 6f6c 6c6f 7729 0a20 2020  pend(follow).   
+0001dad0: 2020 2020 2020 2020 2023 2066 6f6c 6c6f           # follo
+0001dae0: 772e 6765 7470 6172 656e 7428 292e 7265  w.getparent().re
+0001daf0: 6d6f 7665 2866 6f6c 6c6f 7729 0a20 2020  move(follow).   
+0001db00: 2020 2020 2020 2020 2069 6620 6964 5f20           if id_ 
+0001db10: 3d3d 2064 6976 5f69 6431 3a0a 2020 2020  == div_id1:.    
+0001db20: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+0001db30: 7428 2245 5849 5422 290a 2020 2020 2020  t("EXIT").      
+0001db40: 2020 2020 2020 2020 2020 6272 6561 6b0a            break.
+0001db50: 2020 2020 2020 2020 7265 7475 726e 206e          return n
+0001db60: 6577 5f64 6976 0a0a 0a63 6c61 7373 2046  ew_div...class F
+0001db70: 6c6f 6174 426f 756e 6461 7279 3a0a 2020  loatBoundary:.  
+0001db80: 2020 2222 220a 2020 2020 486f 6c64 730a    """.    Holds.
+0001db90: 2020 2020 2222 220a 2020 2020 4950 4343      """.    IPCC
+0001dba0: 5f42 4f55 4e44 4152 5920 3d20 225c 5c5b  _BOUNDARY = "\\[
+0001dbb0: 3f22 205c 0a20 2020 2020 2020 2020 2020  ?" \.           
+0001dbc0: 2020 2020 2020 2020 2066 2228 3f50 3c7b           f"(?P<{
+0001dbd0: 5354 4152 5445 4e44 7d3e 5354 4152 547c  STARTEND}>START|
+0001dbe0: 454e 4429 5c5c 732a 2220 5c0a 2020 2020  END)\\s*" \.    
+0001dbf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dc00: 6622 283f 503c 7b4f 424a 4543 547d 3e2e  f"(?P<{OBJECT}>.
+0001dc10: 2a42 4f58 7c46 4947 5552 457c 5441 424c  *BOX|FIGURE|TABL
+0001dc20: 4529 5c5c 732a 2220 5c0a 2020 2020 2020  E)\\s*" \.      
+0001dc30: 2020 2020 2020 2020 2020 2020 2020 6622                f"
+0001dc40: 283f 503c 7b49 447d 3e28 3f3a 283f 3a5b  (?P<{ID}>(?:(?:[
+0001dc50: 412d 5a30 2d39 5d2b 7c5c 5c64 2b29 3f28  A-Z0-9]+|\\d+)?(
+0001dc60: 3f3a 5c5c 2e5c 5c64 2b29 2a29 295c 5c73  ?:\\.\\d+)*))\\s
+0001dc70: 2a28 3f3a 4845 5245 295c 5c5d 3f22 0a0a  *(?:HERE)\\]?"..
+0001dc80: 2020 2020 2320 5b53 5441 5254 2043 524f      # [START CRO
+0001dc90: 5353 2d53 4543 5449 4f4e 2042 4f58 2e31  SS-SECTION BOX.1
+0001dca0: 2048 4552 455d 0a0a 2020 2020 6465 6620   HERE]..    def 
+0001dcb0: 5f5f 696e 6974 5f5f 2873 656c 6629 3a0a  __init__(self):.
+0001dcc0: 2020 2020 2020 2020 7365 6c66 2e67 726f          self.gro
+0001dcd0: 7570 5f64 6963 7420 3d20 6469 6374 2829  up_dict = dict()
+0001dce0: 0a20 2020 2020 2020 2073 656c 662e 7374  .        self.st
+0001dcf0: 6172 7420 3d20 4e6f 6e65 0a20 2020 2020  art = None.     
+0001dd00: 2020 2073 656c 662e 656e 6420 3d20 4e6f     self.end = No
+0001dd10: 6e65 0a20 2020 2020 2020 2073 656c 662e  ne.        self.
+0001dd20: 6469 765f 6964 203d 204e 6f6e 650a 0a20  div_id = None.. 
+0001dd30: 2020 2064 6566 205f 5f73 7472 5f5f 2873     def __str__(s
+0001dd40: 656c 6629 3a0a 2020 2020 2020 2020 7265  elf):.        re
+0001dd50: 7475 726e 2073 656c 662e 6772 6f75 705f  turn self.group_
+0001dd60: 6469 6374 2e67 6574 2853 5441 5254 454e  dict.get(STARTEN
+0001dd70: 4429 202b 2022 3b22 202b 2073 656c 662e  D) + ";" + self.
+0001dd80: 6772 6f75 705f 6469 6374 2e67 6574 284f  group_dict.get(O
+0001dd90: 424a 4543 5429 202b 2022 3b22 202b 2073  BJECT) + ";" + s
+0001dda0: 656c 662e 6772 6f75 705f 6469 6374 2e67  elf.group_dict.g
+0001ddb0: 6574 2849 4429 0a0a 2020 2020 6465 6620  et(ID)..    def 
+0001ddc0: 5f5f 7265 7072 5f5f 2873 656c 6629 3a0a  __repr__(self):.
+0001ddd0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+0001dde0: 656c 662e 5f5f 7374 725f 5f28 290a 0a20  elf.__str__().. 
+0001ddf0: 2020 2064 6566 2061 6464 2873 656c 662c     def add(self,
+0001de00: 206e 616d 652c 2076 616c 7565 293a 0a20   name, value):. 
+0001de10: 2020 2020 2020 2073 656c 662e 6772 6f75         self.grou
+0001de20: 705f 6469 6374 5b6e 616d 655d 203d 2076  p_dict[name] = v
+0001de30: 616c 7565 0a0a 2020 2020 4070 726f 7065  alue..    @prope
+0001de40: 7274 790a 2020 2020 6465 6620 6b65 7928  rty.    def key(
+0001de50: 7365 6c66 293a 0a20 2020 2020 2020 2072  self):.        r
+0001de60: 6574 7572 6e20 7374 7228 7365 6c66 2e67  eturn str(self.g
+0001de70: 726f 7570 5f64 6963 745b 4f42 4a45 4354  roup_dict[OBJECT
+0001de80: 5d29 202b 2073 7472 2873 656c 662e 6772  ]) + str(self.gr
+0001de90: 6f75 705f 6469 6374 5b49 445d 290a 0a20  oup_dict[ID]).. 
+0001dea0: 2020 2040 7072 6f70 6572 7479 0a20 2020     @property.   
+0001deb0: 2064 6566 2073 7461 7274 5f65 6e64 2873   def start_end(s
+0001dec0: 656c 6629 3a0a 2020 2020 2020 2020 7265  elf):.        re
+0001ded0: 7475 726e 2073 656c 662e 6772 6f75 705f  turn self.group_
+0001dee0: 6469 6374 5b53 5441 5254 454e 445d 0a0a  dict[STARTEND]..
+0001def0: 2020 2020 4063 6c61 7373 6d65 7468 6f64      @classmethod
+0001df00: 0a20 2020 2064 6566 2065 7874 7261 6374  .    def extract
+0001df10: 5f66 6c6f 6174 735f 616e 645f 626f 756e  _floats_and_boun
+0001df20: 6461 7269 6573 2863 6c73 2c20 6874 6d6c  daries(cls, html
+0001df30: 5f65 6c65 6d2c 2070 6163 6b61 6765 2c20  _elem, package, 
+0001df40: 6f75 7464 6972 3d4e 6f6e 6529 3a0a 2020  outdir=None):.  
+0001df50: 2020 2020 2020 7265 6765 7820 3d20 466c        regex = Fl
+0001df60: 6f61 7442 6f75 6e64 6172 792e 4950 4343  oatBoundary.IPCC
+0001df70: 5f42 4f55 4e44 4152 590a 2020 2020 2020  _BOUNDARY.      
+0001df80: 2020 666c 6f61 745f 626f 756e 6461 7269    float_boundari
+0001df90: 6573 203d 2046 6c6f 6174 4578 7472 6163  es = FloatExtrac
+0001dfa0: 746f 7228 292e 6578 7472 6163 745f 666c  tor().extract_fl
+0001dfb0: 6f61 745f 626f 756e 6461 7269 6573 2868  oat_boundaries(h
+0001dfc0: 746d 6c5f 656c 656d 2c20 7265 6765 7829  tml_elem, regex)
+0001dfd0: 0a20 2020 2020 2020 2066 6c6f 6174 5f62  .        float_b
+0001dfe0: 6f75 6e64 6172 795f 6469 6374 203d 2046  oundary_dict = F
+0001dff0: 6c6f 6174 426f 756e 6461 7279 4469 6374  loatBoundaryDict
+0001e000: 2868 746d 6c5f 656c 656d 2c20 6f75 7464  (html_elem, outd
+0001e010: 6972 3d6f 7574 6469 7229 0a20 2020 2020  ir=outdir).     
+0001e020: 2020 2066 6c6f 6174 5f62 6f75 6e64 6172     float_boundar
+0001e030: 795f 6469 6374 2e61 6464 5f66 6c6f 6174  y_dict.add_float
+0001e040: 5f62 6f75 6e64 6172 6965 7328 666c 6f61  _boundaries(floa
+0001e050: 745f 626f 756e 6461 7269 6573 290a 2020  t_boundaries).  
+0001e060: 2020 2020 2020 666c 6f61 745f 626f 756e        float_boun
+0001e070: 6461 7279 5f64 6963 742e 6578 7472 6163  dary_dict.extrac
+0001e080: 745f 636f 6e74 656e 7473 5f6f 665f 6272  t_contents_of_br
+0001e090: 6163 6b65 7465 645f 626f 756e 6461 7269  acketed_boundari
+0001e0a0: 6573 5f61 6e64 5f77 7269 7465 2829 0a20  es_and_write(). 
+0001e0b0: 2020 2020 2020 2072 6574 7572 6e20 6874         return ht
+0001e0c0: 6d6c 5f65 6c65 6d0a 0a0a 636c 6173 7320  ml_elem...class 
+0001e0d0: 466c 6f61 7445 7874 7261 6374 6f72 3a0a  FloatExtractor:.
+0001e0e0: 2020 2020 2222 2265 7874 7261 6374 7320      """extracts 
+0001e0f0: 666c 6f61 7473 2028 626f 7865 732c 2066  floats (boxes, f
+0001e100: 6967 7572 6573 2c20 6574 632e 2920 7573  igures, etc.) us
+0001e110: 696e 6720 7374 6172 742f 656e 6420 7265  ing start/end re
+0001e120: 6765 7865 730a 2020 2020 2222 220a 0a20  gexes.    """.. 
+0001e130: 2020 2064 6566 205f 5f69 6e69 745f 5f28     def __init__(
+0001e140: 7365 6c66 2c20 7265 6765 783d 4e6f 6e65  self, regex=None
+0001e150: 293a 0a20 2020 2020 2020 2073 656c 662e  ):.        self.
+0001e160: 7265 6765 7820 3d20 7265 6765 780a 0a20  regex = regex.. 
+0001e170: 2020 2064 6566 2065 7874 7261 6374 5f66     def extract_f
+0001e180: 6c6f 6174 5f62 6f75 6e64 6172 6965 7328  loat_boundaries(
+0001e190: 7365 6c66 2c20 6874 6d6c 5f65 6c65 6d2c  self, html_elem,
+0001e1a0: 2072 6567 6578 5f73 7472 293a 0a20 2020   regex_str):.   
+0001e1b0: 2020 2020 2066 6c6f 6174 5f62 6f75 6e64       float_bound
+0001e1c0: 6172 6965 7320 3d20 5b5d 0a20 2020 2020  aries = [].     
+0001e1d0: 2020 2072 6567 6578 203d 2072 652e 636f     regex = re.co
+0001e1e0: 6d70 696c 6528 7265 6765 785f 7374 7229  mpile(regex_str)
+0001e1f0: 0a20 2020 2020 2020 2023 2070 7269 6e74  .        # print
+0001e200: 2866 2220 7265 6765 7820 7b72 6567 6578  (f" regex {regex
+0001e210: 7d22 290a 2020 2020 2020 2020 6469 7673  }").        divs
+0001e220: 203d 2068 746d 6c5f 656c 656d 2e78 7061   = html_elem.xpa
+0001e230: 7468 2822 2e2f 2f64 6976 2229 0a20 2020  th(".//div").   
+0001e240: 2020 2020 2066 6f72 2064 6976 2069 6e20       for div in 
+0001e250: 6469 7673 3a0a 2020 2020 2020 2020 2020  divs:.          
+0001e260: 2020 7370 616e 7320 3d20 6469 762e 7870    spans = div.xp
+0001e270: 6174 6828 222e 2f73 7061 6e22 290a 2020  ath("./span").  
+0001e280: 2020 2020 2020 2020 2020 666f 7220 7370            for sp
+0001e290: 616e 2069 6e20 7370 616e 733a 0a20 2020  an in spans:.   
+0001e2a0: 2020 2020 2020 2020 2020 2020 206d 6174               mat
+0001e2b0: 6368 203d 2072 652e 7365 6172 6368 2872  ch = re.search(r
+0001e2c0: 6567 6578 2c20 7370 616e 2e74 6578 7429  egex, span.text)
+0001e2d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001e2e0: 2069 6620 6d61 7463 683a 0a20 2020 2020   if match:.     
+0001e2f0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0001e300: 6c6f 6174 5f62 6f75 6e64 6172 7920 3d20  loat_boundary = 
+0001e310: 466c 6f61 7442 6f75 6e64 6172 7928 290a  FloatBoundary().
+0001e320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e330: 2020 2020 666c 6f61 745f 626f 756e 6461      float_bounda
+0001e340: 7279 2e64 6976 5f69 6420 3d20 6469 762e  ry.div_id = div.
+0001e350: 6174 7472 6962 5b22 6964 225d 0a20 2020  attrib["id"].   
+0001e360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e370: 2066 6f72 2066 6965 6c64 2069 6e20 5b53   for field in [S
+0001e380: 5441 5254 454e 442c 204f 424a 4543 542c  TARTEND, OBJECT,
+0001e390: 2049 445d 3a0a 2020 2020 2020 2020 2020   ID]:.          
+0001e3a0: 2020 2020 2020 2020 2020 2020 2020 666c                fl
+0001e3b0: 6f61 745f 626f 756e 6461 7279 2e61 6464  oat_boundary.add
+0001e3c0: 2866 6965 6c64 2c20 6d61 7463 682e 6772  (field, match.gr
+0001e3d0: 6f75 7028 6669 656c 6429 290a 2020 2020  oup(field)).    
+0001e3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e3f0: 666c 6f61 745f 626f 756e 6461 7269 6573  float_boundaries
+0001e400: 2e61 7070 656e 6428 666c 6f61 745f 626f  .append(float_bo
+0001e410: 756e 6461 7279 290a 2020 2020 2020 2020  undary).        
+0001e420: 7265 7475 726e 2066 6c6f 6174 5f62 6f75  return float_bou
+0001e430: 6e64 6172 6965 730a 0a0a 636c 6173 7320  ndaries...class 
+0001e440: 4353 5353 7479 6c65 3a0a 2020 2020 2222  CSSStyle:.    ""
+0001e450: 220a 2020 2020 636f 6d6d 6f6e 2073 7562  ".    common sub
+0001e460: 7365 7420 6f66 2043 5353 2073 7479 6c65  set of CSS style
+0001e470: 732f 636f 6d6d 616e 6473 0a20 2020 2022  s/commands.    "
+0001e480: 2222 0a20 2020 2023 2061 6c6c 2061 7265  "".    # all are
+0001e490: 206c 6f77 6572 6361 7365 0a20 2020 2042   lowercase.    B
+0001e4a0: 4f4c 4420 3d20 2262 6f6c 6422 0a20 2020  OLD = "bold".   
+0001e4b0: 2042 4f52 4445 5220 3d20 2262 6f72 6465   BORDER = "borde
+0001e4c0: 7222 0a20 2020 2042 4f54 544f 4d20 3d20  r".    BOTTOM = 
+0001e4d0: 2262 6f74 746f 6d22 0a20 2020 2043 4f4c  "bottom".    COL
+0001e4e0: 4f52 203d 2022 636f 6c6f 7222 0a20 2020  OR = "color".   
+0001e4f0: 2044 4f54 5f42 203d 2022 2e42 220a 2020   DOT_B = ".B".  
+0001e500: 2020 4649 4c4c 203d 2022 6669 6c6c 220a    FILL = "fill".
+0001e510: 2020 2020 5354 524f 4b45 203d 2022 7374      STROKE = "st
+0001e520: 726f 6b65 220a 2020 2020 464f 4e54 5f46  roke".    FONT_F
+0001e530: 414d 494c 5920 3d20 2266 6f6e 742d 6661  AMILY = "font-fa
+0001e540: 6d69 6c79 220a 2020 2020 464f 4e54 5f53  mily".    FONT_S
+0001e550: 495a 4520 3d20 2266 6f6e 742d 7369 7a65  IZE = "font-size
+0001e560: 220a 2020 2020 464f 4e54 5f53 5459 4c45  ".    FONT_STYLE
+0001e570: 203d 2022 666f 6e74 2d73 7479 6c65 220a   = "font-style".
+0001e580: 2020 2020 464f 4e54 5f53 5452 4554 4348      FONT_STRETCH
+0001e590: 4544 203d 2022 666f 6e74 2d73 7472 6574  ED = "font-stret
+0001e5a0: 6368 6564 220a 2020 2020 464f 4e54 5f57  ched".    FONT_W
+0001e5b0: 4549 4748 5420 3d20 2266 6f6e 742d 7765  EIGHT = "font-we
+0001e5c0: 6967 6874 220a 2020 2020 4845 4947 4854  ight".    HEIGHT
+0001e5d0: 203d 2022 6865 6967 6874 220a 2020 2020   = "height".    
+0001e5e0: 4954 414c 4943 203d 2022 6974 616c 6963  ITALIC = "italic
+0001e5f0: 220a 2020 2020 4c45 4654 203d 2022 6c65  ".    LEFT = "le
+0001e600: 6674 220a 2020 2020 4c49 4748 5420 3d20  ft".    LIGHT = 
+0001e610: 226c 6967 6874 220a 2020 2020 4e4f 524d  "light".    NORM
+0001e620: 414c 203d 2022 6e6f 726d 616c 220a 2020  AL = "normal".  
+0001e630: 2020 4f50 4143 4954 5920 3d20 226f 7061    OPACITY = "opa
+0001e640: 6369 7479 220a 2020 2020 504f 5349 5449  city".    POSITI
+0001e650: 4f4e 203d 2022 706f 7369 7469 6f6e 220a  ON = "position".
+0001e660: 2020 2020 5058 203d 2022 7078 220a 2020      PX = "px".  
+0001e670: 2020 5354 594c 4520 3d20 2273 7479 6c65    STYLE = "style
+0001e680: 220a 2020 2020 544f 5020 3d20 2274 6f70  ".    TOP = "top
+0001e690: 220a 2020 2020 5749 4454 4820 3d20 2277  ".    WIDTH = "w
+0001e6a0: 6964 7468 220a 0a20 2020 2057 4549 4748  idth"..    WEIGH
+0001e6b0: 545f 5245 203d 2022 285b 2d2e 5d3f 426f  T_RE = "([-.]?Bo
+0001e6c0: 6c64 7c5b 2e5d 5b42 625d 2429 220a 2020  ld|[.][Bb]$)".  
+0001e6d0: 2020 5354 594c 455f 5245 203d 2022 285b    STYLE_RE = "([
+0001e6e0: 2d2e 5d3f 4974 616c 283a 3f69 6329 7c5b  -.]?Ital(:?ic)|[
+0001e6f0: 2d2e 5d3f 4f62 6c69 7175 657c 5b2e 5d5b  -.]?Oblique|[.][
+0001e700: 4969 5d24 2922 0a0a 2020 2020 5445 5854  Ii]$)"..    TEXT
+0001e710: 5f53 5459 4c45 5f43 4f4d 504f 4e45 4e54  _STYLE_COMPONENT
+0001e720: 5320 3d20 5b46 4f4e 545f 5354 594c 452c  S = [FONT_STYLE,
+0001e730: 2046 4f4e 545f 5745 4947 4854 2c20 464f   FONT_WEIGHT, FO
+0001e740: 4e54 5f46 414d 494c 592c 2046 4f4e 545f  NT_FAMILY, FONT_
+0001e750: 5349 5a45 2c20 434f 4c4f 522c 204f 5041  SIZE, COLOR, OPA
+0001e760: 4349 5459 5d0a 0a20 2020 2064 6566 205f  CITY]..    def _
+0001e770: 5f69 6e69 745f 5f28 7365 6c66 293a 0a20  _init__(self):. 
+0001e780: 2020 2020 2020 2073 656c 662e 6e61 6d65         self.name
+0001e790: 5f76 616c 7565 5f64 6963 7420 3d20 6469  _value_dict = di
+0001e7a0: 6374 2829 0a0a 2020 2020 6465 6620 5f5f  ct()..    def __
+0001e7b0: 7374 725f 5f28 7365 6c66 293a 0a20 2020  str__(self):.   
+0001e7c0: 2020 2020 2073 203d 2022 220a 2020 2020       s = "".    
+0001e7d0: 2020 2020 666f 7220 6b2c 2076 2069 6e20      for k, v in 
+0001e7e0: 7365 6c66 2e6e 616d 655f 7661 6c75 655f  self.name_value_
+0001e7f0: 6469 6374 2e69 7465 6d73 2829 3a0a 2020  dict.items():.  
+0001e800: 2020 2020 2020 2020 2020 7320 2b3d 2066            s += f
+0001e810: 227b 6b7d 3a7b 767d 3b20 220a 2020 2020  "{k}:{v}; ".    
+0001e820: 2020 2020 7320 3d20 732e 7374 7269 7028      s = s.strip(
+0001e830: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+0001e840: 2073 0a0a 2020 2020 6465 6620 5f5f 7265   s..    def __re
+0001e850: 7072 5f5f 2873 656c 6629 3a0a 2020 2020  pr__(self):.    
+0001e860: 2020 2020 7265 7475 726e 2066 227b 7365      return f"{se
+0001e870: 6c66 2e6e 616d 655f 7661 6c75 655f 6469  lf.name_value_di
+0001e880: 6374 7d22 0a0a 2020 2020 2320 2020 2063  ct}"..    #    c
+0001e890: 6c61 7373 2043 5353 5374 796c 653a 0a0a  lass CSSStyle:..
+0001e8a0: 2020 2020 4063 6c61 7373 6d65 7468 6f64      @classmethod
+0001e8b0: 0a20 2020 2064 6566 2063 7265 6174 655f  .    def create_
+0001e8c0: 6373 735f 7374 796c 655f 6672 6f6d 5f61  css_style_from_a
+0001e8d0: 7474 7269 6275 7465 5f6f 665f 626f 6479  ttribute_of_body
+0001e8e0: 5f65 6c65 6d65 6e74 2863 6c73 2c20 656c  _element(cls, el
+0001e8f0: 656d 293a 0a20 2020 2020 2020 2022 2222  em):.        """
+0001e900: 6372 6561 7465 2043 5353 5374 796c 6520  create CSSStyle 
+0001e910: 6f62 6a65 6374 2066 726f 6d20 656c 656d  object from elem
+0001e920: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+0001e930: 656c 656d 3a0a 2020 2020 2020 2020 2222  elem:.        ""
+0001e940: 220a 2020 2020 2020 2020 6966 2065 6c65  ".        if ele
+0001e950: 6d20 6973 204e 6f6e 653a 0a20 2020 2020  m is None:.     
+0001e960: 2020 2020 2020 2072 6574 7572 6e20 4e6f         return No
+0001e970: 6e65 0a20 2020 2020 2020 2061 7373 6572  ne.        asser
+0001e980: 7420 7479 7065 2865 6c65 6d29 2069 7320  t type(elem) is 
+0001e990: 5f45 6c65 6d65 6e74 2c20 6622 666f 756e  _Element, f"foun
+0001e9a0: 6420 7b74 7970 6528 656c 656d 297d 220a  d {type(elem)}".
+0001e9b0: 2020 2020 2020 2020 6373 735f 7374 796c          css_styl
+0001e9c0: 6520 3d20 4353 5353 7479 6c65 2829 0a20  e = CSSStyle(). 
+0001e9d0: 2020 2020 2020 2073 7479 6c65 5f61 7474         style_att
+0001e9e0: 7661 6c20 3d20 656c 656d 2e67 6574 2843  val = elem.get(C
+0001e9f0: 5353 5374 796c 652e 5354 594c 4529 0a20  SSStyle.STYLE). 
+0001ea00: 2020 2020 2020 2063 7373 5f73 7479 6c65         css_style
+0001ea10: 2e6e 616d 655f 7661 6c75 655f 6469 6374  .name_value_dict
+0001ea20: 203d 2063 6c73 2e63 7265 6174 655f 6469   = cls.create_di
+0001ea30: 6374 5f66 726f 6d5f 6e61 6d65 5f76 616c  ct_from_name_val
+0001ea40: 7565 5f61 7272 6179 5f73 7472 696e 6728  ue_array_string(
+0001ea50: 7374 796c 655f 6174 7476 616c 290a 2020  style_attval).  
+0001ea60: 2020 2020 2020 7265 7475 726e 2063 7373        return css
+0001ea70: 5f73 7479 6c65 0a0a 2020 2020 2320 2020  _style..    #   
+0001ea80: 2063 6c61 7373 2043 5353 5374 796c 653a   class CSSStyle:
+0001ea90: 0a0a 2020 2020 4063 6c61 7373 6d65 7468  ..    @classmeth
+0001eaa0: 6f64 0a20 2020 2064 6566 2063 7265 6174  od.    def creat
+0001eab0: 655f 6469 6374 5f66 726f 6d5f 6e61 6d65  e_dict_from_name
+0001eac0: 5f76 616c 7565 5f61 7272 6179 5f73 7472  _value_array_str
+0001ead0: 696e 6728 636c 732c 2073 7479 6c65 5f73  ing(cls, style_s
+0001eae0: 7472 2c20 7265 6d6f 7665 5f63 7572 6c79  tr, remove_curly
+0001eaf0: 3d54 7275 6529 3a0a 2020 2020 2020 2020  =True):.        
+0001eb00: 2222 220a 2020 2020 2020 2020 6173 7375  """.        assu
+0001eb10: 6d65 7320 7374 7269 6e67 206f 6620 7479  mes string of ty
+0001eb20: 7065 2022 613a 2062 3b20 633a 2064 3b22  pe "a: b; c: d;"
+0001eb30: 206f 7074 696f 6e61 6c6c 7920 656e 636c   optionally encl
+0001eb40: 6f73 6564 2069 6e20 7b2e 2e2e 7d0a 2020  osed in {...}.  
+0001eb50: 2020 2020 2020 3a70 6172 616d 2073 7479        :param sty
+0001eb60: 6c65 5f73 7472 3a20 0a20 2020 2020 2020  le_str: .       
+0001eb70: 2022 2222 0a20 2020 2020 2020 2072 655f   """.        re_
+0001eb80: 7374 7220 3d20 2228 3f50 3c70 7265 3e2e  str = "(?P<pre>.
+0001eb90: 2a29 7b28 3f50 3c63 7572 6c79 3e2e 2a29  *){(?P<curly>.*)
+0001eba0: 7d28 3f50 3c70 6f73 743e 2e2a 2922 0a20  }(?P<post>.*)". 
+0001ebb0: 2020 2020 2020 2063 7572 6c79 5f72 6520         curly_re 
+0001ebc0: 3d20 7265 2e63 6f6d 7069 6c65 2872 655f  = re.compile(re_
+0001ebd0: 7374 7229 0a20 2020 2020 2020 206e 616d  str).        nam
+0001ebe0: 655f 7661 6c75 655f 6469 6374 203d 2064  e_value_dict = d
+0001ebf0: 6963 7428 290a 2020 2020 2020 2020 6966  ict().        if
+0001ec00: 2074 7970 6528 7374 796c 655f 7374 7229   type(style_str)
+0001ec10: 2069 7320 4353 5353 7479 6c65 3a0a 2020   is CSSStyle:.  
+0001ec20: 2020 2020 2020 2020 2020 7374 796c 655f            style_
+0001ec30: 7374 7220 3d20 7374 796c 655f 7374 722e  str = style_str.
+0001ec40: 6765 745f 6373 735f 7661 6c75 6528 7374  get_css_value(st
+0001ec50: 796c 655f 7374 7229 0a20 2020 2020 2020  yle_str).       
+0001ec60: 2069 6620 7374 796c 655f 7374 723a 0a20   if style_str:. 
+0001ec70: 2020 2020 2020 2020 2020 2069 6620 7265             if re
+0001ec80: 6d6f 7665 5f63 7572 6c79 3a0a 2020 2020  move_curly:.    
+0001ec90: 2020 2020 2020 2020 2020 2020 6d61 7463              matc
+0001eca0: 6820 3d20 6375 726c 795f 7265 2e6d 6174  h = curly_re.mat
+0001ecb0: 6368 2873 7479 6c65 5f73 7472 290a 2020  ch(style_str).  
+0001ecc0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0001ecd0: 206d 6174 6368 3a0a 2020 2020 2020 2020   match:.        
+0001ece0: 2020 2020 2020 2020 2020 2020 7374 796c              styl
+0001ecf0: 655f 7374 7220 3d20 6d61 7463 682e 6772  e_str = match.gr
+0001ed00: 6f75 7028 2263 7572 6c79 2229 0a20 2020  oup("curly").   
+0001ed10: 2020 2020 2020 2020 206e 616d 655f 7661           name_va
+0001ed20: 6c75 655f 6469 6374 203d 2063 6c73 2e63  lue_dict = cls.c
+0001ed30: 7265 6174 655f 6e61 6d65 5f76 616c 7565  reate_name_value
+0001ed40: 5f64 6963 7428 7374 796c 655f 7374 7229  _dict(style_str)
+0001ed50: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0001ed60: 6e61 6d65 5f76 616c 7565 5f64 6963 740a  name_value_dict.
+0001ed70: 0a20 2020 2040 636c 6173 736d 6574 686f  .    @classmetho
+0001ed80: 640a 2020 2020 6465 6620 6372 6561 7465  d.    def create
+0001ed90: 5f6e 616d 655f 7661 6c75 655f 6469 6374  _name_value_dict
+0001eda0: 2863 6c73 2c20 7374 796c 655f 7374 7229  (cls, style_str)
+0001edb0: 3a0a 2020 2020 2020 2020 6e61 6d65 5f76  :.        name_v
+0001edc0: 616c 7565 5f64 6963 7420 3d20 6469 6374  alue_dict = dict
+0001edd0: 2829 0a20 2020 2020 2020 2073 7479 6c65  ().        style
+0001ede0: 5f73 7472 203d 2073 7479 6c65 5f73 7472  _str = style_str
+0001edf0: 2e73 7472 6970 2829 0a20 2020 2020 2020  .strip().       
+0001ee00: 2073 7479 6c65 7320 3d20 7374 796c 655f   styles = style_
+0001ee10: 7374 722e 7370 6c69 7428 223b 2229 0a20  str.split(";"). 
+0001ee20: 2020 2020 2020 2066 6f72 2073 7479 6c65         for style
+0001ee30: 2069 6e20 7374 796c 6573 3a0a 2020 2020   in styles:.    
+0001ee40: 2020 2020 2020 2020 7374 796c 6520 3d20          style = 
+0001ee50: 7374 796c 652e 7374 7269 7028 290a 2020  style.strip().  
+0001ee60: 2020 2020 2020 2020 2020 6966 206c 656e            if len
+0001ee70: 2873 7479 6c65 2920 3e20 303a 0a20 2020  (style) > 0:.   
+0001ee80: 2020 2020 2020 2020 2020 2020 2073 7320               ss 
+0001ee90: 3d20 7374 796c 652e 7370 6c69 7428 223a  = style.split(":
+0001eea0: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+0001eeb0: 2020 2069 6620 6c65 6e28 7373 2920 213d     if len(ss) !=
+0001eec0: 2032 3a0a 2020 2020 2020 2020 2020 2020   2:.            
+0001eed0: 2020 2020 2020 2020 7261 6973 6520 4b65          raise Ke
+0001eee0: 7945 7272 6f72 2866 2262 6164 2073 7479  yError(f"bad sty
+0001eef0: 6c65 207b 7374 796c 657d 2069 6e20 4353  le {style} in CS
+0001ef00: 533a 207b 7374 796c 655f 7374 727d 2229  S: {style_str}")
+0001ef10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001ef20: 206e 616d 6520 3d20 7373 5b30 5d2e 7374   name = ss[0].st
+0001ef30: 7269 7028 290a 2020 2020 2020 2020 2020  rip().          
+0001ef40: 2020 2020 2020 6966 206e 616d 6520 696e        if name in
+0001ef50: 206e 616d 655f 7661 6c75 655f 6469 6374   name_value_dict
+0001ef60: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001ef70: 2020 2020 2020 7261 6973 6520 4b65 7945        raise KeyE
+0001ef80: 7272 6f72 2866 227b 6e61 6d65 7d20 6475  rror(f"{name} du
+0001ef90: 706c 6963 6174 6564 2069 6e20 4353 533a  plicated in CSS:
+0001efa0: 207b 7374 796c 655f 7374 727d 2229 0a20   {style_str}"). 
+0001efb0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+0001efc0: 616d 655f 7661 6c75 655f 6469 6374 5b6e  ame_value_dict[n
+0001efd0: 616d 655d 203d 2073 735b 315d 2e73 7472  ame] = ss[1].str
+0001efe0: 6970 2829 0a20 2020 2020 2020 2072 6574  ip().        ret
+0001eff0: 7572 6e20 6e61 6d65 5f76 616c 7565 5f64  urn name_value_d
+0001f000: 6963 740a 0a20 2020 2023 2020 2020 636c  ict..    #    cl
+0001f010: 6173 7320 4353 5353 7479 6c65 3a0a 0a20  ass CSSStyle:.. 
+0001f020: 2020 2040 636c 6173 736d 6574 686f 640a     @classmethod.
+0001f030: 2020 2020 6465 6620 6372 6561 7465 5f63      def create_c
+0001f040: 7373 5f73 7479 6c65 5f66 726f 6d5f 6373  ss_style_from_cs
+0001f050: 735f 7374 7269 6e67 2863 6c73 2c20 6373  s_string(cls, cs
+0001f060: 735f 7374 7269 6e67 2c20 7265 6d6f 7665  s_string, remove
+0001f070: 5f70 7265 6669 783d 5472 7565 293a 0a20  _prefix=True):. 
+0001f080: 2020 2020 2020 2022 2222 6372 6561 7465         """create
+0001f090: 7320 4353 5353 7479 6c65 206f 626a 6563  s CSSStyle objec
+0001f0a0: 7420 6672 6f6d 2043 5353 2073 7472 696e  t from CSS strin
+0001f0b0: 6722 2222 0a20 2020 2020 2020 2063 7373  g""".        css
+0001f0c0: 5f73 7479 6c65 203d 204e 6f6e 650a 2020  _style = None.  
+0001f0d0: 2020 2020 2020 6966 2063 7373 5f73 7472        if css_str
+0001f0e0: 696e 673a 0a20 2020 2020 2020 2020 2020  ing:.           
+0001f0f0: 2063 7373 5f73 7479 6c65 203d 2043 5353   css_style = CSS
+0001f100: 5374 796c 6528 290a 2020 2020 2020 2020  Style().        
+0001f110: 2020 2020 6373 735f 7374 796c 652e 6e61      css_style.na
+0001f120: 6d65 5f76 616c 7565 5f64 6963 7420 3d20  me_value_dict = 
+0001f130: 636c 732e 6372 6561 7465 5f64 6963 745f  cls.create_dict_
+0001f140: 6672 6f6d 5f6e 616d 655f 7661 6c75 655f  from_name_value_
+0001f150: 6172 7261 795f 7374 7269 6e67 2863 7373  array_string(css
+0001f160: 5f73 7472 696e 6729 0a20 2020 2020 2020  _string).       
+0001f170: 2020 2020 2069 6620 7265 6d6f 7665 5f70       if remove_p
+0001f180: 7265 6669 783a 0a20 2020 2020 2020 2020  refix:.         
+0001f190: 2020 2020 2020 2066 6f6e 745f 6661 6d69         font_fami
+0001f1a0: 6c79 203d 2063 7373 5f73 7479 6c65 2e6e  ly = css_style.n
+0001f1b0: 616d 655f 7661 6c75 655f 6469 6374 2e67  ame_value_dict.g
+0001f1c0: 6574 2843 5353 5374 796c 652e 464f 4e54  et(CSSStyle.FONT
+0001f1d0: 5f46 414d 494c 5929 0a20 2020 2020 2020  _FAMILY).       
+0001f1e0: 2020 2020 2020 2020 2066 6f6e 745f 6661           font_fa
+0001f1f0: 6d69 6c79 3120 3d20 416d 6946 6f6e 742e  mily1 = AmiFont.
+0001f200: 7472 696d 5f70 6466 5f70 7265 6669 7828  trim_pdf_prefix(
+0001f210: 666f 6e74 5f66 616d 696c 7929 0a20 2020  font_family).   
+0001f220: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0001f230: 666f 6e74 5f66 616d 696c 7931 2061 6e64  font_family1 and
+0001f240: 2066 6f6e 745f 6661 6d69 6c79 3120 213d   font_family1 !=
+0001f250: 2066 6f6e 745f 6661 6d69 6c79 3a0a 2020   font_family:.  
+0001f260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f270: 2020 6373 735f 7374 796c 652e 6e61 6d65    css_style.name
+0001f280: 5f76 616c 7565 5f64 6963 745b 4353 5353  _value_dict[CSSS
+0001f290: 7479 6c65 2e46 4f4e 545f 4641 4d49 4c59  tyle.FONT_FAMILY
+0001f2a0: 5d20 3d20 666f 6e74 5f66 616d 696c 7931  ] = font_family1
+0001f2b0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0001f2c0: 6373 735f 7374 796c 650a 0a20 2020 2064  css_style..    d
+0001f2d0: 6566 205f 5f65 715f 5f28 7365 6c66 2c20  ef __eq__(self, 
+0001f2e0: 6f74 6865 7229 3a0a 2020 2020 2020 2020  other):.        
+0001f2f0: 2222 220a 2020 2020 2020 2020 7465 7374  """.        test
+0001f300: 7320 7768 6574 6865 7220 7365 6c66 2061  s whether self a
+0001f310: 6e64 206f 7468 6572 2068 6176 6520 6571  nd other have eq
+0001f320: 7561 6c20 6469 6374 696f 6e61 7269 6573  ual dictionaries
+0001f330: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0001f340: 2020 2020 2069 6620 7479 7065 286f 7468       if type(oth
+0001f350: 6572 2920 6973 2043 5353 5374 796c 653a  er) is CSSStyle:
+0001f360: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+0001f370: 7572 6e20 7365 6c66 2e6e 616d 655f 7661  urn self.name_va
+0001f380: 6c75 655f 6469 6374 203d 3d20 6f74 6865  lue_dict == othe
+0001f390: 722e 6e61 6d65 5f76 616c 7565 5f64 6963  r.name_value_dic
+0001f3a0: 740a 2020 2020 2020 2020 7265 7475 726e  t.        return
+0001f3b0: 2046 616c 7365 0a0a 2020 2020 6465 6620   False..    def 
+0001f3c0: 7365 745f 6174 7472 6962 7574 6528 7365  set_attribute(se
+0001f3d0: 6c66 2c20 7072 6f70 6572 7479 2c20 7661  lf, property, va
+0001f3e0: 6c75 6529 3a0a 2020 2020 2020 2020 2222  lue):.        ""
+0001f3f0: 220a 2020 2020 2020 2020 7365 7473 206e  ".        sets n
+0001f400: 616d 652d 7661 6c75 6520 7061 6972 2069  ame-value pair i
+0001f410: 6e20 4353 5353 7479 6c65 0a20 2020 2020  n CSSStyle.     
+0001f420: 2020 2069 676e 6f72 6573 2065 6d70 7479     ignores empty
+0001f430: 2076 616c 7565 7320 6f72 204e 6f6e 650a   values or None.
+0001f440: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0001f450: 2020 2020 6966 2076 616c 7565 2061 6e64      if value and
+0001f460: 206c 656e 2873 7472 2876 616c 7565 2929   len(str(value))
+0001f470: 203e 2030 3a0a 2020 2020 2020 2020 2020   > 0:.          
+0001f480: 2020 7365 6c66 2e6e 616d 655f 7661 6c75    self.name_valu
+0001f490: 655f 6469 6374 5b70 726f 7065 7274 795d  e_dict[property]
+0001f4a0: 203d 2076 616c 7565 0a0a 2020 2020 6465   = value..    de
+0001f4b0: 6620 7365 745f 6661 6d69 6c79 2873 656c  f set_family(sel
+0001f4c0: 662c 2066 616d 696c 7929 3a0a 2020 2020  f, family):.    
+0001f4d0: 2020 2020 6966 2066 616d 696c 793a 0a20      if family:. 
+0001f4e0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0001f4f0: 7365 745f 6174 7472 6962 7574 6528 4353  set_attribute(CS
+0001f500: 5353 7479 6c65 2e46 4f4e 545f 4641 4d49  SStyle.FONT_FAMI
+0001f510: 4c59 2c20 6661 6d69 6c79 290a 0a20 2020  LY, family)..   
+0001f520: 2064 6566 2073 6574 5f66 6f6e 745f 7765   def set_font_we
+0001f530: 6967 6874 2873 656c 662c 2077 6569 6768  ight(self, weigh
+0001f540: 7429 3a0a 2020 2020 2020 2020 7765 6967  t):.        weig
+0001f550: 6874 203d 2077 6569 6768 742e 6c6f 7765  ht = weight.lowe
+0001f560: 7228 290a 2020 2020 2020 2020 6966 2077  r().        if w
+0001f570: 6569 6768 743a 0a20 2020 2020 2020 2020  eight:.         
+0001f580: 2020 2069 6620 7765 6967 6874 203d 3d20     if weight == 
+0001f590: 4353 5353 7479 6c65 2e4e 4f52 4d41 4c3a  CSSStyle.NORMAL:
+0001f5a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001f5b0: 2073 656c 662e 7365 745f 6174 7472 6962   self.set_attrib
+0001f5c0: 7574 6528 4353 5353 7479 6c65 2e46 4f4e  ute(CSSStyle.FON
+0001f5d0: 545f 5745 4947 4854 2c20 4353 5353 7479  T_WEIGHT, CSSSty
+0001f5e0: 6c65 2e4e 4f52 4d41 4c29 0a20 2020 2020  le.NORMAL).     
+0001f5f0: 2020 2020 2020 2069 6620 7765 6967 6874         if weight
+0001f600: 203d 3d20 4353 5353 7479 6c65 2e42 4f4c   == CSSStyle.BOL
+0001f610: 443a 0a20 2020 2020 2020 2020 2020 2020  D:.             
+0001f620: 2020 2073 656c 662e 7365 745f 6174 7472     self.set_attr
+0001f630: 6962 7574 6528 4353 5353 7479 6c65 2e46  ibute(CSSStyle.F
+0001f640: 4f4e 545f 5745 4947 4854 2c20 4353 5353  ONT_WEIGHT, CSSS
+0001f650: 7479 6c65 2e42 4f4c 4429 0a20 2020 2020  tyle.BOLD).     
+0001f660: 2020 2020 2020 2069 6620 7765 6967 6874         if weight
+0001f670: 203d 3d20 4353 5353 7479 6c65 2e4c 4947   == CSSStyle.LIG
+0001f680: 4854 3a0a 2020 2020 2020 2020 2020 2020  HT:.            
+0001f690: 2020 2020 7365 6c66 2e73 6574 5f61 7474      self.set_att
+0001f6a0: 7269 6275 7465 2843 5353 5374 796c 652e  ribute(CSSStyle.
+0001f6b0: 464f 4e54 5f57 4549 4748 542c 2043 5353  FONT_WEIGHT, CSS
+0001f6c0: 5374 796c 652e 4c49 4748 5429 0a0a 2020  Style.LIGHT)..  
+0001f6d0: 2020 6465 6620 7365 745f 666f 6e74 5f73    def set_font_s
+0001f6e0: 7479 6c65 2873 656c 662c 2073 7479 6c65  tyle(self, style
+0001f6f0: 293a 0a20 2020 2020 2020 2069 6620 7374  ):.        if st
+0001f700: 796c 653a 0a20 2020 2020 2020 2020 2020  yle:.           
+0001f710: 2069 6620 7374 796c 652e 6c6f 7765 7228   if style.lower(
+0001f720: 2920 3d3d 2043 5353 5374 796c 652e 4e4f  ) == CSSStyle.NO
+0001f730: 524d 414c 2e6c 6f77 6572 2829 3a0a 2020  RMAL.lower():.  
+0001f740: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0001f750: 6c66 2e73 6574 5f61 7474 7269 6275 7465  lf.set_attribute
+0001f760: 2843 5353 5374 796c 652e 464f 4e54 5f53  (CSSStyle.FONT_S
+0001f770: 5459 4c45 2c20 4353 5353 7479 6c65 2e4e  TYLE, CSSStyle.N
+0001f780: 4f52 4d41 4c29 0a20 2020 2020 2020 2020  ORMAL).         
+0001f790: 2020 2069 6620 7374 796c 652e 6c6f 7765     if style.lowe
+0001f7a0: 7228 2920 3d3d 2043 5353 5374 796c 652e  r() == CSSStyle.
+0001f7b0: 4954 414c 4943 2e6c 6f77 6572 2829 3a0a  ITALIC.lower():.
+0001f7c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f7d0: 7365 6c66 2e73 6574 5f61 7474 7269 6275  self.set_attribu
+0001f7e0: 7465 2843 5353 5374 796c 652e 464f 4e54  te(CSSStyle.FONT
+0001f7f0: 5f53 5459 4c45 2c20 4353 5353 7479 6c65  _STYLE, CSSStyle
+0001f800: 2e49 5441 4c49 4329 0a0a 2020 2020 6465  .ITALIC)..    de
+0001f810: 6620 6765 745f 6174 7472 6962 7574 6528  f get_attribute(
+0001f820: 7365 6c66 2c20 7072 6f70 6572 7479 293a  self, property):
+0001f830: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0001f840: 2020 2020 2067 6574 7320 7661 6c75 6520       gets value 
+0001f850: 666f 7220 6e61 6d65 2069 6e20 4353 5353  for name in CSSS
+0001f860: 7479 6c65 0a20 2020 2020 2020 2069 676e  tyle.        ign
+0001f870: 6f72 6573 2065 6d70 7479 2076 616c 7565  ores empty value
+0001f880: 7320 6f72 204e 6f6e 650a 2020 2020 2020  s or None.      
+0001f890: 2020 2222 220a 2020 2020 2020 2020 7265    """.        re
+0001f8a0: 7475 726e 2073 656c 662e 6e61 6d65 5f76  turn self.name_v
+0001f8b0: 616c 7565 5f64 6963 7420 616e 6420 7365  alue_dict and se
+0001f8c0: 6c66 2e6e 616d 655f 7661 6c75 655f 6469  lf.name_value_di
+0001f8d0: 6374 2e67 6574 2870 726f 7065 7274 7929  ct.get(property)
+0001f8e0: 0a0a 2020 2020 2320 2020 2063 6c61 7373  ..    #    class
+0001f8f0: 2043 5353 5374 796c 653a 0a0a 2020 2020   CSSStyle:..    
+0001f900: 6465 6620 6765 745f 666f 6e74 5f73 7479  def get_font_sty
+0001f910: 6c65 5f61 7474 7269 6275 7465 7328 7365  le_attributes(se
+0001f920: 6c66 293a 0a20 2020 2020 2020 2022 2222  lf):.        """
+0001f930: 0a20 2020 2020 2020 2067 6574 7320 7475  .        gets tu
+0001f940: 706c 6520 6f66 2034 2066 6f6e 7420 6174  ple of 4 font at
+0001f950: 7472 6962 7574 6573 2028 7369 7a65 2c20  tributes (size, 
+0001f960: 6e6f 6e73 7472 6f6b 652c 2073 7472 6f6b  nonstroke, strok
+0001f970: 652c 2066 6f6e 746e 616d 6529 0a20 2020  e, fontname).   
+0001f980: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
+0001f990: 2020 6966 2073 656c 662e 6e61 6d65 5f76    if self.name_v
+0001f9a0: 616c 7565 5f64 6963 7420 6973 204e 6f6e  alue_dict is Non
+0001f9b0: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
+0001f9c0: 6574 7572 6e20 284e 6f6e 652c 204e 6f6e  eturn (None, Non
+0001f9d0: 652c 204e 6f6e 652c 204e 6f6e 652c 204e  e, None, None, N
+0001f9e0: 6f6e 6529 0a20 2020 2020 2020 2072 6574  one).        ret
+0001f9f0: 7572 6e20 280a 2020 2020 2020 2020 2020  urn (.          
+0001fa00: 2020 2320 7365 6c66 2e6e 616d 655f 7661    # self.name_va
+0001fa10: 6c75 655f 6469 6374 2e67 6574 2843 5353  lue_dict.get(CSS
+0001fa20: 5374 796c 652e 5749 4454 4829 2c0a 2020  Style.WIDTH),.  
+0001fa30: 2020 2020 2020 2020 2020 7365 6c66 2e67            self.g
+0001fa40: 6574 5f61 7474 7269 6275 7465 2843 5353  et_attribute(CSS
+0001fa50: 5374 796c 652e 464f 4e54 5f53 495a 4529  Style.FONT_SIZE)
+0001fa60: 2c0a 2020 2020 2020 2020 2020 2020 7365  ,.            se
+0001fa70: 6c66 2e67 6574 5f61 7474 7269 6275 7465  lf.get_attribute
+0001fa80: 2843 5353 5374 796c 652e 4649 4c4c 292c  (CSSStyle.FILL),
+0001fa90: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0001faa0: 662e 6765 745f 6174 7472 6962 7574 6528  f.get_attribute(
+0001fab0: 4353 5353 7479 6c65 2e53 5452 4f4b 4529  CSSStyle.STROKE)
+0001fac0: 2c0a 2020 2020 2020 2020 2020 2020 7365  ,.            se
+0001fad0: 6c66 2e67 6574 5f61 7474 7269 6275 7465  lf.get_attribute
+0001fae0: 2843 5353 5374 796c 652e 464f 4e54 5f46  (CSSStyle.FONT_F
+0001faf0: 414d 494c 5929 0a20 2020 2020 2020 2029  AMILY).        )
+0001fb00: 0a0a 2020 2020 2320 2020 2063 6c61 7373  ..    #    class
+0001fb10: 2043 5353 5374 796c 653a 0a0a 2020 2020   CSSStyle:..    
+0001fb20: 6465 6620 7265 6d6f 7665 2873 656c 662c  def remove(self,
+0001fb30: 206e 616d 6529 3a0a 2020 2020 2020 2020   name):.        
+0001fb40: 2222 220a 2020 2020 2020 2020 7265 6d6f  """.        remo
+0001fb50: 7665 7320 6e61 6d65 6420 6974 656d 2066  ves named item f
+0001fb60: 726f 6d20 4353 5353 7479 6c65 0a20 2020  rom CSSStyle.   
 0001fb70: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0001fb80: 2063 7373 5f73 7472 203d 2073 656c 662e   css_str = self.
-0001fb90: 6765 745f 6373 735f 7661 6c75 6528 290a  get_css_value().
-0001fba0: 2020 2020 2020 2020 656c 656d 2e61 7474          elem.att
-0001fbb0: 7269 625b 4353 5353 7479 6c65 2e53 5459  rib[CSSStyle.STY
-0001fbc0: 4c45 5d20 3d20 6373 735f 7374 720a 0a20  LE] = css_str.. 
-0001fbd0: 2020 2023 2020 2020 636c 6173 7320 4353     #    class CS
-0001fbe0: 5353 7479 6c65 3a0a 0a20 2020 2064 6566  SStyle:..    def
-0001fbf0: 2067 6574 5f63 7373 5f76 616c 7565 2873   get_css_value(s
-0001fc00: 656c 662c 2077 7261 705f 7769 7468 5f63  elf, wrap_with_c
-0001fc10: 7572 6c79 3d46 616c 7365 293a 0a20 2020  urly=False):.   
-0001fc20: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0001fc30: 2067 656e 6572 6174 6573 2063 7373 2073   generates css s
-0001fc40: 7472 696e 6720 7769 7468 6f75 7420 7175  tring without qu
-0001fc50: 6f74 6564 206e 616d 6573 2061 6e64 2076  oted names and v
-0001fc60: 616c 7565 730a 2020 2020 2020 2020 3a70  alues.        :p
-0001fc70: 6172 616d 2077 7261 705f 7769 7468 5f63  aram wrap_with_c
-0001fc80: 7572 6c79 3a20 6966 2074 7275 6520 656e  urly: if true en
-0001fc90: 636c 6f73 6520 7374 7269 6e67 2069 6e20  close string in 
-0001fca0: 227b 2220 2e2e 2e20 227d 220a 2020 2020  "{" ... "}".    
-0001fcb0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0001fcc0: 7320 3d20 2222 0a20 2020 2020 2020 2066  s = "".        f
-0001fcd0: 6f72 206b 6579 2069 6e20 7365 6c66 2e6e  or key in self.n
-0001fce0: 616d 655f 7661 6c75 655f 6469 6374 3a0a  ame_value_dict:.
-0001fcf0: 2020 2020 2020 2020 2020 2020 7661 6c20              val 
-0001fd00: 3d20 7365 6c66 2e6e 616d 655f 7661 6c75  = self.name_valu
-0001fd10: 655f 6469 6374 5b6b 6579 5d0a 2020 2020  e_dict[key].    
-0001fd20: 2020 2020 2020 2020 7320 2b3d 206b 6579          s += key
-0001fd30: 202b 2022 3a20 2220 2b20 7374 7228 7661   + ": " + str(va
-0001fd40: 6c29 202b 2022 3b20 220a 2020 2020 2020  l) + "; ".      
-0001fd50: 2020 7320 3d20 732e 7374 7269 7028 290a    s = s.strip().
-0001fd60: 2020 2020 2020 2020 7265 7475 726e 2022          return "
-0001fd70: 7b22 202b 2073 202b 2022 7d22 2069 6620  {" + s + "}" if 
-0001fd80: 7772 6170 5f77 6974 685f 6375 726c 7920  wrap_with_curly 
-0001fd90: 656c 7365 2073 0a0a 2020 2020 6465 6620  else s..    def 
-0001fda0: 6174 7476 616c 2873 656c 662c 206e 616d  attval(self, nam
-0001fdb0: 6529 3a0a 2020 2020 2020 2020 7265 7475  e):.        retu
-0001fdc0: 726e 2073 656c 662e 6e61 6d65 5f76 616c  rn self.name_val
-0001fdd0: 7565 5f64 6963 742e 6765 7428 6e61 6d65  ue_dict.get(name
-0001fde0: 2920 6966 2073 656c 662e 6e61 6d65 5f76  ) if self.name_v
-0001fdf0: 616c 7565 5f64 6963 7420 656c 7365 204e  alue_dict else N
-0001fe00: 6f6e 650a 0a20 2020 2023 2020 2020 636c  one..    #    cl
-0001fe10: 6173 7320 4353 5353 7479 6c65 3a0a 0a20  ass CSSStyle:.. 
-0001fe20: 2020 2040 7072 6f70 6572 7479 0a20 2020     @property.   
-0001fe30: 2064 6566 2066 6f6e 745f 6661 6d69 6c79   def font_family
-0001fe40: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-0001fe50: 7265 7475 726e 2073 656c 662e 6174 7476  return self.attv
-0001fe60: 616c 2843 5353 5374 796c 652e 464f 4e54  al(CSSStyle.FONT
-0001fe70: 5f46 414d 494c 5929 0a0a 2020 2020 4070  _FAMILY)..    @p
-0001fe80: 726f 7065 7274 790a 2020 2020 6465 6620  roperty.    def 
-0001fe90: 746f 7028 7365 6c66 293a 0a20 2020 2020  top(self):.     
-0001fea0: 2020 2072 6574 7572 6e20 7365 6c66 2e67     return self.g
-0001feb0: 6574 5f6e 756d 6572 6963 5f61 7474 7661  et_numeric_attva
-0001fec0: 6c28 4353 5353 7479 6c65 2e54 4f50 290a  l(CSSStyle.TOP).
-0001fed0: 0a20 2020 2040 7072 6f70 6572 7479 0a20  .    @property. 
-0001fee0: 2020 2064 6566 2066 6f6e 745f 7369 7a65     def font_size
-0001fef0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-0001ff00: 7265 7475 726e 2073 656c 662e 6765 745f  return self.get_
-0001ff10: 6e75 6d65 7269 635f 6174 7476 616c 2843  numeric_attval(C
-0001ff20: 5353 5374 796c 652e 464f 4e54 5f53 495a  SSStyle.FONT_SIZ
-0001ff30: 4529 0a0a 2020 2020 4070 726f 7065 7274  E)..    @propert
-0001ff40: 790a 2020 2020 6465 6620 6973 5f62 6f6c  y.    def is_bol
-0001ff50: 6428 7365 6c66 293a 0a20 2020 2020 2020  d(self):.       
-0001ff60: 2077 6569 6768 7420 3d20 7365 6c66 2e61   weight = self.a
-0001ff70: 7474 7661 6c28 4353 5353 7479 6c65 2e46  ttval(CSSStyle.F
-0001ff80: 4f4e 545f 5745 4947 4854 290a 2020 2020  ONT_WEIGHT).    
-0001ff90: 2020 2020 7265 7475 726e 2077 6569 6768      return weigh
-0001ffa0: 7420 6973 206e 6f74 204e 6f6e 6520 616e  t is not None an
-0001ffb0: 6420 7765 6967 6874 2e6c 6f77 6572 2829  d weight.lower()
-0001ffc0: 203d 3d20 4353 5353 7479 6c65 2e42 4f4c   == CSSStyle.BOL
-0001ffd0: 442e 6c6f 7765 7228 290a 0a20 2020 2040  D.lower()..    @
-0001ffe0: 7072 6f70 6572 7479 0a20 2020 2064 6566  property.    def
-0001fff0: 2069 735f 6974 616c 6963 2873 656c 6629   is_italic(self)
-00020000: 3a0a 2020 2020 2020 2020 7374 796c 6520  :.        style 
-00020010: 3d20 7365 6c66 2e61 7474 7661 6c28 4353  = self.attval(CS
-00020020: 5353 7479 6c65 2e46 4f4e 545f 5354 594c  SStyle.FONT_STYL
-00020030: 4529 0a20 2020 2020 2020 2072 6574 7572  E).        retur
-00020040: 6e20 7374 796c 6520 6973 206e 6f74 204e  n style is not N
-00020050: 6f6e 6520 616e 6420 7374 796c 652e 6c6f  one and style.lo
-00020060: 7765 7228 2920 3d3d 2043 5353 5374 796c  wer() == CSSStyl
-00020070: 652e 4954 414c 4943 2e6c 6f77 6572 2829  e.ITALIC.lower()
-00020080: 0a0a 2020 2020 4070 726f 7065 7274 790a  ..    @property.
-00020090: 2020 2020 6465 6620 626f 7474 6f6d 2873      def bottom(s
-000200a0: 656c 6629 3a0a 2020 2020 2020 2020 7265  elf):.        re
-000200b0: 7475 726e 2073 656c 662e 6765 745f 6e75  turn self.get_nu
-000200c0: 6d65 7269 635f 6174 7476 616c 2843 5353  meric_attval(CSS
-000200d0: 5374 796c 652e 424f 5454 4f4d 290a 0a20  Style.BOTTOM).. 
-000200e0: 2020 2040 7072 6f70 6572 7479 0a20 2020     @property.   
-000200f0: 2064 6566 206c 6566 7428 7365 6c66 293a   def left(self):
-00020100: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00020110: 7365 6c66 2e67 6574 5f6e 756d 6572 6963  self.get_numeric
-00020120: 5f61 7474 7661 6c28 4353 5353 7479 6c65  _attval(CSSStyle
-00020130: 2e4c 4546 5429 0a0a 2020 2020 2320 2020  .LEFT)..    #   
-00020140: 2063 6c61 7373 2043 5353 5374 796c 653a   class CSSStyle:
-00020150: 0a0a 2020 2020 4070 726f 7065 7274 790a  ..    @property.
-00020160: 2020 2020 6465 6620 7769 6474 6828 7365      def width(se
-00020170: 6c66 293a 0a20 2020 2020 2020 2072 6574  lf):.        ret
-00020180: 7572 6e20 7365 6c66 2e67 6574 5f6e 756d  urn self.get_num
-00020190: 6572 6963 5f61 7474 7661 6c28 4353 5353  eric_attval(CSSS
-000201a0: 7479 6c65 2e57 4944 5448 290a 0a20 2020  tyle.WIDTH)..   
-000201b0: 2040 7072 6f70 6572 7479 0a20 2020 2064   @property.    d
-000201c0: 6566 2068 6569 6768 7428 7365 6c66 293a  ef height(self):
-000201d0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-000201e0: 7365 6c66 2e67 6574 5f6e 756d 6572 6963  self.get_numeric
-000201f0: 5f61 7474 7661 6c28 4353 5353 7479 6c65  _attval(CSSStyle
-00020200: 2e48 4549 4748 5429 0a0a 2020 2020 2320  .HEIGHT)..    # 
-00020210: 2020 2063 6c61 7373 2043 5353 5374 796c     class CSSStyl
-00020220: 653a 0a0a 2020 2020 4063 6c61 7373 6d65  e:..    @classme
-00020230: 7468 6f64 0a20 2020 2064 6566 2061 6464  thod.    def add
-00020240: 5f6e 616d 655f 7661 6c75 6528 636c 732c  _name_value(cls,
-00020250: 2065 6c65 6d2c 2063 7373 5f6e 616d 652c   elem, css_name,
-00020260: 2063 7373 5f76 616c 7565 293a 0a20 2020   css_value):.   
-00020270: 2020 2020 2022 2222 7570 6461 7465 7320       """updates 
-00020280: 7374 796c 6520 6f6e 2065 6c65 6d65 6e74  style on element
-00020290: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-000202a0: 6373 735f 6e61 6d65 3a20 6e61 6d65 206f  css_name: name o
-000202b0: 6620 7072 6f70 6572 7479 0a20 2020 2020  f property.     
-000202c0: 2020 203a 7061 7261 6d20 6373 735f 7661     :param css_va
-000202d0: 6c75 653a 2076 616c 7565 206f 6620 7072  lue: value of pr
-000202e0: 6f70 6572 7479 0a20 2020 2020 2020 2022  operty.        "
-000202f0: 2222 0a20 2020 2020 2020 2063 7373 5f73  "".        css_s
-00020300: 7479 6c65 203d 2063 6c73 2e63 7265 6174  tyle = cls.creat
-00020310: 655f 6373 735f 7374 796c 655f 6672 6f6d  e_css_style_from
-00020320: 5f61 7474 7269 6275 7465 5f6f 665f 626f  _attribute_of_bo
-00020330: 6479 5f65 6c65 6d65 6e74 2865 6c65 6d29  dy_element(elem)
-00020340: 0a20 2020 2020 2020 2063 7373 5f73 7479  .        css_sty
-00020350: 6c65 2e6e 616d 655f 7661 6c75 655f 6469  le.name_value_di
-00020360: 6374 5b63 7373 5f6e 616d 655d 203d 2063  ct[css_name] = c
-00020370: 7373 5f76 616c 7565 0a20 2020 2020 2020  ss_value.       
-00020380: 2063 7373 5f73 7479 6c65 2e61 7070 6c79   css_style.apply
-00020390: 5f74 6f28 656c 656d 290a 0a20 2020 2064  _to(elem)..    d
-000203a0: 6566 2067 6574 5f6e 756d 6572 6963 5f61  ef get_numeric_a
-000203b0: 7474 7661 6c28 7365 6c66 2c20 6e61 6d65  ttval(self, name
-000203c0: 2c20 6465 6369 6d61 6c3d 3129 3a0a 2020  , decimal=1):.  
-000203d0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-000203e0: 2020 6765 7473 2066 6c6f 6174 2076 616c    gets float val
-000203f0: 7565 2c20 726f 756e 6465 6420 746f 2064  ue, rounded to d
-00020400: 656d 6963 616c 2070 6c61 6265 730a 2020  emical plabes.  
-00020410: 2020 2020 2020 3a70 6172 616d 206e 616d        :param nam
-00020420: 653a 206f 6620 7061 7261 6d65 7465 720a  e: of parameter.
-00020430: 2020 2020 2020 2020 3a70 6172 616d 2072          :param r
-00020440: 6f75 6e64 3a20 6e75 6d62 6572 206f 6620  ound: number of 
-00020450: 6465 6369 6d61 6c20 706c 6163 6573 2028  decimal places (
-00020460: 6465 6661 756c 7420 3229 0a20 2020 2020  default 2).     
-00020470: 2020 2022 2222 0a20 2020 2020 2020 2076     """.        v
-00020480: 616c 7565 203d 2073 656c 662e 6174 7476  alue = self.attv
-00020490: 616c 286e 616d 6529 0a20 2020 2020 2020  al(name).       
-000204a0: 2069 6620 6e6f 7420 7661 6c75 653a 0a20   if not value:. 
-000204b0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-000204c0: 6e20 4e6f 6e65 0a20 2020 2020 2020 2069  n None.        i
-000204d0: 6620 7479 7065 2876 616c 7565 2920 6973  f type(value) is
-000204e0: 2073 7472 3a0a 2020 2020 2020 2020 2020   str:.          
-000204f0: 2020 7661 6c75 6520 3d20 7661 6c75 655b    value = value[
-00020500: 3a2d 325d 2069 6620 7661 6c75 652e 656e  :-2] if value.en
-00020510: 6473 7769 7468 2843 5353 5374 796c 652e  dswith(CSSStyle.
-00020520: 5058 2920 656c 7365 2076 616c 7565 0a20  PX) else value. 
-00020530: 2020 2020 2020 2020 2020 2076 616c 7565             value
-00020540: 203d 2066 6c6f 6174 2876 616c 7565 290a   = float(value).
-00020550: 0a20 2020 2020 2020 2066 7320 3d20 726f  .        fs = ro
-00020560: 756e 6428 666c 6f61 7428 7661 6c75 6529  und(float(value)
-00020570: 2c20 6465 6369 6d61 6c29 0a20 2020 2020  , decimal).     
-00020580: 2020 2072 6574 7572 6e20 6673 0a0a 2020     return fs..  
-00020590: 2020 2320 2020 2063 6c61 7373 2043 5353    #    class CSS
-000205a0: 5374 796c 653a 0a0a 2020 2020 6465 6620  Style:..    def 
-000205b0: 6973 5f62 6f6c 645f 6e61 6d65 2873 656c  is_bold_name(sel
-000205c0: 6629 3a0a 2020 2020 2020 2020 2222 2248  f):.        """H
-000205d0: 6575 7269 7374 6963 2075 7369 6e67 2066  euristic using f
-000205e0: 6f6e 742d 6e61 6d65 0a20 2020 2020 2020  ont-name.       
-000205f0: 203a 7265 7475 726e 3a20 5472 7565 2069   :return: True i
-00020600: 6620 6e61 6d65 2063 6f6e 7461 696e 7320  f name contains 
-00020610: 2242 6f6c 6422 206f 7220 222e 4222 206f  "Bold" or ".B" o
-00020620: 7220 2e2e 2222 220a 2020 2020 2020 2020  r ..""".        
-00020630: 666f 6e74 6e61 6d65 203d 2073 656c 662e  fontname = self.
-00020640: 666f 6e74 5f66 616d 696c 790a 2020 2020  font_family.    
-00020650: 2020 2020 7265 7375 6c74 203d 2028 7365      result = (se
-00020660: 6c66 2e42 4f4c 4420 696e 2066 6f6e 746e  lf.BOLD in fontn
-00020670: 616d 6529 206f 7220 2866 6f6e 746e 616d  ame) or (fontnam
-00020680: 652e 656e 6473 7769 7468 2873 656c 662e  e.endswith(self.
-00020690: 444f 545f 4229 2920 6966 2066 6f6e 746e  DOT_B)) if fontn
-000206a0: 616d 6520 656c 7365 2046 616c 7365 0a20  ame else False. 
-000206b0: 2020 2020 2020 2072 6574 7572 6e20 7265         return re
-000206c0: 7375 6c74 0a0a 2020 2020 2320 2020 2063  sult..    #    c
-000206d0: 6c61 7373 2043 5353 5374 796c 653a 0a0a  lass CSSStyle:..
-000206e0: 2020 2020 6465 6620 6f62 6579 7328 7365      def obeys(se
-000206f0: 6c66 2c20 636f 6e64 6974 696f 6e29 3a0a  lf, condition):.
-00020700: 2020 2020 2020 2020 2222 2274 6573 7420          """test 
-00020710: 6966 2073 7479 6c65 206f 6265 7973 2061  if style obeys a
-00020720: 2028 7369 6d70 6c65 2920 636f 6e64 6974   (simple) condit
-00020730: 696f 6e0a 2020 2020 2020 2020 2849 276c  ion.        (I'l
-00020740: 6c20 7772 6974 6520 6120 4453 4c20 6c61  l write a DSL la
-00020750: 7465 7229 0a20 2020 2020 2020 203a 7061  ter).        :pa
-00020760: 7261 6d20 636f 6e64 6974 696f 6e3a 2028  ram condition: (
-00020770: 6e61 6d65 2c20 6f70 6572 6174 6f72 2c20  name, operator, 
-00020780: 7661 6c75 6529 2c20 652e 672e 2022 666f  value), e.g. "fo
-00020790: 6e74 2d73 697a 653e 3130 0a20 2020 2020  nt-size>10.     
-000207a0: 2020 203a 7265 7475 726e 3a20 7465 7374     :return: test
-000207b0: 206f 6620 636f 6e64 6974 696f 6e0a 0a20   of condition.. 
-000207c0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-000207d0: 2020 2072 6573 756c 7420 3d20 4661 6c73     result = Fals
-000207e0: 650a 2020 2020 2020 2020 6966 2063 6f6e  e.        if con
-000207f0: 6469 7469 6f6e 3a0a 2020 2020 2020 2020  dition:.        
-00020800: 2020 2020 7373 203d 2072 652e 7370 6c69      ss = re.spli
-00020810: 7428 2728 3e7c 3c7c 3d3d 7c21 3d29 272c  t('(>|<|==|!=)',
-00020820: 2063 6f6e 6469 7469 6f6e 290a 2020 2020   condition).    
-00020830: 2020 2020 2020 2020 6966 206c 656e 2873          if len(s
-00020840: 7329 2021 3d20 333a 0a20 2020 2020 2020  s) != 3:.       
-00020850: 2020 2020 2020 2020 206c 6f67 6769 6e67           logging
-00020860: 2e77 6172 6e69 6e67 2866 2243 616e 6e6f  .warning(f"Canno
-00020870: 7420 7061 7273 6520 6173 2063 6f6e 6469  t parse as condi
-00020880: 7469 6f6e 207b 636f 6e64 6974 696f 6e7d  tion {condition}
-00020890: 2229 0a20 2020 2020 2020 2020 2020 2065  ").            e
-000208a0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-000208b0: 2020 2020 206c 6873 203d 2073 735b 305d       lhs = ss[0]
-000208c0: 2e73 7472 6970 2829 0a20 2020 2020 2020  .strip().       
-000208d0: 2020 2020 2020 2020 2072 6873 203d 2073           rhs = s
-000208e0: 735b 325d 2e73 7472 6970 2829 0a0a 2020  s[2].strip()..  
-000208f0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00020900: 206c 6873 206e 6f74 2069 6e20 7365 6c66   lhs not in self
-00020910: 2e6e 616d 655f 7661 6c75 655f 6469 6374  .name_value_dict
-00020920: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00020930: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
-00020940: 7365 0a20 2020 2020 2020 2020 2020 2020  se.             
-00020950: 2020 2076 616c 7565 3120 3d20 7365 6c66     value1 = self
-00020960: 2e6e 616d 655f 7661 6c75 655f 6469 6374  .name_value_dict
-00020970: 2e67 6574 286c 6873 290a 2020 2020 2020  .get(lhs).      
-00020980: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-00020990: 2076 616c 7565 313a 0a20 2020 2020 2020   value1:.       
-000209a0: 2020 2020 2020 2020 2020 2020 206c 6f67               log
-000209b0: 6769 6e67 2e77 6172 6e69 6e67 2866 227b  ging.warning(f"{
-000209c0: 6c68 737d 206e 6f74 2069 6e20 7374 796c  lhs} not in styl
-000209d0: 6520 6174 7472 6962 7574 6520 7b73 656c  e attribute {sel
-000209e0: 662e 6e61 6d65 5f76 616c 7565 5f64 6963  f.name_value_dic
-000209f0: 747d 2229 0a20 2020 2020 2020 2020 2020  t}").           
-00020a00: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00020a10: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
-00020a20: 2020 2020 2020 6966 2076 616c 7565 312e        if value1.
-00020a30: 656e 6473 7769 7468 2843 5353 5374 796c  endswith(CSSStyl
-00020a40: 652e 5058 293a 0a20 2020 2020 2020 2020  e.PX):.         
-00020a50: 2020 2020 2020 2020 2020 2076 616c 7565             value
-00020a60: 3120 3d20 7661 6c75 6531 5b3a 2d32 5d0a  1 = value1[:-2].
-00020a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020a80: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
-00020a90: 2020 2020 2020 2020 2076 616c 7565 3120           value1 
-00020aa0: 3d20 666c 6f61 7428 7661 6c75 6531 290a  = float(value1).
-00020ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020ac0: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
-00020ad0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00020ae0: 2020 2020 2020 6c6f 6767 696e 672e 7761        logging.wa
-00020af0: 726e 696e 6728 6622 6e6f 7420 6120 6e75  rning(f"not a nu
-00020b00: 6d62 6572 207b 7661 6c75 6531 7d22 290a  mber {value1}").
-00020b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020b20: 2020 2020 7265 7475 726e 2046 616c 7365      return False
-00020b30: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00020b40: 2020 6966 2072 6873 2e65 6e64 7377 6974    if rhs.endswit
-00020b50: 6828 4353 5353 7479 6c65 2e50 5829 3a0a  h(CSSStyle.PX):.
-00020b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020b70: 2020 2020 7268 7320 3d20 7268 735b 3a2d      rhs = rhs[:-
-00020b80: 325d 0a20 2020 2020 2020 2020 2020 2020  2].             
-00020b90: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-00020ba0: 2020 2020 2020 2020 2020 2020 7661 6c75              valu
-00020bb0: 6532 203d 2066 6c6f 6174 2872 6873 290a  e2 = float(rhs).
+0001fb80: 2069 6620 7479 7065 286e 616d 6529 2069   if type(name) i
+0001fb90: 7320 6c69 7374 3a0a 2020 2020 2020 2020  s list:.        
+0001fba0: 2020 2020 666f 7220 6e20 696e 206e 616d      for n in nam
+0001fbb0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0001fbc0: 2020 2073 656c 662e 7265 6d6f 7665 286e     self.remove(n
+0001fbd0: 290a 2020 2020 2020 2020 656c 6966 206e  ).        elif n
+0001fbe0: 616d 6520 696e 2073 656c 662e 6e61 6d65  ame in self.name
+0001fbf0: 5f76 616c 7565 5f64 6963 743a 0a20 2020  _value_dict:.   
+0001fc00: 2020 2020 2020 2020 2073 656c 662e 6e61           self.na
+0001fc10: 6d65 5f76 616c 7565 5f64 6963 742e 706f  me_value_dict.po
+0001fc20: 7028 6e61 6d65 2c20 4e6f 6e65 290a 0a20  p(name, None).. 
+0001fc30: 2020 2064 6566 2061 7070 6c79 5f74 6f28     def apply_to(
+0001fc40: 7365 6c66 2c20 656c 656d 293a 0a20 2020  self, elem):.   
+0001fc50: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
+0001fc60: 2020 2222 220a 2020 2020 2020 2020 6373    """.        cs
+0001fc70: 735f 7374 7220 3d20 7365 6c66 2e67 6574  s_str = self.get
+0001fc80: 5f63 7373 5f76 616c 7565 2829 0a20 2020  _css_value().   
+0001fc90: 2020 2020 2065 6c65 6d2e 6174 7472 6962       elem.attrib
+0001fca0: 5b43 5353 5374 796c 652e 5354 594c 455d  [CSSStyle.STYLE]
+0001fcb0: 203d 2063 7373 5f73 7472 0a0a 2020 2020   = css_str..    
+0001fcc0: 2320 2020 2063 6c61 7373 2043 5353 5374  #    class CSSSt
+0001fcd0: 796c 653a 0a0a 2020 2020 6465 6620 6765  yle:..    def ge
+0001fce0: 745f 6373 735f 7661 6c75 6528 7365 6c66  t_css_value(self
+0001fcf0: 2c20 7772 6170 5f77 6974 685f 6375 726c  , wrap_with_curl
+0001fd00: 793d 4661 6c73 6529 3a0a 2020 2020 2020  y=False):.      
+0001fd10: 2020 2222 220a 2020 2020 2020 2020 6765    """.        ge
+0001fd20: 6e65 7261 7465 7320 6373 7320 7374 7269  nerates css stri
+0001fd30: 6e67 2077 6974 686f 7574 2071 756f 7465  ng without quote
+0001fd40: 6420 6e61 6d65 7320 616e 6420 7661 6c75  d names and valu
+0001fd50: 6573 0a20 2020 2020 2020 203a 7061 7261  es.        :para
+0001fd60: 6d20 7772 6170 5f77 6974 685f 6375 726c  m wrap_with_curl
+0001fd70: 793a 2069 6620 7472 7565 2065 6e63 6c6f  y: if true enclo
+0001fd80: 7365 2073 7472 696e 6720 696e 2022 7b22  se string in "{"
+0001fd90: 202e 2e2e 2022 7d22 0a20 2020 2020 2020   ... "}".       
+0001fda0: 2022 2222 0a20 2020 2020 2020 2073 203d   """.        s =
+0001fdb0: 2022 220a 2020 2020 2020 2020 666f 7220   "".        for 
+0001fdc0: 6b65 7920 696e 2073 656c 662e 6e61 6d65  key in self.name
+0001fdd0: 5f76 616c 7565 5f64 6963 743a 0a20 2020  _value_dict:.   
+0001fde0: 2020 2020 2020 2020 2076 616c 203d 2073           val = s
+0001fdf0: 656c 662e 6e61 6d65 5f76 616c 7565 5f64  elf.name_value_d
+0001fe00: 6963 745b 6b65 795d 0a20 2020 2020 2020  ict[key].       
+0001fe10: 2020 2020 2073 202b 3d20 6b65 7920 2b20       s += key + 
+0001fe20: 223a 2022 202b 2073 7472 2876 616c 2920  ": " + str(val) 
+0001fe30: 2b20 223b 2022 0a20 2020 2020 2020 2073  + "; ".        s
+0001fe40: 203d 2073 2e73 7472 6970 2829 0a20 2020   = s.strip().   
+0001fe50: 2020 2020 2072 6574 7572 6e20 227b 2220       return "{" 
+0001fe60: 2b20 7320 2b20 227d 2220 6966 2077 7261  + s + "}" if wra
+0001fe70: 705f 7769 7468 5f63 7572 6c79 2065 6c73  p_with_curly els
+0001fe80: 6520 730a 0a20 2020 2064 6566 2061 7474  e s..    def att
+0001fe90: 7661 6c28 7365 6c66 2c20 6e61 6d65 293a  val(self, name):
+0001fea0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0001feb0: 7365 6c66 2e6e 616d 655f 7661 6c75 655f  self.name_value_
+0001fec0: 6469 6374 2e67 6574 286e 616d 6529 2069  dict.get(name) i
+0001fed0: 6620 7365 6c66 2e6e 616d 655f 7661 6c75  f self.name_valu
+0001fee0: 655f 6469 6374 2065 6c73 6520 4e6f 6e65  e_dict else None
+0001fef0: 0a0a 2020 2020 2320 2020 2063 6c61 7373  ..    #    class
+0001ff00: 2043 5353 5374 796c 653a 0a0a 2020 2020   CSSStyle:..    
+0001ff10: 4070 726f 7065 7274 790a 2020 2020 6465  @property.    de
+0001ff20: 6620 666f 6e74 5f66 616d 696c 7928 7365  f font_family(se
+0001ff30: 6c66 293a 0a20 2020 2020 2020 2072 6574  lf):.        ret
+0001ff40: 7572 6e20 7365 6c66 2e61 7474 7661 6c28  urn self.attval(
+0001ff50: 4353 5353 7479 6c65 2e46 4f4e 545f 4641  CSSStyle.FONT_FA
+0001ff60: 4d49 4c59 290a 0a20 2020 2040 7072 6f70  MILY)..    @prop
+0001ff70: 6572 7479 0a20 2020 2064 6566 2074 6f70  erty.    def top
+0001ff80: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+0001ff90: 7265 7475 726e 2073 656c 662e 6765 745f  return self.get_
+0001ffa0: 6e75 6d65 7269 635f 6174 7476 616c 2843  numeric_attval(C
+0001ffb0: 5353 5374 796c 652e 544f 5029 0a0a 2020  SSStyle.TOP)..  
+0001ffc0: 2020 4070 726f 7065 7274 790a 2020 2020    @property.    
+0001ffd0: 6465 6620 666f 6e74 5f73 697a 6528 7365  def font_size(se
+0001ffe0: 6c66 293a 0a20 2020 2020 2020 2072 6574  lf):.        ret
+0001fff0: 7572 6e20 7365 6c66 2e67 6574 5f6e 756d  urn self.get_num
+00020000: 6572 6963 5f61 7474 7661 6c28 4353 5353  eric_attval(CSSS
+00020010: 7479 6c65 2e46 4f4e 545f 5349 5a45 290a  tyle.FONT_SIZE).
+00020020: 0a20 2020 2040 7072 6f70 6572 7479 0a20  .    @property. 
+00020030: 2020 2064 6566 2069 735f 626f 6c64 2873     def is_bold(s
+00020040: 656c 6629 3a0a 2020 2020 2020 2020 7765  elf):.        we
+00020050: 6967 6874 203d 2073 656c 662e 6174 7476  ight = self.attv
+00020060: 616c 2843 5353 5374 796c 652e 464f 4e54  al(CSSStyle.FONT
+00020070: 5f57 4549 4748 5429 0a20 2020 2020 2020  _WEIGHT).       
+00020080: 2072 6574 7572 6e20 7765 6967 6874 2069   return weight i
+00020090: 7320 6e6f 7420 4e6f 6e65 2061 6e64 2077  s not None and w
+000200a0: 6569 6768 742e 6c6f 7765 7228 2920 3d3d  eight.lower() ==
+000200b0: 2043 5353 5374 796c 652e 424f 4c44 2e6c   CSSStyle.BOLD.l
+000200c0: 6f77 6572 2829 0a0a 2020 2020 4070 726f  ower()..    @pro
+000200d0: 7065 7274 790a 2020 2020 6465 6620 6973  perty.    def is
+000200e0: 5f69 7461 6c69 6328 7365 6c66 293a 0a20  _italic(self):. 
+000200f0: 2020 2020 2020 2073 7479 6c65 203d 2073         style = s
+00020100: 656c 662e 6174 7476 616c 2843 5353 5374  elf.attval(CSSSt
+00020110: 796c 652e 464f 4e54 5f53 5459 4c45 290a  yle.FONT_STYLE).
+00020120: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00020130: 7479 6c65 2069 7320 6e6f 7420 4e6f 6e65  tyle is not None
+00020140: 2061 6e64 2073 7479 6c65 2e6c 6f77 6572   and style.lower
+00020150: 2829 203d 3d20 4353 5353 7479 6c65 2e49  () == CSSStyle.I
+00020160: 5441 4c49 432e 6c6f 7765 7228 290a 0a20  TALIC.lower().. 
+00020170: 2020 2040 7072 6f70 6572 7479 0a20 2020     @property.   
+00020180: 2064 6566 2062 6f74 746f 6d28 7365 6c66   def bottom(self
+00020190: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
+000201a0: 6e20 7365 6c66 2e67 6574 5f6e 756d 6572  n self.get_numer
+000201b0: 6963 5f61 7474 7661 6c28 4353 5353 7479  ic_attval(CSSSty
+000201c0: 6c65 2e42 4f54 544f 4d29 0a0a 2020 2020  le.BOTTOM)..    
+000201d0: 4070 726f 7065 7274 790a 2020 2020 6465  @property.    de
+000201e0: 6620 6c65 6674 2873 656c 6629 3a0a 2020  f left(self):.  
+000201f0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+00020200: 662e 6765 745f 6e75 6d65 7269 635f 6174  f.get_numeric_at
+00020210: 7476 616c 2843 5353 5374 796c 652e 4c45  tval(CSSStyle.LE
+00020220: 4654 290a 0a20 2020 2023 2020 2020 636c  FT)..    #    cl
+00020230: 6173 7320 4353 5353 7479 6c65 3a0a 0a20  ass CSSStyle:.. 
+00020240: 2020 2040 7072 6f70 6572 7479 0a20 2020     @property.   
+00020250: 2064 6566 2077 6964 7468 2873 656c 6629   def width(self)
+00020260: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+00020270: 2073 656c 662e 6765 745f 6e75 6d65 7269   self.get_numeri
+00020280: 635f 6174 7476 616c 2843 5353 5374 796c  c_attval(CSSStyl
+00020290: 652e 5749 4454 4829 0a0a 2020 2020 4070  e.WIDTH)..    @p
+000202a0: 726f 7065 7274 790a 2020 2020 6465 6620  roperty.    def 
+000202b0: 6865 6967 6874 2873 656c 6629 3a0a 2020  height(self):.  
+000202c0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+000202d0: 662e 6765 745f 6e75 6d65 7269 635f 6174  f.get_numeric_at
+000202e0: 7476 616c 2843 5353 5374 796c 652e 4845  tval(CSSStyle.HE
+000202f0: 4947 4854 290a 0a20 2020 2023 2020 2020  IGHT)..    #    
+00020300: 636c 6173 7320 4353 5353 7479 6c65 3a0a  class CSSStyle:.
+00020310: 0a20 2020 2040 636c 6173 736d 6574 686f  .    @classmetho
+00020320: 640a 2020 2020 6465 6620 6164 645f 6e61  d.    def add_na
+00020330: 6d65 5f76 616c 7565 2863 6c73 2c20 656c  me_value(cls, el
+00020340: 656d 2c20 6373 735f 6e61 6d65 2c20 6373  em, css_name, cs
+00020350: 735f 7661 6c75 6529 3a0a 2020 2020 2020  s_value):.      
+00020360: 2020 2222 2275 7064 6174 6573 2073 7479    """updates sty
+00020370: 6c65 206f 6e20 656c 656d 656e 740a 2020  le on element.  
+00020380: 2020 2020 2020 3a70 6172 616d 2063 7373        :param css
+00020390: 5f6e 616d 653a 206e 616d 6520 6f66 2070  _name: name of p
+000203a0: 726f 7065 7274 790a 2020 2020 2020 2020  roperty.        
+000203b0: 3a70 6172 616d 2063 7373 5f76 616c 7565  :param css_value
+000203c0: 3a20 7661 6c75 6520 6f66 2070 726f 7065  : value of prope
+000203d0: 7274 790a 2020 2020 2020 2020 2222 220a  rty.        """.
+000203e0: 2020 2020 2020 2020 6373 735f 7374 796c          css_styl
+000203f0: 6520 3d20 636c 732e 6372 6561 7465 5f63  e = cls.create_c
+00020400: 7373 5f73 7479 6c65 5f66 726f 6d5f 6174  ss_style_from_at
+00020410: 7472 6962 7574 655f 6f66 5f62 6f64 795f  tribute_of_body_
+00020420: 656c 656d 656e 7428 656c 656d 290a 2020  element(elem).  
+00020430: 2020 2020 2020 6373 735f 7374 796c 652e        css_style.
+00020440: 6e61 6d65 5f76 616c 7565 5f64 6963 745b  name_value_dict[
+00020450: 6373 735f 6e61 6d65 5d20 3d20 6373 735f  css_name] = css_
+00020460: 7661 6c75 650a 2020 2020 2020 2020 6373  value.        cs
+00020470: 735f 7374 796c 652e 6170 706c 795f 746f  s_style.apply_to
+00020480: 2865 6c65 6d29 0a0a 2020 2020 6465 6620  (elem)..    def 
+00020490: 6765 745f 6e75 6d65 7269 635f 6174 7476  get_numeric_attv
+000204a0: 616c 2873 656c 662c 206e 616d 652c 2064  al(self, name, d
+000204b0: 6563 696d 616c 3d31 293a 0a20 2020 2020  ecimal=1):.     
+000204c0: 2020 2022 2222 0a20 2020 2020 2020 2067     """.        g
+000204d0: 6574 7320 666c 6f61 7420 7661 6c75 652c  ets float value,
+000204e0: 2072 6f75 6e64 6564 2074 6f20 6465 6d69   rounded to demi
+000204f0: 6361 6c20 706c 6162 6573 0a20 2020 2020  cal plabes.     
+00020500: 2020 203a 7061 7261 6d20 6e61 6d65 3a20     :param name: 
+00020510: 6f66 2070 6172 616d 6574 6572 0a20 2020  of parameter.   
+00020520: 2020 2020 203a 7061 7261 6d20 726f 756e       :param roun
+00020530: 643a 206e 756d 6265 7220 6f66 2064 6563  d: number of dec
+00020540: 696d 616c 2070 6c61 6365 7320 2864 6566  imal places (def
+00020550: 6175 6c74 2032 290a 2020 2020 2020 2020  ault 2).        
+00020560: 2222 220a 2020 2020 2020 2020 7661 6c75  """.        valu
+00020570: 6520 3d20 7365 6c66 2e61 7474 7661 6c28  e = self.attval(
+00020580: 6e61 6d65 290a 2020 2020 2020 2020 6966  name).        if
+00020590: 206e 6f74 2076 616c 7565 3a0a 2020 2020   not value:.    
+000205a0: 2020 2020 2020 2020 7265 7475 726e 204e          return N
+000205b0: 6f6e 650a 2020 2020 2020 2020 6966 2074  one.        if t
+000205c0: 7970 6528 7661 6c75 6529 2069 7320 7374  ype(value) is st
+000205d0: 723a 0a20 2020 2020 2020 2020 2020 2076  r:.            v
+000205e0: 616c 7565 203d 2076 616c 7565 5b3a 2d32  alue = value[:-2
+000205f0: 5d20 6966 2076 616c 7565 2e65 6e64 7377  ] if value.endsw
+00020600: 6974 6828 4353 5353 7479 6c65 2e50 5829  ith(CSSStyle.PX)
+00020610: 2065 6c73 6520 7661 6c75 650a 2020 2020   else value.    
+00020620: 2020 2020 2020 2020 7661 6c75 6520 3d20          value = 
+00020630: 666c 6f61 7428 7661 6c75 6529 0a0a 2020  float(value)..  
+00020640: 2020 2020 2020 6673 203d 2072 6f75 6e64        fs = round
+00020650: 2866 6c6f 6174 2876 616c 7565 292c 2064  (float(value), d
+00020660: 6563 696d 616c 290a 2020 2020 2020 2020  ecimal).        
+00020670: 7265 7475 726e 2066 730a 0a20 2020 2023  return fs..    #
+00020680: 2020 2020 636c 6173 7320 4353 5353 7479      class CSSSty
+00020690: 6c65 3a0a 0a20 2020 2064 6566 2069 735f  le:..    def is_
+000206a0: 626f 6c64 5f6e 616d 6528 7365 6c66 293a  bold_name(self):
+000206b0: 0a20 2020 2020 2020 2022 2222 4865 7572  .        """Heur
+000206c0: 6973 7469 6320 7573 696e 6720 666f 6e74  istic using font
+000206d0: 2d6e 616d 650a 2020 2020 2020 2020 3a72  -name.        :r
+000206e0: 6574 7572 6e3a 2054 7275 6520 6966 206e  eturn: True if n
+000206f0: 616d 6520 636f 6e74 6169 6e73 2022 426f  ame contains "Bo
+00020700: 6c64 2220 6f72 2022 2e42 2220 6f72 202e  ld" or ".B" or .
+00020710: 2e22 2222 0a20 2020 2020 2020 2066 6f6e  .""".        fon
+00020720: 746e 616d 6520 3d20 7365 6c66 2e66 6f6e  tname = self.fon
+00020730: 745f 6661 6d69 6c79 0a20 2020 2020 2020  t_family.       
+00020740: 2072 6573 756c 7420 3d20 2873 656c 662e   result = (self.
+00020750: 424f 4c44 2069 6e20 666f 6e74 6e61 6d65  BOLD in fontname
+00020760: 2920 6f72 2028 666f 6e74 6e61 6d65 2e65  ) or (fontname.e
+00020770: 6e64 7377 6974 6828 7365 6c66 2e44 4f54  ndswith(self.DOT
+00020780: 5f42 2929 2069 6620 666f 6e74 6e61 6d65  _B)) if fontname
+00020790: 2065 6c73 6520 4661 6c73 650a 2020 2020   else False.    
+000207a0: 2020 2020 7265 7475 726e 2072 6573 756c      return resul
+000207b0: 740a 0a20 2020 2023 2020 2020 636c 6173  t..    #    clas
+000207c0: 7320 4353 5353 7479 6c65 3a0a 0a20 2020  s CSSStyle:..   
+000207d0: 2064 6566 206f 6265 7973 2873 656c 662c   def obeys(self,
+000207e0: 2063 6f6e 6469 7469 6f6e 293a 0a20 2020   condition):.   
+000207f0: 2020 2020 2022 2222 7465 7374 2069 6620       """test if 
+00020800: 7374 796c 6520 6f62 6579 7320 6120 2873  style obeys a (s
+00020810: 696d 706c 6529 2063 6f6e 6469 7469 6f6e  imple) condition
+00020820: 0a20 2020 2020 2020 2028 4927 6c6c 2077  .        (I'll w
+00020830: 7269 7465 2061 2044 534c 206c 6174 6572  rite a DSL later
+00020840: 290a 2020 2020 2020 2020 3a70 6172 616d  ).        :param
+00020850: 2063 6f6e 6469 7469 6f6e 3a20 286e 616d   condition: (nam
+00020860: 652c 206f 7065 7261 746f 722c 2076 616c  e, operator, val
+00020870: 7565 292c 2065 2e67 2e20 2266 6f6e 742d  ue), e.g. "font-
+00020880: 7369 7a65 3e31 300a 2020 2020 2020 2020  size>10.        
+00020890: 3a72 6574 7572 6e3a 2074 6573 7420 6f66  :return: test of
+000208a0: 2063 6f6e 6469 7469 6f6e 0a0a 2020 2020   condition..    
+000208b0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+000208c0: 7265 7375 6c74 203d 2046 616c 7365 0a20  result = False. 
+000208d0: 2020 2020 2020 2069 6620 636f 6e64 6974         if condit
+000208e0: 696f 6e3a 0a20 2020 2020 2020 2020 2020  ion:.           
+000208f0: 2073 7320 3d20 7265 2e73 706c 6974 2827   ss = re.split('
+00020900: 283e 7c3c 7c3d 3d7c 213d 2927 2c20 636f  (>|<|==|!=)', co
+00020910: 6e64 6974 696f 6e29 0a20 2020 2020 2020  ndition).       
+00020920: 2020 2020 2069 6620 6c65 6e28 7373 2920       if len(ss) 
+00020930: 213d 2033 3a0a 2020 2020 2020 2020 2020  != 3:.          
+00020940: 2020 2020 2020 6c6f 6767 696e 672e 7761        logging.wa
+00020950: 726e 696e 6728 6622 4361 6e6e 6f74 2070  rning(f"Cannot p
+00020960: 6172 7365 2061 7320 636f 6e64 6974 696f  arse as conditio
+00020970: 6e20 7b63 6f6e 6469 7469 6f6e 7d22 290a  n {condition}").
+00020980: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00020990: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000209a0: 2020 6c68 7320 3d20 7373 5b30 5d2e 7374    lhs = ss[0].st
+000209b0: 7269 7028 290a 2020 2020 2020 2020 2020  rip().          
+000209c0: 2020 2020 2020 7268 7320 3d20 7373 5b32        rhs = ss[2
+000209d0: 5d2e 7374 7269 7028 290a 0a20 2020 2020  ].strip()..     
+000209e0: 2020 2020 2020 2020 2020 2069 6620 6c68             if lh
+000209f0: 7320 6e6f 7420 696e 2073 656c 662e 6e61  s not in self.na
+00020a00: 6d65 5f76 616c 7565 5f64 6963 743a 0a20  me_value_dict:. 
+00020a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020a20: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
+00020a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020a40: 7661 6c75 6531 203d 2073 656c 662e 6e61  value1 = self.na
+00020a50: 6d65 5f76 616c 7565 5f64 6963 742e 6765  me_value_dict.ge
+00020a60: 7428 6c68 7329 0a20 2020 2020 2020 2020  t(lhs).         
+00020a70: 2020 2020 2020 2069 6620 6e6f 7420 7661         if not va
+00020a80: 6c75 6531 3a0a 2020 2020 2020 2020 2020  lue1:.          
+00020a90: 2020 2020 2020 2020 2020 6c6f 6767 696e            loggin
+00020aa0: 672e 7761 726e 696e 6728 6622 7b6c 6873  g.warning(f"{lhs
+00020ab0: 7d20 6e6f 7420 696e 2073 7479 6c65 2061  } not in style a
+00020ac0: 7474 7269 6275 7465 207b 7365 6c66 2e6e  ttribute {self.n
+00020ad0: 616d 655f 7661 6c75 655f 6469 6374 7d22  ame_value_dict}"
+00020ae0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00020af0: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
+00020b00: 7365 0a20 2020 2020 2020 2020 2020 2020  se.             
+00020b10: 2020 2069 6620 7661 6c75 6531 2e65 6e64     if value1.end
+00020b20: 7377 6974 6828 4353 5353 7479 6c65 2e50  swith(CSSStyle.P
+00020b30: 5829 3a0a 2020 2020 2020 2020 2020 2020  X):.            
+00020b40: 2020 2020 2020 2020 7661 6c75 6531 203d          value1 =
+00020b50: 2076 616c 7565 315b 3a2d 325d 0a20 2020   value1[:-2].   
+00020b60: 2020 2020 2020 2020 2020 2020 2074 7279               try
+00020b70: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00020b80: 2020 2020 2020 7661 6c75 6531 203d 2066        value1 = f
+00020b90: 6c6f 6174 2876 616c 7565 3129 0a20 2020  loat(value1).   
+00020ba0: 2020 2020 2020 2020 2020 2020 2065 7863               exc
+00020bb0: 6570 7420 4578 6365 7074 696f 6e3a 0a20  ept Exception:. 
 00020bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020bd0: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
-00020be0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00020bf0: 2020 2020 2020 6c6f 6767 696e 672e 7761        logging.wa
-00020c00: 726e 696e 6728 6622 6e6f 7420 6120 6e75  rning(f"not a nu
-00020c10: 6d62 6572 207b 7268 737d 2229 0a20 2020  mber {rhs}").   
-00020c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020c30: 2072 6574 7572 6e20 4661 6c73 650a 2020   return False.  
-00020c40: 2020 2020 2020 2020 2020 2020 2020 6f70                op
-00020c50: 6572 203d 2073 735b 315d 0a20 2020 2020  er = ss[1].     
-00020c60: 2020 2020 2020 2020 2020 2069 6620 6f70             if op
-00020c70: 6572 203d 3d20 223e 223a 0a20 2020 2020  er == ">":.     
-00020c80: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00020c90: 6573 756c 7420 3d20 7661 6c75 6531 203e  esult = value1 >
-00020ca0: 2076 616c 7565 320a 2020 2020 2020 2020   value2.        
-00020cb0: 2020 2020 2020 2020 656c 6966 206f 7065          elif ope
-00020cc0: 7220 3d3d 2022 3c22 3a0a 2020 2020 2020  r == "<":.      
-00020cd0: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00020ce0: 7375 6c74 203d 2076 616c 7565 3120 3c20  sult = value1 < 
-00020cf0: 7661 6c75 6532 0a20 2020 2020 2020 2020  value2.         
-00020d00: 2020 2020 2020 2065 6c69 6620 6f70 6572         elif oper
-00020d10: 203d 3d20 2221 3d22 3a0a 2020 2020 2020   == "!=":.      
-00020d20: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00020d30: 7375 6c74 203d 2076 616c 7565 3120 213d  sult = value1 !=
-00020d40: 2076 616c 7565 320a 2020 2020 2020 2020   value2.        
-00020d50: 2020 2020 2020 2020 656c 6966 206f 7065          elif ope
-00020d60: 7220 3d3d 2022 3d3d 223a 0a20 2020 2020  r == "==":.     
-00020d70: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00020d80: 6573 756c 7420 3d20 2876 616c 7565 3120  esult = (value1 
-00020d90: 3d3d 2076 616c 7565 3229 0a20 2020 2020  == value2).     
-00020da0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00020db0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00020dc0: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
-00020dd0: 4572 726f 7228 6622 6261 6420 6f70 6572  Error(f"bad oper
-00020de0: 6174 6f72 3a20 7b6f 7065 727d 2229 0a20  ator: {oper}"). 
-00020df0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00020e00: 6620 7265 7375 6c74 3a0a 2020 2020 2020  f result:.      
-00020e10: 2020 2020 2020 2020 2020 2020 2020 7061                pa
-00020e20: 7373 0a20 2020 2020 2020 2072 6574 7572  ss.        retur
-00020e30: 6e20 7265 7375 6c74 0a0a 2020 2020 2320  n result..    # 
-00020e40: 2020 2063 6c61 7373 2043 5353 5374 796c     class CSSStyl
-00020e50: 653a 0a0a 2020 2020 4063 6c61 7373 6d65  e:..    @classme
-00020e60: 7468 6f64 0a20 2020 2064 6566 2063 6d79  thod.    def cmy
-00020e70: 6b5f 746f 5f72 6762 2863 6c73 2c20 632c  k_to_rgb(cls, c,
-00020e80: 206d 2c20 792c 206b 293a 0a0a 2020 2020   m, y, k):..    
-00020e90: 2020 2020 7267 625f 7363 616c 6520 3d20      rgb_scale = 
-00020ea0: 3235 350a 2020 2020 2020 2020 2320 636d  255.        # cm
-00020eb0: 796b 5f73 6361 6c65 203d 2031 3030 0a20  yk_scale = 100. 
-00020ec0: 2020 2020 2020 2063 6d79 6b5f 7363 616c         cmyk_scal
-00020ed0: 6520 3d20 312e 300a 2020 2020 2020 2020  e = 1.0.        
-00020ee0: 7220 3d20 7267 625f 7363 616c 6520 2a20  r = rgb_scale * 
-00020ef0: 2831 2e30 202d 2028 6320 2b20 6b29 202f  (1.0 - (c + k) /
-00020f00: 2066 6c6f 6174 2863 6d79 6b5f 7363 616c   float(cmyk_scal
-00020f10: 6529 290a 2020 2020 2020 2020 6720 3d20  e)).        g = 
-00020f20: 7267 625f 7363 616c 6520 2a20 2831 2e30  rgb_scale * (1.0
-00020f30: 202d 2028 6d20 2b20 6b29 202f 2066 6c6f   - (m + k) / flo
-00020f40: 6174 2863 6d79 6b5f 7363 616c 6529 290a  at(cmyk_scale)).
-00020f50: 2020 2020 2020 2020 6220 3d20 7267 625f          b = rgb_
-00020f60: 7363 616c 6520 2a20 2831 2e30 202d 2028  scale * (1.0 - (
-00020f70: 7920 2b20 6b29 202f 2066 6c6f 6174 2863  y + k) / float(c
-00020f80: 6d79 6b5f 7363 616c 6529 290a 0a20 2020  myk_scale))..   
-00020f90: 2020 2020 2072 6574 7572 6e20 722c 2067       return r, g
-00020fa0: 2c20 620a 0a20 2020 2023 2020 2020 636c  , b..    #    cl
-00020fb0: 6173 7320 4353 5353 7479 6c65 3a0a 0a20  ass CSSStyle:.. 
-00020fc0: 2020 2040 636c 6173 736d 6574 686f 640a     @classmethod.
-00020fd0: 2020 2020 6465 6620 636d 6b79 5f74 6f5f      def cmky_to_
-00020fe0: 7267 6228 636c 732c 2063 2c20 6d2c 206b  rgb(cls, c, m, k
-00020ff0: 2c20 7929 3a0a 2020 2020 2020 2020 7265  , y):.        re
-00021000: 7475 726e 2063 6c73 2e63 6d79 6b5f 746f  turn cls.cmyk_to
-00021010: 5f72 6762 2863 2c20 6d2c 2079 2c20 6b29  _rgb(c, m, y, k)
-00021020: 0a0a 2020 2020 6465 6620 6578 7472 6163  ..    def extrac
-00021030: 745f 626f 6c64 5f69 7461 6c69 635f 6672  t_bold_italic_fr
-00021040: 6f6d 5f66 6f6e 745f 6661 6d69 6c79 280a  om_font_family(.
-00021050: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00021060: 2c0a 2020 2020 2020 2020 2020 2020 6f76  ,.            ov
-00021070: 6572 7772 6974 655f 626f 6c64 3d46 616c  erwrite_bold=Fal
-00021080: 7365 2c0a 2020 2020 2020 2020 2020 2020  se,.            
-00021090: 6f76 6572 7772 6974 655f 7374 796c 653d  overwrite_style=
-000210a0: 4661 6c73 652c 0a20 2020 2020 2020 2020  False,.         
-000210b0: 2020 206f 7665 7277 7269 7465 5f66 616d     overwrite_fam
-000210c0: 696c 793d 5472 7565 2c0a 2020 2020 2020  ily=True,.      
-000210d0: 2020 2020 2020 7374 796c 655f 7265 6765        style_rege
-000210e0: 783d 5354 594c 455f 5245 2c0a 2020 2020  x=STYLE_RE,.    
-000210f0: 2020 2020 2020 2020 7765 6967 6874 5f72          weight_r
-00021100: 6567 6578 3d57 4549 4748 545f 5245 293a  egex=WEIGHT_RE):
-00021110: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00021120: 2020 2020 2068 6575 7269 7374 6963 7320       heuristics 
-00021130: 746f 2066 696e 6420 626f 6c64 2061 6e64  to find bold and
-00021140: 2069 7461 6c69 6320 696e 2066 6f6e 7420   italic in font 
-00021150: 6e61 6d65 7320 616e 6420 7472 7920 746f  names and try to
-00021160: 206e 6f72 6d61 6c69 7365 0a20 2020 2020   normalise.     
-00021170: 2020 2065 2e67 2e0a 2020 2020 2020 2020     e.g..        
-00021180: 666f 6e74 2d66 616d 696c 793a 2054 696d  font-family: Tim
-00021190: 6573 4e65 7752 6f6d 616e 5053 2d42 6f6c  esNewRomanPS-Bol
-000211a0: 644d 543b 203d 3e20 666f 6e74 2d66 616d  dMT; => font-fam
-000211b0: 696c 793a 2054 696d 6573 4e65 7752 6f6d  ily: TimesNewRom
-000211c0: 616e 5053 4d54 3b20 666f 6e74 5f77 6569  anPSMT; font_wei
-000211d0: 6768 743a 2062 6f6c 640a 2020 2020 2020  ght: bold.      
-000211e0: 2020 666f 6e74 2d66 616d 696c 793a 2054    font-family: T
-000211f0: 696d 6573 4e65 7752 6f6d 616e 5053 2d49  imesNewRomanPS-I
-00021200: 7461 6c69 634d 543b 203d 3e20 666f 6e74  talicMT; => font
-00021210: 2d66 616d 696c 793a 2054 696d 6573 4e65  -family: TimesNe
-00021220: 7752 6f6d 616e 5053 4d54 3b20 666f 6e74  wRomanPSMT; font
-00021230: 5f73 7479 6c65 3a20 6974 616c 6963 0a20  _style: italic. 
-00021240: 2020 2020 2020 2074 6865 206f 7665 7277         the overw
-00021250: 7269 7465 5f2a 2064 6574 6572 6d69 6e65  rite_* determine
-00021260: 2077 6865 7465 6872 2065 7869 7374 696e   whetehr existin
-00021270: 6720 636f 6d70 6f6e 656e 7473 2077 696c  g components wil
-00021280: 6c20 6265 206f 7665 7277 7269 7474 656e  l be overwritten
-00021290: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-000212a0: 6f76 6572 7772 6974 655f 626f 6c64 3a20  overwrite_bold: 
-000212b0: 6372 6561 7465 2066 6f6e 745f 7765 6967  create font_weig
-000212c0: 6874 3a62 6f6c 6420 7265 6761 7264 6c65  ht:bold regardle
-000212d0: 7373 206f 6620 7072 6576 696f 7573 2077  ss of previous w
-000212e0: 6569 6768 740a 2020 2020 2020 2020 3a70  eight.        :p
-000212f0: 6172 616d 206f 7665 7277 7269 7465 5f73  aram overwrite_s
-00021300: 7479 6c65 3a20 6372 6561 7465 2066 6f6e  tyle: create fon
-00021310: 745f 7374 796c 653a 626f 6c64 2072 6567  t_style:bold reg
-00021320: 6172 646c 6573 7320 6f66 2070 7265 7669  ardless of previ
-00021330: 6f75 7320 7374 796c 650a 2020 2020 2020  ous style.      
-00021340: 2020 3a70 6172 616d 206f 7665 7277 7269    :param overwri
-00021350: 7465 5f66 616d 696c 793a 2065 6469 7420  te_family: edit 
-00021360: 666f 6e74 2d66 616d 696c 7920 746f 2072  font-family to r
-00021370: 656d 6f76 6520 7374 796c 652f 7765 6967  emove style/weig
-00021380: 6874 2069 6e66 6f20 2868 6163 6b79 290a  ht info (hacky).
-00021390: 2020 2020 2020 2020 3a70 6172 616d 2073          :param s
-000213a0: 7479 6c65 5f72 6567 6578 3d0a 0a20 2020  tyle_regex=..   
-000213b0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-000213c0: 2066 616d 696c 7920 3d20 7365 6c66 2e66   family = self.f
-000213d0: 6f6e 745f 6661 6d69 6c79 0a20 2020 2020  ont_family.     
-000213e0: 2020 2069 6620 6e6f 7420 6661 6d69 6c79     if not family
-000213f0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-00021400: 7475 726e 0a20 2020 2020 2020 2066 616d  turn.        fam
-00021410: 696c 795f 7374 796c 652c 2073 7479 6c65  ily_style, style
-00021420: 203d 2073 656c 662e 6d61 7463 685f 7765   = self.match_we
-00021430: 6967 6874 5f73 7479 6c65 2866 616d 696c  ight_style(famil
-00021440: 792c 2073 7479 6c65 5f72 6567 6578 2c20  y, style_regex, 
-00021450: 7661 6c75 653d 2249 222c 206d 6172 6b3d  value="I", mark=
-00021460: 2253 5322 290a 2020 2020 2020 2020 6661  "SS").        fa
-00021470: 6d69 6c79 5f77 6569 6768 742c 2077 6569  mily_weight, wei
-00021480: 6768 7420 3d20 7365 6c66 2e6d 6174 6368  ght = self.match
-00021490: 5f77 6569 6768 745f 7374 796c 6528 6661  _weight_style(fa
-000214a0: 6d69 6c79 2c20 7765 6967 6874 5f72 6567  mily, weight_reg
-000214b0: 6578 2c20 7661 6c75 653d 2242 222c 206d  ex, value="B", m
-000214c0: 6172 6b3d 2257 5722 290a 2020 2020 2020  ark="WW").      
-000214d0: 2020 2320 7072 696e 7428 6622 6661 6d69    # print(f"fami
-000214e0: 6c79 3a20 7b66 616d 696c 797d 3b20 7374  ly: {family}; st
-000214f0: 796c 653a 207b 7374 796c 657d 3b20 7765  yle: {style}; we
-00021500: 6967 6874 3a20 7b77 6569 6768 747d 3b22  ight: {weight};"
-00021510: 290a 2020 2020 2020 2020 6966 2066 616d  ).        if fam
-00021520: 696c 795f 7765 6967 6874 2061 6e64 206f  ily_weight and o
-00021530: 7665 7277 7269 7465 5f66 616d 696c 793a  verwrite_family:
-00021540: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00021550: 662e 7365 745f 6661 6d69 6c79 2866 616d  f.set_family(fam
-00021560: 696c 795f 7765 6967 6874 290a 2020 2020  ily_weight).    
-00021570: 2020 2020 6966 2077 6569 6768 7420 616e      if weight an
-00021580: 6420 6f76 6572 7772 6974 655f 626f 6c64  d overwrite_bold
-00021590: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
-000215a0: 6c66 2e73 6574 5f66 6f6e 745f 7765 6967  lf.set_font_weig
-000215b0: 6874 2877 6569 6768 7429 0a20 2020 2020  ht(weight).     
-000215c0: 2020 2069 6620 7374 796c 6520 616e 6420     if style and 
-000215d0: 6f76 6572 7772 6974 655f 7374 796c 653a  overwrite_style:
-000215e0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-000215f0: 662e 7365 745f 666f 6e74 5f73 7479 6c65  f.set_font_style
-00021600: 2873 7479 6c65 290a 2020 2020 2020 2020  (style).        
-00021610: 2320 6966 2073 7479 6c65 2061 6e64 206f  # if style and o
-00021620: 7665 7277 7269 7465 5f73 7472 6574 6368  verwrite_stretch
-00021630: 6564 3a0a 2020 2020 2020 2020 2320 2020  ed:.        #   
-00021640: 2020 7365 6c66 2e73 6574 5f66 6f6e 745f    self.set_font_
-00021650: 7374 7265 7463 6865 6428 7374 796c 6529  stretched(style)
-00021660: 0a20 2020 2020 2020 2023 2070 7269 6e74  .        # print
-00021670: 2866 226e 6577 2073 7479 6c65 207b 7365  (f"new style {se
-00021680: 6c66 7d22 290a 0a0a 2020 2020 2320 2020  lf}")...    #   
-00021690: 2063 6c61 7373 2043 5353 5374 796c 653a   class CSSStyle:
-000216a0: 0a0a 2020 2020 6465 6620 6d61 7463 685f  ..    def match_
-000216b0: 7765 6967 6874 5f73 7479 6c65 2873 656c  weight_style(sel
-000216c0: 662c 2066 616d 696c 792c 2077 6569 6768  f, family, weigh
-000216d0: 745f 7265 6765 782c 2076 616c 7565 3d4e  t_regex, value=N
-000216e0: 6f6e 652c 206d 6172 6b3d 4e6f 6e65 293a  one, mark=None):
-000216f0: 0a20 2020 2020 2020 2077 6569 6768 745f  .        weight_
-00021700: 7265 6320 3d20 7265 2e63 6f6d 7069 6c65  rec = re.compile
-00021710: 2877 6569 6768 745f 7265 6765 7829 2069  (weight_regex) i
-00021720: 6620 7765 6967 6874 5f72 6567 6578 2065  f weight_regex e
-00021730: 6c73 6520 4e6f 6e65 0a20 2020 2020 2020  lse None.       
-00021740: 206d 6174 6368 203d 2077 6569 6768 745f   match = weight_
-00021750: 7265 632e 7365 6172 6368 2866 616d 696c  rec.search(famil
-00021760: 7929 0a20 2020 2020 2020 2069 6620 6d61  y).        if ma
-00021770: 7463 683a 0a20 2020 2020 2020 2020 2020  tch:.           
-00021780: 2076 616c 7565 203d 2066 616d 696c 795b   value = family[
-00021790: 6d61 7463 682e 7374 6172 7428 293a 6d61  match.start():ma
-000217a0: 7463 682e 656e 6428 295d 0a20 2020 2020  tch.end()].     
-000217b0: 2020 2020 2020 2076 616c 7565 203d 2076         value = v
-000217c0: 616c 7565 2e72 6570 6c61 6365 2822 2d22  alue.replace("-"
-000217d0: 2c20 2222 292e 7265 706c 6163 6528 222e  , "").replace(".
-000217e0: 222c 2022 2229 0a20 2020 2020 2020 2020  ", "").         
-000217f0: 2020 2066 616d 696c 7920 3d20 6661 6d69     family = fami
-00021800: 6c79 5b3a 6d61 7463 682e 7374 6172 7428  ly[:match.start(
-00021810: 295d 202b 2066 616d 696c 795b 6d61 7463  )] + family[matc
-00021820: 682e 656e 6428 293a 5d0a 2020 2020 2020  h.end():].      
-00021830: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00021840: 2020 2020 7661 6c75 6520 3d20 4e6f 6e65      value = None
-00021850: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00021860: 6661 6d69 6c79 2c20 7661 6c75 650a 0a20  family, value.. 
-00021870: 2020 2023 2020 2020 636c 6173 7320 4353     #    class CS
-00021880: 5353 7479 6c65 3a0a 0a20 2020 2064 6566  SStyle:..    def
-00021890: 2063 7265 6174 655f 6262 6f78 2873 656c   create_bbox(sel
-000218a0: 6629 3a0a 2020 2020 2020 2020 2222 220a  f):.        """.
-000218b0: 2020 2020 2020 2020 6372 6561 7465 2062          create b
-000218c0: 6f75 6e64 696e 6720 626f 7820 6672 6f6d  ounding box from
-000218d0: 206c 6566 742c 2077 6964 7468 2c20 746f   left, width, to
-000218e0: 702c 2068 6569 6768 740a 2020 2020 2020  p, height.      
-000218f0: 2020 3a72 6574 7572 6e3a 204e 6f6e 6520    :return: None 
-00021900: 6966 2061 6e79 2061 7474 7269 6275 7465  if any attribute
-00021910: 7320 6d69 7373 696e 670a 2020 2020 2020  s missing.      
-00021920: 2020 2222 220a 2020 2020 2020 2020 6262    """.        bb
-00021930: 6f78 203d 204e 6f6e 650a 2020 2020 2020  ox = None.      
-00021940: 2020 6966 2073 656c 662e 746f 7020 6973    if self.top is
-00021950: 206e 6f74 204e 6f6e 6520 616e 6420 7365   not None and se
-00021960: 6c66 2e68 6569 6768 7420 6973 206e 6f74  lf.height is not
-00021970: 204e 6f6e 6520 616e 6420 7365 6c66 2e6c   None and self.l
-00021980: 6566 7420 6973 206e 6f74 204e 6f6e 6520  eft is not None 
-00021990: 616e 6420 7365 6c66 2e77 6964 7468 2069  and self.width i
-000219a0: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-000219b0: 2020 2020 2020 2020 6262 6f78 203d 2042          bbox = B
-000219c0: 426f 7828 7879 5f72 616e 6765 733d 5b5b  Box(xy_ranges=[[
-000219d0: 7365 6c66 2e6c 6566 742c 2073 656c 662e  self.left, self.
-000219e0: 6c65 6674 202b 2073 656c 662e 7769 6474  left + self.widt
-000219f0: 685d 2c20 5b73 656c 662e 746f 702c 2073  h], [self.top, s
-00021a00: 656c 662e 746f 7020 2b20 7365 6c66 2e68  elf.top + self.h
-00021a10: 6569 6768 745d 5d29 0a20 2020 2020 2020  eight]]).       
-00021a20: 2072 6574 7572 6e20 6262 6f78 0a0a 2020   return bbox..  
-00021a30: 2020 2320 2020 2063 6c61 7373 2043 5353    #    class CSS
-00021a40: 5374 796c 653a 0a0a 2020 2020 6465 6620  Style:..    def 
-00021a50: 6578 7472 6163 745f 7375 6273 7479 6c65  extract_substyle
-00021a60: 7328 7365 6c66 2c20 6373 735f 6e61 6d65  s(self, css_name
-00021a70: 7329 3a0a 2020 2020 2020 2020 2222 220a  s):.        """.
-00021a80: 2020 2020 2020 2020 4372 6561 7465 2032          Create 2
-00021a90: 206e 6577 2043 5353 5373 7479 6c65 7320   new CSSSstyles 
-00021aa0: 2c20 7468 6520 6669 7273 7420 7769 7468  , the first with
-00021ab0: 206e 616d 6573 2069 6e20 2273 7479 6c65   names in "style
-00021ac0: 7322 2061 6e64 2074 6865 2073 6563 6f6e  s" and the secon
-00021ad0: 6420 7468 6520 7265 7374 2e0a 2020 2020  d the rest..    
-00021ae0: 2020 2020 2020 2020 6966 204e 6f6e 652c          if None,
-00021af0: 2072 6574 7275 6e73 204e 6f6e 652c 4e6f   retruns None,No
-00021b00: 6e65 0a20 2020 2020 2020 203a 7061 7261  ne.        :para
-00021b10: 6d20 6373 735f 6e61 6d65 733a 206c 6973  m css_names: lis
-00021b20: 7420 6f66 2043 5353 206e 616d 6573 2028  t of CSS names (
-00021b30: 652e 672e 2022 666f 6e74 2d66 616d 696c  e.g. "font-famil
-00021b40: 7922 292e 2049 6620 6e61 206e 616d 6520  y"). If na name 
-00021b50: 6e6f 7420 666f 756e 642c 206e 6f20 6163  not found, no ac
-00021b60: 7469 6f6e 0a20 2020 2020 2020 203a 7265  tion.        :re
-00021b70: 7475 726e 2032 2d74 7570 6c65 206f 6620  turn 2-tuple of 
-00021b80: 3129 2043 5353 5374 796c 6520 6f62 6a65  1) CSSStyle obje
-00021b90: 6374 2077 6974 6820 6578 7472 6163 7465  ct with extracte
-00021ba0: 6420 6e61 6d65 7320 3229 2043 5353 5374  d names 2) CSSSt
-00021bb0: 796c 6520 6f66 2074 6865 2072 656d 6169  yle of the remai
-00021bc0: 6e64 6572 3b0a 2020 2020 2020 2020 2020  nder;.          
-00021bd0: 2020 6569 7468 6572 2f62 6f74 6820 6d61    either/both ma
-00021be0: 7920 6265 2065 6d70 7479 2043 5353 5374  y be empty CSSSt
-00021bf0: 796c 652e 0a20 2020 2020 2020 2022 2222  yle..        """
-00021c00: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-00021c10: 7365 6c66 2e6e 616d 655f 7661 6c75 655f  self.name_value_
-00021c20: 6469 6374 3a0a 2020 2020 2020 2020 2020  dict:.          
-00021c30: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
-00021c40: 6f72 2866 226e 616d 655f 7661 6c75 655f  or(f"name_value_
-00021c50: 6469 6374 2069 7320 4e6f 6e65 2229 0a20  dict is None"). 
-00021c60: 2020 2020 2020 2069 6620 6373 735f 6e61         if css_na
-00021c70: 6d65 7320 6973 204e 6f6e 653a 0a20 2020  mes is None:.   
-00021c80: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00021c90: 4e6f 6e65 2c20 4e6f 6e65 0a20 2020 2020  None, None.     
-00021ca0: 2020 2063 7373 5f72 6574 6169 6e65 6420     css_retained 
-00021cb0: 3d20 636f 7079 2e64 6565 7063 6f70 7928  = copy.deepcopy(
-00021cc0: 7365 6c66 290a 2020 2020 2020 2020 6373  self).        cs
-00021cd0: 735f 666f 756e 6420 3d20 4353 5353 7479  s_found = CSSSty
-00021ce0: 6c65 2829 0a0a 2020 2020 2020 2020 6b65  le()..        ke
-00021cf0: 7973 203d 2063 7373 5f72 6574 6169 6e65  ys = css_retaine
-00021d00: 642e 6e61 6d65 5f76 616c 7565 5f64 6963  d.name_value_dic
-00021d10: 742e 6b65 7973 2829 0a20 2020 2020 2020  t.keys().       
-00021d20: 2066 6f72 206e 616d 6520 696e 2063 7373   for name in css
-00021d30: 5f6e 616d 6573 3a0a 2020 2020 2020 2020  _names:.        
-00021d40: 2020 2020 6966 206e 616d 6520 696e 2063      if name in c
-00021d50: 7373 5f72 6574 6169 6e65 642e 6e61 6d65  ss_retained.name
-00021d60: 5f76 616c 7565 5f64 6963 743a 0a20 2020  _value_dict:.   
-00021d70: 2020 2020 2020 2020 2020 2020 2076 616c               val
-00021d80: 7565 203d 2063 7373 5f72 6574 6169 6e65  ue = css_retaine
-00021d90: 642e 6e61 6d65 5f76 616c 7565 5f64 6963  d.name_value_dic
-00021da0: 742e 706f 7028 6e61 6d65 290a 2020 2020  t.pop(name).    
-00021db0: 2020 2020 2020 2020 2020 2020 6966 2076              if v
-00021dc0: 616c 7565 3a20 2023 2074 7261 6e73 6665  alue:  # transfe
-00021dd0: 7220 6974 656d 206f 7665 720a 2020 2020  r item over.    
-00021de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021df0: 6373 735f 666f 756e 642e 6e61 6d65 5f76  css_found.name_v
-00021e00: 616c 7565 5f64 6963 745b 6e61 6d65 5d20  alue_dict[name] 
-00021e10: 3d20 7661 6c75 650a 2020 2020 2020 2020  = value.        
-00021e20: 7265 7475 726e 2028 6373 735f 666f 756e  return (css_foun
-00021e30: 642c 2063 7373 5f72 6574 6169 6e65 6429  d, css_retained)
-00021e40: 0a0a 2020 2020 2320 2020 2063 6c61 7373  ..    #    class
-00021e50: 2043 5353 5374 796c 653a 0a0a 2020 2020   CSSStyle:..    
-00021e60: 6465 6620 6372 6561 7465 5f68 746d 6c5f  def create_html_
-00021e70: 7374 796c 655f 656c 656d 656e 7428 7365  style_element(se
-00021e80: 6c66 2c20 6874 6d6c 5f63 6c61 7373 293a  lf, html_class):
-00021e90: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00021ea0: 2020 2020 2043 7265 6174 6573 2073 7472       Creates str
-00021eb0: 696e 6720 666f 7220 4854 4d4c 2073 7479  ing for HTML sty
-00021ec0: 6c65 0a20 2020 2020 2020 2022 2222 0a20  le.        """. 
-00021ed0: 2020 2020 2020 2044 4f54 203d 2022 2e22         DOT = "."
-00021ee0: 0a20 2020 2020 2020 2073 203d 2044 4f54  .        s = DOT
-00021ef0: 202b 2068 746d 6c5f 636c 6173 7320 2b20   + html_class + 
-00021f00: 2220 2220 2b20 7365 6c66 2e67 6574 5f63  " " + self.get_c
-00021f10: 7373 5f76 616c 7565 2877 7261 705f 7769  ss_value(wrap_wi
-00021f20: 7468 5f63 7572 6c79 3d54 7275 6529 0a20  th_curly=True). 
-00021f30: 2020 2020 2020 2065 6c65 6d20 3d20 4554         elem = ET
-00021f40: 2e45 6c65 6d65 6e74 2843 5353 5374 796c  .Element(CSSStyl
-00021f50: 652e 5354 594c 4529 0a20 2020 2020 2020  e.STYLE).       
-00021f60: 2065 6c65 6d2e 7465 7874 203d 2073 0a20   elem.text = s. 
-00021f70: 2020 2020 2020 2072 6574 7572 6e20 656c         return el
-00021f80: 656d 0a0a 2020 2020 2320 2020 2063 6c61  em..    #    cla
-00021f90: 7373 2043 5353 5374 796c 653a 0a0a 2020  ss CSSStyle:..  
-00021fa0: 2020 6465 6620 6578 7472 6163 745f 7465    def extract_te
-00021fb0: 7874 5f73 7479 6c65 7328 7365 6c66 293a  xt_styles(self):
-00021fc0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00021fd0: 2020 2020 2065 7874 7261 6374 2074 6578       extract tex
-00021fe0: 7420 636f 6d70 6f6e 656e 7473 2066 726f  t components fro
-00021ff0: 6d20 7374 796c 6520 2866 6f6e 742d 2a2c  m style (font-*,
-00022000: 2063 6f6c 6f72 2c20 6574 6329 2069 6e74   color, etc) int
-00022010: 6f20 6e65 7720 7374 796c 652c 2072 6574  o new style, ret
-00022020: 7572 6e69 6e67 2074 7570 6c65 206f 660a  urning tuple of.
-00022030: 2020 2020 2020 2020 6e65 7720 7374 796c          new styl
-00022040: 6520 616e 6420 7374 796c 6520 6672 6f6d  e and style from
-00022050: 2072 656d 6169 6e69 6e67 2063 6f6d 706f   remaining compo
-00022060: 6e65 6e74 730a 2020 2020 2020 2020 2222  nents.        ""
-00022070: 220a 2020 2020 2020 2020 2865 7874 7261  ".        (extra
-00022080: 6374 6564 5f73 7479 6c65 2c20 7265 7461  cted_style, reta
-00022090: 696e 6564 2920 3d20 666f 6e74 5f73 7479  ined) = font_sty
-000220a0: 6c65 2c20 7265 7374 5f73 7479 6c65 203d  le, rest_style =
-000220b0: 2073 656c 662e 6578 7472 6163 745f 7375   self.extract_su
-000220c0: 6273 7479 6c65 7328 0a20 2020 2020 2020  bstyles(.       
-000220d0: 2020 2020 2043 5353 5374 796c 652e 5445       CSSStyle.TE
-000220e0: 5854 5f53 5459 4c45 5f43 4f4d 504f 4e45  XT_STYLE_COMPONE
-000220f0: 4e54 530a 2020 2020 2020 2020 290a 2020  NTS.        ).  
-00022100: 2020 2020 2020 7265 7475 726e 2028 6578        return (ex
-00022110: 7472 6163 7465 645f 7374 796c 652c 2072  tracted_style, r
-00022120: 6574 6169 6e65 6429 0a0a 2020 2020 2320  etained)..    # 
-00022130: 2020 2063 6c61 7373 2043 5353 5374 796c     class CSSStyl
-00022140: 653a 0a0a 2020 2020 6465 6620 6578 7472  e:..    def extr
-00022150: 6163 745f 7465 7874 5f73 7479 6c65 735f  act_text_styles_
-00022160: 696e 746f 5f63 6c61 7373 2873 656c 662c  into_class(self,
-00022170: 2063 6c61 7373 5f6e 616d 652c 206f 6c64   class_name, old
-00022180: 5f63 6c61 7373 7374 723d 2222 293a 0a20  _classstr=""):. 
-00022190: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-000221a0: 2020 2065 7874 7261 6374 7320 7465 7874     extracts text
-000221b0: 2063 6c61 7373 206e 616d 652d 7661 6c75   class name-valu
-000221c0: 6520 696e 746f 206e 6577 2043 5353 5374  e into new CSSSt
-000221d0: 796c 652c 2061 6e64 2063 7265 6174 6573  yle, and creates
-000221e0: 2075 7064 6174 6564 2063 6c61 7373 5f73   updated class_s
-000221f0: 7472 696e 670a 2020 2020 2020 2020 4578  tring.        Ex
-00022200: 616d 706c 653a 0a20 2020 2020 2020 2020  ample:.         
-00022210: 2020 2065 6c65 6d65 6e74 2068 6173 2073     element has s
-00022220: 7479 6c65 2061 7474 7269 6275 7465 2077  tyle attribute w
-00022230: 6974 6820 7365 7665 7261 6c20 7465 7874  ith several text
-00022240: 2063 6f6d 706f 6e65 6e74 7320 2865 2e67   components (e.g
-00022250: 2e20 666f 6e74 2d77 6569 6768 742c 2066  . font-weight, f
-00022260: 6f6e 742d 7369 7a65 290a 2020 2020 2020  ont-size).      
-00022270: 2020 2020 2020 5468 6973 2063 7265 6174        This creat
-00022280: 6573 2061 206e 6577 203c 7374 796c 653e  es a new <style>
-00022290: 2045 6c65 6d65 6e74 2028 6578 7472 6163   Element (extrac
-000222a0: 7465 6429 2077 6974 6820 6a75 7374 2074  ted) with just t
-000222b0: 6865 7365 2063 6f6d 706f 6e65 6e74 730a  hese components.
-000222c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000222d0: 616e 6420 7075 7473 2074 6865 2075 6e65  and puts the une
-000222e0: 7874 7261 6374 6564 2073 7479 6c65 2063  xtracted style c
-000222f0: 6f6d 706f 6e65 656e 7473 2069 6e74 6f20  omponeents into 
-00022300: 6e65 7720 7374 796c 6520 7370 6163 652d  new style space-
-00022310: 7365 7061 7261 7465 6420 7374 7269 6e67  separated string
-00022320: 2028 7265 6d61 696e 6e65 6429 0a20 2020   (remainned).   
-00022330: 2020 2020 2020 2020 2049 7420 7573 6573           It uses
-00022340: 2074 6865 2063 6c61 7373 5f6e 616d 6520   the class_name 
-00022350: 746f 2075 7064 6174 6520 7468 6520 6f6c  to update the ol
-00022360: 645f 636c 6173 7373 7472 2073 7472 696e  d_classstr strin
-00022370: 670a 2020 2020 2020 2020 2020 2020 2020  g.              
-00022380: 2020 652e 672e 2063 6c61 7373 5f6e 616d    e.g. class_nam
-00022390: 653d 2273 3122 2061 6e64 206f 6c64 5f63  e="s1" and old_c
-000223a0: 6c61 7373 7374 723d 2266 6f6f 2062 6172  lassstr="foo bar
-000223b0: 2220 3d3e 2022 666f 6f20 6261 7220 7331  " => "foo bar s1
-000223c0: 220a 2020 2020 2020 2020 3a70 6172 616d  ".        :param
-000223d0: 2063 6c61 7373 5f6e 616d 653a 206e 616d   class_name: nam
-000223e0: 6520 6f69 6620 6e65 7720 636c 6173 7320  e oif new class 
-000223f0: 2861 7574 686f 7220 6d75 7374 2065 6e73  (author must ens
-00022400: 7572 6520 756e 6971 7565 6e65 7373 290a  ure uniqueness).
-00022410: 2020 2020 2020 2020 3a70 6172 616d 206f          :param o
-00022420: 6c64 5f63 6c61 7373 7374 723a 206f 6c64  ld_classstr: old
-00022430: 2063 6c61 7373 6e61 6d65 2028 6465 6661   classname (defa
-00022440: 756c 7473 2074 6f20 2222 290a 2020 2020  ults to "").    
-00022450: 2020 2020 3a72 6574 7572 6e3a 2033 2d74      :return: 3-t
-00022460: 7570 6c65 206f 6620 2865 7874 7261 6374  uple of (extract
-00022470: 6564 5f73 7479 6c65 5f65 6c65 6d65 6e74  ed_style_element
-00022480: 2c20 7265 7461 696e 6564 5f73 7479 6c65  , retained_style
-00022490: 5f73 7472 696e 672c 206e 6577 2063 6c61  _string, new cla
-000224a0: 7373 735f 7374 7269 6e67 290a 2020 2020  sss_string).    
-000224b0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-000224c0: 6578 7472 6163 7465 645f 7374 796c 652c  extracted_style,
-000224d0: 2072 6574 6169 6e65 645f 7374 796c 6520   retained_style 
-000224e0: 3d20 7365 6c66 2e65 7874 7261 6374 5f74  = self.extract_t
-000224f0: 6578 745f 7374 796c 6573 2829 0a0a 2020  ext_styles()..  
-00022500: 2020 2020 2020 6966 206e 6f74 2065 7874        if not ext
-00022510: 7261 6374 6564 5f73 7479 6c65 3a0a 2020  racted_style:.  
-00022520: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00022530: 5661 6c75 6545 7272 6f72 2822 6578 7472  ValueError("extr
-00022540: 6163 7465 6420 7374 796c 6520 6973 204e  acted style is N
-00022550: 6f6e 6522 290a 2020 2020 2020 2020 6578  one").        ex
-00022560: 7472 6163 7465 645f 7374 796c 6531 203d  tracted_style1 =
-00022570: 2043 5353 5374 796c 652e 6578 7472 6163   CSSStyle.extrac
-00022580: 745f 626f 6c64 5f69 7461 6c69 635f 6672  t_bold_italic_fr
-00022590: 6f6d 5f66 6f6e 745f 6661 6d69 6c79 5f66  om_font_family_f
-000225a0: 6f72 5f73 7479 6c65 2865 7874 7261 6374  or_style(extract
-000225b0: 6564 5f73 7479 6c65 2920 6966 2065 7874  ed_style) if ext
-000225c0: 7261 6374 6564 5f73 7479 6c65 2065 6c73  racted_style els
-000225d0: 6520 4e6f 6e65 0a20 2020 2020 2020 2065  e None.        e
-000225e0: 7874 7261 6374 6564 5f68 746d 6c5f 7374  xtracted_html_st
-000225f0: 796c 655f 656c 656d 656e 7420 3d20 6578  yle_element = ex
-00022600: 7472 6163 7465 645f 7374 796c 6531 2e63  tracted_style1.c
-00022610: 7265 6174 655f 6874 6d6c 5f73 7479 6c65  reate_html_style
-00022620: 5f65 6c65 6d65 6e74 2863 6c61 7373 5f6e  _element(class_n
-00022630: 616d 6529 2069 6620 6578 7472 6163 7465  ame) if extracte
-00022640: 645f 7374 796c 6531 2069 7320 6e6f 7420  d_style1 is not 
-00022650: 4e6f 6e65 2065 6c73 6520 4e6f 6e65 0a0a  None else None..
-00022660: 2020 2020 2020 2020 7265 7461 696e 6564          retained
-00022670: 5f73 7479 6c65 5f61 7474 7661 6c20 3d20  _style_attval = 
-00022680: 7265 7461 696e 6564 5f73 7479 6c65 2e67  retained_style.g
-00022690: 6574 5f63 7373 5f76 616c 7565 2829 2069  et_css_value() i
-000226a0: 6620 7265 7461 696e 6564 5f73 7479 6c65  f retained_style
-000226b0: 2065 6c73 6520 4e6f 6e65 0a20 2020 2020   else None.     
-000226c0: 2020 2068 746d 6c5f 636c 6173 735f 7661     html_class_va
-000226d0: 6c20 3d20 4353 5353 7479 6c65 2e63 7265  l = CSSStyle.cre
-000226e0: 6174 655f 6874 6d6c 5f63 6c61 7373 5f76  ate_html_class_v
-000226f0: 616c 2863 6c61 7373 5f6e 616d 652c 206f  al(class_name, o
-00022700: 6c64 5f63 6c61 7373 5f76 616c 3d6f 6c64  ld_class_val=old
-00022710: 5f63 6c61 7373 7374 7229 0a20 2020 2020  _classstr).     
-00022720: 2020 2072 6574 7572 6e20 6578 7472 6163     return extrac
-00022730: 7465 645f 6874 6d6c 5f73 7479 6c65 5f65  ted_html_style_e
-00022740: 6c65 6d65 6e74 2c20 7265 7461 696e 6564  lement, retained
-00022750: 5f73 7479 6c65 5f61 7474 7661 6c2c 2068  _style_attval, h
-00022760: 746d 6c5f 636c 6173 735f 7661 6c0a 0a20  tml_class_val.. 
-00022770: 2020 2023 2020 2020 636c 6173 7320 4353     #    class CS
-00022780: 5353 7479 6c65 3a0a 0a20 2020 2040 636c  SStyle:..    @cl
-00022790: 6173 736d 6574 686f 640a 2020 2020 6465  assmethod.    de
-000227a0: 6620 6372 6561 7465 5f68 746d 6c5f 636c  f create_html_cl
-000227b0: 6173 735f 7661 6c28 636c 732c 206e 6577  ass_val(cls, new
-000227c0: 5f63 6c61 7373 2c20 6f6c 645f 636c 6173  _class, old_clas
-000227d0: 735f 7661 6c3d 4e6f 6e65 293a 0a20 2020  s_val=None):.   
-000227e0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-000227f0: 2063 7265 6174 6573 206f 7220 6564 6974   creates or edit
-00022800: 7320 6120 636c 6173 7320 7374 7269 6e67  s a class string
-00022810: 2074 6f20 6163 6365 7074 2061 206e 6577   to accept a new
-00022820: 2076 616c 7565 0a20 2020 2020 2020 206e   value.        n
-00022830: 6f2d 6f70 2069 6620 6e65 775f 636c 6173  o-op if new_clas
-00022840: 7320 6973 2061 6c72 6561 6479 2069 6e20  s is already in 
-00022850: 6f6c 645f 636c 6173 735f 7661 6c0a 2020  old_class_val.  
-00022860: 2020 2020 2020 652e 672e 204e 6f6e 6520        e.g. None 
-00022870: 2b20 2266 6f6f 2220 3d3e 2022 666f 6f22  + "foo" => "foo"
-00022880: 0a20 2020 2020 2020 2022 666f 6f22 202b  .        "foo" +
-00022890: 2022 6261 7220 706c 7567 6822 203d 3e20   "bar plugh" => 
-000228a0: 2262 6172 2070 6c75 6768 2066 6f6f 220a  "bar plugh foo".
-000228b0: 2020 2020 2020 2020 2266 6f6f 2220 2b20          "foo" + 
-000228c0: 2262 6172 2066 6f6f 2070 6c75 6768 2220  "bar foo plugh" 
-000228d0: 3d3e 2022 6261 7220 666f 6f20 706c 7567  => "bar foo plug
-000228e0: 6822 0a20 2020 2020 2020 203a 7061 7261  h".        :para
-000228f0: 6d20 6e65 775f 636c 6173 733a 2063 6c61  m new_class: cla
-00022900: 7373 2074 6f20 6164 640a 2020 2020 2020  ss to add.      
-00022910: 2020 3a70 6172 616d 206f 6c64 5f63 6c61    :param old_cla
-00022920: 7373 5f76 616c 3a20 7370 6163 652d 7365  ss_val: space-se
-00022930: 7061 7261 7465 6420 6c69 7374 206f 6620  parated list of 
-00022940: 6578 6973 7469 6e67 2063 6c61 7373 6573  existing classes
-00022950: 0a20 2020 2020 2020 203a 7265 7475 726e  .        :return
-00022960: 3a20 6e65 7720 636c 6173 7320 7374 7269  : new class stri
-00022970: 6e67 0a20 2020 2020 2020 2022 2222 0a20  ng.        """. 
-00022980: 2020 2020 2020 206f 6c64 5f63 6c61 7373         old_class
-00022990: 6573 203d 205b 5d20 6966 206e 6f74 206f  es = [] if not o
-000229a0: 6c64 5f63 6c61 7373 5f76 616c 2065 6c73  ld_class_val els
-000229b0: 6520 6f6c 645f 636c 6173 735f 7661 6c2e  e old_class_val.
-000229c0: 7370 6c69 7428 290a 2020 2020 2020 2020  split().        
-000229d0: 6966 206e 6577 5f63 6c61 7373 206e 6f74  if new_class not
-000229e0: 2069 6e20 6f6c 645f 636c 6173 7365 733a   in old_classes:
-000229f0: 0a20 2020 2020 2020 2020 2020 206f 6c64  .            old
-00022a00: 5f63 6c61 7373 6573 2e61 7070 656e 6428  _classes.append(
-00022a10: 6e65 775f 636c 6173 7329 0a20 2020 2020  new_class).     
-00022a20: 2020 2072 6574 7572 6e20 5574 696c 2e63     return Util.c
-00022a30: 7265 6174 655f 7374 7269 6e67 5f73 6570  reate_string_sep
-00022a40: 6172 6174 6564 5f6c 6973 7428 6f6c 645f  arated_list(old_
-00022a50: 636c 6173 7365 7329 0a0a 2020 2020 2320  classes)..    # 
-00022a60: 2020 2063 6c61 7373 2043 5353 5374 796c     class CSSStyl
-00022a70: 653a 0a0a 2020 2020 4063 6c61 7373 6d65  e:..    @classme
-00022a80: 7468 6f64 0a20 2020 2064 6566 2063 7265  thod.    def cre
-00022a90: 6174 655f 7374 796c 655f 6469 6374 5f66  ate_style_dict_f
-00022aa0: 726f 6d5f 7374 796c 6573 2863 6c73 2c20  rom_styles(cls, 
-00022ab0: 7374 796c 655f 656c 656d 733d 4e6f 6e65  style_elems=None
-00022ac0: 2c20 7661 6c69 6461 7465 3d54 7275 6529  , validate=True)
-00022ad0: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-00022ae0: 2020 2020 2020 636f 6e76 6572 7420 6c69        convert li
-00022af0: 7374 206f 6620 4353 5353 7479 6c65 7320  st of CSSStyles 
-00022b00: 2861 7320 4854 4d4c 2073 7472 696e 6773  (as HTML strings
-00022b10: 2920 746f 2064 6963 740a 2020 2020 2020  ) to dict.      
-00022b20: 2020 6966 2064 7570 6c69 6361 7465 2073    if duplicate s
-00022b30: 7479 6c65 7265 6673 2072 6169 7365 2045  tylerefs raise E
-00022b40: 7863 6570 7469 6f6e 2069 6620 7661 6c69  xception if vali
-00022b50: 6461 7465 2065 6c73 6520 7461 6b65 2066  date else take f
-00022b60: 6972 7374 0a20 2020 2020 2020 2054 7970  irst.        Typ
-00022b70: 6963 616c 2073 7479 6c65 3a0a 2020 2020  ical style:.    
-00022b80: 2020 2020 3c73 7479 6c65 202e 2e2e 3e2e      <style ...>.
-00022b90: 7330 207b 666f 6e74 2d73 697a 653a 2031  s0 {font-size: 1
-00022ba0: 342e 7078 3b7d 3c2f 7374 796c 653e 0a20  4.px;}</style>. 
-00022bb0: 2020 2020 2020 203a 7061 7261 6d20 7374         :param st
-00022bc0: 796c 655f 656c 656d 733a 206c 6973 7420  yle_elems: list 
-00022bd0: 6f66 206c 786d 6c20 5f45 6c65 6d65 6e74  of lxml _Element
-00022be0: 730a 2020 2020 2020 2020 3a70 6172 616d  s.        :param
-00022bf0: 2076 616c 6964 6174 653a 2063 6865 636b   validate: check
-00022c00: 2077 6865 7468 6572 2043 5353 2076 616c   whether CSS val
-00022c10: 7565 2069 7320 636f 6e66 6f72 6d61 6e74  ue is conformant
-00022c20: 206f 7220 6475 706c 6963 6174 6520 7374   or duplicate st
-00022c30: 796c 655f 7265 6673 0a20 2020 2020 2020  yle_refs.       
-00022c40: 203a 7265 7475 726e 3a20 6469 6374 206f   :return: dict o
-00022c50: 6620 666f 726d 2072 6566 3a20 7374 796c  f form ref: styl
-00022c60: 650a 2020 2020 2020 2020 3a65 7863 6570  e.        :excep
-00022c70: 743a 2049 6620 656c 656d 656e 7420 6861  t: If element ha
-00022c80: 7320 7772 6f6e 6720 7379 6e74 6178 3b20  s wrong syntax; 
-00022c90: 6966 2063 7373 2066 6965 726c 6420 6973  if css fierld is
-00022ca0: 206d 616c 666f 746d 6564 3b20 6966 2072   malfotmed; if r
-00022cb0: 6566 2069 7320 6475 706c 6963 6174 6564  ef is duplicated
-00022cc0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00022cd0: 2020 2020 2063 7373 5f72 6520 3d20 7265       css_re = re
-00022ce0: 2e63 6f6d 7069 6c65 2822 5c5c 732a 285c  .compile("\\s*(\
-00022cf0: 5c2e 2e2a 295c 5c73 2b7b 282e 2a29 7d5c  \..*)\\s+{(.*)}\
-00022d00: 5c73 2a22 290a 2020 2020 2020 2020 6966  \s*").        if
-00022d10: 2073 7479 6c65 5f65 6c65 6d73 2069 7320   style_elems is 
-00022d20: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00022d30: 2020 7374 796c 6573 203d 205b 5d0a 2020    styles = [].  
-00022d40: 2020 2020 2020 7374 796c 655f 6469 6374        style_dict
-00022d50: 203d 2064 6963 7428 290a 2020 2020 2020   = dict().      
-00022d60: 2020 666f 7220 7374 796c 655f 656c 656d    for style_elem
-00022d70: 2069 6e20 7374 796c 655f 656c 656d 733a   in style_elems:
-00022d80: 0a20 2020 2020 2020 2020 2020 2073 7479  .            sty
-00022d90: 6c65 5f74 6578 7420 3d20 7374 796c 655f  le_text = style_
-00022da0: 656c 656d 2e74 6578 742e 7374 7269 7028  elem.text.strip(
-00022db0: 290a 2020 2020 2020 2020 2020 2020 6d61  ).            ma
-00022dc0: 7463 6820 3d20 6373 735f 7265 2e6d 6174  tch = css_re.mat
-00022dd0: 6368 2873 7479 6c65 5f74 6578 7429 0a20  ch(style_text). 
-00022de0: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-00022df0: 7420 6d61 7463 683a 0a20 2020 2020 2020  t match:.       
-00022e00: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
-00022e10: 616c 7565 4572 726f 7228 6622 4241 4420  alueError(f"BAD 
-00022e20: 6865 6164 5f73 7479 6c65 207b 7374 796c  head_style {styl
-00022e30: 655f 7465 7874 7d22 290a 2020 2020 2020  e_text}").      
-00022e40: 2020 2020 2020 7265 6620 3d20 6d61 7463        ref = matc
-00022e50: 682e 6772 6f75 7028 3129 0a20 2020 2020  h.group(1).     
-00022e60: 2020 2020 2020 2063 7373 5f73 7472 696e         css_strin
-00022e70: 6720 3d20 6d61 7463 682e 6772 6f75 7028  g = match.group(
-00022e80: 3229 0a20 2020 2020 2020 2020 2020 2069  2).            i
-00022e90: 6620 6373 735f 7374 7269 6e67 203d 3d20  f css_string == 
-00022ea0: 2222 3a0a 2020 2020 2020 2020 2020 2020  "":.            
-00022eb0: 2020 2020 2320 7468 6973 206f 6363 7572      # this occur
-00022ec0: 7320 7768 656e 2074 6865 2073 7479 6c65  s when the style
-00022ed0: 2061 7474 7269 6275 7465 7320 6172 6520   attributes are 
-00022ee0: 706f 7369 7469 6f6e 616c 0a20 2020 2020  positional.     
-00022ef0: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
-00022f00: 6e75 650a 2020 2020 2020 2020 2020 2020  nue.            
-00022f10: 6966 2076 616c 6964 6174 653a 0a20 2020  if validate:.   
-00022f20: 2020 2020 2020 2020 2020 2020 2063 7373               css
-00022f30: 5f73 7479 6c65 203d 2043 5353 5374 796c  _style = CSSStyl
-00022f40: 652e 6372 6561 7465 5f63 7373 5f73 7479  e.create_css_sty
-00022f50: 6c65 5f66 726f 6d5f 6373 735f 7374 7269  le_from_css_stri
-00022f60: 6e67 2863 7373 5f73 7472 696e 6729 0a20  ng(css_string). 
-00022f70: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00022f80: 6620 6373 735f 7374 796c 6520 6973 204e  f css_style is N
-00022f90: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00022fa0: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
-00022fb0: 616c 7565 4572 726f 7228 6622 6261 6420  alueError(f"bad 
-00022fc0: 4353 5353 7479 6c65 207b 6373 735f 7374  CSSStyle {css_st
-00022fd0: 796c 657d 2229 0a20 2020 2020 2020 2020  yle}").         
-00022fe0: 2020 2069 6620 7265 6620 696e 2073 7479     if ref in sty
-00022ff0: 6c65 5f64 6963 743a 0a20 2020 2020 2020  le_dict:.       
-00023000: 2020 2020 2020 2020 2069 6620 7661 6c69           if vali
-00023010: 6461 7465 3a0a 2020 2020 2020 2020 2020  date:.          
-00023020: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00023030: 5661 6c75 6545 7272 6f72 2866 2264 7570  ValueError(f"dup
-00023040: 6c69 6361 7465 2073 7479 6c65 2072 6566  licate style ref
-00023050: 207b 7374 796c 655f 7465 7874 7d22 290a   {style_text}").
-00023060: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00023070: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00023080: 2020 7374 796c 655f 6469 6374 5b72 6566    style_dict[ref
-00023090: 5d20 3d20 6373 735f 7374 7269 6e67 0a20  ] = css_string. 
-000230a0: 2020 2020 2020 2072 6574 7572 6e20 7374         return st
-000230b0: 796c 655f 6469 6374 0a0a 2020 2020 2320  yle_dict..    # 
-000230c0: 2020 2063 6c61 7373 2043 5353 5374 796c     class CSSStyl
-000230d0: 653a 0a0a 2020 2020 4063 6c61 7373 6d65  e:..    @classme
-000230e0: 7468 6f64 0a20 2020 2064 6566 2065 7874  thod.    def ext
-000230f0: 7261 6374 5f73 7479 6c65 735f 6672 6f6d  ract_styles_from
-00023100: 5f68 746d 6c5f 7374 7269 6e67 2863 6c73  _html_string(cls
-00023110: 2c20 6874 6d6c 5f73 7472 293a 0a20 2020  , html_str):.   
-00023120: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00023130: 2065 7874 7261 6374 2073 7479 6c65 7320   extract styles 
-00023140: 6672 6f6d 2068 6561 6420 6f66 2068 746d  from head of htm
-00023150: 6c20 6669 6c65 0a20 2020 2020 2020 203a  l file.        :
-00023160: 7061 7261 6d20 6874 6d6c 5f73 7472 3a20  param html_str: 
-00023170: 7374 7269 6e67 206f 6620 666f 726d 203c  string of form <
-00023180: 6874 6d6c 3e3c 6865 6164 3e3c 7374 796c  html><head><styl
-00023190: 6520 2e2e 2e3e 3c2f 7374 796c 653e 3c73  e ...></style><s
-000231a0: 7479 6c65 202e 2e2e 3e3c 2f73 7479 6c65  tyle ...></style
-000231b0: 3e3c 2f68 6561 643e 202e 2e2e 203c 2f68  ></head> ... </h
-000231c0: 746d 6c3e 0a20 2020 2020 2020 203a 7265  tml>.        :re
-000231d0: 7475 726e 3a20 6c69 7374 206f 6620 5f45  turn: list of _E
-000231e0: 6c65 6d65 6e74 7320 283c 7374 796c 652e  lements (<style.
-000231f0: 2e2e 3e20 2e2e 2e3c 2f73 7479 6c65 3e29  ..> ...</style>)
-00023200: 206f 7220 5b5d 0a20 2020 2020 2020 2022   or [].        "
-00023210: 2222 0a20 2020 2020 2020 2072 6574 7572  "".        retur
-00023220: 6e20 636c 732e 6578 7472 6163 745f 7374  n cls.extract_st
-00023230: 796c 6573 5f66 726f 6d5f 6874 6d6c 5f68  yles_from_html_h
-00023240: 6561 645f 656c 656d 656e 7428 4554 2e66  ead_element(ET.f
-00023250: 726f 6d73 7472 696e 6728 6874 6d6c 5f73  romstring(html_s
-00023260: 7472 2929 0a0a 2020 2020 2320 2020 2063  tr))..    #    c
-00023270: 6c61 7373 2043 5353 5374 796c 653a 0a0a  lass CSSStyle:..
-00023280: 2020 2020 4063 6c61 7373 6d65 7468 6f64      @classmethod
-00023290: 0a20 2020 2064 6566 2065 7874 7261 6374  .    def extract
-000232a0: 5f73 7479 6c65 735f 6672 6f6d 5f68 746d  _styles_from_htm
-000232b0: 6c5f 6865 6164 5f65 6c65 6d65 6e74 2863  l_head_element(c
-000232c0: 6c73 2c20 6874 6d6c 5f65 6c65 6d29 3a0a  ls, html_elem):.
-000232d0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-000232e0: 2020 2020 6578 7472 6163 7420 7374 796c      extract styl
-000232f0: 6573 2066 726f 6d20 6865 6164 206f 6620  es from head of 
-00023300: 6874 6d6c 2066 696c 650a 2020 2020 2020  html file.      
-00023310: 2020 3a70 6172 616d 2068 746d 6c5f 656c    :param html_el
-00023320: 656d 3a20 656c 656d 656e 7420 6f66 2066  em: element of f
-00023330: 6f72 6d20 3c68 746d 6c3e 3c68 6561 643e  orm <html><head>
-00023340: 3c73 7479 6c65 202e 2e2e 3e3c 2f73 7479  <style ...></sty
-00023350: 6c65 3e3c 7374 796c 6520 2e2e 2e3e 3c2f  le><style ...></
-00023360: 7374 796c 653e 3c2f 6865 6164 3e20 2e2e  style></head> ..
-00023370: 2e20 3c2f 6874 6d6c 3e0a 2020 2020 2020  . </html>.      
-00023380: 2020 3a72 6574 7572 6e3a 206c 6973 7420    :return: list 
-00023390: 6f66 205f 456c 656d 656e 7473 2028 3c73  of _Elements (<s
-000233a0: 7479 6c65 2e2e 2e3e 202e 2e2e 3c2f 7374  tyle...> ...</st
-000233b0: 796c 653e 2920 6f72 205b 5d0a 2020 2020  yle>) or [].    
-000233c0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-000233d0: 7265 7475 726e 205b 5d20 6966 2068 746d  return [] if htm
-000233e0: 6c5f 656c 656d 2069 7320 4e6f 6e65 2065  l_elem is None e
-000233f0: 6c73 6520 6874 6d6c 5f65 6c65 6d2e 7870  lse html_elem.xp
-00023400: 6174 6828 5354 594c 455f 5850 4154 4829  ath(STYLE_XPATH)
-00023410: 0a0a 2020 2020 4063 6c61 7373 6d65 7468  ..    @classmeth
-00023420: 6f64 0a20 2020 2064 6566 2063 7265 6174  od.    def creat
-00023430: 655f 6373 735f 7374 796c 655f 6672 6f6d  e_css_style_from
-00023440: 5f68 746d 6c5f 6865 6164 5f73 7479 6c65  _html_head_style
-00023450: 5f65 6c65 6d28 636c 732c 2073 7479 6c65  _elem(cls, style
-00023460: 5f65 6c65 6d29 3a0a 2020 2020 2020 2020  _elem):.        
-00023470: 2222 220a 2020 2020 2020 2020 6578 7472  """.        extr
-00023480: 6163 7473 2043 5353 5374 796c 6520 656c  acts CSSStyle el
-00023490: 656d 6e74 2066 726f 6d20 4854 4d4c 203c  emnt from HTML <
-000234a0: 7374 796c 653e 2e66 6f6f 207b 613a 623b  style>.foo {a:b;
-000234b0: 2063 3a64 3b7d 2065 6c65 6d65 6e74 0a20   c:d;} element. 
-000234c0: 2020 2020 2020 203a 7061 7261 6d20 7374         :param st
-000234d0: 796c 655f 656c 656d 3a0a 2020 2020 2020  yle_elem:.      
-000234e0: 2020 3a72 6574 7572 6e3a 2074 7570 6c65    :return: tuple
-000234f0: 2873 796d 626f 6c20 7265 662c 206e 6577  (symbol ref, new
-00023500: 2043 5353 5374 796c 6529 0a20 2020 2020   CSSStyle).     
-00023510: 2020 2022 2222 0a20 2020 2020 2020 2073     """.        s
-00023520: 7479 6c65 5f72 6520 3d20 7265 2e63 6f6d  tyle_re = re.com
-00023530: 7069 6c65 2822 5c5c 732a 285b 5e5c 5c73  pile("\\s*([^\\s
-00023540: 5d2a 295c 5c73 2b7b 282e 2a29 7d5c 5c73  ]*)\\s+{(.*)}\\s
-00023550: 2a22 290a 2020 2020 2020 2020 7379 6d62  *").        symb
-00023560: 6f6c 5f72 6566 203d 204e 6f6e 650a 2020  ol_ref = None.  
-00023570: 2020 2020 2020 6373 735f 7374 796c 655f        css_style_
-00023580: 6f62 6a20 3d20 4e6f 6e65 0a20 2020 2020  obj = None.     
-00023590: 2020 2069 6620 7479 7065 2873 7479 6c65     if type(style
-000235a0: 5f65 6c65 6d29 2069 7320 5f45 6c65 6d65  _elem) is _Eleme
-000235b0: 6e74 3a0a 2020 2020 2020 2020 2020 2020  nt:.            
-000235c0: 7465 7874 203d 2058 6d6c 4c69 622e 6765  text = XmlLib.ge
-000235d0: 745f 7465 7874 2873 7479 6c65 5f65 6c65  t_text(style_ele
-000235e0: 6d29 0a20 2020 2020 2020 2020 2020 206d  m).            m
-000235f0: 6174 6368 203d 2073 7479 6c65 5f72 652e  atch = style_re.
-00023600: 6d61 7463 6828 7465 7874 290a 2020 2020  match(text).    
-00023610: 2020 2020 2020 2020 6966 206d 6174 6368          if match
-00023620: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00023630: 2020 7379 6d62 6f6c 5f72 6566 203d 206d    symbol_ref = m
-00023640: 6174 6368 2e67 726f 7570 2831 290a 2020  atch.group(1).  
-00023650: 2020 2020 2020 2020 2020 2020 2020 6373                cs
-00023660: 735f 7374 796c 655f 6f62 6a20 3d20 4353  s_style_obj = CS
-00023670: 5353 7479 6c65 2e63 7265 6174 655f 6373  SStyle.create_cs
-00023680: 735f 7374 796c 655f 6672 6f6d 5f63 7373  s_style_from_css
-00023690: 5f73 7472 696e 6728 6d61 7463 682e 6772  _string(match.gr
-000236a0: 6f75 7028 3229 290a 2020 2020 2020 2020  oup(2)).        
-000236b0: 7265 7475 726e 2073 796d 626f 6c5f 7265  return symbol_re
-000236c0: 662c 2063 7373 5f73 7479 6c65 5f6f 626a  f, css_style_obj
-000236d0: 0a0a 2020 2020 4063 6c61 7373 6d65 7468  ..    @classmeth
-000236e0: 6f64 0a20 2020 2064 6566 2072 6570 6c61  od.    def repla
-000236f0: 6365 5f63 7373 5f73 7479 6c65 5f6e 616d  ce_css_style_nam
-00023700: 655f 7661 6c75 6573 5f77 6974 685f 6e6f  e_values_with_no
-00023710: 726d 616c 697a 6564 5f66 6f6e 7428 636c  rmalized_font(cl
-00023720: 732c 2073 7479 6c65 5f65 6c65 6d29 3a0a  s, style_elem):.
-00023730: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00023740: 2020 2020 6966 2073 7479 6c65 5f65 6c65      if style_ele
-00023750: 6d20 636f 6e74 6169 6e73 2061 2066 6f6e  m contains a fon
-00023760: 7420 696e 2074 6865 2043 5353 2076 616c  t in the CSS val
-00023770: 7565 732c 206e 6f72 6d61 6c69 7a65 7320  ues, normalizes 
-00023780: 6974 2069 6620 706f 7373 6962 6c65 0a20  it if possible. 
-00023790: 2020 2020 2020 2028 652e 672e 2066 6f6e         (e.g. fon
-000237a0: 742d 6661 6d69 6c79 3a20 4172 6961 6c42  t-family: ArialB
-000237b0: 6f6c 643b 203d 3e20 666f 6e74 2d66 616d  old; => font-fam
-000237c0: 696c 793a 4172 6961 6c3b 2066 6f6e 742d  ily:Arial; font-
-000237d0: 7765 6967 6874 3a20 626f 6c64 3b0a 2020  weight: bold;.  
-000237e0: 2020 2020 2020 6564 6974 7320 7468 6520        edits the 
-000237f0: 7374 796c 655f 656c 656d 0a20 2020 2020  style_elem.     
-00023800: 2020 203a 7061 7261 6d20 7374 796c 655f     :param style_
-00023810: 656c 656d 3a20 656c 656d 656e 7420 746f  elem: element to
-00023820: 2062 6520 6564 6974 6564 2028 4e4f 5420   be edited (NOT 
-00023830: 636f 7069 6564 290a 2020 2020 2020 2020  copied).        
-00023840: 2222 220a 2020 2020 2020 2020 7379 6d62  """.        symb
-00023850: 6f6c 5f72 6566 2c20 6e65 775f 6373 7373  ol_ref, new_csss
-00023860: 7479 6c65 203d 2041 6d69 466f 6e74 2e63  tyle = AmiFont.c
-00023870: 7265 6174 655f 666f 6e74 5f65 6469 7465  reate_font_edite
-00023880: 645f 7374 796c 655f 6672 6f6d 5f63 7373  d_style_from_css
-00023890: 5f73 7479 6c65 5f6f 626a 6563 7428 7374  _style_object(st
-000238a0: 796c 655f 656c 656d 290a 2020 2020 2020  yle_elem).      
-000238b0: 2020 6966 206e 6577 5f63 7373 7374 796c    if new_cssstyl
-000238c0: 6520 6973 206e 6f74 204e 6f6e 653a 0a20  e is not None:. 
-000238d0: 2020 2020 2020 2020 2020 2073 7479 6c65             style
-000238e0: 5f65 6c65 6d2e 7465 7874 203d 2066 227b  _elem.text = f"{
-000238f0: 7379 6d62 6f6c 5f72 6566 7d20 7b7b 7b6e  symbol_ref} {{{n
-00023900: 6577 5f63 7373 7374 796c 657d 7d7d 220a  ew_cssstyle}}}".
-00023910: 0a20 2020 2040 636c 6173 736d 6574 686f  .    @classmetho
-00023920: 640a 2020 2020 6465 6620 6e6f 726d 616c  d.    def normal
-00023930: 697a 655f 7374 796c 6573 5f69 6e5f 666f  ize_styles_in_fo
-00023940: 6e74 735f 696e 5f68 746d 6c5f 6865 6164  nts_in_html_head
-00023950: 2863 6c73 2c20 6874 6d6c 5f65 6c65 6d29  (cls, html_elem)
-00023960: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-00023970: 2020 2020 2020 6e6f 726d 616c 697a 6573        normalizes
-00023980: 2061 6c6c 2066 6f6e 7473 2074 6f20 6578   all fonts to ex
-00023990: 706f 7365 2066 6f6e 7420 7765 6967 6874  pose font weight
-000239a0: 7320 616e 6420 7374 796c 6573 0a20 2020  s and styles.   
-000239b0: 2020 2020 203a 7061 7261 6d20 6874 6d6c       :param html
-000239c0: 5f65 6c65 6d3a 2048 544d 4c20 2872 6f6f  _elem: HTML (roo
-000239d0: 7429 2065 6c65 6d65 6e74 2028 6874 6d6c  t) element (html
-000239e0: 2f68 6561 642f 7374 796c 652a 290a 2020  /head/style*).  
-000239f0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00023a00: 2020 7374 796c 655f 656c 656d 7320 3d20    style_elems = 
-00023a10: 4353 5353 7479 6c65 2e65 7874 7261 6374  CSSStyle.extract
-00023a20: 5f73 7479 6c65 735f 6672 6f6d 5f68 746d  _styles_from_htm
-00023a30: 6c5f 6865 6164 5f65 6c65 6d65 6e74 2868  l_head_element(h
-00023a40: 746d 6c5f 656c 656d 290a 2020 2020 2020  tml_elem).      
-00023a50: 2020 666f 7220 7374 796c 655f 656c 656d    for style_elem
-00023a60: 2069 6e20 7374 796c 655f 656c 656d 733a   in style_elems:
-00023a70: 0a20 2020 2020 2020 2020 2020 2043 5353  .            CSS
-00023a80: 5374 796c 652e 7265 706c 6163 655f 6373  Style.replace_cs
-00023a90: 735f 7374 796c 655f 6e61 6d65 5f76 616c  s_style_name_val
-00023aa0: 7565 735f 7769 7468 5f6e 6f72 6d61 6c69  ues_with_normali
-00023ab0: 7a65 645f 666f 6e74 2873 7479 6c65 5f65  zed_font(style_e
-00023ac0: 6c65 6d29 0a0a 2020 2020 4070 726f 7065  lem)..    @prope
-00023ad0: 7274 790a 2020 2020 6465 6620 7368 6f72  rty.    def shor
-00023ae0: 745f 7374 796c 6528 7365 6c66 293a 0a20  t_style(self):. 
-00023af0: 2020 2020 2020 2073 686f 7274 5f73 7479         short_sty
-00023b00: 6c65 203d 2073 656c 662e 666f 6e74 5f66  le = self.font_f
-00023b10: 616d 696c 792e 6c6f 7765 7228 295b 3a33  amily.lower()[:3
-00023b20: 5d0a 2020 2020 2020 2020 7368 6f72 745f  ].        short_
-00023b30: 7374 796c 6520 2b3d 2073 7472 2873 656c  style += str(sel
-00023b40: 662e 666f 6e74 5f73 697a 6529 2e72 6570  f.font_size).rep
-00023b50: 6c61 6365 2822 2e22 2c20 225f 2229 0a20  lace(".", "_"). 
-00023b60: 2020 2020 2020 2069 6620 7365 6c66 2e69         if self.i
-00023b70: 735f 626f 6c64 3a0a 2020 2020 2020 2020  s_bold:.        
-00023b80: 2020 2020 7368 6f72 745f 7374 796c 6520      short_style 
-00023b90: 2b3d 2022 6222 0a20 2020 2020 2020 2069  += "b".        i
-00023ba0: 6620 7365 6c66 2e69 735f 6974 616c 6963  f self.is_italic
-00023bb0: 3a0a 2020 2020 2020 2020 2020 2020 7368  :.            sh
-00023bc0: 6f72 745f 7374 796c 6520 2b3d 2022 6922  ort_style += "i"
-00023bd0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00023be0: 7368 6f72 745f 7374 796c 650a 0a20 2020  short_style..   
-00023bf0: 2064 6566 2067 6574 5f66 6f6e 745f 6174   def get_font_at
-00023c00: 7472 6962 7574 6573 2873 656c 6629 3a0a  tributes(self):.
-00023c10: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00023c20: 2020 2020 7365 7473 2034 2066 6f6e 7420      sets 4 font 
-00023c30: 6174 7472 6962 7574 6573 2028 7769 6474  attributes (widt
-00023c40: 682c 2073 697a 652c 206e 6f6e 7374 726f  h, size, nonstro
-00023c50: 6b65 2c20 7374 726f 6b65 2c20 666f 6e74  ke, stroke, font
-00023c60: 6e61 6d65 0a20 2020 2020 2020 2022 2222  name.        """
-00023c70: 0a0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
-00023c80: 662e 6e61 6d65 5f76 616c 7565 5f64 6963  f.name_value_dic
-00023c90: 7420 6973 204e 6f6e 653a 0a20 2020 2020  t is None:.     
-00023ca0: 2020 2020 2020 2072 6574 7572 6e20 284e         return (N
-00023cb0: 6f6e 652c 204e 6f6e 652c 204e 6f6e 652c  one, None, None,
-00023cc0: 204e 6f6e 652c 204e 6f6e 6529 0a20 2020   None, None).   
-00023cd0: 2020 2020 2072 6574 7572 6e20 280a 2020       return (.  
-00023ce0: 2020 2020 2020 2020 2020 2320 7365 6c66            # self
-00023cf0: 2e6e 616d 655f 7661 6c75 655f 6469 6374  .name_value_dict
-00023d00: 2e67 6574 2843 5353 5374 796c 652e 5749  .get(CSSStyle.WI
-00023d10: 4454 4829 2c0a 2020 2020 2020 2020 2020  DTH),.          
-00023d20: 2020 7365 6c66 2e67 6574 5f61 7474 7269    self.get_attri
-00023d30: 6275 7465 2843 5353 5374 796c 652e 464f  bute(CSSStyle.FO
-00023d40: 4e54 5f53 495a 4529 2c0a 2020 2020 2020  NT_SIZE),.      
-00023d50: 2020 2020 2020 7365 6c66 2e67 6574 5f61        self.get_a
-00023d60: 7474 7269 6275 7465 2843 5353 5374 796c  ttribute(CSSStyl
-00023d70: 652e 4649 4c4c 292c 0a20 2020 2020 2020  e.FILL),.       
-00023d80: 2020 2020 2073 656c 662e 6765 745f 6174       self.get_at
-00023d90: 7472 6962 7574 6528 4353 5353 7479 6c65  tribute(CSSStyle
-00023da0: 2e53 5452 4f4b 4529 2c0a 2020 2020 2020  .STROKE),.      
-00023db0: 2020 2020 2020 7365 6c66 2e67 6574 5f61        self.get_a
-00023dc0: 7474 7269 6275 7465 2843 5353 5374 796c  ttribute(CSSStyl
-00023dd0: 652e 464f 4e54 5f46 414d 494c 5929 0a20  e.FONT_FAMILY). 
-00023de0: 2020 2020 2020 2029 0a0a 2020 2020 4063         )..    @c
-00023df0: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
-00023e00: 6566 2067 6574 5f63 6f6f 7264 7328 636c  ef get_coords(cl
-00023e10: 732c 2065 6c65 6d29 3a0a 2020 2020 2020  s, elem):.      
-00023e20: 2020 2222 220a 2020 2020 2020 2020 3a72    """.        :r
-00023e30: 6574 7572 6e3a 2078 302c 2078 312c 2079  eturn: x0, x1, y
-00023e40: 302c 2079 310a 2020 2020 2020 2020 2222  0, y1.        ""
-00023e50: 220a 2020 2020 2020 2020 6373 7373 203d  ".        csss =
-00023e60: 2063 6c73 2e63 7265 6174 655f 6373 735f   cls.create_css_
-00023e70: 7374 796c 655f 6672 6f6d 5f61 7474 7269  style_from_attri
-00023e80: 6275 7465 5f6f 665f 626f 6479 5f65 6c65  bute_of_body_ele
-00023e90: 6d65 6e74 2865 6c65 6d29 0a20 2020 2020  ment(elem).     
-00023ea0: 2020 2078 3020 3d20 6373 7373 2e67 6574     x0 = csss.get
-00023eb0: 5f6e 756d 6572 6963 5f61 7474 7661 6c28  _numeric_attval(
-00023ec0: 2278 3022 290a 2020 2020 2020 2020 7831  "x0").        x1
-00023ed0: 203d 2063 7373 732e 6765 745f 6e75 6d65   = csss.get_nume
-00023ee0: 7269 635f 6174 7476 616c 2822 7831 2229  ric_attval("x1")
-00023ef0: 0a20 2020 2020 2020 2079 3020 3d20 6373  .        y0 = cs
-00023f00: 7373 2e67 6574 5f6e 756d 6572 6963 5f61  ss.get_numeric_a
-00023f10: 7474 7661 6c28 2279 3022 290a 2020 2020  ttval("y0").    
-00023f20: 2020 2020 7931 203d 2063 7373 732e 6765      y1 = csss.ge
-00023f30: 745f 6e75 6d65 7269 635f 6174 7476 616c  t_numeric_attval
-00023f40: 2822 7931 2229 0a20 2020 2020 2020 2072  ("y1").        r
-00023f50: 6574 7572 6e20 2878 302c 2079 302c 2078  eturn (x0, y0, x
-00023f60: 312c 2079 3129 0a0a 2020 2020 4063 6c61  1, y1)..    @cla
-00023f70: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
-00023f80: 2067 6574 5f78 3028 636c 732c 2065 6c65   get_x0(cls, ele
-00023f90: 6d29 3a0a 2020 2020 2020 2020 7265 7475  m):.        retu
-00023fa0: 726e 2063 6c73 2e67 6574 5f63 6f6f 7264  rn cls.get_coord
-00023fb0: 7328 656c 656d 295b 305d 0a0a 2020 2020  s(elem)[0]..    
-00023fc0: 4063 6c61 7373 6d65 7468 6f64 0a20 2020  @classmethod.   
-00023fd0: 2064 6566 2067 6574 5f79 3028 636c 732c   def get_y0(cls,
-00023fe0: 2065 6c65 6d29 3a0a 2020 2020 2020 2020   elem):.        
-00023ff0: 7265 7475 726e 2063 6c73 2e67 6574 5f63  return cls.get_c
-00024000: 6f6f 7264 7328 656c 656d 295b 315d 0a0a  oords(elem)[1]..
-00024010: 2020 2020 4063 6c61 7373 6d65 7468 6f64      @classmethod
-00024020: 0a20 2020 2064 6566 2067 6574 5f78 3128  .    def get_x1(
-00024030: 636c 732c 2065 6c65 6d29 3a0a 2020 2020  cls, elem):.    
-00024040: 2020 2020 7265 7475 726e 2063 6c73 2e67      return cls.g
-00024050: 6574 5f63 6f6f 7264 7328 656c 656d 295b  et_coords(elem)[
-00024060: 325d 0a0a 2020 2020 4063 6c61 7373 6d65  2]..    @classme
-00024070: 7468 6f64 0a20 2020 2064 6566 2067 6574  thod.    def get
-00024080: 5f79 3128 636c 732c 2065 6c65 6d29 3a0a  _y1(cls, elem):.
-00024090: 2020 2020 2020 2020 7265 7475 726e 2063          return c
-000240a0: 6c73 2e67 6574 5f63 6f6f 7264 7328 656c  ls.get_coords(el
-000240b0: 656d 295b 335d 0a0a 2020 2020 4063 6c61  em)[3]..    @cla
-000240c0: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
-000240d0: 2065 7874 7261 6374 5f63 6f6f 7264 735f   extract_coords_
-000240e0: 616e 645f 666f 6e74 5f70 726f 7065 7274  and_font_propert
-000240f0: 6965 7328 636c 732c 2073 7061 6e29 3a0a  ies(cls, span):.
-00024100: 2020 2020 2020 2020 6373 7373 203d 2043          csss = C
-00024110: 5353 5374 796c 652e 6372 6561 7465 5f63  SSStyle.create_c
-00024120: 7373 5f73 7479 6c65 5f66 726f 6d5f 6174  ss_style_from_at
-00024130: 7472 6962 7574 655f 6f66 5f62 6f64 795f  tribute_of_body_
-00024140: 656c 656d 656e 7428 7370 616e 290a 2020  element(span).  
-00024150: 2020 2020 2020 666f 6e74 5f73 697a 6520        font_size 
-00024160: 3d20 6373 7373 2e67 6574 5f6e 756d 6572  = csss.get_numer
-00024170: 6963 5f61 7474 7661 6c28 4353 5353 7479  ic_attval(CSSSty
-00024180: 6c65 2e46 4f4e 545f 5349 5a45 290a 2020  le.FONT_SIZE).  
-00024190: 2020 2020 2020 7930 203d 2063 7373 732e        y0 = csss.
-000241a0: 6765 745f 6e75 6d65 7269 635f 6174 7476  get_numeric_attv
-000241b0: 616c 2822 7930 2229 0a20 2020 2020 2020  al("y0").       
-000241c0: 2079 3120 3d20 6373 7373 2e67 6574 5f6e   y1 = csss.get_n
-000241d0: 756d 6572 6963 5f61 7474 7661 6c28 2279  umeric_attval("y
-000241e0: 3122 290a 2020 2020 2020 2020 7831 203d  1").        x1 =
-000241f0: 2063 7373 732e 6765 745f 6e75 6d65 7269   csss.get_numeri
-00024200: 635f 6174 7476 616c 2822 7831 2229 0a20  c_attval("x1"). 
-00024210: 2020 2020 2020 2072 6574 7572 6e20 666f         return fo
-00024220: 6e74 5f73 697a 652c 2079 302c 2079 310a  nt_size, y0, y1.
-00024230: 0a20 2020 2040 636c 6173 736d 6574 686f  .    @classmetho
-00024240: 640a 2020 2020 6465 6620 6578 7472 6163  d.    def extrac
-00024250: 745f 626f 6c64 5f69 7461 6c69 635f 6672  t_bold_italic_fr
-00024260: 6f6d 5f66 6f6e 745f 6661 6d69 6c79 5f66  om_font_family_f
-00024270: 6f72 5f73 7479 6c65 7328 636c 732c 2073  or_styles(cls, s
-00024280: 7479 6c65 7329 3a0a 2020 2020 2020 2020  tyles):.        
-00024290: 2222 220a 2020 2020 2020 2020 3a73 7479  """.        :sty
-000242a0: 6c65 733a 206c 6973 7420 6f66 2043 5353  les: list of CSS
-000242b0: 5374 796c 6520 6f62 6a65 6374 7320 746f  Style objects to
-000242c0: 206e 6f72 6d61 6c69 7a65 0a0a 2020 2020   normalize..    
-000242d0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-000242e0: 6578 7472 6163 7465 6420 3d20 5b5d 0a20  extracted = []. 
-000242f0: 2020 2020 2020 2066 6f72 2073 7479 6c65         for style
-00024300: 2069 6e20 7374 796c 6573 3a0a 2020 2020   in styles:.    
-00024310: 2020 2020 2020 2020 6966 2073 7479 6c65          if style
-00024320: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00024330: 2020 6578 7472 6163 7465 642e 6170 7065    extracted.appe
-00024340: 6e64 2863 6c73 2e65 7874 7261 6374 5f62  nd(cls.extract_b
-00024350: 6f6c 645f 6974 616c 6963 5f66 726f 6d5f  old_italic_from_
-00024360: 666f 6e74 5f66 616d 696c 795f 666f 725f  font_family_for_
-00024370: 7374 796c 6528 7374 796c 6529 290a 2020  style(style)).  
-00024380: 2020 2020 2020 7265 7475 726e 2065 7874        return ext
-00024390: 7261 6374 6564 0a0a 2020 2020 4063 6c61  racted..    @cla
-000243a0: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
-000243b0: 2065 7874 7261 6374 5f62 6f6c 645f 6974   extract_bold_it
-000243c0: 616c 6963 5f66 726f 6d5f 666f 6e74 5f66  alic_from_font_f
-000243d0: 616d 696c 795f 666f 725f 7374 796c 6528  amily_for_style(
-000243e0: 636c 732c 2073 7479 6c65 5f73 293a 0a20  cls, style_s):. 
-000243f0: 2020 2020 2020 2069 6620 6e6f 7420 7374         if not st
-00024400: 796c 655f 733a 0a20 2020 2020 2020 2020  yle_s:.         
-00024410: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
-00024420: 726f 7228 2273 7479 6c65 5f73 2069 7320  ror("style_s is 
-00024430: 4e6f 6e65 2229 0a20 2020 2020 2020 2063  None").        c
-00024440: 7373 5f73 7479 6c65 203d 2043 5353 5374  ss_style = CSSSt
-00024450: 796c 652e 6372 6561 7465 5f63 7373 5f73  yle.create_css_s
-00024460: 7479 6c65 5f66 726f 6d5f 6373 735f 7374  tyle_from_css_st
-00024470: 7269 6e67 2873 7472 2873 7479 6c65 5f73  ring(str(style_s
-00024480: 2929 0a20 2020 2020 2020 2069 6620 6373  )).        if cs
-00024490: 735f 7374 796c 653a 0a20 2020 2020 2020  s_style:.       
-000244a0: 2020 2020 2063 7373 5f73 7479 6c65 2e65       css_style.e
-000244b0: 7874 7261 6374 5f62 6f6c 645f 6974 616c  xtract_bold_ital
-000244c0: 6963 5f66 726f 6d5f 666f 6e74 5f66 616d  ic_from_font_fam
-000244d0: 696c 7928 0a20 2020 2020 2020 2020 2020  ily(.           
-000244e0: 2020 2020 206f 7665 7277 7269 7465 5f66       overwrite_f
-000244f0: 616d 696c 793d 5472 7565 2c20 6f76 6572  amily=True, over
-00024500: 7772 6974 655f 626f 6c64 3d54 7275 652c  write_bold=True,
-00024510: 206f 7665 7277 7269 7465 5f73 7479 6c65   overwrite_style
-00024520: 3d54 7275 6529 0a20 2020 2020 2020 2072  =True).        r
-00024530: 6574 7572 6e20 6373 735f 7374 796c 650a  eturn css_style.
-00024540: 0a0a 636c 6173 7320 4353 5343 6f6e 7665  ..class CSSConve
-00024550: 7274 6572 3a0a 2020 2020 2222 220a 2020  rter:.    """.  
-00024560: 2020 7475 726e 7320 4343 5320 7374 796c    turns CCS styl
-00024570: 6573 2069 6e74 6f20 6874 6d6c 2063 6c61  es into html cla
-00024580: 7373 6573 0a20 2020 2022 2222 0a0a 2020  sses.    """..  
-00024590: 2020 6465 6620 5f5f 696e 6974 5f5f 2873    def __init__(s
-000245a0: 656c 6629 3a0a 2020 2020 2020 2020 7061  elf):.        pa
-000245b0: 7373 0a0a 2020 2020 6465 6620 7265 6164  ss..    def read
-000245c0: 5f68 746d 6c5f 656c 656d 656e 7428 7365  _html_element(se
-000245d0: 6c66 2c20 6874 6d6c 5f65 6c65 6d29 3a0a  lf, html_elem):.
-000245e0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-000245f0: 2020 2020 7265 6164 7320 616e 6420 636f      reads and co
-00024600: 6e76 6572 7473 2068 746d 6c20 656c 656d  nverts html elem
-00024610: 656e 742e 0a20 2020 2020 2020 2061 6464  ent..        add
-00024620: 7320 3c68 746d 6c3e 2061 7320 726f 6f74  s <html> as root
-00024630: 2069 6620 6e6f 7420 7072 6573 656e 740a   if not present.
-00024640: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00024650: 2020 2020 7365 6c66 2e68 746d 6c5f 656c      self.html_el
-00024660: 656d 203d 2068 746d 6c5f 656c 656d 0a20  em = html_elem. 
-00024670: 2020 2020 2020 2073 656c 662e 6874 6d6c         self.html
-00024680: 5f65 6c65 6d20 3d20 4874 6d6c 5469 6479  _elem = HtmlTidy
-00024690: 2e65 6e73 7572 655f 6874 6d6c 5f68 6561  .ensure_html_hea
-000246a0: 645f 626f 6479 2873 656c 662e 6874 6d6c  d_body(self.html
-000246b0: 5f65 6c65 6d29 0a20 2020 2020 2020 2072  _elem).        r
-000246c0: 6574 7572 6e20 7365 6c66 2e68 746d 6c5f  eturn self.html_
-000246d0: 656c 656d 0a0a 636c 6173 7320 466f 6e74  elem..class Font
-000246e0: 5072 6f70 6572 7479 2845 6e75 6d29 3a0a  Property(Enum):.
-000246f0: 2020 2020 2222 220a 2020 2020 4172 6961      """.    Aria
-00024700: 6c4e 6172 726f 770a 2020 2020 4172 6961  lNarrow.    Aria
-00024710: 6c4e 6172 726f 772d 426f 6c64 0a20 2020  lNarrow-Bold.   
-00024720: 2043 616c 6962 7269 0a20 2020 2046 7275   Calibri.    Fru
-00024730: 7469 6765 724c 5450 726f 2d42 6c61 636b  tigerLTPro-Black
-00024740: 436e 0a20 2020 2046 7275 7469 6765 724c  Cn.    FrutigerL
-00024750: 5450 726f 2d42 6f6c 6443 6e0a 2020 2020  TPro-BoldCn.    
-00024760: 4672 7574 6967 6572 4c54 5072 6f2d 426f  FrutigerLTPro-Bo
-00024770: 6c64 436e 4974 610a 2020 2020 4672 7574  ldCnIta.    Frut
-00024780: 6967 6572 4c54 5072 6f2d 436f 6e64 656e  igerLTPro-Conden
-00024790: 7365 640a 2020 2020 4672 7574 6967 6572  sed.    Frutiger
-000247a0: 4c54 5072 6f2d 436f 6e64 656e 7365 6449  LTPro-CondensedI
-000247b0: 7461 0a20 2020 2046 7275 7469 6765 724c  ta.    FrutigerL
-000247c0: 5450 726f 2d4c 6967 6874 0a20 2020 2046  TPro-Light.    F
-000247d0: 7275 7469 6765 724c 5450 726f 2d4c 6967  rutigerLTPro-Lig
-000247e0: 6874 436e 0a20 2020 2046 7275 7469 6765  htCn.    Frutige
-000247f0: 724c 5450 726f 2d4c 6967 6874 436e 4974  rLTPro-LightCnIt
-00024800: 610a 2020 2020 4672 7574 6967 6572 4c54  a.    FrutigerLT
-00024810: 5072 6f2d 526f 6d61 6e0a 2020 2020 2222  Pro-Roman.    ""
-00024820: 220a 2020 2020 230a 2020 2020 4e4f 524d  ".    #.    NORM
-00024830: 414c 203d 2022 220a 0a20 2020 204e 4152  AL = ""..    NAR
-00024840: 524f 5720 3d20 226e 6172 726f 7722 0a20  ROW = "narrow". 
-00024850: 2020 2057 4944 4520 3d20 2277 6964 6522     WIDE = "wide"
-00024860: 0a0a 2020 2020 4c49 4748 5420 3d20 226c  ..    LIGHT = "l
-00024870: 6967 6874 220a 2020 2020 424f 4c44 203d  ight".    BOLD =
-00024880: 2022 626f 6c64 220a 0a20 2020 2049 5441   "bold"..    ITA
-00024890: 4c49 4320 3d20 2269 7461 6c69 6322 0a0a  LIC = "italic"..
-000248a0: 2020 2020 5341 4e53 203d 2022 7361 6e73      SANS = "sans
-000248b0: 220a 2020 2020 5345 5249 4620 3d20 2273  ".    SERIF = "s
-000248c0: 6572 6966 220a 2020 2020 5359 4d42 4f4c  erif".    SYMBOL
-000248d0: 203d 2022 7379 6d62 6f6c 220a 2020 2020   = "symbol".    
-000248e0: 4d4f 4e4f 5350 4143 4520 3d20 2273 6f6e  MONOSPACE = "son
-000248f0: 6f73 7061 6365 220a 0a20 2020 2064 6566  ospace"..    def
-00024900: 205f 5f73 7472 5f5f 2873 656c 6629 3a0a   __str__(self):.
-00024910: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-00024920: 7472 2873 656c 662e 7661 6c75 6529 0a0a  tr(self.value)..
-00024930: 2020 2020 6465 6620 5f5f 7265 7072 5f5f      def __repr__
-00024940: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-00024950: 7265 7475 726e 2073 7472 2873 656c 662e  return str(self.
-00024960: 7661 6c75 6529 0a0a 2320 7374 7269 7073  value)..# strips
-00024970: 2070 7265 6669 7820 6f66 6620 666f 6e74   prefix off font
-00024980: 2d6e 616d 6573 0a52 455f 5052 4546 203d  -names.RE_PREF =
-00024990: 2072 652e 636f 6d70 696c 6528 225b 412d   re.compile("[A-
-000249a0: 5a5d 7b36 7d5c 5c2b 283f 503c 6e61 6d65  Z]{6}\\+(?P<name
-000249b0: 3e5b 5e5c 5c73 5d2b 295c 5c73 2a22 290a  >[^\\s]+)\\s*").
-000249c0: 636c 6173 7320 416d 6946 6f6e 743a 0a20  class AmiFont:. 
-000249d0: 2020 2022 2222 0a20 2020 2065 6d70 6972     """.    empir
-000249e0: 6963 616c 206e 6f72 6d61 6c69 7a61 7469  ical normalizati
-000249f0: 6f6e 206f 6620 666f 6e74 732e 2054 7269  on of fonts. Tri
-00024a00: 6573 2074 6f20 636f 6e76 6572 7420 616c  es to convert al
-00024a10: 6c20 746f 2074 6865 0a20 2020 2062 6173  l to the.    bas
-00024a20: 650a 2020 2020 666f 6e74 2d66 616d 696c  e.    font-famil
-00024a30: 793a 2073 6572 6966 2f73 616e 732d 7365  y: serif/sans-se
-00024a40: 7269 662f 6d6f 6e6f 7370 6163 650a 2020  rif/monospace.  
-00024a50: 2020 666f 6e74 2d73 7472 6574 6368 3a20    font-stretch: 
-00024a60: 2863 6f6e 6465 6e73 6564 2f6e 6f72 6d61  (condensed/norma
-00024a70: 6c2f 6578 7061 6e64 6564 290a 2020 2020  l/expanded).    
-00024a80: 666f 726e 2d77 6569 6768 743a 206e 6f72  forn-weight: nor
-00024a90: 6d61 6c2f 626f 6c64 0a20 2020 2066 6f6e  mal/bold.    fon
-00024aa0: 742d 7374 796c 653a 206e 6f72 6d61 6c2f  t-style: normal/
-00024ab0: 6974 616c 6963 0a20 2020 2022 2222 0a0a  italic.    """..
-00024ac0: 0a20 2020 2023 2065 6d70 6972 6963 616c  .    # empirical
-00024ad0: 2063 6f6e 7665 7273 696f 6e73 3b20 7769   conversions; wi
-00024ae0: 6c6c 206e 6565 6420 746f 2062 6520 7570  ll need to be up
-00024af0: 6461 7465 6420 6672 6571 7565 6e74 6c79  dated frequently
-00024b00: 0a20 2020 2063 6f6e 7665 7273 696f 6e5f  .    conversion_
-00024b10: 6469 6374 203d 207b 0a20 2020 2020 2020  dict = {.       
-00024b20: 2022 4172 6961 6c22 3a20 466f 6e74 5072   "Arial": FontPr
-00024b30: 6f70 6572 7479 2e53 414e 532c 0a20 2020  operty.SANS,.   
-00024b40: 2020 2020 2022 4361 6c69 6272 6922 3a20       "Calibri": 
-00024b50: 466f 6e74 5072 6f70 6572 7479 2e53 414e  FontProperty.SAN
-00024b60: 532c 0a20 2020 2020 2020 2022 4672 7574  S,.        "Frut
-00024b70: 6967 6572 223a 2046 6f6e 7450 726f 7065  iger": FontPrope
-00024b80: 7274 792e 5341 4e53 2c0a 2020 2020 2020  rty.SANS,.      
-00024b90: 2020 2248 656c 7665 7469 6361 223a 2046    "Helvetica": F
-00024ba0: 6f6e 7450 726f 7065 7274 792e 5341 4e53  ontProperty.SANS
-00024bb0: 2c0a 0a20 2020 2020 2020 2022 5469 6d65  ,..        "Time
-00024bc0: 7322 3a20 466f 6e74 5072 6f70 6572 7479  s": FontProperty
-00024bd0: 2e53 4552 4946 2c0a 0a20 2020 2020 2020  .SERIF,..       
-00024be0: 2022 436f 7572 6965 7222 3a20 466f 6e74   "Courier": Font
-00024bf0: 5072 6f70 6572 7479 2e4d 4f4e 4f53 5041  Property.MONOSPA
-00024c00: 4345 2c0a 0a20 2020 2020 2020 2022 5379  CE,..        "Sy
-00024c10: 6d62 6f6c 223a 2046 6f6e 7450 726f 7065  mbol": FontPrope
-00024c20: 7274 792e 5359 4d42 4f4c 2c0a 2020 2020  rty.SYMBOL,.    
-00024c30: 7d0a 0a20 2020 2063 6f6e 645f 7265 6765  }..    cond_rege
-00024c40: 7820 3d20 7265 2e63 6f6d 7069 6c65 2822  x = re.compile("
-00024c50: 282e 2a29 2843 6f6e 6465 6e73 6564 7c43  (.*)(Condensed|C
-00024c60: 6e7c 4e61 7272 6f77 2928 2e2a 2922 290a  n|Narrow)(.*)").
-00024c70: 2020 2020 7769 6465 5f72 6567 6578 203d      wide_regex =
-00024c80: 2072 652e 636f 6d70 696c 6528 2228 2e2a   re.compile("(.*
-00024c90: 2928 5769 6465 2928 2e2a 2922 290a 0a20  )(Wide)(.*)").. 
-00024ca0: 2020 206c 6967 6874 5f72 6567 6578 203d     light_regex =
-00024cb0: 2072 652e 636f 6d70 696c 6528 2228 2e2a   re.compile("(.*
-00024cc0: 2928 4c69 6768 747c 5468 696e 2928 2e2a  )(Light|Thin)(.*
-00024cd0: 2922 290a 2020 2020 626f 6c64 5f72 6567  )").    bold_reg
-00024ce0: 6578 203d 2072 652e 636f 6d70 696c 6528  ex = re.compile(
-00024cf0: 2228 2e2a 2928 426f 6c64 7c48 6561 7679  "(.*)(Bold|Heavy
-00024d00: 7765 6967 6874 7c42 6c61 636b 2928 2e2a  weight|Black)(.*
-00024d10: 2922 290a 0a20 2020 2073 7479 6c65 5f72  )")..    style_r
-00024d20: 6567 6578 203d 2072 652e 636f 6d70 696c  egex = re.compil
-00024d30: 6528 2228 2e2a 2928 4974 616c 6963 7c49  e("(.*)(Italic|I
-00024d40: 7461 7c4f 626c 6971 7565 2928 2e2a 2922  ta|Oblique)(.*)"
-00024d50: 290a 0a23 2020 2020 636c 6173 7320 416d  )..#    class Am
-00024d60: 6946 6f6e 743a 0a0a 2020 2020 6465 6620  iFont:..    def 
-00024d70: 5f5f 696e 6974 5f5f 2873 656c 6629 3a0a  __init__(self):.
-00024d80: 2020 2020 2020 2020 7365 6c66 2e6e 616d          self.nam
-00024d90: 6520 3d20 4e6f 6e65 0a20 2020 2020 2020  e = None.       
-00024da0: 2073 656c 662e 6661 6d69 6c79 203d 204e   self.family = N
-00024db0: 6f6e 650a 2020 2020 2020 2020 7365 6c66  one.        self
-00024dc0: 2e77 6569 6768 7420 3d20 7374 7228 466f  .weight = str(Fo
-00024dd0: 6e74 5072 6f70 6572 7479 2e4e 4f52 4d41  ntProperty.NORMA
-00024de0: 4c29 0a20 2020 2020 2020 2073 656c 662e  L).        self.
-00024df0: 7374 796c 6520 3d20 7374 7228 466f 6e74  style = str(Font
-00024e00: 5072 6f70 6572 7479 2e4e 4f52 4d41 4c29  Property.NORMAL)
-00024e10: 0a20 2020 2020 2020 2073 656c 662e 7374  .        self.st
-00024e20: 7265 7463 6865 6420 3d20 7374 7228 466f  retched = str(Fo
-00024e30: 6e74 5072 6f70 6572 7479 2e4e 4f52 4d41  ntProperty.NORMA
-00024e40: 4c29 0a20 2020 2020 2020 2073 656c 662e  L).        self.
-00024e50: 666f 6e74 203d 2073 7472 2846 6f6e 7450  font = str(FontP
-00024e60: 726f 7065 7274 792e 5341 4e53 290a 0a20  roperty.SANS).. 
-00024e70: 2020 2023 2020 2020 636c 6173 7320 416d     #    class Am
-00024e80: 6946 6f6e 743a 0a0a 2020 2020 6465 6620  iFont:..    def 
-00024e90: 5f5f 7374 725f 5f28 7365 6c66 293a 0a20  __str__(self):. 
-00024ea0: 2020 2020 2020 2073 203d 2066 226e 616d         s = f"nam
-00024eb0: 653a 7b73 656c 662e 6e61 6d65 7d3b 6661  e:{self.name};fa
-00024ec0: 6d69 6c79 3a7b 7365 6c66 2e66 616d 696c  mily:{self.famil
-00024ed0: 797d 3b77 6569 6768 743a 7b73 656c 662e  y};weight:{self.
-00024ee0: 7765 6967 6874 7d3b 7374 796c 653a 7b73  weight};style:{s
-00024ef0: 656c 662e 7374 796c 657d 3b73 7472 6574  elf.style};stret
-00024f00: 6368 6564 3a7b 7365 6c66 2e73 7472 6574  ched:{self.stret
-00024f10: 6368 6564 7d3b 666f 6e74 3a7b 7365 6c66  ched};font:{self
-00024f20: 2e66 6f6e 747d 220a 2020 2020 2020 2020  .font}".        
-00024f30: 7265 7475 726e 2073 0a0a 2020 2020 4063  return s..    @c
-00024f40: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
-00024f50: 6566 2065 7874 7261 6374 5f6e 616d 655f  ef extract_name_
-00024f60: 7765 6967 6874 5f73 7479 6c65 5f73 7472  weight_style_str
-00024f70: 6574 6368 6564 5f61 735f 666f 6e74 2863  etched_as_font(c
-00024f80: 6c73 2c20 6e61 6d65 3029 3a0a 0a20 2020  ls, name0):..   
-00024f90: 2020 2020 2066 6f6e 7420 3d20 416d 6946       font = AmiF
-00024fa0: 6f6e 7428 290a 2020 2020 2020 2020 6e61  ont().        na
-00024fb0: 6d65 203d 2041 6d69 466f 6e74 2e74 7269  me = AmiFont.tri
-00024fc0: 6d5f 7064 665f 7072 6566 6978 286e 616d  m_pdf_prefix(nam
-00024fd0: 6530 290a 0a20 2020 2020 2020 2077 6869  e0)..        whi
-00024fe0: 6c65 2054 7275 653a 0a20 2020 2020 2020  le True:.       
-00024ff0: 2020 2020 206e 616d 652c 206d 6174 6368       name, match
-00025000: 203d 2063 6c73 2e65 7874 7261 6374 5f65   = cls.extract_e
-00025010: 6e75 6d65 7261 7465 645f 7374 796c 6573  numerated_styles
-00025020: 2866 6f6e 742c 206e 616d 6529 0a20 2020  (font, name).   
-00025030: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
-00025040: 6d61 7463 683a 0a20 2020 2020 2020 2020  match:.         
-00025050: 2020 2020 2020 2062 7265 616b 0a0a 2020         break..  
-00025060: 2020 2020 2020 6e61 6d65 203d 206e 616d        name = nam
-00025070: 652e 7265 706c 6163 6528 222d 222c 2222  e.replace("-",""
-00025080: 290a 0a20 2020 2020 2020 2066 6f6e 742e  )..        font.
-00025090: 6661 6d69 6c79 203d 206e 616d 650a 2020  family = name.  
-000250a0: 2020 2020 2020 666f 6e74 2e6e 616d 6520        font.name 
-000250b0: 3d20 6e61 6d65 300a 2020 2020 2020 2020  = name0.        
-000250c0: 7265 7475 726e 2066 6f6e 740a 0a20 2020  return font..   
-000250d0: 2040 636c 6173 736d 6574 686f 640a 2020   @classmethod.  
-000250e0: 2020 6465 6620 6578 7472 6163 745f 656e    def extract_en
-000250f0: 756d 6572 6174 6564 5f73 7479 6c65 7328  umerated_styles(
-00025100: 636c 732c 2066 6f6e 742c 206e 616d 6529  cls, font, name)
-00025110: 3a0a 0a20 2020 2020 2020 206e 616d 652c  :..        name,
-00025120: 206d 6174 6368 203d 2063 6c73 2e6d 6174   match = cls.mat
-00025130: 6368 5f66 6f6e 745f 7072 6f70 6572 7479  ch_font_property
-00025140: 286e 616d 652c 2041 6d69 466f 6e74 2e63  (name, AmiFont.c
-00025150: 6f6e 645f 7265 6765 7829 0a20 2020 2020  ond_regex).     
-00025160: 2020 2069 6620 6d61 7463 683a 0a20 2020     if match:.   
-00025170: 2020 2020 2020 2020 2066 6f6e 742e 7374           font.st
-00025180: 7265 7463 6865 6420 3d20 466f 6e74 5072  retched = FontPr
-00025190: 6f70 6572 7479 2e4e 4152 524f 570a 2020  operty.NARROW.  
-000251a0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-000251b0: 206e 616d 652c 206d 6174 6368 0a20 2020   name, match.   
-000251c0: 2020 2020 206e 616d 652c 206d 6174 6368       name, match
-000251d0: 203d 2063 6c73 2e6d 6174 6368 5f66 6f6e   = cls.match_fon
-000251e0: 745f 7072 6f70 6572 7479 286e 616d 652c  t_property(name,
-000251f0: 2041 6d69 466f 6e74 2e77 6964 655f 7265   AmiFont.wide_re
-00025200: 6765 7829 0a20 2020 2020 2020 2069 6620  gex).        if 
-00025210: 6d61 7463 683a 0a20 2020 2020 2020 2020  match:.         
-00025220: 2020 2066 6f6e 742e 7374 7265 7463 6865     font.stretche
-00025230: 6420 3d20 466f 6e74 5072 6f70 6572 7479  d = FontProperty
-00025240: 2e57 4944 450a 2020 2020 2020 2020 2020  .WIDE.          
-00025250: 2020 7265 7475 726e 206e 616d 652c 206d    return name, m
-00025260: 6174 6368 0a20 2020 2020 2020 206e 616d  atch.        nam
-00025270: 652c 206d 6174 6368 203d 2063 6c73 2e6d  e, match = cls.m
-00025280: 6174 6368 5f66 6f6e 745f 7072 6f70 6572  atch_font_proper
-00025290: 7479 286e 616d 652c 2041 6d69 466f 6e74  ty(name, AmiFont
-000252a0: 2e6c 6967 6874 5f72 6567 6578 290a 2020  .light_regex).  
-000252b0: 2020 2020 2020 6966 206d 6174 6368 3a0a        if match:.
-000252c0: 2020 2020 2020 2020 2020 2020 666f 6e74              font
-000252d0: 2e77 6569 6768 7420 3d20 466f 6e74 5072  .weight = FontPr
-000252e0: 6f70 6572 7479 2e4c 4947 4854 0a20 2020  operty.LIGHT.   
-000252f0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00025300: 6e61 6d65 2c20 6d61 7463 680a 2020 2020  name, match.    
-00025310: 2020 2020 6e61 6d65 2c20 6d61 7463 6820      name, match 
-00025320: 3d20 636c 732e 6d61 7463 685f 666f 6e74  = cls.match_font
-00025330: 5f70 726f 7065 7274 7928 6e61 6d65 2c20  _property(name, 
-00025340: 416d 6946 6f6e 742e 626f 6c64 5f72 6567  AmiFont.bold_reg
-00025350: 6578 290a 2020 2020 2020 2020 6966 206d  ex).        if m
-00025360: 6174 6368 3a0a 2020 2020 2020 2020 2020  atch:.          
-00025370: 2020 666f 6e74 2e77 6569 6768 7420 3d20    font.weight = 
-00025380: 466f 6e74 5072 6f70 6572 7479 2e42 4f4c  FontProperty.BOL
-00025390: 440a 2020 2020 2020 2020 2020 2020 7265  D.            re
-000253a0: 7475 726e 206e 616d 652c 206d 6174 6368  turn name, match
-000253b0: 0a0a 2020 2020 2020 2020 6e61 6d65 2c20  ..        name, 
-000253c0: 6d61 7463 6820 3d20 636c 732e 6d61 7463  match = cls.matc
-000253d0: 685f 666f 6e74 5f70 726f 7065 7274 7928  h_font_property(
-000253e0: 6e61 6d65 2c20 416d 6946 6f6e 742e 7374  name, AmiFont.st
-000253f0: 796c 655f 7265 6765 7829 0a20 2020 2020  yle_regex).     
-00025400: 2020 2069 6620 6d61 7463 683a 0a20 2020     if match:.   
-00025410: 2020 2020 2020 2020 2066 6f6e 742e 7374           font.st
-00025420: 796c 6520 3d20 466f 6e74 5072 6f70 6572  yle = FontProper
-00025430: 7479 2e49 5441 4c49 430a 2020 2020 2020  ty.ITALIC.      
-00025440: 2020 2020 2020 7265 7475 726e 206e 616d        return nam
-00025450: 652c 206d 6174 6368 0a0a 2020 2020 2020  e, match..      
-00025460: 2020 7265 7475 726e 206e 616d 652c 204e    return name, N
-00025470: 6f6e 650a 0a20 2020 2023 2020 2020 636c  one..    #    cl
-00025480: 6173 7320 416d 6946 6f6e 743a 0a0a 2020  ass AmiFont:..  
-00025490: 2020 2222 220a 2020 2020 426f 6c64 2046    """.    Bold F
-000254a0: 6f6e 7473 3a20 312e 2041 7269 616c 0a20  onts: 1. Arial. 
-000254b0: 2020 2043 616c 6962 7269 0a20 2020 2043     Calibri.    C
-000254c0: 656e 7475 7279 2047 6f74 6869 630a 2020  entury Gothic.  
-000254d0: 2020 2042 6f6c 6420 342e 200a 2020 2020     Bold 4. .    
-000254e0: 2046 7261 6e6b 6c69 6e20 476f 7468 6963   Franklin Gothic
-000254f0: 200a 2020 2020 2042 6f6c 6420 352e 200a   .     Bold 5. .
-00025500: 2020 2020 2046 7574 7572 6120 426f 6c64       Futura Bold
-00025510: 2036 2e20 0a20 2020 2020 4769 6c6c 2053   6. .     Gill S
-00025520: 616e 7320 426f 6c64 2037 2e20 0a20 2020  ans Bold 7. .   
-00025530: 2048 656c 7665 7469 6361 2042 6f6c 6420   Helvetica Bold 
-00025540: 382e 200a 2020 2020 496d 7061 6374 2042  8. .    Impact B
-00025550: 6f6c 6420 392e 0a20 2020 204c 7563 6964  old 9..    Lucid
-00025560: 6120 5361 6e73 2042 6f6c 6420 3130 2e20  a Sans Bold 10. 
-00025570: 0a20 2020 204d 7972 6961 6420 5072 6f20  .    Myriad Pro 
-00025580: 426f 6c64 2031 312e 204f 7065 6e20 5361  Bold 11. Open Sa
-00025590: 6e73 2042 6f6c 6420 3132 2e20 5061 6c61  ns Bold 12. Pala
-000255a0: 7469 6e6f 2042 6f6c 6420 3133 2e20 526f  tino Bold 13. Ro
-000255b0: 636b 7765 6c6c 2042 6f6c 6420 3134 2e20  ckwell Bold 14. 
-000255c0: 0a20 2020 2053 6567 6f65 2055 4920 426f  .    Segoe UI Bo
-000255d0: 6c64 2031 352e 2054 696d 6573 204e 6577  ld 15. Times New
-000255e0: 2052 6f6d 616e 2042 6f6c 6420 3136 2e20   Roman Bold 16. 
-000255f0: 556e 6976 6572 7320 426f 6c64 2031 372e  Univers Bold 17.
-00025600: 2056 6572 6461 6e61 2042 6f6c 6420 3138   Verdana Bold 18
-00025610: 2e20 4176 656e 6972 2042 6f6c 6420 3139  . Avenir Bold 19
-00025620: 2e20 4261 736b 6572 7669 6c6c 6520 426f  . Baskerville Bo
-00025630: 6c64 2032 302e 2043 6c61 7265 6e64 6f6e  ld 20. Clarendon
-00025640: 2042 6f6c 6420 3231 2e20 430a 2020 2020   Bold 21. C.    
-00025650: 6f70 7065 7270 6c61 7465 2042 6f6c 6420  opperplate Bold 
-00025660: 3232 2e20 4469 646f 7420 426f 6c64 2032  22. Didot Bold 2
-00025670: 332e 2045 7572 6f73 7469 6c65 2042 6f6c  3. Eurostile Bol
-00025680: 6420 3234 2e20 4672 7574 6967 6572 2042  d 24. Frutiger B
-00025690: 6f6c 6420 3235 2e20 4761 7261 6d6f 6e64  old 25. Garamond
-000256a0: 2042 6f6c 6420 3236 2e20 4765 6f72 6769   Bold 26. Georgi
-000256b0: 6120 426f 6c64 2032 372e 2047 6f74 6861  a Bold 27. Gotha
-000256c0: 6d20 426f 6c64 2032 382e 200a 2020 2020  m Bold 28. .    
-000256d0: 486f 6566 6c65 7220 5465 7874 2042 6f6c  Hoefler Text Bol
-000256e0: 6420 3239 2e20 4954 4320 4176 616e 7420  d 29. ITC Avant 
-000256f0: 4761 7264 6520 476f 7468 6963 2042 6f6c  Garde Gothic Bol
-00025700: 6420 3330 2e20 4954 4320 4672 616e 6b6c  d 30. ITC Frankl
-00025710: 696e 2047 6f74 6869 6320 426f 6c64 2033  in Gothic Bold 3
-00025720: 312e 2049 5443 204c 7562 616c 696e 2047  1. ITC Lubalin G
-00025730: 7261 7068 2042 6f6c 6420 3332 2e20 0a20  raph Bold 32. . 
-00025740: 2020 2049 5443 204f 6666 6963 696e 6120     ITC Officina 
-00025750: 5361 6e73 2042 6f6c 6420 3333 2e20 4954  Sans Bold 33. IT
-00025760: 4320 5374 6f6e 6520 5361 6e73 2042 6f6c  C Stone Sans Bol
-00025770: 6420 3334 2e20 4d69 6e69 6f6e 2050 726f  d 34. Minion Pro
-00025780: 2042 6f6c 6420 3335 2e20 4d75 7365 6f20   Bold 35. Museo 
-00025790: 5361 6e73 2042 6f6c 6420 3336 2e20 4e65  Sans Bold 36. Ne
-000257a0: 7574 7261 6661 6365 2042 6f6c 6420 3337  utraface Bold 37
-000257b0: 2e20 0a20 2020 204f 7074 696d 6120 426f  . .    Optima Bo
-000257c0: 6c64 2033 382e 2050 726f 7869 6d61 204e  ld 38. Proxima N
-000257d0: 6f76 6120 426f 6c64 2033 392e 2052 6f62  ova Bold 39. Rob
-000257e0: 6f74 6f20 426f 6c64 2034 302e 2053 6162  oto Bold 40. Sab
-000257f0: 6f6e 2042 6f6c 6420 3431 2e20 5472 6164  on Bold 41. Trad
-00025800: 6520 476f 7468 6963 2042 6f6c 6420 3432  e Gothic Bold 42
-00025810: 2e20 0a20 2020 2054 7265 6275 6368 6574  . .    Trebuchet
-00025820: 204d 5320 426f 6c64 2034 332e 200a 2020   MS Bold 43. .  
-00025830: 2020 5562 756e 7475 2042 6f6c 6420 3434    Ubuntu Bold 44
-00025840: 2e20 0a20 2020 2056 4147 2052 6f75 6e64  . .    VAG Round
-00025850: 6564 2042 6f6c 6420 3435 2e20 0a20 2020  ed Bold 45. .   
-00025860: 2057 6869 746e 6579 2042 6f6c 6420 3436   Whitney Bold 46
-00025870: 2e20 0a20 2020 2058 6974 7320 426f 6c64  . .    Xits Bold
-00025880: 2034 372e 200a 2020 2020 5961 6e6f 6e65   47. .    Yanone
-00025890: 204b 6166 6665 6573 6174 7a20 426f 6c64   Kaffeesatz Bold
-000258a0: 2034 382e 200a 2020 2020 5a69 6c6c 6120   48. .    Zilla 
-000258b0: 536c 6162 0a20 2020 205a 6f6e 610a 2020  Slab.    Zona.  
-000258c0: 2020 5a75 7269 6368 200a 2020 2020 2222    Zurich .    ""
-000258d0: 220a 0a20 2020 2023 2020 2020 636c 6173  "..    #    clas
-000258e0: 7320 416d 6946 6f6e 743a 0a0a 2020 2020  s AmiFont:..    
-000258f0: 4063 6c61 7373 6d65 7468 6f64 0a20 2020  @classmethod.   
-00025900: 2064 6566 206d 6174 6368 5f66 6f6e 745f   def match_font_
-00025910: 7072 6f70 6572 7479 2863 6c73 2c20 6e61  property(cls, na
-00025920: 6d65 2c20 7265 6765 7829 3a0a 2020 2020  me, regex):.    
-00025930: 2020 2020 6d61 7463 6820 3d20 7265 6765      match = rege
-00025940: 782e 6d61 7463 6828 6e61 6d65 290a 2020  x.match(name).  
-00025950: 2020 2020 2020 6966 206d 6174 6368 3a0a        if match:.
-00025960: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
-00025970: 203d 206d 6174 6368 2e67 726f 7570 2831   = match.group(1
-00025980: 2920 2b20 6d61 7463 682e 6772 6f75 7028  ) + match.group(
-00025990: 3329 2023 2063 686f 7020 6f75 7420 6d61  3) # chop out ma
-000259a0: 7463 680a 2020 2020 2020 2020 7265 7475  tch.        retu
-000259b0: 726e 206e 616d 652c 206d 6174 6368 0a0a  rn name, match..
-000259c0: 2020 2020 4063 6c61 7373 6d65 7468 6f64      @classmethod
-000259d0: 0a20 2020 2064 6566 2063 6f6e 7665 7274  .    def convert
-000259e0: 5f63 6f6d 6d6f 6e5f 666f 6e74 7328 636c  _common_fonts(cl
-000259f0: 7329 3a0a 2020 2020 2020 2020 7061 7373  s):.        pass
-00025a00: 0a0a 2020 2020 2320 2020 2063 6c61 7373  ..    #    class
-00025a10: 2041 6d69 466f 6e74 3a0a 0a20 2020 2040   AmiFont:..    @
-00025a20: 636c 6173 736d 6574 686f 640a 2020 2020  classmethod.    
-00025a30: 6465 6620 6372 6561 7465 5f66 6f6e 745f  def create_font_
-00025a40: 6564 6974 6564 5f73 7479 6c65 5f66 726f  edited_style_fro
-00025a50: 6d5f 6865 6164 5f73 7479 6c65 2863 6c73  m_head_style(cls
-00025a60: 2c20 7374 796c 655f 656c 656d 293a 0a20  , style_elem):. 
-00025a70: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00025a80: 2020 2065 6d70 6972 6963 616c 6c79 2063     empirically c
-00025a90: 7265 6174 6520 7374 616e 6461 7264 2066  reate standard f
-00025aa0: 6f6e 7473 2061 6e64 2061 7474 7269 6275  onts and attribu
-00025ab0: 7465 7320 6672 6f6d 2066 6f6e 7420 6e61  tes from font na
-00025ac0: 6d65 730a 2020 2020 2020 2020 3a70 6172  mes.        :par
-00025ad0: 616d 2063 7373 5f73 7479 6c65 3a20 4353  am css_style: CS
-00025ae0: 5353 7479 6c65 204f 626a 6563 7420 6f72  SStyle Object or
-00025af0: 2048 544d 4c20 6865 6164 2f73 7479 6c65   HTML head/style
-00025b00: 2077 6974 6820 756e 6b6e 6f77 6e20 666f   with unknown fo
-00025b10: 6e74 2d66 616d 696c 790a 2020 2020 2020  nt-family.      
-00025b20: 2020 3a72 6574 7572 6e3a 2074 7570 6c65    :return: tuple
-00025b30: 2028 7379 6d62 6f6c 5f72 6566 2c20 6e65   (symbol_ref, ne
-00025b40: 7720 6373 735f 7374 796c 6520 6f62 6a65  w css_style obje
-00025b50: 6374 2077 6974 6820 7374 616e 6461 7264  ct with standard
-00025b60: 2066 6f6e 7420 616e 6420 6d61 7962 6520   font and maybe 
-00025b70: 6e65 7720 7765 6967 6874 206f 7220 7374  new weight or st
-00025b80: 796c 6529 0a20 2020 2020 2020 2022 2222  yle).        """
-00025b90: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-00025ba0: 7479 7065 2873 7479 6c65 5f65 6c65 6d29  type(style_elem)
-00025bb0: 2069 7320 5f45 6c65 6d65 6e74 3a0a 2020   is _Element:.  
-00025bc0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00025bd0: 204e 6f6e 652c 204e 6f6e 650a 2020 2020   None, None.    
-00025be0: 2020 2020 7379 6d62 6f6c 5f72 6566 2c20      symbol_ref, 
-00025bf0: 6373 735f 7374 796c 6520 3d20 4353 5353  css_style = CSSS
-00025c00: 7479 6c65 2e63 7265 6174 655f 6373 735f  tyle.create_css_
-00025c10: 7374 796c 655f 6672 6f6d 5f68 746d 6c5f  style_from_html_
-00025c20: 6865 6164 5f73 7479 6c65 5f65 6c65 6d28  head_style_elem(
-00025c30: 7374 796c 655f 656c 656d 290a 2020 2020  style_elem).    
-00025c40: 2020 2020 6966 2063 7373 5f73 7479 6c65      if css_style
-00025c50: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
-00025c60: 2020 2020 2020 2020 2020 666f 6e74 5f66            font_f
-00025c70: 616d 696c 7920 3d20 6373 735f 7374 796c  amily = css_styl
-00025c80: 652e 666f 6e74 5f66 616d 696c 790a 2020  e.font_family.  
-00025c90: 2020 2020 2020 2020 2020 616d 695f 666f            ami_fo
-00025ca0: 6e74 203d 2041 6d69 466f 6e74 2e65 7874  nt = AmiFont.ext
-00025cb0: 7261 6374 5f6e 616d 655f 7765 6967 6874  ract_name_weight
-00025cc0: 5f73 7479 6c65 5f73 7472 6574 6368 6564  _style_stretched
-00025cd0: 5f61 735f 666f 6e74 2866 6f6e 745f 6661  _as_font(font_fa
-00025ce0: 6d69 6c79 290a 2020 2020 2020 2020 2020  mily).          
-00025cf0: 2020 6e65 775f 6373 735f 7374 796c 6520    new_css_style 
-00025d00: 3d20 4353 5353 7479 6c65 2829 0a20 2020  = CSSStyle().   
-00025d10: 2020 2020 2020 2020 2066 6f72 2069 7465           for ite
-00025d20: 6d20 696e 2063 7373 5f73 7479 6c65 2e6e  m in css_style.n
-00025d30: 616d 655f 7661 6c75 655f 6469 6374 3a0a  ame_value_dict:.
-00025d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025d50: 6e65 775f 6373 735f 7374 796c 652e 6e61  new_css_style.na
-00025d60: 6d65 5f76 616c 7565 5f64 6963 745b 6974  me_value_dict[it
-00025d70: 656d 5b30 5d5d 203d 2069 7465 6d5b 315d  em[0]] = item[1]
-00025d80: 0a20 2020 2020 2020 2020 2020 206e 6577  .            new
-00025d90: 5f63 7373 5f73 7479 6c65 2e73 6574 5f61  _css_style.set_a
-00025da0: 7474 7269 6275 7465 2846 4f4e 545f 4641  ttribute(FONT_FA
-00025db0: 4d49 4c59 2c20 616d 695f 666f 6e74 2e66  MILY, ami_font.f
-00025dc0: 616d 696c 7929 0a20 2020 2020 2020 2020  amily).         
-00025dd0: 2020 206e 6577 5f63 7373 5f73 7479 6c65     new_css_style
-00025de0: 2e73 6574 5f61 7474 7269 6275 7465 2846  .set_attribute(F
-00025df0: 4f4e 545f 5745 4947 4854 2c20 616d 695f  ONT_WEIGHT, ami_
-00025e00: 666f 6e74 2e77 6569 6768 7429 0a20 2020  font.weight).   
-00025e10: 2020 2020 2020 2020 206e 6577 5f63 7373           new_css
-00025e20: 5f73 7479 6c65 2e73 6574 5f61 7474 7269  _style.set_attri
-00025e30: 6275 7465 2846 4f4e 545f 5354 594c 452c  bute(FONT_STYLE,
-00025e40: 2061 6d69 5f66 6f6e 742e 7374 796c 6529   ami_font.style)
-00025e50: 0a20 2020 2020 2020 2020 2020 206e 6577  .            new
-00025e60: 5f63 7373 5f73 7479 6c65 2e73 6574 5f61  _css_style.set_a
-00025e70: 7474 7269 6275 7465 2846 4f4e 545f 5354  ttribute(FONT_ST
-00025e80: 5245 5443 4845 442c 2061 6d69 5f66 6f6e  RETCHED, ami_fon
-00025e90: 742e 7374 7265 7463 6865 6429 0a20 2020  t.stretched).   
-00025ea0: 2020 2020 2072 6574 7572 6e20 7379 6d62       return symb
-00025eb0: 6f6c 5f72 6566 2c20 6e65 775f 6373 735f  ol_ref, new_css_
-00025ec0: 7374 796c 650a 0a20 2020 2040 636c 6173  style..    @clas
-00025ed0: 736d 6574 686f 640a 2020 2020 6465 6620  smethod.    def 
-00025ee0: 6372 6561 7465 5f66 6f6e 745f 6564 6974  create_font_edit
-00025ef0: 6564 5f73 7479 6c65 5f66 726f 6d5f 6373  ed_style_from_cs
-00025f00: 735f 7374 796c 655f 6f62 6a65 6374 2863  s_style_object(c
-00025f10: 6c73 2c20 6373 735f 7374 796c 6529 3a0a  ls, css_style):.
-00025f20: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00025f30: 2020 2020 656d 7069 7269 6361 6c6c 7920      empirically 
-00025f40: 6372 6561 7465 2073 7461 6e64 6172 6420  create standard 
-00025f50: 666f 6e74 7320 616e 6420 6174 7472 6962  fonts and attrib
-00025f60: 7574 6573 2066 726f 6d20 666f 6e74 206e  utes from font n
-00025f70: 616d 6573 0a20 2020 2020 2020 203a 7061  ames.        :pa
-00025f80: 7261 6d20 6373 735f 7374 796c 653a 2043  ram css_style: C
-00025f90: 5353 5374 796c 6520 4f62 6a65 6374 206f  SSStyle Object o
-00025fa0: 7220 4854 4d4c 2068 6561 642f 7374 796c  r HTML head/styl
-00025fb0: 6520 7769 7468 2075 6e6b 6e6f 776e 2066  e with unknown f
-00025fc0: 6f6e 742d 6661 6d69 6c79 0a20 2020 2020  ont-family.     
-00025fd0: 2020 203a 7265 7475 726e 3a20 7475 706c     :return: tupl
-00025fe0: 6520 2873 796d 626f 6c5f 7265 662c 206e  e (symbol_ref, n
-00025ff0: 6577 2063 7373 5f73 7479 6c65 206f 626a  ew css_style obj
-00026000: 6563 7420 7769 7468 2073 7461 6e64 6172  ect with standar
-00026010: 6420 666f 6e74 2061 6e64 206d 6179 6265  d font and maybe
-00026020: 206e 6577 2077 6569 6768 7420 6f72 2073   new weight or s
-00026030: 7479 6c65 290a 2020 2020 2020 2020 2222  tyle).        ""
-00026040: 220a 0a20 2020 2020 2020 2069 6620 6373  "..        if cs
-00026050: 735f 7374 796c 6520 6973 204e 6f6e 653a  s_style is None:
-00026060: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00026070: 7572 6e20 4e6f 6e65 0a20 2020 2020 2020  urn None.       
-00026080: 2069 6620 7479 7065 2863 7373 5f73 7479   if type(css_sty
-00026090: 6c65 2920 6973 2045 542e 5f45 6c65 6d65  le) is ET._Eleme
-000260a0: 6e74 3a0a 2020 2020 2020 2020 2020 2020  nt:.            
-000260b0: 7072 696e 7420 2866 2265 6c65 6d65 6e74  print (f"element
-000260c0: 207b 4554 2e74 6f73 7472 696e 6728 6373   {ET.tostring(cs
-000260d0: 735f 7374 796c 6529 7d22 290a 2020 2020  s_style)}").    
-000260e0: 2020 2020 6966 2074 7970 6528 6373 735f      if type(css_
-000260f0: 7374 796c 6529 2069 7320 7374 723a 0a20  style) is str:. 
-00026100: 2020 2020 2020 2020 2020 2063 7373 5f73             css_s
-00026110: 7479 6c65 203d 2043 5353 5374 796c 652e  tyle = CSSStyle.
-00026120: 6372 6561 7465 5f63 7373 5f73 7479 6c65  create_css_style
-00026130: 5f66 726f 6d5f 6373 735f 7374 7269 6e67  _from_css_string
-00026140: 2863 7373 5f73 7479 6c65 290a 2020 2020  (css_style).    
-00026150: 2020 2020 6966 2063 7373 5f73 7479 6c65      if css_style
-00026160: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-00026170: 2020 2020 2020 7265 7475 726e 204e 6f6e        return Non
-00026180: 650a 2020 2020 2020 2020 6173 7365 7274  e.        assert
-00026190: 2074 7970 6528 6373 735f 7374 796c 6529   type(css_style)
-000261a0: 2069 7320 4353 5353 7479 6c65 2c20 6622   is CSSStyle, f"
-000261b0: 666f 756e 6420 7b74 7970 6528 6373 735f  found {type(css_
-000261c0: 7374 796c 6529 7d22 0a20 2020 2020 2020  style)}".       
-000261d0: 2069 6620 6e6f 7420 6373 735f 7374 796c   if not css_styl
-000261e0: 652e 666f 6e74 5f66 616d 696c 793a 0a20  e.font_family:. 
-000261f0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00026200: 6e20 6373 735f 7374 796c 650a 2020 2020  n css_style.    
-00026210: 2020 2020 616d 695f 666f 6e74 203d 2041      ami_font = A
-00026220: 6d69 466f 6e74 2e65 7874 7261 6374 5f6e  miFont.extract_n
-00026230: 616d 655f 7765 6967 6874 5f73 7479 6c65  ame_weight_style
-00026240: 5f73 7472 6574 6368 6564 5f61 735f 666f  _stretched_as_fo
-00026250: 6e74 2863 7373 5f73 7479 6c65 2e66 6f6e  nt(css_style.fon
-00026260: 745f 6661 6d69 6c79 290a 2020 2020 2020  t_family).      
-00026270: 2020 6e65 775f 6373 735f 7374 796c 6520    new_css_style 
-00026280: 3d20 4353 5353 7479 6c65 2829 0a20 2020  = CSSStyle().   
-00026290: 2020 2020 2066 6f72 2069 7465 6d20 696e       for item in
-000262a0: 2063 7373 5f73 7479 6c65 2e6e 616d 655f   css_style.name_
-000262b0: 7661 6c75 655f 6469 6374 2e69 7465 6d73  value_dict.items
-000262c0: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
-000262d0: 6e65 775f 6373 735f 7374 796c 652e 6e61  new_css_style.na
-000262e0: 6d65 5f76 616c 7565 5f64 6963 745b 6974  me_value_dict[it
-000262f0: 656d 5b30 5d5d 203d 2069 7465 6d5b 315d  em[0]] = item[1]
-00026300: 0a20 2020 2020 2020 206e 6577 5f63 7373  .        new_css
-00026310: 5f73 7479 6c65 2e73 6574 5f61 7474 7269  _style.set_attri
-00026320: 6275 7465 2846 4f4e 545f 4e41 4d45 2c20  bute(FONT_NAME, 
-00026330: 7374 7228 616d 695f 666f 6e74 2e6e 616d  str(ami_font.nam
-00026340: 6529 290a 2020 2020 2020 2020 6e65 775f  e)).        new_
-00026350: 6373 735f 7374 796c 652e 7365 745f 6174  css_style.set_at
-00026360: 7472 6962 7574 6528 464f 4e54 5f46 4f4e  tribute(FONT_FON
-00026370: 542c 2073 7472 2861 6d69 5f66 6f6e 742e  T, str(ami_font.
-00026380: 666f 6e74 2929 0a20 2020 2020 2020 206e  font)).        n
-00026390: 6577 5f63 7373 5f73 7479 6c65 2e73 6574  ew_css_style.set
-000263a0: 5f61 7474 7269 6275 7465 2846 4f4e 545f  _attribute(FONT_
-000263b0: 4641 4d49 4c59 2c20 7374 7228 616d 695f  FAMILY, str(ami_
-000263c0: 666f 6e74 2e66 616d 696c 7929 290a 2020  font.family)).  
-000263d0: 2020 2020 2020 6e65 775f 6373 735f 7374        new_css_st
-000263e0: 796c 652e 7365 745f 6174 7472 6962 7574  yle.set_attribut
-000263f0: 6528 464f 4e54 5f57 4549 4748 542c 2073  e(FONT_WEIGHT, s
-00026400: 7472 2861 6d69 5f66 6f6e 742e 7765 6967  tr(ami_font.weig
-00026410: 6874 292e 6c6f 7765 7228 2929 0a20 2020  ht).lower()).   
-00026420: 2020 2020 206e 6577 5f63 7373 5f73 7479       new_css_sty
-00026430: 6c65 2e73 6574 5f61 7474 7269 6275 7465  le.set_attribute
-00026440: 2846 4f4e 545f 5354 594c 452c 2073 7472  (FONT_STYLE, str
-00026450: 2861 6d69 5f66 6f6e 742e 7374 796c 6529  (ami_font.style)
-00026460: 2e6c 6f77 6572 2829 290a 2020 2020 2020  .lower()).      
-00026470: 2020 6e65 775f 6373 735f 7374 796c 652e    new_css_style.
-00026480: 7365 745f 6174 7472 6962 7574 6528 464f  set_attribute(FO
-00026490: 4e54 5f53 5452 4554 4348 4544 2c20 7374  NT_STRETCHED, st
-000264a0: 7228 616d 695f 666f 6e74 2e73 7472 6574  r(ami_font.stret
-000264b0: 6368 6564 292e 6c6f 7765 7228 2929 0a20  ched).lower()). 
-000264c0: 2020 2020 2020 2072 6574 7572 6e20 6e65         return ne
-000264d0: 775f 6373 735f 7374 796c 650a 0a20 2020  w_css_style..   
-000264e0: 2023 2020 2020 636c 6173 7320 416d 6946   #    class AmiF
-000264f0: 6f6e 743a 0a0a 2020 2020 4070 726f 7065  ont:..    @prope
-00026500: 7274 790a 2020 2020 6465 6620 6973 5f62  rty.    def is_b
-00026510: 6f6c 6428 7365 6c66 293a 0a20 2020 2020  old(self):.     
-00026520: 2020 2072 6574 7572 6e20 7374 7228 466f     return str(Fo
-00026530: 6e74 5072 6f70 6572 7479 2e42 4f4c 4429  ntProperty.BOLD)
-00026540: 203d 3d20 7365 6c66 2e77 6569 6768 740a   == self.weight.
-00026550: 0a20 2020 2040 7072 6f70 6572 7479 0a20  .    @property. 
-00026560: 2020 2064 6566 2069 735f 6974 616c 6963     def is_italic
-00026570: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-00026580: 7265 7475 726e 2073 7472 2846 6f6e 7450  return str(FontP
-00026590: 726f 7065 7274 792e 4954 414c 4943 2920  roperty.ITALIC) 
-000265a0: 3d3d 2073 656c 662e 7374 796c 650a 0a20  == self.style.. 
-000265b0: 2020 2040 636c 6173 736d 6574 686f 640a     @classmethod.
-000265c0: 2020 2020 6465 6620 7472 696d 5f70 6466      def trim_pdf
-000265d0: 5f70 7265 6669 7828 636c 732c 206e 616d  _prefix(cls, nam
-000265e0: 6529 3a0a 2020 2020 2020 2020 2222 2272  e):.        """r
-000265f0: 656d 6f76 6573 2074 6865 2041 4243 4445  emoves the ABCDE
-00026600: 462b 2070 7265 6669 7820 6672 6f6d 2066  F+ prefix from f
-00026610: 6f6e 742d 6e61 6d65 0a20 2020 2020 2020  ont-name.       
-00026620: 2054 6869 7320 7072 6566 6978 2073 6572   This prefix ser
-00026630: 7665 7320 6e6f 2075 7365 6675 6c20 7075  ves no useful pu
-00026640: 7270 6f73 6520 666f 7220 7465 7874 2061  rpose for text a
-00026650: 6e61 6c79 7369 7320 616e 6420 6973 2064  nalysis and is d
-00026660: 6973 6361 7264 6564 2222 220a 2020 2020  iscarded""".    
-00026670: 2020 2020 6966 206e 616d 653a 0a20 2020      if name:.   
-00026680: 2020 2020 2020 2020 206d 6174 6368 203d           match =
-00026690: 2052 455f 5052 4546 2e6d 6174 6368 286e   RE_PREF.match(n
-000266a0: 616d 6529 0a20 2020 2020 2020 2020 2020  ame).           
-000266b0: 2069 6620 6d61 7463 683a 0a20 2020 2020   if match:.     
-000266c0: 2020 2020 2020 2020 2020 206e 616d 6520             name 
-000266d0: 3d20 6d61 7463 682e 6772 6f75 7028 226e  = match.group("n
-000266e0: 616d 6522 290a 2020 2020 2020 2020 7265  ame").        re
-000266f0: 7475 726e 206e 616d 650a 0a0a 636c 6173  turn name...clas
-00026700: 7320 5365 6374 696f 6e48 6965 7261 7263  s SectionHierarc
-00026710: 6879 3a0a 2020 2020 2222 220a 2020 2020  hy:.    """.    
-00026720: 6275 696c 6473 2061 6e64 2071 7565 7269  builds and queri
-00026730: 6573 2068 6965 7261 7263 6869 6361 6c20  es hierarchical 
-00026740: 7365 6374 696f 6e73 0a20 2020 2022 2222  sections.    """
-00026750: 0a0a 2020 2020 4944 203d 2022 6964 220a  ..    ID = "id".
-00026760: 2020 2020 434c 4153 5320 3d20 2763 6c61      CLASS = 'cla
-00026770: 7373 270a 2020 2020 444f 5420 3d20 222e  ss'.    DOT = ".
-00026780: 220a 2020 2020 4d49 5353 494e 4720 3d20  ".    MISSING = 
-00026790: 226d 6973 7369 6e67 220a 2020 2020 5345  "missing".    SE
-000267a0: 4354 203d 2022 7365 6374 220a 0a20 2020  CT = "sect"..   
-000267b0: 2064 6566 205f 5f69 6e69 745f 5f28 7365   def __init__(se
-000267c0: 6c66 293a 0a20 2020 2020 2020 2070 6173  lf):.        pas
-000267d0: 730a 0a20 2020 2064 6566 2061 6464 5f73  s..    def add_s
-000267e0: 6563 7469 6f6e 7328 7365 6c66 2c20 6465  ections(self, de
-000267f0: 6369 6d61 6c5f 7365 6374 696f 6e73 2c20  cimal_sections, 
-00026800: 746f 703d 4e6f 6e65 2c20 706f 706c 6973  top=None, poplis
-00026810: 743d 4e6f 6e65 293a 0a20 2020 2020 2020  t=None):.       
-00026820: 2069 6620 6e6f 7420 706f 706c 6973 743a   if not poplist:
-00026830: 0a20 2020 2020 2020 2020 2020 2070 6f70  .            pop
-00026840: 6c69 7374 203d 205b 5d0a 2020 2020 2020  list = [].      
-00026850: 2020 7365 6374 696f 6e73 5f62 795f 6c65    sections_by_le
-00026860: 7665 6c20 3d20 7365 6c66 2e63 7265 6174  vel = self.creat
-00026870: 655f 7365 6374 696f 6e73 5f62 795f 6c65  e_sections_by_le
-00026880: 7665 6c28 6465 6369 6d61 6c5f 7365 6374  vel(decimal_sect
-00026890: 696f 6e73 290a 2020 2020 2020 2020 7061  ions).        pa
-000268a0: 7265 6e74 5f64 6963 7420 3d20 7365 6c66  rent_dict = self
-000268b0: 2e63 7265 6174 655f 7061 7265 6e74 5f64  .create_parent_d
-000268c0: 6963 7428 7365 6374 696f 6e73 5f62 795f  ict(sections_by_
-000268d0: 6c65 7665 6c29 0a20 2020 2020 2020 2066  level).        f
-000268e0: 6f72 2070 6f70 2069 6e20 706f 706c 6973  or pop in poplis
-000268f0: 743a 0a20 2020 2020 2020 2020 2020 2074  t:.            t
-00026900: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
-00026910: 2020 2020 7061 7265 6e74 5f64 6963 742e      parent_dict.
-00026920: 706f 7028 706f 7029 2020 2320 7265 6d6f  pop(pop)  # remo
-00026930: 7665 206e 6f6e 2d6e 756d 6572 6963 2069  ve non-numeric i
-00026940: 7465 6d0a 2020 2020 2020 2020 2020 2020  tem.            
-00026950: 6578 6365 7074 3a0a 2020 2020 2020 2020  except:.        
-00026960: 2020 2020 2020 2020 7072 696e 7428 2243          print("C
-00026970: 616e 6e6f 7420 706f 7020 7b70 6f70 7d22  annot pop {pop}"
-00026980: 290a 0a20 2020 2020 2020 2072 6f6f 7420  )..        root 
-00026990: 3d20 456c 656d 656e 7428 7365 6c66 2e53  = Element(self.S
-000269a0: 4543 5429 0a20 2020 2020 2020 2072 6f6f  ECT).        roo
-000269b0: 742e 6174 7472 6962 5b73 656c 662e 4944  t.attrib[self.ID
-000269c0: 5d20 3d20 2234 220a 2020 2020 2020 2020  ] = "4".        
-000269d0: 666f 7220 7365 6374 5f69 6420 696e 2070  for sect_id in p
-000269e0: 6172 656e 745f 6469 6374 2e6b 6579 7328  arent_dict.keys(
-000269f0: 293a 0a20 2020 2020 2020 2020 2020 2073  ):.            s
-00026a00: 656c 662e 656e 7375 7265 5f65 6c65 6d65  elf.ensure_eleme
-00026a10: 6e74 2872 6f6f 742c 2073 6563 745f 6964  nt(root, sect_id
-00026a20: 2c20 7061 7265 6e74 5f64 6963 7429 0a0a  , parent_dict)..
-00026a30: 2020 2020 6465 6620 6372 6561 7465 5f70      def create_p
-00026a40: 6172 656e 745f 6469 6374 2873 656c 662c  arent_dict(self,
-00026a50: 2073 6563 7469 6f6e 735f 6279 5f6c 6576   sections_by_lev
-00026a60: 656c 293a 0a20 2020 2020 2020 2070 6172  el):.        par
-00026a70: 656e 745f 6469 6374 203d 2064 6963 7428  ent_dict = dict(
-00026a80: 290a 2020 2020 2020 2020 666f 7220 6c65  ).        for le
-00026a90: 7665 6c20 696e 2073 6563 7469 6f6e 735f  vel in sections_
-00026aa0: 6279 5f6c 6576 656c 2e6b 6579 7328 293a  by_level.keys():
-00026ab0: 0a20 2020 2020 2020 2020 2020 2073 6563  .            sec
-00026ac0: 745f 6964 7320 3d20 7365 6c66 2e61 6464  t_ids = self.add
-00026ad0: 5f70 6172 656e 7473 286c 6576 656c 2c20  _parents(level, 
-00026ae0: 7365 6374 696f 6e73 5f62 795f 6c65 7665  sections_by_leve
-00026af0: 6c2c 2070 6172 656e 745f 6469 6374 290a  l, parent_dict).
-00026b00: 2020 2020 2020 2020 7265 7475 726e 2070          return p
-00026b10: 6172 656e 745f 6469 6374 0a0a 2020 2020  arent_dict..    
-00026b20: 6465 6620 6372 6561 7465 5f73 6563 7469  def create_secti
-00026b30: 6f6e 735f 6279 5f6c 6576 656c 2873 656c  ons_by_level(sel
-00026b40: 662c 2064 6563 696d 616c 5f73 6563 7469  f, decimal_secti
-00026b50: 6f6e 7329 3a0a 2020 2020 2020 2020 7365  ons):.        se
-00026b60: 6374 696f 6e73 5f62 795f 6c65 7665 6c20  ctions_by_level 
-00026b70: 3d20 6465 6661 756c 7464 6963 7428 6c69  = defaultdict(li
-00026b80: 7374 290a 2020 2020 2020 2020 666f 7220  st).        for 
-00026b90: 7365 6374 696f 6e20 696e 2064 6563 696d  section in decim
-00026ba0: 616c 5f73 6563 7469 6f6e 733a 0a20 2020  al_sections:.   
-00026bb0: 2020 2020 2020 2020 206c 6576 656c 203d           level =
-00026bc0: 2073 6563 7469 6f6e 2e61 7474 7269 622e   section.attrib.
-00026bd0: 6765 7428 7365 6c66 2e43 4c41 5353 292e  get(self.CLASS).
-00026be0: 7370 6c69 7428 295b 315d 0a20 2020 2020  split()[1].     
-00026bf0: 2020 2020 2020 2073 6563 7469 6f6e 735f         sections_
-00026c00: 6279 5f6c 6576 656c 5b6c 6576 656c 5d2e  by_level[level].
-00026c10: 6170 7065 6e64 2873 6563 7469 6f6e 2e74  append(section.t
-00026c20: 6578 7429 0a20 2020 2020 2020 2072 6574  ext).        ret
-00026c30: 7572 6e20 7365 6374 696f 6e73 5f62 795f  urn sections_by_
-00026c40: 6c65 7665 6c0a 0a20 2020 2064 6566 2061  level..    def a
-00026c50: 6464 5f70 6172 656e 7473 2873 656c 662c  dd_parents(self,
-00026c60: 206c 6576 656c 2c20 6d75 6c74 6964 6963   level, multidic
-00026c70: 742c 2070 6172 656e 745f 6469 6374 293a  t, parent_dict):
-00026c80: 0a20 2020 2020 2020 206c 6576 656c 5f73  .        level_s
-00026c90: 6563 7473 203d 206d 756c 7469 6469 6374  ects = multidict
-00026ca0: 5b6c 6576 656c 5d0a 2020 2020 2020 2020  [level].        
-00026cb0: 666f 7220 6c65 7665 6c5f 7365 6374 2069  for level_sect i
-00026cc0: 6e20 6c65 7665 6c5f 7365 6374 733a 0a20  n level_sects:. 
-00026cd0: 2020 2020 2020 2020 2020 2070 6172 656e             paren
-00026ce0: 7420 3d20 7365 6c66 2e67 6574 5f70 6172  t = self.get_par
-00026cf0: 656e 7428 6c65 7665 6c5f 7365 6374 290a  ent(level_sect).
-00026d00: 2020 2020 2020 2020 2020 2020 7061 7265              pare
-00026d10: 6e74 5f64 6963 745b 6c65 7665 6c5f 7365  nt_dict[level_se
-00026d20: 6374 5d20 3d20 7061 7265 6e74 0a0a 2020  ct] = parent..  
-00026d30: 2020 6465 6620 6765 745f 7061 7265 6e74    def get_parent
-00026d40: 2873 656c 662c 206c 6576 656c 5f73 6563  (self, level_sec
-00026d50: 7429 3a0a 2020 2020 2020 2020 6269 7473  t):.        bits
-00026d60: 203d 206c 6576 656c 5f73 6563 742e 7370   = level_sect.sp
-00026d70: 6c69 7428 222e 2229 0a20 2020 2020 2020  lit(".").       
-00026d80: 2070 6172 656e 7420 3d20 4e6f 6e65 2069   parent = None i
-00026d90: 6620 6c65 6e28 6269 7473 2920 3d3d 2031  f len(bits) == 1
-00026da0: 2065 6c73 6520 7365 6c66 2e44 4f54 2e6a   else self.DOT.j
-00026db0: 6f69 6e28 6269 7473 5b3a 2d31 5d29 0a20  oin(bits[:-1]). 
-00026dc0: 2020 2020 2020 2072 6574 7572 6e20 7061         return pa
-00026dd0: 7265 6e74 0a0a 2020 2020 6465 6620 656e  rent..    def en
-00026de0: 7375 7265 5f65 6c65 6d65 6e74 2873 656c  sure_element(sel
-00026df0: 662c 2072 6f6f 742c 2073 6563 745f 6964  f, root, sect_id
-00026e00: 2c20 7061 7265 6e74 5f64 6963 7429 3a0a  , parent_dict):.
-00026e10: 2020 2020 2020 2020 6966 2073 6563 745f          if sect_
-00026e20: 6964 203d 3d20 2222 3a0a 2020 2020 2020  id == "":.      
-00026e30: 2020 2020 2020 7072 696e 7428 6622 5241        print(f"RA
-00026e40: 4e20 4f46 4620 544f 5022 290a 2020 2020  N OFF TOP").    
-00026e50: 2020 2020 2020 2020 7265 7475 726e 204e          return N
-00026e60: 6f6e 650a 2020 2020 2020 2020 7870 6174  one.        xpat
-00026e70: 6820 3d20 6622 2f2f 7b73 656c 662e 5345  h = f"//{self.SE
-00026e80: 4354 7d5b 4069 643d 277b 7365 6374 5f69  CT}[@id='{sect_i
-00026e90: 647d 275d 220a 2020 2020 2020 2020 656c  d}']".        el
-00026ea0: 656d 7320 3d20 726f 6f74 2e78 7061 7468  ems = root.xpath
-00026eb0: 2878 7061 7468 290a 2020 2020 2020 2020  (xpath).        
-00026ec0: 6966 206c 656e 2865 6c65 6d73 2920 3d3d  if len(elems) ==
-00026ed0: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
-00026ee0: 7061 7265 6e74 5f69 6420 3d20 7061 7265  parent_id = pare
-00026ef0: 6e74 5f64 6963 742e 6765 7428 7365 6374  nt_dict.get(sect
-00026f00: 5f69 6429 0a20 2020 2020 2020 2020 2020  _id).           
-00026f10: 206d 6973 7369 6e67 203d 2046 616c 7365   missing = False
-00026f20: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00026f30: 7061 7265 6e74 5f69 6420 6973 204e 6f6e  parent_id is Non
-00026f40: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00026f50: 2020 2070 7269 6e74 2866 2220 6d69 7373     print(f" miss
-00026f60: 696e 6720 7061 7265 6e74 2073 6563 7469  ing parent secti
-00026f70: 6f6e 207b 7365 6374 5f69 647d 2229 0a20  on {sect_id}"). 
-00026f80: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-00026f90: 6973 7369 6e67 203d 2054 7275 650a 2020  issing = True.  
-00026fa0: 2020 2020 2020 2020 2020 2020 2020 7370                sp
-00026fb0: 6c20 3d20 7365 6374 5f69 642e 7370 6c69  l = sect_id.spli
-00026fc0: 7428 7365 6c66 2e44 4f54 290a 2020 2020  t(self.DOT).    
-00026fd0: 2020 2020 2020 2020 2020 2020 7370 6c69              spli
-00026fe0: 745f 203d 2073 706c 5b3a 2d31 5d0a 2020  t_ = spl[:-1].  
-00026ff0: 2020 2020 2020 2020 2020 2020 2020 7061                pa
-00027000: 7265 6e74 5f69 6420 3d20 7365 6c66 2e44  rent_id = self.D
-00027010: 4f54 2e6a 6f69 6e28 7370 6c69 745f 290a  OT.join(split_).
-00027020: 2020 2020 2020 2020 2020 2020 6966 2070              if p
-00027030: 6172 656e 745f 6964 203d 3d20 2222 3a0a  arent_id == "":.
-00027040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027050: 7072 696e 7428 6622 2073 6b69 7020 726f  print(f" skip ro
-00027060: 6f74 2e2e 2e22 290a 2020 2020 2020 2020  ot...").        
-00027070: 2020 2020 656c 656d 203d 2073 656c 662e      elem = self.
-00027080: 656e 7375 7265 5f65 6c65 6d65 6e74 2872  ensure_element(r
-00027090: 6f6f 742c 2070 6172 656e 745f 6964 2c20  oot, parent_id, 
-000270a0: 7061 7265 6e74 5f64 6963 7429 0a20 2020  parent_dict).   
-000270b0: 2020 2020 2020 2020 2069 6620 656c 656d           if elem
-000270c0: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
-000270d0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-000270e0: 6374 5f78 6d6c 203d 2045 542e 5375 6245  ct_xml = ET.SubE
-000270f0: 6c65 6d65 6e74 2865 6c65 6d2c 2073 656c  lement(elem, sel
-00027100: 662e 5345 4354 290a 2020 2020 2020 2020  f.SECT).        
-00027110: 2020 2020 2020 2020 7365 6374 5f78 6d6c          sect_xml
-00027120: 2e61 7474 7269 625b 7365 6c66 2e49 445d  .attrib[self.ID]
-00027130: 203d 2073 6563 745f 6964 0a20 2020 2020   = sect_id.     
-00027140: 2020 2020 2020 2020 2020 2069 6620 6d69             if mi
-00027150: 7373 696e 673a 0a20 2020 2020 2020 2020  ssing:.         
-00027160: 2020 2020 2020 2020 2020 2073 6563 745f             sect_
-00027170: 786d 6c2e 6174 7472 6962 5b73 656c 662e  xml.attrib[self.
-00027180: 4d49 5353 494e 475d 203d 2022 5922 0a20  MISSING] = "Y". 
-00027190: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-000271a0: 6574 7572 6e20 7365 6374 5f78 6d6c 0a20  eturn sect_xml. 
-000271b0: 2020 2020 2020 2065 6c69 6620 6c65 6e28         elif len(
-000271c0: 656c 656d 7329 203e 2031 3a0a 2020 2020  elems) > 1:.    
-000271d0: 2020 2020 2020 2020 7072 696e 7428 6622          print(f"
-000271e0: 2064 7570 6c69 6361 7465 2069 6473 3a20   duplicate ids: 
-000271f0: 7b73 6563 745f 6964 7d22 290a 2020 2020  {sect_id}").    
-00027200: 2020 2020 2020 2020 7265 7475 726e 204e          return N
-00027210: 6f6e 650a 2020 2020 2020 2020 656c 7365  one.        else
-00027220: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-00027230: 7475 726e 2065 6c65 6d73 5b30 5d0a 0a20  turn elems[0].. 
-00027240: 2020 2064 6566 2073 6f72 745f 7365 6374     def sort_sect
-00027250: 696f 6e73 2873 656c 6629 3a0a 2020 2020  ions(self):.    
-00027260: 2020 2020 7072 696e 7428 2273 6f72 7420      print("sort 
-00027270: 7365 6374 696f 6e73 204e 5949 2229 0a20  sections NYI"). 
-00027280: 2020 2020 2020 2070 6173 730a 0a20 2020         pass..   
-00027290: 2040 636c 6173 736d 6574 686f 640a 2020   @classmethod.  
-000272a0: 2020 6465 6620 736f 7274 5f69 6473 2863    def sort_ids(c
-000272b0: 6c73 293a 0a20 2020 2020 2020 2070 6173  ls):.        pas
-000272c0: 730a 0a63 6c61 7373 2046 6f6f 746e 6f74  s..class Footnot
-000272d0: 653a 0a20 2020 2022 2222 6578 7472 6163  e:.    """extrac
-000272e0: 7473 2066 6f6f 746e 6f74 6573 2062 7920  ts footnotes by 
-000272f0: 7369 7a65 2061 6e64 2073 7479 6c65 2061  size and style a
-00027300: 6e64 2070 6572 6861 7073 2070 6f73 6974  nd perhaps posit
-00027310: 696f 6d0a 2020 2020 2222 220a 0a20 2020  iom.    """..   
-00027320: 2040 636c 6173 736d 6574 686f 640a 2020   @classmethod.  
-00027330: 2020 6465 6620 6578 7472 6163 745f 666f    def extract_fo
-00027340: 6f74 6e6f 7465 7328 636c 732c 2066 6e5f  otnotes(cls, fn_
-00027350: 7870 6174 682c 2066 6f6f 746e 6f74 655f  xpath, footnote_
-00027360: 7465 7874 5f63 6c61 7373 6573 2c20 6874  text_classes, ht
-00027370: 6d6c 5f65 6c65 6d29 3a0a 2020 2020 2020  ml_elem):.      
-00027380: 2020 6e65 775f 6874 6d6c 5f65 6c65 6d20    new_html_elem 
-00027390: 3d20 4874 6d6c 4c69 622e 6372 6561 7465  = HtmlLib.create
-000273a0: 5f6e 6577 5f68 746d 6c5f 7769 7468 5f6f  _new_html_with_o
-000273b0: 6c64 5f73 7479 6c65 7328 6874 6d6c 5f65  ld_styles(html_e
-000273c0: 6c65 6d29 0a20 2020 2020 2020 2066 6f6f  lem).        foo
-000273d0: 746e 6f74 655f 6e75 6d62 6572 5f66 6f6e  tnote_number_fon
-000273e0: 745f 656c 656d 7320 3d20 6874 6d6c 5f65  t_elems = html_e
-000273f0: 6c65 6d2e 7870 6174 6828 666e 5f78 7061  lem.xpath(fn_xpa
-00027400: 7468 290a 2020 2020 2020 2020 6c61 7374  th).        last
-00027410: 5f66 6f6f 746e 756d 203d 2030 0a20 2020  _footnum = 0.   
-00027420: 2020 2020 2075 6c20 3d20 4554 2e45 6c65       ul = ET.Ele
-00027430: 6d65 6e74 2822 756c 2229 0a20 2020 2020  ment("ul").     
-00027440: 2020 2048 746d 6c4c 6962 2e67 6574 5f62     HtmlLib.get_b
-00027450: 6f64 7928 6e65 775f 6874 6d6c 5f65 6c65  ody(new_html_ele
-00027460: 6d29 2e61 7070 656e 6428 756c 290a 2020  m).append(ul).  
-00027470: 2020 2020 2020 2320 6d65 7373 792c 206e        # messy, n
-00027480: 6565 6420 6120 466f 6f74 6e6f 7465 206f  eed a Footnote o
-00027490: 626a 6563 7420 6865 7265 0a20 2020 2020  bject here.     
-000274a0: 2020 2066 6f72 2066 6f6f 746e 6f74 655f     for footnote_
-000274b0: 6e75 6d62 6572 5f65 6c65 6d20 696e 2066  number_elem in f
-000274c0: 6f6f 746e 6f74 655f 6e75 6d62 6572 5f66  ootnote_number_f
-000274d0: 6f6e 745f 656c 656d 733a 0a20 2020 2020  ont_elems:.     
-000274e0: 2020 2020 2020 206c 6173 745f 666f 6f74         last_foot
-000274f0: 6e75 6d2c 206c 6920 3d20 466f 6f74 6e6f  num, li = Footno
-00027500: 7465 2e65 7874 7261 6374 5f66 6f6f 746e  te.extract_footn
-00027510: 6f74 655f 616e 645f 7361 7665 280a 2020  ote_and_save(.  
-00027520: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-00027530: 6f74 6e6f 7465 5f6e 756d 6265 725f 656c  otnote_number_el
-00027540: 656d 2c20 666f 6f74 6e6f 7465 5f74 6578  em, footnote_tex
-00027550: 745f 636c 6173 7365 732c 206c 6173 745f  t_classes, last_
-00027560: 666f 6f74 6e75 6d29 0a20 2020 2020 2020  footnum).       
-00027570: 2020 2020 2069 6620 6c69 2069 7320 6e6f       if li is no
-00027580: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-00027590: 2020 2020 2020 2020 756c 2e61 7070 656e          ul.appen
-000275a0: 6428 6c69 290a 2020 2020 2020 2020 7265  d(li).        re
-000275b0: 7475 726e 206e 6577 5f68 746d 6c5f 656c  turn new_html_el
-000275c0: 656d 0a0a 2020 2020 4063 6c61 7373 6d65  em..    @classme
-000275d0: 7468 6f64 0a20 2020 2064 6566 2069 735f  thod.    def is_
-000275e0: 666f 6f74 6e6f 7465 5f66 6f6e 7428 636c  footnote_font(cl
-000275f0: 732c 2066 6f6f 746e 6f74 655f 6e75 6d62  s, footnote_numb
-00027600: 6572 5f65 6c65 6d29 3a0a 2020 2020 2020  er_elem):.      
-00027610: 2020 2222 220a 2020 2020 2020 2020 666f    """.        fo
-00027620: 6e74 2073 697a 6520 616c 6f6e 6520 646f  nt size alone do
-00027630: 6573 206e 6f74 2064 6973 7469 6e67 7569  es not distingui
-00027640: 7368 2c20 736f 2075 7365 206e 6569 6768  sh, so use neigh
-00027650: 626f 7572 696e 6720 7465 7874 0a20 2020  bouring text.   
-00027660: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00027670: 206e 6578 7420 3d20 586d 6c4c 6962 2e67   next = XmlLib.g
-00027680: 6574 5f6e 6578 745f 656c 656d 656e 7428  et_next_element(
-00027690: 666f 6f74 6e6f 7465 5f6e 756d 6265 725f  footnote_number_
-000276a0: 656c 656d 290a 2020 2020 2020 2020 7465  elem).        te
-000276b0: 7874 203d 2066 6f6f 746e 6f74 655f 6e75  xt = footnote_nu
-000276c0: 6d62 6572 5f65 6c65 6d2e 7465 7874 0a20  mber_elem.text. 
-000276d0: 2020 2020 2020 2069 6620 6e65 7874 2069         if next i
-000276e0: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-000276f0: 2020 2020 7072 696e 7428 6622 4e4f 2066      print(f"NO f
-00027700: 6f6c 6c6f 7769 6e67 2065 6c65 6d22 290a  ollowing elem").
-00027710: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00027720: 726e 2046 616c 7365 0a20 2020 2020 2020  rn False.       
-00027730: 2023 2066 6f6c 6c6f 6564 2062 7920 736d   # folloed by sm
-00027740: 616c 6c20 666f 6e74 3f0a 2020 2020 2020  all font?.      
-00027750: 2020 6e65 7874 5f63 6c61 7373 203d 206e    next_class = n
-00027760: 6578 742e 6174 7472 6962 5b22 636c 6173  ext.attrib["clas
-00027770: 7322 5d0a 2020 2020 2020 2020 6966 206e  s"].        if n
-00027780: 6578 745f 636c 6173 7320 3d3d 2022 7331  ext_class == "s1
-00027790: 3034 3522 3a0a 2020 2020 2020 2020 2020  045":.          
-000277a0: 2020 7265 7475 726e 2054 7275 650a 2020    return True.  
-000277b0: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
-000277c0: 7365 0a0a 0a23 2046 6f6f 746e 6f74 650a  se...# Footnote.
-000277d0: 0a20 2020 2040 636c 6173 736d 6574 686f  .    @classmetho
-000277e0: 640a 2020 2020 6465 6620 6578 7472 6163  d.    def extrac
-000277f0: 745f 666f 6f74 6e6f 7465 5f61 6e64 5f73  t_footnote_and_s
-00027800: 6176 6528 636c 732c 2066 6f6f 746e 6f74  ave(cls, footnot
-00027810: 655f 6e75 6d62 6572 5f65 6c65 6d2c 2066  e_number_elem, f
-00027820: 6f6f 746e 6f74 655f 7465 7874 5f63 6c61  ootnote_text_cla
-00027830: 7373 6573 2c20 6c61 7374 5f66 6f6f 746e  sses, last_footn
-00027840: 756d 293a 0a20 2020 2020 2020 2074 6578  um):.        tex
-00027850: 7420 3d20 666f 6f74 6e6f 7465 5f6e 756d  t = footnote_num
-00027860: 6265 725f 656c 656d 2e74 6578 740a 2020  ber_elem.text.  
-00027870: 2020 2020 2020 666f 6f74 6e6f 7465 5f6e        footnote_n
-00027880: 756d 6265 7220 3d20 2d31 0a20 2020 2020  umber = -1.     
-00027890: 2020 2069 676e 6f72 6520 3d20 4661 6c73     ignore = Fals
-000278a0: 650a 2020 2020 2020 2020 6966 206e 6f74  e.        if not
-000278b0: 2063 6c73 2e69 735f 666f 6f74 6e6f 7465   cls.is_footnote
-000278c0: 5f66 6f6e 7428 666f 6f74 6e6f 7465 5f6e  _font(footnote_n
-000278d0: 756d 6265 725f 656c 656d 293a 0a20 2020  umber_elem):.   
-000278e0: 2020 2020 2020 2020 2069 676e 6f72 6520           ignore 
-000278f0: 3d20 5472 7565 0a20 2020 2020 2020 2074  = True.        t
-00027900: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
-00027910: 666f 6f74 6e6f 7465 5f6e 756d 6265 7220  footnote_number 
-00027920: 3d20 696e 7428 7465 7874 290a 2020 2020  = int(text).    
-00027930: 2020 2020 6578 6365 7074 2045 7863 6570      except Excep
-00027940: 7469 6f6e 3a0a 2020 2020 2020 2020 2020  tion:.          
-00027950: 2020 6967 6e6f 7265 203d 2054 7275 650a    ignore = True.
-00027960: 2020 2020 2020 2020 6c69 203d 204e 6f6e          li = Non
-00027970: 650a 2020 2020 2020 2020 6966 206e 6f74  e.        if not
-00027980: 2069 676e 6f72 6520 616e 6420 3520 3e20   ignore and 5 > 
-00027990: 2866 6f6f 746e 6f74 655f 6e75 6d62 6572  (footnote_number
-000279a0: 202d 206c 6173 745f 666f 6f74 6e75 6d29   - last_footnum)
-000279b0: 203e 3d20 303a 0a20 2020 2020 2020 2020   >= 0:.         
-000279c0: 2020 206c 6173 745f 666f 6f74 6e75 6d2c     last_footnum,
-000279d0: 206c 6920 3d20 636c 732e 6465 6c65 7465   li = cls.delete
-000279e0: 5f66 6f6f 746e 6f74 655f 6e75 6d62 6572  _footnote_number
-000279f0: 5f61 6e64 5f66 6f6c 6c6f 7769 6e67 5f74  _and_following_t
-00027a00: 6578 745f 5f61 6e64 5f61 6464 5f74 6f5f  ext__and_add_to_
-00027a10: 6c69 7374 280a 2020 2020 2020 2020 2020  list(.          
-00027a20: 2020 2020 2020 666f 6f74 6e6f 7465 5f74        footnote_t
-00027a30: 6578 745f 636c 6173 7365 732c 2066 6f6f  ext_classes, foo
-00027a40: 746e 6f74 655f 6e75 6d62 6572 2c0a 2020  tnote_number,.  
-00027a50: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-00027a60: 6f74 6e6f 7465 5f6e 756d 6265 725f 656c  otnote_number_el
-00027a70: 656d 290a 2020 2020 2020 2020 7265 7475  em).        retu
-00027a80: 726e 206c 6173 745f 666f 6f74 6e75 6d2c  rn last_footnum,
-00027a90: 206c 690a 0a20 2020 2023 2046 6f6f 746e   li..    # Footn
-00027aa0: 6f74 650a 0a20 2020 2040 636c 6173 736d  ote..    @classm
-00027ab0: 6574 686f 640a 2020 2020 6465 6620 6372  ethod.    def cr
-00027ac0: 6561 7465 5f66 6f6f 746e 6f74 655f 6e75  eate_footnote_nu
-00027ad0: 6d62 6572 5f78 7061 7468 2863 6c73 2c20  mber_xpath(cls, 
-00027ae0: 666f 6f74 6e6f 7465 5f6e 756d 6265 725f  footnote_number_
-00027af0: 636c 6173 7365 7329 3a0a 2020 2020 2020  classes):.      
-00027b00: 2020 7870 6174 6830 203d 2022 220a 2020    xpath0 = "".  
-00027b10: 2020 2020 2020 666f 7220 692c 2066 6e63        for i, fnc
-00027b20: 2069 6e20 656e 756d 6572 6174 6528 666f   in enumerate(fo
-00027b30: 6f74 6e6f 7465 5f6e 756d 6265 725f 636c  otnote_number_cl
-00027b40: 6173 7365 7329 3a0a 2020 2020 2020 2020  asses):.        
-00027b50: 2020 2020 7870 6174 6830 202b 3d20 2222      xpath0 += ""
-00027b60: 2069 6620 6920 3d3d 2030 2065 6c73 6520   if i == 0 else 
-00027b70: 2220 6f72 2022 0a20 2020 2020 2020 2020  " or ".         
-00027b80: 2020 2078 7061 7468 3020 2b3d 2066 2227     xpath0 += f"'
-00027b90: 7b66 6e63 7d27 220a 2020 2020 2020 2020  {fnc}'".        
-00027ba0: 666e 5f78 7061 7468 203d 2066 222e 2f2f  fn_xpath = f".//
-00027bb0: 7370 616e 5b7b 7870 6174 6830 7d5d 220a  span[{xpath0}]".
-00027bc0: 2020 2020 2020 2020 7265 7475 726e 2066          return f
-00027bd0: 6e5f 7870 6174 680a 0a20 2020 2023 2046  n_xpath..    # F
-00027be0: 6f6f 746e 6f74 650a 0a20 2020 2040 636c  ootnote..    @cl
-00027bf0: 6173 736d 6574 686f 640a 2020 2020 6465  assmethod.    de
-00027c00: 6620 6465 6c65 7465 5f66 6f6f 746e 6f74  f delete_footnot
-00027c10: 655f 6e75 6d62 6572 5f61 6e64 5f66 6f6c  e_number_and_fol
-00027c20: 6c6f 7769 6e67 5f74 6578 745f 5f61 6e64  lowing_text__and
-00027c30: 5f61 6464 5f74 6f5f 6c69 7374 280a 2020  _add_to_list(.  
-00027c40: 2020 2020 2020 2020 2020 636c 732c 2063            cls, c
-00027c50: 6c61 7373 6573 2c20 666f 6f74 6e6f 7465  lasses, footnote
-00027c60: 5f6e 756d 6265 722c 2066 6f6f 746e 6f74  _number, footnot
-00027c70: 655f 6e75 6d62 6572 5f65 6c65 6d29 3a0a  e_number_elem):.
-00027c80: 2020 2020 2020 2020 6c69 203d 2045 542e          li = ET.
-00027c90: 456c 656d 656e 7428 226c 6922 290a 2020  Element("li").  
-00027ca0: 2020 2020 2020 6c69 2e61 7070 656e 6428        li.append(
-00027cb0: 636f 7079 2e64 6565 7063 6f70 7928 666f  copy.deepcopy(fo
-00027cc0: 6f74 6e6f 7465 5f6e 756d 6265 725f 656c  otnote_number_el
-00027cd0: 656d 2929 0a20 2020 2020 2020 2066 6f6f  em)).        foo
-00027ce0: 746e 6f74 655f 666f 6c6c 6f77 6572 7320  tnote_followers 
-00027cf0: 3d20 586d 6c4c 6962 2e67 6574 5f66 6f6c  = XmlLib.get_fol
-00027d00: 6c6f 7769 6e67 5f65 6c65 6d65 6e74 7328  lowing_elements(
-00027d10: 666f 6f74 6e6f 7465 5f6e 756d 6265 725f  footnote_number_
-00027d20: 656c 656d 290a 2020 2020 2020 2020 2320  elem).        # 
-00027d30: 6164 6420 6f6e 6520 7370 616e 2865 6e64  add one span(end
-00027d40: 7320 6166 7465 7220 666f 6e74 2063 6861  s after font cha
-00027d50: 6d67 6529 0a20 2020 2020 2020 2063 6c73  mge).        cls
-00027d60: 2e69 7465 7261 7465 5f75 6e74 696c 5f75  .iterate_until_u
-00027d70: 6e61 6363 6570 7461 626c 655f 666f 6e74  nacceptable_font
-00027d80: 5f63 6c61 7373 2866 6f6f 746e 6f74 655f  _class(footnote_
-00027d90: 666f 6c6c 6f77 6572 732c 206c 693d 6c69  followers, li=li
-00027da0: 2c20 666e 5f63 6c61 7373 6573 3d63 6c61  , fn_classes=cla
-00027db0: 7373 6573 290a 2020 2020 2020 2020 6c61  sses).        la
-00027dc0: 7374 5f66 6f6f 746e 756d 203d 2066 6f6f  st_footnum = foo
-00027dd0: 746e 6f74 655f 6e75 6d62 6572 0a20 2020  tnote_number.   
-00027de0: 2020 2020 2058 6d6c 4c69 622e 7265 6d6f       XmlLib.remo
-00027df0: 7665 5f65 6c65 6d65 6e74 2866 6f6f 746e  ve_element(footn
-00027e00: 6f74 655f 6e75 6d62 6572 5f65 6c65 6d29  ote_number_elem)
-00027e10: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00027e20: 6c61 7374 5f66 6f6f 746e 756d 2c20 6c69  last_footnum, li
-00027e30: 0a0a 2020 2020 2320 466f 6f74 6e6f 7465  ..    # Footnote
-00027e40: 0a0a 2020 2020 4063 6c61 7373 6d65 7468  ..    @classmeth
-00027e50: 6f64 0a20 2020 2064 6566 2069 7465 7261  od.    def itera
-00027e60: 7465 5f75 6e74 696c 5f75 6e61 6363 6570  te_until_unaccep
-00027e70: 7461 626c 655f 666f 6e74 5f63 6c61 7373  table_font_class
-00027e80: 2863 6c73 2c20 666f 6c6c 6f77 6572 732c  (cls, followers,
-00027e90: 206c 693d 4e6f 6e65 2c20 666e 5f63 6c61   li=None, fn_cla
-00027ea0: 7373 6573 3d4e 6f6e 652c 2064 6562 7567  sses=None, debug
-00027eb0: 3d46 616c 7365 293a 0a20 2020 2020 2020  =False):.       
-00027ec0: 2022 2222 6974 6572 6174 6573 206f 7665   """iterates ove
-00027ed0: 7220 656c 656d 7473 2066 6f6c 6c6f 7769  r elemts followi
-00027ee0: 6e67 2061 2066 6f6f 746e 6f74 6520 6e75  ng a footnote nu
-00027ef0: 6d62 6572 2075 6e74 696c 2061 6e20 696e  mber until an in
-00027f00: 636f 6d70 6174 6962 6c65 0a20 2020 2020  compatible.     
-00027f10: 2020 2063 6c61 7373 2073 7479 6c65 2069     class style i
-00027f20: 7320 666f 756e 642c 2077 6865 6e20 6272  s found, when br
-00027f30: 6561 6b22 2222 0a20 2020 2020 2020 2066  eak""".        f
-00027f40: 6f72 2066 6f6c 6c6f 7765 7220 696e 2066  or follower in f
-00027f50: 6f6c 6c6f 7765 7273 3a0a 2020 2020 2020  ollowers:.      
-00027f60: 2020 2020 2020 636c 617a 7a20 3d20 666f        clazz = fo
-00027f70: 6c6c 6f77 6572 2e61 7474 7269 625b 2263  llower.attrib["c
-00027f80: 6c61 7373 225d 0a20 2020 2020 2020 2020  lass"].         
-00027f90: 2020 2069 6620 636c 617a 7a20 696e 2066     if clazz in f
-00027fa0: 6e5f 636c 6173 7365 733a 0a20 2020 2020  n_classes:.     
-00027fb0: 2020 2020 2020 2020 2020 206c 692e 6170             li.ap
-00027fc0: 7065 6e64 2863 6f70 792e 6465 6570 636f  pend(copy.deepco
-00027fd0: 7079 2866 6f6c 6c6f 7765 7229 290a 2020  py(follower)).  
-00027fe0: 2020 2020 2020 2020 2020 2020 2020 586d                Xm
-00027ff0: 6c4c 6962 2e72 656d 6f76 655f 656c 656d  lLib.remove_elem
-00028000: 656e 7428 666f 6c6c 6f77 6572 290a 2020  ent(follower).  
-00028010: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-00028020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028030: 6966 2064 6562 7567 3a0a 2020 2020 2020  if debug:.      
-00028040: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-00028050: 696e 7428 6622 6272 6f6b 6520 6f75 7420  int(f"broke out 
-00028060: 6f66 2066 6f6f 746e 6f74 6520 6174 207b  of footnote at {
-00028070: 636c 617a 7a7d 2229 0a20 2020 2020 2020  clazz}").       
-00028080: 2020 2020 2020 2020 2062 7265 616b 0a0a           break..
-00028090: 0a                                       .
+00020bd0: 2020 206c 6f67 6769 6e67 2e77 6172 6e69     logging.warni
+00020be0: 6e67 2866 226e 6f74 2061 206e 756d 6265  ng(f"not a numbe
+00020bf0: 7220 7b76 616c 7565 317d 2229 0a20 2020  r {value1}").   
+00020c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020c10: 2072 6574 7572 6e20 4661 6c73 650a 0a20   return False.. 
+00020c20: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00020c30: 6620 7268 732e 656e 6473 7769 7468 2843  f rhs.endswith(C
+00020c40: 5353 5374 796c 652e 5058 293a 0a20 2020  SSStyle.PX):.   
+00020c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020c60: 2072 6873 203d 2072 6873 5b3a 2d32 5d0a   rhs = rhs[:-2].
+00020c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020c80: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+00020c90: 2020 2020 2020 2020 2076 616c 7565 3220           value2 
+00020ca0: 3d20 666c 6f61 7428 7268 7329 0a20 2020  = float(rhs).   
+00020cb0: 2020 2020 2020 2020 2020 2020 2065 7863               exc
+00020cc0: 6570 7420 4578 6365 7074 696f 6e3a 0a20  ept Exception:. 
+00020cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020ce0: 2020 206c 6f67 6769 6e67 2e77 6172 6e69     logging.warni
+00020cf0: 6e67 2866 226e 6f74 2061 206e 756d 6265  ng(f"not a numbe
+00020d00: 7220 7b72 6873 7d22 290a 2020 2020 2020  r {rhs}").      
+00020d10: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00020d20: 7475 726e 2046 616c 7365 0a20 2020 2020  turn False.     
+00020d30: 2020 2020 2020 2020 2020 206f 7065 7220             oper 
+00020d40: 3d20 7373 5b31 5d0a 2020 2020 2020 2020  = ss[1].        
+00020d50: 2020 2020 2020 2020 6966 206f 7065 7220          if oper 
+00020d60: 3d3d 2022 3e22 3a0a 2020 2020 2020 2020  == ">":.        
+00020d70: 2020 2020 2020 2020 2020 2020 7265 7375              resu
+00020d80: 6c74 203d 2076 616c 7565 3120 3e20 7661  lt = value1 > va
+00020d90: 6c75 6532 0a20 2020 2020 2020 2020 2020  lue2.           
+00020da0: 2020 2020 2065 6c69 6620 6f70 6572 203d       elif oper =
+00020db0: 3d20 223c 223a 0a20 2020 2020 2020 2020  = "<":.         
+00020dc0: 2020 2020 2020 2020 2020 2072 6573 756c             resul
+00020dd0: 7420 3d20 7661 6c75 6531 203c 2076 616c  t = value1 < val
+00020de0: 7565 320a 2020 2020 2020 2020 2020 2020  ue2.            
+00020df0: 2020 2020 656c 6966 206f 7065 7220 3d3d      elif oper ==
+00020e00: 2022 213d 223a 0a20 2020 2020 2020 2020   "!=":.         
+00020e10: 2020 2020 2020 2020 2020 2072 6573 756c             resul
+00020e20: 7420 3d20 7661 6c75 6531 2021 3d20 7661  t = value1 != va
+00020e30: 6c75 6532 0a20 2020 2020 2020 2020 2020  lue2.           
+00020e40: 2020 2020 2065 6c69 6620 6f70 6572 203d       elif oper =
+00020e50: 3d20 223d 3d22 3a0a 2020 2020 2020 2020  = "==":.        
+00020e60: 2020 2020 2020 2020 2020 2020 7265 7375              resu
+00020e70: 6c74 203d 2028 7661 6c75 6531 203d 3d20  lt = (value1 == 
+00020e80: 7661 6c75 6532 290a 2020 2020 2020 2020  value2).        
+00020e90: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00020ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020eb0: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
+00020ec0: 6f72 2866 2262 6164 206f 7065 7261 746f  or(f"bad operato
+00020ed0: 723a 207b 6f70 6572 7d22 290a 2020 2020  r: {oper}").    
+00020ee0: 2020 2020 2020 2020 2020 2020 6966 2072              if r
+00020ef0: 6573 756c 743a 0a20 2020 2020 2020 2020  esult:.         
+00020f00: 2020 2020 2020 2020 2020 2070 6173 730a             pass.
+00020f10: 2020 2020 2020 2020 7265 7475 726e 2072          return r
+00020f20: 6573 756c 740a 0a20 2020 2023 2020 2020  esult..    #    
+00020f30: 636c 6173 7320 4353 5353 7479 6c65 3a0a  class CSSStyle:.
+00020f40: 0a20 2020 2040 636c 6173 736d 6574 686f  .    @classmetho
+00020f50: 640a 2020 2020 6465 6620 636d 796b 5f74  d.    def cmyk_t
+00020f60: 6f5f 7267 6228 636c 732c 2063 2c20 6d2c  o_rgb(cls, c, m,
+00020f70: 2079 2c20 6b29 3a0a 0a20 2020 2020 2020   y, k):..       
+00020f80: 2072 6762 5f73 6361 6c65 203d 2032 3535   rgb_scale = 255
+00020f90: 0a20 2020 2020 2020 2023 2063 6d79 6b5f  .        # cmyk_
+00020fa0: 7363 616c 6520 3d20 3130 300a 2020 2020  scale = 100.    
+00020fb0: 2020 2020 636d 796b 5f73 6361 6c65 203d      cmyk_scale =
+00020fc0: 2031 2e30 0a20 2020 2020 2020 2072 203d   1.0.        r =
+00020fd0: 2072 6762 5f73 6361 6c65 202a 2028 312e   rgb_scale * (1.
+00020fe0: 3020 2d20 2863 202b 206b 2920 2f20 666c  0 - (c + k) / fl
+00020ff0: 6f61 7428 636d 796b 5f73 6361 6c65 2929  oat(cmyk_scale))
+00021000: 0a20 2020 2020 2020 2067 203d 2072 6762  .        g = rgb
+00021010: 5f73 6361 6c65 202a 2028 312e 3020 2d20  _scale * (1.0 - 
+00021020: 286d 202b 206b 2920 2f20 666c 6f61 7428  (m + k) / float(
+00021030: 636d 796b 5f73 6361 6c65 2929 0a20 2020  cmyk_scale)).   
+00021040: 2020 2020 2062 203d 2072 6762 5f73 6361       b = rgb_sca
+00021050: 6c65 202a 2028 312e 3020 2d20 2879 202b  le * (1.0 - (y +
+00021060: 206b 2920 2f20 666c 6f61 7428 636d 796b   k) / float(cmyk
+00021070: 5f73 6361 6c65 2929 0a0a 2020 2020 2020  _scale))..      
+00021080: 2020 7265 7475 726e 2072 2c20 672c 2062    return r, g, b
+00021090: 0a0a 2020 2020 2320 2020 2063 6c61 7373  ..    #    class
+000210a0: 2043 5353 5374 796c 653a 0a0a 2020 2020   CSSStyle:..    
+000210b0: 4063 6c61 7373 6d65 7468 6f64 0a20 2020  @classmethod.   
+000210c0: 2064 6566 2063 6d6b 795f 746f 5f72 6762   def cmky_to_rgb
+000210d0: 2863 6c73 2c20 632c 206d 2c20 6b2c 2079  (cls, c, m, k, y
+000210e0: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
+000210f0: 6e20 636c 732e 636d 796b 5f74 6f5f 7267  n cls.cmyk_to_rg
+00021100: 6228 632c 206d 2c20 792c 206b 290a 0a20  b(c, m, y, k).. 
+00021110: 2020 2064 6566 2065 7874 7261 6374 5f62     def extract_b
+00021120: 6f6c 645f 6974 616c 6963 5f66 726f 6d5f  old_italic_from_
+00021130: 666f 6e74 5f66 616d 696c 7928 0a20 2020  font_family(.   
+00021140: 2020 2020 2020 2020 2073 656c 662c 0a20           self,. 
+00021150: 2020 2020 2020 2020 2020 206f 7665 7277             overw
+00021160: 7269 7465 5f62 6f6c 643d 4661 6c73 652c  rite_bold=False,
+00021170: 0a20 2020 2020 2020 2020 2020 206f 7665  .            ove
+00021180: 7277 7269 7465 5f73 7479 6c65 3d46 616c  rwrite_style=Fal
+00021190: 7365 2c0a 2020 2020 2020 2020 2020 2020  se,.            
+000211a0: 6f76 6572 7772 6974 655f 6661 6d69 6c79  overwrite_family
+000211b0: 3d54 7275 652c 0a20 2020 2020 2020 2020  =True,.         
+000211c0: 2020 2073 7479 6c65 5f72 6567 6578 3d53     style_regex=S
+000211d0: 5459 4c45 5f52 452c 0a20 2020 2020 2020  TYLE_RE,.       
+000211e0: 2020 2020 2077 6569 6768 745f 7265 6765       weight_rege
+000211f0: 783d 5745 4947 4854 5f52 4529 3a0a 2020  x=WEIGHT_RE):.  
+00021200: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00021210: 2020 6865 7572 6973 7469 6373 2074 6f20    heuristics to 
+00021220: 6669 6e64 2062 6f6c 6420 616e 6420 6974  find bold and it
+00021230: 616c 6963 2069 6e20 666f 6e74 206e 616d  alic in font nam
+00021240: 6573 2061 6e64 2074 7279 2074 6f20 6e6f  es and try to no
+00021250: 726d 616c 6973 650a 2020 2020 2020 2020  rmalise.        
+00021260: 652e 672e 0a20 2020 2020 2020 2066 6f6e  e.g..        fon
+00021270: 742d 6661 6d69 6c79 3a20 5469 6d65 734e  t-family: TimesN
+00021280: 6577 526f 6d61 6e50 532d 426f 6c64 4d54  ewRomanPS-BoldMT
+00021290: 3b20 3d3e 2066 6f6e 742d 6661 6d69 6c79  ; => font-family
+000212a0: 3a20 5469 6d65 734e 6577 526f 6d61 6e50  : TimesNewRomanP
+000212b0: 534d 543b 2066 6f6e 745f 7765 6967 6874  SMT; font_weight
+000212c0: 3a20 626f 6c64 0a20 2020 2020 2020 2066  : bold.        f
+000212d0: 6f6e 742d 6661 6d69 6c79 3a20 5469 6d65  ont-family: Time
+000212e0: 734e 6577 526f 6d61 6e50 532d 4974 616c  sNewRomanPS-Ital
+000212f0: 6963 4d54 3b20 3d3e 2066 6f6e 742d 6661  icMT; => font-fa
+00021300: 6d69 6c79 3a20 5469 6d65 734e 6577 526f  mily: TimesNewRo
+00021310: 6d61 6e50 534d 543b 2066 6f6e 745f 7374  manPSMT; font_st
+00021320: 796c 653a 2069 7461 6c69 630a 2020 2020  yle: italic.    
+00021330: 2020 2020 7468 6520 6f76 6572 7772 6974      the overwrit
+00021340: 655f 2a20 6465 7465 726d 696e 6520 7768  e_* determine wh
+00021350: 6574 6568 7220 6578 6973 7469 6e67 2063  etehr existing c
+00021360: 6f6d 706f 6e65 6e74 7320 7769 6c6c 2062  omponents will b
+00021370: 6520 6f76 6572 7772 6974 7465 6e0a 2020  e overwritten.  
+00021380: 2020 2020 2020 3a70 6172 616d 206f 7665        :param ove
+00021390: 7277 7269 7465 5f62 6f6c 643a 2063 7265  rwrite_bold: cre
+000213a0: 6174 6520 666f 6e74 5f77 6569 6768 743a  ate font_weight:
+000213b0: 626f 6c64 2072 6567 6172 646c 6573 7320  bold regardless 
+000213c0: 6f66 2070 7265 7669 6f75 7320 7765 6967  of previous weig
+000213d0: 6874 0a20 2020 2020 2020 203a 7061 7261  ht.        :para
+000213e0: 6d20 6f76 6572 7772 6974 655f 7374 796c  m overwrite_styl
+000213f0: 653a 2063 7265 6174 6520 666f 6e74 5f73  e: create font_s
+00021400: 7479 6c65 3a62 6f6c 6420 7265 6761 7264  tyle:bold regard
+00021410: 6c65 7373 206f 6620 7072 6576 696f 7573  less of previous
+00021420: 2073 7479 6c65 0a20 2020 2020 2020 203a   style.        :
+00021430: 7061 7261 6d20 6f76 6572 7772 6974 655f  param overwrite_
+00021440: 6661 6d69 6c79 3a20 6564 6974 2066 6f6e  family: edit fon
+00021450: 742d 6661 6d69 6c79 2074 6f20 7265 6d6f  t-family to remo
+00021460: 7665 2073 7479 6c65 2f77 6569 6768 7420  ve style/weight 
+00021470: 696e 666f 2028 6861 636b 7929 0a20 2020  info (hacky).   
+00021480: 2020 2020 203a 7061 7261 6d20 7374 796c       :param styl
+00021490: 655f 7265 6765 783d 0a0a 2020 2020 2020  e_regex=..      
+000214a0: 2020 2222 220a 2020 2020 2020 2020 6661    """.        fa
+000214b0: 6d69 6c79 203d 2073 656c 662e 666f 6e74  mily = self.font
+000214c0: 5f66 616d 696c 790a 2020 2020 2020 2020  _family.        
+000214d0: 6966 206e 6f74 2066 616d 696c 793a 0a20  if not family:. 
+000214e0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+000214f0: 6e0a 2020 2020 2020 2020 6661 6d69 6c79  n.        family
+00021500: 5f73 7479 6c65 2c20 7374 796c 6520 3d20  _style, style = 
+00021510: 7365 6c66 2e6d 6174 6368 5f77 6569 6768  self.match_weigh
+00021520: 745f 7374 796c 6528 6661 6d69 6c79 2c20  t_style(family, 
+00021530: 7374 796c 655f 7265 6765 782c 2076 616c  style_regex, val
+00021540: 7565 3d22 4922 2c20 6d61 726b 3d22 5353  ue="I", mark="SS
+00021550: 2229 0a20 2020 2020 2020 2066 616d 696c  ").        famil
+00021560: 795f 7765 6967 6874 2c20 7765 6967 6874  y_weight, weight
+00021570: 203d 2073 656c 662e 6d61 7463 685f 7765   = self.match_we
+00021580: 6967 6874 5f73 7479 6c65 2866 616d 696c  ight_style(famil
+00021590: 792c 2077 6569 6768 745f 7265 6765 782c  y, weight_regex,
+000215a0: 2076 616c 7565 3d22 4222 2c20 6d61 726b   value="B", mark
+000215b0: 3d22 5757 2229 0a20 2020 2020 2020 2023  ="WW").        #
+000215c0: 2070 7269 6e74 2866 2266 616d 696c 793a   print(f"family:
+000215d0: 207b 6661 6d69 6c79 7d3b 2073 7479 6c65   {family}; style
+000215e0: 3a20 7b73 7479 6c65 7d3b 2077 6569 6768  : {style}; weigh
+000215f0: 743a 207b 7765 6967 6874 7d3b 2229 0a20  t: {weight};"). 
+00021600: 2020 2020 2020 2069 6620 6661 6d69 6c79         if family
+00021610: 5f77 6569 6768 7420 616e 6420 6f76 6572  _weight and over
+00021620: 7772 6974 655f 6661 6d69 6c79 3a0a 2020  write_family:.  
+00021630: 2020 2020 2020 2020 2020 7365 6c66 2e73            self.s
+00021640: 6574 5f66 616d 696c 7928 6661 6d69 6c79  et_family(family
+00021650: 5f77 6569 6768 7429 0a20 2020 2020 2020  _weight).       
+00021660: 2069 6620 7765 6967 6874 2061 6e64 206f   if weight and o
+00021670: 7665 7277 7269 7465 5f62 6f6c 643a 0a20  verwrite_bold:. 
+00021680: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00021690: 7365 745f 666f 6e74 5f77 6569 6768 7428  set_font_weight(
+000216a0: 7765 6967 6874 290a 2020 2020 2020 2020  weight).        
+000216b0: 6966 2073 7479 6c65 2061 6e64 206f 7665  if style and ove
+000216c0: 7277 7269 7465 5f73 7479 6c65 3a0a 2020  rwrite_style:.  
+000216d0: 2020 2020 2020 2020 2020 7365 6c66 2e73            self.s
+000216e0: 6574 5f66 6f6e 745f 7374 796c 6528 7374  et_font_style(st
+000216f0: 796c 6529 0a20 2020 2020 2020 2023 2069  yle).        # i
+00021700: 6620 7374 796c 6520 616e 6420 6f76 6572  f style and over
+00021710: 7772 6974 655f 7374 7265 7463 6865 643a  write_stretched:
+00021720: 0a20 2020 2020 2020 2023 2020 2020 2073  .        #     s
+00021730: 656c 662e 7365 745f 666f 6e74 5f73 7472  elf.set_font_str
+00021740: 6574 6368 6564 2873 7479 6c65 290a 2020  etched(style).  
+00021750: 2020 2020 2020 2320 7072 696e 7428 6622        # print(f"
+00021760: 6e65 7720 7374 796c 6520 7b73 656c 667d  new style {self}
+00021770: 2229 0a0a 2020 2020 2320 2020 2063 6c61  ")..    #    cla
+00021780: 7373 2043 5353 5374 796c 653a 0a0a 2020  ss CSSStyle:..  
+00021790: 2020 6465 6620 6d61 7463 685f 7765 6967    def match_weig
+000217a0: 6874 5f73 7479 6c65 2873 656c 662c 2066  ht_style(self, f
+000217b0: 616d 696c 792c 2077 6569 6768 745f 7265  amily, weight_re
+000217c0: 6765 782c 2076 616c 7565 3d4e 6f6e 652c  gex, value=None,
+000217d0: 206d 6172 6b3d 4e6f 6e65 293a 0a20 2020   mark=None):.   
+000217e0: 2020 2020 2077 6569 6768 745f 7265 6320       weight_rec 
+000217f0: 3d20 7265 2e63 6f6d 7069 6c65 2877 6569  = re.compile(wei
+00021800: 6768 745f 7265 6765 7829 2069 6620 7765  ght_regex) if we
+00021810: 6967 6874 5f72 6567 6578 2065 6c73 6520  ight_regex else 
+00021820: 4e6f 6e65 0a20 2020 2020 2020 206d 6174  None.        mat
+00021830: 6368 203d 2077 6569 6768 745f 7265 632e  ch = weight_rec.
+00021840: 7365 6172 6368 2866 616d 696c 7929 0a20  search(family). 
+00021850: 2020 2020 2020 2069 6620 6d61 7463 683a         if match:
+00021860: 0a20 2020 2020 2020 2020 2020 2076 616c  .            val
+00021870: 7565 203d 2066 616d 696c 795b 6d61 7463  ue = family[matc
+00021880: 682e 7374 6172 7428 293a 6d61 7463 682e  h.start():match.
+00021890: 656e 6428 295d 0a20 2020 2020 2020 2020  end()].         
+000218a0: 2020 2076 616c 7565 203d 2076 616c 7565     value = value
+000218b0: 2e72 6570 6c61 6365 2822 2d22 2c20 2222  .replace("-", ""
+000218c0: 292e 7265 706c 6163 6528 222e 222c 2022  ).replace(".", "
+000218d0: 2229 0a20 2020 2020 2020 2020 2020 2066  ").            f
+000218e0: 616d 696c 7920 3d20 6661 6d69 6c79 5b3a  amily = family[:
+000218f0: 6d61 7463 682e 7374 6172 7428 295d 202b  match.start()] +
+00021900: 2066 616d 696c 795b 6d61 7463 682e 656e   family[match.en
+00021910: 6428 293a 5d0a 2020 2020 2020 2020 656c  d():].        el
+00021920: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00021930: 7661 6c75 6520 3d20 4e6f 6e65 0a20 2020  value = None.   
+00021940: 2020 2020 2072 6574 7572 6e20 6661 6d69       return fami
+00021950: 6c79 2c20 7661 6c75 650a 0a20 2020 2023  ly, value..    #
+00021960: 2020 2020 636c 6173 7320 4353 5353 7479      class CSSSty
+00021970: 6c65 3a0a 0a20 2020 2064 6566 2063 7265  le:..    def cre
+00021980: 6174 655f 6262 6f78 2873 656c 6629 3a0a  ate_bbox(self):.
+00021990: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+000219a0: 2020 2020 6372 6561 7465 2062 6f75 6e64      create bound
+000219b0: 696e 6720 626f 7820 6672 6f6d 206c 6566  ing box from lef
+000219c0: 742c 2077 6964 7468 2c20 746f 702c 2068  t, width, top, h
+000219d0: 6569 6768 740a 2020 2020 2020 2020 3a72  eight.        :r
+000219e0: 6574 7572 6e3a 204e 6f6e 6520 6966 2061  eturn: None if a
+000219f0: 6e79 2061 7474 7269 6275 7465 7320 6d69  ny attributes mi
+00021a00: 7373 696e 670a 2020 2020 2020 2020 2222  ssing.        ""
+00021a10: 220a 2020 2020 2020 2020 6262 6f78 203d  ".        bbox =
+00021a20: 204e 6f6e 650a 2020 2020 2020 2020 6966   None.        if
+00021a30: 2073 656c 662e 746f 7020 6973 206e 6f74   self.top is not
+00021a40: 204e 6f6e 6520 616e 6420 7365 6c66 2e68   None and self.h
+00021a50: 6569 6768 7420 6973 206e 6f74 204e 6f6e  eight is not Non
+00021a60: 6520 616e 6420 7365 6c66 2e6c 6566 7420  e and self.left 
+00021a70: 6973 206e 6f74 204e 6f6e 6520 616e 6420  is not None and 
+00021a80: 7365 6c66 2e77 6964 7468 2069 7320 6e6f  self.width is no
+00021a90: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+00021aa0: 2020 2020 6262 6f78 203d 2042 426f 7828      bbox = BBox(
+00021ab0: 7879 5f72 616e 6765 733d 5b5b 7365 6c66  xy_ranges=[[self
+00021ac0: 2e6c 6566 742c 2073 656c 662e 6c65 6674  .left, self.left
+00021ad0: 202b 2073 656c 662e 7769 6474 685d 2c20   + self.width], 
+00021ae0: 5b73 656c 662e 746f 702c 2073 656c 662e  [self.top, self.
+00021af0: 746f 7020 2b20 7365 6c66 2e68 6569 6768  top + self.heigh
+00021b00: 745d 5d29 0a20 2020 2020 2020 2072 6574  t]]).        ret
+00021b10: 7572 6e20 6262 6f78 0a0a 2020 2020 2320  urn bbox..    # 
+00021b20: 2020 2063 6c61 7373 2043 5353 5374 796c     class CSSStyl
+00021b30: 653a 0a0a 2020 2020 6465 6620 6578 7472  e:..    def extr
+00021b40: 6163 745f 7375 6273 7479 6c65 7328 7365  act_substyles(se
+00021b50: 6c66 2c20 6373 735f 6e61 6d65 7329 3a0a  lf, css_names):.
+00021b60: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00021b70: 2020 2020 4372 6561 7465 2032 206e 6577      Create 2 new
+00021b80: 2043 5353 5373 7479 6c65 7320 2c20 7468   CSSSstyles , th
+00021b90: 6520 6669 7273 7420 7769 7468 206e 616d  e first with nam
+00021ba0: 6573 2069 6e20 2273 7479 6c65 7322 2061  es in "styles" a
+00021bb0: 6e64 2074 6865 2073 6563 6f6e 6420 7468  nd the second th
+00021bc0: 6520 7265 7374 2e0a 2020 2020 2020 2020  e rest..        
+00021bd0: 2020 2020 6966 204e 6f6e 652c 2072 6574      if None, ret
+00021be0: 7275 6e73 204e 6f6e 652c 4e6f 6e65 0a20  runs None,None. 
+00021bf0: 2020 2020 2020 203a 7061 7261 6d20 6373         :param cs
+00021c00: 735f 6e61 6d65 733a 206c 6973 7420 6f66  s_names: list of
+00021c10: 2043 5353 206e 616d 6573 2028 652e 672e   CSS names (e.g.
+00021c20: 2022 666f 6e74 2d66 616d 696c 7922 292e   "font-family").
+00021c30: 2049 6620 6e61 206e 616d 6520 6e6f 7420   If na name not 
+00021c40: 666f 756e 642c 206e 6f20 6163 7469 6f6e  found, no action
+00021c50: 0a20 2020 2020 2020 203a 7265 7475 726e  .        :return
+00021c60: 2032 2d74 7570 6c65 206f 6620 3129 2043   2-tuple of 1) C
+00021c70: 5353 5374 796c 6520 6f62 6a65 6374 2077  SSStyle object w
+00021c80: 6974 6820 6578 7472 6163 7465 6420 6e61  ith extracted na
+00021c90: 6d65 7320 3229 2043 5353 5374 796c 6520  mes 2) CSSStyle 
+00021ca0: 6f66 2074 6865 2072 656d 6169 6e64 6572  of the remainder
+00021cb0: 3b0a 2020 2020 2020 2020 2020 2020 6569  ;.            ei
+00021cc0: 7468 6572 2f62 6f74 6820 6d61 7920 6265  ther/both may be
+00021cd0: 2065 6d70 7479 2043 5353 5374 796c 652e   empty CSSStyle.
+00021ce0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00021cf0: 2020 2020 2069 6620 6e6f 7420 7365 6c66       if not self
+00021d00: 2e6e 616d 655f 7661 6c75 655f 6469 6374  .name_value_dict
+00021d10: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
+00021d20: 6973 6520 5661 6c75 6545 7272 6f72 2866  ise ValueError(f
+00021d30: 226e 616d 655f 7661 6c75 655f 6469 6374  "name_value_dict
+00021d40: 2069 7320 4e6f 6e65 2229 0a20 2020 2020   is None").     
+00021d50: 2020 2069 6620 6373 735f 6e61 6d65 7320     if css_names 
+00021d60: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+00021d70: 2020 2020 2072 6574 7572 6e20 4e6f 6e65       return None
+00021d80: 2c20 4e6f 6e65 0a20 2020 2020 2020 2063  , None.        c
+00021d90: 7373 5f72 6574 6169 6e65 6420 3d20 636f  ss_retained = co
+00021da0: 7079 2e64 6565 7063 6f70 7928 7365 6c66  py.deepcopy(self
+00021db0: 290a 2020 2020 2020 2020 6373 735f 666f  ).        css_fo
+00021dc0: 756e 6420 3d20 4353 5353 7479 6c65 2829  und = CSSStyle()
+00021dd0: 0a0a 2020 2020 2020 2020 6b65 7973 203d  ..        keys =
+00021de0: 2063 7373 5f72 6574 6169 6e65 642e 6e61   css_retained.na
+00021df0: 6d65 5f76 616c 7565 5f64 6963 742e 6b65  me_value_dict.ke
+00021e00: 7973 2829 0a20 2020 2020 2020 2066 6f72  ys().        for
+00021e10: 206e 616d 6520 696e 2063 7373 5f6e 616d   name in css_nam
+00021e20: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
+00021e30: 6966 206e 616d 6520 696e 2063 7373 5f72  if name in css_r
+00021e40: 6574 6169 6e65 642e 6e61 6d65 5f76 616c  etained.name_val
+00021e50: 7565 5f64 6963 743a 0a20 2020 2020 2020  ue_dict:.       
+00021e60: 2020 2020 2020 2020 2076 616c 7565 203d           value =
+00021e70: 2063 7373 5f72 6574 6169 6e65 642e 6e61   css_retained.na
+00021e80: 6d65 5f76 616c 7565 5f64 6963 742e 706f  me_value_dict.po
+00021e90: 7028 6e61 6d65 290a 2020 2020 2020 2020  p(name).        
+00021ea0: 2020 2020 2020 2020 6966 2076 616c 7565          if value
+00021eb0: 3a20 2023 2074 7261 6e73 6665 7220 6974  :  # transfer it
+00021ec0: 656d 206f 7665 720a 2020 2020 2020 2020  em over.        
+00021ed0: 2020 2020 2020 2020 2020 2020 6373 735f              css_
+00021ee0: 666f 756e 642e 6e61 6d65 5f76 616c 7565  found.name_value
+00021ef0: 5f64 6963 745b 6e61 6d65 5d20 3d20 7661  _dict[name] = va
+00021f00: 6c75 650a 2020 2020 2020 2020 7265 7475  lue.        retu
+00021f10: 726e 2028 6373 735f 666f 756e 642c 2063  rn (css_found, c
+00021f20: 7373 5f72 6574 6169 6e65 6429 0a0a 2020  ss_retained)..  
+00021f30: 2020 2320 2020 2063 6c61 7373 2043 5353    #    class CSS
+00021f40: 5374 796c 653a 0a0a 2020 2020 6465 6620  Style:..    def 
+00021f50: 6372 6561 7465 5f68 746d 6c5f 7374 796c  create_html_styl
+00021f60: 655f 656c 656d 656e 7428 7365 6c66 2c20  e_element(self, 
+00021f70: 6874 6d6c 5f63 6c61 7373 293a 0a20 2020  html_class):.   
+00021f80: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00021f90: 2043 7265 6174 6573 2073 7472 696e 6720   Creates string 
+00021fa0: 666f 7220 4854 4d4c 2073 7479 6c65 0a20  for HTML style. 
+00021fb0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00021fc0: 2020 2044 4f54 203d 2022 2e22 0a20 2020     DOT = ".".   
+00021fd0: 2020 2020 2073 203d 2044 4f54 202b 2068       s = DOT + h
+00021fe0: 746d 6c5f 636c 6173 7320 2b20 2220 2220  tml_class + " " 
+00021ff0: 2b20 7365 6c66 2e67 6574 5f63 7373 5f76  + self.get_css_v
+00022000: 616c 7565 2877 7261 705f 7769 7468 5f63  alue(wrap_with_c
+00022010: 7572 6c79 3d54 7275 6529 0a20 2020 2020  urly=True).     
+00022020: 2020 2065 6c65 6d20 3d20 4554 2e45 6c65     elem = ET.Ele
+00022030: 6d65 6e74 2843 5353 5374 796c 652e 5354  ment(CSSStyle.ST
+00022040: 594c 4529 0a20 2020 2020 2020 2065 6c65  YLE).        ele
+00022050: 6d2e 7465 7874 203d 2073 0a20 2020 2020  m.text = s.     
+00022060: 2020 2072 6574 7572 6e20 656c 656d 0a0a     return elem..
+00022070: 2020 2020 2320 2020 2063 6c61 7373 2043      #    class C
+00022080: 5353 5374 796c 653a 0a0a 2020 2020 6465  SSStyle:..    de
+00022090: 6620 6578 7472 6163 745f 7465 7874 5f73  f extract_text_s
+000220a0: 7479 6c65 7328 7365 6c66 293a 0a20 2020  tyles(self):.   
+000220b0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+000220c0: 2065 7874 7261 6374 2074 6578 7420 636f   extract text co
+000220d0: 6d70 6f6e 656e 7473 2066 726f 6d20 7374  mponents from st
+000220e0: 796c 6520 2866 6f6e 742d 2a2c 2063 6f6c  yle (font-*, col
+000220f0: 6f72 2c20 6574 6329 2069 6e74 6f20 6e65  or, etc) into ne
+00022100: 7720 7374 796c 652c 2072 6574 7572 6e69  w style, returni
+00022110: 6e67 2074 7570 6c65 206f 660a 2020 2020  ng tuple of.    
+00022120: 2020 2020 6e65 7720 7374 796c 6520 616e      new style an
+00022130: 6420 7374 796c 6520 6672 6f6d 2072 656d  d style from rem
+00022140: 6169 6e69 6e67 2063 6f6d 706f 6e65 6e74  aining component
+00022150: 730a 2020 2020 2020 2020 2222 220a 2020  s.        """.  
+00022160: 2020 2020 2020 2865 7874 7261 6374 6564        (extracted
+00022170: 5f73 7479 6c65 2c20 7265 7461 696e 6564  _style, retained
+00022180: 2920 3d20 666f 6e74 5f73 7479 6c65 2c20  ) = font_style, 
+00022190: 7265 7374 5f73 7479 6c65 203d 2073 656c  rest_style = sel
+000221a0: 662e 6578 7472 6163 745f 7375 6273 7479  f.extract_substy
+000221b0: 6c65 7328 0a20 2020 2020 2020 2020 2020  les(.           
+000221c0: 2043 5353 5374 796c 652e 5445 5854 5f53   CSSStyle.TEXT_S
+000221d0: 5459 4c45 5f43 4f4d 504f 4e45 4e54 530a  TYLE_COMPONENTS.
+000221e0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+000221f0: 2020 7265 7475 726e 2028 6578 7472 6163    return (extrac
+00022200: 7465 645f 7374 796c 652c 2072 6574 6169  ted_style, retai
+00022210: 6e65 6429 0a0a 2020 2020 2320 2020 2063  ned)..    #    c
+00022220: 6c61 7373 2043 5353 5374 796c 653a 0a0a  lass CSSStyle:..
+00022230: 2020 2020 6465 6620 6578 7472 6163 745f      def extract_
+00022240: 7465 7874 5f73 7479 6c65 735f 696e 746f  text_styles_into
+00022250: 5f63 6c61 7373 2873 656c 662c 2063 6c61  _class(self, cla
+00022260: 7373 5f6e 616d 652c 206f 6c64 5f63 6c61  ss_name, old_cla
+00022270: 7373 7374 723d 2222 293a 0a20 2020 2020  ssstr=""):.     
+00022280: 2020 2022 2222 0a20 2020 2020 2020 2065     """.        e
+00022290: 7874 7261 6374 7320 7465 7874 2063 6c61  xtracts text cla
+000222a0: 7373 206e 616d 652d 7661 6c75 6520 696e  ss name-value in
+000222b0: 746f 206e 6577 2043 5353 5374 796c 652c  to new CSSStyle,
+000222c0: 2061 6e64 2063 7265 6174 6573 2075 7064   and creates upd
+000222d0: 6174 6564 2063 6c61 7373 5f73 7472 696e  ated class_strin
+000222e0: 670a 2020 2020 2020 2020 4578 616d 706c  g.        Exampl
+000222f0: 653a 0a20 2020 2020 2020 2020 2020 2065  e:.            e
+00022300: 6c65 6d65 6e74 2068 6173 2073 7479 6c65  lement has style
+00022310: 2061 7474 7269 6275 7465 2077 6974 6820   attribute with 
+00022320: 7365 7665 7261 6c20 7465 7874 2063 6f6d  several text com
+00022330: 706f 6e65 6e74 7320 2865 2e67 2e20 666f  ponents (e.g. fo
+00022340: 6e74 2d77 6569 6768 742c 2066 6f6e 742d  nt-weight, font-
+00022350: 7369 7a65 290a 2020 2020 2020 2020 2020  size).          
+00022360: 2020 5468 6973 2063 7265 6174 6573 2061    This creates a
+00022370: 206e 6577 203c 7374 796c 653e 2045 6c65   new <style> Ele
+00022380: 6d65 6e74 2028 6578 7472 6163 7465 6429  ment (extracted)
+00022390: 2077 6974 6820 6a75 7374 2074 6865 7365   with just these
+000223a0: 2063 6f6d 706f 6e65 6e74 730a 2020 2020   components.    
+000223b0: 2020 2020 2020 2020 2020 2020 616e 6420              and 
+000223c0: 7075 7473 2074 6865 2075 6e65 7874 7261  puts the unextra
+000223d0: 6374 6564 2073 7479 6c65 2063 6f6d 706f  cted style compo
+000223e0: 6e65 656e 7473 2069 6e74 6f20 6e65 7720  neents into new 
+000223f0: 7374 796c 6520 7370 6163 652d 7365 7061  style space-sepa
+00022400: 7261 7465 6420 7374 7269 6e67 2028 7265  rated string (re
+00022410: 6d61 696e 6e65 6429 0a20 2020 2020 2020  mainned).       
+00022420: 2020 2020 2049 7420 7573 6573 2074 6865       It uses the
+00022430: 2063 6c61 7373 5f6e 616d 6520 746f 2075   class_name to u
+00022440: 7064 6174 6520 7468 6520 6f6c 645f 636c  pdate the old_cl
+00022450: 6173 7373 7472 2073 7472 696e 670a 2020  assstr string.  
+00022460: 2020 2020 2020 2020 2020 2020 2020 652e                e.
+00022470: 672e 2063 6c61 7373 5f6e 616d 653d 2273  g. class_name="s
+00022480: 3122 2061 6e64 206f 6c64 5f63 6c61 7373  1" and old_class
+00022490: 7374 723d 2266 6f6f 2062 6172 2220 3d3e  str="foo bar" =>
+000224a0: 2022 666f 6f20 6261 7220 7331 220a 2020   "foo bar s1".  
+000224b0: 2020 2020 2020 3a70 6172 616d 2063 6c61        :param cla
+000224c0: 7373 5f6e 616d 653a 206e 616d 6520 6f69  ss_name: name oi
+000224d0: 6620 6e65 7720 636c 6173 7320 2861 7574  f new class (aut
+000224e0: 686f 7220 6d75 7374 2065 6e73 7572 6520  hor must ensure 
+000224f0: 756e 6971 7565 6e65 7373 290a 2020 2020  uniqueness).    
+00022500: 2020 2020 3a70 6172 616d 206f 6c64 5f63      :param old_c
+00022510: 6c61 7373 7374 723a 206f 6c64 2063 6c61  lassstr: old cla
+00022520: 7373 6e61 6d65 2028 6465 6661 756c 7473  ssname (defaults
+00022530: 2074 6f20 2222 290a 2020 2020 2020 2020   to "").        
+00022540: 3a72 6574 7572 6e3a 2033 2d74 7570 6c65  :return: 3-tuple
+00022550: 206f 6620 2865 7874 7261 6374 6564 5f73   of (extracted_s
+00022560: 7479 6c65 5f65 6c65 6d65 6e74 2c20 7265  tyle_element, re
+00022570: 7461 696e 6564 5f73 7479 6c65 5f73 7472  tained_style_str
+00022580: 696e 672c 206e 6577 2063 6c61 7373 735f  ing, new classs_
+00022590: 7374 7269 6e67 290a 2020 2020 2020 2020  string).        
+000225a0: 2222 220a 2020 2020 2020 2020 6578 7472  """.        extr
+000225b0: 6163 7465 645f 7374 796c 652c 2072 6574  acted_style, ret
+000225c0: 6169 6e65 645f 7374 796c 6520 3d20 7365  ained_style = se
+000225d0: 6c66 2e65 7874 7261 6374 5f74 6578 745f  lf.extract_text_
+000225e0: 7374 796c 6573 2829 0a0a 2020 2020 2020  styles()..      
+000225f0: 2020 6966 206e 6f74 2065 7874 7261 6374    if not extract
+00022600: 6564 5f73 7479 6c65 3a0a 2020 2020 2020  ed_style:.      
+00022610: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
+00022620: 6545 7272 6f72 2822 6578 7472 6163 7465  eError("extracte
+00022630: 6420 7374 796c 6520 6973 204e 6f6e 6522  d style is None"
+00022640: 290a 2020 2020 2020 2020 6578 7472 6163  ).        extrac
+00022650: 7465 645f 7374 796c 6531 203d 2043 5353  ted_style1 = CSS
+00022660: 5374 796c 652e 6578 7472 6163 745f 626f  Style.extract_bo
+00022670: 6c64 5f69 7461 6c69 635f 6672 6f6d 5f66  ld_italic_from_f
+00022680: 6f6e 745f 6661 6d69 6c79 5f66 6f72 5f73  ont_family_for_s
+00022690: 7479 6c65 280a 2020 2020 2020 2020 2020  tyle(.          
+000226a0: 2020 6578 7472 6163 7465 645f 7374 796c    extracted_styl
+000226b0: 6529 2069 6620 6578 7472 6163 7465 645f  e) if extracted_
+000226c0: 7374 796c 6520 656c 7365 204e 6f6e 650a  style else None.
+000226d0: 2020 2020 2020 2020 6578 7472 6163 7465          extracte
+000226e0: 645f 6874 6d6c 5f73 7479 6c65 5f65 6c65  d_html_style_ele
+000226f0: 6d65 6e74 203d 2065 7874 7261 6374 6564  ment = extracted
+00022700: 5f73 7479 6c65 312e 6372 6561 7465 5f68  _style1.create_h
+00022710: 746d 6c5f 7374 796c 655f 656c 656d 656e  tml_style_elemen
+00022720: 7428 0a20 2020 2020 2020 2020 2020 2063  t(.            c
+00022730: 6c61 7373 5f6e 616d 6529 2069 6620 6578  lass_name) if ex
+00022740: 7472 6163 7465 645f 7374 796c 6531 2069  tracted_style1 i
+00022750: 7320 6e6f 7420 4e6f 6e65 2065 6c73 6520  s not None else 
+00022760: 4e6f 6e65 0a0a 2020 2020 2020 2020 7265  None..        re
+00022770: 7461 696e 6564 5f73 7479 6c65 5f61 7474  tained_style_att
+00022780: 7661 6c20 3d20 7265 7461 696e 6564 5f73  val = retained_s
+00022790: 7479 6c65 2e67 6574 5f63 7373 5f76 616c  tyle.get_css_val
+000227a0: 7565 2829 2069 6620 7265 7461 696e 6564  ue() if retained
+000227b0: 5f73 7479 6c65 2065 6c73 6520 4e6f 6e65  _style else None
+000227c0: 0a20 2020 2020 2020 2068 746d 6c5f 636c  .        html_cl
+000227d0: 6173 735f 7661 6c20 3d20 4353 5353 7479  ass_val = CSSSty
+000227e0: 6c65 2e63 7265 6174 655f 6874 6d6c 5f63  le.create_html_c
+000227f0: 6c61 7373 5f76 616c 2863 6c61 7373 5f6e  lass_val(class_n
+00022800: 616d 652c 206f 6c64 5f63 6c61 7373 5f76  ame, old_class_v
+00022810: 616c 3d6f 6c64 5f63 6c61 7373 7374 7229  al=old_classstr)
+00022820: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00022830: 6578 7472 6163 7465 645f 6874 6d6c 5f73  extracted_html_s
+00022840: 7479 6c65 5f65 6c65 6d65 6e74 2c20 7265  tyle_element, re
+00022850: 7461 696e 6564 5f73 7479 6c65 5f61 7474  tained_style_att
+00022860: 7661 6c2c 2068 746d 6c5f 636c 6173 735f  val, html_class_
+00022870: 7661 6c0a 0a20 2020 2023 2020 2020 636c  val..    #    cl
+00022880: 6173 7320 4353 5353 7479 6c65 3a0a 0a20  ass CSSStyle:.. 
+00022890: 2020 2040 636c 6173 736d 6574 686f 640a     @classmethod.
+000228a0: 2020 2020 6465 6620 6372 6561 7465 5f68      def create_h
+000228b0: 746d 6c5f 636c 6173 735f 7661 6c28 636c  tml_class_val(cl
+000228c0: 732c 206e 6577 5f63 6c61 7373 2c20 6f6c  s, new_class, ol
+000228d0: 645f 636c 6173 735f 7661 6c3d 4e6f 6e65  d_class_val=None
+000228e0: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
+000228f0: 2020 2020 2020 2063 7265 6174 6573 206f         creates o
+00022900: 7220 6564 6974 7320 6120 636c 6173 7320  r edits a class 
+00022910: 7374 7269 6e67 2074 6f20 6163 6365 7074  string to accept
+00022920: 2061 206e 6577 2076 616c 7565 0a20 2020   a new value.   
+00022930: 2020 2020 206e 6f2d 6f70 2069 6620 6e65       no-op if ne
+00022940: 775f 636c 6173 7320 6973 2061 6c72 6561  w_class is alrea
+00022950: 6479 2069 6e20 6f6c 645f 636c 6173 735f  dy in old_class_
+00022960: 7661 6c0a 2020 2020 2020 2020 652e 672e  val.        e.g.
+00022970: 204e 6f6e 6520 2b20 2266 6f6f 2220 3d3e   None + "foo" =>
+00022980: 2022 666f 6f22 0a20 2020 2020 2020 2022   "foo".        "
+00022990: 666f 6f22 202b 2022 6261 7220 706c 7567  foo" + "bar plug
+000229a0: 6822 203d 3e20 2262 6172 2070 6c75 6768  h" => "bar plugh
+000229b0: 2066 6f6f 220a 2020 2020 2020 2020 2266   foo".        "f
+000229c0: 6f6f 2220 2b20 2262 6172 2066 6f6f 2070  oo" + "bar foo p
+000229d0: 6c75 6768 2220 3d3e 2022 6261 7220 666f  lugh" => "bar fo
+000229e0: 6f20 706c 7567 6822 0a20 2020 2020 2020  o plugh".       
+000229f0: 203a 7061 7261 6d20 6e65 775f 636c 6173   :param new_clas
+00022a00: 733a 2063 6c61 7373 2074 6f20 6164 640a  s: class to add.
+00022a10: 2020 2020 2020 2020 3a70 6172 616d 206f          :param o
+00022a20: 6c64 5f63 6c61 7373 5f76 616c 3a20 7370  ld_class_val: sp
+00022a30: 6163 652d 7365 7061 7261 7465 6420 6c69  ace-separated li
+00022a40: 7374 206f 6620 6578 6973 7469 6e67 2063  st of existing c
+00022a50: 6c61 7373 6573 0a20 2020 2020 2020 203a  lasses.        :
+00022a60: 7265 7475 726e 3a20 6e65 7720 636c 6173  return: new clas
+00022a70: 7320 7374 7269 6e67 0a20 2020 2020 2020  s string.       
+00022a80: 2022 2222 0a20 2020 2020 2020 206f 6c64   """.        old
+00022a90: 5f63 6c61 7373 6573 203d 205b 5d20 6966  _classes = [] if
+00022aa0: 206e 6f74 206f 6c64 5f63 6c61 7373 5f76   not old_class_v
+00022ab0: 616c 2065 6c73 6520 6f6c 645f 636c 6173  al else old_clas
+00022ac0: 735f 7661 6c2e 7370 6c69 7428 290a 2020  s_val.split().  
+00022ad0: 2020 2020 2020 6966 206e 6577 5f63 6c61        if new_cla
+00022ae0: 7373 206e 6f74 2069 6e20 6f6c 645f 636c  ss not in old_cl
+00022af0: 6173 7365 733a 0a20 2020 2020 2020 2020  asses:.         
+00022b00: 2020 206f 6c64 5f63 6c61 7373 6573 2e61     old_classes.a
+00022b10: 7070 656e 6428 6e65 775f 636c 6173 7329  ppend(new_class)
+00022b20: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00022b30: 5574 696c 2e63 7265 6174 655f 7374 7269  Util.create_stri
+00022b40: 6e67 5f73 6570 6172 6174 6564 5f6c 6973  ng_separated_lis
+00022b50: 7428 6f6c 645f 636c 6173 7365 7329 0a0a  t(old_classes)..
+00022b60: 2020 2020 2320 2020 2063 6c61 7373 2043      #    class C
+00022b70: 5353 5374 796c 653a 0a0a 2020 2020 4063  SSStyle:..    @c
+00022b80: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
+00022b90: 6566 2063 7265 6174 655f 7374 796c 655f  ef create_style_
+00022ba0: 6469 6374 5f66 726f 6d5f 7374 796c 6573  dict_from_styles
+00022bb0: 2863 6c73 2c20 7374 796c 655f 656c 656d  (cls, style_elem
+00022bc0: 733d 4e6f 6e65 2c20 7661 6c69 6461 7465  s=None, validate
+00022bd0: 3d54 7275 6529 3a0a 2020 2020 2020 2020  =True):.        
+00022be0: 2222 220a 2020 2020 2020 2020 636f 6e76  """.        conv
+00022bf0: 6572 7420 6c69 7374 206f 6620 4353 5353  ert list of CSSS
+00022c00: 7479 6c65 7320 2861 7320 4854 4d4c 2073  tyles (as HTML s
+00022c10: 7472 696e 6773 2920 746f 2064 6963 740a  trings) to dict.
+00022c20: 2020 2020 2020 2020 6966 2064 7570 6c69          if dupli
+00022c30: 6361 7465 2073 7479 6c65 7265 6673 2072  cate stylerefs r
+00022c40: 6169 7365 2045 7863 6570 7469 6f6e 2069  aise Exception i
+00022c50: 6620 7661 6c69 6461 7465 2065 6c73 6520  f validate else 
+00022c60: 7461 6b65 2066 6972 7374 0a20 2020 2020  take first.     
+00022c70: 2020 2054 7970 6963 616c 2073 7479 6c65     Typical style
+00022c80: 3a0a 2020 2020 2020 2020 3c73 7479 6c65  :.        <style
+00022c90: 202e 2e2e 3e2e 7330 207b 666f 6e74 2d73   ...>.s0 {font-s
+00022ca0: 697a 653a 2031 342e 7078 3b7d 3c2f 7374  ize: 14.px;}</st
+00022cb0: 796c 653e 0a20 2020 2020 2020 203a 7061  yle>.        :pa
+00022cc0: 7261 6d20 7374 796c 655f 656c 656d 733a  ram style_elems:
+00022cd0: 206c 6973 7420 6f66 206c 786d 6c20 5f45   list of lxml _E
+00022ce0: 6c65 6d65 6e74 730a 2020 2020 2020 2020  lements.        
+00022cf0: 3a70 6172 616d 2076 616c 6964 6174 653a  :param validate:
+00022d00: 2063 6865 636b 2077 6865 7468 6572 2043   check whether C
+00022d10: 5353 2076 616c 7565 2069 7320 636f 6e66  SS value is conf
+00022d20: 6f72 6d61 6e74 206f 7220 6475 706c 6963  ormant or duplic
+00022d30: 6174 6520 7374 796c 655f 7265 6673 0a20  ate style_refs. 
+00022d40: 2020 2020 2020 203a 7265 7475 726e 3a20         :return: 
+00022d50: 6469 6374 206f 6620 666f 726d 2072 6566  dict of form ref
+00022d60: 3a20 7374 796c 650a 2020 2020 2020 2020  : style.        
+00022d70: 3a65 7863 6570 743a 2049 6620 656c 656d  :except: If elem
+00022d80: 656e 7420 6861 7320 7772 6f6e 6720 7379  ent has wrong sy
+00022d90: 6e74 6178 3b20 6966 2063 7373 2066 6965  ntax; if css fie
+00022da0: 726c 6420 6973 206d 616c 666f 746d 6564  rld is malfotmed
+00022db0: 3b20 6966 2072 6566 2069 7320 6475 706c  ; if ref is dupl
+00022dc0: 6963 6174 6564 0a20 2020 2020 2020 2022  icated.        "
+00022dd0: 2222 0a20 2020 2020 2020 2063 7373 5f72  "".        css_r
+00022de0: 6520 3d20 7265 2e63 6f6d 7069 6c65 2822  e = re.compile("
+00022df0: 5c5c 732a 285c 5c2e 2e2a 295c 5c73 2b7b  \\s*(\\..*)\\s+{
+00022e00: 282e 2a29 7d5c 5c73 2a22 290a 2020 2020  (.*)}\\s*").    
+00022e10: 2020 2020 6966 2073 7479 6c65 5f65 6c65      if style_ele
+00022e20: 6d73 2069 7320 4e6f 6e65 3a0a 2020 2020  ms is None:.    
+00022e30: 2020 2020 2020 2020 7374 796c 6573 203d          styles =
+00022e40: 205b 5d0a 2020 2020 2020 2020 7374 796c   [].        styl
+00022e50: 655f 6469 6374 203d 2064 6963 7428 290a  e_dict = dict().
+00022e60: 2020 2020 2020 2020 666f 7220 7374 796c          for styl
+00022e70: 655f 656c 656d 2069 6e20 7374 796c 655f  e_elem in style_
+00022e80: 656c 656d 733a 0a20 2020 2020 2020 2020  elems:.         
+00022e90: 2020 2073 7479 6c65 5f74 6578 7420 3d20     style_text = 
+00022ea0: 7374 796c 655f 656c 656d 2e74 6578 742e  style_elem.text.
+00022eb0: 7374 7269 7028 290a 2020 2020 2020 2020  strip().        
+00022ec0: 2020 2020 6d61 7463 6820 3d20 6373 735f      match = css_
+00022ed0: 7265 2e6d 6174 6368 2873 7479 6c65 5f74  re.match(style_t
+00022ee0: 6578 7429 0a20 2020 2020 2020 2020 2020  ext).           
+00022ef0: 2069 6620 6e6f 7420 6d61 7463 683a 0a20   if not match:. 
+00022f00: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00022f10: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
+00022f20: 6622 4241 4420 6865 6164 5f73 7479 6c65  f"BAD head_style
+00022f30: 207b 7374 796c 655f 7465 7874 7d22 290a   {style_text}").
+00022f40: 2020 2020 2020 2020 2020 2020 7265 6620              ref 
+00022f50: 3d20 6d61 7463 682e 6772 6f75 7028 3129  = match.group(1)
+00022f60: 0a20 2020 2020 2020 2020 2020 2063 7373  .            css
+00022f70: 5f73 7472 696e 6720 3d20 6d61 7463 682e  _string = match.
+00022f80: 6772 6f75 7028 3229 0a20 2020 2020 2020  group(2).       
+00022f90: 2020 2020 2069 6620 6373 735f 7374 7269       if css_stri
+00022fa0: 6e67 203d 3d20 2222 3a0a 2020 2020 2020  ng == "":.      
+00022fb0: 2020 2020 2020 2020 2020 2320 7468 6973            # this
+00022fc0: 206f 6363 7572 7320 7768 656e 2074 6865   occurs when the
+00022fd0: 2073 7479 6c65 2061 7474 7269 6275 7465   style attribute
+00022fe0: 7320 6172 6520 706f 7369 7469 6f6e 616c  s are positional
+00022ff0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00023000: 2063 6f6e 7469 6e75 650a 2020 2020 2020   continue.      
+00023010: 2020 2020 2020 6966 2076 616c 6964 6174        if validat
+00023020: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00023030: 2020 2063 7373 5f73 7479 6c65 203d 2043     css_style = C
+00023040: 5353 5374 796c 652e 6372 6561 7465 5f63  SSStyle.create_c
+00023050: 7373 5f73 7479 6c65 5f66 726f 6d5f 6373  ss_style_from_cs
+00023060: 735f 7374 7269 6e67 2863 7373 5f73 7472  s_string(css_str
+00023070: 696e 6729 0a20 2020 2020 2020 2020 2020  ing).           
+00023080: 2020 2020 2069 6620 6373 735f 7374 796c       if css_styl
+00023090: 6520 6973 204e 6f6e 653a 0a20 2020 2020  e is None:.     
+000230a0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+000230b0: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
+000230c0: 6622 6261 6420 4353 5353 7479 6c65 207b  f"bad CSSStyle {
+000230d0: 6373 735f 7374 796c 657d 2229 0a20 2020  css_style}").   
+000230e0: 2020 2020 2020 2020 2069 6620 7265 6620           if ref 
+000230f0: 696e 2073 7479 6c65 5f64 6963 743a 0a20  in style_dict:. 
+00023100: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00023110: 6620 7661 6c69 6461 7465 3a0a 2020 2020  f validate:.    
+00023120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023130: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
+00023140: 2866 2264 7570 6c69 6361 7465 2073 7479  (f"duplicate sty
+00023150: 6c65 2072 6566 207b 7374 796c 655f 7465  le ref {style_te
+00023160: 7874 7d22 290a 2020 2020 2020 2020 2020  xt}").          
+00023170: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00023180: 2020 2020 2020 2020 7374 796c 655f 6469          style_di
+00023190: 6374 5b72 6566 5d20 3d20 6373 735f 7374  ct[ref] = css_st
+000231a0: 7269 6e67 0a20 2020 2020 2020 2072 6574  ring.        ret
+000231b0: 7572 6e20 7374 796c 655f 6469 6374 0a0a  urn style_dict..
+000231c0: 2020 2020 2320 2020 2063 6c61 7373 2043      #    class C
+000231d0: 5353 5374 796c 653a 0a0a 2020 2020 4063  SSStyle:..    @c
+000231e0: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
+000231f0: 6566 2065 7874 7261 6374 5f73 7479 6c65  ef extract_style
+00023200: 735f 6672 6f6d 5f68 746d 6c5f 7374 7269  s_from_html_stri
+00023210: 6e67 2863 6c73 2c20 6874 6d6c 5f73 7472  ng(cls, html_str
+00023220: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
+00023230: 2020 2020 2020 2065 7874 7261 6374 2073         extract s
+00023240: 7479 6c65 7320 6672 6f6d 2068 6561 6420  tyles from head 
+00023250: 6f66 2068 746d 6c20 6669 6c65 0a20 2020  of html file.   
+00023260: 2020 2020 203a 7061 7261 6d20 6874 6d6c       :param html
+00023270: 5f73 7472 3a20 7374 7269 6e67 206f 6620  _str: string of 
+00023280: 666f 726d 203c 6874 6d6c 3e3c 6865 6164  form <html><head
+00023290: 3e3c 7374 796c 6520 2e2e 2e3e 3c2f 7374  ><style ...></st
+000232a0: 796c 653e 3c73 7479 6c65 202e 2e2e 3e3c  yle><style ...><
+000232b0: 2f73 7479 6c65 3e3c 2f68 6561 643e 202e  /style></head> .
+000232c0: 2e2e 203c 2f68 746d 6c3e 0a20 2020 2020  .. </html>.     
+000232d0: 2020 203a 7265 7475 726e 3a20 6c69 7374     :return: list
+000232e0: 206f 6620 5f45 6c65 6d65 6e74 7320 283c   of _Elements (<
+000232f0: 7374 796c 652e 2e2e 3e20 2e2e 2e3c 2f73  style...> ...</s
+00023300: 7479 6c65 3e29 206f 7220 5b5d 0a20 2020  tyle>) or [].   
+00023310: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00023320: 2072 6574 7572 6e20 636c 732e 6578 7472   return cls.extr
+00023330: 6163 745f 7374 796c 6573 5f66 726f 6d5f  act_styles_from_
+00023340: 6874 6d6c 5f68 6561 645f 656c 656d 656e  html_head_elemen
+00023350: 7428 4554 2e66 726f 6d73 7472 696e 6728  t(ET.fromstring(
+00023360: 6874 6d6c 5f73 7472 2929 0a0a 2020 2020  html_str))..    
+00023370: 2320 2020 2063 6c61 7373 2043 5353 5374  #    class CSSSt
+00023380: 796c 653a 0a0a 2020 2020 4063 6c61 7373  yle:..    @class
+00023390: 6d65 7468 6f64 0a20 2020 2064 6566 2065  method.    def e
+000233a0: 7874 7261 6374 5f73 7479 6c65 735f 6672  xtract_styles_fr
+000233b0: 6f6d 5f68 746d 6c5f 6865 6164 5f65 6c65  om_html_head_ele
+000233c0: 6d65 6e74 2863 6c73 2c20 6874 6d6c 5f65  ment(cls, html_e
+000233d0: 6c65 6d29 3a0a 2020 2020 2020 2020 2222  lem):.        ""
+000233e0: 220a 2020 2020 2020 2020 6578 7472 6163  ".        extrac
+000233f0: 7420 7374 796c 6573 2066 726f 6d20 6865  t styles from he
+00023400: 6164 206f 6620 6874 6d6c 2066 696c 650a  ad of html file.
+00023410: 2020 2020 2020 2020 3a70 6172 616d 2068          :param h
+00023420: 746d 6c5f 656c 656d 3a20 656c 656d 656e  tml_elem: elemen
+00023430: 7420 6f66 2066 6f72 6d20 3c68 746d 6c3e  t of form <html>
+00023440: 3c68 6561 643e 3c73 7479 6c65 202e 2e2e  <head><style ...
+00023450: 3e3c 2f73 7479 6c65 3e3c 7374 796c 6520  ></style><style 
+00023460: 2e2e 2e3e 3c2f 7374 796c 653e 3c2f 6865  ...></style></he
+00023470: 6164 3e20 2e2e 2e20 3c2f 6874 6d6c 3e0a  ad> ... </html>.
+00023480: 2020 2020 2020 2020 3a72 6574 7572 6e3a          :return:
+00023490: 206c 6973 7420 6f66 205f 456c 656d 656e   list of _Elemen
+000234a0: 7473 2028 3c73 7479 6c65 2e2e 2e3e 202e  ts (<style...> .
+000234b0: 2e2e 3c2f 7374 796c 653e 2920 6f72 205b  ..</style>) or [
+000234c0: 5d0a 2020 2020 2020 2020 2222 220a 2020  ].        """.  
+000234d0: 2020 2020 2020 7265 7475 726e 205b 5d20        return [] 
+000234e0: 6966 2068 746d 6c5f 656c 656d 2069 7320  if html_elem is 
+000234f0: 4e6f 6e65 2065 6c73 6520 6874 6d6c 5f65  None else html_e
+00023500: 6c65 6d2e 7870 6174 6828 5354 594c 455f  lem.xpath(STYLE_
+00023510: 5850 4154 4829 0a0a 2020 2020 4063 6c61  XPATH)..    @cla
+00023520: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
+00023530: 2063 7265 6174 655f 6373 735f 7374 796c   create_css_styl
+00023540: 655f 6672 6f6d 5f68 746d 6c5f 6865 6164  e_from_html_head
+00023550: 5f73 7479 6c65 5f65 6c65 6d28 636c 732c  _style_elem(cls,
+00023560: 2073 7479 6c65 5f65 6c65 6d29 3a0a 2020   style_elem):.  
+00023570: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00023580: 2020 6578 7472 6163 7473 2043 5353 5374    extracts CSSSt
+00023590: 796c 6520 656c 656d 6e74 2066 726f 6d20  yle elemnt from 
+000235a0: 4854 4d4c 203c 7374 796c 653e 2e66 6f6f  HTML <style>.foo
+000235b0: 207b 613a 623b 2063 3a64 3b7d 2065 6c65   {a:b; c:d;} ele
+000235c0: 6d65 6e74 0a20 2020 2020 2020 203a 7061  ment.        :pa
+000235d0: 7261 6d20 7374 796c 655f 656c 656d 3a0a  ram style_elem:.
+000235e0: 2020 2020 2020 2020 3a72 6574 7572 6e3a          :return:
+000235f0: 2074 7570 6c65 2873 796d 626f 6c20 7265   tuple(symbol re
+00023600: 662c 206e 6577 2043 5353 5374 796c 6529  f, new CSSStyle)
+00023610: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00023620: 2020 2020 2073 7479 6c65 5f72 6520 3d20       style_re = 
+00023630: 7265 2e63 6f6d 7069 6c65 2822 5c5c 732a  re.compile("\\s*
+00023640: 285b 5e5c 5c73 5d2a 295c 5c73 2b7b 282e  ([^\\s]*)\\s+{(.
+00023650: 2a29 7d5c 5c73 2a22 290a 2020 2020 2020  *)}\\s*").      
+00023660: 2020 7379 6d62 6f6c 5f72 6566 203d 204e    symbol_ref = N
+00023670: 6f6e 650a 2020 2020 2020 2020 6373 735f  one.        css_
+00023680: 7374 796c 655f 6f62 6a20 3d20 4e6f 6e65  style_obj = None
+00023690: 0a20 2020 2020 2020 2069 6620 7479 7065  .        if type
+000236a0: 2873 7479 6c65 5f65 6c65 6d29 2069 7320  (style_elem) is 
+000236b0: 5f45 6c65 6d65 6e74 3a0a 2020 2020 2020  _Element:.      
+000236c0: 2020 2020 2020 7465 7874 203d 2058 6d6c        text = Xml
+000236d0: 4c69 622e 6765 745f 7465 7874 2873 7479  Lib.get_text(sty
+000236e0: 6c65 5f65 6c65 6d29 0a20 2020 2020 2020  le_elem).       
+000236f0: 2020 2020 206d 6174 6368 203d 2073 7479       match = sty
+00023700: 6c65 5f72 652e 6d61 7463 6828 7465 7874  le_re.match(text
+00023710: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+00023720: 206d 6174 6368 3a0a 2020 2020 2020 2020   match:.        
+00023730: 2020 2020 2020 2020 7379 6d62 6f6c 5f72          symbol_r
+00023740: 6566 203d 206d 6174 6368 2e67 726f 7570  ef = match.group
+00023750: 2831 290a 2020 2020 2020 2020 2020 2020  (1).            
+00023760: 2020 2020 6373 735f 7374 796c 655f 6f62      css_style_ob
+00023770: 6a20 3d20 4353 5353 7479 6c65 2e63 7265  j = CSSStyle.cre
+00023780: 6174 655f 6373 735f 7374 796c 655f 6672  ate_css_style_fr
+00023790: 6f6d 5f63 7373 5f73 7472 696e 6728 6d61  om_css_string(ma
+000237a0: 7463 682e 6772 6f75 7028 3229 290a 2020  tch.group(2)).  
+000237b0: 2020 2020 2020 7265 7475 726e 2073 796d        return sym
+000237c0: 626f 6c5f 7265 662c 2063 7373 5f73 7479  bol_ref, css_sty
+000237d0: 6c65 5f6f 626a 0a0a 2020 2020 4063 6c61  le_obj..    @cla
+000237e0: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
+000237f0: 2072 6570 6c61 6365 5f63 7373 5f73 7479   replace_css_sty
+00023800: 6c65 5f6e 616d 655f 7661 6c75 6573 5f77  le_name_values_w
+00023810: 6974 685f 6e6f 726d 616c 697a 6564 5f66  ith_normalized_f
+00023820: 6f6e 7428 636c 732c 2073 7479 6c65 5f65  ont(cls, style_e
+00023830: 6c65 6d29 3a0a 2020 2020 2020 2020 2222  lem):.        ""
+00023840: 220a 2020 2020 2020 2020 6966 2073 7479  ".        if sty
+00023850: 6c65 5f65 6c65 6d20 636f 6e74 6169 6e73  le_elem contains
+00023860: 2061 2066 6f6e 7420 696e 2074 6865 2043   a font in the C
+00023870: 5353 2076 616c 7565 732c 206e 6f72 6d61  SS values, norma
+00023880: 6c69 7a65 7320 6974 2069 6620 706f 7373  lizes it if poss
+00023890: 6962 6c65 0a20 2020 2020 2020 2028 652e  ible.        (e.
+000238a0: 672e 2066 6f6e 742d 6661 6d69 6c79 3a20  g. font-family: 
+000238b0: 4172 6961 6c42 6f6c 643b 203d 3e20 666f  ArialBold; => fo
+000238c0: 6e74 2d66 616d 696c 793a 4172 6961 6c3b  nt-family:Arial;
+000238d0: 2066 6f6e 742d 7765 6967 6874 3a20 626f   font-weight: bo
+000238e0: 6c64 3b0a 2020 2020 2020 2020 6564 6974  ld;.        edit
+000238f0: 7320 7468 6520 7374 796c 655f 656c 656d  s the style_elem
+00023900: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+00023910: 7374 796c 655f 656c 656d 3a20 656c 656d  style_elem: elem
+00023920: 656e 7420 746f 2062 6520 6564 6974 6564  ent to be edited
+00023930: 2028 4e4f 5420 636f 7069 6564 290a 2020   (NOT copied).  
+00023940: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00023950: 2020 7379 6d62 6f6c 5f72 6566 2c20 6e65    symbol_ref, ne
+00023960: 775f 6373 7373 7479 6c65 203d 2041 6d69  w_cssstyle = Ami
+00023970: 466f 6e74 2e63 7265 6174 655f 666f 6e74  Font.create_font
+00023980: 5f65 6469 7465 645f 7374 796c 655f 6672  _edited_style_fr
+00023990: 6f6d 5f63 7373 5f73 7479 6c65 5f6f 626a  om_css_style_obj
+000239a0: 6563 7428 7374 796c 655f 656c 656d 290a  ect(style_elem).
+000239b0: 2020 2020 2020 2020 6966 206e 6577 5f63          if new_c
+000239c0: 7373 7374 796c 6520 6973 206e 6f74 204e  ssstyle is not N
+000239d0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+000239e0: 2073 7479 6c65 5f65 6c65 6d2e 7465 7874   style_elem.text
+000239f0: 203d 2066 227b 7379 6d62 6f6c 5f72 6566   = f"{symbol_ref
+00023a00: 7d20 7b7b 7b6e 6577 5f63 7373 7374 796c  } {{{new_cssstyl
+00023a10: 657d 7d7d 220a 0a20 2020 2040 636c 6173  e}}}"..    @clas
+00023a20: 736d 6574 686f 640a 2020 2020 6465 6620  smethod.    def 
+00023a30: 6e6f 726d 616c 697a 655f 7374 796c 6573  normalize_styles
+00023a40: 5f69 6e5f 666f 6e74 735f 696e 5f68 746d  _in_fonts_in_htm
+00023a50: 6c5f 6865 6164 2863 6c73 2c20 6874 6d6c  l_head(cls, html
+00023a60: 5f65 6c65 6d29 3a0a 2020 2020 2020 2020  _elem):.        
+00023a70: 2222 220a 2020 2020 2020 2020 6e6f 726d  """.        norm
+00023a80: 616c 697a 6573 2061 6c6c 2066 6f6e 7473  alizes all fonts
+00023a90: 2074 6f20 6578 706f 7365 2066 6f6e 7420   to expose font 
+00023aa0: 7765 6967 6874 7320 616e 6420 7374 796c  weights and styl
+00023ab0: 6573 0a20 2020 2020 2020 203a 7061 7261  es.        :para
+00023ac0: 6d20 6874 6d6c 5f65 6c65 6d3a 2048 544d  m html_elem: HTM
+00023ad0: 4c20 2872 6f6f 7429 2065 6c65 6d65 6e74  L (root) element
+00023ae0: 2028 6874 6d6c 2f68 6561 642f 7374 796c   (html/head/styl
+00023af0: 652a 290a 2020 2020 2020 2020 2222 220a  e*).        """.
+00023b00: 2020 2020 2020 2020 7374 796c 655f 656c          style_el
+00023b10: 656d 7320 3d20 4353 5353 7479 6c65 2e65  ems = CSSStyle.e
+00023b20: 7874 7261 6374 5f73 7479 6c65 735f 6672  xtract_styles_fr
+00023b30: 6f6d 5f68 746d 6c5f 6865 6164 5f65 6c65  om_html_head_ele
+00023b40: 6d65 6e74 2868 746d 6c5f 656c 656d 290a  ment(html_elem).
+00023b50: 2020 2020 2020 2020 666f 7220 7374 796c          for styl
+00023b60: 655f 656c 656d 2069 6e20 7374 796c 655f  e_elem in style_
+00023b70: 656c 656d 733a 0a20 2020 2020 2020 2020  elems:.         
+00023b80: 2020 2043 5353 5374 796c 652e 7265 706c     CSSStyle.repl
+00023b90: 6163 655f 6373 735f 7374 796c 655f 6e61  ace_css_style_na
+00023ba0: 6d65 5f76 616c 7565 735f 7769 7468 5f6e  me_values_with_n
+00023bb0: 6f72 6d61 6c69 7a65 645f 666f 6e74 2873  ormalized_font(s
+00023bc0: 7479 6c65 5f65 6c65 6d29 0a0a 2020 2020  tyle_elem)..    
+00023bd0: 4070 726f 7065 7274 790a 2020 2020 6465  @property.    de
+00023be0: 6620 7368 6f72 745f 7374 796c 6528 7365  f short_style(se
+00023bf0: 6c66 293a 0a20 2020 2020 2020 2073 686f  lf):.        sho
+00023c00: 7274 5f73 7479 6c65 203d 2073 656c 662e  rt_style = self.
+00023c10: 666f 6e74 5f66 616d 696c 792e 6c6f 7765  font_family.lowe
+00023c20: 7228 295b 3a33 5d0a 2020 2020 2020 2020  r()[:3].        
+00023c30: 7368 6f72 745f 7374 796c 6520 2b3d 2073  short_style += s
+00023c40: 7472 2873 656c 662e 666f 6e74 5f73 697a  tr(self.font_siz
+00023c50: 6529 2e72 6570 6c61 6365 2822 2e22 2c20  e).replace(".", 
+00023c60: 225f 2229 0a20 2020 2020 2020 2069 6620  "_").        if 
+00023c70: 7365 6c66 2e69 735f 626f 6c64 3a0a 2020  self.is_bold:.  
+00023c80: 2020 2020 2020 2020 2020 7368 6f72 745f            short_
+00023c90: 7374 796c 6520 2b3d 2022 6222 0a20 2020  style += "b".   
+00023ca0: 2020 2020 2069 6620 7365 6c66 2e69 735f       if self.is_
+00023cb0: 6974 616c 6963 3a0a 2020 2020 2020 2020  italic:.        
+00023cc0: 2020 2020 7368 6f72 745f 7374 796c 6520      short_style 
+00023cd0: 2b3d 2022 6922 0a20 2020 2020 2020 2072  += "i".        r
+00023ce0: 6574 7572 6e20 7368 6f72 745f 7374 796c  eturn short_styl
+00023cf0: 650a 0a20 2020 2064 6566 2067 6574 5f66  e..    def get_f
+00023d00: 6f6e 745f 6174 7472 6962 7574 6573 2873  ont_attributes(s
+00023d10: 656c 6629 3a0a 2020 2020 2020 2020 2222  elf):.        ""
+00023d20: 220a 2020 2020 2020 2020 7365 7473 2034  ".        sets 4
+00023d30: 2066 6f6e 7420 6174 7472 6962 7574 6573   font attributes
+00023d40: 2028 7769 6474 682c 2073 697a 652c 206e   (width, size, n
+00023d50: 6f6e 7374 726f 6b65 2c20 7374 726f 6b65  onstroke, stroke
+00023d60: 2c20 666f 6e74 6e61 6d65 0a20 2020 2020  , fontname.     
+00023d70: 2020 2022 2222 0a0a 2020 2020 2020 2020     """..        
+00023d80: 6966 2073 656c 662e 6e61 6d65 5f76 616c  if self.name_val
+00023d90: 7565 5f64 6963 7420 6973 204e 6f6e 653a  ue_dict is None:
+00023da0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00023db0: 7572 6e20 284e 6f6e 652c 204e 6f6e 652c  urn (None, None,
+00023dc0: 204e 6f6e 652c 204e 6f6e 652c 204e 6f6e   None, None, Non
+00023dd0: 6529 0a20 2020 2020 2020 2072 6574 7572  e).        retur
+00023de0: 6e20 280a 2020 2020 2020 2020 2020 2020  n (.            
+00023df0: 2320 7365 6c66 2e6e 616d 655f 7661 6c75  # self.name_valu
+00023e00: 655f 6469 6374 2e67 6574 2843 5353 5374  e_dict.get(CSSSt
+00023e10: 796c 652e 5749 4454 4829 2c0a 2020 2020  yle.WIDTH),.    
+00023e20: 2020 2020 2020 2020 7365 6c66 2e67 6574          self.get
+00023e30: 5f61 7474 7269 6275 7465 2843 5353 5374  _attribute(CSSSt
+00023e40: 796c 652e 464f 4e54 5f53 495a 4529 2c0a  yle.FONT_SIZE),.
+00023e50: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00023e60: 2e67 6574 5f61 7474 7269 6275 7465 2843  .get_attribute(C
+00023e70: 5353 5374 796c 652e 4649 4c4c 292c 0a20  SSStyle.FILL),. 
+00023e80: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00023e90: 6765 745f 6174 7472 6962 7574 6528 4353  get_attribute(CS
+00023ea0: 5353 7479 6c65 2e53 5452 4f4b 4529 2c0a  SStyle.STROKE),.
+00023eb0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00023ec0: 2e67 6574 5f61 7474 7269 6275 7465 2843  .get_attribute(C
+00023ed0: 5353 5374 796c 652e 464f 4e54 5f46 414d  SSStyle.FONT_FAM
+00023ee0: 494c 5929 0a20 2020 2020 2020 2029 0a0a  ILY).        )..
+00023ef0: 2020 2020 4063 6c61 7373 6d65 7468 6f64      @classmethod
+00023f00: 0a20 2020 2064 6566 2067 6574 5f63 6f6f  .    def get_coo
+00023f10: 7264 7328 636c 732c 2065 6c65 6d29 3a0a  rds(cls, elem):.
+00023f20: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00023f30: 2020 2020 3a72 6574 7572 6e3a 2078 302c      :return: x0,
+00023f40: 2078 312c 2079 302c 2079 310a 2020 2020   x1, y0, y1.    
+00023f50: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00023f60: 6373 7373 203d 2063 6c73 2e63 7265 6174  csss = cls.creat
+00023f70: 655f 6373 735f 7374 796c 655f 6672 6f6d  e_css_style_from
+00023f80: 5f61 7474 7269 6275 7465 5f6f 665f 626f  _attribute_of_bo
+00023f90: 6479 5f65 6c65 6d65 6e74 2865 6c65 6d29  dy_element(elem)
+00023fa0: 0a20 2020 2020 2020 2078 3020 3d20 6373  .        x0 = cs
+00023fb0: 7373 2e67 6574 5f6e 756d 6572 6963 5f61  ss.get_numeric_a
+00023fc0: 7474 7661 6c28 2278 3022 290a 2020 2020  ttval("x0").    
+00023fd0: 2020 2020 7831 203d 2063 7373 732e 6765      x1 = csss.ge
+00023fe0: 745f 6e75 6d65 7269 635f 6174 7476 616c  t_numeric_attval
+00023ff0: 2822 7831 2229 0a20 2020 2020 2020 2079  ("x1").        y
+00024000: 3020 3d20 6373 7373 2e67 6574 5f6e 756d  0 = csss.get_num
+00024010: 6572 6963 5f61 7474 7661 6c28 2279 3022  eric_attval("y0"
+00024020: 290a 2020 2020 2020 2020 7931 203d 2063  ).        y1 = c
+00024030: 7373 732e 6765 745f 6e75 6d65 7269 635f  sss.get_numeric_
+00024040: 6174 7476 616c 2822 7931 2229 0a20 2020  attval("y1").   
+00024050: 2020 2020 2072 6574 7572 6e20 2878 302c       return (x0,
+00024060: 2079 302c 2078 312c 2079 3129 0a0a 2020   y0, x1, y1)..  
+00024070: 2020 4063 6c61 7373 6d65 7468 6f64 0a20    @classmethod. 
+00024080: 2020 2064 6566 2067 6574 5f78 3028 636c     def get_x0(cl
+00024090: 732c 2065 6c65 6d29 3a0a 2020 2020 2020  s, elem):.      
+000240a0: 2020 7265 7475 726e 2063 6c73 2e67 6574    return cls.get
+000240b0: 5f63 6f6f 7264 7328 656c 656d 295b 305d  _coords(elem)[0]
+000240c0: 0a0a 2020 2020 4063 6c61 7373 6d65 7468  ..    @classmeth
+000240d0: 6f64 0a20 2020 2064 6566 2067 6574 5f79  od.    def get_y
+000240e0: 3028 636c 732c 2065 6c65 6d29 3a0a 2020  0(cls, elem):.  
+000240f0: 2020 2020 2020 7265 7475 726e 2063 6c73        return cls
+00024100: 2e67 6574 5f63 6f6f 7264 7328 656c 656d  .get_coords(elem
+00024110: 295b 315d 0a0a 2020 2020 4063 6c61 7373  )[1]..    @class
+00024120: 6d65 7468 6f64 0a20 2020 2064 6566 2067  method.    def g
+00024130: 6574 5f78 3128 636c 732c 2065 6c65 6d29  et_x1(cls, elem)
+00024140: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+00024150: 2063 6c73 2e67 6574 5f63 6f6f 7264 7328   cls.get_coords(
+00024160: 656c 656d 295b 325d 0a0a 2020 2020 4063  elem)[2]..    @c
+00024170: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
+00024180: 6566 2067 6574 5f79 3128 636c 732c 2065  ef get_y1(cls, e
+00024190: 6c65 6d29 3a0a 2020 2020 2020 2020 7265  lem):.        re
+000241a0: 7475 726e 2063 6c73 2e67 6574 5f63 6f6f  turn cls.get_coo
+000241b0: 7264 7328 656c 656d 295b 335d 0a0a 2020  rds(elem)[3]..  
+000241c0: 2020 4063 6c61 7373 6d65 7468 6f64 0a20    @classmethod. 
+000241d0: 2020 2064 6566 2065 7874 7261 6374 5f63     def extract_c
+000241e0: 6f6f 7264 735f 616e 645f 666f 6e74 5f70  oords_and_font_p
+000241f0: 726f 7065 7274 6965 7328 636c 732c 2073  roperties(cls, s
+00024200: 7061 6e29 3a0a 2020 2020 2020 2020 6373  pan):.        cs
+00024210: 7373 203d 2043 5353 5374 796c 652e 6372  ss = CSSStyle.cr
+00024220: 6561 7465 5f63 7373 5f73 7479 6c65 5f66  eate_css_style_f
+00024230: 726f 6d5f 6174 7472 6962 7574 655f 6f66  rom_attribute_of
+00024240: 5f62 6f64 795f 656c 656d 656e 7428 7370  _body_element(sp
+00024250: 616e 290a 2020 2020 2020 2020 666f 6e74  an).        font
+00024260: 5f73 697a 6520 3d20 6373 7373 2e67 6574  _size = csss.get
+00024270: 5f6e 756d 6572 6963 5f61 7474 7661 6c28  _numeric_attval(
+00024280: 4353 5353 7479 6c65 2e46 4f4e 545f 5349  CSSStyle.FONT_SI
+00024290: 5a45 290a 2020 2020 2020 2020 7930 203d  ZE).        y0 =
+000242a0: 2063 7373 732e 6765 745f 6e75 6d65 7269   csss.get_numeri
+000242b0: 635f 6174 7476 616c 2822 7930 2229 0a20  c_attval("y0"). 
+000242c0: 2020 2020 2020 2079 3120 3d20 6373 7373         y1 = csss
+000242d0: 2e67 6574 5f6e 756d 6572 6963 5f61 7474  .get_numeric_att
+000242e0: 7661 6c28 2279 3122 290a 2020 2020 2020  val("y1").      
+000242f0: 2020 7831 203d 2063 7373 732e 6765 745f    x1 = csss.get_
+00024300: 6e75 6d65 7269 635f 6174 7476 616c 2822  numeric_attval("
+00024310: 7831 2229 0a20 2020 2020 2020 2072 6574  x1").        ret
+00024320: 7572 6e20 666f 6e74 5f73 697a 652c 2079  urn font_size, y
+00024330: 302c 2079 310a 0a20 2020 2040 636c 6173  0, y1..    @clas
+00024340: 736d 6574 686f 640a 2020 2020 6465 6620  smethod.    def 
+00024350: 6578 7472 6163 745f 626f 6c64 5f69 7461  extract_bold_ita
+00024360: 6c69 635f 6672 6f6d 5f66 6f6e 745f 6661  lic_from_font_fa
+00024370: 6d69 6c79 5f66 6f72 5f73 7479 6c65 7328  mily_for_styles(
+00024380: 636c 732c 2073 7479 6c65 7329 3a0a 2020  cls, styles):.  
+00024390: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+000243a0: 2020 3a73 7479 6c65 733a 206c 6973 7420    :styles: list 
+000243b0: 6f66 2043 5353 5374 796c 6520 6f62 6a65  of CSSStyle obje
+000243c0: 6374 7320 746f 206e 6f72 6d61 6c69 7a65  cts to normalize
+000243d0: 0a0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
+000243e0: 2020 2020 2020 6578 7472 6163 7465 6420        extracted 
+000243f0: 3d20 5b5d 0a20 2020 2020 2020 2066 6f72  = [].        for
+00024400: 2073 7479 6c65 2069 6e20 7374 796c 6573   style in styles
+00024410: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+00024420: 2073 7479 6c65 3a0a 2020 2020 2020 2020   style:.        
+00024430: 2020 2020 2020 2020 6578 7472 6163 7465          extracte
+00024440: 642e 6170 7065 6e64 2863 6c73 2e65 7874  d.append(cls.ext
+00024450: 7261 6374 5f62 6f6c 645f 6974 616c 6963  ract_bold_italic
+00024460: 5f66 726f 6d5f 666f 6e74 5f66 616d 696c  _from_font_famil
+00024470: 795f 666f 725f 7374 796c 6528 7374 796c  y_for_style(styl
+00024480: 6529 290a 2020 2020 2020 2020 7265 7475  e)).        retu
+00024490: 726e 2065 7874 7261 6374 6564 0a0a 2020  rn extracted..  
+000244a0: 2020 4063 6c61 7373 6d65 7468 6f64 0a20    @classmethod. 
+000244b0: 2020 2064 6566 2065 7874 7261 6374 5f62     def extract_b
+000244c0: 6f6c 645f 6974 616c 6963 5f66 726f 6d5f  old_italic_from_
+000244d0: 666f 6e74 5f66 616d 696c 795f 666f 725f  font_family_for_
+000244e0: 7374 796c 6528 636c 732c 2073 7479 6c65  style(cls, style
+000244f0: 5f73 293a 0a20 2020 2020 2020 2069 6620  _s):.        if 
+00024500: 6e6f 7420 7374 796c 655f 733a 0a20 2020  not style_s:.   
+00024510: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
+00024520: 616c 7565 4572 726f 7228 2273 7479 6c65  alueError("style
+00024530: 5f73 2069 7320 4e6f 6e65 2229 0a20 2020  _s is None").   
+00024540: 2020 2020 2063 7373 5f73 7479 6c65 203d       css_style =
+00024550: 2043 5353 5374 796c 652e 6372 6561 7465   CSSStyle.create
+00024560: 5f63 7373 5f73 7479 6c65 5f66 726f 6d5f  _css_style_from_
+00024570: 6373 735f 7374 7269 6e67 2873 7472 2873  css_string(str(s
+00024580: 7479 6c65 5f73 2929 0a20 2020 2020 2020  tyle_s)).       
+00024590: 2069 6620 6373 735f 7374 796c 653a 0a20   if css_style:. 
+000245a0: 2020 2020 2020 2020 2020 2063 7373 5f73             css_s
+000245b0: 7479 6c65 2e65 7874 7261 6374 5f62 6f6c  tyle.extract_bol
+000245c0: 645f 6974 616c 6963 5f66 726f 6d5f 666f  d_italic_from_fo
+000245d0: 6e74 5f66 616d 696c 7928 0a20 2020 2020  nt_family(.     
+000245e0: 2020 2020 2020 2020 2020 206f 7665 7277             overw
+000245f0: 7269 7465 5f66 616d 696c 793d 5472 7565  rite_family=True
+00024600: 2c20 6f76 6572 7772 6974 655f 626f 6c64  , overwrite_bold
+00024610: 3d54 7275 652c 206f 7665 7277 7269 7465  =True, overwrite
+00024620: 5f73 7479 6c65 3d54 7275 6529 0a20 2020  _style=True).   
+00024630: 2020 2020 2072 6574 7572 6e20 6373 735f       return css_
+00024640: 7374 796c 650a 0a0a 636c 6173 7320 4353  style...class CS
+00024650: 5343 6f6e 7665 7274 6572 3a0a 2020 2020  SConverter:.    
+00024660: 2222 220a 2020 2020 7475 726e 7320 4343  """.    turns CC
+00024670: 5320 7374 796c 6573 2069 6e74 6f20 6874  S styles into ht
+00024680: 6d6c 2063 6c61 7373 6573 0a20 2020 2022  ml classes.    "
+00024690: 2222 0a0a 2020 2020 6465 6620 5f5f 696e  ""..    def __in
+000246a0: 6974 5f5f 2873 656c 6629 3a0a 2020 2020  it__(self):.    
+000246b0: 2020 2020 7061 7373 0a0a 2020 2020 6465      pass..    de
+000246c0: 6620 7265 6164 5f68 746d 6c5f 656c 656d  f read_html_elem
+000246d0: 656e 7428 7365 6c66 2c20 6874 6d6c 5f65  ent(self, html_e
+000246e0: 6c65 6d29 3a0a 2020 2020 2020 2020 2222  lem):.        ""
+000246f0: 220a 2020 2020 2020 2020 7265 6164 7320  ".        reads 
+00024700: 616e 6420 636f 6e76 6572 7473 2068 746d  and converts htm
+00024710: 6c20 656c 656d 656e 742e 0a20 2020 2020  l element..     
+00024720: 2020 2061 6464 7320 3c68 746d 6c3e 2061     adds <html> a
+00024730: 7320 726f 6f74 2069 6620 6e6f 7420 7072  s root if not pr
+00024740: 6573 656e 740a 2020 2020 2020 2020 2222  esent.        ""
+00024750: 220a 2020 2020 2020 2020 7365 6c66 2e68  ".        self.h
+00024760: 746d 6c5f 656c 656d 203d 2068 746d 6c5f  tml_elem = html_
+00024770: 656c 656d 0a20 2020 2020 2020 2073 656c  elem.        sel
+00024780: 662e 6874 6d6c 5f65 6c65 6d20 3d20 4874  f.html_elem = Ht
+00024790: 6d6c 5469 6479 2e65 6e73 7572 655f 6874  mlTidy.ensure_ht
+000247a0: 6d6c 5f68 6561 645f 626f 6479 2873 656c  ml_head_body(sel
+000247b0: 662e 6874 6d6c 5f65 6c65 6d29 0a20 2020  f.html_elem).   
+000247c0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+000247d0: 2e68 746d 6c5f 656c 656d 0a0a 0a63 6c61  .html_elem...cla
+000247e0: 7373 2046 6f6e 7450 726f 7065 7274 7928  ss FontProperty(
+000247f0: 456e 756d 293a 0a20 2020 2022 2222 0a20  Enum):.    """. 
+00024800: 2020 2041 7269 616c 4e61 7272 6f77 0a20     ArialNarrow. 
+00024810: 2020 2041 7269 616c 4e61 7272 6f77 2d42     ArialNarrow-B
+00024820: 6f6c 640a 2020 2020 4361 6c69 6272 690a  old.    Calibri.
+00024830: 2020 2020 4672 7574 6967 6572 4c54 5072      FrutigerLTPr
+00024840: 6f2d 426c 6163 6b43 6e0a 2020 2020 4672  o-BlackCn.    Fr
+00024850: 7574 6967 6572 4c54 5072 6f2d 426f 6c64  utigerLTPro-Bold
+00024860: 436e 0a20 2020 2046 7275 7469 6765 724c  Cn.    FrutigerL
+00024870: 5450 726f 2d42 6f6c 6443 6e49 7461 0a20  TPro-BoldCnIta. 
+00024880: 2020 2046 7275 7469 6765 724c 5450 726f     FrutigerLTPro
+00024890: 2d43 6f6e 6465 6e73 6564 0a20 2020 2046  -Condensed.    F
+000248a0: 7275 7469 6765 724c 5450 726f 2d43 6f6e  rutigerLTPro-Con
+000248b0: 6465 6e73 6564 4974 610a 2020 2020 4672  densedIta.    Fr
+000248c0: 7574 6967 6572 4c54 5072 6f2d 4c69 6768  utigerLTPro-Ligh
+000248d0: 740a 2020 2020 4672 7574 6967 6572 4c54  t.    FrutigerLT
+000248e0: 5072 6f2d 4c69 6768 7443 6e0a 2020 2020  Pro-LightCn.    
+000248f0: 4672 7574 6967 6572 4c54 5072 6f2d 4c69  FrutigerLTPro-Li
+00024900: 6768 7443 6e49 7461 0a20 2020 2046 7275  ghtCnIta.    Fru
+00024910: 7469 6765 724c 5450 726f 2d52 6f6d 616e  tigerLTPro-Roman
+00024920: 0a20 2020 2022 2222 0a20 2020 2023 0a20  .    """.    #. 
+00024930: 2020 204e 4f52 4d41 4c20 3d20 2222 0a0a     NORMAL = ""..
+00024940: 2020 2020 4e41 5252 4f57 203d 2022 6e61      NARROW = "na
+00024950: 7272 6f77 220a 2020 2020 5749 4445 203d  rrow".    WIDE =
+00024960: 2022 7769 6465 220a 0a20 2020 204c 4947   "wide"..    LIG
+00024970: 4854 203d 2022 6c69 6768 7422 0a20 2020  HT = "light".   
+00024980: 2042 4f4c 4420 3d20 2262 6f6c 6422 0a0a   BOLD = "bold"..
+00024990: 2020 2020 4954 414c 4943 203d 2022 6974      ITALIC = "it
+000249a0: 616c 6963 220a 0a20 2020 2053 414e 5320  alic"..    SANS 
+000249b0: 3d20 2273 616e 7322 0a20 2020 2053 4552  = "sans".    SER
+000249c0: 4946 203d 2022 7365 7269 6622 0a20 2020  IF = "serif".   
+000249d0: 2053 594d 424f 4c20 3d20 2273 796d 626f   SYMBOL = "symbo
+000249e0: 6c22 0a20 2020 204d 4f4e 4f53 5041 4345  l".    MONOSPACE
+000249f0: 203d 2022 736f 6e6f 7370 6163 6522 0a0a   = "sonospace"..
+00024a00: 2020 2020 6465 6620 5f5f 7374 725f 5f28      def __str__(
+00024a10: 7365 6c66 293a 0a20 2020 2020 2020 2072  self):.        r
+00024a20: 6574 7572 6e20 7374 7228 7365 6c66 2e76  eturn str(self.v
+00024a30: 616c 7565 290a 0a20 2020 2064 6566 205f  alue)..    def _
+00024a40: 5f72 6570 725f 5f28 7365 6c66 293a 0a20  _repr__(self):. 
+00024a50: 2020 2020 2020 2072 6574 7572 6e20 7374         return st
+00024a60: 7228 7365 6c66 2e76 616c 7565 290a 0a0a  r(self.value)...
+00024a70: 2320 7374 7269 7073 2070 7265 6669 7820  # strips prefix 
+00024a80: 6f66 6620 666f 6e74 2d6e 616d 6573 0a52  off font-names.R
+00024a90: 455f 5052 4546 203d 2072 652e 636f 6d70  E_PREF = re.comp
+00024aa0: 696c 6528 225b 412d 5a5d 7b36 7d5c 5c2b  ile("[A-Z]{6}\\+
+00024ab0: 283f 503c 6e61 6d65 3e5b 5e5c 5c73 5d2b  (?P<name>[^\\s]+
+00024ac0: 295c 5c73 2a22 290a 0a0a 636c 6173 7320  )\\s*")...class 
+00024ad0: 416d 6946 6f6e 743a 0a20 2020 2022 2222  AmiFont:.    """
+00024ae0: 0a20 2020 2065 6d70 6972 6963 616c 206e  .    empirical n
+00024af0: 6f72 6d61 6c69 7a61 7469 6f6e 206f 6620  ormalization of 
+00024b00: 666f 6e74 732e 2054 7269 6573 2074 6f20  fonts. Tries to 
+00024b10: 636f 6e76 6572 7420 616c 6c20 746f 2074  convert all to t
+00024b20: 6865 0a20 2020 2062 6173 650a 2020 2020  he.    base.    
+00024b30: 666f 6e74 2d66 616d 696c 793a 2073 6572  font-family: ser
+00024b40: 6966 2f73 616e 732d 7365 7269 662f 6d6f  if/sans-serif/mo
+00024b50: 6e6f 7370 6163 650a 2020 2020 666f 6e74  nospace.    font
+00024b60: 2d73 7472 6574 6368 3a20 2863 6f6e 6465  -stretch: (conde
+00024b70: 6e73 6564 2f6e 6f72 6d61 6c2f 6578 7061  nsed/normal/expa
+00024b80: 6e64 6564 290a 2020 2020 666f 726e 2d77  nded).    forn-w
+00024b90: 6569 6768 743a 206e 6f72 6d61 6c2f 626f  eight: normal/bo
+00024ba0: 6c64 0a20 2020 2066 6f6e 742d 7374 796c  ld.    font-styl
+00024bb0: 653a 206e 6f72 6d61 6c2f 6974 616c 6963  e: normal/italic
+00024bc0: 0a20 2020 2022 2222 0a0a 2020 2020 2320  .    """..    # 
+00024bd0: 656d 7069 7269 6361 6c20 636f 6e76 6572  empirical conver
+00024be0: 7369 6f6e 733b 2077 696c 6c20 6e65 6564  sions; will need
+00024bf0: 2074 6f20 6265 2075 7064 6174 6564 2066   to be updated f
+00024c00: 7265 7175 656e 746c 790a 2020 2020 636f  requently.    co
+00024c10: 6e76 6572 7369 6f6e 5f64 6963 7420 3d20  nversion_dict = 
+00024c20: 7b0a 2020 2020 2020 2020 2241 7269 616c  {.        "Arial
+00024c30: 223a 2046 6f6e 7450 726f 7065 7274 792e  ": FontProperty.
+00024c40: 5341 4e53 2c0a 2020 2020 2020 2020 2243  SANS,.        "C
+00024c50: 616c 6962 7269 223a 2046 6f6e 7450 726f  alibri": FontPro
+00024c60: 7065 7274 792e 5341 4e53 2c0a 2020 2020  perty.SANS,.    
+00024c70: 2020 2020 2246 7275 7469 6765 7222 3a20      "Frutiger": 
+00024c80: 466f 6e74 5072 6f70 6572 7479 2e53 414e  FontProperty.SAN
+00024c90: 532c 0a20 2020 2020 2020 2022 4865 6c76  S,.        "Helv
+00024ca0: 6574 6963 6122 3a20 466f 6e74 5072 6f70  etica": FontProp
+00024cb0: 6572 7479 2e53 414e 532c 0a0a 2020 2020  erty.SANS,..    
+00024cc0: 2020 2020 2254 696d 6573 223a 2046 6f6e      "Times": Fon
+00024cd0: 7450 726f 7065 7274 792e 5345 5249 462c  tProperty.SERIF,
+00024ce0: 0a0a 2020 2020 2020 2020 2243 6f75 7269  ..        "Couri
+00024cf0: 6572 223a 2046 6f6e 7450 726f 7065 7274  er": FontPropert
+00024d00: 792e 4d4f 4e4f 5350 4143 452c 0a0a 2020  y.MONOSPACE,..  
+00024d10: 2020 2020 2020 2253 796d 626f 6c22 3a20        "Symbol": 
+00024d20: 466f 6e74 5072 6f70 6572 7479 2e53 594d  FontProperty.SYM
+00024d30: 424f 4c2c 0a20 2020 207d 0a0a 2020 2020  BOL,.    }..    
+00024d40: 636f 6e64 5f72 6567 6578 203d 2072 652e  cond_regex = re.
+00024d50: 636f 6d70 696c 6528 2228 2e2a 2928 436f  compile("(.*)(Co
+00024d60: 6e64 656e 7365 647c 436e 7c4e 6172 726f  ndensed|Cn|Narro
+00024d70: 7729 282e 2a29 2229 0a20 2020 2077 6964  w)(.*)").    wid
+00024d80: 655f 7265 6765 7820 3d20 7265 2e63 6f6d  e_regex = re.com
+00024d90: 7069 6c65 2822 282e 2a29 2857 6964 6529  pile("(.*)(Wide)
+00024da0: 282e 2a29 2229 0a0a 2020 2020 6c69 6768  (.*)")..    ligh
+00024db0: 745f 7265 6765 7820 3d20 7265 2e63 6f6d  t_regex = re.com
+00024dc0: 7069 6c65 2822 282e 2a29 284c 6967 6874  pile("(.*)(Light
+00024dd0: 7c54 6869 6e29 282e 2a29 2229 0a20 2020  |Thin)(.*)").   
+00024de0: 2062 6f6c 645f 7265 6765 7820 3d20 7265   bold_regex = re
+00024df0: 2e63 6f6d 7069 6c65 2822 282e 2a29 2842  .compile("(.*)(B
+00024e00: 6f6c 647c 4865 6176 7977 6569 6768 747c  old|Heavyweight|
+00024e10: 426c 6163 6b29 282e 2a29 2229 0a0a 2020  Black)(.*)")..  
+00024e20: 2020 7374 796c 655f 7265 6765 7820 3d20    style_regex = 
+00024e30: 7265 2e63 6f6d 7069 6c65 2822 282e 2a29  re.compile("(.*)
+00024e40: 2849 7461 6c69 637c 4974 617c 4f62 6c69  (Italic|Ita|Obli
+00024e50: 7175 6529 282e 2a29 2229 0a0a 2020 2020  que)(.*)")..    
+00024e60: 2320 2020 2063 6c61 7373 2041 6d69 466f  #    class AmiFo
+00024e70: 6e74 3a0a 0a20 2020 2064 6566 205f 5f69  nt:..    def __i
+00024e80: 6e69 745f 5f28 7365 6c66 293a 0a20 2020  nit__(self):.   
+00024e90: 2020 2020 2073 656c 662e 6e61 6d65 203d       self.name =
+00024ea0: 204e 6f6e 650a 2020 2020 2020 2020 7365   None.        se
+00024eb0: 6c66 2e66 616d 696c 7920 3d20 4e6f 6e65  lf.family = None
+00024ec0: 0a20 2020 2020 2020 2073 656c 662e 7765  .        self.we
+00024ed0: 6967 6874 203d 2073 7472 2846 6f6e 7450  ight = str(FontP
+00024ee0: 726f 7065 7274 792e 4e4f 524d 414c 290a  roperty.NORMAL).
+00024ef0: 2020 2020 2020 2020 7365 6c66 2e73 7479          self.sty
+00024f00: 6c65 203d 2073 7472 2846 6f6e 7450 726f  le = str(FontPro
+00024f10: 7065 7274 792e 4e4f 524d 414c 290a 2020  perty.NORMAL).  
+00024f20: 2020 2020 2020 7365 6c66 2e73 7472 6574        self.stret
+00024f30: 6368 6564 203d 2073 7472 2846 6f6e 7450  ched = str(FontP
+00024f40: 726f 7065 7274 792e 4e4f 524d 414c 290a  roperty.NORMAL).
+00024f50: 2020 2020 2020 2020 7365 6c66 2e66 6f6e          self.fon
+00024f60: 7420 3d20 7374 7228 466f 6e74 5072 6f70  t = str(FontProp
+00024f70: 6572 7479 2e53 414e 5329 0a0a 2020 2020  erty.SANS)..    
+00024f80: 2320 2020 2063 6c61 7373 2041 6d69 466f  #    class AmiFo
+00024f90: 6e74 3a0a 0a20 2020 2064 6566 205f 5f73  nt:..    def __s
+00024fa0: 7472 5f5f 2873 656c 6629 3a0a 2020 2020  tr__(self):.    
+00024fb0: 2020 2020 7320 3d20 6622 6e61 6d65 3a7b      s = f"name:{
+00024fc0: 7365 6c66 2e6e 616d 657d 3b66 616d 696c  self.name};famil
+00024fd0: 793a 7b73 656c 662e 6661 6d69 6c79 7d3b  y:{self.family};
+00024fe0: 7765 6967 6874 3a7b 7365 6c66 2e77 6569  weight:{self.wei
+00024ff0: 6768 747d 3b73 7479 6c65 3a7b 7365 6c66  ght};style:{self
+00025000: 2e73 7479 6c65 7d3b 7374 7265 7463 6865  .style};stretche
+00025010: 643a 7b73 656c 662e 7374 7265 7463 6865  d:{self.stretche
+00025020: 647d 3b66 6f6e 743a 7b73 656c 662e 666f  d};font:{self.fo
+00025030: 6e74 7d22 0a20 2020 2020 2020 2072 6574  nt}".        ret
+00025040: 7572 6e20 730a 0a20 2020 2040 636c 6173  urn s..    @clas
+00025050: 736d 6574 686f 640a 2020 2020 6465 6620  smethod.    def 
+00025060: 6578 7472 6163 745f 6e61 6d65 5f77 6569  extract_name_wei
+00025070: 6768 745f 7374 796c 655f 7374 7265 7463  ght_style_stretc
+00025080: 6865 645f 6173 5f66 6f6e 7428 636c 732c  hed_as_font(cls,
+00025090: 206e 616d 6530 293a 0a0a 2020 2020 2020   name0):..      
+000250a0: 2020 666f 6e74 203d 2041 6d69 466f 6e74    font = AmiFont
+000250b0: 2829 0a20 2020 2020 2020 206e 616d 6520  ().        name 
+000250c0: 3d20 416d 6946 6f6e 742e 7472 696d 5f70  = AmiFont.trim_p
+000250d0: 6466 5f70 7265 6669 7828 6e61 6d65 3029  df_prefix(name0)
+000250e0: 0a0a 2020 2020 2020 2020 7768 696c 6520  ..        while 
+000250f0: 5472 7565 3a0a 2020 2020 2020 2020 2020  True:.          
+00025100: 2020 6e61 6d65 2c20 6d61 7463 6820 3d20    name, match = 
+00025110: 636c 732e 6578 7472 6163 745f 656e 756d  cls.extract_enum
+00025120: 6572 6174 6564 5f73 7479 6c65 7328 666f  erated_styles(fo
+00025130: 6e74 2c20 6e61 6d65 290a 2020 2020 2020  nt, name).      
+00025140: 2020 2020 2020 6966 206e 6f74 206d 6174        if not mat
+00025150: 6368 3a0a 2020 2020 2020 2020 2020 2020  ch:.            
+00025160: 2020 2020 6272 6561 6b0a 0a20 2020 2020      break..     
+00025170: 2020 206e 616d 6520 3d20 6e61 6d65 2e72     name = name.r
+00025180: 6570 6c61 6365 2822 2d22 2c20 2222 290a  eplace("-", "").
+00025190: 0a20 2020 2020 2020 2066 6f6e 742e 6661  .        font.fa
+000251a0: 6d69 6c79 203d 206e 616d 650a 2020 2020  mily = name.    
+000251b0: 2020 2020 666f 6e74 2e6e 616d 6520 3d20      font.name = 
+000251c0: 6e61 6d65 300a 2020 2020 2020 2020 7265  name0.        re
+000251d0: 7475 726e 2066 6f6e 740a 0a20 2020 2040  turn font..    @
+000251e0: 636c 6173 736d 6574 686f 640a 2020 2020  classmethod.    
+000251f0: 6465 6620 6578 7472 6163 745f 656e 756d  def extract_enum
+00025200: 6572 6174 6564 5f73 7479 6c65 7328 636c  erated_styles(cl
+00025210: 732c 2066 6f6e 742c 206e 616d 6529 3a0a  s, font, name):.
+00025220: 0a20 2020 2020 2020 206e 616d 652c 206d  .        name, m
+00025230: 6174 6368 203d 2063 6c73 2e6d 6174 6368  atch = cls.match
+00025240: 5f66 6f6e 745f 7072 6f70 6572 7479 286e  _font_property(n
+00025250: 616d 652c 2041 6d69 466f 6e74 2e63 6f6e  ame, AmiFont.con
+00025260: 645f 7265 6765 7829 0a20 2020 2020 2020  d_regex).       
+00025270: 2069 6620 6d61 7463 683a 0a20 2020 2020   if match:.     
+00025280: 2020 2020 2020 2066 6f6e 742e 7374 7265         font.stre
+00025290: 7463 6865 6420 3d20 466f 6e74 5072 6f70  tched = FontProp
+000252a0: 6572 7479 2e4e 4152 524f 570a 2020 2020  erty.NARROW.    
+000252b0: 2020 2020 2020 2020 7265 7475 726e 206e          return n
+000252c0: 616d 652c 206d 6174 6368 0a20 2020 2020  ame, match.     
+000252d0: 2020 206e 616d 652c 206d 6174 6368 203d     name, match =
+000252e0: 2063 6c73 2e6d 6174 6368 5f66 6f6e 745f   cls.match_font_
+000252f0: 7072 6f70 6572 7479 286e 616d 652c 2041  property(name, A
+00025300: 6d69 466f 6e74 2e77 6964 655f 7265 6765  miFont.wide_rege
+00025310: 7829 0a20 2020 2020 2020 2069 6620 6d61  x).        if ma
+00025320: 7463 683a 0a20 2020 2020 2020 2020 2020  tch:.           
+00025330: 2066 6f6e 742e 7374 7265 7463 6865 6420   font.stretched 
+00025340: 3d20 466f 6e74 5072 6f70 6572 7479 2e57  = FontProperty.W
+00025350: 4944 450a 2020 2020 2020 2020 2020 2020  IDE.            
+00025360: 7265 7475 726e 206e 616d 652c 206d 6174  return name, mat
+00025370: 6368 0a20 2020 2020 2020 206e 616d 652c  ch.        name,
+00025380: 206d 6174 6368 203d 2063 6c73 2e6d 6174   match = cls.mat
+00025390: 6368 5f66 6f6e 745f 7072 6f70 6572 7479  ch_font_property
+000253a0: 286e 616d 652c 2041 6d69 466f 6e74 2e6c  (name, AmiFont.l
+000253b0: 6967 6874 5f72 6567 6578 290a 2020 2020  ight_regex).    
+000253c0: 2020 2020 6966 206d 6174 6368 3a0a 2020      if match:.  
+000253d0: 2020 2020 2020 2020 2020 666f 6e74 2e77            font.w
+000253e0: 6569 6768 7420 3d20 466f 6e74 5072 6f70  eight = FontProp
+000253f0: 6572 7479 2e4c 4947 4854 0a20 2020 2020  erty.LIGHT.     
+00025400: 2020 2020 2020 2072 6574 7572 6e20 6e61         return na
+00025410: 6d65 2c20 6d61 7463 680a 2020 2020 2020  me, match.      
+00025420: 2020 6e61 6d65 2c20 6d61 7463 6820 3d20    name, match = 
+00025430: 636c 732e 6d61 7463 685f 666f 6e74 5f70  cls.match_font_p
+00025440: 726f 7065 7274 7928 6e61 6d65 2c20 416d  roperty(name, Am
+00025450: 6946 6f6e 742e 626f 6c64 5f72 6567 6578  iFont.bold_regex
+00025460: 290a 2020 2020 2020 2020 6966 206d 6174  ).        if mat
+00025470: 6368 3a0a 2020 2020 2020 2020 2020 2020  ch:.            
+00025480: 666f 6e74 2e77 6569 6768 7420 3d20 466f  font.weight = Fo
+00025490: 6e74 5072 6f70 6572 7479 2e42 4f4c 440a  ntProperty.BOLD.
+000254a0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+000254b0: 726e 206e 616d 652c 206d 6174 6368 0a0a  rn name, match..
+000254c0: 2020 2020 2020 2020 6e61 6d65 2c20 6d61          name, ma
+000254d0: 7463 6820 3d20 636c 732e 6d61 7463 685f  tch = cls.match_
+000254e0: 666f 6e74 5f70 726f 7065 7274 7928 6e61  font_property(na
+000254f0: 6d65 2c20 416d 6946 6f6e 742e 7374 796c  me, AmiFont.styl
+00025500: 655f 7265 6765 7829 0a20 2020 2020 2020  e_regex).       
+00025510: 2069 6620 6d61 7463 683a 0a20 2020 2020   if match:.     
+00025520: 2020 2020 2020 2066 6f6e 742e 7374 796c         font.styl
+00025530: 6520 3d20 466f 6e74 5072 6f70 6572 7479  e = FontProperty
+00025540: 2e49 5441 4c49 430a 2020 2020 2020 2020  .ITALIC.        
+00025550: 2020 2020 7265 7475 726e 206e 616d 652c      return name,
+00025560: 206d 6174 6368 0a0a 2020 2020 2020 2020   match..        
+00025570: 7265 7475 726e 206e 616d 652c 204e 6f6e  return name, Non
+00025580: 650a 0a20 2020 2023 2020 2020 636c 6173  e..    #    clas
+00025590: 7320 416d 6946 6f6e 743a 0a0a 2020 2020  s AmiFont:..    
+000255a0: 2222 220a 2020 2020 426f 6c64 2046 6f6e  """.    Bold Fon
+000255b0: 7473 3a20 312e 2041 7269 616c 0a20 2020  ts: 1. Arial.   
+000255c0: 2043 616c 6962 7269 0a20 2020 2043 656e   Calibri.    Cen
+000255d0: 7475 7279 2047 6f74 6869 630a 2020 2020  tury Gothic.    
+000255e0: 2042 6f6c 6420 342e 200a 2020 2020 2046   Bold 4. .     F
+000255f0: 7261 6e6b 6c69 6e20 476f 7468 6963 200a  ranklin Gothic .
+00025600: 2020 2020 2042 6f6c 6420 352e 200a 2020       Bold 5. .  
+00025610: 2020 2046 7574 7572 6120 426f 6c64 2036     Futura Bold 6
+00025620: 2e20 0a20 2020 2020 4769 6c6c 2053 616e  . .     Gill San
+00025630: 7320 426f 6c64 2037 2e20 0a20 2020 2048  s Bold 7. .    H
+00025640: 656c 7665 7469 6361 2042 6f6c 6420 382e  elvetica Bold 8.
+00025650: 200a 2020 2020 496d 7061 6374 2042 6f6c   .    Impact Bol
+00025660: 6420 392e 0a20 2020 204c 7563 6964 6120  d 9..    Lucida 
+00025670: 5361 6e73 2042 6f6c 6420 3130 2e20 0a20  Sans Bold 10. . 
+00025680: 2020 204d 7972 6961 6420 5072 6f20 426f     Myriad Pro Bo
+00025690: 6c64 2031 312e 204f 7065 6e20 5361 6e73  ld 11. Open Sans
+000256a0: 2042 6f6c 6420 3132 2e20 5061 6c61 7469   Bold 12. Palati
+000256b0: 6e6f 2042 6f6c 6420 3133 2e20 526f 636b  no Bold 13. Rock
+000256c0: 7765 6c6c 2042 6f6c 6420 3134 2e20 0a20  well Bold 14. . 
+000256d0: 2020 2053 6567 6f65 2055 4920 426f 6c64     Segoe UI Bold
+000256e0: 2031 352e 2054 696d 6573 204e 6577 2052   15. Times New R
+000256f0: 6f6d 616e 2042 6f6c 6420 3136 2e20 556e  oman Bold 16. Un
+00025700: 6976 6572 7320 426f 6c64 2031 372e 2056  ivers Bold 17. V
+00025710: 6572 6461 6e61 2042 6f6c 6420 3138 2e20  erdana Bold 18. 
+00025720: 4176 656e 6972 2042 6f6c 6420 3139 2e20  Avenir Bold 19. 
+00025730: 4261 736b 6572 7669 6c6c 6520 426f 6c64  Baskerville Bold
+00025740: 2032 302e 2043 6c61 7265 6e64 6f6e 2042   20. Clarendon B
+00025750: 6f6c 6420 3231 2e20 430a 2020 2020 6f70  old 21. C.    op
+00025760: 7065 7270 6c61 7465 2042 6f6c 6420 3232  perplate Bold 22
+00025770: 2e20 4469 646f 7420 426f 6c64 2032 332e  . Didot Bold 23.
+00025780: 2045 7572 6f73 7469 6c65 2042 6f6c 6420   Eurostile Bold 
+00025790: 3234 2e20 4672 7574 6967 6572 2042 6f6c  24. Frutiger Bol
+000257a0: 6420 3235 2e20 4761 7261 6d6f 6e64 2042  d 25. Garamond B
+000257b0: 6f6c 6420 3236 2e20 4765 6f72 6769 6120  old 26. Georgia 
+000257c0: 426f 6c64 2032 372e 2047 6f74 6861 6d20  Bold 27. Gotham 
+000257d0: 426f 6c64 2032 382e 200a 2020 2020 486f  Bold 28. .    Ho
+000257e0: 6566 6c65 7220 5465 7874 2042 6f6c 6420  efler Text Bold 
+000257f0: 3239 2e20 4954 4320 4176 616e 7420 4761  29. ITC Avant Ga
+00025800: 7264 6520 476f 7468 6963 2042 6f6c 6420  rde Gothic Bold 
+00025810: 3330 2e20 4954 4320 4672 616e 6b6c 696e  30. ITC Franklin
+00025820: 2047 6f74 6869 6320 426f 6c64 2033 312e   Gothic Bold 31.
+00025830: 2049 5443 204c 7562 616c 696e 2047 7261   ITC Lubalin Gra
+00025840: 7068 2042 6f6c 6420 3332 2e20 0a20 2020  ph Bold 32. .   
+00025850: 2049 5443 204f 6666 6963 696e 6120 5361   ITC Officina Sa
+00025860: 6e73 2042 6f6c 6420 3333 2e20 4954 4320  ns Bold 33. ITC 
+00025870: 5374 6f6e 6520 5361 6e73 2042 6f6c 6420  Stone Sans Bold 
+00025880: 3334 2e20 4d69 6e69 6f6e 2050 726f 2042  34. Minion Pro B
+00025890: 6f6c 6420 3335 2e20 4d75 7365 6f20 5361  old 35. Museo Sa
+000258a0: 6e73 2042 6f6c 6420 3336 2e20 4e65 7574  ns Bold 36. Neut
+000258b0: 7261 6661 6365 2042 6f6c 6420 3337 2e20  raface Bold 37. 
+000258c0: 0a20 2020 204f 7074 696d 6120 426f 6c64  .    Optima Bold
+000258d0: 2033 382e 2050 726f 7869 6d61 204e 6f76   38. Proxima Nov
+000258e0: 6120 426f 6c64 2033 392e 2052 6f62 6f74  a Bold 39. Robot
+000258f0: 6f20 426f 6c64 2034 302e 2053 6162 6f6e  o Bold 40. Sabon
+00025900: 2042 6f6c 6420 3431 2e20 5472 6164 6520   Bold 41. Trade 
+00025910: 476f 7468 6963 2042 6f6c 6420 3432 2e20  Gothic Bold 42. 
+00025920: 0a20 2020 2054 7265 6275 6368 6574 204d  .    Trebuchet M
+00025930: 5320 426f 6c64 2034 332e 200a 2020 2020  S Bold 43. .    
+00025940: 5562 756e 7475 2042 6f6c 6420 3434 2e20  Ubuntu Bold 44. 
+00025950: 0a20 2020 2056 4147 2052 6f75 6e64 6564  .    VAG Rounded
+00025960: 2042 6f6c 6420 3435 2e20 0a20 2020 2057   Bold 45. .    W
+00025970: 6869 746e 6579 2042 6f6c 6420 3436 2e20  hitney Bold 46. 
+00025980: 0a20 2020 2058 6974 7320 426f 6c64 2034  .    Xits Bold 4
+00025990: 372e 200a 2020 2020 5961 6e6f 6e65 204b  7. .    Yanone K
+000259a0: 6166 6665 6573 6174 7a20 426f 6c64 2034  affeesatz Bold 4
+000259b0: 382e 200a 2020 2020 5a69 6c6c 6120 536c  8. .    Zilla Sl
+000259c0: 6162 0a20 2020 205a 6f6e 610a 2020 2020  ab.    Zona.    
+000259d0: 5a75 7269 6368 200a 2020 2020 2222 220a  Zurich .    """.
+000259e0: 0a20 2020 2023 2020 2020 636c 6173 7320  .    #    class 
+000259f0: 416d 6946 6f6e 743a 0a0a 2020 2020 4063  AmiFont:..    @c
+00025a00: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
+00025a10: 6566 206d 6174 6368 5f66 6f6e 745f 7072  ef match_font_pr
+00025a20: 6f70 6572 7479 2863 6c73 2c20 6e61 6d65  operty(cls, name
+00025a30: 2c20 7265 6765 7829 3a0a 2020 2020 2020  , regex):.      
+00025a40: 2020 6d61 7463 6820 3d20 7265 6765 782e    match = regex.
+00025a50: 6d61 7463 6828 6e61 6d65 290a 2020 2020  match(name).    
+00025a60: 2020 2020 6966 206d 6174 6368 3a0a 2020      if match:.  
+00025a70: 2020 2020 2020 2020 2020 6e61 6d65 203d            name =
+00025a80: 206d 6174 6368 2e67 726f 7570 2831 2920   match.group(1) 
+00025a90: 2b20 6d61 7463 682e 6772 6f75 7028 3329  + match.group(3)
+00025aa0: 2020 2320 6368 6f70 206f 7574 206d 6174    # chop out mat
+00025ab0: 6368 0a20 2020 2020 2020 2072 6574 7572  ch.        retur
+00025ac0: 6e20 6e61 6d65 2c20 6d61 7463 680a 0a20  n name, match.. 
+00025ad0: 2020 2040 636c 6173 736d 6574 686f 640a     @classmethod.
+00025ae0: 2020 2020 6465 6620 636f 6e76 6572 745f      def convert_
+00025af0: 636f 6d6d 6f6e 5f66 6f6e 7473 2863 6c73  common_fonts(cls
+00025b00: 293a 0a20 2020 2020 2020 2070 6173 730a  ):.        pass.
+00025b10: 0a20 2020 2023 2020 2020 636c 6173 7320  .    #    class 
+00025b20: 416d 6946 6f6e 743a 0a0a 2020 2020 4063  AmiFont:..    @c
+00025b30: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
+00025b40: 6566 2063 7265 6174 655f 666f 6e74 5f65  ef create_font_e
+00025b50: 6469 7465 645f 7374 796c 655f 6672 6f6d  dited_style_from
+00025b60: 5f68 6561 645f 7374 796c 6528 636c 732c  _head_style(cls,
+00025b70: 2073 7479 6c65 5f65 6c65 6d29 3a0a 2020   style_elem):.  
+00025b80: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00025b90: 2020 656d 7069 7269 6361 6c6c 7920 6372    empirically cr
+00025ba0: 6561 7465 2073 7461 6e64 6172 6420 666f  eate standard fo
+00025bb0: 6e74 7320 616e 6420 6174 7472 6962 7574  nts and attribut
+00025bc0: 6573 2066 726f 6d20 666f 6e74 206e 616d  es from font nam
+00025bd0: 6573 0a20 2020 2020 2020 203a 7061 7261  es.        :para
+00025be0: 6d20 6373 735f 7374 796c 653a 2043 5353  m css_style: CSS
+00025bf0: 5374 796c 6520 4f62 6a65 6374 206f 7220  Style Object or 
+00025c00: 4854 4d4c 2068 6561 642f 7374 796c 6520  HTML head/style 
+00025c10: 7769 7468 2075 6e6b 6e6f 776e 2066 6f6e  with unknown fon
+00025c20: 742d 6661 6d69 6c79 0a20 2020 2020 2020  t-family.       
+00025c30: 203a 7265 7475 726e 3a20 7475 706c 6520   :return: tuple 
+00025c40: 2873 796d 626f 6c5f 7265 662c 206e 6577  (symbol_ref, new
+00025c50: 2063 7373 5f73 7479 6c65 206f 626a 6563   css_style objec
+00025c60: 7420 7769 7468 2073 7461 6e64 6172 6420  t with standard 
+00025c70: 666f 6e74 2061 6e64 206d 6179 6265 206e  font and maybe n
+00025c80: 6577 2077 6569 6768 7420 6f72 2073 7479  ew weight or sty
+00025c90: 6c65 290a 2020 2020 2020 2020 2222 220a  le).        """.
+00025ca0: 2020 2020 2020 2020 6966 206e 6f74 2074          if not t
+00025cb0: 7970 6528 7374 796c 655f 656c 656d 2920  ype(style_elem) 
+00025cc0: 6973 205f 456c 656d 656e 743a 0a20 2020  is _Element:.   
+00025cd0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00025ce0: 4e6f 6e65 2c20 4e6f 6e65 0a20 2020 2020  None, None.     
+00025cf0: 2020 2073 796d 626f 6c5f 7265 662c 2063     symbol_ref, c
+00025d00: 7373 5f73 7479 6c65 203d 2043 5353 5374  ss_style = CSSSt
+00025d10: 796c 652e 6372 6561 7465 5f63 7373 5f73  yle.create_css_s
+00025d20: 7479 6c65 5f66 726f 6d5f 6874 6d6c 5f68  tyle_from_html_h
+00025d30: 6561 645f 7374 796c 655f 656c 656d 2873  ead_style_elem(s
+00025d40: 7479 6c65 5f65 6c65 6d29 0a20 2020 2020  tyle_elem).     
+00025d50: 2020 2069 6620 6373 735f 7374 796c 6520     if css_style 
+00025d60: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+00025d70: 2020 2020 2020 2020 2066 6f6e 745f 6661           font_fa
+00025d80: 6d69 6c79 203d 2063 7373 5f73 7479 6c65  mily = css_style
+00025d90: 2e66 6f6e 745f 6661 6d69 6c79 0a20 2020  .font_family.   
+00025da0: 2020 2020 2020 2020 2061 6d69 5f66 6f6e           ami_fon
+00025db0: 7420 3d20 416d 6946 6f6e 742e 6578 7472  t = AmiFont.extr
+00025dc0: 6163 745f 6e61 6d65 5f77 6569 6768 745f  act_name_weight_
+00025dd0: 7374 796c 655f 7374 7265 7463 6865 645f  style_stretched_
+00025de0: 6173 5f66 6f6e 7428 666f 6e74 5f66 616d  as_font(font_fam
+00025df0: 696c 7929 0a20 2020 2020 2020 2020 2020  ily).           
+00025e00: 206e 6577 5f63 7373 5f73 7479 6c65 203d   new_css_style =
+00025e10: 2043 5353 5374 796c 6528 290a 2020 2020   CSSStyle().    
+00025e20: 2020 2020 2020 2020 666f 7220 6974 656d          for item
+00025e30: 2069 6e20 6373 735f 7374 796c 652e 6e61   in css_style.na
+00025e40: 6d65 5f76 616c 7565 5f64 6963 743a 0a20  me_value_dict:. 
+00025e50: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+00025e60: 6577 5f63 7373 5f73 7479 6c65 2e6e 616d  ew_css_style.nam
+00025e70: 655f 7661 6c75 655f 6469 6374 5b69 7465  e_value_dict[ite
+00025e80: 6d5b 305d 5d20 3d20 6974 656d 5b31 5d0a  m[0]] = item[1].
+00025e90: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
+00025ea0: 6373 735f 7374 796c 652e 7365 745f 6174  css_style.set_at
+00025eb0: 7472 6962 7574 6528 464f 4e54 5f46 414d  tribute(FONT_FAM
+00025ec0: 494c 592c 2061 6d69 5f66 6f6e 742e 6661  ILY, ami_font.fa
+00025ed0: 6d69 6c79 290a 2020 2020 2020 2020 2020  mily).          
+00025ee0: 2020 6e65 775f 6373 735f 7374 796c 652e    new_css_style.
+00025ef0: 7365 745f 6174 7472 6962 7574 6528 464f  set_attribute(FO
+00025f00: 4e54 5f57 4549 4748 542c 2061 6d69 5f66  NT_WEIGHT, ami_f
+00025f10: 6f6e 742e 7765 6967 6874 290a 2020 2020  ont.weight).    
+00025f20: 2020 2020 2020 2020 6e65 775f 6373 735f          new_css_
+00025f30: 7374 796c 652e 7365 745f 6174 7472 6962  style.set_attrib
+00025f40: 7574 6528 464f 4e54 5f53 5459 4c45 2c20  ute(FONT_STYLE, 
+00025f50: 616d 695f 666f 6e74 2e73 7479 6c65 290a  ami_font.style).
+00025f60: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
+00025f70: 6373 735f 7374 796c 652e 7365 745f 6174  css_style.set_at
+00025f80: 7472 6962 7574 6528 464f 4e54 5f53 5452  tribute(FONT_STR
+00025f90: 4554 4348 4544 2c20 616d 695f 666f 6e74  ETCHED, ami_font
+00025fa0: 2e73 7472 6574 6368 6564 290a 2020 2020  .stretched).    
+00025fb0: 2020 2020 7265 7475 726e 2073 796d 626f      return symbo
+00025fc0: 6c5f 7265 662c 206e 6577 5f63 7373 5f73  l_ref, new_css_s
+00025fd0: 7479 6c65 0a0a 2020 2020 4063 6c61 7373  tyle..    @class
+00025fe0: 6d65 7468 6f64 0a20 2020 2064 6566 2063  method.    def c
+00025ff0: 7265 6174 655f 666f 6e74 5f65 6469 7465  reate_font_edite
+00026000: 645f 7374 796c 655f 6672 6f6d 5f63 7373  d_style_from_css
+00026010: 5f73 7479 6c65 5f6f 626a 6563 7428 636c  _style_object(cl
+00026020: 732c 2063 7373 5f73 7479 6c65 293a 0a20  s, css_style):. 
+00026030: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00026040: 2020 2065 6d70 6972 6963 616c 6c79 2063     empirically c
+00026050: 7265 6174 6520 7374 616e 6461 7264 2066  reate standard f
+00026060: 6f6e 7473 2061 6e64 2061 7474 7269 6275  onts and attribu
+00026070: 7465 7320 6672 6f6d 2066 6f6e 7420 6e61  tes from font na
+00026080: 6d65 730a 2020 2020 2020 2020 3a70 6172  mes.        :par
+00026090: 616d 2063 7373 5f73 7479 6c65 3a20 4353  am css_style: CS
+000260a0: 5353 7479 6c65 204f 626a 6563 7420 6f72  SStyle Object or
+000260b0: 2048 544d 4c20 6865 6164 2f73 7479 6c65   HTML head/style
+000260c0: 2077 6974 6820 756e 6b6e 6f77 6e20 666f   with unknown fo
+000260d0: 6e74 2d66 616d 696c 790a 2020 2020 2020  nt-family.      
+000260e0: 2020 3a72 6574 7572 6e3a 2074 7570 6c65    :return: tuple
+000260f0: 2028 7379 6d62 6f6c 5f72 6566 2c20 6e65   (symbol_ref, ne
+00026100: 7720 6373 735f 7374 796c 6520 6f62 6a65  w css_style obje
+00026110: 6374 2077 6974 6820 7374 616e 6461 7264  ct with standard
+00026120: 2066 6f6e 7420 616e 6420 6d61 7962 6520   font and maybe 
+00026130: 6e65 7720 7765 6967 6874 206f 7220 7374  new weight or st
+00026140: 796c 6529 0a20 2020 2020 2020 2022 2222  yle).        """
+00026150: 0a0a 2020 2020 2020 2020 6966 2063 7373  ..        if css
+00026160: 5f73 7479 6c65 2069 7320 4e6f 6e65 3a0a  _style is None:.
+00026170: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00026180: 726e 204e 6f6e 650a 2020 2020 2020 2020  rn None.        
+00026190: 6966 2074 7970 6528 6373 735f 7374 796c  if type(css_styl
+000261a0: 6529 2069 7320 4554 2e5f 456c 656d 656e  e) is ET._Elemen
+000261b0: 743a 0a20 2020 2020 2020 2020 2020 2070  t:.            p
+000261c0: 7269 6e74 2866 2265 6c65 6d65 6e74 207b  rint(f"element {
+000261d0: 4554 2e74 6f73 7472 696e 6728 6373 735f  ET.tostring(css_
+000261e0: 7374 796c 6529 7d22 290a 2020 2020 2020  style)}").      
+000261f0: 2020 6966 2074 7970 6528 6373 735f 7374    if type(css_st
+00026200: 796c 6529 2069 7320 7374 723a 0a20 2020  yle) is str:.   
+00026210: 2020 2020 2020 2020 2063 7373 5f73 7479           css_sty
+00026220: 6c65 203d 2043 5353 5374 796c 652e 6372  le = CSSStyle.cr
+00026230: 6561 7465 5f63 7373 5f73 7479 6c65 5f66  eate_css_style_f
+00026240: 726f 6d5f 6373 735f 7374 7269 6e67 2863  rom_css_string(c
+00026250: 7373 5f73 7479 6c65 290a 2020 2020 2020  ss_style).      
+00026260: 2020 6966 2063 7373 5f73 7479 6c65 2069    if css_style i
+00026270: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+00026280: 2020 2020 7265 7475 726e 204e 6f6e 650a      return None.
+00026290: 2020 2020 2020 2020 6173 7365 7274 2074          assert t
+000262a0: 7970 6528 6373 735f 7374 796c 6529 2069  ype(css_style) i
+000262b0: 7320 4353 5353 7479 6c65 2c20 6622 666f  s CSSStyle, f"fo
+000262c0: 756e 6420 7b74 7970 6528 6373 735f 7374  und {type(css_st
+000262d0: 796c 6529 7d22 0a20 2020 2020 2020 2069  yle)}".        i
+000262e0: 6620 6e6f 7420 6373 735f 7374 796c 652e  f not css_style.
+000262f0: 666f 6e74 5f66 616d 696c 793a 0a20 2020  font_family:.   
+00026300: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00026310: 6373 735f 7374 796c 650a 2020 2020 2020  css_style.      
+00026320: 2020 616d 695f 666f 6e74 203d 2041 6d69    ami_font = Ami
+00026330: 466f 6e74 2e65 7874 7261 6374 5f6e 616d  Font.extract_nam
+00026340: 655f 7765 6967 6874 5f73 7479 6c65 5f73  e_weight_style_s
+00026350: 7472 6574 6368 6564 5f61 735f 666f 6e74  tretched_as_font
+00026360: 2863 7373 5f73 7479 6c65 2e66 6f6e 745f  (css_style.font_
+00026370: 6661 6d69 6c79 290a 2020 2020 2020 2020  family).        
+00026380: 6e65 775f 6373 735f 7374 796c 6520 3d20  new_css_style = 
+00026390: 4353 5353 7479 6c65 2829 0a20 2020 2020  CSSStyle().     
+000263a0: 2020 2066 6f72 2069 7465 6d20 696e 2063     for item in c
+000263b0: 7373 5f73 7479 6c65 2e6e 616d 655f 7661  ss_style.name_va
+000263c0: 6c75 655f 6469 6374 2e69 7465 6d73 2829  lue_dict.items()
+000263d0: 3a0a 2020 2020 2020 2020 2020 2020 6e65  :.            ne
+000263e0: 775f 6373 735f 7374 796c 652e 6e61 6d65  w_css_style.name
+000263f0: 5f76 616c 7565 5f64 6963 745b 6974 656d  _value_dict[item
+00026400: 5b30 5d5d 203d 2069 7465 6d5b 315d 0a20  [0]] = item[1]. 
+00026410: 2020 2020 2020 206e 6577 5f63 7373 5f73         new_css_s
+00026420: 7479 6c65 2e73 6574 5f61 7474 7269 6275  tyle.set_attribu
+00026430: 7465 2846 4f4e 545f 4e41 4d45 2c20 7374  te(FONT_NAME, st
+00026440: 7228 616d 695f 666f 6e74 2e6e 616d 6529  r(ami_font.name)
+00026450: 290a 2020 2020 2020 2020 6e65 775f 6373  ).        new_cs
+00026460: 735f 7374 796c 652e 7365 745f 6174 7472  s_style.set_attr
+00026470: 6962 7574 6528 464f 4e54 5f46 4f4e 542c  ibute(FONT_FONT,
+00026480: 2073 7472 2861 6d69 5f66 6f6e 742e 666f   str(ami_font.fo
+00026490: 6e74 2929 0a20 2020 2020 2020 206e 6577  nt)).        new
+000264a0: 5f63 7373 5f73 7479 6c65 2e73 6574 5f61  _css_style.set_a
+000264b0: 7474 7269 6275 7465 2846 4f4e 545f 4641  ttribute(FONT_FA
+000264c0: 4d49 4c59 2c20 7374 7228 616d 695f 666f  MILY, str(ami_fo
+000264d0: 6e74 2e66 616d 696c 7929 290a 2020 2020  nt.family)).    
+000264e0: 2020 2020 6e65 775f 6373 735f 7374 796c      new_css_styl
+000264f0: 652e 7365 745f 6174 7472 6962 7574 6528  e.set_attribute(
+00026500: 464f 4e54 5f57 4549 4748 542c 2073 7472  FONT_WEIGHT, str
+00026510: 2861 6d69 5f66 6f6e 742e 7765 6967 6874  (ami_font.weight
+00026520: 292e 6c6f 7765 7228 2929 0a20 2020 2020  ).lower()).     
+00026530: 2020 206e 6577 5f63 7373 5f73 7479 6c65     new_css_style
+00026540: 2e73 6574 5f61 7474 7269 6275 7465 2846  .set_attribute(F
+00026550: 4f4e 545f 5354 594c 452c 2073 7472 2861  ONT_STYLE, str(a
+00026560: 6d69 5f66 6f6e 742e 7374 796c 6529 2e6c  mi_font.style).l
+00026570: 6f77 6572 2829 290a 2020 2020 2020 2020  ower()).        
+00026580: 6e65 775f 6373 735f 7374 796c 652e 7365  new_css_style.se
+00026590: 745f 6174 7472 6962 7574 6528 464f 4e54  t_attribute(FONT
+000265a0: 5f53 5452 4554 4348 4544 2c20 7374 7228  _STRETCHED, str(
+000265b0: 616d 695f 666f 6e74 2e73 7472 6574 6368  ami_font.stretch
+000265c0: 6564 292e 6c6f 7765 7228 2929 0a20 2020  ed).lower()).   
+000265d0: 2020 2020 2072 6574 7572 6e20 6e65 775f       return new_
+000265e0: 6373 735f 7374 796c 650a 0a20 2020 2023  css_style..    #
+000265f0: 2020 2020 636c 6173 7320 416d 6946 6f6e      class AmiFon
+00026600: 743a 0a0a 2020 2020 4070 726f 7065 7274  t:..    @propert
+00026610: 790a 2020 2020 6465 6620 6973 5f62 6f6c  y.    def is_bol
+00026620: 6428 7365 6c66 293a 0a20 2020 2020 2020  d(self):.       
+00026630: 2072 6574 7572 6e20 7374 7228 466f 6e74   return str(Font
+00026640: 5072 6f70 6572 7479 2e42 4f4c 4429 203d  Property.BOLD) =
+00026650: 3d20 7365 6c66 2e77 6569 6768 740a 0a20  = self.weight.. 
+00026660: 2020 2040 7072 6f70 6572 7479 0a20 2020     @property.   
+00026670: 2064 6566 2069 735f 6974 616c 6963 2873   def is_italic(s
+00026680: 656c 6629 3a0a 2020 2020 2020 2020 7265  elf):.        re
+00026690: 7475 726e 2073 7472 2846 6f6e 7450 726f  turn str(FontPro
+000266a0: 7065 7274 792e 4954 414c 4943 2920 3d3d  perty.ITALIC) ==
+000266b0: 2073 656c 662e 7374 796c 650a 0a20 2020   self.style..   
+000266c0: 2040 636c 6173 736d 6574 686f 640a 2020   @classmethod.  
+000266d0: 2020 6465 6620 7472 696d 5f70 6466 5f70    def trim_pdf_p
+000266e0: 7265 6669 7828 636c 732c 206e 616d 6529  refix(cls, name)
+000266f0: 3a0a 2020 2020 2020 2020 2222 2272 656d  :.        """rem
+00026700: 6f76 6573 2074 6865 2041 4243 4445 462b  oves the ABCDEF+
+00026710: 2070 7265 6669 7820 6672 6f6d 2066 6f6e   prefix from fon
+00026720: 742d 6e61 6d65 0a20 2020 2020 2020 2054  t-name.        T
+00026730: 6869 7320 7072 6566 6978 2073 6572 7665  his prefix serve
+00026740: 7320 6e6f 2075 7365 6675 6c20 7075 7270  s no useful purp
+00026750: 6f73 6520 666f 7220 7465 7874 2061 6e61  ose for text ana
+00026760: 6c79 7369 7320 616e 6420 6973 2064 6973  lysis and is dis
+00026770: 6361 7264 6564 2222 220a 2020 2020 2020  carded""".      
+00026780: 2020 6966 206e 616d 653a 0a20 2020 2020    if name:.     
+00026790: 2020 2020 2020 206d 6174 6368 203d 2052         match = R
+000267a0: 455f 5052 4546 2e6d 6174 6368 286e 616d  E_PREF.match(nam
+000267b0: 6529 0a20 2020 2020 2020 2020 2020 2069  e).            i
+000267c0: 6620 6d61 7463 683a 0a20 2020 2020 2020  f match:.       
+000267d0: 2020 2020 2020 2020 206e 616d 6520 3d20           name = 
+000267e0: 6d61 7463 682e 6772 6f75 7028 226e 616d  match.group("nam
+000267f0: 6522 290a 2020 2020 2020 2020 7265 7475  e").        retu
+00026800: 726e 206e 616d 650a 0a0a 636c 6173 7320  rn name...class 
+00026810: 5365 6374 696f 6e48 6965 7261 7263 6879  SectionHierarchy
+00026820: 3a0a 2020 2020 2222 220a 2020 2020 6275  :.    """.    bu
+00026830: 696c 6473 2061 6e64 2071 7565 7269 6573  ilds and queries
+00026840: 2068 6965 7261 7263 6869 6361 6c20 7365   hierarchical se
+00026850: 6374 696f 6e73 0a20 2020 2022 2222 0a0a  ctions.    """..
+00026860: 2020 2020 4944 203d 2022 6964 220a 2020      ID = "id".  
+00026870: 2020 434c 4153 5320 3d20 2763 6c61 7373    CLASS = 'class
+00026880: 270a 2020 2020 444f 5420 3d20 222e 220a  '.    DOT = ".".
+00026890: 2020 2020 4d49 5353 494e 4720 3d20 226d      MISSING = "m
+000268a0: 6973 7369 6e67 220a 2020 2020 5345 4354  issing".    SECT
+000268b0: 203d 2022 7365 6374 220a 0a20 2020 2064   = "sect"..    d
+000268c0: 6566 205f 5f69 6e69 745f 5f28 7365 6c66  ef __init__(self
+000268d0: 293a 0a20 2020 2020 2020 2070 6173 730a  ):.        pass.
+000268e0: 0a20 2020 2064 6566 2061 6464 5f73 6563  .    def add_sec
+000268f0: 7469 6f6e 7328 7365 6c66 2c20 6465 6369  tions(self, deci
+00026900: 6d61 6c5f 7365 6374 696f 6e73 2c20 746f  mal_sections, to
+00026910: 703d 4e6f 6e65 2c20 706f 706c 6973 743d  p=None, poplist=
+00026920: 4e6f 6e65 293a 0a20 2020 2020 2020 2069  None):.        i
+00026930: 6620 6e6f 7420 706f 706c 6973 743a 0a20  f not poplist:. 
+00026940: 2020 2020 2020 2020 2020 2070 6f70 6c69             popli
+00026950: 7374 203d 205b 5d0a 2020 2020 2020 2020  st = [].        
+00026960: 7365 6374 696f 6e73 5f62 795f 6c65 7665  sections_by_leve
+00026970: 6c20 3d20 7365 6c66 2e63 7265 6174 655f  l = self.create_
+00026980: 7365 6374 696f 6e73 5f62 795f 6c65 7665  sections_by_leve
+00026990: 6c28 6465 6369 6d61 6c5f 7365 6374 696f  l(decimal_sectio
+000269a0: 6e73 290a 2020 2020 2020 2020 7061 7265  ns).        pare
+000269b0: 6e74 5f64 6963 7420 3d20 7365 6c66 2e63  nt_dict = self.c
+000269c0: 7265 6174 655f 7061 7265 6e74 5f64 6963  reate_parent_dic
+000269d0: 7428 7365 6374 696f 6e73 5f62 795f 6c65  t(sections_by_le
+000269e0: 7665 6c29 0a20 2020 2020 2020 2066 6f72  vel).        for
+000269f0: 2070 6f70 2069 6e20 706f 706c 6973 743a   pop in poplist:
+00026a00: 0a20 2020 2020 2020 2020 2020 2074 7279  .            try
+00026a10: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00026a20: 2020 7061 7265 6e74 5f64 6963 742e 706f    parent_dict.po
+00026a30: 7028 706f 7029 2020 2320 7265 6d6f 7665  p(pop)  # remove
+00026a40: 206e 6f6e 2d6e 756d 6572 6963 2069 7465   non-numeric ite
+00026a50: 6d0a 2020 2020 2020 2020 2020 2020 6578  m.            ex
+00026a60: 6365 7074 3a0a 2020 2020 2020 2020 2020  cept:.          
+00026a70: 2020 2020 2020 7072 696e 7428 2243 616e        print("Can
+00026a80: 6e6f 7420 706f 7020 7b70 6f70 7d22 290a  not pop {pop}").
+00026a90: 0a20 2020 2020 2020 2072 6f6f 7420 3d20  .        root = 
+00026aa0: 456c 656d 656e 7428 7365 6c66 2e53 4543  Element(self.SEC
+00026ab0: 5429 0a20 2020 2020 2020 2072 6f6f 742e  T).        root.
+00026ac0: 6174 7472 6962 5b73 656c 662e 4944 5d20  attrib[self.ID] 
+00026ad0: 3d20 2234 220a 2020 2020 2020 2020 666f  = "4".        fo
+00026ae0: 7220 7365 6374 5f69 6420 696e 2070 6172  r sect_id in par
+00026af0: 656e 745f 6469 6374 2e6b 6579 7328 293a  ent_dict.keys():
+00026b00: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00026b10: 662e 656e 7375 7265 5f65 6c65 6d65 6e74  f.ensure_element
+00026b20: 2872 6f6f 742c 2073 6563 745f 6964 2c20  (root, sect_id, 
+00026b30: 7061 7265 6e74 5f64 6963 7429 0a0a 2020  parent_dict)..  
+00026b40: 2020 6465 6620 6372 6561 7465 5f70 6172    def create_par
+00026b50: 656e 745f 6469 6374 2873 656c 662c 2073  ent_dict(self, s
+00026b60: 6563 7469 6f6e 735f 6279 5f6c 6576 656c  ections_by_level
+00026b70: 293a 0a20 2020 2020 2020 2070 6172 656e  ):.        paren
+00026b80: 745f 6469 6374 203d 2064 6963 7428 290a  t_dict = dict().
+00026b90: 2020 2020 2020 2020 666f 7220 6c65 7665          for leve
+00026ba0: 6c20 696e 2073 6563 7469 6f6e 735f 6279  l in sections_by
+00026bb0: 5f6c 6576 656c 2e6b 6579 7328 293a 0a20  _level.keys():. 
+00026bc0: 2020 2020 2020 2020 2020 2073 6563 745f             sect_
+00026bd0: 6964 7320 3d20 7365 6c66 2e61 6464 5f70  ids = self.add_p
+00026be0: 6172 656e 7473 286c 6576 656c 2c20 7365  arents(level, se
+00026bf0: 6374 696f 6e73 5f62 795f 6c65 7665 6c2c  ctions_by_level,
+00026c00: 2070 6172 656e 745f 6469 6374 290a 2020   parent_dict).  
+00026c10: 2020 2020 2020 7265 7475 726e 2070 6172        return par
+00026c20: 656e 745f 6469 6374 0a0a 2020 2020 6465  ent_dict..    de
+00026c30: 6620 6372 6561 7465 5f73 6563 7469 6f6e  f create_section
+00026c40: 735f 6279 5f6c 6576 656c 2873 656c 662c  s_by_level(self,
+00026c50: 2064 6563 696d 616c 5f73 6563 7469 6f6e   decimal_section
+00026c60: 7329 3a0a 2020 2020 2020 2020 7365 6374  s):.        sect
+00026c70: 696f 6e73 5f62 795f 6c65 7665 6c20 3d20  ions_by_level = 
+00026c80: 6465 6661 756c 7464 6963 7428 6c69 7374  defaultdict(list
+00026c90: 290a 2020 2020 2020 2020 666f 7220 7365  ).        for se
+00026ca0: 6374 696f 6e20 696e 2064 6563 696d 616c  ction in decimal
+00026cb0: 5f73 6563 7469 6f6e 733a 0a20 2020 2020  _sections:.     
+00026cc0: 2020 2020 2020 206c 6576 656c 203d 2073         level = s
+00026cd0: 6563 7469 6f6e 2e61 7474 7269 622e 6765  ection.attrib.ge
+00026ce0: 7428 7365 6c66 2e43 4c41 5353 292e 7370  t(self.CLASS).sp
+00026cf0: 6c69 7428 295b 315d 0a20 2020 2020 2020  lit()[1].       
+00026d00: 2020 2020 2073 6563 7469 6f6e 735f 6279       sections_by
+00026d10: 5f6c 6576 656c 5b6c 6576 656c 5d2e 6170  _level[level].ap
+00026d20: 7065 6e64 2873 6563 7469 6f6e 2e74 6578  pend(section.tex
+00026d30: 7429 0a20 2020 2020 2020 2072 6574 7572  t).        retur
+00026d40: 6e20 7365 6374 696f 6e73 5f62 795f 6c65  n sections_by_le
+00026d50: 7665 6c0a 0a20 2020 2064 6566 2061 6464  vel..    def add
+00026d60: 5f70 6172 656e 7473 2873 656c 662c 206c  _parents(self, l
+00026d70: 6576 656c 2c20 6d75 6c74 6964 6963 742c  evel, multidict,
+00026d80: 2070 6172 656e 745f 6469 6374 293a 0a20   parent_dict):. 
+00026d90: 2020 2020 2020 206c 6576 656c 5f73 6563         level_sec
+00026da0: 7473 203d 206d 756c 7469 6469 6374 5b6c  ts = multidict[l
+00026db0: 6576 656c 5d0a 2020 2020 2020 2020 666f  evel].        fo
+00026dc0: 7220 6c65 7665 6c5f 7365 6374 2069 6e20  r level_sect in 
+00026dd0: 6c65 7665 6c5f 7365 6374 733a 0a20 2020  level_sects:.   
+00026de0: 2020 2020 2020 2020 2070 6172 656e 7420           parent 
+00026df0: 3d20 7365 6c66 2e67 6574 5f70 6172 656e  = self.get_paren
+00026e00: 7428 6c65 7665 6c5f 7365 6374 290a 2020  t(level_sect).  
+00026e10: 2020 2020 2020 2020 2020 7061 7265 6e74            parent
+00026e20: 5f64 6963 745b 6c65 7665 6c5f 7365 6374  _dict[level_sect
+00026e30: 5d20 3d20 7061 7265 6e74 0a0a 2020 2020  ] = parent..    
+00026e40: 6465 6620 6765 745f 7061 7265 6e74 2873  def get_parent(s
+00026e50: 656c 662c 206c 6576 656c 5f73 6563 7429  elf, level_sect)
+00026e60: 3a0a 2020 2020 2020 2020 6269 7473 203d  :.        bits =
+00026e70: 206c 6576 656c 5f73 6563 742e 7370 6c69   level_sect.spli
+00026e80: 7428 222e 2229 0a20 2020 2020 2020 2070  t(".").        p
+00026e90: 6172 656e 7420 3d20 4e6f 6e65 2069 6620  arent = None if 
+00026ea0: 6c65 6e28 6269 7473 2920 3d3d 2031 2065  len(bits) == 1 e
+00026eb0: 6c73 6520 7365 6c66 2e44 4f54 2e6a 6f69  lse self.DOT.joi
+00026ec0: 6e28 6269 7473 5b3a 2d31 5d29 0a20 2020  n(bits[:-1]).   
+00026ed0: 2020 2020 2072 6574 7572 6e20 7061 7265       return pare
+00026ee0: 6e74 0a0a 2020 2020 6465 6620 656e 7375  nt..    def ensu
+00026ef0: 7265 5f65 6c65 6d65 6e74 2873 656c 662c  re_element(self,
+00026f00: 2072 6f6f 742c 2073 6563 745f 6964 2c20   root, sect_id, 
+00026f10: 7061 7265 6e74 5f64 6963 7429 3a0a 2020  parent_dict):.  
+00026f20: 2020 2020 2020 6966 2073 6563 745f 6964        if sect_id
+00026f30: 203d 3d20 2222 3a0a 2020 2020 2020 2020   == "":.        
+00026f40: 2020 2020 7072 696e 7428 6622 5241 4e20      print(f"RAN 
+00026f50: 4f46 4620 544f 5022 290a 2020 2020 2020  OFF TOP").      
+00026f60: 2020 2020 2020 7265 7475 726e 204e 6f6e        return Non
+00026f70: 650a 2020 2020 2020 2020 7870 6174 6820  e.        xpath 
+00026f80: 3d20 6622 2f2f 7b73 656c 662e 5345 4354  = f"//{self.SECT
+00026f90: 7d5b 4069 643d 277b 7365 6374 5f69 647d  }[@id='{sect_id}
+00026fa0: 275d 220a 2020 2020 2020 2020 656c 656d  ']".        elem
+00026fb0: 7320 3d20 726f 6f74 2e78 7061 7468 2878  s = root.xpath(x
+00026fc0: 7061 7468 290a 2020 2020 2020 2020 6966  path).        if
+00026fd0: 206c 656e 2865 6c65 6d73 2920 3d3d 2030   len(elems) == 0
+00026fe0: 3a0a 2020 2020 2020 2020 2020 2020 7061  :.            pa
+00026ff0: 7265 6e74 5f69 6420 3d20 7061 7265 6e74  rent_id = parent
+00027000: 5f64 6963 742e 6765 7428 7365 6374 5f69  _dict.get(sect_i
+00027010: 6429 0a20 2020 2020 2020 2020 2020 206d  d).            m
+00027020: 6973 7369 6e67 203d 2046 616c 7365 0a20  issing = False. 
+00027030: 2020 2020 2020 2020 2020 2069 6620 7061             if pa
+00027040: 7265 6e74 5f69 6420 6973 204e 6f6e 653a  rent_id is None:
+00027050: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00027060: 2070 7269 6e74 2866 2220 6d69 7373 696e   print(f" missin
+00027070: 6720 7061 7265 6e74 2073 6563 7469 6f6e  g parent section
+00027080: 207b 7365 6374 5f69 647d 2229 0a20 2020   {sect_id}").   
+00027090: 2020 2020 2020 2020 2020 2020 206d 6973               mis
+000270a0: 7369 6e67 203d 2054 7275 650a 2020 2020  sing = True.    
+000270b0: 2020 2020 2020 2020 2020 2020 7370 6c20              spl 
+000270c0: 3d20 7365 6374 5f69 642e 7370 6c69 7428  = sect_id.split(
+000270d0: 7365 6c66 2e44 4f54 290a 2020 2020 2020  self.DOT).      
+000270e0: 2020 2020 2020 2020 2020 7370 6c69 745f            split_
+000270f0: 203d 2073 706c 5b3a 2d31 5d0a 2020 2020   = spl[:-1].    
+00027100: 2020 2020 2020 2020 2020 2020 7061 7265              pare
+00027110: 6e74 5f69 6420 3d20 7365 6c66 2e44 4f54  nt_id = self.DOT
+00027120: 2e6a 6f69 6e28 7370 6c69 745f 290a 2020  .join(split_).  
+00027130: 2020 2020 2020 2020 2020 6966 2070 6172            if par
+00027140: 656e 745f 6964 203d 3d20 2222 3a0a 2020  ent_id == "":.  
+00027150: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+00027160: 696e 7428 6622 2073 6b69 7020 726f 6f74  int(f" skip root
+00027170: 2e2e 2e22 290a 2020 2020 2020 2020 2020  ...").          
+00027180: 2020 656c 656d 203d 2073 656c 662e 656e    elem = self.en
+00027190: 7375 7265 5f65 6c65 6d65 6e74 2872 6f6f  sure_element(roo
+000271a0: 742c 2070 6172 656e 745f 6964 2c20 7061  t, parent_id, pa
+000271b0: 7265 6e74 5f64 6963 7429 0a20 2020 2020  rent_dict).     
+000271c0: 2020 2020 2020 2069 6620 656c 656d 2069         if elem i
+000271d0: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+000271e0: 2020 2020 2020 2020 2020 2020 7365 6374              sect
+000271f0: 5f78 6d6c 203d 2045 542e 5375 6245 6c65  _xml = ET.SubEle
+00027200: 6d65 6e74 2865 6c65 6d2c 2073 656c 662e  ment(elem, self.
+00027210: 5345 4354 290a 2020 2020 2020 2020 2020  SECT).          
+00027220: 2020 2020 2020 7365 6374 5f78 6d6c 2e61        sect_xml.a
+00027230: 7474 7269 625b 7365 6c66 2e49 445d 203d  ttrib[self.ID] =
+00027240: 2073 6563 745f 6964 0a20 2020 2020 2020   sect_id.       
+00027250: 2020 2020 2020 2020 2069 6620 6d69 7373           if miss
+00027260: 696e 673a 0a20 2020 2020 2020 2020 2020  ing:.           
+00027270: 2020 2020 2020 2020 2073 6563 745f 786d           sect_xm
+00027280: 6c2e 6174 7472 6962 5b73 656c 662e 4d49  l.attrib[self.MI
+00027290: 5353 494e 475d 203d 2022 5922 0a20 2020  SSING] = "Y".   
+000272a0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+000272b0: 7572 6e20 7365 6374 5f78 6d6c 0a20 2020  urn sect_xml.   
+000272c0: 2020 2020 2065 6c69 6620 6c65 6e28 656c       elif len(el
+000272d0: 656d 7329 203e 2031 3a0a 2020 2020 2020  ems) > 1:.      
+000272e0: 2020 2020 2020 7072 696e 7428 6622 2064        print(f" d
+000272f0: 7570 6c69 6361 7465 2069 6473 3a20 7b73  uplicate ids: {s
+00027300: 6563 745f 6964 7d22 290a 2020 2020 2020  ect_id}").      
+00027310: 2020 2020 2020 7265 7475 726e 204e 6f6e        return Non
+00027320: 650a 2020 2020 2020 2020 656c 7365 3a0a  e.        else:.
+00027330: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00027340: 726e 2065 6c65 6d73 5b30 5d0a 0a20 2020  rn elems[0]..   
+00027350: 2064 6566 2073 6f72 745f 7365 6374 696f   def sort_sectio
+00027360: 6e73 2873 656c 6629 3a0a 2020 2020 2020  ns(self):.      
+00027370: 2020 7072 696e 7428 2273 6f72 7420 7365    print("sort se
+00027380: 6374 696f 6e73 204e 5949 2229 0a20 2020  ctions NYI").   
+00027390: 2020 2020 2070 6173 730a 0a20 2020 2040       pass..    @
+000273a0: 636c 6173 736d 6574 686f 640a 2020 2020  classmethod.    
+000273b0: 6465 6620 736f 7274 5f69 6473 2863 6c73  def sort_ids(cls
+000273c0: 293a 0a20 2020 2020 2020 2070 6173 730a  ):.        pass.
+000273d0: 0a0a 636c 6173 7320 466f 6f74 6e6f 7465  ..class Footnote
+000273e0: 3a0a 2020 2020 2222 2265 7874 7261 6374  :.    """extract
+000273f0: 7320 666f 6f74 6e6f 7465 7320 6279 2073  s footnotes by s
+00027400: 697a 6520 616e 6420 7374 796c 6520 616e  ize and style an
+00027410: 6420 7065 7268 6170 7320 706f 7369 7469  d perhaps positi
+00027420: 6f6d 0a20 2020 2022 2222 0a0a 2020 2020  om.    """..    
+00027430: 4063 6c61 7373 6d65 7468 6f64 0a20 2020  @classmethod.   
+00027440: 2064 6566 2065 7874 7261 6374 5f66 6f6f   def extract_foo
+00027450: 746e 6f74 6573 2863 6c73 2c20 666e 5f78  tnotes(cls, fn_x
+00027460: 7061 7468 2c20 666f 6f74 6e6f 7465 5f74  path, footnote_t
+00027470: 6578 745f 636c 6173 7365 732c 2068 746d  ext_classes, htm
+00027480: 6c5f 656c 656d 293a 0a20 2020 2020 2020  l_elem):.       
+00027490: 206e 6577 5f68 746d 6c5f 656c 656d 203d   new_html_elem =
+000274a0: 2048 746d 6c4c 6962 2e63 7265 6174 655f   HtmlLib.create_
+000274b0: 6e65 775f 6874 6d6c 5f77 6974 685f 6f6c  new_html_with_ol
+000274c0: 645f 7374 796c 6573 2868 746d 6c5f 656c  d_styles(html_el
+000274d0: 656d 290a 2020 2020 2020 2020 666f 6f74  em).        foot
+000274e0: 6e6f 7465 5f6e 756d 6265 725f 666f 6e74  note_number_font
+000274f0: 5f65 6c65 6d73 203d 2068 746d 6c5f 656c  _elems = html_el
+00027500: 656d 2e78 7061 7468 2866 6e5f 7870 6174  em.xpath(fn_xpat
+00027510: 6829 0a20 2020 2020 2020 206c 6173 745f  h).        last_
+00027520: 666f 6f74 6e75 6d20 3d20 300a 2020 2020  footnum = 0.    
+00027530: 2020 2020 756c 203d 2045 542e 456c 656d      ul = ET.Elem
+00027540: 656e 7428 2275 6c22 290a 2020 2020 2020  ent("ul").      
+00027550: 2020 4874 6d6c 4c69 622e 6765 745f 626f    HtmlLib.get_bo
+00027560: 6479 286e 6577 5f68 746d 6c5f 656c 656d  dy(new_html_elem
+00027570: 292e 6170 7065 6e64 2875 6c29 0a20 2020  ).append(ul).   
+00027580: 2020 2020 2023 206d 6573 7379 2c20 6e65       # messy, ne
+00027590: 6564 2061 2046 6f6f 746e 6f74 6520 6f62  ed a Footnote ob
+000275a0: 6a65 6374 2068 6572 650a 2020 2020 2020  ject here.      
+000275b0: 2020 666f 7220 666f 6f74 6e6f 7465 5f6e    for footnote_n
+000275c0: 756d 6265 725f 656c 656d 2069 6e20 666f  umber_elem in fo
+000275d0: 6f74 6e6f 7465 5f6e 756d 6265 725f 666f  otnote_number_fo
+000275e0: 6e74 5f65 6c65 6d73 3a0a 2020 2020 2020  nt_elems:.      
+000275f0: 2020 2020 2020 6c61 7374 5f66 6f6f 746e        last_footn
+00027600: 756d 2c20 6c69 203d 2046 6f6f 746e 6f74  um, li = Footnot
+00027610: 652e 6578 7472 6163 745f 666f 6f74 6e6f  e.extract_footno
+00027620: 7465 5f61 6e64 5f73 6176 6528 0a20 2020  te_and_save(.   
+00027630: 2020 2020 2020 2020 2020 2020 2066 6f6f               foo
+00027640: 746e 6f74 655f 6e75 6d62 6572 5f65 6c65  tnote_number_ele
+00027650: 6d2c 2066 6f6f 746e 6f74 655f 7465 7874  m, footnote_text
+00027660: 5f63 6c61 7373 6573 2c20 6c61 7374 5f66  _classes, last_f
+00027670: 6f6f 746e 756d 290a 2020 2020 2020 2020  ootnum).        
+00027680: 2020 2020 6966 206c 6920 6973 206e 6f74      if li is not
+00027690: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+000276a0: 2020 2020 2020 2075 6c2e 6170 7065 6e64         ul.append
+000276b0: 286c 6929 0a20 2020 2020 2020 2072 6574  (li).        ret
+000276c0: 7572 6e20 6e65 775f 6874 6d6c 5f65 6c65  urn new_html_ele
+000276d0: 6d0a 0a20 2020 2040 636c 6173 736d 6574  m..    @classmet
+000276e0: 686f 640a 2020 2020 6465 6620 6973 5f66  hod.    def is_f
+000276f0: 6f6f 746e 6f74 655f 666f 6e74 2863 6c73  ootnote_font(cls
+00027700: 2c20 666f 6f74 6e6f 7465 5f6e 756d 6265  , footnote_numbe
+00027710: 725f 656c 656d 293a 0a20 2020 2020 2020  r_elem):.       
+00027720: 2022 2222 0a20 2020 2020 2020 2066 6f6e   """.        fon
+00027730: 7420 7369 7a65 2061 6c6f 6e65 2064 6f65  t size alone doe
+00027740: 7320 6e6f 7420 6469 7374 696e 6775 6973  s not distinguis
+00027750: 682c 2073 6f20 7573 6520 6e65 6967 6862  h, so use neighb
+00027760: 6f75 7269 6e67 2074 6578 740a 2020 2020  ouring text.    
+00027770: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00027780: 6e65 7874 203d 2058 6d6c 4c69 622e 6765  next = XmlLib.ge
+00027790: 745f 6e65 7874 5f65 6c65 6d65 6e74 2866  t_next_element(f
+000277a0: 6f6f 746e 6f74 655f 6e75 6d62 6572 5f65  ootnote_number_e
+000277b0: 6c65 6d29 0a20 2020 2020 2020 2074 6578  lem).        tex
+000277c0: 7420 3d20 666f 6f74 6e6f 7465 5f6e 756d  t = footnote_num
+000277d0: 6265 725f 656c 656d 2e74 6578 740a 2020  ber_elem.text.  
+000277e0: 2020 2020 2020 6966 206e 6578 7420 6973        if next is
+000277f0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00027800: 2020 2070 7269 6e74 2866 224e 4f20 666f     print(f"NO fo
+00027810: 6c6c 6f77 696e 6720 656c 656d 2229 0a20  llowing elem"). 
+00027820: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00027830: 6e20 4661 6c73 650a 2020 2020 2020 2020  n False.        
+00027840: 2320 666f 6c6c 6f65 6420 6279 2073 6d61  # folloed by sma
+00027850: 6c6c 2066 6f6e 743f 0a20 2020 2020 2020  ll font?.       
+00027860: 206e 6578 745f 636c 6173 7320 3d20 6e65   next_class = ne
+00027870: 7874 2e61 7474 7269 625b 2263 6c61 7373  xt.attrib["class
+00027880: 225d 0a20 2020 2020 2020 2069 6620 6e65  "].        if ne
+00027890: 7874 5f63 6c61 7373 203d 3d20 2273 3130  xt_class == "s10
+000278a0: 3435 223a 0a20 2020 2020 2020 2020 2020  45":.           
+000278b0: 2072 6574 7572 6e20 5472 7565 0a20 2020   return True.   
+000278c0: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
+000278d0: 650a 0a20 2020 2023 2046 6f6f 746e 6f74  e..    # Footnot
+000278e0: 650a 0a20 2020 2040 636c 6173 736d 6574  e..    @classmet
+000278f0: 686f 640a 2020 2020 6465 6620 6578 7472  hod.    def extr
+00027900: 6163 745f 666f 6f74 6e6f 7465 5f61 6e64  act_footnote_and
+00027910: 5f73 6176 6528 636c 732c 2066 6f6f 746e  _save(cls, footn
+00027920: 6f74 655f 6e75 6d62 6572 5f65 6c65 6d2c  ote_number_elem,
+00027930: 2066 6f6f 746e 6f74 655f 7465 7874 5f63   footnote_text_c
+00027940: 6c61 7373 6573 2c20 6c61 7374 5f66 6f6f  lasses, last_foo
+00027950: 746e 756d 293a 0a20 2020 2020 2020 2074  tnum):.        t
+00027960: 6578 7420 3d20 666f 6f74 6e6f 7465 5f6e  ext = footnote_n
+00027970: 756d 6265 725f 656c 656d 2e74 6578 740a  umber_elem.text.
+00027980: 2020 2020 2020 2020 666f 6f74 6e6f 7465          footnote
+00027990: 5f6e 756d 6265 7220 3d20 2d31 0a20 2020  _number = -1.   
+000279a0: 2020 2020 2069 676e 6f72 6520 3d20 4661       ignore = Fa
+000279b0: 6c73 650a 2020 2020 2020 2020 6966 206e  lse.        if n
+000279c0: 6f74 2063 6c73 2e69 735f 666f 6f74 6e6f  ot cls.is_footno
+000279d0: 7465 5f66 6f6e 7428 666f 6f74 6e6f 7465  te_font(footnote
+000279e0: 5f6e 756d 6265 725f 656c 656d 293a 0a20  _number_elem):. 
+000279f0: 2020 2020 2020 2020 2020 2069 676e 6f72             ignor
+00027a00: 6520 3d20 5472 7565 0a20 2020 2020 2020  e = True.       
+00027a10: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
+00027a20: 2020 666f 6f74 6e6f 7465 5f6e 756d 6265    footnote_numbe
+00027a30: 7220 3d20 696e 7428 7465 7874 290a 2020  r = int(text).  
+00027a40: 2020 2020 2020 6578 6365 7074 2045 7863        except Exc
+00027a50: 6570 7469 6f6e 3a0a 2020 2020 2020 2020  eption:.        
+00027a60: 2020 2020 6967 6e6f 7265 203d 2054 7275      ignore = Tru
+00027a70: 650a 2020 2020 2020 2020 6c69 203d 204e  e.        li = N
+00027a80: 6f6e 650a 2020 2020 2020 2020 6966 206e  one.        if n
+00027a90: 6f74 2069 676e 6f72 6520 616e 6420 3520  ot ignore and 5 
+00027aa0: 3e20 2866 6f6f 746e 6f74 655f 6e75 6d62  > (footnote_numb
+00027ab0: 6572 202d 206c 6173 745f 666f 6f74 6e75  er - last_footnu
+00027ac0: 6d29 203e 3d20 303a 0a20 2020 2020 2020  m) >= 0:.       
+00027ad0: 2020 2020 206c 6173 745f 666f 6f74 6e75       last_footnu
+00027ae0: 6d2c 206c 6920 3d20 636c 732e 6465 6c65  m, li = cls.dele
+00027af0: 7465 5f66 6f6f 746e 6f74 655f 6e75 6d62  te_footnote_numb
+00027b00: 6572 5f61 6e64 5f66 6f6c 6c6f 7769 6e67  er_and_following
+00027b10: 5f74 6578 745f 5f61 6e64 5f61 6464 5f74  _text__and_add_t
+00027b20: 6f5f 6c69 7374 280a 2020 2020 2020 2020  o_list(.        
+00027b30: 2020 2020 2020 2020 666f 6f74 6e6f 7465          footnote
+00027b40: 5f74 6578 745f 636c 6173 7365 732c 2066  _text_classes, f
+00027b50: 6f6f 746e 6f74 655f 6e75 6d62 6572 2c0a  ootnote_number,.
+00027b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027b70: 666f 6f74 6e6f 7465 5f6e 756d 6265 725f  footnote_number_
+00027b80: 656c 656d 290a 2020 2020 2020 2020 7265  elem).        re
+00027b90: 7475 726e 206c 6173 745f 666f 6f74 6e75  turn last_footnu
+00027ba0: 6d2c 206c 690a 0a20 2020 2023 2046 6f6f  m, li..    # Foo
+00027bb0: 746e 6f74 650a 0a20 2020 2040 636c 6173  tnote..    @clas
+00027bc0: 736d 6574 686f 640a 2020 2020 6465 6620  smethod.    def 
+00027bd0: 6372 6561 7465 5f66 6f6f 746e 6f74 655f  create_footnote_
+00027be0: 6e75 6d62 6572 5f78 7061 7468 2863 6c73  number_xpath(cls
+00027bf0: 2c20 666f 6f74 6e6f 7465 5f6e 756d 6265  , footnote_numbe
+00027c00: 725f 636c 6173 7365 7329 3a0a 2020 2020  r_classes):.    
+00027c10: 2020 2020 7870 6174 6830 203d 2022 220a      xpath0 = "".
+00027c20: 2020 2020 2020 2020 666f 7220 692c 2066          for i, f
+00027c30: 6e63 2069 6e20 656e 756d 6572 6174 6528  nc in enumerate(
+00027c40: 666f 6f74 6e6f 7465 5f6e 756d 6265 725f  footnote_number_
+00027c50: 636c 6173 7365 7329 3a0a 2020 2020 2020  classes):.      
+00027c60: 2020 2020 2020 7870 6174 6830 202b 3d20        xpath0 += 
+00027c70: 2222 2069 6620 6920 3d3d 2030 2065 6c73  "" if i == 0 els
+00027c80: 6520 2220 6f72 2022 0a20 2020 2020 2020  e " or ".       
+00027c90: 2020 2020 2078 7061 7468 3020 2b3d 2066       xpath0 += f
+00027ca0: 2227 7b66 6e63 7d27 220a 2020 2020 2020  "'{fnc}'".      
+00027cb0: 2020 666e 5f78 7061 7468 203d 2066 222e    fn_xpath = f".
+00027cc0: 2f2f 7370 616e 5b7b 7870 6174 6830 7d5d  //span[{xpath0}]
+00027cd0: 220a 2020 2020 2020 2020 7265 7475 726e  ".        return
+00027ce0: 2066 6e5f 7870 6174 680a 0a20 2020 2023   fn_xpath..    #
+00027cf0: 2046 6f6f 746e 6f74 650a 0a20 2020 2040   Footnote..    @
+00027d00: 636c 6173 736d 6574 686f 640a 2020 2020  classmethod.    
+00027d10: 6465 6620 6465 6c65 7465 5f66 6f6f 746e  def delete_footn
+00027d20: 6f74 655f 6e75 6d62 6572 5f61 6e64 5f66  ote_number_and_f
+00027d30: 6f6c 6c6f 7769 6e67 5f74 6578 745f 5f61  ollowing_text__a
+00027d40: 6e64 5f61 6464 5f74 6f5f 6c69 7374 280a  nd_add_to_list(.
+00027d50: 2020 2020 2020 2020 2020 2020 636c 732c              cls,
+00027d60: 2063 6c61 7373 6573 2c20 666f 6f74 6e6f   classes, footno
+00027d70: 7465 5f6e 756d 6265 722c 2066 6f6f 746e  te_number, footn
+00027d80: 6f74 655f 6e75 6d62 6572 5f65 6c65 6d29  ote_number_elem)
+00027d90: 3a0a 2020 2020 2020 2020 6c69 203d 2045  :.        li = E
+00027da0: 542e 456c 656d 656e 7428 226c 6922 290a  T.Element("li").
+00027db0: 2020 2020 2020 2020 6c69 2e61 7070 656e          li.appen
+00027dc0: 6428 636f 7079 2e64 6565 7063 6f70 7928  d(copy.deepcopy(
+00027dd0: 666f 6f74 6e6f 7465 5f6e 756d 6265 725f  footnote_number_
+00027de0: 656c 656d 2929 0a20 2020 2020 2020 2066  elem)).        f
+00027df0: 6f6f 746e 6f74 655f 666f 6c6c 6f77 6572  ootnote_follower
+00027e00: 7320 3d20 586d 6c4c 6962 2e67 6574 5f66  s = XmlLib.get_f
+00027e10: 6f6c 6c6f 7769 6e67 5f65 6c65 6d65 6e74  ollowing_element
+00027e20: 7328 666f 6f74 6e6f 7465 5f6e 756d 6265  s(footnote_numbe
+00027e30: 725f 656c 656d 290a 2020 2020 2020 2020  r_elem).        
+00027e40: 2320 6164 6420 6f6e 6520 7370 616e 2865  # add one span(e
+00027e50: 6e64 7320 6166 7465 7220 666f 6e74 2063  nds after font c
+00027e60: 6861 6d67 6529 0a20 2020 2020 2020 2063  hamge).        c
+00027e70: 6c73 2e69 7465 7261 7465 5f75 6e74 696c  ls.iterate_until
+00027e80: 5f75 6e61 6363 6570 7461 626c 655f 666f  _unacceptable_fo
+00027e90: 6e74 5f63 6c61 7373 2866 6f6f 746e 6f74  nt_class(footnot
+00027ea0: 655f 666f 6c6c 6f77 6572 732c 206c 693d  e_followers, li=
+00027eb0: 6c69 2c20 666e 5f63 6c61 7373 6573 3d63  li, fn_classes=c
+00027ec0: 6c61 7373 6573 290a 2020 2020 2020 2020  lasses).        
+00027ed0: 6c61 7374 5f66 6f6f 746e 756d 203d 2066  last_footnum = f
+00027ee0: 6f6f 746e 6f74 655f 6e75 6d62 6572 0a20  ootnote_number. 
+00027ef0: 2020 2020 2020 2058 6d6c 4c69 622e 7265         XmlLib.re
+00027f00: 6d6f 7665 5f65 6c65 6d65 6e74 2866 6f6f  move_element(foo
+00027f10: 746e 6f74 655f 6e75 6d62 6572 5f65 6c65  tnote_number_ele
+00027f20: 6d29 0a20 2020 2020 2020 2072 6574 7572  m).        retur
+00027f30: 6e20 6c61 7374 5f66 6f6f 746e 756d 2c20  n last_footnum, 
+00027f40: 6c69 0a0a 2020 2020 2320 466f 6f74 6e6f  li..    # Footno
+00027f50: 7465 0a0a 2020 2020 4063 6c61 7373 6d65  te..    @classme
+00027f60: 7468 6f64 0a20 2020 2064 6566 2069 7465  thod.    def ite
+00027f70: 7261 7465 5f75 6e74 696c 5f75 6e61 6363  rate_until_unacc
+00027f80: 6570 7461 626c 655f 666f 6e74 5f63 6c61  eptable_font_cla
+00027f90: 7373 2863 6c73 2c20 666f 6c6c 6f77 6572  ss(cls, follower
+00027fa0: 732c 206c 693d 4e6f 6e65 2c20 666e 5f63  s, li=None, fn_c
+00027fb0: 6c61 7373 6573 3d4e 6f6e 652c 2064 6562  lasses=None, deb
+00027fc0: 7567 3d46 616c 7365 293a 0a20 2020 2020  ug=False):.     
+00027fd0: 2020 2022 2222 6974 6572 6174 6573 206f     """iterates o
+00027fe0: 7665 7220 656c 656d 7473 2066 6f6c 6c6f  ver elemts follo
+00027ff0: 7769 6e67 2061 2066 6f6f 746e 6f74 6520  wing a footnote 
+00028000: 6e75 6d62 6572 2075 6e74 696c 2061 6e20  number until an 
+00028010: 696e 636f 6d70 6174 6962 6c65 0a20 2020  incompatible.   
+00028020: 2020 2020 2063 6c61 7373 2073 7479 6c65       class style
+00028030: 2069 7320 666f 756e 642c 2077 6865 6e20   is found, when 
+00028040: 6272 6561 6b22 2222 0a20 2020 2020 2020  break""".       
+00028050: 2066 6f72 2066 6f6c 6c6f 7765 7220 696e   for follower in
+00028060: 2066 6f6c 6c6f 7765 7273 3a0a 2020 2020   followers:.    
+00028070: 2020 2020 2020 2020 636c 617a 7a20 3d20          clazz = 
+00028080: 666f 6c6c 6f77 6572 2e61 7474 7269 625b  follower.attrib[
+00028090: 2263 6c61 7373 225d 0a20 2020 2020 2020  "class"].       
+000280a0: 2020 2020 2069 6620 636c 617a 7a20 696e       if clazz in
+000280b0: 2066 6e5f 636c 6173 7365 733a 0a20 2020   fn_classes:.   
+000280c0: 2020 2020 2020 2020 2020 2020 206c 692e               li.
+000280d0: 6170 7065 6e64 2863 6f70 792e 6465 6570  append(copy.deep
+000280e0: 636f 7079 2866 6f6c 6c6f 7765 7229 290a  copy(follower)).
+000280f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028100: 586d 6c4c 6962 2e72 656d 6f76 655f 656c  XmlLib.remove_el
+00028110: 656d 656e 7428 666f 6c6c 6f77 6572 290a  ement(follower).
+00028120: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00028130: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00028140: 2020 6966 2064 6562 7567 3a0a 2020 2020    if debug:.    
+00028150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028160: 7072 696e 7428 6622 6272 6f6b 6520 6f75  print(f"broke ou
+00028170: 7420 6f66 2066 6f6f 746e 6f74 6520 6174  t of footnote at
+00028180: 207b 636c 617a 7a7d 2229 0a20 2020 2020   {clazz}").     
+00028190: 2020 2020 2020 2020 2020 2062 7265 616b             break
+000281a0: 0a                                       .
```

### Comparing `amilib-0.0.3/amilib/ami_integrate.py` & `amilib-0.0.4/amilib/ami_integrate.py`

 * *Files identical despite different names*

### Comparing `amilib-0.0.3/amilib/ami_nlp.py` & `amilib-0.0.4/amilib/ami_nlp.py`

 * *Files identical despite different names*

### Comparing `amilib-0.0.3/amilib/ami_pdf_libs.py` & `amilib-0.0.4/amilib/ami_pdf_libs.py`

 * *Files identical despite different names*

### Comparing `amilib-0.0.3/amilib/ami_svg.py` & `amilib-0.0.4/amilib/ami_svg.py`

 * *Files identical despite different names*

### Comparing `amilib-0.0.3/amilib/ami_util.py` & `amilib-0.0.4/amilib/ami_util.py`

 * *Files 2% similar despite different names*

```diff
@@ -9,14 +9,15 @@
 import csv
 
 X = 0
 Y = 1
 
 logger = logging.getLogger(__file__)
 
+
 class AmiUtil:
 
     @classmethod
     def check_type_and_existence(cls, target, expected_type):
         """
         asserts not None for object and its type
         if path asserts existence
@@ -36,16 +37,16 @@
     def is_ordered_numbers(cls, limits2):
         """
         check limits2 is a numeric 2-tuple in increasing order
         :param limits2:
         :return: True tuple[1] > tuple[2]
         """
         return limits2 is not None and len(limits2) == 2 \
-               and AmiUtil.is_number(limits2[0]) and AmiUtil.is_number(limits2[1]) \
-               and limits2[1] > limits2[0]
+           and AmiUtil.is_number(limits2[0]) and AmiUtil.is_number(limits2[1]) \
+           and limits2[1] > limits2[0]
 
     @classmethod
     def is_number(cls, s):
         """
         test if s is a number
         :param s:
         :return: True if float(s) succeeds
@@ -70,15 +71,15 @@
 
     @classmethod
     def int2hex(cls, ii):
         """convert int (0-255) to 2-character hex string
         :param ii: integer
         :return: 2-digit hex string of form 01, 09, 0f, 10, ff , or None if not int 0-125
         """
-        if ii is None or not type(ii) is int or ii < 0 or ii> 255:
+        if ii is None or not type(ii) is int or ii < 0 or ii > 255:
             return None
         return ('0' + hex(ii)[2:])[-2:]
 
     @classmethod
     def is_white(cls, color, delta=20, sat=255):
         """is color white within given tolerance
         255 - color[i] < delta
@@ -128,15 +129,14 @@
             return False
         mean = (color[0] + color[1] + color[2]) / 3
         for i in range(3):
             if abs(color[i] - mean) > delta:
                 return False
         return True
 
-
     @classmethod
     def get_xy_from_sknw_centroid(cls, yx):
         """
         yx is a 2-array and coords need swapping
         and changing from numpy to int
         :param yx:
         :return: [x,y]
@@ -183,17 +183,17 @@
         '''
         AmiUtil.assert_is_float_array(p0)
         AmiUtil.assert_is_float_array(p1)
         AmiUtil.assert_is_float_array(p2)
 
         linal = False
         if linal:
-            np0 = np.array(p0, dtype=uint8)
-            np1 = np.array(p1, dtype=uint8)
-            np2 = np.array(p2, dtype=uint8)
+            np0 = np.array(p0, dtype=np.uint8)
+            np1 = np.array(p1, dtype=np.uint8)
+            np2 = np.array(p2, dtype=np.uint8)
             v0 = np0 - np1
             v1 = np2 - np1
             angle = np.math.atan2(np.linalg.det([v0, v1]), np.dot(v0, v1))
         else:
             dx0 = p0[0] - p1[0]
             dy0 = p0[1] - p1[1]
             v01 = [p0[0] - p1[0], p0[1] - p1[1]]
@@ -234,15 +234,14 @@
 
         dx0 = fxy0[0] - fxy1[0]
         dy0 = fxy0[1] - fxy1[1]
         dist = math.sqrt(dx0 * dx0 + dy0 * dy0)
 
         return dist
 
-
     @classmethod
     def assert_is_float_array(cls, arr, length=2):
         """
         assert arr[0] is float and has given length
         :param arr:
         :param length:
         :return:
@@ -266,15 +265,15 @@
         """
         converts a list of ints or uint16 or uint8 to floats
         :param int_lst: 
         :return: 
         """
         assert int_lst is not None and type(int_lst) is list and len(int_lst) > 0, f"not a list: {int_lst}"
         tt = type(int_lst[0])
-        assert tt is int or tt is uint8 or tt is uint16, f"expected int, got {tt}"
+        assert tt is int or tt is np.uint8 or tt is np.uint16, f"expected int, got {tt}"
         return [float(i) for i in int_lst]
 
     @classmethod
     def to_float_array(cls, arr):
         """
         converts to array of floats if possible
         :param arr:
@@ -334,14 +333,15 @@
         assert path is not None, "no path given"
         with open(path, "w", encoding="UTF-8", newline='') as f:
             writer = csv.writer(f)
             if header:
                 writer.writerow(header)
             writer.writerows(xy_array)
 
+
 class Vector2:
 
     def __init__(self, v2):
         self.vec2 = v2
 
     # @classmethod
     # def angle_to(cls, vv0, vv1):
```

### Comparing `amilib-0.0.3/amilib/amidriver.py` & `amilib-0.0.4/amilib/amidriver.py`

 * *Files identical despite different names*

### Comparing `amilib-0.0.3/amilib/amix.py` & `amilib-0.0.4/amilib/amix.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,161 +1,159 @@
 import argparse
-import ast
-import glob
 import logging
-import os
-import pprint
 import re
 import sys
 import textwrap
 from enum import Enum
 from pathlib import Path
 
-import lxml.etree as ET
-# local
-
-from amilib.pdf_args import PDFArgs
 from amilib.html_args import HTMLArgs
-from amilib.util import AmiLogger, Util, AbstractArgs
+from amilib.pdf_args import PDFArgs
+from amilib.util import AbstractArgs
 from amilib.wikimedia import WikidataLookup
 
+# local
+
 AMIX_DIR = Path(__file__).parent
 REPO_DIR = AMIX_DIR.parent
 
 logger = logging.getLogger(__file__)
 
+
 class AmiLib:
     logger = logging.getLogger("amilib")
-#     """ main entry point for running pyami
-#      """
-#     OUTFILE = "outfile"
-#
-#     # flags
-#     APPLY = "apply"
-#     ASSERT = "assert"
-#     CHECK_URLS = "check_urls"
+    #     """ main entry point for running pyami
+    #      """
+    #     OUTFILE = "outfile"
+    #
+    #     # flags
+    #     APPLY = "apply"
+    #     ASSERT = "assert"
+    #     CHECK_URLS = "check_urls"
     COPY = "copy"
-#     COMBINE = "combine"
-#     CONFIG = "config"
-#     CONTAINS = "contains"
+    #     COMBINE = "combine"
+    #     CONFIG = "config"
+    #     CONTAINS = "contains"
     DEBUG = "debug"
-#     DELETE = "delete"
-#     DEST = "dest"
-#     DICTIONARY = "dictionary"
+    #     DELETE = "delete"
+    #     DEST = "dest"
+    #     DICTIONARY = "dictionary"
     EXAMPLES = "examples"
-#     FILTER = "filter"
+    #     FILTER = "filter"
     FLAGS = "flags"
     GLOB = "glob"
-#     LOOKUP = "lookup"
-#     PRINT_SYMBOLS = "print_symbols"
+    #     LOOKUP = "lookup"
+    #     PRINT_SYMBOLS = "print_symbols"
     PROJ = "proj"
-#     RECURSE = "recurse"
-#     REGEX = "regex"
+    #     RECURSE = "recurse"
+    #     REGEX = "regex"
     SECT = "sect"
-#     SRC = "src"
+    #     SRC = "src"
     SPLIT = "split"
-#     SYMBOLS = "symbols"
+    #     SYMBOLS = "symbols"
     SYSTEM_EXIT_OK = "SystemExitOK"
     SYSTEM_EXIT_FAIL = "SystemExitFail_"
-#     TEST = "test"
+    #     TEST = "test"
     VERSION = "version"
-#     WIKIDATA_SPARQL = "wikidata_sparql"
-#     XPATH = "xpath"
-#     # apply methods 1:1 input-output
-#     # obsolete (use Converters)
-#     PDF2TXT = "pdf2svg"
-#     PDF2SVG = "pdf2svg"
-#     SVG2PAGE = "svg2page"
-#     XML2HTML = "xml2html"
-#     TXT2SENT = "txt2sent"
-#     XML2TXT = "xml2txt"
-#     TXT2PARA = "txt2para"
-#     XML2SECT = "xml2sect"
-#     # combine methods n:1 input-output
-#     CONCAT_STR = "concat_str"
-#     # split methods 1:n input-output
-#     # symbols to update table
-#     SPECIAL_SYMBOLS = ["_proj"]
+    #     WIKIDATA_SPARQL = "wikidata_sparql"
+    #     XPATH = "xpath"
+    #     # apply methods 1:1 input-output
+    #     # obsolete (use Converters)
+    #     PDF2TXT = "pdf2svg"
+    #     PDF2SVG = "pdf2svg"
+    #     SVG2PAGE = "svg2page"
+    #     XML2HTML = "xml2html"
+    #     TXT2SENT = "txt2sent"
+    #     XML2TXT = "xml2txt"
+    #     TXT2PARA = "txt2para"
+    #     XML2SECT = "xml2sect"
+    #     # combine methods n:1 input-output
+    #     CONCAT_STR = "concat_str"
+    #     # split methods 1:n input-output
+    #     # symbols to update table
+    #     SPECIAL_SYMBOLS = ["_proj"]
     LOGLEVEL = "loglevel"
-#     PY4AMI = "pyamihtmlx"
-#
-#     # parsers are these used??
-#     # DICT_PARSER = "DICT"
-#     # HTML_PARSER = "HTML"
-#     # IPCC_PARSER = "IPCC"
-#     # PDF_PARSER  = "PDF"
-#     # PROJECT_PARSER = "PROJECT"
-#     # UNFCCC_PARSER  = "UNFCCC"
-#
-#     logger = logging.getLogger("pyami")
-#     symbol_ini = None
-#
+
+    #     PY4AMI = "pyamihtmlx"
+    #
+    #     # parsers are these used??
+    #     # DICT_PARSER = "DICT"
+    #     # HTML_PARSER = "HTML"
+    #     # IPCC_PARSER = "IPCC"
+    #     # PDF_PARSER  = "PDF"
+    #     # PROJECT_PARSER = "PROJECT"
+    #     # UNFCCC_PARSER  = "UNFCCC"
+    #
+    #     logger = logging.getLogger("pyami")
+    #     symbol_ini = None
+    #
     def __init__(self):
         """constructor
 
         creates symbols
         """
-#
-#         self.logger.debug(f"===============Examples=================")
-#         if self.logger.getEffectiveLevel() <= logging.DEBUG:
-#             traceback.print_stack(file=sys.stdout)
-#
-#         self.args = {}  # args captured in here as name/value without "-" or "--"
-#         self.apply = []
-#         self.combine = None
-#         self.config = None  # holds configuration and global parameters (still being developed)
-#         self.current_file = None
-#         self.fileset = None
-#         # self.file_dict = {}  # possibly to be replaced by content_store.file_dict
-#         # self.content_store = ContentStore(self)  # will expose content_store.file_dict
-#         self.func_dict = {}
-#         self.result = None
-#         self.flag_dict = {}
-#         self.initialize_flags()
-#         self.wikidata_lookup = None
-#         self.wikipedia_lookup = None
-#         self.hit_counter = None
-#         # self.symbol_ini = SymbolIni(self)
-#         self.set_funcs()
-#         self.show_symbols = False
-#         self.ami_dictionary = None
-#         self.proj = None  # current project in searches
-#         self.current_ctree = None  # current ctree (may change during iteration
-#         self.cproject = None
-#         self.ami_logger = None
-#         self.outfile = None
-#         if self.show_symbols:
-#             pprint.pp(f"SYMBOLS\n {self.symbol_ini.symbols}")
-#
-#     def initialize_flags(self):
-#         """initialises flag_dict
-#         """
-#
-#         self.flag_dict = {
-#
-#             self.APPLY: None,
-#             self.CHECK_URLS: None,
-#             self.COMBINE: None,
-#             self.PRINT_SYMBOLS: False,
-#             self.RECURSE: True,
-#         }
-#
-#     def set_funcs(self):
-#         """initializes func_dict
-#         """
-#         # 1:1 methods
-#         # tuple of func+file_extnsion
-#         self.func_dict[self.XML2TXT] = (XmlLib.remove_all_tags, ".xml.txt")
-#         # self.func_dict[self.PDF2TXT] = (PdfReader.read_and_convert, ".pdf.txt")
-#         # self.func_dict[self.PDF2SVG] = (Pdf2SvgConverter.read_and_convert, ".pdf.svg")
-#         # self.func_dict[self.SVG2PAGE] = (Svg2PageConverter.read_and_convert, ".svg.xml")
-#         # self.func_dict[self.XML2HTML] = (Xml2HtmlConverter.read_and_convert, ".svg.html")
-#         # self.func_dict[self.TXT2SENT] = (TextUtil.split_into_sentences, ".sen.txt")
-#         # 1:n methods
-#
+
+    #
+    #         self.logger.debug(f"===============Examples=================")
+    #         if self.logger.getEffectiveLevel() <= logging.DEBUG:
+    #             traceback.print_stack(file=sys.stdout)
+    #
+    #         self.args = {}  # args captured in here as name/value without "-" or "--"
+    #         self.apply = []
+    #         self.combine = None
+    #         self.config = None  # holds configuration and global parameters (still being developed)
+    #         self.current_file = None
+    #         self.fileset = None
+    #         # self.file_dict = {}  # possibly to be replaced by content_store.file_dict
+    #         # self.content_store = ContentStore(self)  # will expose content_store.file_dict
+    #         self.func_dict = {}
+    #         self.result = None
+    #         self.flag_dict = {}
+    #         self.initialize_flags()
+    #         self.wikidata_lookup = None
+    #         self.wikipedia_lookup = None
+    #         self.hit_counter = None
+    #         # self.symbol_ini = SymbolIni(self)
+    #         self.set_funcs()
+    #         self.show_symbols = False
+    #         self.ami_dictionary = None
+    #         self.proj = None  # current project in searches
+    #         self.current_ctree = None  # current ctree (may change during iteration
+    #         self.cproject = None
+    #         self.ami_logger = None
+    #         self.outfile = None
+    #         if self.show_symbols:
+    #             pprint.pp(f"SYMBOLS\n {self.symbol_ini.symbols}")
+    #
+    #     def initialize_flags(self):
+    #         """initialises flag_dict
+    #         """
+    #
+    #         self.flag_dict = {
+    #
+    #             self.APPLY: None,
+    #             self.CHECK_URLS: None,
+    #             self.COMBINE: None,
+    #             self.PRINT_SYMBOLS: False,
+    #             self.RECURSE: True,
+    #         }
+    #
+    #     def set_funcs(self):
+    #         """initializes func_dict
+    #         """
+    #         # 1:1 methods
+    #         # tuple of func+file_extnsion
+    #         self.func_dict[self.XML2TXT] = (XmlLib.remove_all_tags, ".xml.txt")
+    #         # self.func_dict[self.PDF2TXT] = (PdfReader.read_and_convert, ".pdf.txt")
+    #         # self.func_dict[self.PDF2SVG] = (Pdf2SvgConverter.read_and_convert, ".pdf.svg")
+    #         # self.func_dict[self.SVG2PAGE] = (Svg2PageConverter.read_and_convert, ".svg.xml")
+    #         # self.func_dict[self.XML2HTML] = (Xml2HtmlConverter.read_and_convert, ".svg.html")
+    #         # self.func_dict[self.TXT2SENT] = (TextUtil.split_into_sentences, ".sen.txt")
+    #         # 1:n methods
+    #
     def create_arg_parser(self):
         """creates adds the arguments for pyami commandline
         """
 
         def run_dict(self):
             print(f"run dict pyamix")
 
@@ -299,38 +297,41 @@
         # this may be redundant
         self.substitute_args()
         self.logger.debug(f"self.args {self.args}")
         self.add_single_str_to_list()
         self.logger.debug("ARGS after substitution: " + str(self.args))
         self.set_loglevel_from_args()
         self.run_arguments()
-#
+
+    #
     def substitute_args(self):
         """ iterates through self.args and makes subsitutions
         May duplicates
         """
         new_items = {}
         # self.logger.debug(f"SYMBOLS1 {self.symbol_ini.symbols}")
         for item in self.args.items():
             new_item = self.make_substitutions(item)
             self.logger.debug(f"++++++++{item} ==> {new_item}")
             new_items[new_item[0]] = new_item[1]
         self.args = new_items
         self.logger.debug(f"******** substituted ARGS {self.args}")
-#
+
+    #
     def add_single_str_to_list(self):
         """convert single strings to list of one string
         Not sure of what this is for
         """
         str_args = [self.DEBUG, self.EXAMPLES]
         for str_arg in str_args:
             self.logger.debug(f"key {str_arg}")
             self.replace_single_values_in_self_args_with_list(str_arg)
             self.logger.debug(f"args => {self.args}")
-#
+
+    #
     def run_arguments(self):
         """ parse and expland arguments then ru options for
 
         Currently:
         * examples
         * project
         * tests
@@ -353,15 +354,16 @@
         }
         abstract_args = subparser_dict.get(subparser_type)
 
         if abstract_args:
             abstract_args.parse_and_process1(self.args)
         else:
             self.run_core_mathods()
-#
+
+    #
     def run_core_mathods(self):
         logging.debug(f"run_core")
         # mainly obsolete
         if self.VERSION in self.args and self.args[self.VERSION] is not None:
             self.print_version()
         if self.FLAGS in self.args and self.args[self.FLAGS] is not None:
             self.add_flags()
@@ -383,30 +385,32 @@
         # elif TestFile.TEST in self.args:
         #     self.logger.warning(f"TEST in **args {self.args}")
         #     TestFile.run_arg_tests(self.args)
         # TODO linkup with test arguments
 
     def print_version(self):
         print(f"version {self.version()}")
-#
+
+    #
     def replace_single_values_in_self_args_with_list(self, key):
         """always returns list even for single arg
         e.g. turns "foo" into ["foo"]
         This is to avoid strings being interpreted as lists of characters
         I am sure there is a more pythonic way
         """
         # argsx = None
         if self.args is None:
             self.logger.warning(f"NULL self.args")
         elif key in self.args:
             argsx = self.args[key]
             if argsx is not None:
                 if type(argsx) != list:
                     self.args[key] = [argsx]
-#
+
+    #
     def make_substitutions(self, item):
         """
 
         :param item:
 
         """
         # no change
@@ -497,14 +501,15 @@
                     arglistx = match.groupdict("argvals")
                     arg_vars = arglistx.split(",\\s*")
 
             for item in arg_vars.items():  # BUG in Pycharm/Pandas see https://stackoverflow.com/questions/75453995/pandas-plot-vars-argument-must-have-dict-attribute
                 new_item = self.make_substitutions(item)
                 new_items[new_item[0]] = new_item[1]
         return new_items
+
     #
     def parse_args_and_trap_errors(self, arglist, parser):
         """run argparse parser.parse_args and try to trap serious errors
         --help calls SystemExit (we trap and return None)"""
         try:
             parsed_args = parser.parse_args(arglist)
         except SystemExit as se:  # exit codes
@@ -512,14 +517,15 @@
                 parsed_args = self.SYSTEM_EXIT_OK
             else:
                 parsed_args = self.SYSTEM_EXIT_FAIL + str(se)
         except Exception as e:
             parsed_args = None
             self.logger.error(f"Cannot parse {arglist} , {e}")
         return parsed_args
+
     #
     # def add_special_keys_to_symbols_ini(self, key, value):
     #     """
     #
     #     :param key:
     #     :param value:
     #
@@ -541,14 +547,15 @@
             loglevel = self.args[self.LOGLEVEL]
             self.logger.info(f"loglevel {loglevel}")
             if loglevel is not None:
                 loglevel = str(loglevel)
             if loglevel is not None and loglevel.lower() in levels:
                 level = levels[loglevel.lower()]
                 self.logger.loglevel = level
+
     #
     # def run_project_workflow(self):
     #     """ run when PROJ is set"""
     #     self.logger.debug(f"ARGS {self.args}")
     #     if not self.args:
     #         self.logger.error("no args given; try --examples or --help")
     #         return
@@ -1149,20 +1156,20 @@
         """
 
         version = '0.0.1a1'  # 2024-03-27
         version = '0.0.1a3'  # 2024-03-27
         version = '0.0.1'  # 2024-04-03
         version = '0.0.2'  # 2024-04-04
         version = '0.0.3'  # 2024-04-06
+        version = '0.0.4'  # 2024-04-06
 
         # logging.warn(f"VERSION {version}")
         return version
 
 
-
 class AmiLibArgs(AbstractArgs):
     """Parse args to analyze, edit and annotate HTML"""
 
     def __init__(self):
         """arg_dict is set to default"""
         super().__init__()
         self.dictfile = None
@@ -1295,10 +1302,8 @@
     print(f"***** PYAMI VERSION {amix.version()} *****")
     # this needs commandline
     if run_commands:
         amix.run_command(sys.argv[1:])
 
 
 if __name__ == "__main__":
-
     main()
-
```

### Comparing `amilib-0.0.3/amilib/bbox.py` & `amilib-0.0.4/amilib/bbox.py`

 * *Files 1% similar despite different names*

```diff
@@ -2,14 +2,15 @@
 import logging
 import math
 # this should be in a separate library
 from amilib.ami_util import AmiUtil
 
 logger = logging.getLogger(__file__)
 
+
 class BBox:
     """bounding box 2array of 2arrays, based on integers
     """
 
     X = "x"
     Y = "y"
     WIDTH = "width"
```

### Comparing `amilib-0.0.3/amilib/file_lib.py` & `amilib-0.0.4/amilib/file_lib.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,22 +1,25 @@
 """
 standalone library from pyamihtml
 """
 import ast
+import errno
 import glob
 import json
 import logging
 import os
 import re
 import shutil
 from pathlib import Path, PurePath, PurePosixPath
 
 import chardet
 import requests
 
+from amilib.util import TextUtil
+
 logging.debug("loading file_lib")
 
 # wildcards
 STARS = "**"
 STAR = "*"
 
 # suffixes
@@ -51,16 +54,16 @@
 # FULLTEXT_PAGE = "fulltext-page*"
 # CHANNEL_STAR = "channel*"
 # RAW = "raw"
 
 
 logger = logging.getLogger(__file__)
 
-class FileLib:
 
+class FileLib:
     logger = logging.getLogger("file_lib")
 
     @classmethod
     def force_mkdir(cls, dirx):
         """ensure dirx and its parents exist
         :dirx: directory
         """
@@ -69,16 +72,14 @@
             try:
                 path.mkdir(parents=True, exist_ok=True)
                 assert (f := path).exists(), f"dir {path} should now exist"
             except Exception as e:
                 cls.logger.error(f"cannot make dirx {dirx} , {e}")
                 print(f"cannot make dirx {dirx}, {e}")
 
-
-
     @classmethod
     def force_mkparent(cls, file):
         """ensure parent directory exists
 
         :path: whose parent directory is to be created if absent
         """
         if file is not None:
@@ -229,15 +230,15 @@
         """
         deletes directories recursively using shutil.rmtree
         :param dirx: directory tree to delete
         :param delete_directory: If True, delete dirx
         :return None:
         """
         if not dirx or not Path(dirx).exists():
-            print (f"no directory given or found {dirx}")
+            print(f"no directory given or found {dirx}")
             return
         if delete_directory:
             shutil.rmtree(dirx)
         else:
             for path in Path(dirx).glob("**/*"):
                 if path.is_file():
                     path.unlink()
@@ -314,15 +315,14 @@
         """converts list of files to posix form (i.e. all files have / not backslash)
         """
         if file_list is None:
             return None
         posix_files = [PurePosixPath(f) for f in file_list]
         return posix_files
 
-
     @classmethod
     def delete_file(cls, file):
         """delete file (uses unlink) and asserts it has worked
         ;param file: to delete"""
         if file.exists():
             file.unlink()
         assert not file.exists()
@@ -338,15 +338,16 @@
 
         with open(str(path), "w") as f:
             json.dump(dikt, f, indent=indent)
         if debug:
             print(f"wrote dictionary to {path}")
 
     @classmethod
-    def read_string_with_user_agent(self, url, user_agent='my-app/0.0.1', encoding="UTF-8", encoding_scheme="chardet", debug=False):
+    def read_string_with_user_agent(self, url, user_agent='my-app/0.0.1', encoding="UTF-8", encoding_scheme="chardet",
+                                    debug=False):
         """
         allows request.get() to use a user_agent
         :param url: url to read
         :param encoding_scheme: id "chardet uses chardet else response.appenent_encoding
         :return: decoded string
         """
         if not url:
@@ -356,15 +357,16 @@
         response = requests.get(url, headers={'user-agent': user_agent})
         if debug:
             print(f"response: {response} content: {response.content[:400]}")
         content = response.content
         if debug:
             print(f"apparent encoding: {response.apparent_encoding}")
         if encoding is None:
-            encoding = chardet.detect(content)['encoding'] if encoding_scheme == "chardet" else response.apparent_encoding
+            encoding = chardet.detect(content)[
+                'encoding'] if encoding_scheme == "chardet" else response.apparent_encoding
         content = content.decode(encoding)
         return content, encoding
 
     @classmethod
     def join_dir_and_file_as_posix(cls, indir, input):
         """
         joins indir (directory) and input (descendants) to make a list of full filenames
@@ -399,15 +401,15 @@
             for input_item in input:
                 if input_item[0] != "/":
                     posix = PurePosixPath(indir, input_item)
                     outputs.append(str(posix))
             return outputs
 
     @classmethod
-    def posix_glob(cls, glob_str, recursive = True):
+    def posix_glob(cls, glob_str, recursive=True):
         """expands glob and ensure all output is posix
         :param glob_str: glob or list of globs to expand
         :param recursive: use recursive glob
         :return: list of files in posix format"""
         files = []
         if glob_str is None:
             return files
@@ -429,25 +431,23 @@
         try:
             assert path.exists(), f"file {path} must exist"
             assert (s := path.stat().st_size) > minsize, f"file {file} size = {s} must be above {minsize}"
         except AssertionError as e:
             if abort:
                 raise e
 
-
     @classmethod
     def get_home(cls):
         """
         gets home directory os.path.expanduser("~")
         """
         home = os.path.expanduser("~")
         return home
 
 
-
 # see https://realpython.com/python-pathlib/
 
 def main():
     print("started file_lib")
     # test_templates()
 
     print("finished file_lib")
@@ -457,14 +457,15 @@
     print("running file_lib main")
     main()
 else:
     #    print("running file_lib main anyway")
     #    main()
     pass
 
+
 # examples of regex for filenames
 
 
 def glob_re(pattern, strings):
     return filter(re.compile(pattern).match, strings)
```

### Comparing `amilib-0.0.3/amilib/html_args.py` & `amilib-0.0.4/amilib/html_args.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,27 +1,28 @@
 """
 Command-line for converting and processing HTML
 """
 import argparse
 import logging
+from pathlib import Path
 
 from amilib.util import AbstractArgs
 
 # commandline
 ANNOTATE = "annotate"
 COLOR = "color"
 DICT = "dict"
 INPATH = "inpath"
 OUTDIR = "outdir"
 OUTPATH = "outpath"
 
 logger = logging.getLogger(__file__)
 
-class HTMLArgs(AbstractArgs):
 
+class HTMLArgs(AbstractArgs):
     """Parse args to analyze, edit and annotate HTML"""
 
     def __init__(self):
         """arg_dict is set to default"""
         super().__init__()
         self.dictfile = None
         self.inpath = None
@@ -108,8 +109,7 @@
         if not self.outdir:
             self.outdir = Path(self.outpath).parent
         self.outdir = Path(self.outdir)
         self.outdir.mkdir(exist_ok=True)
 
         self.ami_dict = AmiDictionary.create_from_xml_file(self.dictfile)
         self.ami_dict.markup_html_from_dictionary(self.inpath, self.outpath, self.color)
-
```

### Comparing `amilib-0.0.3/amilib/html_generator.py` & `amilib-0.0.4/amilib/html_generator.py`

 * *Files 0% similar despite different names*

```diff
@@ -1,24 +1,23 @@
-import json
 import logging
 from io import BytesIO
 from pathlib import Path
 
 import lxml
 import pdfplumber
 from pyamihtml.ami_pdf import PDFDebug
 
+from amilib.ami_html import H_BODY, H_DIV
 from amilib.ami_html import HtmlUtil, P_FONTNAME, P_HEIGHT, P_STROKING_COLOR, P_NON_STROKING_COLOR, AmiSpan, P_TEXT, \
     HtmlGroup, HtmlStyle
-from amilib.ami_pdf_libs import create_thin_line_from_rect, AmiPDFPlumber, AmiPlumberJson
-from amilib.ami_pdf_libs import AmiPDFPlumber,AmiPage, TextStyle
+from amilib.ami_pdf_libs import AmiPDFPlumber, AmiPage, TextStyle
+from amilib.ami_pdf_libs import create_thin_line_from_rect, AmiPlumberJson
 from amilib.file_lib import FileLib
 from amilib.util import AmiLogger
 from amilib.xml_lib import HtmlLib, XmlLib
-from amilib.ami_html import H_BODY, H_DIV
 
 logger = AmiLogger.create_named_logger(__file__)
 logger = logging.getLogger(__file__)
 
 DICT_KEYSET = set([
     'annots',
     'bbox',
```

### Comparing `amilib-0.0.3/amilib/html_marker.py` & `amilib-0.0.4/amilib/html_marker.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 import copy
 import csv
-import glob
+import logging
 import re
 from collections import Counter, defaultdict
 from dataclasses import dataclass
 from pathlib import Path
 
 import lxml.etree
 
@@ -12,14 +12,15 @@
 from amilib.ami_integrate import HtmlGenerator
 from amilib.util import Util, EnhancedRegex, GENERATE
 # from pyamihtmlx.util import EnhancedRegex, GENERATE, Util
 from amilib.xml_lib import HtmlLib, Templater, XmlLib
 
 logger = logging.getLogger(__file__)
 
+
 def replace_parent(current_parents, div):
     pass
 
 
 def add__and_insert_parents(current_parents, div, level_index):
     pass
 
@@ -979,64 +980,64 @@
     styles: list
     force_make_pdf: bool
     svg_dir: str
     page_json_dir: str
     debug: bool
 
     def __init__(self,
-        file_splitter = None,
-        insubdir = None,
-        instem = None,
-        outsubdir = None,
-        top_outdir = None,
-        directory_maker = None,
-        markukp_dict = None,
-        inline_dict = None,
-        param_dict = None,
-        targets = None,
-        styles = None,
-        force_make_pdf = True,
-        svg_dir = None,
-        page_json_dir = None,
-        debug = False
-    ):
-        self.file_splitter=file_splitter
-        self.insubdir=insubdir
-        self.instem=instem
-        self.outsubdir=outsubdir
-        self.top_outdir=top_outdir
-        self.directory_maker=directory_maker
-        self.markukp_dict=markukp_dict
-        self.inline_dict=inline_dict
-        self.param_dict=param_dict
-        self.targets=targets
-        self.styles=styles
-        self.force_make_pdf=force_make_pdf
-        self.svg_dir=svg_dir
-        self.page_json_dir=page_json_dir
-        self.debug=debug
+                 file_splitter=None,
+                 insubdir=None,
+                 instem=None,
+                 outsubdir=None,
+                 top_outdir=None,
+                 directory_maker=None,
+                 markukp_dict=None,
+                 inline_dict=None,
+                 param_dict=None,
+                 targets=None,
+                 styles=None,
+                 force_make_pdf=True,
+                 svg_dir=None,
+                 page_json_dir=None,
+                 debug=False
+                 ):
+        self.file_splitter = file_splitter
+        self.insubdir = insubdir
+        self.instem = instem
+        self.outsubdir = outsubdir
+        self.top_outdir = top_outdir
+        self.directory_maker = directory_maker
+        self.markukp_dict = markukp_dict
+        self.inline_dict = inline_dict
+        self.param_dict = param_dict
+        self.targets = targets
+        self.styles = styles
+        self.force_make_pdf = force_make_pdf
+        self.svg_dir = svg_dir
+        self.page_json_dir = page_json_dir
+        self.debug = debug
 
     @classmethod
     def make_dataclass(cls):
         dc = HtmlPipelineData(
-        file_splitter = None,
-        insubdir = None,
-        instem = None,
-        outsubdir = None,
-        top_outdir = None,
-        directory_maker = None,
-        markukp_dict = None,
-        inline_dict = None,
-        param_dict = None,
-        targets = None,
-        styles = None,
-        force_make_pdf = True,
-        svg_dir = None,
-        page_json_dir = None,
-        debug = False
+            file_splitter=None,
+            insubdir=None,
+            instem=None,
+            outsubdir=None,
+            top_outdir=None,
+            directory_maker=None,
+            markukp_dict=None,
+            inline_dict=None,
+            param_dict=None,
+            targets=None,
+            styles=None,
+            force_make_pdf=True,
+            svg_dir=None,
+            page_json_dir=None,
+            debug=False
         )
         """holds state and can be passed between steps"""
         return dc
 
 
 class HtmlPipeline:
     """pipeline for HTML conversioms"""
@@ -1246,14 +1247,15 @@
         html_elem = HtmlLib.parse_html(infile)
         HtmlLib.write_html_file(html_elem, outfile=outfile)
 
     @classmethod
     def print_step(cls, step):
         print(f"==========\nrunning {step}\n============")
 
+
 class HearstPattern:
     """extracts Hearst paaterns using regexes
     NYI
     """
 
     def __init__(self, regex=None):
         self.regex = regex
```

### Comparing `amilib-0.0.3/amilib/pdf_args.py` & `amilib-0.0.4/amilib/pdf_args.py`

 * *Files identical despite different names*

### Comparing `amilib-0.0.3/amilib/util.py` & `amilib-0.0.4/amilib/util.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,29 +1,28 @@
 import argparse
 import ast
+import base64
 import codecs
+import csv
 import importlib
+import json
 import logging
 import os
-import sys
-import csv
 import re
-from enum import Enum
+import sys
+import time
 from abc import ABC, abstractmethod
 from collections import Counter
+from enum import Enum
+from pathlib import Path
 
-import lxml
 import pandas as pd
 import pyvis
-from lxml import html
-from pathlib import Path
-import time
 import requests
-import json
-import base64
+from lxml import html
 
 logger = logging.getLogger(__file__)
 
 HREF = "href"
 
 
 class Util:
```

### Comparing `amilib-0.0.3/amilib/wikimedia.py` & `amilib-0.0.4/amilib/wikimedia.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,25 +1,24 @@
 import json
 import logging
 import os
 import re
 import sys
 from enum import Enum
+from io import StringIO
 from pathlib import Path
-
-import requests
-from lxml import etree as ET
-from lxml import etree, html
-import lxml.etree
+from urllib.error import HTTPError
 from urllib.parse import quote
-from io import StringIO
 from urllib.request import urlopen
-from lxml import etree
-from urllib.error import HTTPError
+
+import lxml.etree
+import requests
 from SPARQLWrapper import SPARQLWrapper
+from lxml import etree as ET
+from lxml import html
 
 # local
 from amilib.ami_html import HtmlUtil
 from amilib.util import Util
 
 logging.debug("loading wikimedia.py")
 
@@ -55,19 +54,20 @@
 ID_NAME = "id_name"
 SPQ_NAME = "sparql_name"
 DICT_NAME = "dict_name"
 
 ARTICLEs = [
     ".*((scientific|journal)\\s+)?article.*",
     ".*((scientific|academic)\\s+)?journal.*"
-     ]
+]
 ARTS = [".*(film|song|album)"]
 
 logger = logging.getLogger(__file__)
 
+
 # this should go in config files
 class WikidataPredicate:
     chemistry = {
         "P31": {
             "Q11173": "chemical compound",
             "weight": 0.9
         },
@@ -91,26 +91,24 @@
     def __init__(self, exact_lookup=False):
         self.term = None
         self.wikidata_dict = None
         self.root = None
         self.exact_lookup = exact_lookup
         self.hits_dict = dict()
 
-
     def lookup_wikidata(self, term):
         """
         Looks up term in Wikidata and gets Q number and descriptiom
 
         NOTE requires Internet
 
         :param term: word or phrase to lookup
         :return: triple (e.g. hit0_id, hit0_description, wikidata_hits)
         """
 
-
         if not term:
             logging.warning("null term")
             return None, None, None
         self.term = term
         MAX_ENTRIES = 5
         url = WIKIDATA_QUERY_URI + quote(term.encode('utf8'))
         # print(f"url {url}")
@@ -171,15 +169,15 @@
                 self.add_subdict_title_desc_statements(li, qitem, result_heading_a_elem, wikidata_dict)
         return wikidata_dict
 
     def add_subdict_title_desc_statements(self, li, qitem, result_heading_a, wikidata_dict):
         sub_dict = {}
         wikidata_dict[qitem] = sub_dict
         # make title from text children not tooltip
-        text = ''.join(result_heading_a.itertext()) # acetone (Q49546)
+        text = ''.join(result_heading_a.itertext())  # acetone (Q49546)
         title = text.split("(Q")[0]
         sub_dict[TITLE] = title
         find_arg = "./div[@class='" + SEARCH_RESULT + "']/span"
         find_elem = li.find(find_arg)
         sub_dict[DESC] = None if find_elem is None else find_elem.text
 
         # just take statements at present (n statements or 1 statement)
@@ -563,15 +561,14 @@
         </div>
         """
         li_list = self.root.xpath(
             ".//div[normalize-space(@class)='wikibase-entitytermsview-heading-aliases']/ul/li[@class='wikibase-entitytermsview-aliases-alias']")
         aliases = [li.text for li in li_list]
         return
 
-
     def get_id(self):
         """
         get id from <span class="wikibase-title-id">(Q42)</span>
         remove brackets
         :return: P/Q id or None
         """
         id_list = self.get_elements_for_normalized_attrib_val("class", "wikibase-title-id")
@@ -680,27 +677,24 @@
             logging.error(f"must give required wikidata label")
             return None
         idlist = []
         for label, id in zip(labels, ids):
             if label_match(label, wikidata_label, method, ignorecase):  # METHOD NOT WRITTEN
                 idlist.append(id)
 
-
     """<div class="wikibase-entitytermsview-heading-description">chemical compound</div>"""
 
     def debug_page(self):
         """debug crude"""
         if self.root is None:
             print(f"no root for wikidata")
         else:
             HtmlUtil.write_html_elem(self.root, sys.stdout, pretty_print=True)
 
 
-
-
 class WikidataSparql:
 
     def __init__(self, dictionary):
         self.dictionary = dictionary
 
     def update_from_sparql(self, sparql_file, sparql_to_dictionary):
         self.sparql_to_dictionary = sparql_to_dictionary
@@ -795,15 +789,14 @@
         except HTTPError as e:
             print(f"cannout open {url} because {e}")
         tree = ET.parse(StringIO(content), ET.HTMLParser())
         root = tree.getroot()
         return root
 
 
-
 class WikidataExtractor:
     """Thanks to Awena for showing the approach"""
     VERSION = "0.1"
     USER_AGENT = "Mozilla/5.0 (compatible; Pyami/" + VERSION + "; +https://github.com/petermr/pyami/)"
     WIKIDATA_API = "https://www.wikidata.org/w/api.php"
 
     def __init__(self, lang='en'):
```

### Comparing `amilib-0.0.3/amilib/xml_lib.py` & `amilib-0.0.4/amilib/xml_lib.py`

 * *Files 0% similar despite different names*

```diff
@@ -1,26 +1,25 @@
 import copy
 import html
 import logging
 import os
 import pprint
 import re
+import tkinter as tk
 from io import StringIO
 from pathlib import Path
 from urllib.request import urlopen
 
-import chardet
 import lxml
 import lxml.etree
 import requests
 import tkinterweb
 from lxml import etree as ET
 from lxml.etree import _Element, _ElementTree
 from lxml.html import HTMLParser
-import tkinter as tk
 
 from amilib.file_lib import FileLib
 
 logging.debug("loading xml_lib")
 
 # make leafnodes and copy remaning content as XML
 TERMINAL_COPY = {
```

### Comparing `amilib-0.0.3/amilib.egg-info/PKG-INFO` & `amilib-0.0.4/amilib.egg-info/PKG-INFO`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: amilib
-Version: 0.0.3
+Version: 0.0.4
 Summary: document download, cleaning, managemenr
 Home-page: https://github.com/petermr/amilib
 Author: Peter Murray-Rust
 Author-email: petermurrayrust@googlemail.com
 License: Apache2
 Keywords: text and data mining
 Classifier: Development Status :: 3 - Alpha
```

### Comparing `amilib-0.0.3/amilib.egg-info/SOURCES.txt` & `amilib-0.0.4/amilib.egg-info/SOURCES.txt`

 * *Files identical despite different names*

### Comparing `amilib-0.0.3/setup.py` & `amilib-0.0.4/setup.py`

 * *Files 0% similar despite different names*

```diff
@@ -29,15 +29,15 @@
  'scikit-learn',
 
 ]
 
 setup(
     name='amilib',
     url='https://github.com/petermr/amilib',
-    version='0.0.3',
+    version='0.0.4',
     description='document download, cleaning, managemenr',
     long_description_content_type='text/markdown',
     long_description=readme,
     author="Peter Murray-Rust",
     author_email='petermurrayrust@googlemail.com',
     license='Apache2',
     install_requires=requirements,
```

### Comparing `amilib-0.0.3/test/test_all.py` & `amilib-0.0.4/test/test_all.py`

 * *Files identical despite different names*

### Comparing `amilib-0.0.3/test/test_file.py` & `amilib-0.0.4/test/test_file.py`

 * *Files identical despite different names*

### Comparing `amilib-0.0.3/test/test_headless.py` & `amilib-0.0.4/test/test_headless.py`

 * *Files identical despite different names*

### Comparing `amilib-0.0.3/test/test_html.py` & `amilib-0.0.4/test/test_html.py`

 * *Files identical despite different names*

### Comparing `amilib-0.0.3/test/test_nlp.py` & `amilib-0.0.4/test/test_nlp.py`

 * *Files identical despite different names*

### Comparing `amilib-0.0.3/test/test_pdf.py` & `amilib-0.0.4/test/test_pdf.py`

 * *Files 0% similar despite different names*

```diff
@@ -145,17 +145,19 @@
         page_json_dir = output_page_dir
         output_page_dir.mkdir(exist_ok=True, parents=True)
         ami_pdfplumber = AmiPDFPlumber()
         HtmlGenerator.create_html_pages(
             ami_pdfplumber, input_pdf=input_pdf, outdir=output_page_dir, page_json_dir=page_json_dir,
             pages=[1, 2, 3, 4, 5, 6, 7])
 
-    @unittest.skipUnless(AmiAnyTest.run_long(), "run occasionally")
+    # @unittest.skipUnless(AmiAnyTest.run_long(), "run occasionally")
+    @unittest.skip(reason="too complex")
     def test_pdfplumber_doublecol_create_pages_for_WGs_HACKATHON(self):
         """
+        TODO move this to climate
         creates AmiPDFPlumber and reads double-column pdf and debugs
         This is also an integration/project test
         """
 
         report_names = [
             # "SYR_LR",
             # "SYR_SPM",
```

### Comparing `amilib-0.0.3/test/test_stat.py` & `amilib-0.0.4/test/test_stat.py`

 * *Files identical despite different names*

### Comparing `amilib-0.0.3/test/test_svg.py` & `amilib-0.0.4/test/test_svg.py`

 * *Files identical despite different names*

### Comparing `amilib-0.0.3/test/test_util.py` & `amilib-0.0.4/test/test_util.py`

 * *Files identical despite different names*

### Comparing `amilib-0.0.3/test/test_wikidata.py` & `amilib-0.0.4/test/test_wikidata.py`

 * *Files identical despite different names*

### Comparing `amilib-0.0.3/test/test_xml.py` & `amilib-0.0.4/test/test_xml.py`

 * *Files identical despite different names*

