# Comparing `tmp/akhdefo_functions-2.4.29-py3-none-any.whl.zip` & `tmp/akhdefo_functions-2.5.0-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,22 +1,23 @@
-Zip file size: 164269 bytes, number of entries: 20
+Zip file size: 164707 bytes, number of entries: 21
 -rw-rw-rw-  2.0 fat    16653 b- defN 24-Feb-22 18:14 akhdefo_functions/ASF.py
--rw-rw-rw-  2.0 fat    53386 b- defN 24-Feb-16 02:34 akhdefo_functions/AkhdefoPlot.py
--rw-rw-rw-  2.0 fat     9259 b- defN 24-Jan-03 23:08 akhdefo_functions/Akhdefo_Coreg.py
--rw-rw-rw-  2.0 fat   114378 b- defN 24-Feb-21 21:23 akhdefo_functions/Akhdefo_GOI.py
+-rw-rw-rw-  2.0 fat    53386 b- defN 24-Apr-07 00:24 akhdefo_functions/AkhdefoPlot.py
+-rw-rw-rw-  2.0 fat    10947 b- defN 24-Apr-06 22:52 akhdefo_functions/Akhdefo_Classification.py
+-rw-rw-rw-  2.0 fat     9269 b- defN 24-Apr-06 23:22 akhdefo_functions/Akhdefo_Coreg.py
+-rw-rw-rw-  2.0 fat   114256 b- defN 24-Apr-07 00:41 akhdefo_functions/Akhdefo_GOI.py
 -rw-rw-rw-  2.0 fat    45641 b- defN 24-Feb-16 03:08 akhdefo_functions/Akhdefo_TS.py
--rw-rw-rw-  2.0 fat    87861 b- defN 24-Jan-28 01:23 akhdefo_functions/Akhdefo_Tools.py
--rw-rw-rw-  2.0 fat   153565 b- defN 24-Apr-03 22:13 akhdefo_functions/Akhdefo_Utilities.py
--rw-rw-rw-  2.0 fat    27051 b- defN 24-Feb-22 03:34 akhdefo_functions/Filter_PreProc.py
--rw-rw-rw-  2.0 fat     8056 b- defN 24-Jan-03 23:08 akhdefo_functions/Mosaic_Crop.py
+-rw-rw-rw-  2.0 fat    76847 b- defN 24-Apr-06 22:26 akhdefo_functions/Akhdefo_Tools.py
+-rw-rw-rw-  2.0 fat   153494 b- defN 24-Apr-06 23:34 akhdefo_functions/Akhdefo_Utilities.py
+-rw-rw-rw-  2.0 fat    27026 b- defN 24-Apr-07 00:07 akhdefo_functions/Filter_PreProc.py
+-rw-rw-rw-  2.0 fat     8035 b- defN 24-Apr-07 00:09 akhdefo_functions/Mosaic_Crop.py
 -rw-rw-rw-  2.0 fat    45101 b- defN 24-Jan-03 23:08 akhdefo_functions/OpticalFlow.py
 -rw-rw-rw-  2.0 fat    12943 b- defN 24-Feb-19 20:51 akhdefo_functions/S1.py
--rw-rw-rw-  2.0 fat    38790 b- defN 24-Jan-03 23:08 akhdefo_functions/Stacked_Velocity.py
--rw-rw-rw-  2.0 fat    11849 b- defN 24-Jan-03 23:08 akhdefo_functions/Unzip_CopyFiles.py
--rw-rw-rw-  2.0 fat     9190 b- defN 24-Jan-28 10:03 akhdefo_functions/Video_Streamer.py
--rw-rw-rw-  2.0 fat      619 b- defN 24-Apr-03 22:14 akhdefo_functions/__init__.py
+-rw-rw-rw-  2.0 fat    38672 b- defN 24-Apr-07 00:13 akhdefo_functions/Stacked_Velocity.py
+-rw-rw-rw-  2.0 fat    11726 b- defN 24-Apr-06 23:46 akhdefo_functions/Unzip_CopyFiles.py
+-rw-rw-rw-  2.0 fat     9247 b- defN 24-Apr-06 23:49 akhdefo_functions/Video_Streamer.py
+-rw-rw-rw-  2.0 fat      683 b- defN 24-Apr-07 00:41 akhdefo_functions/__init__.py
 -rw-rw-rw-  2.0 fat     2128 b- defN 24-Feb-19 20:51 akhdefo_functions/tqdm_joblib.py
--rw-rw-rw-  2.0 fat     3936 b- defN 24-Apr-03 22:15 akhdefo_functions-2.4.29.dist-info/METADATA
--rw-rw-rw-  2.0 fat       92 b- defN 24-Apr-03 22:15 akhdefo_functions-2.4.29.dist-info/WHEEL
--rw-rw-rw-  2.0 fat       18 b- defN 24-Apr-03 22:15 akhdefo_functions-2.4.29.dist-info/top_level.txt
--rw-rw-r--  2.0 fat     1782 b- defN 24-Apr-03 22:15 akhdefo_functions-2.4.29.dist-info/RECORD
-20 files, 642298 bytes uncompressed, 161351 bytes compressed:  74.9%
+-rw-rw-rw-  2.0 fat     3935 b- defN 24-Apr-07 01:02 akhdefo_functions-2.5.0.dist-info/METADATA
+-rw-rw-rw-  2.0 fat       92 b- defN 24-Apr-07 01:02 akhdefo_functions-2.5.0.dist-info/WHEEL
+-rw-rw-rw-  2.0 fat       18 b- defN 24-Apr-07 01:02 akhdefo_functions-2.5.0.dist-info/top_level.txt
+-rw-rw-r--  2.0 fat     1879 b- defN 24-Apr-07 01:02 akhdefo_functions-2.5.0.dist-info/RECORD
+21 files, 641978 bytes uncompressed, 161635 bytes compressed:  74.8%
```

## zipnote {}

```diff
@@ -1,13 +1,16 @@
 Filename: akhdefo_functions/ASF.py
 Comment: 
 
 Filename: akhdefo_functions/AkhdefoPlot.py
 Comment: 
 
+Filename: akhdefo_functions/Akhdefo_Classification.py
+Comment: 
+
 Filename: akhdefo_functions/Akhdefo_Coreg.py
 Comment: 
 
 Filename: akhdefo_functions/Akhdefo_GOI.py
 Comment: 
 
 Filename: akhdefo_functions/Akhdefo_TS.py
@@ -42,20 +45,20 @@
 
 Filename: akhdefo_functions/__init__.py
 Comment: 
 
 Filename: akhdefo_functions/tqdm_joblib.py
 Comment: 
 
-Filename: akhdefo_functions-2.4.29.dist-info/METADATA
+Filename: akhdefo_functions-2.5.0.dist-info/METADATA
 Comment: 
 
-Filename: akhdefo_functions-2.4.29.dist-info/WHEEL
+Filename: akhdefo_functions-2.5.0.dist-info/WHEEL
 Comment: 
 
-Filename: akhdefo_functions-2.4.29.dist-info/top_level.txt
+Filename: akhdefo_functions-2.5.0.dist-info/top_level.txt
 Comment: 
 
-Filename: akhdefo_functions-2.4.29.dist-info/RECORD
+Filename: akhdefo_functions-2.5.0.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## akhdefo_functions/AkhdefoPlot.py

 * *Ordering differences only*

```diff
@@ -49,15 +49,22 @@
 import matplotlib.pyplot as plt
 from matplotlib.colors import TwoSlopeNorm, Normalize
 from mpl_toolkits.axes_grid1.anchored_artists import AnchoredSizeBar
 import rasterio
 import rasterio.plot
 import earthpy.spatial as es
 import earthpy.plot as ep
-
+import os
+import glob
+import pandas as pd
+import numpy as np
+import matplotlib.pyplot as plt
+import matplotlib.dates as mdates
+import re
+from datetime import datetime
 
 def akhdefo_viewer(path_to_dem_file, raster_file, output_folder, title='', 
                    pixel_resolution_meters=3.125, output_file_name="", 
                    alpha=0.5, unit_conversion=None, no_data_mask=False, 
                    colormap='jet', min_value=None, max_value=None, 
                    normalize=False, colorbar_label=None, show_figure=True , aspect_raster=None, cmap_aspect=None, step=10):
     """
@@ -282,22 +289,15 @@
         ax.add_artist(scalebar)
       
     # Save the plot
     plt.savefig(os.path.join(output_folder, output_file_name), dpi=100, bbox_inches='tight')
 
 
 
-import os
-import glob
-import pandas as pd
-import numpy as np
-import matplotlib.pyplot as plt
-import matplotlib.dates as mdates
-import re
-from datetime import datetime
+
 
 def plot_stackNetwork(src_folder="", output_folder="", cmap='tab20', date_plot_interval=(5, 30), marker_size=15):
     
     """
     Generates a scatter plot to visualize the time intervals between dates extracted from the filenames of .tif files.
     The function handles filenames containing single or multiple dates. For multiple dates, it calculates the interval 
     between the first and last date. For single dates, it calculates the interval between consecutive dates.
```

## akhdefo_functions/Akhdefo_Coreg.py

```diff
@@ -1,12 +1,15 @@
+###Start###
 import cv2
 import numpy as np
 import os
 import shutil
 from osgeo import gdal
+import os
+from arosics import COREG_LOCAL
 
 def raster_alignment(src_directory, ref_filename, delete_files=False):
     """
     Aligns raster images in a given source directory to a reference image.
 
     Args:
     src_directory (str): Path to the source directory containing images to align.
@@ -146,16 +149,15 @@
     Returns
     -------
     None
         The function saves the coregistered rasters and corresponding figures to specified directories.
 
     """
 
-    import os
-    from arosics import COREG_LOCAL
+   
 
     def create_directory(directory):
         """Helper function to create a directory if it doesn't exist."""
         if not os.path.exists(directory):
             os.makedirs(directory)
 
     def generate_filename(ref_path, target_path, title_suffix):
```

## akhdefo_functions/Akhdefo_GOI.py

```diff
@@ -1,13 +1,96 @@
+###Start###
+
 import os
 from osgeo import gdal
 import tempfile
 import numpy as np
-
 import gc
+import os
+import geopandas as gpd
+import matplotlib.pyplot as plt
+import numpy as np
+import scipy.stats as stats
+from pykrige.ok import OrdinaryKriging
+from scipy.stats import zscore
+from scipy.ndimage import generic_filter
+import shutil
+import geopandas as gpd
+import numpy as np
+import matplotlib.pyplot as plt
+from sklearn.cluster import DBSCAN
+from sklearn.preprocessing import StandardScaler
+import cv2
+import numpy as np
+from scipy.stats import zscore
+from skimage.filters import gaussian
+import os
+import re
+from datetime import datetime
+from os import listdir
+from os.path import isfile, join
+import cv2
+import geopandas as gpd
+import matplotlib.pyplot as plt
+import numpy as np
+import pandas as pd
+import rasterio
+from matplotlib.backends.backend_pdf import PdfPages
+from mpl_toolkits.axes_grid1.inset_locator import inset_axes
+from rasterio.features import geometry_mask
+from rasterio.transform import from_origin
+from scipy.interpolate import griddata
+from skimage.metrics import structural_similarity as ssim
+import geopandas as gpd
+from shapely.geometry import Point
+import pandas as pd
+from tqdm import tqdm
+import xml.etree.ElementTree as ET
+import geopandas as gpd
+import rasterio
+import numpy as np
+from pathlib import Path
+from datetime import datetime
+import pandas as pd
+import xml.etree.ElementTree as ET
+
+
+import os
+from datetime import datetime
+import numpy as np
+import rasterio
+from tqdm import tqdm
+import akhdefo_functions
+from akhdefo_functions import Crop_to_AOI
+from akhdefo_functions.Akhdefo_Utilities import Auto_Variogram
+import os
+import numpy as np
+import rasterio
+from rasterio.windows import from_bounds
+from shapely.geometry import box
+from rasterio.mask import mask
+import geopandas as gpd
+import geopandas as gpd
+import numpy as np
+import rasterio
+from rasterio.features import geometry_mask
+from rasterio.transform import from_origin
+from scipy.interpolate import griddata
+from scipy.spatial import cKDTree
+import cmocean
+import earthpy.plot as ep
+import earthpy.spatial as es
+import matplotlib.pyplot as plt
+import numpy as np
+# Import necessary packages
+import rasterio as rio
+from mpl_toolkits.axes_grid1 import make_axes_locatable
+import re
+import xml.etree.ElementTree as ET
+
 
 def mask_raster_with_template(input_raster_path, mask_raster_path, noData_value=np.nan):
     """
     Masks a georeferenced raster file using a binary raster mask template.
 
     Parameters:
     - input_raster_path (str): Path to the input georeferenced raster file.
@@ -50,15 +133,15 @@
     input_ds = None
     mask_ds = None
     out_ds = None
     
     # Replace original raster with the masked raster
     # os.remove(input_raster_path)
     # os.rename(temp_file, input_raster_path)
-    import shutil
+    
     shutil.copy(temp_file, input_raster_path)
     os.remove(temp_file)
 
 
 
 def mask_all_rasters_in_directory(directory, mask_raster_path):
     
@@ -77,22 +160,15 @@
     
     for file in os.listdir(directory):  # This will only list files/directories in the given directory
         if file.lower().endswith(('.tif', '.tiff')):
             input_raster_path = os.path.join(directory, file)
             mask_raster_with_template(input_raster_path, mask_raster_path)
 
 
-import os
-import geopandas as gpd
-import matplotlib.pyplot as plt
-import numpy as np
-import scipy.stats as stats
-from pykrige.ok import OrdinaryKriging
-from scipy.stats import zscore
-from scipy.ndimage import generic_filter
+
 
 #Calculate Linear Velocity for each data point
 def linear_VEL(df, dnames):
     
     dd_list=[x.replace("D", "") for x in dnames]
     dates_list=([datetime.strptime(x, '%Y%m%d') for x in dd_list])
     days_num=[( ((x) - (pd.Timestamp(year=x.year, month=1, day=1))).days + 1) for x in dates_list]
@@ -415,19 +491,15 @@
     #     print("Error in displacement correction:", e)
         #reference_index = None
 
     return gdf
 
 def find_best_match(gdf):
     
-    import geopandas as gpd
-    import numpy as np
-    import matplotlib.pyplot as plt
-    from sklearn.cluster import DBSCAN
-    from sklearn.preprocessing import StandardScaler
+   
 
     gdf_temp=gdf
     # Load your GeoDataFrame
     # Assuming 'gdf' is your GeoDataFrame with a 'VEL' column and geometry
     # gdf_temp['VEL']=gdf_temp['VEL'].abs()
     # gdf_temp['VEL_STD']=gdf_temp['VEL_STD'].abs()
     
@@ -466,21 +538,15 @@
 
 
 ######################################3
 
 
 
 #############################
-import geopandas as gpd
-import rasterio
-import numpy as np
-from pathlib import Path
-from datetime import datetime
-import pandas as pd
-import xml.etree.ElementTree as ET
+
 
 def calculate_slopes_std_and_residuals(geodataframe):
     L_slopes = []
     M_slopes = []
     L_std_devs = []
     M_std_devs = []
 
@@ -708,15 +774,15 @@
     # Rename the index column to "CODE"
     #gdf = gdf.rename(columns={'index': 'CODE'})
     gdf = gdf.reindex(columns=col_titles)
     
     # Get the CRS of the GeoDataFrame
     gdf.crs=crs_ini
     #gdf=gdf.dropna()
-    import xml.etree.ElementTree as ET
+    
     
     #####Correct displacement to a stable point############
     # try:
     #     # _, VEL_STD_series = linear_VEL(gdf[d_columns], d_columns)
         
     #     # # Filter points with the lowest standard deviation
     #     # VEL_STD_series = pd.Series(VEL_STD_series)
@@ -841,18 +907,15 @@
     
     
     # with open(updated_shapefile_path[:-4] + ".cpg", "w") as f:
     #     f.write("UTF-8")
     return gdf , update_dir_shapefile
 
 ##################################################################################################
-import geopandas as gpd
-from shapely.geometry import Point
-import pandas as pd
-from tqdm import tqdm
+
 
 def merge_geodataframes_generator(gdfs):
     total_gdfs = len(gdfs)
 
     for i, gdf in enumerate(gdfs):
         # Extracting x, y coordinates from the geometry on-the-fly without adding to the dataframe
         # xy = gdf.geometry.apply(lambda geom: (geom.x, geom.y))
@@ -906,31 +969,14 @@
     
     
     return final_gdf
 
 
 ###################################################################
 
-import os
-import re
-from datetime import datetime
-from os import listdir
-from os.path import isfile, join
-import cv2
-import geopandas as gpd
-import matplotlib.pyplot as plt
-import numpy as np
-import pandas as pd
-import rasterio
-from matplotlib.backends.backend_pdf import PdfPages
-from mpl_toolkits.axes_grid1.inset_locator import inset_axes
-from rasterio.features import geometry_mask
-from rasterio.transform import from_origin
-from scipy.interpolate import griddata
-from skimage.metrics import structural_similarity as ssim
 
 
 def mask_raster(dem_array=None, mask_path=None, no_data_value=np.nan, scatter_x=None, scatter_y=None):
     """
     Parameters:
         - Mask a given raster (DEM) array using a binary mask and optionally filter scatter plot data based on the same mask.
         - dem_array (np.ndarray, optional): The 2D or 3D input raster array to be masked. If 3D, the last dimension is assumed to be the channel dimension (e.g., RGB).
@@ -1288,18 +1334,15 @@
             
         
         
        
         return good_matches, descriptor12, keypoint12
         
 
-    import cv2
-    import numpy as np
-    from scipy.stats import zscore
-    from skimage.filters import gaussian
+   
 
     def calculate_optical_flow(image1, image2, zscore_threshold=2.0, ssim_thresh=ssim_thresh, pyr_scale=0.5, levels=15, winsize=32,iterations= 3, poly_n=5,poly_sigma= 1.5, flags=1, orbit_dir=None):
         # Rasterio reads data as (bands, height, width)
         # OpenCV expects data as (height, width, channels)
         # So we need to transpose the data
         # image1 = np.transpose(image1, [1, 2, 0])
         # image2 = np.transpose(image2, [1, 2, 0])
@@ -1405,33 +1448,26 @@
         
         
         
 
         return velocity, flowx, flowy
 
 
-    import re
-
-    from mpl_toolkits.axes_grid1 import make_axes_locatable
+    
+    
 
     def separate_floats_letters(input_string):
         floats = re.findall(r'\d+\.\d+|\d+', input_string)
         letters = re.findall(r'[a-zA-Z]+', input_string)
         return letters, floats
 
     input_string = image_resolution
     unit, img_res = separate_floats_letters(input_string)
 
-    import earthpy.plot as ep
-    import earthpy.spatial as es
-    import matplotlib.pyplot as plt
-    import numpy as np
-    # Import necessary packages
-    import rasterio as rio
-    from mpl_toolkits.axes_grid1 import make_axes_locatable
+    
 
     def calculate_hillshade(dem_file_path, hillshade_option=True):
         # Open the raster data
 
         with rio.open(dem_file_path) as dem_src:
             dem = dem_src.read(1)
 
@@ -1440,15 +1476,15 @@
             hillshade = es.hillshade(dem)
         else:
             hillshade=dem
         return hillshade
 
     
     
-    import xml.etree.ElementTree as ET
+    
     
     
     def get_values_from_xml(filename):
         try:
             # Parse the XML file
             tree = ET.parse(filename)
             root = tree.getroot()
@@ -1589,16 +1625,15 @@
                 norm= mcolors.Normalize(vmin=vmin, vmax=vmax)
                 if cmap is None:
                     cmap = 'viridis'
                 
                 return cmap, norm
 
         
-        import cmocean
-
+        
         
         fig, axes = plt.subplots(nrows=2, ncols=2, figsize=(20, 10), sharey=False)
 
         # Plot flowx
         #ep.plot_rgb(image1, ax=axes[0, 0], title=f'Disp-X({unit}) - {date1} to {date2}', extent=bounds)
         axes[0, 0].imshow(hillshade, cmap='gray', extent=bounds)
         minmax = np.max(np.abs(flowx))
@@ -1715,21 +1750,15 @@
         mean_array = np.nanmean([array1, array2], axis=0)
         
 
         return mean_array
 
     
 
-    import geopandas as gpd
-    import numpy as np
-    import rasterio
-    from rasterio.features import geometry_mask
-    from rasterio.transform import from_origin
-    from scipy.interpolate import griddata
-    from scipy.spatial import cKDTree
+    
 
     def replace_nan_with_nearest(x, y, z, width, height):
         try:
             # Create a 2D grid of coordinates based on the x, y values
             xi = np.linspace(np.nanmin(x), np.nanmax(x), width)
             yi = np.linspace(np.nanmin(y), np.nanmax(y), height)
             xi, yi = np.meshgrid(xi, yi)
@@ -1862,21 +1891,16 @@
 
         except Exception as e:
             print("An error occurred while creating the GeoTIFF:")
             print(e)
 
         return zi
     
-    import os
-    import numpy as np
-    import rasterio
-    from rasterio.windows import from_bounds
-    from shapely.geometry import box
-    from rasterio.mask import mask
-    import geopandas as gpd
+    
+    
     def crop_to_overlap(folder_path, start_date=start_date, end_date=end_date):
         
         if start_date is not None and end_date is not None:
             from datetime import datetime, timedelta
 
             # User provided start and end date strings
             start_date = start_date
@@ -1958,21 +1982,15 @@
 
 
 
 
 
 ###################################
 
-    import os
-    from datetime import datetime
-
-    import numpy as np
-    import rasterio
-    from tqdm import tqdm
-    from akhdefo_functions import Auto_Variogram
+    
     
 
     def feature_matching(folder_path=input_dir, output_dir=output_dir, zscore_threshold=zscore_threshold, 
     AOI=AOI, conversion_factor=float(img_res[0]), ssim_thresh=ssim_thresh, Vegetation_mask=Vegetation_mask, 
     VEL_scale=VEL_scale, VEL_Mode=VEL_Mode, shapefile_output=shapefile_output, 
     smoothing_kernel_size=smoothing_kernel_size, pixel_size=pixel_size,num_chunks=num_chunks,overlap_percentage=overlap_percentage, 
     pyr_scale=pyr_scale, levels=levels, winsize=winsize,iterations= iterations, poly_n=poly_n,poly_sigma= poly_sigma, flags=flags,
@@ -2384,16 +2402,15 @@
             geodfs_v=merge_geodataframes(geodfs_v)
             #print("DataFrame 2DVEL Summary:\n", geodfs_v.describe())
             geodfs_v.crs=dem_crs
             geodfs_v.to_file(shapefileName + '_2DVEL.shp')
             
             del geodfs_v
            
-            import akhdefo_functions
-            from akhdefo_functions import Crop_to_AOI
+            
             # ####3Look for stable pixel###########
             # os.makedirs(ssim_outdir + '/cropped', exist_ok=True)
 
             # Crop_to_AOI(Path_to_WorkingDir=ssim_outdir, 
             #                   Path_to_AOI_shapefile=AOI, 
             #                   output_CroppedDir=ssim_outdir+ '/cropped', file_ex='.tif')
             # gdf_ssim=process_shapefile_with_rasters(shapefileName +'_E.shp', ssim_outdir + '/cropped')
```

## akhdefo_functions/Akhdefo_Tools.py

```diff
@@ -1008,4485 +1008,3796 @@
 00003ef0: 706f 6e64 696e 6720 686f 7572 2066 6f6c  ponding hour fol
 00003f00: 6465 720d 0a20 2020 2020 2020 2073 6875  der..        shu
 00003f10: 7469 6c2e 6d6f 7665 286f 732e 7061 7468  til.move(os.path
 00003f20: 2e6a 6f69 6e28 6261 7365 5f64 6972 6563  .join(base_direc
 00003f30: 746f 7279 2c20 6669 6c65 6e61 6d65 292c  tory, filename),
 00003f40: 206f 732e 7061 7468 2e6a 6f69 6e28 686f   os.path.join(ho
 00003f50: 7572 5f64 6972 2c20 6e65 775f 6669 6c65  ur_dir, new_file
-00003f60: 6e61 6d65 2929 0d0a 0d0a 0d0a 0d0a 6672  name))........fr
-00003f70: 6f6d 2074 656e 736f 7266 6c6f 772e 6b65  om tensorflow.ke
-00003f80: 7261 7320 696d 706f 7274 2062 6163 6b65  ras import backe
-00003f90: 6e64 2061 7320 4b0d 0a66 726f 6d20 7465  nd as K..from te
-00003fa0: 6e73 6f72 666c 6f77 2e6b 6572 6173 2e6c  nsorflow.keras.l
-00003fb0: 6179 6572 7320 696d 706f 7274 2028 4163  ayers import (Ac
-00003fc0: 7469 7661 7469 6f6e 2c20 436f 6e76 3244  tivation, Conv2D
-00003fd0: 2c20 4465 6e73 652c 2046 6c61 7474 656e  , Dense, Flatten
-00003fe0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00003ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004000: 2020 2020 2020 2020 4d61 7850 6f6f 6c69          MaxPooli
-00004010: 6e67 3244 290d 0a66 726f 6d20 7465 6e73  ng2D)..from tens
-00004020: 6f72 666c 6f77 2e6b 6572 6173 2e6d 6f64  orflow.keras.mod
-00004030: 656c 7320 696d 706f 7274 2053 6571 7565  els import Seque
-00004040: 6e74 6961 6c0d 0a0d 0a0d 0a63 6c61 7373  ntial......class
-00004050: 204c 654e 6574 3a0d 0a20 2020 2040 7374   LeNet:..    @st
-00004060: 6174 6963 6d65 7468 6f64 0d0a 2020 2020  aticmethod..    
-00004070: 6465 6620 6275 696c 6428 7769 6474 682c  def build(width,
-00004080: 2068 6569 6768 742c 2064 6570 7468 2c20   height, depth, 
-00004090: 636c 6173 7365 7329 3a0d 0a20 2020 2020  classes):..     
-000040a0: 2020 2023 2069 6e69 7469 616c 697a 6520     # initialize 
-000040b0: 7468 6520 6d6f 6465 6c0d 0a20 2020 2020  the model..     
-000040c0: 2020 206d 6f64 656c 203d 2053 6571 7565     model = Seque
-000040d0: 6e74 6961 6c28 290d 0a20 2020 2020 2020  ntial()..       
-000040e0: 2069 6e70 7574 5368 6170 6520 3d20 2868   inputShape = (h
-000040f0: 6569 6768 742c 2077 6964 7468 2c20 6465  eight, width, de
-00004100: 7074 6829 0d0a 0d0a 2020 2020 2020 2020  pth)....        
-00004110: 2320 6966 2077 6520 6172 6520 7573 696e  # if we are usin
-00004120: 6720 2263 6861 6e6e 656c 7320 6669 7273  g "channels firs
-00004130: 7422 2c20 7570 6461 7465 2074 6865 2069  t", update the i
-00004140: 6e70 7574 2073 6861 7065 0d0a 2020 2020  nput shape..    
-00004150: 2020 2020 6966 204b 2e69 6d61 6765 5f64      if K.image_d
-00004160: 6174 615f 666f 726d 6174 2829 203d 3d20  ata_format() == 
-00004170: 2263 6861 6e6e 656c 735f 6669 7273 7422  "channels_first"
-00004180: 3a0d 0a20 2020 2020 2020 2020 2020 2069  :..            i
-00004190: 6e70 7574 5368 6170 6520 3d20 2864 6570  nputShape = (dep
-000041a0: 7468 2c20 6865 6967 6874 2c20 7769 6474  th, height, widt
-000041b0: 6829 0d0a 0d0a 2020 2020 2020 2020 2320  h)....        # 
-000041c0: 6669 7273 7420 7365 7420 6f66 2043 4f4e  first set of CON
-000041d0: 5620 3d3e 2052 454c 5520 3d3e 2050 4f4f  V => RELU => POO
-000041e0: 4c20 6c61 7965 7273 0d0a 2020 2020 2020  L layers..      
-000041f0: 2020 6d6f 6465 6c2e 6164 6428 436f 6e76    model.add(Conv
-00004200: 3244 2832 302c 2028 352c 2035 292c 2070  2D(20, (5, 5), p
-00004210: 6164 6469 6e67 3d22 7361 6d65 222c 0d0a  adding="same",..
-00004220: 2020 2020 2020 2020 2020 2020 696e 7075              inpu
-00004230: 745f 7368 6170 653d 696e 7075 7453 6861  t_shape=inputSha
-00004240: 7065 2929 0d0a 2020 2020 2020 2020 6d6f  pe))..        mo
-00004250: 6465 6c2e 6164 6428 4163 7469 7661 7469  del.add(Activati
-00004260: 6f6e 2822 7265 6c75 2229 290d 0a20 2020  on("relu"))..   
-00004270: 2020 2020 206d 6f64 656c 2e61 6464 284d       model.add(M
-00004280: 6178 506f 6f6c 696e 6732 4428 706f 6f6c  axPooling2D(pool
-00004290: 5f73 697a 653d 2832 2c20 3229 2c20 7374  _size=(2, 2), st
-000042a0: 7269 6465 733d 2832 2c20 3229 2929 0d0a  rides=(2, 2)))..
-000042b0: 0d0a 2020 2020 2020 2020 2320 7365 636f  ..        # seco
-000042c0: 6e64 2073 6574 206f 6620 434f 4e56 203d  nd set of CONV =
-000042d0: 3e20 5245 4c55 203d 3e20 504f 4f4c 206c  > RELU => POOL l
-000042e0: 6179 6572 730d 0a20 2020 2020 2020 206d  ayers..        m
-000042f0: 6f64 656c 2e61 6464 2843 6f6e 7632 4428  odel.add(Conv2D(
-00004300: 3530 2c20 2835 2c20 3529 2c20 7061 6464  50, (5, 5), padd
-00004310: 696e 673d 2273 616d 6522 2929 0d0a 2020  ing="same"))..  
-00004320: 2020 2020 2020 6d6f 6465 6c2e 6164 6428        model.add(
-00004330: 4163 7469 7661 7469 6f6e 2822 7265 6c75  Activation("relu
-00004340: 2229 290d 0a20 2020 2020 2020 206d 6f64  "))..        mod
-00004350: 656c 2e61 6464 284d 6178 506f 6f6c 696e  el.add(MaxPoolin
-00004360: 6732 4428 706f 6f6c 5f73 697a 653d 2832  g2D(pool_size=(2
-00004370: 2c20 3229 2c20 7374 7269 6465 733d 2832  , 2), strides=(2
-00004380: 2c20 3229 2929 0d0a 0d0a 2020 2020 2020  , 2)))....      
-00004390: 2020 2320 6669 7273 7420 2861 6e64 206f    # first (and o
-000043a0: 6e6c 7929 2073 6574 206f 6620 4643 203d  nly) set of FC =
-000043b0: 3e20 5245 4c55 206c 6179 6572 730d 0a20  > RELU layers.. 
-000043c0: 2020 2020 2020 206d 6f64 656c 2e61 6464         model.add
-000043d0: 2846 6c61 7474 656e 2829 290d 0a20 2020  (Flatten())..   
-000043e0: 2020 2020 206d 6f64 656c 2e61 6464 2844       model.add(D
-000043f0: 656e 7365 2835 3030 2929 0d0a 2020 2020  ense(500))..    
-00004400: 2020 2020 6d6f 6465 6c2e 6164 6428 4163      model.add(Ac
-00004410: 7469 7661 7469 6f6e 2822 7265 6c75 2229  tivation("relu")
-00004420: 290d 0a0d 0a20 2020 2020 2020 2023 2073  )....        # s
-00004430: 6f66 746d 6178 2063 6c61 7373 6966 6965  oftmax classifie
-00004440: 720d 0a20 2020 2020 2020 206d 6f64 656c  r..        model
-00004450: 2e61 6464 2844 656e 7365 2863 6c61 7373  .add(Dense(class
-00004460: 6573 2929 0d0a 2020 2020 2020 2020 6d6f  es))..        mo
-00004470: 6465 6c2e 6164 6428 4163 7469 7661 7469  del.add(Activati
-00004480: 6f6e 2822 736f 6674 6d61 7822 2929 0d0a  on("softmax"))..
-00004490: 0d0a 2020 2020 2020 2020 2320 7265 7475  ..        # retu
-000044a0: 726e 2074 6865 2063 6f6e 7374 7275 6374  rn the construct
-000044b0: 6564 206e 6574 776f 726b 2061 7263 6869  ed network archi
-000044c0: 7465 6374 7572 650d 0a20 2020 2020 2020  tecture..       
-000044d0: 2072 6574 7572 6e20 6d6f 6465 6c0d 0a0d   return model...
-000044e0: 0a64 6566 204c 656e 6574 5f4d 6f64 656c  .def Lenet_Model
-000044f0: 5f74 7261 696e 696e 6728 6461 7461 7365  _training(datase
-00004500: 743d 2244 6174 6146 6f72 5472 6169 6e69  t="DataForTraini
-00004510: 6e67 222c 206d 6f64 656c 5f6f 7574 3d22  ng", model_out="
-00004520: 666f 6767 795f 6e6f 745f 666f 6767 792e  foggy_not_foggy.
-00004530: 6d6f 6465 6c22 2c20 706c 6f74 3d22 4d6f  model", plot="Mo
-00004540: 6465 6c5f 7374 6174 5f70 6c6f 742e 706e  del_stat_plot.pn
-00004550: 6722 2c20 4550 4f43 4853 203d 2031 3030  g", EPOCHS = 100
-00004560: 2c0d 0a20 2020 2049 4e49 545f 4c52 203d  ,..    INIT_LR =
-00004570: 2031 652d 332c 2020 4253 203d 2033 3229   1e-3,  BS = 32)
-00004580: 3a0d 0a0d 0a20 2020 2027 2727 0d0a 0d0a  :....    '''....
-00004590: 2020 2020 5468 6973 2066 756e 6374 696f      This functio
-000045a0: 6e2c 204c 656e 6574 5f4d 6f64 656c 5f74  n, Lenet_Model_t
-000045b0: 7261 696e 2829 2c20 6973 2064 6573 6967  rain(), is desig
-000045c0: 6e65 6420 746f 2074 7261 696e 2061 2063  ned to train a c
-000045d0: 6f6e 766f 6c75 7469 6f6e 616c 206e 6575  onvolutional neu
-000045e0: 7261 6c20 6e65 7477 6f72 6b20 2843 4e4e  ral network (CNN
-000045f0: 2920 7573 696e 6720 7468 6520 4c65 4e65  ) using the LeNe
-00004600: 7420 6172 6368 6974 6563 7475 7265 2e20  t architecture. 
-00004610: 5468 6520 6e65 7477 6f72 6b20 6973 2074  The network is t
-00004620: 7261 696e 6564 206f 6e20 6120 6461 7461  rained on a data
-00004630: 7365 7420 6f66 2069 6d61 6765 7320 746f  set of images to
-00004640: 2063 6c61 7373 6966 7920 7768 6574 6865   classify whethe
-00004650: 7220 7468 6579 2061 7265 2022 666f 6767  r they are "fogg
-00004660: 7922 206f 7220 226e 6f74 2066 6f67 6779  y" or "not foggy
-00004670: 222e 0d0a 0d0a 2020 2020 5061 7261 6d65  ".....    Parame
-00004680: 7465 7273 3a0d 0a20 2020 202d 2d2d 2d2d  ters:..    -----
-00004690: 2d2d 2d2d 2d2d 0d0a 0d0a 2020 2020 6461  ------....    da
-000046a0: 7461 7365 743a 2073 7472 0d0a 2020 2020  taset: str..    
-000046b0: 2020 2864 6566 6175 6c74 3d22 4461 7461    (default="Data
-000046c0: 466f 7254 7261 696e 696e 6722 2920 5061  ForTraining") Pa
-000046d0: 7468 2074 6f20 7468 6520 6469 7265 6374  th to the direct
-000046e0: 6f72 7920 636f 6e74 6169 6e69 6e67 2074  ory containing t
-000046f0: 6865 2069 6d61 6765 2064 6174 6120 666f  he image data fo
-00004700: 7220 7472 6169 6e69 6e67 2e20 5468 6520  r training. The 
-00004710: 696d 6167 6573 2061 7265 2065 7870 6563  images are expec
-00004720: 7465 6420 746f 2062 6520 696e 2073 6570  ted to be in sep
-00004730: 6172 6174 6520 6469 7265 6374 6f72 6965  arate directorie
-00004740: 7320 6e61 6d65 6420 6166 7465 7220 7468  s named after th
-00004750: 6569 7220 636f 7272 6573 706f 6e64 696e  eir correspondin
-00004760: 6720 636c 6173 7320 2822 666f 6767 7922  g class ("foggy"
-00004770: 206f 7220 226e 6f74 2066 6f67 6779 2229   or "not foggy")
-00004780: 2e0d 0a20 2020 206d 6f64 656c 5f6f 7574  ...    model_out
-00004790: 3a20 7374 720d 0a20 2020 2020 2028 6465  : str..      (de
-000047a0: 6661 756c 743d 2266 6f67 6779 5f6e 6f74  fault="foggy_not
-000047b0: 5f66 6f67 6779 2e6d 6f64 656c 2229 2054  _foggy.model") T
-000047c0: 6865 206e 616d 6520 6f72 2070 6174 6820  he name or path 
-000047d0: 666f 7220 7468 6520 6f75 7470 7574 2066  for the output f
-000047e0: 696c 6520 7768 6572 6520 7468 6520 7472  ile where the tr
-000047f0: 6169 6e65 6420 6d6f 6465 6c20 7769 6c6c  ained model will
-00004800: 2062 6520 7361 7665 6420 696e 2074 6865   be saved in the
-00004810: 2068 3520 666f 726d 6174 2e0d 0a20 2020   h5 format...   
-00004820: 2070 6c6f 743a 2073 7472 0d0a 2020 2020   plot: str..    
-00004830: 2028 6465 6661 756c 743d 224d 6f64 656c   (default="Model
-00004840: 5f73 7461 745f 706c 6f74 2e70 6e67 2229  _stat_plot.png")
-00004850: 2054 6865 206e 616d 6520 6f72 2070 6174   The name or pat
-00004860: 6820 666f 7220 7468 6520 6f75 7470 7574  h for the output
-00004870: 2069 6d61 6765 2066 696c 6520 7768 6572   image file wher
-00004880: 6520 6120 706c 6f74 206f 6620 7468 6520  e a plot of the 
-00004890: 7472 6169 6e69 6e67 206c 6f73 7320 616e  training loss an
-000048a0: 6420 6163 6375 7261 6379 2077 696c 6c20  d accuracy will 
-000048b0: 6265 2073 6176 6564 2e0d 0a20 2020 2045  be saved...    E
-000048c0: 504f 4348 533a 2069 6e74 0d0a 2020 2020  POCHS: int..    
-000048d0: 2020 2864 6566 6175 6c74 3d31 3030 2954    (default=100)T
-000048e0: 6865 206e 756d 6265 7220 6f66 2065 706f  he number of epo
-000048f0: 6368 7320 746f 2075 7365 2066 6f72 2074  chs to use for t
-00004900: 7261 696e 696e 672e 0d0a 2020 2020 494e  raining...    IN
-00004910: 4954 5f4c 523a 2066 6c6f 6174 0d0a 2020  IT_LR: float..  
-00004920: 2020 2020 2864 6566 6175 6c74 3d31 652d      (default=1e-
-00004930: 3329 5468 6520 696e 6974 6961 6c20 6c65  3)The initial le
-00004940: 6172 6e69 6e67 2072 6174 6520 666f 7220  arning rate for 
-00004950: 7468 6520 4164 616d 206f 7074 696d 697a  the Adam optimiz
-00004960: 6572 2e0d 0a20 2020 2042 533a 2069 6e74  er...    BS: int
-00004970: 0d0a 2020 2020 2020 2864 6566 6175 6c74  ..      (default
-00004980: 3d33 3229 5468 6520 6261 7463 6820 7369  =32)The batch si
-00004990: 7a65 2066 6f72 2074 7261 696e 696e 672e  ze for training.
-000049a0: 0d0a 0d0a 2020 2020 5265 7475 726e 733a  ....    Returns:
-000049b0: 0d0a 2020 2020 2d2d 2d2d 2d2d 2d2d 0d0a  ..    --------..
-000049c0: 2020 2020 2d20 5472 6169 6e73 2061 204c      - Trains a L
-000049d0: 654e 6574 206d 6f64 656c 206f 6e20 7468  eNet model on th
-000049e0: 6520 6769 7665 6e20 6461 7461 7365 742e  e given dataset.
-000049f0: 0d0a 2020 2020 2d20 5361 7665 7320 7468  ..    - Saves th
-00004a00: 6520 7472 6169 6e65 6420 6d6f 6465 6c20  e trained model 
-00004a10: 746f 2064 6973 6b20 696e 2074 6865 2068  to disk in the h
-00004a20: 3520 666f 726d 6174 2e0d 0a20 2020 202d  5 format...    -
-00004a30: 2050 6c6f 7473 2074 6865 2074 7261 696e   Plots the train
-00004a40: 696e 6720 616e 6420 7661 6c69 6461 7469  ing and validati
-00004a50: 6f6e 206c 6f73 7320 616e 6420 6163 6375  on loss and accu
-00004a60: 7261 6379 2061 7320 6120 6675 6e63 7469  racy as a functi
-00004a70: 6f6e 206f 6620 6570 6f63 6820 6e75 6d62  on of epoch numb
-00004a80: 6572 2c20 616e 6420 7361 7665 7320 7468  er, and saves th
-00004a90: 6520 706c 6f74 2074 6f20 6469 736b 2e20  e plot to disk. 
-00004aa0: 5468 6520 706c 6f74 2061 6c73 6f20 696e  The plot also in
-00004ab0: 636c 7564 6573 2074 6865 206d 6f64 656c  cludes the model
-00004ac0: 2073 756d 6d61 7279 2e0d 0a20 2020 202d   summary...    -
-00004ad0: 204e 6f74 653a 2054 6865 2066 756e 6374   Note: The funct
-00004ae0: 696f 6e20 7573 6573 2064 6174 6120 6175  ion uses data au
-00004af0: 676d 656e 7461 7469 6f6e 2074 6563 686e  gmentation techn
-00004b00: 6971 7565 7320 6475 7269 6e67 2074 7261  iques during tra
-00004b10: 696e 696e 672c 2069 6e63 6c75 6469 6e67  ining, including
-00004b20: 2072 616e 646f 6d20 726f 7461 7469 6f6e   random rotation
-00004b30: 732c 2077 6964 7468 2061 6e64 2068 6569  s, width and hei
-00004b40: 6768 7420 7368 6966 7473 2c20 7368 6561  ght shifts, shea
-00004b50: 7269 6e67 2c20 7a6f 6f6d 696e 672c 2061  ring, zooming, a
-00004b60: 6e64 2068 6f72 697a 6f6e 7461 6c20 666c  nd horizontal fl
-00004b70: 6970 7069 6e67 2e0d 0a20 2020 202d 2054  ipping...    - T
-00004b80: 6869 7320 6675 6e63 7469 6f6e 2075 7365  his function use
-00004b90: 7320 7468 6520 5465 6e73 6f72 466c 6f77  s the TensorFlow
-00004ba0: 2c20 4b65 7261 732c 204f 7065 6e43 562c  , Keras, OpenCV,
-00004bb0: 2061 6e64 206d 6174 706c 6f74 6c69 6220   and matplotlib 
-00004bc0: 6c69 6272 6172 6965 732e 0d0a 0d0a 2020  libraries.....  
-00004bd0: 2020 2727 270d 0a20 2020 2020 2020 2020    '''..         
-00004be0: 2020 200d 0a20 2020 2069 6d70 6f72 7420     ..    import 
-00004bf0: 6172 6770 6172 7365 0d0a 2020 2020 696d  argparse..    im
-00004c00: 706f 7274 206f 730d 0a20 2020 2069 6d70  port os..    imp
-00004c10: 6f72 7420 7261 6e64 6f6d 0d0a 0d0a 2020  ort random....  
-00004c20: 2020 696d 706f 7274 2063 7632 0d0a 2020    import cv2..  
-00004c30: 2020 696d 706f 7274 206d 6174 706c 6f74    import matplot
-00004c40: 6c69 622e 7079 706c 6f74 2061 7320 706c  lib.pyplot as pl
-00004c50: 740d 0a20 2020 2069 6d70 6f72 7420 6e75  t..    import nu
-00004c60: 6d70 7920 6173 206e 700d 0a20 2020 2066  mpy as np..    f
-00004c70: 726f 6d20 696d 7574 696c 7320 696d 706f  rom imutils impo
-00004c80: 7274 2070 6174 6873 0d0a 2020 2020 6672  rt paths..    fr
-00004c90: 6f6d 2073 6b6c 6561 726e 2e6d 6f64 656c  om sklearn.model
-00004ca0: 5f73 656c 6563 7469 6f6e 2069 6d70 6f72  _selection impor
-00004cb0: 7420 7472 6169 6e5f 7465 7374 5f73 706c  t train_test_spl
-00004cc0: 6974 0d0a 2020 2020 6672 6f6d 2074 656e  it..    from ten
-00004cd0: 736f 7266 6c6f 772e 6b65 7261 732e 6f70  sorflow.keras.op
-00004ce0: 7469 6d69 7a65 7273 2069 6d70 6f72 7420  timizers import 
-00004cf0: 4164 616d 0d0a 2020 2020 6672 6f6d 2074  Adam..    from t
-00004d00: 656e 736f 7266 6c6f 772e 6b65 7261 732e  ensorflow.keras.
-00004d10: 7072 6570 726f 6365 7373 696e 672e 696d  preprocessing.im
-00004d20: 6167 6520 696d 706f 7274 2028 496d 6167  age import (Imag
-00004d30: 6544 6174 6147 656e 6572 6174 6f72 2c0d  eDataGenerator,.
-00004d40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004d70: 2020 2020 2020 2069 6d67 5f74 6f5f 6172         img_to_ar
-00004d80: 7261 7929 0d0a 2020 2020 6672 6f6d 2074  ray)..    from t
-00004d90: 656e 736f 7266 6c6f 772e 6b65 7261 732e  ensorflow.keras.
-00004da0: 7574 696c 7320 696d 706f 7274 2074 6f5f  utils import to_
-00004db0: 6361 7465 676f 7269 6361 6c0d 0a0d 0a20  categorical.... 
-00004dc0: 2020 2023 6672 6f6d 206d 6168 6d75 645f     #from mahmud_
-00004dd0: 6d6c 2e6c 656e 6574 2069 6d70 6f72 7420  ml.lenet import 
-00004de0: 4c65 4e65 740d 0a0d 0a20 2020 200d 0a0d  LeNet....    ...
-00004df0: 0a20 2020 2064 6174 6173 6574 3d64 6174  .    dataset=dat
-00004e00: 6173 6574 0d0a 2020 2020 6d6f 6465 6c3d  aset..    model=
-00004e10: 6d6f 6465 6c5f 6f75 740d 0a20 2020 2070  model_out..    p
-00004e20: 6c6f 743d 706c 6f74 0d0a 2020 2020 0d0a  lot=plot..    ..
-00004e30: 0d0a 2020 2020 2320 696e 6974 6961 6c69  ..    # initiali
-00004e40: 7a65 2074 6865 206e 756d 6265 7220 6f66  ze the number of
-00004e50: 2065 706f 6368 7320 746f 2074 7261 696e   epochs to train
-00004e60: 2066 6f72 2c20 696e 6974 6961 6c20 6c65   for, initial le
-00004e70: 6172 6e69 6e67 2072 6174 652c 2061 6e64  arning rate, and
-00004e80: 2062 6174 6368 2073 697a 650d 0a20 2020   batch size..   
-00004e90: 2045 504f 4348 5320 3d20 4550 4f43 4853   EPOCHS = EPOCHS
-00004ea0: 0d0a 2020 2020 494e 4954 5f4c 5220 3d20  ..    INIT_LR = 
-00004eb0: 494e 4954 5f4c 520d 0a20 2020 2042 5320  INIT_LR..    BS 
-00004ec0: 3d20 4253 0d0a 0d0a 2020 2020 2320 696e  = BS....    # in
-00004ed0: 6974 6961 6c69 7a65 2074 6865 2064 6174  itialize the dat
-00004ee0: 6120 616e 6420 6c61 6265 6c73 0d0a 2020  a and labels..  
-00004ef0: 2020 7072 696e 7428 225b 494e 464f 5d20    print("[INFO] 
-00004f00: 6c6f 6164 696e 6720 696d 6167 6573 2e2e  loading images..
-00004f10: 2e22 290d 0a20 2020 2064 6174 6120 3d20  .")..    data = 
-00004f20: 5b5d 0d0a 2020 2020 6c61 6265 6c73 203d  []..    labels =
-00004f30: 205b 5d0d 0a0d 0a20 2020 2023 2067 7261   []....    # gra
-00004f40: 6220 7468 6520 696d 6167 6520 7061 7468  b the image path
-00004f50: 7320 616e 6420 7261 6e64 6f6d 6c79 2073  s and randomly s
-00004f60: 6875 6666 6c65 0d0a 2020 2020 696d 6167  huffle..    imag
-00004f70: 6550 6174 6873 203d 2073 6f72 7465 6428  ePaths = sorted(
-00004f80: 6c69 7374 2870 6174 6873 2e6c 6973 745f  list(paths.list_
-00004f90: 696d 6167 6573 2864 6174 6173 6574 2929  images(dataset))
-00004fa0: 290d 0a20 2020 2072 616e 646f 6d2e 7365  )..    random.se
-00004fb0: 6564 2834 3229 0d0a 2020 2020 7261 6e64  ed(42)..    rand
-00004fc0: 6f6d 2e73 6875 6666 6c65 2869 6d61 6765  om.shuffle(image
-00004fd0: 5061 7468 7329 0d0a 0d0a 2020 2020 2320  Paths)....    # 
-00004fe0: 6c6f 6f70 206f 7665 7220 7468 6520 696e  loop over the in
-00004ff0: 7075 7420 696d 6167 6573 0d0a 2020 2020  put images..    
-00005000: 666f 7220 696d 6167 6550 6174 6820 696e  for imagePath in
-00005010: 2069 6d61 6765 5061 7468 733a 0d0a 2020   imagePaths:..  
-00005020: 2020 2020 2020 2320 6c6f 6164 2074 6865        # load the
-00005030: 2069 6d61 6765 2c20 7072 652d 7072 6f63   image, pre-proc
-00005040: 6573 7320 6974 2c20 616e 6420 7374 6f72  ess it, and stor
-00005050: 6520 6974 2069 6e20 7468 6520 6461 7461  e it in the data
-00005060: 206c 6973 740d 0a20 2020 2020 2020 2069   list..        i
-00005070: 6d61 6765 203d 2063 7632 2e69 6d72 6561  mage = cv2.imrea
-00005080: 6428 696d 6167 6550 6174 6829 0d0a 2020  d(imagePath)..  
-00005090: 2020 2020 2020 696d 6167 6520 3d20 6376        image = cv
-000050a0: 322e 7265 7369 7a65 2869 6d61 6765 2c20  2.resize(image, 
-000050b0: 2832 382c 2032 3829 290d 0a20 2020 2020  (28, 28))..     
-000050c0: 2020 2069 6d61 6765 203d 2069 6d67 5f74     image = img_t
-000050d0: 6f5f 6172 7261 7928 696d 6167 6529 0d0a  o_array(image)..
-000050e0: 2020 2020 2020 2020 6461 7461 2e61 7070          data.app
-000050f0: 656e 6428 696d 6167 6529 0d0a 0d0a 2020  end(image)....  
-00005100: 2020 2020 2020 2320 6578 7472 6163 7420        # extract 
-00005110: 7468 6520 636c 6173 7320 6c61 6265 6c20  the class label 
-00005120: 6672 6f6d 2074 6865 2069 6d61 6765 2070  from the image p
-00005130: 6174 6820 616e 6420 7570 6461 7465 2074  ath and update t
-00005140: 6865 206c 6162 656c 7320 6c69 7374 0d0a  he labels list..
-00005150: 2020 2020 2020 2020 6c61 6265 6c20 3d20          label = 
-00005160: 696d 6167 6550 6174 682e 7370 6c69 7428  imagePath.split(
-00005170: 6f73 2e70 6174 682e 7365 7029 5b2d 325d  os.path.sep)[-2]
-00005180: 0d0a 2020 2020 2020 2020 6c61 6265 6c20  ..        label 
-00005190: 3d20 3120 6966 206c 6162 656c 203d 3d20  = 1 if label == 
-000051a0: 2266 6f67 6779 2220 656c 7365 2030 0d0a  "foggy" else 0..
-000051b0: 2020 2020 2020 2020 6c61 6265 6c73 2e61          labels.a
-000051c0: 7070 656e 6428 6c61 6265 6c29 0d0a 0d0a  ppend(label)....
-000051d0: 2020 2020 2320 7363 616c 6520 7468 6520      # scale the 
-000051e0: 7261 7720 7069 7865 6c20 696e 7465 6e73  raw pixel intens
-000051f0: 6974 6965 7320 746f 2074 6865 2072 616e  ities to the ran
-00005200: 6765 205b 302c 2031 5d0d 0a20 2020 2064  ge [0, 1]..    d
-00005210: 6174 6120 3d20 6e70 2e61 7272 6179 2864  ata = np.array(d
-00005220: 6174 612c 2064 7479 7065 3d22 666c 6f61  ata, dtype="floa
-00005230: 7422 2920 2f20 3235 352e 300d 0a20 2020  t") / 255.0..   
-00005240: 206c 6162 656c 7320 3d20 6e70 2e61 7272   labels = np.arr
-00005250: 6179 286c 6162 656c 7329 0d0a 0d0a 2020  ay(labels)....  
-00005260: 2020 2320 7061 7274 6974 696f 6e20 7468    # partition th
-00005270: 6520 6461 7461 2069 6e74 6f20 7472 6169  e data into trai
-00005280: 6e69 6e67 2061 6e64 2074 6573 7469 6e67  ning and testing
-00005290: 2073 706c 6974 7320 7573 696e 6720 3735   splits using 75
-000052a0: 2520 6f66 2074 6865 2064 6174 6120 666f  % of the data fo
-000052b0: 7220 7472 6169 6e69 6e67 2061 6e64 2074  r training and t
-000052c0: 6865 2072 656d 6169 6e69 6e67 2032 3525  he remaining 25%
-000052d0: 2066 6f72 2074 6573 7469 6e67 0d0a 2020   for testing..  
-000052e0: 2020 2874 7261 696e 582c 2074 6573 7458    (trainX, testX
-000052f0: 2c20 7472 6169 6e59 2c20 7465 7374 5929  , trainY, testY)
-00005300: 203d 2074 7261 696e 5f74 6573 745f 7370   = train_test_sp
-00005310: 6c69 7428 6461 7461 2c20 6c61 6265 6c73  lit(data, labels
-00005320: 2c20 7465 7374 5f73 697a 653d 302e 3235  , test_size=0.25
-00005330: 2c20 7261 6e64 6f6d 5f73 7461 7465 3d34  , random_state=4
-00005340: 3229 0d0a 0d0a 2020 2020 2320 636f 6e76  2)....    # conv
-00005350: 6572 7420 7468 6520 6c61 6265 6c73 2066  ert the labels f
-00005360: 726f 6d20 696e 7465 6765 7273 2074 6f20  rom integers to 
-00005370: 7665 6374 6f72 730d 0a20 2020 2074 7261  vectors..    tra
-00005380: 696e 5920 3d20 746f 5f63 6174 6567 6f72  inY = to_categor
-00005390: 6963 616c 2874 7261 696e 592c 206e 756d  ical(trainY, num
-000053a0: 5f63 6c61 7373 6573 3d32 290d 0a20 2020  _classes=2)..   
-000053b0: 2074 6573 7459 203d 2074 6f5f 6361 7465   testY = to_cate
-000053c0: 676f 7269 6361 6c28 7465 7374 592c 206e  gorical(testY, n
-000053d0: 756d 5f63 6c61 7373 6573 3d32 290d 0a0d  um_classes=2)...
-000053e0: 0a20 2020 2023 2063 6f6e 7374 7275 6374  .    # construct
-000053f0: 2074 6865 2069 6d61 6765 2067 656e 6572   the image gener
-00005400: 6174 6f72 2066 6f72 2064 6174 6120 6175  ator for data au
-00005410: 676d 656e 7461 7469 6f6e 0d0a 2020 2020  gmentation..    
-00005420: 6175 6720 3d20 496d 6167 6544 6174 6147  aug = ImageDataG
-00005430: 656e 6572 6174 6f72 2872 6f74 6174 696f  enerator(rotatio
-00005440: 6e5f 7261 6e67 653d 3330 2c20 7769 6474  n_range=30, widt
-00005450: 685f 7368 6966 745f 7261 6e67 653d 302e  h_shift_range=0.
-00005460: 312c 2068 6569 6768 745f 7368 6966 745f  1, height_shift_
-00005470: 7261 6e67 653d 302e 312c 2073 6865 6172  range=0.1, shear
-00005480: 5f72 616e 6765 3d30 2e32 2c20 7a6f 6f6d  _range=0.2, zoom
-00005490: 5f72 616e 6765 3d30 2e32 2c20 686f 7269  _range=0.2, hori
-000054a0: 7a6f 6e74 616c 5f66 6c69 703d 5472 7565  zontal_flip=True
-000054b0: 2c20 6669 6c6c 5f6d 6f64 653d 226e 6561  , fill_mode="nea
-000054c0: 7265 7374 2229 0d0a 0d0a 2020 2020 2320  rest")....    # 
-000054d0: 696e 6974 6961 6c69 7a65 2074 6865 206d  initialize the m
-000054e0: 6f64 656c 0d0a 2020 2020 7072 696e 7428  odel..    print(
-000054f0: 225b 494e 464f 5d20 636f 6d70 696c 696e  "[INFO] compilin
-00005500: 6720 6d6f 6465 6c2e 2e2e 2229 0d0a 2020  g model...")..  
-00005510: 2020 6d6f 6465 6c20 3d20 4c65 4e65 742e    model = LeNet.
-00005520: 6275 696c 6428 7769 6474 683d 3238 2c20  build(width=28, 
-00005530: 6865 6967 6874 3d32 382c 2064 6570 7468  height=28, depth
-00005540: 3d33 2c20 636c 6173 7365 733d 3229 0d0a  =3, classes=2)..
-00005550: 2020 2020 6f70 7420 3d20 4164 616d 286c      opt = Adam(l
-00005560: 6561 726e 696e 675f 7261 7465 3d49 4e49  earning_rate=INI
-00005570: 545f 4c52 290d 0a20 2020 206d 6f64 656c  T_LR)..    model
-00005580: 2e63 6f6d 7069 6c65 286c 6f73 733d 2262  .compile(loss="b
-00005590: 696e 6172 795f 6372 6f73 7365 6e74 726f  inary_crossentro
-000055a0: 7079 222c 206f 7074 696d 697a 6572 3d6f  py", optimizer=o
-000055b0: 7074 2c20 6d65 7472 6963 733d 5b22 6163  pt, metrics=["ac
-000055c0: 6375 7261 6379 225d 290d 0a0d 0a20 2020  curacy"])....   
-000055d0: 2023 2074 7261 696e 2074 6865 206e 6574   # train the net
-000055e0: 776f 726b 0d0a 2020 2020 7072 696e 7428  work..    print(
-000055f0: 225b 494e 464f 5d20 7472 6169 6e69 6e67  "[INFO] training
-00005600: 206e 6574 776f 726b 2e2e 2e22 290d 0a20   network...").. 
-00005610: 2020 2048 203d 206d 6f64 656c 2e66 6974     H = model.fit
-00005620: 2878 3d61 7567 2e66 6c6f 7728 7472 6169  (x=aug.flow(trai
-00005630: 6e58 2c20 7472 6169 6e59 2c20 6261 7463  nX, trainY, batc
-00005640: 685f 7369 7a65 3d42 5329 2c20 7661 6c69  h_size=BS), vali
-00005650: 6461 7469 6f6e 5f64 6174 613d 2874 6573  dation_data=(tes
-00005660: 7458 2c20 7465 7374 5929 2c20 7374 6570  tX, testY), step
-00005670: 735f 7065 725f 6570 6f63 683d 6c65 6e28  s_per_epoch=len(
-00005680: 7472 6169 6e58 2920 2f2f 2042 532c 2065  trainX) // BS, e
-00005690: 706f 6368 733d 4550 4f43 4853 2c20 7665  pochs=EPOCHS, ve
-000056a0: 7262 6f73 653d 3129 0d0a 0d0a 2020 2020  rbose=1)....    
-000056b0: 2320 7361 7665 2074 6865 206d 6f64 656c  # save the model
-000056c0: 2074 6f20 6469 736b 0d0a 2020 2020 7072   to disk..    pr
-000056d0: 696e 7428 225b 494e 464f 5d20 7365 7269  int("[INFO] seri
-000056e0: 616c 697a 696e 6720 6e65 7477 6f72 6b2e  alizing network.
-000056f0: 2e2e 2229 0d0a 2020 2020 6d6f 6465 6c2e  ..")..    model.
-00005700: 7361 7665 286d 6f64 656c 5f6f 7574 2c20  save(model_out, 
-00005710: 7361 7665 5f66 6f72 6d61 743d 2268 3522  save_format="h5"
-00005720: 290d 0a0d 0a20 2020 2023 2323 2323 2323  )....    #######
-00005730: 2323 2323 2323 0d0a 0d0a 2020 2020 6672  ######....    fr
-00005740: 6f6d 2074 656e 736f 7266 6c6f 772e 6b65  om tensorflow.ke
-00005750: 7261 732e 6d6f 6465 6c73 2069 6d70 6f72  ras.models impor
-00005760: 7420 6c6f 6164 5f6d 6f64 656c 0d0a 0d0a  t load_model....
-00005770: 2020 2020 2320 4c6f 6164 2074 6865 206d      # Load the m
-00005780: 6f64 656c 0d0a 2020 2020 6d6f 6465 6c20  odel..    model 
-00005790: 3d20 6c6f 6164 5f6d 6f64 656c 286d 6f64  = load_model(mod
-000057a0: 656c 5f6f 7574 290d 0a0d 0a20 2020 2023  el_out)....    #
-000057b0: 2023 2050 7269 6e74 206d 6f64 656c 2073   # Print model s
-000057c0: 756d 6d61 7279 0d0a 2020 2020 2320 7072  ummary..    # pr
-000057d0: 696e 7428 225c 6e4d 6f64 656c 2053 756d  int("\nModel Sum
-000057e0: 6d61 7279 3a22 290d 0a20 2020 2023 6d6f  mary:")..    #mo
-000057f0: 6465 6c2e 7375 6d6d 6172 7928 290d 0a0d  del.summary()...
-00005800: 0a20 2020 2069 6d70 6f72 7420 696f 0d0a  .    import io..
-00005810: 2020 2020 696d 706f 7274 2072 650d 0a0d      import re...
-00005820: 0a20 2020 2069 6d70 6f72 7420 6d61 7470  .    import matp
-00005830: 6c6f 746c 6962 2e70 7970 6c6f 7420 6173  lotlib.pyplot as
-00005840: 2070 6c74 0d0a 0d0a 2020 2020 2320 5361   plt....    # Sa
-00005850: 7665 2074 6865 2073 756d 6d61 7279 2074  ve the summary t
-00005860: 6f20 6120 7374 7269 6e67 0d0a 2020 2020  o a string..    
-00005870: 7374 7265 616d 203d 2069 6f2e 5374 7269  stream = io.Stri
-00005880: 6e67 494f 2829 0d0a 2020 2020 6d6f 6465  ngIO()..    mode
-00005890: 6c2e 7375 6d6d 6172 7928 7072 696e 745f  l.summary(print_
-000058a0: 666e 3d6c 616d 6264 6120 783a 2073 7472  fn=lambda x: str
-000058b0: 6561 6d2e 7772 6974 6528 7820 2b20 275c  eam.write(x + '\
-000058c0: 6e27 2929 0d0a 2020 2020 7375 6d6d 6172  n'))..    summar
-000058d0: 795f 7374 7269 6e67 203d 2073 7472 6561  y_string = strea
-000058e0: 6d2e 6765 7476 616c 7565 2829 0d0a 2020  m.getvalue()..  
-000058f0: 2020 7374 7265 616d 2e63 6c6f 7365 2829    stream.close()
-00005900: 0d0a 0d0a 2020 2020 2320 5072 6570 726f  ....    # Prepro
-00005910: 6365 7373 2074 6865 2073 7472 696e 6720  cess the string 
-00005920: 746f 2072 656d 6f76 6520 756e 7761 6e74  to remove unwant
-00005930: 6564 2063 6861 7261 6374 6572 730d 0a20  ed characters.. 
-00005940: 2020 2073 756d 6d61 7279 5f73 7472 696e     summary_strin
-00005950: 6720 3d20 7265 2e73 7562 2827 5f2b 272c  g = re.sub('_+',
-00005960: 2027 272c 2073 756d 6d61 7279 5f73 7472   '', summary_str
-00005970: 696e 6729 0d0a 2020 2020 7375 6d6d 6172  ing)..    summar
-00005980: 795f 7374 7269 6e67 203d 2072 652e 7375  y_string = re.su
-00005990: 6228 273d 2b27 2c20 2727 2c20 7375 6d6d  b('=+', '', summ
-000059a0: 6172 795f 7374 7269 6e67 290d 0a0d 0a0d  ary_string).....
-000059b0: 0a20 2020 2023 2323 2323 2323 2323 2323  .    ###########
-000059c0: 2323 2323 0d0a 0d0a 2020 2020 2320 706c  ####....    # pl
-000059d0: 6f74 2074 6865 2074 7261 696e 696e 6720  ot the training 
-000059e0: 6c6f 7373 2061 6e64 2061 6363 7572 6163  loss and accurac
-000059f0: 790d 0a20 2020 2070 6c74 2e73 7479 6c65  y..    plt.style
-00005a00: 2e75 7365 2822 6767 706c 6f74 2229 0d0a  .use("ggplot")..
-00005a10: 2020 2020 706c 742e 6669 6775 7265 2866      plt.figure(f
-00005a20: 6967 7369 7a65 3d28 3135 2c35 2929 0d0a  igsize=(15,5))..
-00005a30: 2020 2020 4e20 3d20 4550 4f43 4853 0d0a      N = EPOCHS..
-00005a40: 2020 2020 706c 742e 706c 6f74 286e 702e      plt.plot(np.
-00005a50: 6172 616e 6765 2830 2c20 4e29 2c20 482e  arange(0, N), H.
-00005a60: 6869 7374 6f72 795b 226c 6f73 7322 5d2c  history["loss"],
-00005a70: 206c 6162 656c 3d22 7472 6169 6e5f 6c6f   label="train_lo
-00005a80: 7373 2229 0d0a 2020 2020 706c 742e 706c  ss")..    plt.pl
-00005a90: 6f74 286e 702e 6172 616e 6765 2830 2c20  ot(np.arange(0, 
-00005aa0: 4e29 2c20 482e 6869 7374 6f72 795b 2276  N), H.history["v
-00005ab0: 616c 5f6c 6f73 7322 5d2c 206c 6162 656c  al_loss"], label
-00005ac0: 3d22 7661 6c5f 6c6f 7373 2229 0d0a 2020  ="val_loss")..  
-00005ad0: 2020 706c 742e 706c 6f74 286e 702e 6172    plt.plot(np.ar
-00005ae0: 616e 6765 2830 2c20 4e29 2c20 482e 6869  ange(0, N), H.hi
-00005af0: 7374 6f72 795b 2261 6363 7572 6163 7922  story["accuracy"
-00005b00: 5d2c 206c 6162 656c 3d22 7472 6169 6e5f  ], label="train_
-00005b10: 6163 6322 290d 0a20 2020 2070 6c74 2e70  acc")..    plt.p
-00005b20: 6c6f 7428 6e70 2e61 7261 6e67 6528 302c  lot(np.arange(0,
-00005b30: 204e 292c 2048 2e68 6973 746f 7279 5b22   N), H.history["
-00005b40: 7661 6c5f 6163 6375 7261 6379 225d 2c20  val_accuracy"], 
-00005b50: 6c61 6265 6c3d 2276 616c 5f61 6363 2229  label="val_acc")
-00005b60: 0d0a 2020 2020 706c 742e 7469 746c 6528  ..    plt.title(
-00005b70: 2254 7261 696e 696e 6720 4c6f 7373 2061  "Training Loss a
-00005b80: 6e64 2041 6363 7572 6163 7920 6f6e 2066  nd Accuracy on f
-00005b90: 6f67 2f4e 6f74 2066 6f67 2229 0d0a 2020  og/Not fog")..  
-00005ba0: 2020 706c 742e 786c 6162 656c 2822 4570    plt.xlabel("Ep
-00005bb0: 6f63 6820 2322 290d 0a20 2020 2070 6c74  och #")..    plt
-00005bc0: 2e79 6c61 6265 6c28 224c 6f73 732f 4163  .ylabel("Loss/Ac
-00005bd0: 6375 7261 6379 2229 0d0a 2020 2020 706c  curacy")..    pl
-00005be0: 742e 6c65 6765 6e64 286c 6f63 3d22 6c6f  t.legend(loc="lo
-00005bf0: 7765 7220 6c65 6674 2229 0d0a 0d0a 0d0a  wer left")......
-00005c00: 2020 2020 2320 4164 6420 7468 6520 7375      # Add the su
-00005c10: 6d6d 6172 7920 7374 7269 6e67 2061 7320  mmary string as 
-00005c20: 6120 7465 7874 626f 780d 0a20 2020 2023  a textbox..    #
-00005c30: 2041 6464 2074 6578 7420 746f 2066 6967   Add text to fig
-00005c40: 7572 6520 7769 7468 2061 2062 6f75 6e64  ure with a bound
-00005c50: 696e 6720 626f 780d 0a20 2020 2062 626f  ing box..    bbo
-00005c60: 785f 7072 6f70 7320 3d20 6469 6374 2862  x_props = dict(b
-00005c70: 6f78 7374 796c 653d 2272 6f75 6e64 2c20  oxstyle="round, 
-00005c80: 7061 643d 302e 3322 2c20 6663 3d22 7768  pad=0.3", fc="wh
-00005c90: 6974 6522 2c20 6563 3d22 6b22 2c20 6c77  ite", ec="k", lw
-00005ca0: 3d32 2c20 616c 7068 613d 302e 3629 0d0a  =2, alpha=0.6)..
-00005cb0: 2020 2020 706c 742e 6669 6774 6578 7428      plt.figtext(
-00005cc0: 302e 3735 2c20 302e 352c 2073 756d 6d61  0.75, 0.5, summa
-00005cd0: 7279 5f73 7472 696e 672c 2068 6f72 697a  ry_string, horiz
-00005ce0: 6f6e 7461 6c61 6c69 676e 6d65 6e74 3d27  ontalalignment='
-00005cf0: 6c65 6674 272c 2076 6572 7469 6361 6c61  left', verticala
-00005d00: 6c69 676e 6d65 6e74 3d27 6365 6e74 6572  lignment='center
-00005d10: 272c 2066 6f6e 7473 697a 653d 362c 2062  ', fontsize=6, b
-00005d20: 626f 783d 6262 6f78 5f70 726f 7073 290d  box=bbox_props).
-00005d30: 0a0d 0a20 2020 2070 6c74 2e74 6967 6874  ...    plt.tight
-00005d40: 5f6c 6179 6f75 7428 290d 0a0d 0a20 2020  _layout()....   
-00005d50: 2070 6c74 2e73 6176 6566 6967 2870 6c6f   plt.savefig(plo
-00005d60: 7429 0d0a 0d0a 2020 2020 706c 742e 7368  t)....    plt.sh
-00005d70: 6f77 2829 0d0a 0d0a 0d0a 6672 6f6d 206f  ow()......from o
-00005d80: 7320 696d 706f 7274 206c 6973 7464 6972  s import listdir
-00005d90: 2c20 6d61 6b65 6469 7273 0d0a 6672 6f6d  , makedirs..from
-00005da0: 206f 732e 7061 7468 2069 6d70 6f72 7420   os.path import 
-00005db0: 6973 6469 722c 2069 7366 696c 652c 206a  isdir, isfile, j
-00005dc0: 6f69 6e0d 0a0d 0a69 6d70 6f72 7420 6376  oin....import cv
-00005dd0: 320d 0a69 6d70 6f72 7420 6e75 6d70 7920  2..import numpy 
-00005de0: 6173 206e 700d 0a66 726f 6d20 5049 4c20  as np..from PIL 
-00005df0: 696d 706f 7274 2049 6d61 6765 0d0a 6672  import Image..fr
-00005e00: 6f6d 2074 656e 736f 7266 6c6f 772e 6b65  om tensorflow.ke
-00005e10: 7261 732e 6d6f 6465 6c73 2069 6d70 6f72  ras.models impor
-00005e20: 7420 6c6f 6164 5f6d 6f64 656c 0d0a 6672  t load_model..fr
-00005e30: 6f6d 2074 656e 736f 7266 6c6f 772e 6b65  om tensorflow.ke
-00005e40: 7261 732e 7072 6570 726f 6365 7373 696e  ras.preprocessin
-00005e50: 672e 696d 6167 6520 696d 706f 7274 2069  g.image import i
-00005e60: 6d67 5f74 6f5f 6172 7261 790d 0a66 726f  mg_to_array..fro
-00005e70: 6d20 7471 646d 2069 6d70 6f72 7420 7471  m tqdm import tq
-00005e80: 646d 0d0a 0d0a 0d0a 6465 6620 636c 6173  dm......def clas
-00005e90: 7369 6669 6361 7469 6f6e 2869 6e70 7574  sification(input
-00005ea0: 5f64 6972 3d22 6461 7461 7365 745f 696d  _dir="dataset_im
-00005eb0: 6167 6572 7922 2c20 7472 6169 6e65 645f  agery", trained_
-00005ec0: 6d6f 6465 6c3d 2266 6f67 6779 5f6e 6f74  model="foggy_not
-00005ed0: 5f66 6f67 6779 2e6d 6f64 656c 2229 3a0d  _foggy.model"):.
-00005ee0: 0a20 2020 2022 2222 0d0a 2020 2020 436c  .    """..    Cl
-00005ef0: 6173 7369 6669 6573 2069 6d61 6765 7320  assifies images 
-00005f00: 696e 2074 6865 2073 7065 6369 6669 6564  in the specified
-00005f10: 2064 6972 6563 746f 7279 2075 7369 6e67   directory using
-00005f20: 2061 2074 7261 696e 6564 206d 6f64 656c   a trained model
-00005f30: 2e0d 0a0d 0a20 2020 2049 6e70 7574 733a  .....    Inputs:
-00005f40: 0d0a 2020 2020 2d2d 2d2d 2d2d 2d0d 0a20  ..    -------.. 
-00005f50: 2020 2020 2020 202d 2069 6e70 7574 5f64         - input_d
-00005f60: 6972 2028 7374 722c 206f 7074 696f 6e61  ir (str, optiona
-00005f70: 6c29 3a20 5061 7468 2074 6f20 7468 6520  l): Path to the 
-00005f80: 6469 7265 6374 6f72 7920 636f 6e74 6169  directory contai
-00005f90: 6e69 6e67 2074 6865 2069 6e70 7574 2069  ning the input i
-00005fa0: 6d61 6765 732e 2044 6566 6175 6c74 7320  mages. Defaults 
-00005fb0: 746f 2022 6461 7461 7365 745f 696d 6167  to "dataset_imag
-00005fc0: 6572 7922 2e0d 0a20 2020 2020 2020 202d  ery"...        -
-00005fd0: 2074 7261 696e 6564 5f6d 6f64 656c 2028   trained_model (
-00005fe0: 7374 722c 206f 7074 696f 6e61 6c29 3a20  str, optional): 
-00005ff0: 5061 7468 2074 6f20 7468 6520 7472 6169  Path to the trai
-00006000: 6e65 6420 6d6f 6465 6c20 6669 6c65 2e20  ned model file. 
-00006010: 4465 6661 756c 7473 2074 6f20 2266 6f67  Defaults to "fog
-00006020: 6779 5f6e 6f74 5f66 6f67 6779 2e6d 6f64  gy_not_foggy.mod
-00006030: 656c 222e 0d0a 0d0a 2020 2020 0d0a 0d0a  el".....    ....
-00006040: 2020 2020 5265 7475 726e 733a 0d0a 2020      Returns:..  
-00006050: 2020 2d2d 2d2d 2d2d 2d2d 0d0a 2020 2020    --------..    
-00006060: 2020 2020 2d20 5468 6520 6675 6e63 7469      - The functi
-00006070: 6f6e 2061 7373 756d 6573 2074 6861 7420  on assumes that 
-00006080: 7468 6520 696e 7075 7420 6469 7265 6374  the input direct
-00006090: 6f72 7920 636f 6e74 6169 6e73 2069 6d61  ory contains ima
-000060a0: 6765 2066 696c 6573 2069 6e20 4a50 4720  ge files in JPG 
-000060b0: 666f 726d 6174 2e0d 0a20 2020 2020 2020  format...       
-000060c0: 202d 2054 6865 2066 756e 6374 696f 6e20   - The function 
-000060d0: 7573 6573 2061 2074 7261 696e 6564 2063  uses a trained c
-000060e0: 6f6e 766f 6c75 7469 6f6e 616c 206e 6575  onvolutional neu
-000060f0: 7261 6c20 6e65 7477 6f72 6b20 6d6f 6465  ral network mode
-00006100: 6c20 746f 2063 6c61 7373 6966 7920 7468  l to classify th
-00006110: 6520 696d 6167 6573 2e0d 0a20 2020 2020  e images...     
-00006120: 2020 202d 2049 7420 7361 7665 7320 7468     - It saves th
-00006130: 6520 636c 6173 7369 6669 6564 2069 6d61  e classified ima
-00006140: 6765 7320 696e 746f 2073 6570 6172 6174  ges into separat
-00006150: 6520 6469 7265 6374 6f72 6965 7320 6261  e directories ba
-00006160: 7365 6420 6f6e 2074 6865 6972 2063 6c61  sed on their cla
-00006170: 7373 6966 6963 6174 696f 6e2e 0d0a 0d0a  ssification.....
-00006180: 2020 2020 0d0a 2020 2020 2222 220d 0a20      ..    """.. 
-00006190: 2020 2023 2053 6574 7469 6e67 2072 6571     # Setting req
-000061a0: 7569 7265 6420 6669 6c65 2064 6972 6563  uired file direc
-000061b0: 746f 7269 6573 0d0a 2020 2020 6469 725f  tories..    dir_
-000061c0: 6c69 7374 203d 205b 2766 696c 7465 7265  list = ['filtere
-000061d0: 645f 696d 6167 6573 5f6e 6f46 6f67 272c  d_images_noFog',
-000061e0: 2027 6669 6c74 6572 6564 5f69 6d61 6765   'filtered_image
-000061f0: 735f 466f 6727 2c20 2743 6c65 6172 496d  s_Fog', 'ClearIm
-00006200: 6167 6573 5f64 6169 6c79 275d 0d0a 2020  ages_daily']..  
-00006210: 2020 666f 7220 6469 7265 6374 6f72 7920    for directory 
-00006220: 696e 2064 6972 5f6c 6973 743a 0d0a 2020  in dir_list:..  
-00006230: 2020 2020 2020 6966 206e 6f74 2069 7364        if not isd
-00006240: 6972 2864 6972 6563 746f 7279 293a 0d0a  ir(directory):..
-00006250: 2020 2020 2020 2020 2020 2020 7472 793a              try:
-00006260: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00006270: 2020 6d61 6b65 6469 7273 2864 6972 6563    makedirs(direc
-00006280: 746f 7279 290d 0a20 2020 2020 2020 2020  tory)..         
-00006290: 2020 2065 7863 6570 7420 4f53 4572 726f     except OSErro
-000062a0: 7220 6173 2065 3a0d 0a20 2020 2020 2020  r as e:..       
-000062b0: 2020 2020 2020 2020 2072 6169 7365 204f           raise O
-000062c0: 5345 7272 6f72 2866 2245 7272 6f72 2063  SError(f"Error c
-000062d0: 7265 6174 696e 6720 6469 7265 6374 6f72  reating director
-000062e0: 7920 277b 6469 7265 6374 6f72 797d 273a  y '{directory}':
-000062f0: 207b 657d 2229 0d0a 0d0a 2020 2020 4e6f   {e}")....    No
-00006300: 5f46 6f67 675f 7061 7468 203d 2022 6669  _Fogg_path = "fi
-00006310: 6c74 6572 6564 5f69 6d61 6765 735f 6e6f  ltered_images_no
-00006320: 466f 6722 0d0a 2020 2020 466f 6767 795f  Fog"..    Foggy_
-00006330: 5061 7468 203d 2022 6669 6c74 6572 6564  Path = "filtered
-00006340: 5f69 6d61 6765 735f 466f 6722 0d0a 2020  _images_Fog"..  
-00006350: 2020 6461 696c 7969 6d61 6765 7320 3d20    dailyimages = 
-00006360: 2243 6c65 6172 496d 6167 6573 5f64 6169  "ClearImages_dai
-00006370: 6c79 220d 0a20 2020 206d 7970 6174 6820  ly"..    mypath 
-00006380: 3d20 696e 7075 745f 6469 720d 0a0d 0a20  = input_dir.... 
-00006390: 2020 206f 6e6c 7966 696c 6573 203d 205b     onlyfiles = [
-000063a0: 6620 666f 7220 6620 696e 206c 6973 7464  f for f in listd
-000063b0: 6972 286d 7970 6174 6829 2069 6620 6973  ir(mypath) if is
-000063c0: 6669 6c65 286a 6f69 6e28 6d79 7061 7468  file(join(mypath
-000063d0: 2c20 6629 295d 0d0a 2020 2020 696d 6167  , f))]..    imag
-000063e0: 6573 203d 206e 702e 656d 7074 7928 6c65  es = np.empty(le
-000063f0: 6e28 6f6e 6c79 6669 6c65 7329 2c20 6474  n(onlyfiles), dt
-00006400: 7970 653d 6f62 6a65 6374 290d 0a0d 0a20  ype=object).... 
-00006410: 2020 2023 204c 6f61 6420 7468 6520 7472     # Load the tr
-00006420: 6169 6e65 6420 636f 6e76 6f6c 7574 696f  ained convolutio
-00006430: 6e61 6c20 6e65 7572 616c 206e 6574 776f  nal neural netwo
-00006440: 726b 206f 7574 7369 6465 206f 6620 6c6f  rk outside of lo
-00006450: 6f70 0d0a 2020 2020 6d6f 6465 6c20 3d20  op..    model = 
-00006460: 6c6f 6164 5f6d 6f64 656c 2874 7261 696e  load_model(train
-00006470: 6564 5f6d 6f64 656c 290d 0a0d 0a20 2020  ed_model)....   
-00006480: 2023 204c 6f6f 7020 7468 726f 7567 6820   # Loop through 
-00006490: 6561 6368 2069 6d61 6765 2061 6e64 2075  each image and u
-000064a0: 7365 2074 7164 6d20 666f 7220 7072 6f67  se tqdm for prog
-000064b0: 7265 7373 2062 6172 0d0a 2020 2020 7062  ress bar..    pb
-000064c0: 6172 203d 2074 7164 6d28 7261 6e67 6528  ar = tqdm(range(
-000064d0: 6c65 6e28 6f6e 6c79 6669 6c65 7329 292c  len(onlyfiles)),
-000064e0: 2062 6172 5f66 6f72 6d61 743d 277b 6c5f   bar_format='{l_
-000064f0: 6261 727d 7b62 6172 7d7c 207b 6e5f 666d  bar}{bar}| {n_fm
-00006500: 747d 2f7b 746f 7461 6c5f 666d 747d 272c  t}/{total_fmt}',
-00006510: 2063 6f6c 6f75 723d 2723 3030 6666 3030   colour='#00ff00
-00006520: 272c 2064 796e 616d 6963 5f6e 636f 6c73  ', dynamic_ncols
-00006530: 3d54 7275 6529 0d0a 0d0a 2020 2020 666f  =True)....    fo
-00006540: 7220 6e20 696e 2070 6261 723a 0d0a 2020  r n in pbar:..  
-00006550: 2020 2020 2020 7062 6172 2e73 6574 5f64        pbar.set_d
-00006560: 6573 6372 6970 7469 6f6e 2866 2250 726f  escription(f"Pro
-00006570: 6365 7373 696e 6720 696d 6167 6520 7b6e  cessing image {n
-00006580: 202b 2031 7d22 290d 0a20 2020 2020 2020   + 1}")..       
-00006590: 2069 6d61 6765 5f70 6174 6820 3d20 6a6f   image_path = jo
-000065a0: 696e 286d 7970 6174 682c 206f 6e6c 7966  in(mypath, onlyf
-000065b0: 696c 6573 5b6e 5d29 0d0a 0d0a 2020 2020  iles[n])....    
-000065c0: 2020 2020 696d 6167 6520 3d20 6376 322e      image = cv2.
-000065d0: 696d 7265 6164 2869 6d61 6765 5f70 6174  imread(image_pat
-000065e0: 6829 0d0a 2020 2020 2020 2020 6f72 6967  h)..        orig
-000065f0: 203d 2069 6d61 6765 2e63 6f70 7928 290d   = image.copy().
-00006600: 0a0d 0a20 2020 2020 2020 2023 2050 7265  ...        # Pre
-00006610: 2d70 726f 6365 7373 2074 6865 2069 6d61  -process the ima
-00006620: 6765 2066 6f72 2063 6c61 7373 6966 6963  ge for classific
-00006630: 6174 696f 6e0d 0a20 2020 2020 2020 2069  ation..        i
-00006640: 6d61 6765 203d 2063 7632 2e72 6573 697a  mage = cv2.resiz
-00006650: 6528 696d 6167 652c 2028 3238 2c20 3238  e(image, (28, 28
-00006660: 2929 0d0a 2020 2020 2020 2020 696d 6167  ))..        imag
-00006670: 6520 3d20 696d 675f 746f 5f61 7272 6179  e = img_to_array
-00006680: 2869 6d61 6765 290d 0a20 2020 2020 2020  (image)..       
-00006690: 2069 6d61 6765 203d 206e 702e 6578 7061   image = np.expa
-000066a0: 6e64 5f64 696d 7328 696d 6167 652c 2061  nd_dims(image, a
-000066b0: 7869 733d 3029 0d0a 2020 2020 2020 2020  xis=0)..        
-000066c0: 696d 6167 6520 3d20 696d 6167 652e 6173  image = image.as
-000066d0: 7479 7065 2822 666c 6f61 7422 2920 2f20  type("float") / 
-000066e0: 3235 352e 300d 0a0d 0a20 2020 2020 2020  255.0....       
-000066f0: 2023 2043 6c61 7373 6966 7920 7468 6520   # Classify the 
-00006700: 696e 7075 7420 696d 6167 650d 0a20 2020  input image..   
-00006710: 2020 2020 2028 6e6f 745f 666f 6767 792c       (not_foggy,
-00006720: 2066 6f67 6779 2920 3d20 6d6f 6465 6c2e   foggy) = model.
-00006730: 7072 6564 6963 7428 696d 6167 6529 5b30  predict(image)[0
-00006740: 5d0d 0a20 2020 2020 2020 206c 6162 656c  ]..        label
-00006750: 203d 2022 4e6f 7446 6f67 6779 2220 6966   = "NotFoggy" if
-00006760: 206e 6f74 5f66 6f67 6779 203e 2066 6f67   not_foggy > fog
-00006770: 6779 2065 6c73 6520 2246 6f67 6779 220d  gy else "Foggy".
-00006780: 0a20 2020 2020 2020 2070 726f 6261 203d  .        proba =
-00006790: 206e 6f74 5f66 6f67 6779 2069 6620 6e6f   not_foggy if no
-000067a0: 745f 666f 6767 7920 3e20 666f 6767 7920  t_foggy > foggy 
-000067b0: 656c 7365 2066 6f67 6779 0d0a 2020 2020  else foggy..    
-000067c0: 2020 2020 6c61 6265 6c20 3d20 6622 7b6c      label = f"{l
-000067d0: 6162 656c 7d3a 207b 7072 6f62 6120 2a20  abel}: {proba * 
-000067e0: 3130 303a 2e32 667d 2522 0d0a 0d0a 2020  100:.2f}%"....  
-000067f0: 2020 2020 2020 6376 322e 7075 7454 6578        cv2.putTex
-00006800: 7428 6f72 6967 2c20 6c61 6265 6c2c 2028  t(orig, label, (
-00006810: 3430 2c20 3130 3029 2c20 6376 322e 464f  40, 100), cv2.FO
-00006820: 4e54 5f48 4552 5348 4559 5f53 494d 504c  NT_HERSHEY_SIMPL
-00006830: 4558 2c20 302e 372c 2028 302c 2032 3535  EX, 0.7, (0, 255
-00006840: 2c20 3029 2c20 3229 0d0a 2020 2020 2020  , 0), 2)..      
-00006850: 2020 696d 203d 2049 6d61 6765 2e66 726f    im = Image.fro
-00006860: 6d61 7272 6179 286f 7269 6729 0d0a 0d0a  marray(orig)....
-00006870: 2020 2020 2020 2020 6669 6c65 203d 2073          file = s
-00006880: 7472 286f 6e6c 7966 696c 6573 5b6e 5d29  tr(onlyfiles[n])
-00006890: 0d0a 2020 2020 2020 2020 706f 7369 7469  ..        positi
-000068a0: 6f6e 203d 2066 696c 652e 696e 6465 7828  on = file.index(
-000068b0: 222e 6a70 6722 290d 0a20 2020 2020 2020  ".jpg")..       
-000068c0: 2066 696c 656e 616d 6520 3d20 6669 6c65   filename = file
-000068d0: 5b3a 706f 7369 7469 6f6e 5d0d 0a0d 0a20  [:position].... 
-000068e0: 2020 2020 2020 2069 6620 7072 6f62 6120         if proba 
-000068f0: 3e20 302e 3935 2061 6e64 206e 6f74 5f66  > 0.95 and not_f
-00006900: 6f67 6779 203e 2066 6f67 6779 3a0d 0a20  oggy > foggy:.. 
-00006910: 2020 2020 2020 2020 2020 206c 6162 656c             label
-00006920: 203d 2022 4e6f 7420 466f 6767 7922 0d0a   = "Not Foggy"..
-00006930: 2020 2020 2020 2020 2020 2020 696d 2e73              im.s
-00006940: 6176 6528 6a6f 696e 284e 6f5f 466f 6767  ave(join(No_Fogg
-00006950: 5f70 6174 682c 2066 227b 7072 6f62 617d  _path, f"{proba}
-00006960: 2d7b 6669 6c65 6e61 6d65 7d2e 6a70 6722  -{filename}.jpg"
-00006970: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
-00006980: 696d 2e73 6176 6528 6a6f 696e 2864 6169  im.save(join(dai
-00006990: 6c79 696d 6167 6573 2c20 6622 7b66 696c  lyimages, f"{fil
-000069a0: 656e 616d 657d 2e6a 7067 2229 290d 0a20  ename}.jpg")).. 
-000069b0: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
-000069c0: 2020 2020 2020 2020 2020 6c61 6265 6c20            label 
-000069d0: 3d20 2246 6f67 6779 220d 0a20 2020 2020  = "Foggy"..     
-000069e0: 2020 2020 2020 2069 6d2e 7361 7665 286a         im.save(j
-000069f0: 6f69 6e28 466f 6767 795f 5061 7468 2c20  oin(Foggy_Path, 
-00006a00: 6622 7b70 726f 6261 7d2d 7b66 696c 656e  f"{proba}-{filen
-00006a10: 616d 657d 2e6a 7067 2229 290d 0a0d 0a20  ame}.jpg")).... 
-00006a20: 2020 2070 7269 6e74 2822 5c6e 4e6f 206d     print("\nNo m
-00006a30: 6f72 6520 6669 6c65 7320 6c65 6674 2074  ore files left t
-00006a40: 6f20 7072 6f63 6573 7322 2920 2023 2050  o process")  # P
-00006a50: 7269 6e74 2066 696e 616c 206d 6573 7361  rint final messa
-00006a60: 6765 206f 6e20 6120 6e65 7720 6c69 6e65  ge on a new line
-00006a70: 0d0a 0d0a 0d0a 696d 706f 7274 206d 6174  ......import mat
-00006a80: 706c 6f74 6c69 622e 7079 706c 6f74 2061  plotlib.pyplot a
-00006a90: 7320 706c 740d 0a69 6d70 6f72 7420 6e75  s plt..import nu
-00006aa0: 6d70 7920 6173 206e 700d 0a69 6d70 6f72  mpy as np..impor
-00006ab0: 7420 7261 7374 6572 696f 0d0a 6672 6f6d  t rasterio..from
-00006ac0: 2072 6173 7465 7269 6f2e 7472 616e 7366   rasterio.transf
-00006ad0: 6f72 6d20 696d 706f 7274 2041 6666 696e  orm import Affin
-00006ae0: 650d 0a0d 0a0d 0a64 6566 2063 616c 6375  e......def calcu
-00006af0: 6c61 7465 5f76 6f6c 756d 6528 656c 6576  late_volume(elev
-00006b00: 6174 696f 6e5f 6d61 702c 2073 6c6f 7065  ation_map, slope
-00006b10: 5f6d 6170 2c20 6365 6c6c 5f73 697a 652c  _map, cell_size,
-00006b20: 206f 7574 7075 745f 6669 6c65 2c20 706c   output_file, pl
-00006b30: 6f74 5f6d 6170 3d46 616c 7365 2c20 706c  ot_map=False, pl
-00006b40: 6f74 5f66 696c 653d 4e6f 6e65 293a 0d0a  ot_file=None):..
-00006b50: 2020 2020 2222 220d 0a20 2020 2043 616c      """..    Cal
-00006b60: 6375 6c61 7465 2074 6865 2076 6f6c 756d  culate the volum
-00006b70: 6520 6261 7365 6420 6f6e 2061 6e20 656c  e based on an el
-00006b80: 6576 6174 696f 6e20 6d61 7020 616e 6420  evation map and 
-00006b90: 6120 736c 6f70 6520 6d61 702c 0d0a 2020  a slope map,..  
-00006ba0: 2020 616e 6420 7361 7665 2074 6865 2076    and save the v
-00006bb0: 6f6c 756d 6520 6d61 7020 6173 2061 2047  olume map as a G
-00006bc0: 656f 5449 4646 2066 696c 652e 204f 7074  eoTIFF file. Opt
-00006bd0: 696f 6e61 6c6c 792c 2070 6c6f 7420 7468  ionally, plot th
-00006be0: 6520 766f 6c75 6d65 206d 6170 2061 7320  e volume map as 
-00006bf0: 6120 6669 6775 7265 2061 6e64 2073 6176  a figure and sav
-00006c00: 6520 6974 2e0d 0a0d 0a20 2020 2041 7267  e it.....    Arg
-00006c10: 733a 0d0a 2020 2020 2020 2020 656c 6576  s:..        elev
-00006c20: 6174 696f 6e5f 6d61 7020 2873 7472 293a  ation_map (str):
-00006c30: 2046 696c 6520 7061 7468 2074 6f20 7468   File path to th
-00006c40: 6520 656c 6576 6174 696f 6e20 6d61 7020  e elevation map 
-00006c50: 7261 7374 6572 2e0d 0a20 2020 2020 2020  raster...       
-00006c60: 2073 6c6f 7065 5f6d 6170 2028 6e64 6172   slope_map (ndar
-00006c70: 7261 7929 3a20 3244 2061 7272 6179 2072  ray): 2D array r
-00006c80: 6570 7265 7365 6e74 696e 6720 7468 6520  epresenting the 
-00006c90: 736c 6f70 6520 7661 6c75 6573 2e0d 0a20  slope values... 
-00006ca0: 2020 2020 2020 2063 656c 6c5f 7369 7a65         cell_size
-00006cb0: 2028 666c 6f61 7429 3a20 5369 7a65 206f   (float): Size o
-00006cc0: 6620 6561 6368 2063 656c 6c20 696e 2074  f each cell in t
-00006cd0: 6865 206d 6170 2028 652e 672e 2c20 6c65  he map (e.g., le
-00006ce0: 6e67 7468 206f 6620 6f6e 6520 7369 6465  ngth of one side
-00006cf0: 206f 6620 6120 7371 7561 7265 2063 656c   of a square cel
-00006d00: 6c29 2e0d 0a20 2020 2020 2020 206f 7574  l)...        out
-00006d10: 7075 745f 6669 6c65 2028 7374 7229 3a20  put_file (str): 
-00006d20: 4f75 7470 7574 2066 696c 6520 7061 7468  Output file path
-00006d30: 2066 6f72 2073 6176 696e 6720 7468 6520   for saving the 
-00006d40: 766f 6c75 6d65 206d 6170 2061 7320 6120  volume map as a 
-00006d50: 4765 6f54 4946 462e 0d0a 2020 2020 2020  GeoTIFF...      
-00006d60: 2020 706c 6f74 5f6d 6170 2028 626f 6f6c    plot_map (bool
-00006d70: 2c20 6f70 7469 6f6e 616c 293a 2057 6865  , optional): Whe
-00006d80: 7468 6572 2074 6f20 706c 6f74 2074 6865  ther to plot the
-00006d90: 2076 6f6c 756d 6520 6d61 7020 6173 2061   volume map as a
-00006da0: 2066 6967 7572 652e 2044 6566 6175 6c74   figure. Default
-00006db0: 2069 7320 4661 6c73 652e 0d0a 2020 2020   is False...    
-00006dc0: 2020 2020 706c 6f74 5f66 696c 6520 2873      plot_file (s
-00006dd0: 7472 2c20 6f70 7469 6f6e 616c 293a 204f  tr, optional): O
-00006de0: 7574 7075 7420 6669 6c65 2070 6174 6820  utput file path 
-00006df0: 666f 7220 7361 7669 6e67 2074 6865 2076  for saving the v
-00006e00: 6f6c 756d 6520 6d61 7020 706c 6f74 2e20  olume map plot. 
-00006e10: 5265 7175 6972 6564 2069 6620 706c 6f74  Required if plot
-00006e20: 5f6d 6170 2069 7320 5472 7565 2e0d 0a0d  _map is True....
-00006e30: 0a20 2020 2052 6574 7572 6e73 3a0d 0a20  .    Returns:.. 
-00006e40: 2020 2020 2020 206e 6461 7272 6179 3a20         ndarray: 
-00006e50: 5468 6520 6361 6c63 756c 6174 6564 2076  The calculated v
-00006e60: 6f6c 756d 6520 6d61 702e 0d0a 0d0a 2020  olume map.....  
-00006e70: 2020 2222 220d 0a20 2020 2023 2052 6561    """..    # Rea
-00006e80: 6420 656c 6576 6174 696f 6e20 6d61 7020  d elevation map 
-00006e90: 7261 7374 6572 2075 7369 6e67 2072 6173  raster using ras
-00006ea0: 7465 7269 6f0d 0a20 2020 2073 7263 3d20  terio..    src= 
-00006eb0: 7261 7374 6572 696f 2e6f 7065 6e28 656c  rasterio.open(el
-00006ec0: 6576 6174 696f 6e5f 6d61 7029 0d0a 2020  evation_map)..  
-00006ed0: 2020 2320 4765 7420 4352 5320 6672 6f6d    # Get CRS from
-00006ee0: 2065 6c65 7661 7469 6f6e 5f6d 6170 0d0a   elevation_map..
-00006ef0: 2020 2020 6372 7320 3d20 7372 632e 6372      crs = src.cr
-00006f00: 730d 0a0d 0a20 2020 2023 2047 6574 2074  s....    # Get t
-00006f10: 7261 6e73 666f 726d 2066 726f 6d20 656c  ransform from el
-00006f20: 6576 6174 696f 6e5f 6d61 700d 0a20 2020  evation_map..   
-00006f30: 2074 7261 6e73 666f 726d 203d 2073 7263   transform = src
-00006f40: 2e74 7261 6e73 666f 726d 0d0a 0d0a 2020  .transform....  
-00006f50: 2020 2023 2052 6561 6420 656c 6576 6174     # Read elevat
-00006f60: 696f 6e20 6d61 7020 6461 7461 0d0a 2020  ion map data..  
-00006f70: 2020 656c 6576 6174 696f 6e5f 6461 7461    elevation_data
-00006f80: 203d 2073 7263 2e72 6561 6428 3129 0d0a   = src.read(1)..
-00006f90: 0d0a 2020 2020 2023 2052 6561 6420 656c  ..     # Read el
-00006fa0: 6576 6174 696f 6e20 6d61 7020 7261 7374  evation map rast
-00006fb0: 6572 2075 7369 6e67 2072 6173 7465 7269  er using rasteri
-00006fc0: 6f0d 0a20 2020 2073 7263 313d 2072 6173  o..    src1= ras
-00006fd0: 7465 7269 6f2e 6f70 656e 2873 6c6f 7065  terio.open(slope
-00006fe0: 5f6d 6170 290d 0a20 2020 2020 2020 200d  _map)..        .
-00006ff0: 0a20 2020 2020 2320 5265 6164 2073 6c6f  .     # Read slo
-00007000: 7065 5f6d 6170 2064 6174 610d 0a20 2020  pe_map data..   
-00007010: 2073 6c6f 7065 5f64 6174 6120 3d20 7372   slope_data = sr
-00007020: 632e 7265 6164 2831 290d 0a0d 0a20 2020  c.read(1)....   
-00007030: 2023 2043 616c 6375 6c61 7465 2074 6865   # Calculate the
-00007040: 2064 696d 656e 7369 6f6e 7320 6f66 2074   dimensions of t
-00007050: 6865 206d 6170 730d 0a20 2020 2072 6f77  he maps..    row
-00007060: 732c 2063 6f6c 7320 3d20 656c 6576 6174  s, cols = elevat
-00007070: 696f 6e5f 6461 7461 2e73 6861 7065 0d0a  ion_data.shape..
-00007080: 0d0a 2020 2020 2320 496e 6974 6961 6c69  ..    # Initiali
-00007090: 7a65 2074 6865 2076 6f6c 756d 6520 6d61  ze the volume ma
-000070a0: 700d 0a20 2020 2076 6f6c 756d 655f 6d61  p..    volume_ma
-000070b0: 7020 3d20 6e70 2e7a 6572 6f73 5f6c 696b  p = np.zeros_lik
-000070c0: 6528 656c 6576 6174 696f 6e5f 6461 7461  e(elevation_data
-000070d0: 2c20 6474 7970 653d 666c 6f61 7429 0d0a  , dtype=float)..
-000070e0: 0d0a 2020 2020 2320 4974 6572 6174 6520  ..    # Iterate 
-000070f0: 6f76 6572 2065 6163 6820 6365 6c6c 2069  over each cell i
-00007100: 6e20 7468 6520 6d61 7073 0d0a 2020 2020  n the maps..    
-00007110: 666f 7220 6920 696e 2072 616e 6765 2872  for i in range(r
-00007120: 6f77 7329 3a0d 0a20 2020 2020 2020 2066  ows):..        f
-00007130: 6f72 206a 2069 6e20 7261 6e67 6528 636f  or j in range(co
-00007140: 6c73 293a 0d0a 2020 2020 2020 2020 2020  ls):..          
-00007150: 2020 2320 4361 6c63 756c 6174 6520 7468    # Calculate th
-00007160: 6520 6365 6c6c 2061 7265 610d 0a20 2020  e cell area..   
-00007170: 2020 2020 2020 2020 2061 7265 6120 3d20           area = 
-00007180: 6365 6c6c 5f73 697a 6520 2a2a 2032 0d0a  cell_size ** 2..
-00007190: 0d0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-000071a0: 4361 6c63 756c 6174 6520 7468 6520 6365  Calculate the ce
-000071b0: 6c6c 2076 6f6c 756d 6520 636f 6e74 7269  ll volume contri
-000071c0: 6275 7469 6f6e 0d0a 2020 2020 2020 2020  bution..        
-000071d0: 2020 2020 766f 6c75 6d65 5f6d 6170 5b69      volume_map[i
-000071e0: 2c20 6a5d 202b 3d20 656c 6576 6174 696f  , j] += elevatio
-000071f0: 6e5f 6461 7461 5b69 2c20 6a5d 202a 2061  n_data[i, j] * a
-00007200: 7265 610d 0a0d 0a20 2020 2020 2020 2020  rea....         
-00007210: 2020 2023 2043 616c 6375 6c61 7465 2074     # Calculate t
-00007220: 6865 2073 6c6f 7065 2067 7261 6469 656e  he slope gradien
-00007230: 740d 0a20 2020 2020 2020 2020 2020 2073  t..            s
-00007240: 6c6f 7065 5f67 7261 6469 656e 7420 3d20  lope_gradient = 
-00007250: 6e70 2e74 616e 286e 702e 7261 6469 616e  np.tan(np.radian
-00007260: 7328 736c 6f70 655f 6461 7461 5b69 2c20  s(slope_data[i, 
-00007270: 6a5d 2929 0d0a 0d0a 2020 2020 2020 2020  j]))....        
-00007280: 2020 2020 2320 4361 6c63 756c 6174 6520      # Calculate 
-00007290: 7468 6520 6164 6469 7469 6f6e 616c 2076  the additional v
-000072a0: 6f6c 756d 6520 6475 6520 746f 2074 6865  olume due to the
-000072b0: 2073 6c6f 7065 0d0a 2020 2020 2020 2020   slope..        
-000072c0: 2020 2020 766f 6c75 6d65 5f6d 6170 5b69      volume_map[i
-000072d0: 2c20 6a5d 202b 3d20 302e 3520 2a20 736c  , j] += 0.5 * sl
-000072e0: 6f70 655f 6772 6164 6965 6e74 202a 2061  ope_gradient * a
-000072f0: 7265 610d 0a0d 0a20 2020 2023 2053 6176  rea....    # Sav
-00007300: 6520 766f 6c75 6d65 206d 6170 2061 7320  e volume map as 
-00007310: 4765 6f54 4946 460d 0a20 2020 2077 6974  GeoTIFF..    wit
-00007320: 6820 7261 7374 6572 696f 2e6f 7065 6e28  h rasterio.open(
-00007330: 6f75 7470 7574 5f66 696c 652c 2022 7722  output_file, "w"
-00007340: 2c20 6472 6976 6572 3d22 4754 6966 6622  , driver="GTiff"
-00007350: 2c20 6865 6967 6874 3d76 6f6c 756d 655f  , height=volume_
-00007360: 6d61 702e 7368 6170 655b 305d 2c20 7769  map.shape[0], wi
-00007370: 6474 683d 766f 6c75 6d65 5f6d 6170 2e73  dth=volume_map.s
-00007380: 6861 7065 5b31 5d2c 2063 6f75 6e74 3d31  hape[1], count=1
-00007390: 2c20 6474 7970 653d 766f 6c75 6d65 5f6d  , dtype=volume_m
-000073a0: 6170 2e64 7479 7065 2c20 6372 733d 6372  ap.dtype, crs=cr
-000073b0: 732c 2074 7261 6e73 666f 726d 3d74 7261  s, transform=tra
-000073c0: 6e73 666f 726d 2920 6173 2064 7374 3a0d  nsform) as dst:.
-000073d0: 0a20 2020 2020 2020 2064 7374 2e77 7269  .        dst.wri
-000073e0: 7465 2876 6f6c 756d 655f 6d61 702c 2031  te(volume_map, 1
-000073f0: 290d 0a0d 0a20 2020 2023 2050 6c6f 7420  )....    # Plot 
-00007400: 616e 6420 7361 7665 2076 6f6c 756d 6520  and save volume 
-00007410: 6d61 7020 6966 2064 6573 6972 6564 0d0a  map if desired..
-00007420: 2020 2020 6966 2070 6c6f 745f 6d61 703a      if plot_map:
-00007430: 0d0a 2020 2020 2020 2020 706c 742e 696d  ..        plt.im
-00007440: 7368 6f77 2876 6f6c 756d 655f 6d61 702c  show(volume_map,
-00007450: 2063 6d61 703d 2776 6972 6964 6973 2729   cmap='viridis')
-00007460: 0d0a 2020 2020 2020 2020 706c 742e 636f  ..        plt.co
-00007470: 6c6f 7262 6172 286c 6162 656c 3d27 566f  lorbar(label='Vo
-00007480: 6c75 6d65 2729 0d0a 2020 2020 2020 2020  lume')..        
-00007490: 706c 742e 7469 746c 6528 2756 6f6c 756d  plt.title('Volum
-000074a0: 6520 4d61 7027 290d 0a20 2020 2020 2020  e Map')..       
-000074b0: 2070 6c74 2e78 6c61 6265 6c28 2743 6f6c   plt.xlabel('Col
-000074c0: 756d 6e27 290d 0a20 2020 2020 2020 2070  umn')..        p
-000074d0: 6c74 2e79 6c61 6265 6c28 2752 6f77 2729  lt.ylabel('Row')
-000074e0: 0d0a 2020 2020 2020 2020 706c 742e 7469  ..        plt.ti
-000074f0: 6768 745f 6c61 796f 7574 2829 0d0a 2020  ght_layout()..  
-00007500: 2020 2020 2020 706c 742e 7361 7665 6669        plt.savefi
-00007510: 6728 706c 6f74 5f66 696c 6529 0d0a 2020  g(plot_file)..  
-00007520: 2020 2020 2020 706c 742e 7368 6f77 2829        plt.show()
-00007530: 0d0a 0d0a 2020 2020 7265 7475 726e 2076  ....    return v
-00007540: 6f6c 756d 655f 6d61 700d 0a0d 0a0d 0a0d  olume_map.......
-00007550: 0a0d 0a23 2064 6566 2074 735f 706c 6f74  ...# def ts_plot
-00007560: 2864 662c 2070 6c6f 745f 6e75 6d62 6572  (df, plot_number
-00007570: 2c20 7361 7665 5f70 6c6f 743d 4661 6c73  , save_plot=Fals
-00007580: 6520 2c20 6f75 7470 7574 5f64 6972 3d22  e , output_dir="
-00007590: 222c 2070 6c6f 745f 6669 6c65 6e61 6d65  ", plot_filename
-000075a0: 3d22 2220 2c20 5645 4c5f 5363 616c 653d  ="" , VEL_Scale=
-000075b0: 2779 6561 7227 293a 0d0a 0d0a 0d0a 2320  'year'):......# 
-000075c0: 2020 2020 696d 706f 7274 2070 6c6f 746c      import plotl
-000075d0: 792e 6772 6170 685f 6f62 6a65 6374 7320  y.graph_objects 
-000075e0: 6173 2067 6f0d 0a23 2020 2020 2069 6d70  as go..#     imp
-000075f0: 6f72 7420 706c 6f74 6c79 2e65 7870 7265  ort plotly.expre
-00007600: 7373 2061 7320 7078 0d0a 2320 2020 2020  ss as px..#     
-00007610: 696d 706f 7274 2070 6c6f 746c 792e 6578  import plotly.ex
-00007620: 7072 6573 7320 6173 2070 785f 7465 6d70  press as px_temp
-00007630: 0d0a 2320 2020 2020 696d 706f 7274 2070  ..#     import p
-00007640: 616e 6461 7320 6173 2070 640d 0a23 2020  andas as pd..#  
-00007650: 2020 2069 6d70 6f72 7420 6e75 6d70 7920     import numpy 
-00007660: 6173 206e 700d 0a23 2020 2020 2069 6d70  as np..#     imp
-00007670: 6f72 7420 6d61 7470 6c6f 746c 6962 2e70  ort matplotlib.p
-00007680: 7970 6c6f 7420 6173 2070 6c74 0d0a 2320  yplot as plt..# 
-00007690: 2020 2020 696d 706f 7274 2067 656f 7061      import geopa
-000076a0: 6e64 6173 2061 7320 6770 6420 0d0a 2320  ndas as gpd ..# 
-000076b0: 2020 2020 696d 706f 7274 2070 616e 6461      import panda
-000076c0: 7320 6173 2070 6420 200d 0a23 2020 2020  s as pd  ..#    
-000076d0: 2069 6d70 6f72 7420 7365 6162 6f72 6e20   import seaborn 
-000076e0: 6173 2073 6e73 2020 0d0a 2320 2020 2020  as sns  ..#     
-000076f0: 696d 706f 7274 2070 6c6f 746c 792e 6f66  import plotly.of
-00007700: 666c 696e 6520 6173 2070 795f 6f66 666c  fline as py_offl
-00007710: 696e 650d 0a23 2020 2020 2069 6d70 6f72  ine..#     impor
-00007720: 7420 6f73 2020 200d 0a23 2020 2020 2069  t os   ..#     i
-00007730: 6d70 6f72 7420 7374 6174 736d 6f64 656c  mport statsmodel
-00007740: 732e 6170 6920 6173 2073 6d0d 0a23 2020  s.api as sm..#  
-00007750: 2020 2066 726f 6d20 736b 6c65 6172 6e2e     from sklearn.
-00007760: 6d65 7472 6963 7320 696d 706f 7274 206d  metrics import m
-00007770: 6561 6e5f 7371 7561 7265 645f 6572 726f  ean_squared_erro
-00007780: 722c 2072 325f 7363 6f72 650d 0a23 2020  r, r2_score..#  
-00007790: 2020 2069 6d70 6f72 7420 6e75 6d70 7920     import numpy 
-000077a0: 6173 206e 700d 0a23 2020 2020 2066 726f  as np..#     fro
-000077b0: 6d20 736b 6c65 6172 6e2e 6c69 6e65 6172  m sklearn.linear
-000077c0: 5f6d 6f64 656c 2069 6d70 6f72 7420 4c69  _model import Li
-000077d0: 6e65 6172 5265 6772 6573 7369 6f6e 0d0a  nearRegression..
-000077e0: 2320 2020 2020 6672 6f6d 2064 6174 6574  #     from datet
-000077f0: 696d 6520 696d 706f 7274 2064 6174 6574  ime import datet
-00007800: 696d 650d 0a23 2020 2020 2069 6d70 6f72  ime..#     impor
-00007810: 7420 6d61 7468 0d0a 2020 2020 0d0a 2320  t math..    ..# 
-00007820: 2020 2020 7079 5f6f 6666 6c69 6e65 2e69      py_offline.i
-00007830: 6e69 745f 6e6f 7465 626f 6f6b 5f6d 6f64  nit_notebook_mod
-00007840: 6528 290d 0a23 2020 2020 2023 256d 6174  e()..#     #%mat
-00007850: 706c 6f74 6c69 6220 7769 6467 6574 0d0a  plotlib widget..
-00007860: 2320 2020 2020 2364 663d 7064 2e72 6561  #     #df=pd.rea
-00007870: 645f 6373 7628 2274 656d 702e 6373 7622  d_csv("temp.csv"
-00007880: 290d 0a23 2020 2020 2064 662e 7265 6e61  )..#     df.rena
-00007890: 6d65 2863 6f6c 756d 6e73 3d7b 2064 662e  me(columns={ df.
-000078a0: 636f 6c75 6d6e 735b 305d 3a20 2264 6422  columns[0]: "dd"
-000078b0: 207d 2c20 696e 706c 6163 6520 3d20 5472   }, inplace = Tr
-000078c0: 7565 290d 0a23 2020 2020 2064 665b 2764  ue)..#     df['d
-000078d0: 645f 7374 7227 5d3d 6466 5b27 6464 275d  d_str']=df['dd']
-000078e0: 2e61 7374 7970 6528 7374 7229 0d0a 2320  .astype(str)..# 
-000078f0: 2020 2020 6466 5b27 6464 5f73 7472 275d      df['dd_str']
-00007900: 203d 2064 665b 2764 645f 7374 7227 5d2e   = df['dd_str'].
-00007910: 6173 7479 7065 2873 7472 290d 0a23 2020  astype(str)..#  
-00007920: 2020 2064 662e 7265 6e61 6d65 2863 6f6c     df.rename(col
-00007930: 756d 6e73 3d7b 2064 662e 636f 6c75 6d6e  umns={ df.column
-00007940: 735b 315d 3a20 2276 616c 2220 7d2c 2069  s[1]: "val" }, i
-00007950: 6e70 6c61 6365 203d 2054 7275 6529 0d0a  nplace = True)..
-00007960: 2320 2020 2020 6466 5b27 6464 275d 3d20  #     df['dd']= 
-00007970: 7064 2e74 6f5f 6461 7465 7469 6d65 2864  pd.to_datetime(d
-00007980: 665b 2764 6427 5d2e 6173 7479 7065 2873  f['dd'].astype(s
-00007990: 7472 292c 2066 6f72 6d61 743d 2725 5925  tr), format='%Y%
-000079a0: 6d25 6427 290d 0a20 2020 200d 0a23 2020  m%d')..    ..#  
-000079b0: 2020 2064 663d 6466 2e73 6574 5f69 6e64     df=df.set_ind
-000079c0: 6578 2827 6464 2729 0d0a 2020 2020 0d0a  ex('dd')..    ..
-000079d0: 2320 2020 2020 2323 2323 2323 2323 2323  #     ##########
-000079e0: 2323 2323 2323 2323 2323 2323 2323 0d0a  ##############..
-000079f0: 2320 2020 2020 6466 3d64 662e 6472 6f70  #     df=df.drop
-00007a00: 6e61 2829 0d0a 2320 2020 2020 2320 4d61  na()..#     # Ma
-00007a10: 6b65 2069 6e64 6578 2070 642e 4461 7465  ke index pd.Date
-00007a20: 7469 6d65 496e 6465 780d 0a23 2020 2020  timeIndex..#    
-00007a30: 2064 662e 696e 6465 7820 3d20 7064 2e44   df.index = pd.D
-00007a40: 6174 6574 696d 6549 6e64 6578 2864 662e  atetimeIndex(df.
-00007a50: 696e 6465 7829 0d0a 2320 2020 2020 2320  index)..#     # 
-00007a60: 4d61 6b65 206e 6577 2069 6e64 6578 0d0a  Make new index..
-00007a70: 2320 2020 2020 6964 7820 3d20 7064 2e64  #     idx = pd.d
-00007a80: 6174 655f 7261 6e67 6528 6466 2e69 6e64  ate_range(df.ind
-00007a90: 6578 2e6d 696e 2829 2c20 6466 2e69 6e64  ex.min(), df.ind
-00007aa0: 6578 2e6d 6178 2829 290d 0a23 2020 2020  ex.max())..#    
-00007ab0: 2023 2052 6570 6c61 6365 206f 7269 6769   # Replace origi
-00007ac0: 6e61 6c20 696e 6465 7820 7769 7468 2069  nal index with i
-00007ad0: 6478 0d0a 2320 2020 2020 6466 203d 2064  dx..#     df = d
-00007ae0: 662e 7265 696e 6465 7828 696e 6465 7820  f.reindex(index 
-00007af0: 3d20 6964 7829 0d0a 2320 2020 2020 2320  = idx)..#     # 
-00007b00: 496e 7365 7274 2072 6f77 2063 6f75 6e74  Insert row count
-00007b10: 0d0a 2320 2020 2020 6466 2e69 6e73 6572  ..#     df.inser
-00007b20: 7428 6466 2e73 6861 7065 5b31 5d2c 0d0a  t(df.shape[1],..
-00007b30: 2320 2020 2020 2020 2020 2020 2020 2772  #             'r
-00007b40: 6f77 5f63 6f75 6e74 272c 0d0a 2320 2020  ow_count',..#   
-00007b50: 2020 2020 2020 2020 2020 6466 2e69 6e64            df.ind
-00007b60: 6578 2e76 616c 7565 5f63 6f75 6e74 7328  ex.value_counts(
-00007b70: 292e 736f 7274 5f69 6e64 6578 2829 2e63  ).sort_index().c
-00007b80: 756d 7375 6d28 2929 0d0a 0d0a 2320 2020  umsum())....#   
-00007b90: 2020 6466 3d64 662e 6472 6f70 6e61 2829    df=df.dropna()
-00007ba0: 0d0a 2020 2020 0d0a 2320 2020 2020 2364  ..    ..#     #d
-00007bb0: 663d 6466 2e73 6574 5f69 6e64 6578 2864  f=df.set_index(d
-00007bc0: 665b 2772 6f77 5f63 6f75 6e74 275d 2c20  f['row_count'], 
-00007bd0: 696e 706c 6163 653d 5472 7565 290d 0a0d  inplace=True)...
-00007be0: 0a23 2020 2020 2064 662e 736f 7274 5f69  .#     df.sort_i
-00007bf0: 6e64 6578 2861 7363 656e 6469 6e67 3d54  ndex(ascending=T
-00007c00: 7275 652c 2069 6e70 6c61 6365 3d54 7275  rue, inplace=Tru
-00007c10: 6529 0d0a 2020 2020 0d0a 0d0a 2320 2020  e)..    ....#   
-00007c20: 2020 6465 6620 6265 7374 5f66 6974 5f73    def best_fit_s
-00007c30: 6c6f 7065 5f61 6e64 5f69 6e74 6572 6365  lope_and_interce
-00007c40: 7074 2878 732c 7973 293a 0d0a 2320 2020  pt(xs,ys):..#   
-00007c50: 2020 2020 2020 6672 6f6d 2073 7461 7469        from stati
-00007c60: 7374 6963 7320 696d 706f 7274 206d 6561  stics import mea
-00007c70: 6e0d 0a23 2020 2020 2020 2020 2078 7320  n..#         xs 
-00007c80: 3d20 6e70 2e61 7272 6179 2878 732c 2064  = np.array(xs, d
-00007c90: 7479 7065 3d6e 702e 666c 6f61 7436 3429  type=np.float64)
-00007ca0: 0d0a 2320 2020 2020 2020 2020 7973 203d  ..#         ys =
-00007cb0: 206e 702e 6172 7261 7928 7973 2c20 6474   np.array(ys, dt
-00007cc0: 7970 653d 6e70 2e66 6c6f 6174 3634 290d  ype=np.float64).
-00007cd0: 0a23 2020 2020 2020 2020 206d 203d 2028  .#         m = (
-00007ce0: 2828 6d65 616e 2878 7329 2a6d 6561 6e28  ((mean(xs)*mean(
-00007cf0: 7973 2929 202d 206d 6561 6e28 7873 2a79  ys)) - mean(xs*y
-00007d00: 7329 2920 2f0d 0a23 2020 2020 2020 2020  s)) /..#        
-00007d10: 2020 2020 2028 286d 6561 6e28 7873 292a       ((mean(xs)*
-00007d20: 6d65 616e 2878 7329 2920 2d20 6d65 616e  mean(xs)) - mean
-00007d30: 2878 732a 7873 2929 290d 0a20 2020 2020  (xs*xs)))..     
-00007d40: 2020 200d 0a23 2020 2020 2020 2020 2062     ..#         b
-00007d50: 203d 206d 6561 6e28 7973 2920 2d20 6d2a   = mean(ys) - m*
-00007d60: 6d65 616e 2878 7329 0d0a 2020 2020 2020  mean(xs)..      
-00007d70: 2020 0d0a 2320 2020 2020 2020 2020 7265    ..#         re
-00007d80: 7475 726e 206d 2c20 620d 0a0d 0a20 2020  turn m, b....   
-00007d90: 200d 0a0d 0a23 2020 2020 2023 636f 6e76   ....#     #conv
-00007da0: 6572 7420 6461 7474 696d 6520 746f 206e  ert dattime to n
-00007db0: 756d 6265 7220 6f66 2064 6179 7320 7065  umber of days pe
-00007dc0: 7220 7965 6172 0d0a 2020 2020 0d0a 2020  r year..    ..  
-00007dd0: 2020 0d0a 2020 2020 0d0a 0d0a 2320 2020    ..    ....#   
-00007de0: 2020 6461 7465 735f 6c69 7374 3d28 5b64    dates_list=([d
-00007df0: 6174 6574 696d 652e 7374 7270 7469 6d65  atetime.strptime
-00007e00: 2878 2c20 2725 5925 6d25 6427 2920 666f  (x, '%Y%m%d') fo
-00007e10: 7220 7820 696e 2064 662e 6464 5f73 7472  r x in df.dd_str
-00007e20: 5d29 0d0a 2320 2020 2020 6461 7973 5f6e  ])..#     days_n
-00007e30: 756d 3d5b 2820 2828 7829 202d 2028 7064  um=[( ((x) - (pd
-00007e40: 2e54 696d 6573 7461 6d70 2879 6561 723d  .Timestamp(year=
-00007e50: 782e 7965 6172 2c20 6d6f 6e74 683d 312c  x.year, month=1,
-00007e60: 2064 6179 3d31 2929 292e 6461 7973 202b   day=1))).days +
-00007e70: 2031 2920 666f 7220 7820 696e 2064 6174   1) for x in dat
-00007e80: 6573 5f6c 6973 745d 0d0a 2320 2020 2020  es_list]..#     
-00007e90: 7469 6d65 323d 6461 7973 5f6e 756d 5b6c  time2=days_num[l
-00007ea0: 656e 2864 6179 735f 6e75 6d29 2d31 5d0d  en(days_num)-1].
-00007eb0: 0a23 2020 2020 2074 696d 6531 3d64 6179  .#     time1=day
-00007ec0: 735f 6e75 6d5b 305d 0d0a 2320 2020 2020  s_num[0]..#     
-00007ed0: 6465 6c74 613d 7469 6d65 322d 7469 6d65  delta=time2-time
-00007ee0: 310d 0a23 2020 2020 2064 656c 7461 3d66  1..#     delta=f
-00007ef0: 6c6f 6174 2864 656c 7461 290d 0a23 2020  loat(delta)..#  
-00007f00: 2020 2070 7269 6e74 2864 6179 735f 6e75     print(days_nu
-00007f10: 6d2c 2064 656c 7461 290d 0a20 2020 200d  m, delta)..    .
-00007f20: 0a23 2020 2020 206d 2c20 6220 3d20 6265  .#     m, b = be
-00007f30: 7374 5f66 6974 5f73 6c6f 7065 5f61 6e64  st_fit_slope_and
-00007f40: 5f69 6e74 6572 6365 7074 2864 662e 726f  _intercept(df.ro
-00007f50: 775f 636f 756e 742c 2064 662e 7661 6c29  w_count, df.val)
-00007f60: 0d0a 2320 2020 2020 7072 696e 7428 226d  ..#     print("m
-00007f70: 3a22 2c20 6d61 7468 2e63 6569 6c28 6d2a  :", math.ceil(m*
-00007f80: 3130 3029 2f31 3030 2c20 2262 3a22 2c6d  100)/100, "b:",m
-00007f90: 6174 682e 6365 696c 2862 2a31 3030 292f  ath.ceil(b*100)/
-00007fa0: 3130 3029 0d0a 2320 2020 2020 7265 6772  100)..#     regr
-00007fb0: 6573 7369 6f6e 5f6d 6f64 656c 203d 204c  ession_model = L
-00007fc0: 696e 6561 7252 6567 7265 7373 696f 6e28  inearRegression(
-00007fd0: 290d 0a23 2020 2020 2076 616c 5f64 6174  )..#     val_dat
-00007fe0: 6573 5f72 6573 203d 2072 6567 7265 7373  es_res = regress
-00007ff0: 696f 6e5f 6d6f 6465 6c2e 6669 7428 6e70  ion_model.fit(np
-00008000: 2e61 7272 6179 2864 6179 735f 6e75 6d29  .array(days_num)
-00008010: 2e72 6573 6861 7065 282d 312c 3129 2c20  .reshape(-1,1), 
-00008020: 6e70 2e61 7272 6179 2864 662e 7661 6c29  np.array(df.val)
-00008030: 290d 0a23 2020 2020 2079 5f70 7265 6469  )..#     y_predi
-00008040: 6374 6564 203d 2072 6567 7265 7373 696f  cted = regressio
-00008050: 6e5f 6d6f 6465 6c2e 7072 6564 6963 7428  n_model.predict(
-00008060: 6e70 2e61 7272 6179 2864 6179 735f 6e75  np.array(days_nu
-00008070: 6d29 2e72 6573 6861 7065 282d 312c 3129  m).reshape(-1,1)
-00008080: 290d 0a20 2020 200d 0a23 2020 2020 2069  )..    ..#     i
-00008090: 6620 5645 4c5f 5363 616c 653d 3d27 7965  f VEL_Scale=='ye
-000080a0: 6172 273a 0d0a 2320 2020 2020 2020 2020  ar':..#         
-000080b0: 7261 7465 5f63 6861 6e67 653d 7265 6772  rate_change=regr
-000080c0: 6573 7369 6f6e 5f6d 6f64 656c 2e63 6f65  ession_model.coe
-000080d0: 665f 5b30 5d2f 6465 6c74 6120 2a20 3336  f_[0]/delta * 36
-000080e0: 352e 300d 0a23 2020 2020 2065 6c69 6620  5.0..#     elif 
-000080f0: 5645 4c5f 5363 616c 653d 3d27 6d6f 6e74  VEL_Scale=='mont
-00008100: 6827 3a0d 0a23 2020 2020 2020 2020 2072  h':..#         r
-00008110: 6174 655f 6368 616e 6765 3d72 6567 7265  ate_change=regre
-00008120: 7373 696f 6e5f 6d6f 6465 6c2e 636f 6566  ssion_model.coef
-00008130: 5f5b 305d 2f64 656c 7461 202a 2033 300d  _[0]/delta * 30.
-00008140: 0a20 2020 2020 2020 200d 0a23 2020 2020  .        ..#    
-00008150: 2023 206d 6f64 656c 2065 7661 6c75 6174   # model evaluat
-00008160: 696f 6e0d 0a23 2020 2020 206d 7365 3d6d  ion..#     mse=m
-00008170: 6561 6e5f 7371 7561 7265 645f 6572 726f  ean_squared_erro
-00008180: 7228 6e70 2e61 7272 6179 2864 662e 7661  r(np.array(df.va
-00008190: 6c29 2c79 5f70 7265 6469 6374 6564 290d  l),y_predicted).
-000081a0: 0a23 2020 2020 2072 6d73 6520 3d20 6e70  .#     rmse = np
-000081b0: 2e73 7172 7428 6d65 616e 5f73 7175 6172  .sqrt(mean_squar
-000081c0: 6564 5f65 7272 6f72 286e 702e 6172 7261  ed_error(np.arra
-000081d0: 7928 6466 2e76 616c 292c 2079 5f70 7265  y(df.val), y_pre
-000081e0: 6469 6374 6564 2929 0d0a 2320 2020 2020  dicted))..#     
-000081f0: 7232 203d 2072 325f 7363 6f72 6528 6e70  r2 = r2_score(np
-00008200: 2e61 7272 6179 2864 662e 7661 6c29 2c20  .array(df.val), 
-00008210: 795f 7072 6564 6963 7465 6429 0d0a 2020  y_predicted)..  
-00008220: 2020 0d0a 2320 2020 2020 2320 7072 696e    ..#     # prin
-00008230: 7469 6e67 2076 616c 7565 730d 0a23 2020  ting values..#  
-00008240: 2020 2070 7269 6e74 2827 536c 6f70 6528     print('Slope(
-00008250: 6c69 6e65 6172 2064 6566 6f72 6d61 7469  linear deformati
-00008260: 6f6e 2072 6174 6529 3a27 202b 2073 7472  on rate):' + str
-00008270: 286d 6174 682e 6365 696c 2872 6567 7265  (math.ceil(regre
-00008280: 7373 696f 6e5f 6d6f 6465 6c2e 636f 6566  ssion_model.coef
-00008290: 5f5b 305d 2a31 3030 292f 3130 302f 6465  _[0]*100)/100/de
-000082a0: 6c74 6129 202b 2022 206d 6d2f 6461 7922  lta) + " mm/day"
-000082b0: 290d 0a23 2020 2020 2070 7269 6e74 2827  )..#     print('
-000082c0: 496e 7465 7263 6570 743a 272c 206d 6174  Intercept:', mat
-000082d0: 682e 6365 696c 2862 2a31 3030 292f 3130  h.ceil(b*100)/10
-000082e0: 3029 0d0a 2320 2020 2020 2370 7269 6e74  0)..#     #print
-000082f0: 2827 4d53 453a 272c 6d73 6529 0d0a 2320  ('MSE:',mse)..# 
-00008300: 2020 2020 7072 696e 7428 2752 6f6f 7420      print('Root 
-00008310: 6d65 616e 2073 7175 6172 6564 2065 7272  mean squared err
-00008320: 6f72 3a20 272c 206d 6174 682e 6365 696c  or: ', math.ceil
-00008330: 2872 6d73 652a 3130 3029 2f31 3030 290d  (rmse*100)/100).
-00008340: 0a23 2020 2020 2070 7269 6e74 2827 5232  .#     print('R2
-00008350: 2073 636f 7265 3a20 272c 2072 3229 0d0a   score: ', r2)..
-00008360: 2320 2020 2020 7072 696e 7428 2253 5444  #     print("STD
-00008370: 3a20 222c 6d61 7468 2e63 6569 6c28 6e70  : ",math.ceil(np
-00008380: 2e73 7464 2879 5f70 7265 6469 6374 6564  .std(y_predicted
-00008390: 292a 3130 3029 2f31 3030 2920 0d0a 2320  )*100)/100) ..# 
-000083a0: 2020 2020 2320 4372 6561 7465 2066 6967      # Create fig
-000083b0: 7572 650d 0a23 2020 2020 2023 6669 6720  ure..#     #fig 
-000083c0: 3d20 676f 2e46 6967 7572 6528 290d 0a20  = go.Figure().. 
-000083d0: 2020 200d 0a23 2020 2020 2066 6967 203d     ..#     fig =
-000083e0: 2067 6f2e 4669 6775 7265 5769 6467 6574   go.FigureWidget
-000083f0: 2829 0d0a 2020 2020 0d0a 2320 2020 2020  ()..    ..#     
-00008400: 706c 6f74 5f6e 756d 6265 723d 2250 6c6f  plot_number="Plo
-00008410: 7420 4e75 6d62 6572 3a22 2b73 7472 2870  t Number:"+str(p
-00008420: 6c6f 745f 6e75 6d62 6572 290d 0a0d 0a23  lot_number)....#
-00008430: 2020 2020 2066 6967 2e61 6464 5f74 7261       fig.add_tra
-00008440: 6365 2867 6f2e 5363 6174 7465 7228 783d  ce(go.Scatter(x=
-00008450: 6c69 7374 2864 662e 696e 6465 7829 2c20  list(df.index), 
-00008460: 793d 6c69 7374 2864 662e 7661 6c29 2929  y=list(df.val)))
-00008470: 0d0a 2320 2020 2020 6669 6720 3d20 7078  ..#     fig = px
-00008480: 2e73 6361 7474 6572 2864 662c 2078 3d6c  .scatter(df, x=l
-00008490: 6973 7428 6466 2e69 6e64 6578 292c 2079  ist(df.index), y
-000084a0: 3d6c 6973 7428 6466 2e76 616c 292c 0d0a  =list(df.val),..
-000084b0: 2320 2020 2020 2020 2020 2020 2020 2020  #               
-000084c0: 2020 636f 6c6f 723d 2276 616c 222c 2068    color="val", h
-000084d0: 6f76 6572 5f6e 616d 653d 2276 616c 220d  over_name="val".
-000084e0: 0a23 2020 2020 2020 2020 2020 2020 2020  .#              
-000084f0: 2020 2020 2020 202c 206c 6162 656c 733d         , labels=
-00008500: 6469 6374 2878 3d22 4461 7465 7322 2c20  dict(x="Dates", 
-00008510: 793d 226d 6d2f 222b 5645 4c5f 5363 616c  y="mm/"+VEL_Scal
-00008520: 6520 2c20 636f 6c6f 723d 226d 6d2f 222b  e , color="mm/"+
-00008530: 5645 4c5f 5363 616c 6529 290d 0a20 2020  VEL_Scale))..   
-00008540: 200d 0a23 2020 2020 2023 2066 6967 2e61   ..#     # fig.a
-00008550: 6464 5f74 7261 6365 280d 0a23 2020 2020  dd_trace(..#    
-00008560: 2023 2067 6f2e 5363 6174 7465 7228 783d   # go.Scatter(x=
-00008570: 6c69 7374 2864 662e 696e 6465 7829 2c20  list(df.index), 
-00008580: 793d 6c69 7374 2876 616c 5f66 6974 292c  y=list(val_fit),
-00008590: 206d 6f64 6520 3d20 226c 696e 6573 222c   mode = "lines",
-000085a0: 6e61 6d65 3d22 7472 656e 646c 696e 6522  name="trendline"
-000085b0: 2c20 6d61 726b 6572 5f63 6f6c 6f72 203d  , marker_color =
-000085c0: 2022 7265 6422 2929 0d0a 2020 2020 0d0a   "red"))..    ..
-000085d0: 2020 2020 0d0a 2020 2020 0d0a 2320 2020      ..    ..#   
-000085e0: 2020 6669 672e 6164 645f 7472 6163 6528    fig.add_trace(
-000085f0: 676f 2e53 6361 7474 6572 2878 3d6c 6973  go.Scatter(x=lis
-00008600: 7428 6466 2e69 6e64 6578 292c 2079 3d6c  t(df.index), y=l
-00008610: 6973 7428 6466 2e76 616c 292c 6d6f 6465  ist(df.val),mode
-00008620: 203d 2027 6c69 6e65 7327 2c0d 0a23 2020   = 'lines',..#  
-00008630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008640: 2020 2020 2020 2020 2020 206e 616d 6520             name 
-00008650: 3d20 2764 7261 7720 6c69 6e65 7327 2c20  = 'draw lines', 
-00008660: 6c69 6e65 203d 2064 6963 7428 7368 6170  line = dict(shap
-00008670: 6520 3d20 276c 696e 6561 7227 2c20 636f  e = 'linear', co
-00008680: 6c6f 7220 3d20 2772 6762 2830 2c20 302c  lor = 'rgb(0, 0,
-00008690: 2030 2927 2c20 6461 7368 203d 2027 6461   0)', dash = 'da
-000086a0: 7368 2729 2c20 636f 6e6e 6563 7467 6170  sh'), connectgap
-000086b0: 7320 3d20 5472 7565 2929 0d0a 2020 2020  s = True))..    
-000086c0: 0d0a 2320 2020 2020 6669 672e 6164 645f  ..#     fig.add_
-000086d0: 7472 6163 6528 0d0a 2320 2020 2020 2020  trace(..#       
-000086e0: 2020 676f 2e53 6361 7474 6572 2878 3d6c    go.Scatter(x=l
-000086f0: 6973 7428 6466 2e69 6e64 6578 292c 2079  ist(df.index), y
-00008700: 3d6c 6973 7428 795f 7072 6564 6963 7465  =list(y_predicte
-00008710: 6429 2c20 6d6f 6465 203d 2022 6c69 6e65  d), mode = "line
-00008720: 7322 2c6e 616d 653d 2274 7265 6e64 6c69  s",name="trendli
-00008730: 6e65 222c 206d 6172 6b65 725f 636f 6c6f  ne", marker_colo
-00008740: 7220 3d20 2262 6c61 636b 222c 206c 696e  r = "black", lin
-00008750: 655f 636f 6c6f 723d 2772 6564 2729 290d  e_color='red')).
-00008760: 0a20 2020 200d 0a20 2020 200d 0a0d 0a23  .    ..    ....#
-00008770: 2020 2020 2023 2041 6464 2072 616e 6765       # Add range
-00008780: 2073 6c69 6465 720d 0a23 2020 2020 2066   slider..#     f
-00008790: 6967 2e75 7064 6174 655f 6c61 796f 7574  ig.update_layout
-000087a0: 280d 0a23 2020 2020 2020 2020 2078 6178  (..#         xax
-000087b0: 6973 3d64 6963 7428 0d0a 2320 2020 2020  is=dict(..#     
-000087c0: 2020 2020 2020 2020 7261 6e67 6573 656c          rangesel
-000087d0: 6563 746f 723d 6469 6374 280d 0a23 2020  ector=dict(..#  
-000087e0: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-000087f0: 7574 746f 6e73 3d6c 6973 7428 5b0d 0a23  uttons=list([..#
-00008800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008810: 2020 2020 2064 6963 7428 636f 756e 743d       dict(count=
-00008820: 312c 0d0a 2320 2020 2020 2020 2020 2020  1,..#           
-00008830: 2020 2020 2020 2020 2020 2020 2020 6c61                la
-00008840: 6265 6c3d 2231 6d22 2c0d 0a23 2020 2020  bel="1m",..#    
-00008850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008860: 2020 2020 2073 7465 703d 226d 6f6e 7468       step="month
-00008870: 222c 0d0a 2320 2020 2020 2020 2020 2020  ",..#           
-00008880: 2020 2020 2020 2020 2020 2020 2020 7374                st
-00008890: 6570 6d6f 6465 3d22 6261 636b 7761 7264  epmode="backward
-000088a0: 2229 2c0d 0a23 2020 2020 2020 2020 2020  "),..#          
-000088b0: 2020 2020 2020 2020 2020 2064 6963 7428             dict(
-000088c0: 636f 756e 743d 362c 0d0a 2320 2020 2020  count=6,..#     
-000088d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000088e0: 2020 2020 6c61 6265 6c3d 2236 6d22 2c0d      label="6m",.
-000088f0: 0a23 2020 2020 2020 2020 2020 2020 2020  .#              
-00008900: 2020 2020 2020 2020 2020 2073 7465 703d             step=
-00008910: 226d 6f6e 7468 222c 0d0a 2320 2020 2020  "month",..#     
-00008920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008930: 2020 2020 7374 6570 6d6f 6465 3d22 6261      stepmode="ba
-00008940: 636b 7761 7264 2229 2c0d 0a23 2020 2020  ckward"),..#    
-00008950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008960: 2064 6963 7428 636f 756e 743d 312c 0d0a   dict(count=1,..
-00008970: 2320 2020 2020 2020 2020 2020 2020 2020  #               
-00008980: 2020 2020 2020 2020 2020 6c61 6265 6c3d            label=
-00008990: 2259 5444 222c 0d0a 2320 2020 2020 2020  "YTD",..#       
-000089a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000089b0: 2020 7374 6570 3d22 7965 6172 222c 0d0a    step="year",..
-000089c0: 2320 2020 2020 2020 2020 2020 2020 2020  #               
-000089d0: 2020 2020 2020 2020 2020 7374 6570 6d6f            stepmo
-000089e0: 6465 3d22 746f 6461 7465 2229 2c0d 0a23  de="todate"),..#
-000089f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008a00: 2020 2020 2064 6963 7428 636f 756e 743d       dict(count=
-00008a10: 312c 0d0a 2320 2020 2020 2020 2020 2020  1,..#           
-00008a20: 2020 2020 2020 2020 2020 2020 2020 6c61                la
-00008a30: 6265 6c3d 2231 7922 2c0d 0a23 2020 2020  bel="1y",..#    
-00008a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008a50: 2020 2020 2073 7465 703d 2279 6561 7222       step="year"
-00008a60: 2c0d 0a23 2020 2020 2020 2020 2020 2020  ,..#            
-00008a70: 2020 2020 2020 2020 2020 2020 2073 7465               ste
-00008a80: 706d 6f64 653d 2262 6163 6b77 6172 6422  pmode="backward"
-00008a90: 292c 0d0a 2320 2020 2020 2020 2020 2020  ),..#           
-00008aa0: 2020 2020 2020 2020 2020 6469 6374 2873            dict(s
-00008ab0: 7465 703d 2261 6c6c 2229 0d0a 2320 2020  tep="all")..#   
-00008ac0: 2020 2020 2020 2020 2020 2020 2020 5d29                ])
-00008ad0: 0d0a 2320 2020 2020 2020 2020 2020 2020  ..#             
-00008ae0: 292c 0d0a 2320 2020 2020 2020 2020 2020  ),..#           
-00008af0: 2020 7261 6e67 6573 6c69 6465 723d 6469    rangeslider=di
-00008b00: 6374 280d 0a23 2020 2020 2020 2020 2020  ct(..#          
-00008b10: 2020 2020 2020 2076 6973 6962 6c65 3d54         visible=T
-00008b20: 7275 650d 0a23 2020 2020 2020 2020 2020  rue..#          
-00008b30: 2020 2029 2c0d 0a23 2020 2020 2020 2020     ),..#        
-00008b40: 2020 2020 2074 7970 653d 2264 6174 6522       type="date"
-00008b50: 0d0a 2320 2020 2020 2020 2020 2920 0d0a  ..#         ) ..
-00008b60: 2320 2020 2020 290d 0a23 2020 2020 2066  #     )..#     f
-00008b70: 6967 2e75 7064 6174 655f 7861 7865 7328  ig.update_xaxes(
-00008b80: 7261 6e67 6573 6c69 6465 725f 7468 6963  rangeslider_thic
-00008b90: 6b6e 6573 7320 3d20 302e 3035 290d 0a23  kness = 0.05)..#
-00008ba0: 2020 2020 2023 6669 672e 7570 6461 7465       #fig.update
-00008bb0: 5f6c 6179 6f75 7428 7368 6f77 6c65 6765  _layout(showlege
-00008bc0: 6e64 3d54 7275 6529 0d0a 0d0a 2320 2020  nd=True)....#   
-00008bd0: 2020 2366 6967 2e64 6174 615b 305d 2e75    #fig.data[0].u
-00008be0: 7064 6174 6528 6c69 6e65 5f63 6f6c 6f72  pdate(line_color
-00008bf0: 3d27 626c 6163 6b27 290d 0a23 2020 2020  ='black')..#    
-00008c00: 2074 743d 2022 4465 666f 2d52 6174 653a   tt= "Defo-Rate:
-00008c10: 222b 7374 7228 726f 756e 6428 7261 7465  "+str(round(rate
-00008c20: 5f63 6861 6e67 652c 3229 292b 223a 222b  _change,2))+":"+
-00008c30: 2022 4465 666f 2d52 6174 652d 5354 443a   "Defo-Rate-STD:
-00008c40: 222b 7374 7228 726f 756e 6428 6e70 2e73  "+str(round(np.s
-00008c50: 7464 2879 5f70 7265 6469 6374 6564 292c  td(y_predicted),
-00008c60: 2032 2929 2b20 223a 2220 2b70 6c6f 745f   2))+ ":" +plot_
-00008c70: 6e75 6d62 6572 0d0a 2020 2020 0d0a 2320  number..    ..# 
-00008c80: 2020 2020 2320 6d61 6b65 2073 7061 6365      # make space
-00008c90: 2066 6f72 2065 7870 6c61 6e61 7469 6f6e   for explanation
-00008ca0: 202f 2061 6e6e 6f74 6174 696f 6e0d 0a23   / annotation..#
-00008cb0: 2020 2020 2066 6967 2e75 7064 6174 655f       fig.update_
-00008cc0: 6c61 796f 7574 286d 6172 6769 6e3d 6469  layout(margin=di
-00008cd0: 6374 286c 3d32 302c 2072 3d32 302c 2074  ct(l=20, r=20, t
-00008ce0: 3d32 302c 2062 3d36 3029 2c70 6170 6572  =20, b=60),paper
-00008cf0: 5f62 6763 6f6c 6f72 3d22 4c69 6768 7453  _bgcolor="LightS
-00008d00: 7465 656c 426c 7565 2229 0d0a 0d0a 2020  teelBlue")....  
-00008d10: 2020 0d0a 2320 2020 2020 6669 672e 7570    ..#     fig.up
-00008d20: 6461 7465 5f6c 6179 6f75 7428 0d0a 2020  date_layout(..  
-00008d30: 2020 2020 2020 0d0a 2320 2020 2020 7469        ..#     ti
-00008d40: 746c 655f 7465 7874 3d74 742c 2074 6974  tle_text=tt, tit
-00008d50: 6c65 5f66 6f6e 745f 6661 6d69 6c79 3d22  le_font_family="
-00008d60: 5369 746b 6120 536d 616c 6c22 2c0d 0a23  Sitka Small",..#
-00008d70: 2020 2020 2074 6974 6c65 5f66 6f6e 745f       title_font_
-00008d80: 636f 6c6f 723d 2272 6564 222c 2074 6974  color="red", tit
-00008d90: 6c65 5f78 3d30 2e35 202c 206c 6567 656e  le_x=0.5 , legen
-00008da0: 645f 7469 746c 653d 224c 6567 656e 6422  d_title="Legend"
-00008db0: 2c0d 0a23 2020 2020 2066 6f6e 743d 6469  ,..#     font=di
-00008dc0: 6374 280d 0a23 2020 2020 2020 2020 2066  ct(..#         f
-00008dd0: 616d 696c 793d 2243 6f75 7269 6572 204e  amily="Courier N
-00008de0: 6577 2c20 6d6f 6e6f 7370 6163 6522 2c0d  ew, monospace",.
-00008df0: 0a23 2020 2020 2020 2020 2073 697a 653d  .#         size=
-00008e00: 3135 2c0d 0a23 2020 2020 2020 2020 2063  15,..#         c
-00008e10: 6f6c 6f72 3d22 5265 6265 6363 6150 7572  olor="RebeccaPur
-00008e20: 706c 6522 2029 290d 0a20 2020 200d 0a23  ple" ))..    ..#
-00008e30: 2020 2020 2066 6967 2e75 7064 6174 655f       fig.update_
-00008e40: 6c61 796f 7574 286c 6567 656e 643d 6469  layout(legend=di
-00008e50: 6374 280d 0a23 2020 2020 2079 616e 6368  ct(..#     yanch
-00008e60: 6f72 3d22 746f 7022 2c0d 0a23 2020 2020  or="top",..#    
-00008e70: 2079 3d2d 302c 0d0a 2320 2020 2020 7861   y=-0,..#     xa
-00008e80: 6e63 686f 723d 226c 6566 7422 2c0d 0a23  nchor="left",..#
-00008e90: 2020 2020 2078 3d31 2e30 310d 0a23 2029       x=1.01..# )
-00008ea0: 290d 0a0d 0a23 2020 2020 2023 2066 6967  )....#     # fig
-00008eb0: 2e75 7064 6174 655f 6c61 796f 7574 280d  .update_layout(.
-00008ec0: 0a23 2020 2020 2023 2075 7064 6174 656d  .#     # updatem
-00008ed0: 656e 7573 3d5b 0d0a 2320 2020 2020 2320  enus=[..#     # 
-00008ee0: 2020 2020 6469 6374 280d 0a23 2020 2020      dict(..#    
-00008ef0: 2023 2020 2020 2020 2020 2074 7970 653d   #         type=
-00008f00: 2262 7574 746f 6e73 222c 0d0a 2320 2020  "buttons",..#   
-00008f10: 2020 2320 2020 2020 2020 2020 6469 7265    #         dire
-00008f20: 6374 696f 6e3d 2272 6967 6874 222c 0d0a  ction="right",..
-00008f30: 2320 2020 2020 2320 2020 2020 2020 2020  #     #         
-00008f40: 6163 7469 7665 3d30 2c0d 0a23 2020 2020  active=0,..#    
-00008f50: 2023 2020 2020 2020 2020 2078 3d30 2e35   #         x=0.5
-00008f60: 372c 0d0a 2320 2020 2020 2320 2020 2020  7,..#     #     
-00008f70: 2020 2020 793d 312e 322c 0d0a 2320 2020      y=1.2,..#   
-00008f80: 2020 2320 2020 2020 2020 2020 6275 7474    #         butt
-00008f90: 6f6e 733d 6c69 7374 285b 0d0a 2320 2020  ons=list([..#   
-00008fa0: 2020 2320 2020 2020 2020 2020 2020 2020    #             
-00008fb0: 6469 6374 280d 0a23 2020 2020 2023 2020  dict(..#     #  
-00008fc0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-00008fd0: 7267 733d 5b22 636f 6c6f 7273 6361 6c65  rgs=["colorscale
-00008fe0: 222c 2022 5669 7269 6469 7322 5d2c 0d0a  ", "Viridis"],..
-00008ff0: 2320 2020 2020 2320 2020 2020 2020 2020  #     #         
-00009000: 2020 2020 2020 2020 6c61 6265 6c3d 2256          label="V
-00009010: 6972 6964 6973 222c 0d0a 2320 2020 2020  iridis",..#     
-00009020: 2320 2020 2020 2020 2020 2020 2020 2020  #               
-00009030: 2020 6d65 7468 6f64 3d22 7265 7374 796c    method="restyl
-00009040: 6522 0d0a 2320 2020 2020 2320 2020 2020  e"..#     #     
-00009050: 2020 2020 2020 2020 292c 0d0a 2320 2020          ),..#   
-00009060: 2020 2320 2020 2020 2020 2020 2020 2020    #             
-00009070: 6469 6374 280d 0a23 2020 2020 2023 2020  dict(..#     #  
-00009080: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-00009090: 7267 733d 5b22 636f 6c6f 7273 6361 6c65  rgs=["colorscale
-000090a0: 222c 2022 7475 7262 6f22 5d2c 0d0a 2320  ", "turbo"],..# 
-000090b0: 2020 2020 2320 2020 2020 2020 2020 2020      #           
-000090c0: 2020 2020 2020 6c61 6265 6c3d 2274 7572        label="tur
-000090d0: 626f 222c 0d0a 2320 2020 2020 2320 2020  bo",..#     #   
-000090e0: 2020 2020 2020 2020 2020 2020 2020 6d65                me
-000090f0: 7468 6f64 3d22 7265 7374 796c 6522 0d0a  thod="restyle"..
-00009100: 2320 2020 2020 2320 2020 2020 2020 2020  #     #         
-00009110: 2020 2020 290d 0a23 2020 2020 2023 2020      )..#     #  
-00009120: 2020 2020 2020 205d 292c 0d0a 2320 2020         ]),..#   
-00009130: 2020 2320 2020 2020 290d 0a23 2020 2020    #     )..#    
-00009140: 2023 205d 290d 0a0d 0a20 2020 200d 0a23   # ])....    ..#
-00009150: 2020 2020 2066 6967 2e75 7064 6174 655f       fig.update_
-00009160: 7861 7865 7328 7368 6f77 7370 696b 6573  xaxes(showspikes
-00009170: 3d54 7275 652c 2073 7069 6b65 6d6f 6465  =True, spikemode
-00009180: 3d27 746f 6178 6973 2720 2c20 7370 696b  ='toaxis' , spik
-00009190: 6573 6e61 703d 2763 7572 736f 7227 2c20  esnap='cursor', 
-000091a0: 7370 696b 6564 6173 683d 2764 6f74 272c  spikedash='dot',
-000091b0: 2073 7069 6b65 636f 6c6f 723d 2762 6c75   spikecolor='blu
-000091c0: 6527 2c20 7363 616c 6561 6e63 686f 723d  e', scaleanchor=
-000091d0: 2779 272c 2074 6974 6c65 5f66 6f6e 745f  'y', title_font_
-000091e0: 6661 6d69 6c79 3d22 4172 6961 6c22 2c20  family="Arial", 
-000091f0: 0d0a 2320 2020 2020 2020 2020 2020 2020  ..#             
-00009200: 2020 2020 2020 2020 7469 746c 655f 666f          title_fo
-00009210: 6e74 3d64 6963 7428 7369 7a65 3d31 3529  nt=dict(size=15)
-00009220: 290d 0a23 2020 2020 2066 6967 2e75 7064  )..#     fig.upd
-00009230: 6174 655f 7961 7865 7328 7368 6f77 7370  ate_yaxes(showsp
-00009240: 696b 6573 3d54 7275 652c 2073 7069 6b65  ikes=True, spike
-00009250: 6d6f 6465 3d27 746f 6178 6973 2720 2c20  mode='toaxis' , 
-00009260: 7370 696b 6573 6e61 703d 2763 7572 736f  spikesnap='curso
-00009270: 7227 2c20 7370 696b 6564 6173 683d 2764  r', spikedash='d
-00009280: 6f74 272c 2073 7069 6b65 636f 6c6f 723d  ot', spikecolor=
-00009290: 2762 6c75 6527 2c20 7363 616c 6561 6e63  'blue', scaleanc
-000092a0: 686f 723d 2778 272c 2074 6974 6c65 5f66  hor='x', title_f
-000092b0: 6f6e 745f 6661 6d69 6c79 3d22 4172 6961  ont_family="Aria
-000092c0: 6c22 2c0d 0a23 2020 2020 2020 2020 2020  l",..#          
-000092d0: 2020 2020 2020 2020 2020 2074 6974 6c65             title
-000092e0: 5f66 6f6e 743d 6469 6374 2873 697a 653d  _font=dict(size=
-000092f0: 3135 2929 0d0a 0d0a 2020 2020 0d0a 2020  15))....    ..  
-00009300: 2020 0d0a 2320 2020 2020 6966 2073 6176    ..#     if sav
-00009310: 655f 706c 6f74 3d3d 5472 7565 3a0d 0a20  e_plot==True:.. 
-00009320: 2020 200d 0a23 2020 2020 2020 2020 2069     ..#         i
-00009330: 6620 6e6f 7420 6f73 2e70 6174 682e 6578  f not os.path.ex
-00009340: 6973 7473 286f 7574 7075 745f 6469 7229  ists(output_dir)
-00009350: 3a0d 0a23 2020 2020 2020 2020 2020 2020  :..#            
-00009360: 206f 732e 6d6b 6469 7228 6f75 7470 7574   os.mkdir(output
-00009370: 5f64 6972 290d 0a0d 0a23 2020 2020 2020  _dir)....#      
-00009380: 2020 2066 6967 2e77 7269 7465 5f68 746d     fig.write_htm
-00009390: 6c28 6f75 7470 7574 5f64 6972 202b 2022  l(output_dir + "
-000093a0: 2f22 202b 2070 6c6f 745f 6669 6c65 6e61  /" + plot_filena
-000093b0: 6d65 202b 2022 2e68 746d 6c22 2029 0d0a  me + ".html" )..
-000093c0: 2320 2020 2020 2020 2020 6669 672e 7772  #         fig.wr
-000093d0: 6974 655f 696d 6167 6528 6f75 7470 7574  ite_image(output
-000093e0: 5f64 6972 202b 2022 2f22 202b 2070 6c6f  _dir + "/" + plo
-000093f0: 745f 6669 6c65 6e61 6d65 202b 2022 2e6a  t_filename + ".j
-00009400: 7065 6722 2c20 7363 616c 653d 312c 2077  peg", scale=1, w
-00009410: 6964 7468 3d31 3038 302c 2068 6569 6768  idth=1080, heigh
-00009420: 743d 3330 3020 290d 0a20 2020 2020 2020  t=300 )..       
-00009430: 200d 0a20 2020 200d 0a23 2020 2020 2064   ..    ..#     d
-00009440: 6566 207a 6f6f 6d28 6c61 796f 7574 2c20  ef zoom(layout, 
-00009450: 7872 616e 6765 293a 0d0a 2320 2020 2020  xrange):..#     
-00009460: 2020 2020 696e 5f76 6965 7720 3d20 6466      in_view = df
-00009470: 2e6c 6f63 5b66 6967 2e6c 6179 6f75 742e  .loc[fig.layout.
-00009480: 7861 7869 732e 7261 6e67 655b 305d 3a66  xaxis.range[0]:f
-00009490: 6967 2e6c 6179 6f75 742e 7861 7869 732e  ig.layout.xaxis.
-000094a0: 7261 6e67 655b 315d 5d0d 0a23 2020 2020  range[1]]..#    
-000094b0: 2020 2020 2066 6967 2e6c 6179 6f75 742e       fig.layout.
-000094c0: 7961 7869 732e 7261 6e67 6520 3d20 5b69  yaxis.range = [i
-000094d0: 6e5f 7669 6577 2e48 6967 682e 6d69 6e28  n_view.High.min(
-000094e0: 2920 2d20 3130 2c20 696e 5f76 6965 772e  ) - 10, in_view.
-000094f0: 4869 6768 2e6d 6178 2829 202b 2031 305d  High.max() + 10]
-00009500: 0d0a 0d0a 2320 2020 2020 6669 672e 6c61  ....#     fig.la
-00009510: 796f 7574 2e6f 6e5f 6368 616e 6765 287a  yout.on_change(z
-00009520: 6f6f 6d2c 2027 7861 7869 732e 7261 6e67  oom, 'xaxis.rang
-00009530: 6527 290d 0a20 2020 200d 0a23 2020 2020  e')..    ..#    
-00009540: 2066 6967 2e73 686f 7728 290d 0a20 2020   fig.show()..   
-00009550: 200d 0a20 2020 200d 0a0d 0a0d 0a0d 0a0d   ..    .........
-00009560: 0a20 2020 200d 0a23 2020 2020 2073 7461  .    ..#     sta
-00009570: 7274 3d69 6e74 2873 7461 7274 2e74 696d  rt=int(start.tim
-00009580: 6573 7461 6d70 2829 202a 2031 3030 3029  estamp() * 1000)
-00009590: 0d0a 2320 2020 2020 656e 643d 696e 7428  ..#     end=int(
-000095a0: 656e 642e 7469 6d65 7374 616d 7028 2920  end.timestamp() 
-000095b0: 2a20 3130 3030 290d 0a0d 0a23 2020 2020  * 1000)....#    
-000095c0: 2023 6466 3d70 642e 7265 6164 5f63 7376   #df=pd.read_csv
-000095d0: 2827 7465 6d70 322e 6373 7627 290d 0a20  ('temp2.csv').. 
-000095e0: 2020 200d 0a23 2020 2020 2064 662e 7265     ..#     df.re
-000095f0: 6e61 6d65 2863 6f6c 756d 6e73 3d7b 2064  name(columns={ d
-00009600: 662e 636f 6c75 6d6e 735b 305d 3a20 2264  f.columns[0]: "d
-00009610: 6422 207d 2c20 696e 706c 6163 6520 3d20  d" }, inplace = 
-00009620: 5472 7565 290d 0a23 2020 2020 2064 665b  True)..#     df[
-00009630: 2764 645f 7374 7227 5d3d 6466 5b27 6464  'dd_str']=df['dd
-00009640: 275d 2e61 7374 7970 6528 7374 7229 0d0a  '].astype(str)..
-00009650: 2320 2020 2020 6466 5b27 6464 5f73 7472  #     df['dd_str
-00009660: 275d 203d 2064 665b 2764 645f 7374 7227  '] = df['dd_str'
-00009670: 5d2e 6173 7479 7065 2873 7472 290d 0a23  ].astype(str)..#
-00009680: 2020 2020 2064 662e 7265 6e61 6d65 2863       df.rename(c
-00009690: 6f6c 756d 6e73 3d7b 2064 662e 636f 6c75  olumns={ df.colu
-000096a0: 6d6e 735b 315d 3a20 2276 616c 2220 7d2c  mns[1]: "val" },
-000096b0: 2069 6e70 6c61 6365 203d 2054 7275 6529   inplace = True)
-000096c0: 0d0a 2320 2020 2020 6466 5b27 6464 275d  ..#     df['dd']
-000096d0: 3d20 7064 2e74 6f5f 6461 7465 7469 6d65  = pd.to_datetime
-000096e0: 2864 665b 2764 6427 5d2e 6173 7479 7065  (df['dd'].astype
-000096f0: 2873 7472 292c 2066 6f72 6d61 743d 2725  (str), format='%
-00009700: 592d 256d 2d25 6427 290d 0a23 2020 2020  Y-%m-%d')..#    
-00009710: 2064 662e 696e 7365 7274 2864 662e 7368   df.insert(df.sh
-00009720: 6170 655b 315d 2c0d 0a23 2020 2020 2020  ape[1],..#      
-00009730: 2020 2020 2020 2027 726f 775f 636f 756e         'row_coun
-00009740: 7427 2c0d 0a23 2020 2020 2020 2020 2020  t',..#          
-00009750: 2020 2064 662e 696e 6465 782e 7661 6c75     df.index.valu
-00009760: 655f 636f 756e 7473 2829 2e73 6f72 745f  e_counts().sort_
-00009770: 696e 6465 7828 292e 6375 6d73 756d 2829  index().cumsum()
-00009780: 290d 0a23 2020 2020 2023 6466 3d64 662e  )..#     #df=df.
-00009790: 7365 745f 696e 6465 7828 2764 6427 290d  set_index('dd').
-000097a0: 0a23 2020 2020 2023 6466 2e69 6e64 6578  .#     #df.index
-000097b0: 203d 2070 642e 4461 7465 7469 6d65 496e   = pd.DatetimeIn
-000097c0: 6465 7828 6466 2e69 6e64 6578 290d 0a23  dex(df.index)..#
-000097d0: 2020 2020 2064 662e 6464 5f73 7472 203d       df.dd_str =
-000097e0: 2070 642e 4461 7465 7469 6d65 496e 6465   pd.DatetimeInde
-000097f0: 7828 6466 2e64 645f 7374 7229 0d0a 2320  x(df.dd_str)..# 
-00009800: 2020 2020 6466 5b27 6464 5f69 6e74 275d      df['dd_int']
-00009810: 203d 205b 696e 7428 692e 7469 6d65 7374   = [int(i.timest
-00009820: 616d 7028 292a 3130 3030 2920 666f 7220  amp()*1000) for 
-00009830: 6920 696e 2064 662e 6464 5f73 7472 5d0d  i in df.dd_str].
-00009840: 0a23 2020 2020 2069 6d70 6f72 7420 6e75  .#     import nu
-00009850: 6d70 7920 6173 206e 7020 0d0a 2320 2020  mpy as np ..#   
-00009860: 2020 6465 6620 6669 6e64 5f6e 6561 7265    def find_neare
-00009870: 7374 2861 7272 6179 2c20 7661 6c75 6529  st(array, value)
-00009880: 3a0d 0a23 2020 2020 2020 2020 2061 7272  :..#         arr
-00009890: 6179 203d 206e 702e 6173 6172 7261 7928  ay = np.asarray(
-000098a0: 6172 7261 7929 0d0a 2320 2020 2020 2020  array)..#       
-000098b0: 2020 6964 7820 3d20 286e 702e 6162 7328    idx = (np.abs(
-000098c0: 6172 7261 7920 2d20 7661 6c75 6529 292e  array - value)).
-000098d0: 6172 676d 696e 2829 0d0a 2320 2020 2020  argmin()..#     
-000098e0: 2020 2020 7265 7475 726e 2061 7272 6179      return array
-000098f0: 5b69 6478 5d0d 0a23 2020 2020 2073 3d66  [idx]..#     s=f
-00009900: 696e 645f 6e65 6172 6573 7428 6e70 2e61  ind_nearest(np.a
-00009910: 7272 6179 2864 662e 6464 5f69 6e74 292c  rray(df.dd_int),
-00009920: 2073 7461 7274 290d 0a23 2020 2020 2065   start)..#     e
-00009930: 3d66 696e 645f 6e65 6172 6573 7428 6e70  =find_nearest(np
-00009940: 2e61 7272 6179 2864 662e 6464 5f69 6e74  .array(df.dd_int
-00009950: 292c 2065 6e64 290d 0a0d 0a23 2020 2020  ), end)....#    
-00009960: 2073 3d28 6466 5b64 665b 2764 645f 696e   s=(df[df['dd_in
-00009970: 7427 5d3d 3d73 5d2e 696e 6465 7829 0d0a  t']==s].index)..
-00009980: 2320 2020 2020 653d 2864 665b 6466 5b27  #     e=(df[df['
-00009990: 6464 5f69 6e74 275d 3d3d 655d 2e69 6e64  dd_int']==e].ind
-000099a0: 6578 290d 0a0d 0a23 2020 2020 2064 665f  ex)....#     df_
-000099b0: 6669 6c74 6572 3d64 665b 735b 305d 3a65  filter=df[s[0]:e
-000099c0: 5b30 5d5d 0d0a 2320 2020 2020 7072 696e  [0]]..#     prin
-000099d0: 7428 6466 5f66 696c 7465 7229 0d0a 0d0a  t(df_filter)....
-000099e0: 2320 2020 2020 6466 3d64 665f 6669 6c74  #     df=df_filt
-000099f0: 6572 2020 0d0a 2020 2020 0d0a 2320 696d  er  ..    ..# im
-00009a00: 706f 7274 2070 616e 6461 7320 6173 2070  port pandas as p
-00009a10: 640d 0a23 2069 6d70 6f72 7420 6970 7977  d..# import ipyw
-00009a20: 6964 6765 7473 2061 7320 7769 6467 6574  idgets as widget
-00009a30: 730d 0a23 2066 726f 6d20 4950 7974 686f  s..# from IPytho
-00009a40: 6e2e 6469 7370 6c61 7920 696d 706f 7274  n.display import
-00009a50: 2064 6973 706c 6179 0d0a 0d0a 2320 636c   display....# cl
-00009a60: 6173 7320 4461 7465 5261 6e67 6550 6963  ass DateRangePic
-00009a70: 6b65 7228 6f62 6a65 6374 293a 0d0a 2320  ker(object):..# 
-00009a80: 2020 2020 6465 6620 5f5f 696e 6974 5f5f      def __init__
-00009a90: 2873 656c 662c 7374 6172 742c 656e 642c  (self,start,end,
-00009aa0: 6672 6571 3d27 4427 2c66 6d74 3d27 2559  freq='D',fmt='%Y
-00009ab0: 2d25 6d2d 2564 2729 3a0d 0a23 2020 2020  -%m-%d'):..#    
-00009ac0: 2020 2020 2022 2222 0d0a 2320 2020 2020       """..#     
-00009ad0: 2020 2020 5061 7261 6d65 7465 7273 0d0a      Parameters..
-00009ae0: 2320 2020 2020 2020 2020 2d2d 2d2d 2d2d  #         ------
-00009af0: 2d2d 2d2d 0d0a 2320 2020 2020 2020 2020  ----..#         
-00009b00: 7374 6172 7420 3a20 7374 7269 6e67 206f  start : string o
-00009b10: 7220 6461 7465 7469 6d65 2d6c 696b 650d  r datetime-like.
-00009b20: 0a23 2020 2020 2020 2020 2020 2020 204c  .#             L
-00009b30: 6566 7420 626f 756e 6420 6f66 2074 6865  eft bound of the
-00009b40: 2070 6572 696f 640d 0a23 2020 2020 2020   period..#      
-00009b50: 2020 2065 6e64 203a 2073 7472 696e 6720     end : string 
-00009b60: 6f72 2064 6174 6574 696d 652d 6c69 6b65  or datetime-like
-00009b70: 0d0a 2320 2020 2020 2020 2020 2020 2020  ..#             
-00009b80: 4c65 6674 2062 6f75 6e64 206f 6620 7468  Left bound of th
-00009b90: 6520 7065 7269 6f64 0d0a 2320 2020 2020  e period..#     
-00009ba0: 2020 2020 6672 6571 203a 2073 7472 696e      freq : strin
-00009bb0: 6720 6f72 2070 616e 6461 732e 4461 7465  g or pandas.Date
-00009bc0: 4f66 6673 6574 2c20 6465 6661 756c 743d  Offset, default=
-00009bd0: 2744 270d 0a23 2020 2020 2020 2020 2020  'D'..#          
-00009be0: 2020 2046 7265 7175 656e 6379 2073 7472     Frequency str
-00009bf0: 696e 6773 2063 616e 2068 6176 6520 6d75  ings can have mu
-00009c00: 6c74 6970 6c65 732c 2065 2e67 2e20 2735  ltiples, e.g. '5
-00009c10: 4827 200d 0a23 2020 2020 2020 2020 2066  H' ..#         f
-00009c20: 6d74 203a 2073 7472 696e 672c 2064 6566  mt : string, def
-00009c30: 6175 6c79 203d 2027 2559 2d25 6d2d 2564  auly = '%Y-%m-%d
-00009c40: 270d 0a23 2020 2020 2020 2020 2020 2020  '..#            
-00009c50: 2046 6f72 6d61 7420 746f 2075 7365 2074   Format to use t
-00009c60: 6f20 6469 7370 6c61 7920 7468 6520 7365  o display the se
-00009c70: 6c65 6374 6564 2070 6572 696f 640d 0a0d  lected period...
-00009c80: 0a23 2020 2020 2020 2020 2022 2222 0d0a  .#         """..
-00009c90: 2320 2020 2020 2020 2020 7365 6c66 2e64  #         self.d
-00009ca0: 6174 655f 7261 6e67 653d 7064 2e64 6174  ate_range=pd.dat
-00009cb0: 655f 7261 6e67 6528 7374 6172 743d 7374  e_range(start=st
-00009cc0: 6172 742c 656e 643d 656e 642c 6672 6571  art,end=end,freq
-00009cd0: 3d66 7265 7129 0d0a 2320 2020 2020 2020  =freq)..#       
-00009ce0: 2020 6f70 7469 6f6e 7320 3d20 5b28 6974    options = [(it
-00009cf0: 656d 2e73 7472 6674 696d 6528 666d 7429  em.strftime(fmt)
-00009d00: 2c69 7465 6d29 2066 6f72 2069 7465 6d20  ,item) for item 
-00009d10: 696e 2073 656c 662e 6461 7465 5f72 616e  in self.date_ran
-00009d20: 6765 5d0d 0a23 2020 2020 2020 2020 2073  ge]..#         s
-00009d30: 656c 662e 736c 6964 6572 5f73 7461 7274  elf.slider_start
-00009d40: 203d 2077 6964 6765 7473 2e53 656c 6563   = widgets.Selec
-00009d50: 7469 6f6e 536c 6964 6572 280d 0a23 2020  tionSlider(..#  
-00009d60: 2020 2020 2020 2020 2020 2064 6573 6372             descr
-00009d70: 6970 7469 6f6e 3d27 7374 6172 7427 2c0d  iption='start',.
-00009d80: 0a23 2020 2020 2020 2020 2020 2020 206f  .#             o
-00009d90: 7074 696f 6e73 3d6f 7074 696f 6e73 2c0d  ptions=options,.
-00009da0: 0a23 2020 2020 2020 2020 2020 2020 2063  .#             c
-00009db0: 6f6e 7469 6e75 6f75 735f 7570 6461 7465  ontinuous_update
-00009dc0: 3d46 616c 7365 0d0a 2320 2020 2020 2020  =False..#       
-00009dd0: 2020 290d 0a23 2020 2020 2020 2020 2073    )..#         s
-00009de0: 656c 662e 736c 6964 6572 5f65 6e64 203d  elf.slider_end =
-00009df0: 2077 6964 6765 7473 2e53 656c 6563 7469   widgets.Selecti
-00009e00: 6f6e 536c 6964 6572 280d 0a23 2020 2020  onSlider(..#    
-00009e10: 2020 2020 2020 2020 2064 6573 6372 6970           descrip
-00009e20: 7469 6f6e 3d27 656e 6427 2c0d 0a23 2020  tion='end',..#  
-00009e30: 2020 2020 2020 2020 2020 206f 7074 696f             optio
-00009e40: 6e73 3d6f 7074 696f 6e73 2c0d 0a23 2020  ns=options,..#  
-00009e50: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
-00009e60: 6e75 6f75 735f 7570 6461 7465 3d46 616c  nuous_update=Fal
-00009e70: 7365 2c0d 0a23 2020 2020 2020 2020 2020  se,..#          
-00009e80: 2020 2076 616c 7565 3d6f 7074 696f 6e73     value=options
-00009e90: 5b2d 315d 5b31 5d0d 0a23 2020 2020 2020  [-1][1]..#      
-00009ea0: 2020 2029 0d0a 0d0a 2320 2020 2020 2020     )....#       
-00009eb0: 2020 7365 6c66 2e73 6c69 6465 725f 7374    self.slider_st
-00009ec0: 6172 742e 6f6e 5f74 7261 6974 5f63 6861  art.on_trait_cha
-00009ed0: 6e67 6528 7365 6c66 2e73 6c69 6465 725f  nge(self.slider_
-00009ee0: 7374 6172 745f 6368 616e 6765 642c 2027  start_changed, '
-00009ef0: 7661 6c75 6527 290d 0a23 2020 2020 2020  value')..#      
-00009f00: 2020 2073 656c 662e 736c 6964 6572 5f65     self.slider_e
-00009f10: 6e64 2e6f 6e5f 7472 6169 745f 6368 616e  nd.on_trait_chan
-00009f20: 6765 2873 656c 662e 736c 6964 6572 5f65  ge(self.slider_e
-00009f30: 6e64 5f63 6861 6e67 6564 2c20 2776 616c  nd_changed, 'val
-00009f40: 7565 2729 0d0a 0d0a 2320 2020 2020 2020  ue')....#       
-00009f50: 2020 7365 6c66 2e77 6964 6765 7420 3d20    self.widget = 
-00009f60: 7769 6467 6574 732e 426f 7828 6368 696c  widgets.Box(chil
-00009f70: 6472 656e 3d5b 7365 6c66 2e73 6c69 6465  dren=[self.slide
-00009f80: 725f 7374 6172 742c 7365 6c66 2e73 6c69  r_start,self.sli
-00009f90: 6465 725f 656e 645d 290d 0a0d 0a23 2020  der_end])....#  
-00009fa0: 2020 2064 6566 2073 6c69 6465 725f 7374     def slider_st
-00009fb0: 6172 745f 6368 616e 6765 6428 7365 6c66  art_changed(self
-00009fc0: 2c6b 6579 2c76 616c 7565 293a 0d0a 2320  ,key,value):..# 
-00009fd0: 2020 2020 2020 2020 7365 6c66 2e73 6c69          self.sli
-00009fe0: 6465 725f 656e 642e 7661 6c75 653d 6d61  der_end.value=ma
-00009ff0: 7828 7365 6c66 2e73 6c69 6465 725f 7374  x(self.slider_st
-0000a000: 6172 742e 7661 6c75 652c 7365 6c66 2e73  art.value,self.s
-0000a010: 6c69 6465 725f 656e 642e 7661 6c75 6529  lider_end.value)
-0000a020: 0d0a 2320 2020 2020 2020 2020 7365 6c66  ..#         self
-0000a030: 2e5f 6f62 7365 7276 6528 7374 6172 743d  ._observe(start=
-0000a040: 7365 6c66 2e73 6c69 6465 725f 7374 6172  self.slider_star
-0000a050: 742e 7661 6c75 652c 656e 643d 7365 6c66  t.value,end=self
-0000a060: 2e73 6c69 6465 725f 656e 642e 7661 6c75  .slider_end.valu
-0000a070: 6529 0d0a 0d0a 2320 2020 2020 6465 6620  e)....#     def 
-0000a080: 736c 6964 6572 5f65 6e64 5f63 6861 6e67  slider_end_chang
-0000a090: 6564 2873 656c 662c 6b65 792c 7661 6c75  ed(self,key,valu
-0000a0a0: 6529 3a0d 0a23 2020 2020 2020 2020 2073  e):..#         s
-0000a0b0: 656c 662e 736c 6964 6572 5f73 7461 7274  elf.slider_start
-0000a0c0: 2e76 616c 7565 3d6d 696e 2873 656c 662e  .value=min(self.
-0000a0d0: 736c 6964 6572 5f73 7461 7274 2e76 616c  slider_start.val
-0000a0e0: 7565 2c73 656c 662e 736c 6964 6572 5f65  ue,self.slider_e
-0000a0f0: 6e64 2e76 616c 7565 290d 0a23 2020 2020  nd.value)..#    
-0000a100: 2020 2020 2073 656c 662e 5f6f 6273 6572       self._obser
-0000a110: 7665 2873 7461 7274 3d73 656c 662e 736c  ve(start=self.sl
-0000a120: 6964 6572 5f73 7461 7274 2e76 616c 7565  ider_start.value
-0000a130: 2c65 6e64 3d73 656c 662e 736c 6964 6572  ,end=self.slider
-0000a140: 5f65 6e64 2e76 616c 7565 290d 0a0d 0a23  _end.value)....#
-0000a150: 2020 2020 2064 6566 2064 6973 706c 6179       def display
-0000a160: 2873 656c 6629 3a0d 0a23 2020 2020 2020  (self):..#      
-0000a170: 2020 2064 6973 706c 6179 2873 656c 662e     display(self.
-0000a180: 736c 6964 6572 5f73 7461 7274 2c73 656c  slider_start,sel
-0000a190: 662e 736c 6964 6572 5f65 6e64 290d 0a0d  f.slider_end)...
-0000a1a0: 0a23 2020 2020 2064 6566 205f 6f62 7365  .#     def _obse
-0000a1b0: 7276 6528 7365 6c66 2c2a 2a6b 7761 7267  rve(self,**kwarg
-0000a1c0: 7329 3a0d 0a23 2020 2020 2020 2020 2069  s):..#         i
-0000a1d0: 6620 6861 7361 7474 7228 7365 6c66 2c27  f hasattr(self,'
-0000a1e0: 6f62 7365 7276 6527 293a 0d0a 2320 2020  observe'):..#   
-0000a1f0: 2020 2020 2020 2020 2020 7365 6c66 2e6f            self.o
-0000a200: 6273 6572 7665 282a 2a6b 7761 7267 7329  bserve(**kwargs)
-0000a210: 0d0a 0d0a 2320 6465 6620 6663 7428 7374  ....# def fct(st
-0000a220: 6172 742c 656e 6429 3a0d 0a23 2020 2020  art,end):..#    
-0000a230: 2070 7269 6e74 2028 7374 6172 742c 656e   print (start,en
-0000a240: 6429 0d0a 2020 2020 0d0a 2320 2020 2020  d)..    ..#     
-0000a250: 7374 6172 743d 696e 7428 7374 6172 742e  start=int(start.
-0000a260: 7469 6d65 7374 616d 7028 2920 2a20 3130  timestamp() * 10
-0000a270: 3030 290d 0a23 2020 2020 2065 6e64 3d69  00)..#     end=i
-0000a280: 6e74 2865 6e64 2e74 696d 6573 7461 6d70  nt(end.timestamp
-0000a290: 2829 202a 2031 3030 3029 0d0a 0d0a 2320  () * 1000)....# 
-0000a2a0: 2020 2020 6466 3d70 642e 7265 6164 5f63      df=pd.read_c
-0000a2b0: 7376 2827 7465 6d70 322e 6373 7627 290d  sv('temp2.csv').
-0000a2c0: 0a0d 0a23 2020 2020 2064 662e 7265 6e61  ...#     df.rena
-0000a2d0: 6d65 2863 6f6c 756d 6e73 3d7b 2064 662e  me(columns={ df.
-0000a2e0: 636f 6c75 6d6e 735b 305d 3a20 2264 6422  columns[0]: "dd"
-0000a2f0: 207d 2c20 696e 706c 6163 6520 3d20 5472   }, inplace = Tr
-0000a300: 7565 290d 0a23 2020 2020 2064 665b 2764  ue)..#     df['d
-0000a310: 645f 7374 7227 5d3d 6466 5b27 6464 275d  d_str']=df['dd']
-0000a320: 2e61 7374 7970 6528 7374 7229 0d0a 2320  .astype(str)..# 
-0000a330: 2020 2020 6466 5b27 6464 5f73 7472 275d      df['dd_str']
-0000a340: 203d 2064 665b 2764 645f 7374 7227 5d2e   = df['dd_str'].
-0000a350: 6173 7479 7065 2873 7472 290d 0a23 2020  astype(str)..#  
-0000a360: 2020 2064 662e 7265 6e61 6d65 2863 6f6c     df.rename(col
-0000a370: 756d 6e73 3d7b 2064 662e 636f 6c75 6d6e  umns={ df.column
-0000a380: 735b 315d 3a20 2276 616c 2220 7d2c 2069  s[1]: "val" }, i
-0000a390: 6e70 6c61 6365 203d 2054 7275 6529 0d0a  nplace = True)..
-0000a3a0: 2320 2020 2020 6466 5b27 6464 275d 3d20  #     df['dd']= 
-0000a3b0: 7064 2e74 6f5f 6461 7465 7469 6d65 2864  pd.to_datetime(d
-0000a3c0: 665b 2764 6427 5d2e 6173 7479 7065 2873  f['dd'].astype(s
-0000a3d0: 7472 292c 2066 6f72 6d61 743d 2725 592d  tr), format='%Y-
-0000a3e0: 256d 2d25 6427 290d 0a23 2020 2020 2064  %m-%d')..#     d
-0000a3f0: 662e 696e 7365 7274 2864 662e 7368 6170  f.insert(df.shap
-0000a400: 655b 315d 2c0d 0a23 2020 2020 2020 2020  e[1],..#        
-0000a410: 2020 2020 2027 726f 775f 636f 756e 7427       'row_count'
-0000a420: 2c0d 0a23 2020 2020 2020 2020 2020 2020  ,..#            
-0000a430: 2064 662e 696e 6465 782e 7661 6c75 655f   df.index.value_
-0000a440: 636f 756e 7473 2829 2e73 6f72 745f 696e  counts().sort_in
-0000a450: 6465 7828 292e 6375 6d73 756d 2829 290d  dex().cumsum()).
-0000a460: 0a23 2020 2020 2023 6466 3d64 662e 7365  .#     #df=df.se
-0000a470: 745f 696e 6465 7828 2764 6427 290d 0a23  t_index('dd')..#
-0000a480: 2020 2020 2023 6466 2e69 6e64 6578 203d       #df.index =
-0000a490: 2070 642e 4461 7465 7469 6d65 496e 6465   pd.DatetimeInde
-0000a4a0: 7828 6466 2e69 6e64 6578 290d 0a23 2020  x(df.index)..#  
-0000a4b0: 2020 2064 662e 6464 5f73 7472 203d 2070     df.dd_str = p
-0000a4c0: 642e 4461 7465 7469 6d65 496e 6465 7828  d.DatetimeIndex(
-0000a4d0: 6466 2e64 645f 7374 7229 0d0a 2320 2020  df.dd_str)..#   
-0000a4e0: 2020 6466 5b27 6464 5f69 6e74 275d 203d    df['dd_int'] =
-0000a4f0: 205b 696e 7428 692e 7469 6d65 7374 616d   [int(i.timestam
-0000a500: 7028 292a 3130 3030 2920 666f 7220 6920  p()*1000) for i 
-0000a510: 696e 2064 662e 6464 5f73 7472 5d0d 0a23  in df.dd_str]..#
-0000a520: 2020 2020 2069 6d70 6f72 7420 6e75 6d70       import nump
-0000a530: 7920 6173 206e 7020 0d0a 2320 2020 2020  y as np ..#     
-0000a540: 6465 6620 6669 6e64 5f6e 6561 7265 7374  def find_nearest
-0000a550: 2861 7272 6179 2c20 7661 6c75 6529 3a0d  (array, value):.
-0000a560: 0a23 2020 2020 2020 2020 2061 7272 6179  .#         array
-0000a570: 203d 206e 702e 6173 6172 7261 7928 6172   = np.asarray(ar
-0000a580: 7261 7929 0d0a 2320 2020 2020 2020 2020  ray)..#         
-0000a590: 6964 7820 3d20 286e 702e 6162 7328 6172  idx = (np.abs(ar
-0000a5a0: 7261 7920 2d20 7661 6c75 6529 292e 6172  ray - value)).ar
-0000a5b0: 676d 696e 2829 0d0a 2320 2020 2020 2020  gmin()..#       
-0000a5c0: 2020 7265 7475 726e 2061 7272 6179 5b69    return array[i
-0000a5d0: 6478 5d0d 0a23 2020 2020 2073 3d66 696e  dx]..#     s=fin
-0000a5e0: 645f 6e65 6172 6573 7428 6e70 2e61 7272  d_nearest(np.arr
-0000a5f0: 6179 2864 662e 6464 5f69 6e74 292c 2073  ay(df.dd_int), s
-0000a600: 7461 7274 290d 0a23 2020 2020 2065 3d66  tart)..#     e=f
-0000a610: 696e 645f 6e65 6172 6573 7428 6e70 2e61  ind_nearest(np.a
-0000a620: 7272 6179 2864 662e 6464 5f69 6e74 292c  rray(df.dd_int),
-0000a630: 2065 6e64 290d 0a0d 0a23 2020 2020 2073   end)....#     s
-0000a640: 3d28 6466 5b64 665b 2764 645f 696e 7427  =(df[df['dd_int'
-0000a650: 5d3d 3d73 5d2e 696e 6465 7829 0d0a 2320  ]==s].index)..# 
-0000a660: 2020 2020 653d 2864 665b 6466 5b27 6464      e=(df[df['dd
-0000a670: 5f69 6e74 275d 3d3d 655d 2e69 6e64 6578  _int']==e].index
-0000a680: 290d 0a0d 0a23 2020 2020 2064 665f 6669  )....#     df_fi
-0000a690: 6c74 6572 3d64 665b 735b 305d 3a65 5b30  lter=df[s[0]:e[0
-0000a6a0: 5d5d 0d0a 2320 2020 2020 7072 696e 7428  ]]..#     print(
-0000a6b0: 6466 5f66 696c 7465 7229 0d0a 2320 2020  df_filter)..#   
-0000a6c0: 2020 7265 7475 726e 2028 7374 6172 742c    return (start,
-0000a6d0: 2065 6e64 290d 0a20 2020 200d 0a23 2077   end)..    ..# w
-0000a6e0: 3d44 6174 6552 616e 6765 5069 636b 6572  =DateRangePicker
-0000a6f0: 2873 7461 7274 3d27 3230 3232 2d30 382d  (start='2022-08-
-0000a700: 3032 272c 656e 643d 2232 3032 322d 3039  02',end="2022-09
-0000a710: 2d30 3222 2c66 7265 713d 2744 272c 666d  -02",freq='D',fm
-0000a720: 743d 2725 592d 256d 2d25 6427 290d 0a23  t='%Y-%m-%d')..#
-0000a730: 2077 2e6f 6273 6572 7665 3d66 6374 0d0a   w.observe=fct..
-0000a740: 2320 772e 6469 7370 6c61 7928 290d 0a0d  # w.display()...
-0000a750: 0a23 2023 613d 6663 745b 305d 0d0a 2320  .# #a=fct[0]..# 
-0000a760: 7072 696e 7428 772e 6f62 7365 7276 655b  print(w.observe[
-0000a770: 305d 290d 0a0d 0a23 2323 2323 2323 2323  0])....#########
-0000a780: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000a790: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000a7a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000a7b0: 2323 230d 0a0d 0a0d 0a64 6566 2061 6b68  ###......def akh
-0000a7c0: 6465 666f 5f66 6974 506c 616e 6528 6465  defo_fitPlane(de
-0000a7d0: 6d5f 6461 7461 3d27 272c 206c 696e 655f  m_data='', line_
-0000a7e0: 7368 6170 6566 696c 653d 4e6f 6e65 202c  shapefile=None ,
-0000a7f0: 206f 7574 5f70 6c61 6e65 466f 6c64 6572   out_planeFolder
-0000a800: 3d27 506c 616e 6573 5f6f 7574 2729 3a0d  ='Planes_out'):.
-0000a810: 0a20 2020 2022 2222 0d0a 2020 2020 4669  .    """..    Fi
-0000a820: 7420 706c 616e 6573 2074 6f20 706f 696e  t planes to poin
-0000a830: 7473 2069 6e20 6120 4469 6769 7461 6c20  ts in a Digital 
-0000a840: 456c 6576 6174 696f 6e20 4d6f 6465 6c20  Elevation Model 
-0000a850: 2844 454d 2920 616e 6420 7669 7375 616c  (DEM) and visual
-0000a860: 697a 6520 7468 6520 7265 7375 6c74 732e  ize the results.
-0000a870: 0d0a 0d0a 2020 2020 5061 7261 6d65 7465  ....    Paramete
-0000a880: 7273 3a0d 0a20 2020 2020 2020 202d 2064  rs:..        - d
-0000a890: 656d 5f64 6174 6120 2873 7472 293a 2050  em_data (str): P
-0000a8a0: 6174 6820 746f 2074 6865 2044 454d 2064  ath to the DEM d
-0000a8b0: 6174 6120 6669 6c65 2028 4765 6f54 4946  ata file (GeoTIF
-0000a8c0: 4620 666f 726d 6174 292e 0d0a 2020 2020  F format)...    
-0000a8d0: 2020 2020 2d20 6c69 6e65 5f73 6861 7065      - line_shape
-0000a8e0: 6669 6c65 2028 7374 7229 3a20 5061 7468  file (str): Path
-0000a8f0: 2074 6f20 7468 6520 7368 6170 6566 696c   to the shapefil
-0000a900: 6520 636f 6e74 6169 6e69 6e67 206c 696e  e containing lin
-0000a910: 6520 6665 6174 7572 6573 2072 6570 7265  e features repre
-0000a920: 7365 6e74 696e 6720 706c 616e 6573 2e0d  senting planes..
-0000a930: 0a20 2020 2020 2020 202d 206f 7574 5f70  .        - out_p
-0000a940: 6c61 6e65 466f 6c64 6572 2028 7374 7229  laneFolder (str)
-0000a950: 3a20 5061 7468 2074 6f20 7468 6520 666f  : Path to the fo
-0000a960: 6c64 6572 2077 6865 7265 2074 6865 206f  lder where the o
-0000a970: 7574 7075 7420 706c 616e 6520 6461 7461  utput plane data
-0000a980: 2077 696c 6c20 6265 2073 6176 6564 2e0d   will be saved..
-0000a990: 0a0d 0a20 2020 2048 6f77 2049 7420 576f  ...    How It Wo
-0000a9a0: 726b 733a 0d0a 2020 2020 2020 2020 5468  rks:..        Th
-0000a9b0: 6973 2066 756e 6374 696f 6e20 7265 6164  is function read
-0000a9c0: 7320 6120 4445 4d20 616e 6420 7368 6170  s a DEM and shap
-0000a9d0: 6566 696c 652c 2061 6c6c 6f77 7320 7468  efile, allows th
-0000a9e0: 6520 7573 6572 2074 6f20 696e 7465 7261  e user to intera
-0000a9f0: 6374 6976 656c 7920 7365 6c65 6374 2070  ctively select p
-0000aa00: 6f69 6e74 7320 6672 6f6d 2074 6865 2044  oints from the D
-0000aa10: 454d 2c0d 0a20 2020 2020 2020 2066 6974  EM,..        fit
-0000aa20: 7320 706c 616e 6573 2074 6f20 7468 6520  s planes to the 
-0000aa30: 7365 6c65 6374 6564 2070 6f69 6e74 732c  selected points,
-0000aa40: 2061 6e64 2076 6973 7561 6c69 7a65 7320   and visualizes 
-0000aa50: 7468 6520 7265 7375 6c74 7320 696e 2032  the results in 2
-0000aa60: 4420 616e 6420 3344 2070 6c6f 7473 2e20  D and 3D plots. 
-0000aa70: 4974 2061 6c73 6f20 7072 6f76 6964 6573  It also provides
-0000aa80: 206f 7074 696f 6e73 0d0a 2020 2020 2020   options..      
-0000aa90: 2020 746f 2073 6176 6520 7468 6520 6669    to save the fi
-0000aaa0: 7474 6564 2070 6c61 6e65 7320 6173 2058  tted planes as X
-0000aab0: 595a 2061 6e64 2044 5846 2066 696c 6573  YZ and DXF files
-0000aac0: 2e20 6164 6469 7469 6f6e 616c 6c79 2070  . additionally p
-0000aad0: 6c6f 7473 2070 6f6c 6573 2074 6f20 706c  lots poles to pl
-0000aae0: 616e 6573 206f 6e20 706f 6c61 7220 6772  anes on polar gr
-0000aaf0: 6964 2061 6e64 2072 6f73 6520 6469 6167  id and rose diag
-0000ab00: 7261 6d20 666f 7220 7374 7269 6b65 2f74  ram for strike/t
-0000ab10: 7265 6e64 7320 6f66 2070 6c61 6e65 730d  rends of planes.
-0000ab20: 0a0d 0a20 2020 204e 6f74 653a 0d0a 2020  ...    Note:..  
-0000ab30: 2020 2020 2020 2d20 5468 6520 6675 6e63        - The func
-0000ab40: 7469 6f6e 2075 7469 6c69 7a65 7320 7661  tion utilizes va
-0000ab50: 7269 6f75 7320 6c69 6272 6172 6965 7320  rious libraries 
-0000ab60: 7375 6368 2061 7320 6e75 6d70 792c 206d  such as numpy, m
-0000ab70: 6174 706c 6f74 6c69 622c 2074 6b69 6e74  atplotlib, tkint
-0000ab80: 6572 2c20 6f73 6765 6f20 2847 4441 4c29  er, osgeo (GDAL)
-0000ab90: 2c20 616e 6420 6765 6f70 616e 6461 732e  , and geopandas.
-0000aba0: 0d0a 2020 2020 2020 2020 2d20 456e 7375  ..        - Ensu
-0000abb0: 7265 2074 6861 7420 7468 6520 7265 7175  re that the requ
-0000abc0: 6972 6564 206c 6962 7261 7269 6573 2061  ired libraries a
-0000abd0: 6e64 2064 6570 656e 6465 6e63 6965 7320  nd dependencies 
-0000abe0: 6172 6520 696e 7374 616c 6c65 6420 746f  are installed to
-0000abf0: 2075 7365 2074 6869 7320 6675 6e63 7469   use this functi
-0000ac00: 6f6e 2065 6666 6563 7469 7665 6c79 2e0d  on effectively..
-0000ac10: 0a0d 0a20 2020 2045 7861 6d70 6c65 2055  ...    Example U
-0000ac20: 7361 6765 3a0d 0a20 2020 2020 2020 2061  sage:..        a
-0000ac30: 6b68 6465 666f 5f66 6974 506c 616e 6528  khdefo_fitPlane(
-0000ac40: 6465 6d5f 6461 7461 3d27 7061 7468 2f74  dem_data='path/t
-0000ac50: 6f2f 6465 6d2e 7469 6627 2c6c 696e 655f  o/dem.tif',line_
-0000ac60: 7368 6170 6566 696c 653d 2770 6174 682f  shapefile='path/
-0000ac70: 746f 2f6c 696e 6573 2e73 6870 272c 6f75  to/lines.shp',ou
-0000ac80: 745f 706c 616e 6546 6f6c 6465 723d 276f  t_planeFolder='o
-0000ac90: 7574 7075 742f 666f 6c64 6572 2729 0d0a  utput/folder')..
-0000aca0: 2020 2020 2020 2020 0d0a 2020 2020 2222          ..    ""
-0000acb0: 220d 0a20 2020 200d 0a20 2020 2067 6c6f  "..    ..    glo
-0000acc0: 6261 6c20 6469 705f 616e 676c 655f 6c69  bal dip_angle_li
-0000acd0: 7374 2c20 6469 705f 6469 7265 6374 696f  st, dip_directio
-0000ace0: 6e5f 6c69 7374 202c 2066 6967 315f 636d  n_list , fig1_cm
-0000acf0: 6170 2c20 706c 616e 655f 636f 6c6f 7273  ap, plane_colors
-0000ad00: 0d0a 2020 2020 0d0a 2020 2020 6469 705f  ..    ..    dip_
-0000ad10: 616e 676c 655f 6c69 7374 3d5b 5d0d 0a20  angle_list=[].. 
-0000ad20: 2020 2064 6970 5f64 6972 6563 7469 6f6e     dip_direction
-0000ad30: 5f6c 6973 743d 5b5d 0d0a 2020 2020 706c  _list=[]..    pl
-0000ad40: 616e 655f 636f 6c6f 7273 3d5b 5d0d 0a20  ane_colors=[].. 
-0000ad50: 2020 200d 0a20 2020 2023 2064 6566 2063     ..    # def c
-0000ad60: 6d61 705f 706c 6f74 2870 6c61 6e65 5f63  map_plot(plane_c
-0000ad70: 6f6c 6f72 732c 2020 6c61 6265 6c3d 2743  olors,  label='C
-0000ad80: 6f6c 6f72 2729 3a0d 0a20 2020 2020 2020  olor'):..       
-0000ad90: 200d 0a20 2020 2023 2020 2020 2066 726f   ..    #     fro
-0000ada0: 6d20 6d61 7470 6c6f 746c 6962 2e63 6f6c  m matplotlib.col
-0000adb0: 6f72 7320 696d 706f 7274 204c 6973 7465  ors import Liste
-0000adc0: 6443 6f6c 6f72 6d61 700d 0a20 2020 2023  dColormap..    #
-0000add0: 2020 2020 2069 6d70 6f72 7420 6e75 6d70       import nump
-0000ade0: 7920 6173 206e 700d 0a20 2020 2023 2020  y as np..    #  
-0000adf0: 2020 2074 7279 3a0d 0a20 2020 2023 2020     try:..    #  
-0000ae00: 2020 2020 2020 2063 6d61 7020 3d20 4c69         cmap = Li
-0000ae10: 7374 6564 436f 6c6f 726d 6170 2870 6c61  stedColormap(pla
-0000ae20: 6e65 5f63 6f6c 6f72 7329 0d0a 2020 2020  ne_colors)..    
-0000ae30: 2320 2020 2020 2020 2020 6669 672c 2061  #         fig, a
-0000ae40: 7820 3d20 706c 742e 7375 6270 6c6f 7473  x = plt.subplots
-0000ae50: 2866 6967 7369 7a65 3d28 362c 2031 2929  (figsize=(6, 1))
-0000ae60: 0d0a 2020 2020 2320 2020 2020 2020 2020  ..    #         
-0000ae70: 6669 672e 7375 6270 6c6f 7473 5f61 646a  fig.subplots_adj
-0000ae80: 7573 7428 626f 7474 6f6d 3d30 2e35 290d  ust(bottom=0.5).
-0000ae90: 0a20 2020 2023 2020 2020 2020 2020 2063  .    #         c
-0000aea0: 6261 7220 3d20 706c 742e 636f 6c6f 7262  bar = plt.colorb
-0000aeb0: 6172 2870 6c74 2e63 6d2e 5363 616c 6172  ar(plt.cm.Scalar
-0000aec0: 4d61 7070 6162 6c65 2863 6d61 703d 636d  Mappable(cmap=cm
-0000aed0: 6170 292c 2063 6178 3d61 782c 206f 7269  ap), cax=ax, ori
-0000aee0: 656e 7461 7469 6f6e 3d27 686f 7269 7a6f  entation='horizo
-0000aef0: 6e74 616c 2729 0d0a 2020 2020 2320 2020  ntal')..    #   
-0000af00: 2020 2020 2020 6362 6172 2e73 6574 5f6c        cbar.set_l
-0000af10: 6162 656c 286c 6162 656c 290d 0a20 2020  abel(label)..   
-0000af20: 2023 2020 2020 2020 2020 2070 6c74 2e73   #         plt.s
-0000af30: 686f 7728 290d 0a20 2020 2023 2020 2020  how()..    #    
-0000af40: 2065 7863 6570 7420 4578 6365 7074 696f   except Exceptio
-0000af50: 6e20 6173 2065 783a 0d0a 2020 2020 2320  n as ex:..    # 
-0000af60: 2020 2020 2020 2020 7072 696e 7428 2222          print(""
-0000af70: 290d 0a20 2020 2020 2020 200d 0a20 2020  )..        ..   
-0000af80: 2023 2020 2020 2072 6574 7572 6e20 6669   #     return fi
-0000af90: 670d 0a20 2020 200d 0a20 2020 2069 6d70  g..    ..    imp
-0000afa0: 6f72 7420 6f73 0d0a 2020 2020 696d 706f  ort os..    impo
-0000afb0: 7274 206e 756d 7079 2061 7320 6e70 0d0a  rt numpy as np..
-0000afc0: 2020 2020 696d 706f 7274 206d 6174 706c      import matpl
-0000afd0: 6f74 6c69 622e 7079 706c 6f74 2061 7320  otlib.pyplot as 
-0000afe0: 706c 740d 0a20 2020 2066 726f 6d20 6f73  plt..    from os
-0000aff0: 6765 6f20 696d 706f 7274 2067 6461 6c0d  geo import gdal.
-0000b000: 0a20 2020 2069 6d70 6f72 7420 746b 696e  .    import tkin
-0000b010: 7465 7220 6173 2074 6b0d 0a20 2020 2066  ter as tk..    f
-0000b020: 726f 6d20 746b 696e 7465 7220 696d 706f  rom tkinter impo
-0000b030: 7274 2074 746b 0d0a 2020 2020 6672 6f6d  rt ttk..    from
-0000b040: 206d 6174 706c 6f74 6c69 622e 6261 636b   matplotlib.back
-0000b050: 656e 6473 2e62 6163 6b65 6e64 5f74 6b61  ends.backend_tka
-0000b060: 6767 2069 6d70 6f72 7420 4669 6775 7265  gg import Figure
-0000b070: 4361 6e76 6173 546b 4167 670d 0a20 2020  CanvasTkAgg..   
-0000b080: 2066 726f 6d20 6d61 7470 6c6f 746c 6962   from matplotlib
-0000b090: 2e63 6f6c 6f72 7320 696d 706f 7274 204c  .colors import L
-0000b0a0: 6967 6874 536f 7572 6365 0d0a 2020 2020  ightSource..    
-0000b0b0: 696d 706f 7274 2065 6172 7468 7079 2e73  import earthpy.s
-0000b0c0: 7061 7469 616c 2061 7320 6573 0d0a 2020  patial as es..  
-0000b0d0: 2020 696d 706f 7274 2067 656f 7061 6e64    import geopand
-0000b0e0: 6173 2061 7320 6770 640d 0a20 2020 2069  as as gpd..    i
-0000b0f0: 6d70 6f72 7420 7261 6e64 6f6d 0d0a 2020  mport random..  
-0000b100: 2020 6672 6f6d 206d 6174 706c 6f74 6c69    from matplotli
-0000b110: 622e 6261 636b 656e 6473 2e62 6163 6b65  b.backends.backe
-0000b120: 6e64 5f74 6b61 6767 2069 6d70 6f72 7420  nd_tkagg import 
-0000b130: 4e61 7669 6761 7469 6f6e 546f 6f6c 6261  NavigationToolba
-0000b140: 7232 546b 0d0a 2020 2020 6672 6f6d 2073  r2Tk..    from s
-0000b150: 6861 7065 6c79 2e67 656f 6d65 7472 7920  hapely.geometry 
-0000b160: 696d 706f 7274 204c 696e 6553 7472 696e  import LineStrin
-0000b170: 670d 0a20 2020 200d 0a20 2020 200d 0a20  g..    ..    .. 
-0000b180: 2020 2069 6620 6e6f 7420 6f73 2e70 6174     if not os.pat
-0000b190: 682e 6578 6973 7473 286f 7574 5f70 6c61  h.exists(out_pla
-0000b1a0: 6e65 466f 6c64 6572 293a 0d0a 2020 2020  neFolder):..    
-0000b1b0: 2020 2020 6f73 2e6d 616b 6564 6972 7328      os.makedirs(
-0000b1c0: 6f75 745f 706c 616e 6546 6f6c 6465 7229  out_planeFolder)
-0000b1d0: 0d0a 2020 2020 0d0a 2020 2020 6465 6620  ..    ..    def 
-0000b1e0: 636f 6c6f 725f 6672 6f6d 5f64 6970 5f61  color_from_dip_a
-0000b1f0: 6e64 5f64 6972 6563 7469 6f6e 2864 6970  nd_direction(dip
-0000b200: 2c20 6469 7265 6374 696f 6e29 3a0d 0a20  , direction):.. 
-0000b210: 2020 2020 2020 2063 6d61 705f 6469 7020         cmap_dip 
-0000b220: 3d20 706c 742e 6765 745f 636d 6170 2827  = plt.get_cmap('
-0000b230: 6873 7627 290d 0a20 2020 2020 2020 2063  hsv')..        c
-0000b240: 6d61 705f 6469 7265 6374 696f 6e20 3d20  map_direction = 
-0000b250: 706c 742e 6765 745f 636d 6170 2827 6873  plt.get_cmap('hs
-0000b260: 7627 290d 0a0d 0a20 2020 2020 2020 2063  v')....        c
-0000b270: 6f6c 5f64 6970 203d 2063 6d61 705f 6469  ol_dip = cmap_di
-0000b280: 7028 6469 7020 2f20 3930 2e30 290d 0a20  p(dip / 90.0).. 
-0000b290: 2020 2020 2020 2063 6f6c 5f64 6972 6563         col_direc
-0000b2a0: 7469 6f6e 203d 2063 6d61 705f 6469 7265  tion = cmap_dire
-0000b2b0: 6374 696f 6e28 6469 7265 6374 696f 6e20  ction(direction 
-0000b2c0: 2f20 3336 302e 3029 0d0a 0d0a 2020 2020  / 360.0)....    
-0000b2d0: 2020 2020 636f 6c6f 7220 3d20 5b30 2e35      color = [0.5
-0000b2e0: 2a28 636f 6c5f 6469 705b 695d 202b 2063  *(col_dip[i] + c
-0000b2f0: 6f6c 5f64 6972 6563 7469 6f6e 5b69 5d29  ol_direction[i])
-0000b300: 2066 6f72 2069 2069 6e20 7261 6e67 6528   for i in range(
-0000b310: 3329 5d0d 0a20 2020 200d 0a20 2020 2020  3)]..    ..     
-0000b320: 2020 2072 6574 7572 6e20 636f 6c6f 720d     return color.
-0000b330: 0a0d 0a20 2020 2064 6566 2072 616e 646f  ...    def rando
-0000b340: 6d5f 636f 6c6f 7228 293a 0d0a 2020 2020  m_color():..    
-0000b350: 2020 2020 2222 2247 656e 6572 6174 6520      """Generate 
-0000b360: 6120 7261 6e64 6f6d 2063 6f6c 6f72 2e22  a random color."
-0000b370: 2222 0d0a 2020 2020 2020 2020 7265 7475  ""..        retu
-0000b380: 726e 2028 7261 6e64 6f6d 2e75 6e69 666f  rn (random.unifo
-0000b390: 726d 2830 2c20 3129 2c20 7261 6e64 6f6d  rm(0, 1), random
-0000b3a0: 2e75 6e69 666f 726d 2830 2c20 3129 2c20  .uniform(0, 1), 
-0000b3b0: 7261 6e64 6f6d 2e75 6e69 666f 726d 2830  random.uniform(0
-0000b3c0: 2c20 3129 290d 0a0d 0a20 2020 2064 6566  , 1))....    def
-0000b3d0: 2072 6561 645f 6465 6d28 6465 6d5f 6669   read_dem(dem_fi
-0000b3e0: 6c65 293a 0d0a 2020 2020 2020 2020 6473  le):..        ds
-0000b3f0: 203d 2067 6461 6c2e 4f70 656e 2864 656d   = gdal.Open(dem
-0000b400: 5f66 696c 6529 0d0a 2020 2020 2020 2020  _file)..        
-0000b410: 6461 7461 203d 2064 732e 5265 6164 4173  data = ds.ReadAs
-0000b420: 4172 7261 7928 290d 0a20 2020 2020 2020  Array()..       
-0000b430: 2074 7261 6e73 666f 726d 203d 2064 732e   transform = ds.
-0000b440: 4765 7447 656f 5472 616e 7366 6f72 6d28  GetGeoTransform(
-0000b450: 290d 0a20 2020 2020 2020 2070 726f 6a65  )..        proje
-0000b460: 6374 696f 6e20 3d20 6473 2e47 6574 5072  ction = ds.GetPr
-0000b470: 6f6a 6563 7469 6f6e 2829 0d0a 2020 2020  ojection()..    
-0000b480: 2020 2020 6473 203d 204e 6f6e 6520 2023      ds = None  #
-0000b490: 2043 6c6f 7365 2074 6865 2064 6174 6173   Close the datas
-0000b4a0: 6574 0d0a 2020 2020 2020 2020 7265 7475  et..        retu
-0000b4b0: 726e 2064 6174 612c 2074 7261 6e73 666f  rn data, transfo
-0000b4c0: 726d 2c20 7072 6f6a 6563 7469 6f6e 0d0a  rm, projection..
-0000b4d0: 2020 2020 0d0a 2020 2020 6461 7461 2c20      ..    data, 
-0000b4e0: 7472 616e 7366 6f72 6d2c 2070 726f 6a65  transform, proje
-0000b4f0: 6374 696f 6e20 3d20 7265 6164 5f64 656d  ction = read_dem
-0000b500: 2864 656d 5f64 6174 6129 0d0a 2020 2020  (dem_data)..    
-0000b510: 0d0a 2020 2020 696d 706f 7274 206d 6174  ..    import mat
-0000b520: 680d 0a0d 0a20 2020 2064 6566 2063 616c  h....    def cal
-0000b530: 6375 6c61 7465 5f64 6970 5f61 6e67 6c65  culate_dip_angle
-0000b540: 5f61 6e64 5f64 6972 6563 7469 6f6e 2841  _and_direction(A
-0000b550: 2c20 4229 3a0d 0a20 2020 2020 2020 2023  , B):..        #
-0000b560: 2043 616c 6375 6c61 7465 2074 6865 2064   Calculate the d
-0000b570: 6970 2061 6e67 6c65 2028 696e 636c 696e  ip angle (inclin
-0000b580: 6174 696f 6e29 0d0a 2020 2020 2020 2020  ation)..        
-0000b590: 6469 705f 616e 676c 6520 3d20 6d61 7468  dip_angle = math
-0000b5a0: 2e64 6567 7265 6573 286d 6174 682e 6174  .degrees(math.at
-0000b5b0: 616e 286d 6174 682e 7371 7274 2841 2a2a  an(math.sqrt(A**
-0000b5c0: 3220 2b20 422a 2a32 2929 290d 0a20 2020  2 + B**2)))..   
-0000b5d0: 2020 2020 0d0a 2020 2020 2020 2020 0d0a      ..        ..
-0000b5e0: 2020 2020 2020 2020 2320 4361 6c63 756c          # Calcul
-0000b5f0: 6174 6520 7468 6520 6469 7020 6469 7265  ate the dip dire
-0000b600: 6374 696f 6e20 2861 7a69 6d75 7468 290d  ction (azimuth).
-0000b610: 0a20 2020 2020 2020 2064 6970 5f64 6972  .        dip_dir
-0000b620: 6563 7469 6f6e 203d 206d 6174 682e 6465  ection = math.de
-0000b630: 6772 6565 7328 6d61 7468 2e61 7461 6e32  grees(math.atan2
-0000b640: 282d 422c 202d 4129 290d 0a20 2020 2020  (-B, -A))..     
-0000b650: 2020 200d 0a20 2020 2020 2020 2023 2045     ..        # E
-0000b660: 6e73 7572 6520 6469 705f 6469 7265 6374  nsure dip_direct
-0000b670: 696f 6e20 6973 2069 6e20 7468 6520 7261  ion is in the ra
-0000b680: 6e67 6520 5b30 2c20 3336 3029 0d0a 2020  nge [0, 360)..  
-0000b690: 2020 2020 2020 6469 705f 6469 7265 6374        dip_direct
-0000b6a0: 696f 6e20 3d20 2864 6970 5f64 6972 6563  ion = (dip_direc
-0000b6b0: 7469 6f6e 202b 2039 3029 2025 2033 3630  tion + 90) % 360
-0000b6c0: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
-0000b6d0: 2020 2020 7265 7475 726e 2064 6970 5f61      return dip_a
-0000b6e0: 6e67 6c65 2c20 6469 705f 6469 7265 6374  ngle, dip_direct
-0000b6f0: 696f 6e0d 0a20 2020 200d 0a20 2020 2064  ion..    ..    d
-0000b700: 6566 2066 6974 5f70 6c61 6e65 2870 6f69  ef fit_plane(poi
-0000b710: 6e74 732c 2078 782c 2079 7929 3a0d 0a20  nts, xx, yy):.. 
-0000b720: 2020 2020 2020 206d 696e 5f72 616e 6765         min_range
-0000b730: 203d 206e 702e 6e61 6e6d 696e 2864 6174   = np.nanmin(dat
-0000b740: 6129 0d0a 2020 2020 2020 2020 6d61 785f  a)..        max_
-0000b750: 7261 6e67 6520 3d20 6e70 2e6e 616e 6d61  range = np.nanma
-0000b760: 7828 6461 7461 290d 0a20 2020 2020 2020  x(data)..       
-0000b770: 200d 0a20 2020 2020 2020 2023 2078 7820   ..        # xx 
-0000b780: 3d20 2878 7820 2d20 6e70 2e6e 616e 6d69  = (xx - np.nanmi
-0000b790: 6e28 7878 2929 202f 2028 6e70 2e6e 616e  n(xx)) / (np.nan
-0000b7a0: 6d61 7828 7878 2920 2d20 6e70 2e6e 616e  max(xx) - np.nan
-0000b7b0: 6d69 6e28 7878 2929 0d0a 2020 2020 2020  min(xx))..      
-0000b7c0: 2020 2320 7878 203d 2078 7820 2a20 286d    # xx = xx * (m
-0000b7d0: 6178 5f72 616e 6765 202d 206d 696e 5f72  ax_range - min_r
-0000b7e0: 616e 6765 2920 2b20 6d69 6e5f 7261 6e67  ange) + min_rang
-0000b7f0: 650d 0a20 2020 2020 2020 200d 0a20 2020  e..        ..   
-0000b800: 2020 2020 2023 2079 7920 3d20 2879 7920       # yy = (yy 
-0000b810: 2d20 6e70 2e6e 616e 6d69 6e28 7979 2929  - np.nanmin(yy))
-0000b820: 202f 2028 6e70 2e6e 616e 6d61 7828 7979   / (np.nanmax(yy
-0000b830: 2920 2d20 6e70 2e6e 616e 6d69 6e28 7979  ) - np.nanmin(yy
-0000b840: 2929 0d0a 2020 2020 2020 2020 2320 7979  ))..        # yy
-0000b850: 203d 2079 7920 2a20 286d 6178 5f72 616e   = yy * (max_ran
-0000b860: 6765 202d 206d 696e 5f72 616e 6765 2920  ge - min_range) 
-0000b870: 2b20 6d69 6e5f 7261 6e67 650d 0a20 2020  + min_range..   
-0000b880: 2020 2020 200d 0a20 2020 2020 2020 2078       ..        x
-0000b890: 5f76 616c 732c 2079 5f76 616c 732c 207a  _vals, y_vals, z
-0000b8a0: 5f76 616c 7320 3d20 7a69 7028 2a70 6f69  _vals = zip(*poi
-0000b8b0: 6e74 7329 0d0a 2020 2020 0d0a 2020 2020  nts)..    ..    
-0000b8c0: 2020 2020 4120 3d20 6e70 2e76 7374 6163      A = np.vstac
-0000b8d0: 6b28 5b78 5f76 616c 732c 2079 5f76 616c  k([x_vals, y_val
-0000b8e0: 732c 206e 702e 6f6e 6573 286c 656e 2878  s, np.ones(len(x
-0000b8f0: 5f76 616c 7329 295d 292e 540d 0a20 2020  _vals))]).T..   
-0000b900: 2020 2020 2061 2c20 622c 2063 203d 206e       a, b, c = n
-0000b910: 702e 6c69 6e61 6c67 2e6c 7374 7371 2841  p.linalg.lstsq(A
-0000b920: 2c20 7a5f 7661 6c73 2c20 7263 6f6e 643d  , z_vals, rcond=
-0000b930: 4e6f 6e65 295b 305d 0d0a 2020 2020 2020  None)[0]..      
-0000b940: 2020 0d0a 2020 2020 2020 2020 7072 696e    ..        prin
-0000b950: 7428 6622 506c 616e 6520 6571 7561 7469  t(f"Plane equati
-0000b960: 6f6e 3a20 7a20 3d20 7b61 7d78 202b 207b  on: z = {a}x + {
-0000b970: 627d 7920 2b20 7b63 7d22 2920 2023 2044  b}y + {c}")  # D
-0000b980: 6562 7567 6769 6e67 206c 696e 650d 0a20  ebugging line.. 
-0000b990: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
-0000b9a0: 207a 7a20 3d20 6120 2a20 7878 202b 2062   zz = a * xx + b
-0000b9b0: 202a 2079 7920 2b20 630d 0a20 2020 2020   * yy + c..     
-0000b9c0: 2020 2023 2323 2323 2323 2323 2323 2323     #############
-0000b9d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0000b9e0: 2323 2323 230d 0a20 2020 2020 2020 2023  #####..        #
-0000b9f0: 2070 6f69 6e74 7320 3d20 6e70 2e61 7272   points = np.arr
-0000ba00: 6179 2870 6f69 6e74 7329 200d 0a20 2020  ay(points) ..   
-0000ba10: 2020 2020 2023 2023 2043 6f6d 7075 7465       # # Compute
-0000ba20: 2074 6865 2063 656e 7472 6f69 6420 6f66   the centroid of
-0000ba30: 2074 6865 2070 6f69 6e74 730d 0a20 2020   the points..   
-0000ba40: 2020 2020 2023 2063 656e 7472 6f69 6420       # centroid 
-0000ba50: 3d20 6e70 2e6d 6561 6e28 706f 696e 7473  = np.mean(points
-0000ba60: 2c20 6178 6973 3d30 290d 0a0d 0a20 2020  , axis=0)....   
-0000ba70: 2020 2020 2023 2023 2053 7562 7472 6163       # # Subtrac
-0000ba80: 7420 7468 6520 6365 6e74 726f 6964 2066  t the centroid f
-0000ba90: 726f 6d20 7468 6520 706f 696e 7473 2074  rom the points t
-0000baa0: 6f20 6365 6e74 6572 2074 6865 6d0d 0a20  o center them.. 
-0000bab0: 2020 2020 2020 2023 2063 656e 7465 7265         # centere
-0000bac0: 645f 706f 696e 7473 203d 2070 6f69 6e74  d_points = point
-0000bad0: 7320 2d20 6365 6e74 726f 6964 0d0a 0d0a  s - centroid....
-0000bae0: 2020 2020 2020 2020 2320 2320 5065 7266          # # Perf
-0000baf0: 6f72 6d20 5356 4420 6f6e 2074 6865 2063  orm SVD on the c
-0000bb00: 656e 7465 7265 6420 706f 696e 7473 0d0a  entered points..
-0000bb10: 2020 2020 2020 2020 2320 552c 2053 2c20          # U, S, 
-0000bb20: 5674 203d 206e 702e 6c69 6e61 6c67 2e73  Vt = np.linalg.s
-0000bb30: 7664 2863 656e 7465 7265 645f 706f 696e  vd(centered_poin
-0000bb40: 7473 290d 0a0d 0a20 2020 2020 2020 2023  ts)....        #
-0000bb50: 2023 2054 6865 206e 6f72 6d61 6c20 7665   # The normal ve
-0000bb60: 6374 6f72 206f 6620 7468 6520 706c 616e  ctor of the plan
-0000bb70: 6520 6973 2074 6865 206c 6173 7420 726f  e is the last ro
-0000bb80: 7720 6f66 2056 740d 0a20 2020 2020 2020  w of Vt..       
-0000bb90: 2023 206e 6f72 6d61 6c5f 7665 6374 6f72   # normal_vector
-0000bba0: 203d 2056 745b 2d31 2c20 3a5d 0d0a 0d0a   = Vt[-1, :]....
-0000bbb0: 2020 2020 2020 2020 2320 2320 4e6f 726d          # # Norm
-0000bbc0: 616c 697a 6520 7468 6520 6e6f 726d 616c  alize the normal
-0000bbd0: 2076 6563 746f 720d 0a20 2020 2020 2020   vector..       
-0000bbe0: 2023 206e 6f72 6d61 6c5f 7665 6374 6f72   # normal_vector
-0000bbf0: 202f 3d20 6e70 2e6c 696e 616c 672e 6e6f   /= np.linalg.no
-0000bc00: 726d 286e 6f72 6d61 6c5f 7665 6374 6f72  rm(normal_vector
-0000bc10: 290d 0a0d 0a20 2020 2020 2020 2023 2023  )....        # #
-0000bc20: 2054 6865 2065 7175 6174 696f 6e20 6f66   The equation of
-0000bc30: 2074 6865 2070 6c61 6e65 2069 733a 2061   the plane is: a
-0000bc40: 7820 2b20 6279 202b 2063 7a20 2b20 6420  x + by + cz + d 
-0000bc50: 3d20 302c 2077 6865 7265 205b 612c 2062  = 0, where [a, b
-0000bc60: 2c20 635d 2069 7320 7468 6520 6e6f 726d  , c] is the norm
-0000bc70: 616c 2076 6563 746f 720d 0a20 2020 2020  al vector..     
-0000bc80: 2020 2023 2061 2c20 622c 2063 203d 206e     # a, b, c = n
-0000bc90: 6f72 6d61 6c5f 7665 6374 6f72 0d0a 0d0a  ormal_vector....
-0000bca0: 2020 2020 2020 2020 2320 2320 4361 6c63          # # Calc
-0000bcb0: 756c 6174 6520 6420 7573 696e 6720 7468  ulate d using th
-0000bcc0: 6520 706c 616e 6520 6571 7561 7469 6f6e  e plane equation
-0000bcd0: 2061 6e64 2074 6865 2063 656e 7472 6f69   and the centroi
-0000bce0: 640d 0a20 2020 2020 2020 2023 2064 203d  d..        # d =
-0000bcf0: 202d 6e70 2e64 6f74 286e 6f72 6d61 6c5f   -np.dot(normal_
-0000bd00: 7665 6374 6f72 2c20 6365 6e74 726f 6964  vector, centroid
-0000bd10: 290d 0a20 2020 2020 2020 2023 207a 7a20  )..        # zz 
-0000bd20: 3d20 282d 6120 2a20 7878 202d 2062 202a  = (-a * xx - b *
-0000bd30: 2079 7920 2d20 6429 202f 2063 2020 2320   yy - d) / c  # 
-0000bd40: 536f 6c76 6520 666f 7220 7a0d 0a20 2020  Solve for z..   
-0000bd50: 2020 2020 200d 0a20 2020 2020 2020 0d0a       ..       ..
-0000bd60: 2020 2020 2020 2020 6469 705f 616e 676c          dip_angl
-0000bd70: 652c 2064 6970 5f64 6972 6563 7469 6f6e  e, dip_direction
-0000bd80: 203d 2063 616c 6375 6c61 7465 5f64 6970   = calculate_dip
-0000bd90: 5f61 6e67 6c65 5f61 6e64 5f64 6972 6563  _angle_and_direc
-0000bda0: 7469 6f6e 2861 2c20 6229 0d0a 0d0a 2020  tion(a, b)....  
-0000bdb0: 2020 2020 2020 7072 696e 7428 6622 4469        print(f"Di
-0000bdc0: 7020 416e 676c 6520 2849 6e63 6c69 6e61  p Angle (Inclina
-0000bdd0: 7469 6f6e 293a 207b 6469 705f 616e 676c  tion): {dip_angl
-0000bde0: 657d 2064 6567 7265 6573 2229 0d0a 2020  e} degrees")..  
-0000bdf0: 2020 2020 2020 7072 696e 7428 6622 4469        print(f"Di
-0000be00: 7020 4469 7265 6374 696f 6e20 2841 7a69  p Direction (Azi
-0000be10: 6d75 7468 293a 207b 6469 705f 6469 7265  muth): {dip_dire
-0000be20: 6374 696f 6e7d 2064 6567 7265 6573 2229  ction} degrees")
-0000be30: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
-0000be40: 2020 2020 0d0a 2020 2020 2020 2020 0d0a      ..        ..
-0000be50: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
-0000be60: 200d 0a20 2020 2020 2020 2023 2020 2320   ..        #  # 
-0000be70: 436c 6970 2074 6865 2076 616c 7565 7320  Clip the values 
-0000be80: 746f 2074 6865 2064 6573 6972 6564 2072  to the desired r
-0000be90: 616e 6765 0d0a 2020 2020 2020 2020 237a  ange..        #z
-0000bea0: 7a20 3d20 6e70 2e63 6c69 7028 7a7a 2c20  z = np.clip(zz, 
-0000beb0: 6d69 6e5f 7261 6e67 652c 206d 6178 5f72  min_range, max_r
-0000bec0: 616e 6765 290d 0a20 2020 2020 2020 200d  ange)..        .
-0000bed0: 0a20 2020 2020 2020 207a 7a5b 7a7a 203c  .        zz[zz <
-0000bee0: 206d 696e 5f72 616e 6765 5d20 3d20 6e70   min_range] = np
-0000bef0: 2e6e 616e 0d0a 2020 2020 2020 2020 7a7a  .nan..        zz
-0000bf00: 5b7a 7a20 3e20 6d61 785f 7261 6e67 655d  [zz > max_range]
-0000bf10: 203d 206e 702e 6e61 6e0d 0a20 2020 2020   = np.nan..     
-0000bf20: 2020 0d0a 2020 2020 2020 200d 0a20 2020    ..       ..   
-0000bf30: 2020 2020 2023 2023 2044 6566 696e 6520       # # Define 
-0000bf40: 7468 6520 6465 7369 7265 6420 7261 6e67  the desired rang
-0000bf50: 6520 6261 7365 6420 6f6e 2079 6f75 7220  e based on your 
-0000bf60: 2764 6174 6127 0d0a 2020 2020 2020 2020  'data'..        
-0000bf70: 2320 6966 206c 696d 6974 5f65 7874 656e  # if limit_exten
-0000bf80: 643d 3d46 616c 7365 3a0d 0a20 2020 2020  d==False:..     
-0000bf90: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
-0000bfa0: 2320 2320 2320 2320 4e6f 726d 616c 697a  # # # # Normaliz
-0000bfb0: 6520 277a 7a27 2074 6f20 6d61 7463 6820  e 'zz' to match 
-0000bfc0: 7468 6520 276d 696e 5f72 616e 6765 2720  the 'min_range' 
-0000bfd0: 616e 6420 276d 6178 5f72 616e 6765 2720  and 'max_range' 
-0000bfe0: 6f66 2027 6461 7461 270d 0a20 2020 2020  of 'data'..     
-0000bff0: 2020 2023 207a 7a20 3d20 287a 7a20 2d20     # zz = (zz - 
-0000c000: 6e70 2e6e 616e 6d69 6e28 7a7a 2929 202f  np.nanmin(zz)) /
-0000c010: 2028 6e70 2e6e 616e 6d61 7828 7a7a 2920   (np.nanmax(zz) 
-0000c020: 2d20 6e70 2e6e 616e 6d69 6e28 7a7a 2929  - np.nanmin(zz))
-0000c030: 0d0a 2020 2020 2020 2020 2320 7a7a 203d  ..        # zz =
-0000c040: 207a 7a20 2a20 286d 6178 5f72 616e 6765   zz * (max_range
-0000c050: 202d 206d 696e 5f72 616e 6765 2920 2b20   - min_range) + 
-0000c060: 6d69 6e5f 7261 6e67 650d 0a20 2020 2020  min_range..     
-0000c070: 2020 200d 0a20 2020 2020 2020 2020 2020     ..           
-0000c080: 2020 2020 0d0a 2020 2020 2020 2020 2320      ..        # 
-0000c090: 7072 696e 7428 7a7a 2e73 6861 7065 290d  print(zz.shape).
-0000c0a0: 0a20 2020 2020 2020 2023 2070 7269 6e74  .        # print
-0000c0b0: 287a 7a29 0d0a 2020 2020 2020 2020 7265  (zz)..        re
-0000c0c0: 7475 726e 207a 7a2c 2061 2c20 622c 2063  turn zz, a, b, c
-0000c0d0: 2c20 6469 705f 616e 676c 652c 2064 6970  , dip_angle, dip
-0000c0e0: 5f64 6972 6563 7469 6f6e 0d0a 2020 2020  _direction..    
-0000c0f0: 0d0a 2020 200d 0a20 2020 0d0a 2020 200d  ..   ..   ..   .
-0000c100: 0a0d 0a20 2020 2064 6566 206f 6e63 6c69  ...    def oncli
-0000c110: 636b 2865 7665 6e74 2c20 706f 696e 7473  ck(event, points
-0000c120: 2c20 6461 7461 2c20 7472 616e 7366 6f72  , data, transfor
-0000c130: 6d29 3a0d 0a20 2020 2020 2020 2078 2c20  m):..        x, 
-0000c140: 7920 3d20 6576 656e 742e 7864 6174 612c  y = event.xdata,
-0000c150: 2065 7665 6e74 2e79 6461 7461 0d0a 2020   event.ydata..  
-0000c160: 2020 2020 2020 636f 6c20 3d20 696e 7428        col = int(
-0000c170: 2878 202d 2074 7261 6e73 666f 726d 5b30  (x - transform[0
-0000c180: 5d29 202f 2074 7261 6e73 666f 726d 5b31  ]) / transform[1
-0000c190: 5d29 0d0a 2020 2020 2020 2020 726f 7720  ])..        row 
-0000c1a0: 3d20 696e 7428 2879 202d 2074 7261 6e73  = int((y - trans
-0000c1b0: 666f 726d 5b33 5d29 202f 2074 7261 6e73  form[3]) / trans
-0000c1c0: 666f 726d 5b35 5d29 0d0a 0d0a 2020 2020  form[5])....    
-0000c1d0: 2020 2020 6966 2030 203c 3d20 636f 6c20      if 0 <= col 
-0000c1e0: 3c20 6461 7461 2e73 6861 7065 5b31 5d20  < data.shape[1] 
-0000c1f0: 616e 6420 3020 3c3d 2072 6f77 203c 2064  and 0 <= row < d
-0000c200: 6174 612e 7368 6170 655b 305d 3a0d 0a20  ata.shape[0]:.. 
-0000c210: 2020 2020 2020 2020 2020 207a 203d 2064             z = d
-0000c220: 6174 615b 726f 772c 2063 6f6c 5d0d 0a20  ata[row, col].. 
-0000c230: 2020 2020 2020 2020 2020 2070 6f69 6e74             point
-0000c240: 732e 6170 7065 6e64 285b 782c 2079 2c20  s.append([x, y, 
-0000c250: 7a5d 290d 0a20 2020 2020 2020 2020 2020  z])..           
-0000c260: 2061 785f 3264 2e70 6c6f 7428 782c 2079   ax_2d.plot(x, y
-0000c270: 2c20 276f 272c 2063 6f6c 6f72 3d27 626c  , 'o', color='bl
-0000c280: 6163 6b27 290d 0a20 2020 2020 2020 2020  ack')..         
-0000c290: 2020 2063 616e 7661 735f 3264 2e64 7261     canvas_2d.dra
-0000c2a0: 7728 290d 0a0d 0a20 2020 2020 2020 2020  w()....         
-0000c2b0: 2020 2070 6f69 6e74 5f73 7472 203d 2066     point_str = f
-0000c2c0: 2278 3d7b 783a 2e32 667d 2c20 793d 7b79  "x={x:.2f}, y={y
-0000c2d0: 3a2e 3266 7d2c 207a 3d7b 7a3a 2e32 667d  :.2f}, z={z:.2f}
-0000c2e0: 220d 0a20 2020 2020 2020 2020 2020 2070  "..            p
-0000c2f0: 6f69 6e74 735f 6c69 7374 626f 782e 696e  oints_listbox.in
-0000c300: 7365 7274 2874 6b2e 454e 442c 2070 6f69  sert(tk.END, poi
-0000c310: 6e74 5f73 7472 290d 0a0d 0a20 2020 2064  nt_str)....    d
-0000c320: 6566 206f 6e5f 706f 696e 745f 646f 7562  ef on_point_doub
-0000c330: 6c65 5f63 6c69 636b 2865 7665 6e74 293a  le_click(event):
-0000c340: 0d0a 2020 2020 2020 2020 676c 6f62 616c  ..        global
-0000c350: 2070 6f69 6e74 732c 2061 785f 3264 2c20   points, ax_2d, 
-0000c360: 706f 696e 7473 5f6c 6973 7462 6f78 2c20  points_listbox, 
-0000c370: 6873 0d0a 2020 2020 2020 2020 6964 7820  hs..        idx 
-0000c380: 3d20 706f 696e 7473 5f6c 6973 7462 6f78  = points_listbox
-0000c390: 2e63 7572 7365 6c65 6374 696f 6e28 295b  .curselection()[
-0000c3a0: 305d 2020 2320 496e 6465 7820 6f66 2073  0]  # Index of s
-0000c3b0: 656c 6563 7465 6420 706f 696e 7420 696e  elected point in
-0000c3c0: 2074 6865 206c 6973 7462 6f78 0d0a 2020   the listbox..  
-0000c3d0: 2020 2020 2020 706f 696e 7420 3d20 706f        point = po
-0000c3e0: 696e 7473 5b69 6478 5d0d 0a20 2020 2020  ints[idx]..     
-0000c3f0: 2020 200d 0a20 2020 2020 2020 2023 2052     ..        # R
-0000c400: 656d 6f76 6520 7468 6520 706f 696e 7420  emove the point 
-0000c410: 6672 6f6d 206f 7572 2064 6174 610d 0a20  from our data.. 
-0000c420: 2020 2020 2020 2070 6f69 6e74 732e 706f         points.po
-0000c430: 7028 6964 7829 0d0a 2020 2020 2020 2020  p(idx)..        
-0000c440: 706f 696e 7473 5f6c 6973 7462 6f78 2e64  points_listbox.d
-0000c450: 656c 6574 6528 6964 7829 0d0a 0d0a 2020  elete(idx)....  
-0000c460: 2020 2020 2020 2320 4964 656e 7469 6679        # Identify
-0000c470: 2061 6e64 2072 656d 6f76 6520 7468 6520   and remove the 
-0000c480: 636f 7272 6573 706f 6e64 696e 6720 706f  corresponding po
-0000c490: 696e 7420 6672 6f6d 2074 6865 2061 785f  int from the ax_
-0000c4a0: 3264 2070 6c6f 740d 0a20 2020 2020 2020  2d plot..       
-0000c4b0: 2066 6f72 206c 696e 6520 696e 2061 785f   for line in ax_
-0000c4c0: 3264 2e6c 696e 6573 3a0d 0a20 2020 2020  2d.lines:..     
-0000c4d0: 2020 2020 2020 2078 6461 7461 2c20 7964         xdata, yd
-0000c4e0: 6174 6120 3d20 6c69 6e65 2e67 6574 5f78  ata = line.get_x
-0000c4f0: 6461 7461 2829 2c20 6c69 6e65 2e67 6574  data(), line.get
-0000c500: 5f79 6461 7461 2829 0d0a 2020 2020 2020  _ydata()..      
-0000c510: 2020 2020 2020 6966 2078 6461 7461 5b30        if xdata[0
-0000c520: 5d20 3d3d 2070 6f69 6e74 5b30 5d20 616e  ] == point[0] an
-0000c530: 6420 7964 6174 615b 305d 203d 3d20 706f  d ydata[0] == po
-0000c540: 696e 745b 315d 3a0d 0a20 2020 2020 2020  int[1]:..       
-0000c550: 2020 2020 2020 2020 206c 696e 652e 7265           line.re
-0000c560: 6d6f 7665 2829 0d0a 2020 2020 2020 2020  move()..        
-0000c570: 2020 2020 2020 2020 6272 6561 6b0d 0a0d          break...
-0000c580: 0a20 2020 2020 2020 2063 616e 7661 735f  .        canvas_
-0000c590: 3264 2e64 7261 7728 290d 0a20 2020 2020  2d.draw()..     
-0000c5a0: 2020 200d 0a20 2020 2020 2020 200d 0a20     ..        .. 
-0000c5b0: 2020 200d 0a20 2020 200d 0a20 2020 2064     ..    ..    d
-0000c5c0: 6566 2070 6c6f 745f 706c 616e 6573 2864  ef plot_planes(d
-0000c5d0: 6970 5f6c 6973 742c 2061 7a69 6d75 7468  ip_list, azimuth
-0000c5e0: 5f6c 6973 742c 2072 6762 5f63 6f6c 6f72  _list, rgb_color
-0000c5f0: 732c 206f 7574 5f70 6c61 6e65 466f 6c64  s, out_planeFold
-0000c600: 6572 3d6f 7574 5f70 6c61 6e65 466f 6c64  er=out_planeFold
-0000c610: 6572 293a 0d0a 2020 2020 2020 2020 2366  er):..        #f
-0000c620: 726f 6d20 6d70 6c73 7465 7265 6f6e 6574  rom mplstereonet
-0000c630: 2069 6d70 6f72 7420 5374 6572 656f 6e65   import Stereone
-0000c640: 7441 7865 730d 0a20 2020 2020 2020 2020  tAxes..         
-0000c650: 2320 4372 6561 7465 2061 2073 7465 7265  # Create a stere
-0000c660: 6f20 6e65 7420 706c 6f74 0d0a 2020 2020  o net plot..    
-0000c670: 2020 2020 6669 6720 3d20 706c 742e 6669      fig = plt.fi
-0000c680: 6775 7265 2866 6967 7369 7a65 3d28 3130  gure(figsize=(10
-0000c690: 2c20 3130 292c 2064 7069 3d33 3030 290d  , 10), dpi=300).
-0000c6a0: 0a20 2020 2020 2020 2023 6178 203d 2066  .        #ax = f
-0000c6b0: 6967 2e61 6464 5f73 7562 706c 6f74 2831  ig.add_subplot(1
-0000c6c0: 3231 2c20 7072 6f6a 6563 7469 6f6e 3d27  21, projection='
-0000c6d0: 7374 6572 656f 6e65 7427 290d 0a20 2020  stereonet')..   
-0000c6e0: 2020 2020 2061 783d 6669 672e 6164 645f       ax=fig.add_
-0000c6f0: 7375 6270 6c6f 7428 3132 312c 2070 6f6c  subplot(121, pol
-0000c700: 6172 3d54 7275 6529 0d0a 0d0a 2020 2020  ar=True)....    
-0000c710: 2020 2020 666f 7220 6469 705f 616e 676c      for dip_angl
-0000c720: 6573 2c20 6469 705f 6469 7265 6374 696f  es, dip_directio
-0000c730: 6e73 2c20 636f 6c6f 7220 696e 207a 6970  ns, color in zip
-0000c740: 2864 6970 5f6c 6973 742c 2061 7a69 6d75  (dip_list, azimu
-0000c750: 7468 5f6c 6973 742c 2072 6762 5f63 6f6c  th_list, rgb_col
-0000c760: 6f72 7329 3a0d 0a20 2020 2020 2020 2020  ors):..         
-0000c770: 2020 2023 2043 6f6e 7665 7274 2064 6970     # Convert dip
-0000c780: 2064 6972 6563 7469 6f6e 7320 616e 6420   directions and 
-0000c790: 6469 7020 616e 676c 6573 2074 6f20 7261  dip angles to ra
-0000c7a0: 6469 616e 730d 0a20 2020 2020 2020 2020  dians..         
-0000c7b0: 2020 2023 6469 705f 6469 7265 6374 696f     #dip_directio
-0000c7c0: 6e73 203d 2028 6469 705f 6469 7265 6374  ns = (dip_direct
-0000c7d0: 696f 6e73 202b 2039 3029 2025 2033 3630  ions + 90) % 360
-0000c7e0: 2023 636f 6e76 6572 7465 6420 6469 7020   #converted dip 
-0000c7f0: 6469 7265 6374 696f 6e20 746f 2073 7472  direction to str
-0000c800: 696b 650d 0a20 2020 2020 2020 2020 2020  ike..           
-0000c810: 2064 6970 5f61 6e67 6c65 7320 3d20 2839   dip_angles = (9
-0000c820: 3020 2d20 6e70 2e61 7272 6179 2864 6970  0 - np.array(dip
-0000c830: 5f61 6e67 6c65 7329 2920 2023 2043 6f6e  _angles))  # Con
-0000c840: 7665 7274 2064 6970 2061 6e67 6c65 7320  vert dip angles 
-0000c850: 746f 2063 6f6d 706c 656d 656e 7461 7279  to complementary
-0000c860: 2061 6e67 6c65 730d 0a20 2020 2020 2020   angles..       
-0000c870: 2020 2020 2020 2320 436f 6e76 6572 7420        # Convert 
-0000c880: 6469 7020 617a 696d 7574 6873 2074 6f20  dip azimuths to 
-0000c890: 7261 6469 616e 730d 0a20 2020 2020 2020  radians..       
-0000c8a0: 2020 2020 2064 6970 5f61 7a69 6d75 7468       dip_azimuth
-0000c8b0: 735f 7261 6420 3d20 6e70 2e72 6164 6961  s_rad = np.radia
-0000c8c0: 6e73 2864 6970 5f64 6972 6563 7469 6f6e  ns(dip_direction
-0000c8d0: 7329 0d0a 2020 2020 2020 2020 2020 2020  s)..            
-0000c8e0: 2320 506c 6f74 2074 6865 2070 6f6c 6573  # Plot the poles
-0000c8f0: 206f 6620 706c 616e 6573 2061 7320 646f   of planes as do
-0000c900: 7473 0d0a 2020 2020 2020 2020 2020 2020  ts..            
-0000c910: 6178 2e73 6361 7474 6572 2864 6970 5f61  ax.scatter(dip_a
-0000c920: 7a69 6d75 7468 735f 7261 642c 2064 6970  zimuths_rad, dip
-0000c930: 5f61 6e67 6c65 732c 2063 6f6c 6f72 3d63  _angles, color=c
-0000c940: 6f6c 6f72 2920 2020 0d0a 0d0a 2020 2020  olor)   ....    
-0000c950: 2020 2020 6178 2e67 7269 6428 5472 7565      ax.grid(True
-0000c960: 290d 0a20 2020 2020 2020 2061 782e 7365  )..        ax.se
-0000c970: 745f 7468 6574 615f 7a65 726f 5f6c 6f63  t_theta_zero_loc
-0000c980: 6174 696f 6e28 274e 2729 2020 2320 5365  ation('N')  # Se
-0000c990: 7420 3020 6465 6772 6565 7320 6174 2074  t 0 degrees at t
-0000c9a0: 6865 2074 6f70 0d0a 2020 2020 2020 2020  he top..        
-0000c9b0: 6178 2e73 6574 5f74 6865 7461 5f64 6972  ax.set_theta_dir
-0000c9c0: 6563 7469 6f6e 282d 3129 2020 2320 5265  ection(-1)  # Re
-0000c9d0: 7665 7273 6520 7468 6520 6469 7265 6374  verse the direct
-0000c9e0: 696f 6e20 6f66 2074 6865 2061 6e67 6c65  ion of the angle
-0000c9f0: 730d 0a0d 0a20 2020 2020 2020 2023 2053  s....        # S
-0000ca00: 6574 206c 6162 656c 7320 666f 7220 6361  et labels for ca
-0000ca10: 7264 696e 616c 2064 6972 6563 7469 6f6e  rdinal direction
-0000ca20: 730d 0a20 2020 2020 2020 2061 782e 7365  s..        ax.se
-0000ca30: 745f 7874 6963 6b73 286e 702e 7261 6469  t_xticks(np.radi
-0000ca40: 616e 7328 5b30 2c20 3435 2c20 3930 2c20  ans([0, 45, 90, 
-0000ca50: 3133 352c 2031 3830 2c20 3232 352c 2032  135, 180, 225, 2
-0000ca60: 3730 2c20 3331 355d 2929 0d0a 2020 2020  70, 315]))..    
-0000ca70: 2020 2020 6178 2e73 6574 5f78 7469 636b      ax.set_xtick
-0000ca80: 6c61 6265 6c73 285b 274e 272c 2027 4e45  labels(['N', 'NE
-0000ca90: 272c 2027 4527 2c20 2753 4527 2c20 2753  ', 'E', 'SE', 'S
-0000caa0: 272c 2027 5357 272c 2027 5727 2c20 274e  ', 'SW', 'W', 'N
-0000cab0: 5727 5d29 0d0a 0d0a 2020 2020 2020 2020  W'])....        
-0000cac0: 2320 5365 7420 7468 6520 7261 6469 616c  # Set the radial
-0000cad0: 2067 7269 6420 616e 6420 6c61 6265 6c73   grid and labels
-0000cae0: 0d0a 2020 2020 2020 2020 6178 2e73 6574  ..        ax.set
-0000caf0: 5f72 6c61 6265 6c5f 706f 7369 7469 6f6e  _rlabel_position
-0000cb00: 2839 3029 0d0a 2020 2020 2020 2020 6178  (90)..        ax
-0000cb10: 2e73 6574 5f79 7469 636b 7328 5b31 352c  .set_yticks([15,
-0000cb20: 2033 302c 2034 352c 2036 302c 2037 355d   30, 45, 60, 75]
-0000cb30: 290d 0a20 2020 2020 2020 2061 782e 7365  )..        ax.se
-0000cb40: 745f 726d 6178 2839 3029 2020 2320 5365  t_rmax(90)  # Se
-0000cb50: 7420 7468 6520 6d61 7869 6d75 6d20 7261  t the maximum ra
-0000cb60: 6469 616c 2064 6973 7461 6e63 650d 0a20  dial distance.. 
-0000cb70: 2020 2020 2020 2061 782e 7365 745f 7469         ax.set_ti
-0000cb80: 746c 6528 2250 6f6c 6573 2074 6f20 506c  tle("Poles to Pl
-0000cb90: 616e 6573 2229 0d0a 2020 2020 2020 2020  anes")..        
-0000cba0: 2320 4375 7374 6f6d 697a 6520 7469 636b  # Customize tick
-0000cbb0: 206d 6172 6b73 202d 2073 7065 6369 6679   marks - specify
-0000cbc0: 2061 6e67 6c65 7320 696e 2072 6164 6961   angles in radia
-0000cbd0: 6e73 0d0a 2020 2020 2020 2020 2320 6178  ns..        # ax
-0000cbe0: 2e73 6574 5f78 7469 636b 7328 6e70 2e72  .set_xticks(np.r
-0000cbf0: 6164 6961 6e73 2872 616e 6765 2830 2c20  adians(range(0, 
-0000cc00: 3336 302c 2031 3029 2929 2020 2320 3130  360, 10)))  # 10
-0000cc10: 2d64 6567 7265 6520 696e 7465 7276 616c  -degree interval
-0000cc20: 730d 0a20 2020 2020 2020 2023 2061 782e  s..        # ax.
-0000cc30: 7365 745f 7974 6963 6b73 286e 702e 7261  set_yticks(np.ra
-0000cc40: 6469 616e 7328 7261 6e67 6528 2d39 302c  dians(range(-90,
-0000cc50: 2039 302c 2031 3029 2929 0d0a 0d0a 2020   90, 10)))....  
-0000cc60: 2020 2020 2020 7374 7269 6b65 733d 5b5d        strikes=[]
-0000cc70: 0d0a 2020 2020 2020 2020 616c 6c5f 636f  ..        all_co
-0000cc80: 6c6f 7273 3d5b 5d0d 0a20 2020 2020 2020  lors=[]..       
-0000cc90: 2066 6f72 2064 6970 5f61 6e67 6c65 732c   for dip_angles,
-0000cca0: 2064 6970 5f64 6972 6563 7469 6f6e 732c   dip_directions,
-0000ccb0: 2063 6f6c 6f72 2069 6e20 7a69 7028 6469   color in zip(di
-0000ccc0: 705f 6c69 7374 2c20 617a 696d 7574 685f  p_list, azimuth_
-0000ccd0: 6c69 7374 2c20 7267 625f 636f 6c6f 7273  list, rgb_colors
-0000cce0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-0000ccf0: 6469 705f 617a 696d 7574 6873 5f72 6164  dip_azimuths_rad
-0000cd00: 203d 206e 702e 7261 6469 616e 7328 6469   = np.radians(di
-0000cd10: 705f 6469 7265 6374 696f 6e73 290d 0a20  p_directions).. 
-0000cd20: 2020 2020 2020 2020 2020 2023 6469 705f             #dip_
-0000cd30: 6469 7265 6374 696f 6e73 203d 2028 6469  directions = (di
-0000cd40: 705f 6469 7265 6374 696f 6e73 202b 2039  p_directions + 9
-0000cd50: 3029 2025 2033 3630 0d0a 2020 2020 2020  0) % 360..      
-0000cd60: 2020 2020 2020 6469 705f 616e 676c 6573        dip_angles
-0000cd70: 203d 2028 3930 202d 206e 702e 6172 7261   = (90 - np.arra
-0000cd80: 7928 6469 705f 616e 676c 6573 2929 2020  y(dip_angles))  
-0000cd90: 2320 436f 6e76 6572 7420 6469 7020 616e  # Convert dip an
-0000cda0: 676c 6573 2074 6f20 636f 6d70 6c65 6d65  gles to compleme
-0000cdb0: 6e74 6172 7920 616e 676c 6573 0d0a 2020  ntary angles..  
-0000cdc0: 2020 2020 2020 2020 2020 7374 7269 6b65            strike
-0000cdd0: 732e 6170 7065 6e64 2828 6469 705f 617a  s.append((dip_az
-0000cde0: 696d 7574 6873 5f72 6164 202b 2039 3029  imuths_rad + 90)
-0000cdf0: 2025 2033 3630 290d 0a20 2020 2020 2020   % 360)..       
-0000ce00: 2020 2020 2061 6c6c 5f63 6f6c 6f72 732e       all_colors.
-0000ce10: 6170 7065 6e64 2863 6f6c 6f72 290d 0a20  append(color).. 
-0000ce20: 2020 2020 2020 200d 0a0d 0a20 2020 2020         ....     
-0000ce30: 2020 2020 2320 4361 6c63 756c 6174 6520      # Calculate 
-0000ce40: 7468 6520 6e75 6d62 6572 206f 6620 6269  the number of bi
-0000ce50: 6e73 2075 7369 6e67 2053 636f 7474 2773  ns using Scott's
-0000ce60: 2052 756c 650d 0a20 2020 2020 2020 206e   Rule..        n
-0000ce70: 203d 206c 656e 2873 7472 696b 6573 290d   = len(strikes).
-0000ce80: 0a0d 0a20 2020 2020 2020 2023 2043 616c  ...        # Cal
-0000ce90: 6375 6c61 7465 2074 6865 2073 7461 6e64  culate the stand
-0000cea0: 6172 6420 6465 7669 6174 696f 6e20 6f66  ard deviation of
-0000ceb0: 2074 6865 2064 6174 610d 0a20 2020 2020   the data..     
-0000cec0: 2020 2073 7464 5f64 6576 203d 206e 702e     std_dev = np.
-0000ced0: 7374 6428 7374 7269 6b65 7329 0d0a 0d0a  std(strikes)....
-0000cee0: 2020 2020 2020 2020 2320 4361 6c63 756c          # Calcul
-0000cef0: 6174 6520 7468 6520 6269 6e20 7769 6474  ate the bin widt
-0000cf00: 6820 7573 696e 6720 5363 6f74 7427 7320  h using Scott's 
-0000cf10: 5275 6c65 2066 6f72 6d75 6c61 2c20 656e  Rule formula, en
-0000cf20: 7375 7269 6e67 2069 7427 7320 6e6f 7420  suring it's not 
-0000cf30: 7a65 726f 0d0a 2020 2020 2020 2020 6966  zero..        if
-0000cf40: 2073 7464 5f64 6576 2021 3d20 303a 0d0a   std_dev != 0:..
-0000cf50: 2020 2020 2020 2020 2020 2020 6269 6e5f              bin_
-0000cf60: 7769 6474 6820 3d20 302e 3520 2a20 7374  width = 0.5 * st
-0000cf70: 645f 6465 7620 2f20 286e 2a2a 2831 2f33  d_dev / (n**(1/3
-0000cf80: 2929 2020 2320 5363 6f74 7427 7320 5275  ))  # Scott's Ru
-0000cf90: 6c65 2066 6f72 6d75 6c61 0d0a 2020 2020  le formula..    
-0000cfa0: 2020 2020 2020 2020 6e75 6d5f 6269 6e73          num_bins
-0000cfb0: 203d 206d 6178 2869 6e74 2828 6d61 7828   = max(int((max(
-0000cfc0: 7374 7269 6b65 7329 202d 206d 696e 2873  strikes) - min(s
-0000cfd0: 7472 696b 6573 2929 202f 2062 696e 5f77  trikes)) / bin_w
-0000cfe0: 6964 7468 292c 2031 2920 2023 2045 6e73  idth), 1)  # Ens
-0000cff0: 7572 6520 6e75 6d5f 6269 6e73 2069 7320  ure num_bins is 
-0000d000: 6174 206c 6561 7374 2031 0d0a 2020 2020  at least 1..    
-0000d010: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
-0000d020: 2020 2020 2020 206e 756d 5f62 696e 7320         num_bins 
-0000d030: 3d20 3132 2020 2320 4120 6465 6661 756c  = 12  # A defaul
-0000d040: 7420 6e75 6d62 6572 206f 6620 6269 6e73  t number of bins
-0000d050: 2069 6620 7374 645f 6465 7620 6973 207a   if std_dev is z
-0000d060: 6572 6f0d 0a20 2020 2020 2020 2023 2043  ero..        # C
-0000d070: 7265 6174 6520 6120 726f 7365 2064 6961  reate a rose dia
-0000d080: 6772 616d 2028 6369 7263 756c 6172 2068  gram (circular h
-0000d090: 6973 746f 6772 616d 290d 0a20 2020 2020  istogram)..     
-0000d0a0: 2020 2061 785f 726f 7365 203d 2066 6967     ax_rose = fig
-0000d0b0: 2e61 6464 5f73 7562 706c 6f74 2831 3232  .add_subplot(122
-0000d0c0: 2c20 706f 6c61 723d 5472 7565 290d 0a0d  , polar=True)...
-0000d0d0: 0a20 2020 2020 2020 2066 6f72 2064 6970  .        for dip
-0000d0e0: 2c20 7374 7269 6b65 2c20 636f 6c6f 722c  , strike, color,
-0000d0f0: 2061 7a20 696e 207a 6970 2864 6970 5f6c   az in zip(dip_l
-0000d100: 6973 742c 2073 7472 696b 6573 2c20 616c  ist, strikes, al
-0000d110: 6c5f 636f 6c6f 7273 2c20 617a 696d 7574  l_colors, azimut
-0000d120: 685f 6c69 7374 293a 0d0a 2020 2020 2020  h_list):..      
-0000d130: 2020 2020 2020 2320 436f 6e76 6572 7420        # Convert 
-0000d140: 6469 7020 617a 696d 7574 6873 2074 6f20  dip azimuths to 
-0000d150: 7261 6469 616e 730d 0a20 2020 2020 2020  radians..       
-0000d160: 2020 2020 2064 6970 5f61 7a69 6d75 7468       dip_azimuth
-0000d170: 735f 7261 6420 3d20 6e70 2e72 6164 6961  s_rad = np.radia
-0000d180: 6e73 2861 7a29 0d0a 2020 2020 2020 2020  ns(az)..        
-0000d190: 2020 2020 6469 705f 616e 676c 6573 203d      dip_angles =
-0000d1a0: 2028 3930 202d 206e 702e 6172 7261 7928   (90 - np.array(
-0000d1b0: 6469 705f 616e 676c 6573 2929 2020 2320  dip_angles))  # 
-0000d1c0: 436f 6e76 6572 7420 6469 7020 616e 676c  Convert dip angl
-0000d1d0: 6573 2074 6f20 636f 6d70 6c65 6d65 6e74  es to complement
-0000d1e0: 6172 7920 616e 676c 6573 0d0a 2020 2020  ary angles..    
-0000d1f0: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
-0000d200: 2020 2020 2020 2320 506c 6f74 2064 6970        # Plot dip
-0000d210: 2061 6e67 6c65 7320 6173 2072 6164 6969   angles as radii
-0000d220: 2061 6e64 2064 6970 2061 7a69 6d75 7468   and dip azimuth
-0000d230: 7320 6173 2061 6e67 6c65 730d 0a20 2020  s as angles..   
-0000d240: 2020 2020 2020 2020 2023 6178 5f72 6f73           #ax_ros
-0000d250: 652e 7363 6174 7465 7228 6469 705f 617a  e.scatter(dip_az
-0000d260: 696d 7574 6873 5f72 6164 2c20 6469 705f  imuths_rad, dip_
-0000d270: 616e 676c 6573 2c20 633d 636f 6c6f 722c  angles, c=color,
-0000d280: 2061 6c70 6861 3d30 2e35 290d 0a20 2020   alpha=0.5)..   
-0000d290: 2020 2020 2020 2020 2023 2050 6c6f 7420           # Plot 
-0000d2a0: 7468 6520 6f72 6965 6e74 6174 696f 6e20  the orientation 
-0000d2b0: 6461 7461 2061 7320 6120 726f 7365 2064  data as a rose d
-0000d2c0: 6961 6772 616d 0d0a 2020 2020 2020 2020  iagram..        
-0000d2d0: 2020 2020 6e2c 2062 696e 732c 2070 6174      n, bins, pat
-0000d2e0: 6368 6573 3d61 785f 726f 7365 2e68 6973  ches=ax_rose.his
-0000d2f0: 7428 7374 7269 6b65 2c20 6269 6e73 3d6e  t(strike, bins=n
-0000d300: 756d 5f62 696e 732c 2063 6f6c 6f72 3d63  um_bins, color=c
-0000d310: 6f6c 6f72 2c20 616c 7068 613d 302e 3529  olor, alpha=0.5)
-0000d320: 0d0a 2020 2020 2020 2020 2020 2020 2023  ..             #
-0000d330: 2041 6e6e 6f74 6174 6520 7468 6520 6e75   Annotate the nu
-0000d340: 6d62 6572 206f 6620 6461 7461 2070 6f69  mber of data poi
-0000d350: 6e74 7320 616e 6420 6269 6e20 6e75 6d62  nts and bin numb
-0000d360: 6572 0d0a 2020 2020 2020 2020 2020 2020  er..            
-0000d370: 6178 5f72 6f73 652e 7465 7874 2830 2c20  ax_rose.text(0, 
-0000d380: 2d30 2e31 2c20 6622 4461 7461 2050 6f69  -0.1, f"Data Poi
-0000d390: 6e74 733a 207b 6c65 6e28 7374 7269 6b65  nts: {len(strike
-0000d3a0: 7329 7d22 2c20 6861 3d27 6365 6e74 6572  s)}", ha='center
-0000d3b0: 272c 2076 613d 2763 656e 7465 7227 2c20  ', va='center', 
-0000d3c0: 7472 616e 7366 6f72 6d3d 6178 5f72 6f73  transform=ax_ros
-0000d3d0: 652e 7472 616e 7341 7865 7329 0d0a 2020  e.transAxes)..  
-0000d3e0: 2020 2020 2020 2020 2020 6178 5f72 6f73            ax_ros
-0000d3f0: 652e 7465 7874 2830 2c20 2d30 2e31 352c  e.text(0, -0.15,
-0000d400: 2066 2242 696e 2043 6f75 6e74 3a20 7b6e   f"Bin Count: {n
-0000d410: 756d 5f62 696e 737d 222c 2068 613d 2763  um_bins}", ha='c
-0000d420: 656e 7465 7227 2c20 7661 3d27 6365 6e74  enter', va='cent
-0000d430: 6572 272c 2074 7261 6e73 666f 726d 3d61  er', transform=a
-0000d440: 785f 726f 7365 2e74 7261 6e73 4178 6573  x_rose.transAxes
-0000d450: 290d 0a0d 0a20 2020 2020 2020 2023 2023  )....        # #
-0000d460: 2043 7573 746f 6d69 7a65 2074 6865 2072   Customize the r
-0000d470: 6f73 6520 6469 6167 7261 6d0d 0a20 2020  ose diagram..   
-0000d480: 2020 2020 2023 2061 785f 726f 7365 2e73       # ax_rose.s
-0000d490: 6574 5f74 6865 7461 5f7a 6572 6f5f 6c6f  et_theta_zero_lo
-0000d4a0: 6361 7469 6f6e 2822 4e22 290d 0a20 2020  cation("N")..   
-0000d4b0: 2020 2020 2023 2061 785f 726f 7365 2e73       # ax_rose.s
-0000d4c0: 6574 5f74 6865 7461 5f64 6972 6563 7469  et_theta_directi
-0000d4d0: 6f6e 282d 3129 0d0a 2020 2020 2020 2020  on(-1)..        
-0000d4e0: 2320 4375 7374 6f6d 697a 6520 7468 6520  # Customize the 
-0000d4f0: 706f 6c61 7220 706c 6f74 0d0a 2020 2020  polar plot..    
-0000d500: 2020 2020 6178 5f72 6f73 652e 7365 745f      ax_rose.set_
-0000d510: 7468 6574 615f 7a65 726f 5f6c 6f63 6174  theta_zero_locat
-0000d520: 696f 6e28 274e 2729 2020 2320 5365 7420  ion('N')  # Set 
-0000d530: 3020 6465 6772 6565 7320 6174 2074 6865  0 degrees at the
-0000d540: 2074 6f70 0d0a 2020 2020 2020 2020 6178   top..        ax
-0000d550: 5f72 6f73 652e 7365 745f 7468 6574 615f  _rose.set_theta_
-0000d560: 6469 7265 6374 696f 6e28 2d31 2920 2023  direction(-1)  #
-0000d570: 2052 6576 6572 7365 2074 6865 2064 6972   Reverse the dir
-0000d580: 6563 7469 6f6e 206f 6620 7468 6520 616e  ection of the an
-0000d590: 676c 6573 0d0a 0d0a 2020 2020 2020 2020  gles....        
-0000d5a0: 2320 5365 7420 6c61 6265 6c73 2066 6f72  # Set labels for
-0000d5b0: 2063 6172 6469 6e61 6c20 6469 7265 6374   cardinal direct
-0000d5c0: 696f 6e73 0d0a 2020 2020 2020 2020 6178  ions..        ax
-0000d5d0: 5f72 6f73 652e 7365 745f 7874 6963 6b73  _rose.set_xticks
-0000d5e0: 286e 702e 7261 6469 616e 7328 5b30 2c20  (np.radians([0, 
-0000d5f0: 3435 2c20 3930 2c20 3133 352c 2031 3830  45, 90, 135, 180
-0000d600: 2c20 3232 352c 2032 3730 2c20 3331 355d  , 225, 270, 315]
-0000d610: 2929 0d0a 2020 2020 2020 2020 6178 5f72  ))..        ax_r
-0000d620: 6f73 652e 7365 745f 7874 6963 6b6c 6162  ose.set_xticklab
-0000d630: 656c 7328 5b27 4e27 2c20 274e 4527 2c20  els(['N', 'NE', 
-0000d640: 2745 272c 2027 5345 272c 2027 5327 2c20  'E', 'SE', 'S', 
-0000d650: 2753 5727 2c20 2757 272c 2027 4e57 275d  'SW', 'W', 'NW']
-0000d660: 290d 0a20 2020 2020 2020 0d0a 0d0a 2020  )..       ....  
-0000d670: 2020 2020 2020 2320 5365 7420 7468 6520        # Set the 
-0000d680: 7261 6469 616c 2067 7269 6420 616e 6420  radial grid and 
-0000d690: 6c61 6265 6c73 0d0a 2020 2020 2020 2020  labels..        
-0000d6a0: 2320 6178 5f72 6f73 652e 7365 745f 726c  # ax_rose.set_rl
-0000d6b0: 6162 656c 5f70 6f73 6974 696f 6e28 3930  abel_position(90
-0000d6c0: 290d 0a20 2020 2020 2020 2023 2061 785f  )..        # ax_
-0000d6d0: 726f 7365 2e73 6574 5f79 7469 636b 7328  rose.set_yticks(
-0000d6e0: 5b31 352c 2033 302c 2034 352c 2036 302c  [15, 30, 45, 60,
-0000d6f0: 2037 355d 290d 0a20 2020 2020 2020 2023   75])..        #
-0000d700: 2061 785f 726f 7365 2e73 6574 5f72 6d61   ax_rose.set_rma
-0000d710: 7828 3930 2920 2023 2053 6574 2074 6865  x(90)  # Set the
-0000d720: 206d 6178 696d 756d 2072 6164 6961 6c20   maximum radial 
-0000d730: 6469 7374 616e 6365 0d0a 2020 2020 2020  distance..      
-0000d740: 2020 6178 5f72 6f73 652e 7365 745f 7469    ax_rose.set_ti
-0000d750: 746c 6528 2252 6f73 6520 4469 6167 7261  tle("Rose Diagra
-0000d760: 6d20 5374 7269 6b65 2229 0d0a 0d0a 2020  m Strike")....  
-0000d770: 2020 2020 2020 2320 4164 6a75 7374 2073        # Adjust s
-0000d780: 7061 6369 6e67 2062 6574 7765 656e 2073  pacing between s
-0000d790: 7562 706c 6f74 730d 0a20 2020 2020 2020  ubplots..       
-0000d7a0: 2070 6c74 2e73 7562 706c 6f74 735f 6164   plt.subplots_ad
-0000d7b0: 6a75 7374 2877 7370 6163 653d 302e 3229  just(wspace=0.2)
-0000d7c0: 0d0a 0d0a 2020 2020 2020 2020 706c 742e  ....        plt.
-0000d7d0: 7361 7665 6669 6728 6f75 745f 706c 616e  savefig(out_plan
-0000d7e0: 6546 6f6c 6465 7220 2b20 222f 2220 2b20  eFolder + "/" + 
-0000d7f0: 2273 7465 7265 6f70 6c6f 742e 706e 6722  "stereoplot.png"
-0000d800: 2c20 6470 693d 3330 3029 0d0a 2020 2020  , dpi=300)..    
-0000d810: 2020 2020 706c 742e 7469 6768 745f 6c61      plt.tight_la
-0000d820: 796f 7574 0d0a 2020 2020 2020 2020 2370  yout..        #p
-0000d830: 6c74 2e63 6c6f 7365 2829 0d0a 2020 2020  lt.close()..    
-0000d840: 2020 2020 706c 742e 636c 6f73 6528 290d      plt.close().
-0000d850: 0a20 2020 2020 2020 200d 0a20 2020 200d  .        ..    .
-0000d860: 0a20 2020 200d 0a20 2020 2020 2020 200d  .    ..        .
-0000d870: 0a20 2020 2064 6566 2064 7261 775f 706c  .    def draw_pl
-0000d880: 616e 6528 7878 2c79 7929 3a0d 0a20 2020  ane(xx,yy):..   
-0000d890: 2020 2020 200d 0a20 2020 2020 2020 2069       ..        i
-0000d8a0: 6620 6c65 6e28 706f 696e 7473 2920 3e3d  f len(points) >=
-0000d8b0: 2033 3a0d 0a20 2020 2020 2020 2020 2020   3:..           
-0000d8c0: 2066 6974 7465 645f 706c 616e 652c 2061   fitted_plane, a
-0000d8d0: 2c20 622c 2063 202c 2064 6970 5f61 6e67  , b, c , dip_ang
-0000d8e0: 6c65 2c20 6469 705f 6469 7265 6374 696f  le, dip_directio
-0000d8f0: 6e20 3d20 6669 745f 706c 616e 6528 706f  n = fit_plane(po
-0000d900: 696e 7473 2c20 7878 2c20 7979 290d 0a20  ints, xx, yy).. 
-0000d910: 2020 2020 2020 2020 2020 200d 0a20 2020             ..   
-0000d920: 2020 2020 2020 2020 2064 6970 5f61 6e67           dip_ang
-0000d930: 6c65 5f6c 6973 742e 6170 7065 6e64 2864  le_list.append(d
-0000d940: 6970 5f61 6e67 6c65 290d 0a20 2020 2020  ip_angle)..     
-0000d950: 2020 2020 2020 2064 6970 5f64 6972 6563         dip_direc
-0000d960: 7469 6f6e 5f6c 6973 742e 6170 7065 6e64  tion_list.append
-0000d970: 2864 6970 5f64 6972 6563 7469 6f6e 290d  (dip_direction).
-0000d980: 0a20 2020 2020 2020 2020 2020 200d 0a20  .            .. 
-0000d990: 2020 2020 2020 2020 2020 2023 2069 6620             # if 
-0000d9a0: 6c69 6d69 745f 6578 7465 6e64 3a0d 0a20  limit_extend:.. 
-0000d9b0: 2020 2020 2020 2020 2020 2023 2020 2347             #  #G
-0000d9c0: 6574 2062 6f75 6e64 696e 6720 626f 7820  et bounding box 
-0000d9d0: 6f66 2074 6865 2073 656c 6563 7465 6420  of the selected 
-0000d9e0: 706f 696e 7473 0d0a 2020 2020 2020 2020  points..        
-0000d9f0: 2020 2020 2320 2020 2020 786d 696e 2c20      #     xmin, 
-0000da00: 786d 6178 2c20 796d 696e 2c20 796d 6178  xmax, ymin, ymax
-0000da10: 203d 2062 6f75 6e64 696e 675f 626f 7828   = bounding_box(
-0000da20: 706f 696e 7473 290d 0a20 2020 2020 2020  points)..       
-0000da30: 2020 2020 2020 2020 200d 0a20 2020 2020           ..     
-0000da40: 2020 2020 2020 2023 2020 2020 206d 6173         #     mas
-0000da50: 6b20 3d20 2878 7820 3e3d 2078 6d69 6e29  k = (xx >= xmin)
-0000da60: 2026 2028 7878 203c 3d20 786d 6178 2920   & (xx <= xmax) 
-0000da70: 2620 2879 7920 3e3d 2079 6d69 6e29 2026  & (yy >= ymin) &
-0000da80: 2028 7979 203c 3d20 796d 6178 290d 0a20   (yy <= ymax).. 
-0000da90: 2020 2020 2020 2020 2020 2020 2020 200d                 .
-0000daa0: 0a20 2020 2020 2020 2020 2020 2023 2020  .            #  
-0000dab0: 2020 2066 6f72 2069 2069 6e20 7261 6e67     for i in rang
-0000dac0: 6528 7878 2e73 6861 7065 5b30 5d29 3a0d  e(xx.shape[0]):.
-0000dad0: 0a20 2020 2020 2020 2020 2020 2023 2020  .            #  
-0000dae0: 2020 2020 2020 2066 6f72 206a 2069 6e20         for j in 
-0000daf0: 7261 6e67 6528 7878 2e73 6861 7065 5b31  range(xx.shape[1
-0000db00: 5d29 3a0d 0a20 2020 2020 2020 2020 2020  ]):..           
-0000db10: 2023 2020 2020 2020 2020 2020 2020 2069   #             i
-0000db20: 6620 6e6f 7420 6d61 736b 5b69 2c20 6a5d  f not mask[i, j]
-0000db30: 3a0d 0a20 2020 2020 2020 2020 2020 2023  :..            #
-0000db40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000db50: 2066 6974 7465 645f 706c 616e 655b 692c   fitted_plane[i,
-0000db60: 206a 5d20 3d20 6e70 2e6e 616e 2020 2320   j] = np.nan  # 
-0000db70: 5365 7420 6f75 742d 6f66 2d62 6f75 6e64  Set out-of-bound
-0000db80: 7320 7661 6c75 6573 2074 6f20 4e61 4e0d  s values to NaN.
-0000db90: 0a20 2020 2020 2020 200d 0a20 2020 2020  .        ..     
-0000dba0: 2020 2020 2020 2070 6c61 6e65 732e 6170         planes.ap
-0000dbb0: 7065 6e64 2866 6974 7465 645f 706c 616e  pend(fitted_plan
-0000dbc0: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
-0000dbd0: 0d0a 2020 2020 2020 2020 2020 2020 2370  ..            #p
-0000dbe0: 6c61 6e65 5f63 6f6c 6f72 203d 2072 616e  lane_color = ran
-0000dbf0: 646f 6d5f 636f 6c6f 7228 290d 0a20 2020  dom_color()..   
-0000dc00: 2020 2020 2020 2020 2070 6c61 6e65 5f63           plane_c
-0000dc10: 6f6c 6f72 3d63 6f6c 6f72 5f66 726f 6d5f  olor=color_from_
-0000dc20: 6469 705f 616e 645f 6469 7265 6374 696f  dip_and_directio
-0000dc30: 6e28 6469 705f 616e 676c 652c 2064 6970  n(dip_angle, dip
-0000dc40: 5f64 6972 6563 7469 6f6e 290d 0a20 2020  _direction)..   
-0000dc50: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
-0000dc60: 706c 616e 6520 636f 6c6f 723a 2027 2c20  plane color: ', 
-0000dc70: 706c 616e 655f 636f 6c6f 7229 0d0a 2020  plane_color)..  
-0000dc80: 2020 2020 2020 2020 2020 706c 616e 655f            plane_
-0000dc90: 636f 6c6f 7273 2e61 7070 656e 6428 706c  colors.append(pl
-0000dca0: 616e 655f 636f 6c6f 7229 0d0a 0d0a 2020  ane_color)....  
-0000dcb0: 2020 2020 2020 2020 2020 666f 7220 706f            for po
-0000dcc0: 696e 7420 2069 6e20 706f 696e 7473 3a0d  int  in points:.
-0000dcd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000dce0: 2061 785f 3264 2e70 6c6f 7428 706f 696e   ax_2d.plot(poin
-0000dcf0: 745b 305d 2c20 706f 696e 745b 315d 2c20  t[0], point[1], 
-0000dd00: 276f 272c 2063 6f6c 6f72 3d70 6c61 6e65  'o', color=plane
-0000dd10: 5f63 6f6c 6f72 202c 2061 6c70 6861 3d30  _color , alpha=0
-0000dd20: 2e37 290d 0a20 2020 2020 2020 2020 200d  .7)..          .
-0000dd30: 0a20 2020 2020 2020 2020 2020 200d 0a20  .            .. 
-0000dd40: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
-0000dd50: 2020 2020 2063 616e 7661 735f 3264 2e64       canvas_2d.d
-0000dd60: 7261 7728 290d 0a20 2020 2020 2020 2020  raw()..         
-0000dd70: 2020 200d 0a0d 0a20 2020 2020 2020 2020     ....         
-0000dd80: 2020 2023 6178 5f33 642e 636c 6561 7228     #ax_3d.clear(
-0000dd90: 290d 0a20 2020 2020 2020 2020 2020 2061  )..            a
-0000dda0: 785f 3364 2e73 6574 5f74 6974 6c65 2827  x_3d.set_title('
-0000ddb0: 3344 2044 454d 2077 6974 6820 4669 7474  3D DEM with Fitt
-0000ddc0: 6564 2050 6c61 6e65 7327 290d 0a20 2020  ed Planes')..   
-0000ddd0: 2020 2020 2020 2020 2061 785f 3364 2e70           ax_3d.p
-0000dde0: 6c6f 745f 7375 7266 6163 6528 7878 2c20  lot_surface(xx, 
-0000ddf0: 7979 2c20 6461 7461 2c20 636d 6170 3d27  yy, data, cmap='
-0000de00: 7465 7272 6169 6e27 2c20 6c69 6e65 7769  terrain', linewi
-0000de10: 6474 683d 302c 2061 6e74 6961 6c69 6173  dth=0, antialias
-0000de20: 6564 3d54 7275 652c 2061 6c70 6861 3d30  ed=True, alpha=0
-0000de30: 2e35 290d 0a20 2020 2020 2020 2020 2020  .5)..           
-0000de40: 2023 666f 7220 706c 616e 6520 696e 2070   #for plane in p
-0000de50: 6c61 6e65 733a 0d0a 2020 2020 2020 2020  lanes:..        
-0000de60: 2020 2020 7375 7266 3d61 785f 3364 2e70      surf=ax_3d.p
-0000de70: 6c6f 745f 7375 7266 6163 6528 7878 2c20  lot_surface(xx, 
-0000de80: 7979 2c20 6669 7474 6564 5f70 6c61 6e65  yy, fitted_plane
-0000de90: 2c20 616c 7068 613d 302e 362c 206c 696e  , alpha=0.6, lin
-0000dea0: 6577 6964 7468 3d30 2c20 616e 7469 616c  ewidth=0, antial
-0000deb0: 6961 7365 643d 5472 7565 2c20 636f 6c6f  iased=True, colo
-0000dec0: 723d 706c 616e 655f 636f 6c6f 7229 0d0a  r=plane_color)..
-0000ded0: 2020 2020 2020 2020 2020 2020 0d0a 2020              ..  
-0000dee0: 2020 2020 2020 2020 2020 2020 2020 2370                #p
-0000def0: 6c6f 7420 706f 696e 7473 2069 6e20 3344  lot points in 3D
-0000df00: 0d0a 2020 2020 2020 2020 2020 2020 666f  ..            fo
-0000df10: 7220 706f 696e 7420 696e 2070 6f69 6e74  r point in point
-0000df20: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
-0000df30: 2020 2020 6178 5f33 642e 706c 6f74 2870      ax_3d.plot(p
-0000df40: 6f69 6e74 5b30 5d2c 2070 6f69 6e74 5b31  oint[0], point[1
-0000df50: 5d2c 2027 6f27 2c20 636f 6c6f 723d 706c  ], 'o', color=pl
-0000df60: 616e 655f 636f 6c6f 7229 0d0a 2020 2020  ane_color)..    
-0000df70: 2020 2020 2020 2020 2020 2020 0d0a 2020              ..  
-0000df80: 2020 2020 2020 2020 2020 6361 6e76 6173            canvas
-0000df90: 5f33 642e 6472 6177 2829 0d0a 2020 2020  _3d.draw()..    
-0000dfa0: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
-0000dfb0: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
-0000dfc0: 2020 2020 0d0a 0d0a 2020 2020 2020 2020      ....        
-0000dfd0: 2020 2020 706f 696e 7473 5f6c 6973 7462      points_listb
-0000dfe0: 6f78 2e64 656c 6574 6528 302c 2074 6b2e  ox.delete(0, tk.
-0000dff0: 454e 4429 0d0a 2020 2020 2020 2020 2020  END)..          
-0000e000: 2020 706f 696e 7473 2e63 6c65 6172 2829    points.clear()
-0000e010: 0d0a 2020 2020 2020 2020 2020 2020 0d0a  ..            ..
-0000e020: 2020 2020 2020 2020 2020 2020 706c 6f74              plot
-0000e030: 5f70 6c61 6e65 7328 6469 705f 616e 676c  _planes(dip_angl
-0000e040: 655f 6c69 7374 2c20 6469 705f 6469 7265  e_list, dip_dire
-0000e050: 6374 696f 6e5f 6c69 7374 2c20 706c 616e  ction_list, plan
-0000e060: 655f 636f 6c6f 7273 290d 0a20 2020 2020  e_colors)..     
-0000e070: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
-0000e080: 2020 2020 2023 2041 7373 756d 696e 6720       # Assuming 
-0000e090: 796f 7520 6861 7665 2061 2027 706c 616e  you have a 'plan
-0000e0a0: 6573 2720 6c69 7374 2c20 796f 7520 6361  es' list, you ca
-0000e0b0: 6e20 6368 6563 6b20 6974 7320 666f 726d  n check its form
-0000e0c0: 6174 0d0a 2020 2020 2020 2020 2020 2020  at..            
-0000e0d0: 2320 666f 7220 706c 616e 6520 696e 2070  # for plane in p
-0000e0e0: 6c61 6e65 733a 0d0a 2020 2020 2020 2020  lanes:..        
-0000e0f0: 2020 2020 2320 2020 2020 7072 696e 7428      #     print(
-0000e100: 7479 7065 2870 6c61 6e65 2929 0d0a 2020  type(plane))..  
-0000e110: 2020 2020 2020 2020 2020 2320 2020 2020            #     
-0000e120: 7072 696e 7428 6c65 6e28 706c 616e 6529  print(len(plane)
-0000e130: 2920 2023 2054 6869 7320 7769 6c6c 2067  )  # This will g
-0000e140: 6976 6520 796f 7520 7468 6520 6c65 6e67  ive you the leng
-0000e150: 7468 206f 7220 6e75 6d62 6572 206f 6620  th or number of 
-0000e160: 656c 656d 656e 7473 2069 6e20 7468 6520  elements in the 
-0000e170: 706c 616e 650d 0a0d 0a20 2020 2020 2020  plane....       
-0000e180: 2020 2020 2023 2020 2020 2023 2049 6620       #     # If 
-0000e190: 6974 2773 2061 204e 756d 5079 2061 7272  it's a NumPy arr
-0000e1a0: 6179 2c20 796f 7520 6361 6e20 7072 696e  ay, you can prin
-0000e1b0: 7420 6974 7320 7368 6170 6520 746f 2073  t its shape to s
-0000e1c0: 6565 2074 6865 2064 696d 656e 7369 6f6e  ee the dimension
-0000e1d0: 730d 0a20 2020 2020 2020 2020 2020 2023  s..            #
-0000e1e0: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
-0000e1f0: 6365 2870 6c61 6e65 2c20 6e70 2e6e 6461  ce(plane, np.nda
-0000e200: 7272 6179 293a 0d0a 2020 2020 2020 2020  rray):..        
-0000e210: 2020 2020 2320 2020 2020 2020 2020 7072      #         pr
-0000e220: 696e 7428 706c 616e 652e 7368 6170 6529  int(plane.shape)
-0000e230: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000e240: 2020 0d0a 2020 2020 2020 2020 2020 2020    ..            
-0000e250: 2320 2020 2020 2320 5072 696e 7420 7468  #     # Print th
-0000e260: 6520 6669 7273 7420 656c 656d 656e 7420  e first element 
-0000e270: 2861 7373 756d 696e 6720 6974 2773 2061  (assuming it's a
-0000e280: 206c 6973 7420 6f72 204e 756d 5079 2061   list or NumPy a
-0000e290: 7272 6179 290d 0a20 2020 2020 2020 2020  rray)..         
-0000e2a0: 2020 2023 2020 2020 2070 7269 6e74 2870     #     print(p
-0000e2b0: 6c61 6e65 5b30 5d29 0d0a 0d0a 2020 2020  lane[0])....    
-0000e2c0: 2020 2020 2020 2020 2320 2320 5072 696e          # # Prin
-0000e2d0: 7420 7468 6520 6c65 6e67 7468 206f 6620  t the length of 
-0000e2e0: 7468 6520 2770 6c61 6e65 7327 206c 6973  the 'planes' lis
-0000e2f0: 740d 0a20 2020 2020 2020 2020 2020 2023  t..            #
-0000e300: 2070 7269 6e74 286c 656e 2870 6c61 6e65   print(len(plane
-0000e310: 7329 290d 0a20 2020 2020 2020 2020 2020  s))..           
-0000e320: 200d 0a20 2020 2020 2020 2020 2020 200d   ..            .
-0000e330: 0a20 2020 2020 2020 2020 2020 200d 0a20  .            .. 
-0000e340: 2020 2020 2020 200d 0a0d 0a20 2020 2064         ....    d
-0000e350: 6566 2062 6f75 6e64 696e 675f 626f 7828  ef bounding_box(
-0000e360: 706f 696e 7473 293a 0d0a 2020 2020 2020  points):..      
-0000e370: 2020 2222 2246 696e 6420 7468 6520 626f    """Find the bo
-0000e380: 756e 6469 6e67 2062 6f78 2066 6f72 2061  unding box for a
-0000e390: 2073 6574 206f 6620 706f 696e 7473 2e22   set of points."
-0000e3a0: 2222 0d0a 2020 2020 2020 2020 785f 7661  ""..        x_va
-0000e3b0: 6c73 2c20 795f 7661 6c73 2c20 5f20 3d20  ls, y_vals, _ = 
-0000e3c0: 7a69 7028 2a70 6f69 6e74 7329 0d0a 2020  zip(*points)..  
-0000e3d0: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
-0000e3e0: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-0000e3f0: 206d 696e 2878 5f76 616c 7329 202c 206d   min(x_vals) , m
-0000e400: 6178 2878 5f76 616c 7329 2c20 6d69 6e28  ax(x_vals), min(
-0000e410: 795f 7661 6c73 292c 206d 6178 2879 5f76  y_vals), max(y_v
-0000e420: 616c 7329 0d0a 0d0a 2020 2020 2323 2323  als)....    ####
-0000e430: 2323 2323 0d0a 0d0a 2020 200d 0a20 2020  ####....   ..   
-0000e440: 200d 0a20 2020 2069 6d70 6f72 7420 657a   ..    import ez
-0000e450: 6478 660d 0a20 2020 2066 726f 6d20 7363  dxf..    from sc
-0000e460: 6970 792e 7370 6174 6961 6c20 696d 706f  ipy.spatial impo
-0000e470: 7274 2044 656c 6175 6e61 790d 0a20 2020  rt Delaunay..   
-0000e480: 2069 6d70 6f72 7420 6e75 6d70 7920 6173   import numpy as
-0000e490: 206e 700d 0a20 2020 2069 6d70 6f72 7420   np..    import 
-0000e4a0: 6f73 0d0a 0d0a 2020 2020 6465 6620 6c69  os....    def li
-0000e4b0: 7374 5f78 797a 5f66 696c 6573 5f69 6e5f  st_xyz_files_in_
-0000e4c0: 666f 6c64 6572 2866 6f6c 6465 725f 7061  folder(folder_pa
-0000e4d0: 7468 293a 0d0a 2020 2020 2020 2020 7879  th):..        xy
-0000e4e0: 7a5f 6669 6c65 7320 3d20 5b5d 0d0a 2020  z_files = []..  
-0000e4f0: 2020 2020 2020 666f 7220 6669 6c65 6e61        for filena
-0000e500: 6d65 2069 6e20 6f73 2e6c 6973 7464 6972  me in os.listdir
-0000e510: 2866 6f6c 6465 725f 7061 7468 293a 0d0a  (folder_path):..
-0000e520: 2020 2020 2020 2020 2020 2020 6966 2066              if f
-0000e530: 696c 656e 616d 652e 656e 6473 7769 7468  ilename.endswith
-0000e540: 2822 2e78 797a 2229 3a0d 0a20 2020 2020  (".xyz"):..     
-0000e550: 2020 2020 2020 2020 2020 2078 797a 5f66             xyz_f
-0000e560: 696c 6573 2e61 7070 656e 6428 6f73 2e70  iles.append(os.p
-0000e570: 6174 682e 6a6f 696e 2866 6f6c 6465 725f  ath.join(folder_
-0000e580: 7061 7468 2c20 6669 6c65 6e61 6d65 2929  path, filename))
-0000e590: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-0000e5a0: 2078 797a 5f66 696c 6573 0d0a 0d0a 2020   xyz_files....  
-0000e5b0: 2020 6465 6620 6372 6561 7465 5f64 7866    def create_dxf
-0000e5c0: 5f66 726f 6d5f 7879 7a5f 6669 6c65 7328  _from_xyz_files(
-0000e5d0: 7879 7a5f 6669 6c65 732c 206f 7574 7075  xyz_files, outpu
-0000e5e0: 745f 7061 7468 2c20 7369 6e67 6c65 3d4e  t_path, single=N
-0000e5f0: 6f6e 6529 3a0d 0a20 2020 2020 2020 200d  one):..        .
-0000e600: 0a20 2020 2020 2020 2069 6620 7369 6e67  .        if sing
-0000e610: 6c65 2069 7320 4e6f 6e65 3a0d 0a20 2020  le is None:..   
-0000e620: 2020 2020 2020 2020 2020 2320 4372 6561            # Crea
-0000e630: 7465 2061 206e 6577 2044 5846 2064 6f63  te a new DXF doc
-0000e640: 756d 656e 740d 0a20 2020 2020 2020 2020  ument..         
-0000e650: 2020 2064 6f63 203d 2065 7a64 7866 2e6e     doc = ezdxf.n
-0000e660: 6577 2829 0d0a 0d0a 2020 2020 2020 2020  ew()....        
-0000e670: 2020 2020 2320 4372 6561 7465 2061 206e      # Create a n
-0000e680: 6577 2044 5846 206d 6f64 656c 2073 7061  ew DXF model spa
-0000e690: 6365 0d0a 2020 2020 2020 2020 2020 2020  ce..            
-0000e6a0: 6d73 7020 3d20 646f 632e 6d6f 6465 6c73  msp = doc.models
-0000e6b0: 7061 6365 2829 0d0a 2020 2020 2020 2020  pace()..        
-0000e6c0: 2020 2020 0d0a 2020 2020 2020 2020 2020      ..          
-0000e6d0: 200d 0a0d 0a20 2020 2020 2020 2066 6f72   ....        for
-0000e6e0: 2078 797a 5f66 696c 6520 696e 2078 797a   xyz_file in xyz
-0000e6f0: 5f66 696c 6573 3a0d 0a20 2020 2020 2020  _files:..       
-0000e700: 2020 2020 200d 0a20 2020 2020 2020 2020       ..         
-0000e710: 2020 2069 6620 7369 6e67 6c65 2069 7320     if single is 
-0000e720: 6e6f 7420 4e6f 6e65 3a0d 0a20 2020 2020  not None:..     
-0000e730: 2020 2020 2020 2020 2020 2023 2043 7265             # Cre
-0000e740: 6174 6520 6120 6e65 7720 4458 4620 646f  ate a new DXF do
-0000e750: 6375 6d65 6e74 0d0a 2020 2020 2020 2020  cument..        
-0000e760: 2020 2020 2020 2020 646f 6320 3d20 657a          doc = ez
-0000e770: 6478 662e 6e65 7728 290d 0a0d 0a20 2020  dxf.new()....   
-0000e780: 2020 2020 2020 2020 2020 2020 2023 2043               # C
-0000e790: 7265 6174 6520 6120 6e65 7720 4458 4620  reate a new DXF 
-0000e7a0: 6d6f 6465 6c20 7370 6163 650d 0a20 2020  model space..   
-0000e7b0: 2020 2020 2020 2020 2020 2020 206d 7370               msp
-0000e7c0: 203d 2064 6f63 2e6d 6f64 656c 7370 6163   = doc.modelspac
-0000e7d0: 6528 290d 0a20 2020 2020 2020 2020 2020  e()..           
-0000e7e0: 2023 204c 6f61 6420 5859 5a20 6461 7461   # Load XYZ data
-0000e7f0: 2066 726f 6d20 6120 6669 6c65 0d0a 2020   from a file..  
-0000e800: 2020 2020 2020 2020 2020 6461 7461 203d            data =
-0000e810: 206e 702e 6c6f 6164 7478 7428 7879 7a5f   np.loadtxt(xyz_
-0000e820: 6669 6c65 290d 0a20 2020 2020 2020 2020  file)..         
-0000e830: 2020 200d 0a0d 0a20 2020 2020 2020 2020     ....         
-0000e840: 2020 2023 2053 6570 6172 6174 6520 7468     # Separate th
-0000e850: 6520 5859 5a20 6461 7461 2069 6e74 6f20  e XYZ data into 
-0000e860: 696e 6469 7669 6475 616c 2061 7272 6179  individual array
-0000e870: 730d 0a20 2020 2020 2020 2020 2020 2078  s..            x
-0000e880: 203d 2064 6174 615b 3a2c 2030 5d0d 0a20   = data[:, 0].. 
-0000e890: 2020 2020 2020 2020 2020 2079 203d 2064             y = d
-0000e8a0: 6174 615b 3a2c 2031 5d0d 0a20 2020 2020  ata[:, 1]..     
-0000e8b0: 2020 2020 2020 207a 203d 2064 6174 615b         z = data[
-0000e8c0: 3a2c 2032 5d0d 0a0d 0a20 2020 2020 2020  :, 2]....       
-0000e8d0: 2020 2020 2023 2043 7265 6174 6520 6120       # Create a 
-0000e8e0: 4465 6c61 756e 6179 2074 7269 616e 6775  Delaunay triangu
-0000e8f0: 6c61 7469 6f6e 206f 6620 7468 6520 706f  lation of the po
-0000e900: 696e 7473 0d0a 2020 2020 2020 2020 2020  ints..          
-0000e910: 2020 7472 6920 3d20 4465 6c61 756e 6179    tri = Delaunay
-0000e920: 286e 702e 636f 6c75 6d6e 5f73 7461 636b  (np.column_stack
-0000e930: 2828 782c 2079 2929 290d 0a0d 0a20 2020  ((x, y)))....   
-0000e940: 2020 2020 2020 2020 2023 2041 6464 2074           # Add t
-0000e950: 6865 2074 7269 616e 676c 6573 2074 6f20  he triangles to 
-0000e960: 7468 6520 6d6f 6465 6c20 7370 6163 650d  the model space.
-0000e970: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-0000e980: 2073 696d 706c 6578 2069 6e20 7472 692e   simplex in tri.
-0000e990: 7369 6d70 6c69 6365 733a 0d0a 2020 2020  simplices:..    
-0000e9a0: 2020 2020 2020 2020 2020 2020 7665 7274              vert
-0000e9b0: 6963 6573 203d 205b 2878 5b69 5d2c 2079  ices = [(x[i], y
-0000e9c0: 5b69 5d2c 207a 5b69 5d29 2066 6f72 2069  [i], z[i]) for i
-0000e9d0: 2069 6e20 7369 6d70 6c65 785d 0d0a 2020   in simplex]..  
-0000e9e0: 2020 2020 2020 2020 2020 2020 2020 6d73                ms
-0000e9f0: 702e 6164 645f 3364 6661 6365 2870 6f69  p.add_3dface(poi
-0000ea00: 6e74 733d 7665 7274 6963 6573 290d 0a20  nts=vertices).. 
-0000ea10: 2020 2020 2020 2020 2020 200d 0a20 2020             ..   
-0000ea20: 2020 2020 2020 2020 2069 6620 7369 6e67           if sing
-0000ea30: 6c65 2069 7320 6e6f 7420 4e6f 6e65 3a0d  le is not None:.
-0000ea40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ea50: 2020 2020 2023 2053 6176 6520 7468 6520       # Save the 
-0000ea60: 4458 4620 6669 6c65 0d0a 2020 2020 2020  DXF file..      
-0000ea70: 2020 2020 2020 2020 2020 646f 632e 7361            doc.sa
-0000ea80: 7665 6173 286f 7574 7075 745f 7061 7468  veas(output_path
-0000ea90: 290d 0a20 2020 2020 2020 2020 2020 200d  )..            .
-0000eaa0: 0a20 2020 2020 2020 2069 6620 7369 6e67  .        if sing
-0000eab0: 6c65 2069 7320 4e6f 6e65 3a20 0d0a 0d0a  le is None: ....
-0000eac0: 2020 2020 2020 2020 2020 2020 2320 5361              # Sa
-0000ead0: 7665 2074 6865 2044 5846 2066 696c 650d  ve the DXF file.
-0000eae0: 0a20 2020 2020 2020 2020 2020 2064 6f63  .            doc
-0000eaf0: 2e73 6176 6561 7328 6f75 7470 7574 5f70  .saveas(output_p
-0000eb00: 6174 6829 0d0a 2020 2020 2020 2020 0d0a  ath)..        ..
-0000eb10: 2020 2020 0d0a 2020 2020 6465 6620 7361      ..    def sa
-0000eb20: 7665 5f70 6c61 6e65 735f 746f 5f6f 626a  ve_planes_to_obj
-0000eb30: 2829 3a0d 0a20 2020 2020 2020 2078 5f63  ():..        x_c
-0000eb40: 6f6f 7264 7320 3d20 6e70 2e6c 696e 7370  oords = np.linsp
-0000eb50: 6163 6528 6c65 6674 2c20 7269 6768 742c  ace(left, right,
-0000eb60: 2064 6174 612e 7368 6170 655b 315d 290d   data.shape[1]).
-0000eb70: 0a20 2020 2020 2020 2079 5f63 6f6f 7264  .        y_coord
-0000eb80: 7320 3d20 6e70 2e6c 696e 7370 6163 6528  s = np.linspace(
-0000eb90: 746f 702c 2062 6f74 746f 6d2c 2064 6174  top, bottom, dat
-0000eba0: 612e 7368 6170 655b 305d 290d 0a20 2020  a.shape[0])..   
-0000ebb0: 2020 2020 2078 782c 2079 7920 3d20 6e70       xx, yy = np
-0000ebc0: 2e6d 6573 6867 7269 6428 785f 636f 6f72  .meshgrid(x_coor
-0000ebd0: 6473 2c20 795f 636f 6f72 6473 290d 0a20  ds, y_coords).. 
-0000ebe0: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
-0000ebf0: 6966 206e 6f74 2070 6c61 6e65 733a 0d0a  if not planes:..
-0000ec00: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-0000ec10: 7428 224e 6f20 706c 616e 6573 2074 6f20  t("No planes to 
-0000ec20: 7361 7665 2e22 290d 0a20 2020 2020 2020  save.")..       
-0000ec30: 2020 2020 2072 6574 7572 6e0d 0a20 2020       return..   
-0000ec40: 2020 2020 200d 0a20 2020 2020 2020 200d       ..        .
-0000ec50: 0a20 2020 2020 2020 206f 7574 7075 745f  .        output_
-0000ec60: 6669 6c65 6e61 6d65 5f64 7866 203d 2066  filename_dxf = f
-0000ec70: 227b 6f75 745f 706c 616e 6546 6f6c 6465  "{out_planeFolde
-0000ec80: 727d 2f70 6c61 6e65 732e 6478 6622 0d0a  r}/planes.dxf"..
-0000ec90: 2020 2020 2020 2020 666f 7220 6964 782c          for idx,
-0000eca0: 2070 6c61 6e65 2069 6e20 656e 756d 6572   plane in enumer
-0000ecb0: 6174 6528 706c 616e 6573 293a 0d0a 2020  ate(planes):..  
-0000ecc0: 2020 2020 2020 2020 2020 6f75 7470 7574            output
-0000ecd0: 5f66 696c 656e 616d 6520 3d20 6622 7b6f  _filename = f"{o
-0000ece0: 7574 5f70 6c61 6e65 466f 6c64 6572 7d2f  ut_planeFolder}/
-0000ecf0: 706c 616e 6573 5f7b 6964 787d 2e78 797a  planes_{idx}.xyz
-0000ed00: 220d 0a20 2020 2020 2020 2020 2020 206f  "..            o
-0000ed10: 7574 7075 745f 6669 6c65 6e61 6d65 5f69  utput_filename_i
-0000ed20: 6478 203d 2066 227b 6f75 745f 706c 616e  dx = f"{out_plan
-0000ed30: 6546 6f6c 6465 727d 2f70 6c61 6e65 735f  eFolder}/planes_
-0000ed40: 7b69 6478 7d2e 6478 6622 0d0a 2020 2020  {idx}.dxf"..    
-0000ed50: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
-0000ed60: 2020 2020 2020 2320 496e 6974 6961 6c69        # Initiali
-0000ed70: 7a65 206c 6973 7473 2074 6f20 7374 6f72  ze lists to stor
-0000ed80: 6520 7665 7274 6963 6573 2061 6e64 2066  e vertices and f
-0000ed90: 6163 6573 0d0a 2020 2020 2020 2020 2020  aces..          
-0000eda0: 2020 7665 7274 6963 6573 203d 205b 5d0d    vertices = [].
-0000edb0: 0a20 2020 2020 2020 2020 2020 200d 0a20  .            .. 
-0000edc0: 2020 2020 2020 2020 2020 2023 2053 616d             # Sam
-0000edd0: 706c 6564 2070 6f69 6e74 2069 6e74 6572  pled point inter
-0000ede0: 7661 6c0d 0a20 2020 2020 2020 2020 2020  val..           
-0000edf0: 2073 616d 706c 655f 696e 7465 7276 616c   sample_interval
-0000ee00: 203d 2032 3030 0d0a 2020 2020 2020 2020   = 200..        
-0000ee10: 2020 2020 0d0a 2020 2020 2020 2020 2020      ..          
-0000ee20: 2020 2320 4f70 656e 2074 6865 2058 595a    # Open the XYZ
-0000ee30: 2066 696c 6520 666f 7220 7772 6974 696e   file for writin
-0000ee40: 670d 0a20 2020 2020 2020 2020 2020 2077  g..            w
-0000ee50: 6974 6820 6f70 656e 286f 7574 7075 745f  ith open(output_
-0000ee60: 6669 6c65 6e61 6d65 2c20 2777 2729 2061  filename, 'w') a
-0000ee70: 7320 7879 7a5f 6669 6c65 3a0d 0a20 2020  s xyz_file:..   
-0000ee80: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-0000ee90: 2069 2069 6e20 7261 6e67 6528 302c 2070   i in range(0, p
-0000eea0: 6c61 6e65 2e73 6861 7065 5b30 5d2c 2073  lane.shape[0], s
-0000eeb0: 616d 706c 655f 696e 7465 7276 616c 293a  ample_interval):
-0000eec0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000eed0: 2020 2020 2020 666f 7220 6a20 696e 2072        for j in r
-0000eee0: 616e 6765 2830 2c20 706c 616e 652e 7368  ange(0, plane.sh
-0000eef0: 6170 655b 315d 2c20 7361 6d70 6c65 5f69  ape[1], sample_i
-0000ef00: 6e74 6572 7661 6c29 3a0d 0a20 2020 2020  nterval):..     
-0000ef10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ef20: 2020 2069 6620 6920 3c20 7878 2e73 6861     if i < xx.sha
-0000ef30: 7065 5b30 5d20 616e 6420 6a20 3c20 7878  pe[0] and j < xx
-0000ef40: 2e73 6861 7065 5b31 5d3a 0d0a 2020 2020  .shape[1]:..    
-0000ef50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ef60: 2020 2020 2020 2020 7820 3d20 7878 5b69          x = xx[i
-0000ef70: 2c20 6a5d 0d0a 2020 2020 2020 2020 2020  , j]..          
-0000ef80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ef90: 2020 7920 3d20 7979 5b69 2c20 6a5d 0d0a    y = yy[i, j]..
-0000efa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000efb0: 2020 2020 2020 2020 2020 2020 7a20 3d20              z = 
-0000efc0: 706c 616e 655b 692c 206a 5d0d 0a0d 0a20  plane[i, j].... 
-0000efd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000efe0: 2020 2020 2020 2020 2020 2023 2043 6865             # Che
-0000eff0: 636b 2066 6f72 204e 614e 2076 616c 7565  ck for NaN value
-0000f000: 730d 0a20 2020 2020 2020 2020 2020 2020  s..             
-0000f010: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0000f020: 6620 6e6f 7420 6e70 2e69 736e 616e 2878  f not np.isnan(x
-0000f030: 2920 616e 6420 6e6f 7420 6e70 2e69 736e  ) and not np.isn
-0000f040: 616e 2879 2920 616e 6420 6e6f 7420 6e70  an(y) and not np
-0000f050: 2e69 736e 616e 287a 293a 0d0a 2020 2020  .isnan(z):..    
-0000f060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f070: 2020 2020 2020 2020 2020 2020 2320 4164              # Ad
-0000f080: 6420 7468 6520 7665 7274 6578 2074 6f20  d the vertex to 
-0000f090: 7468 6520 6c69 7374 0d0a 2020 2020 2020  the list..      
-0000f0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f0b0: 2020 2020 2020 2020 2020 7665 7274 6963            vertic
-0000f0c0: 6573 2e61 7070 656e 6428 2878 2c20 792c  es.append((x, y,
-0000f0d0: 207a 2929 0d0a 2020 2020 2020 2020 2020   z))..          
-0000f0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f0f0: 2020 2020 200d 0a20 2020 2020 2020 2020       ..         
-0000f100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f110: 2020 2020 2020 2023 2057 7269 7465 2076         # Write v
-0000f120: 6572 7465 7820 6461 7461 2074 6f20 7468  ertex data to th
-0000f130: 6520 5859 5a20 6669 6c65 0d0a 2020 2020  e XYZ file..    
-0000f140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f150: 2020 2020 2020 2020 2020 2020 7879 7a5f              xyz_
-0000f160: 6669 6c65 2e77 7269 7465 2866 277b 787d  file.write(f'{x}
-0000f170: 207b 797d 207b 7a7d 5c6e 2729 0d0a 2020   {y} {z}\n')..  
-0000f180: 2020 2020 2020 2020 2020 0d0a 2020 2020            ..    
-0000f190: 2020 2020 2020 2020 6372 6561 7465 5f64          create_d
-0000f1a0: 7866 5f66 726f 6d5f 7879 7a5f 6669 6c65  xf_from_xyz_file
-0000f1b0: 7328 6c69 7374 5f78 797a 5f66 696c 6573  s(list_xyz_files
-0000f1c0: 5f69 6e5f 666f 6c64 6572 286f 7574 5f70  _in_folder(out_p
-0000f1d0: 6c61 6e65 466f 6c64 6572 292c 206f 7574  laneFolder), out
-0000f1e0: 7075 745f 6669 6c65 6e61 6d65 5f69 6478  put_filename_idx
-0000f1f0: 2c20 7369 6e67 6c65 3d69 6478 290d 0a20  , single=idx).. 
-0000f200: 2020 2020 2020 2020 2020 200d 0a20 2020             ..   
-0000f210: 2020 2020 2020 2020 2020 2020 2020 200d                 .
-0000f220: 0a20 2020 2020 2020 2070 7269 6e74 2866  .        print(f
-0000f230: 277a 7a20 7661 6c75 6573 2073 6176 6564  'zz values saved
-0000f240: 2074 6f20 7b6f 7574 7075 745f 6669 6c65   to {output_file
-0000f250: 6e61 6d65 7d27 290d 0a20 2020 2020 2020  name}')..       
-0000f260: 2020 2020 200d 0a20 2020 2020 2020 200d       ..        .
-0000f270: 0a20 2020 0d0a 2020 2020 2020 2020 0d0a  .   ..        ..
-0000f280: 2020 2020 2020 2020 0d0a 2020 2020 6465          ..    de
-0000f290: 6620 636f 6c6c 6563 745f 706f 696e 7473  f collect_points
-0000f2a0: 5f66 726f 6d5f 6c69 6e65 2867 6466 293a  _from_line(gdf):
-0000f2b0: 0d0a 2020 2020 2020 2020 2222 2243 6f6c  ..        """Col
-0000f2c0: 6c65 6374 2073 7461 7274 2c20 6d69 6464  lect start, midd
-0000f2d0: 6c65 2c20 616e 6420 656e 6420 706f 696e  le, and end poin
-0000f2e0: 7473 2066 726f 6d20 6561 6368 206c 696e  ts from each lin
-0000f2f0: 6520 6665 6174 7572 652e 2222 220d 0a20  e feature.""".. 
-0000f300: 2020 2020 2020 2063 6f6c 6c65 6374 6564         collected
-0000f310: 5f70 6f69 6e74 7320 3d20 5b5d 0d0a 0d0a  _points = []....
-0000f320: 2020 2020 2020 2020 666f 7220 6765 6f6d          for geom
-0000f330: 6574 7279 2069 6e20 6764 662e 6765 6f6d  etry in gdf.geom
-0000f340: 6574 7279 3a0d 0a20 2020 2020 2020 2020  etry:..         
-0000f350: 2020 2069 6620 6765 6f6d 6574 7279 2e67     if geometry.g
-0000f360: 656f 6d5f 7479 7065 203d 3d20 224c 696e  eom_type == "Lin
-0000f370: 6553 7472 696e 6722 3a0d 0a20 2020 2020  eString":..     
-0000f380: 2020 2020 2020 2020 2020 2078 2c20 7920             x, y 
-0000f390: 3d20 6765 6f6d 6574 7279 2e78 790d 0a20  = geometry.xy.. 
-0000f3a0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0000f3b0: 7461 7274 203d 2028 785b 305d 2c20 795b  tart = (x[0], y[
-0000f3c0: 305d 290d 0a20 2020 2020 2020 2020 2020  0])..           
-0000f3d0: 2020 2020 2065 6e64 203d 2028 785b 2d31       end = (x[-1
-0000f3e0: 5d2c 2079 5b2d 315d 290d 0a20 2020 2020  ], y[-1])..     
-0000f3f0: 2020 2020 2020 2020 2020 200d 0a20 2020             ..   
-0000f400: 2020 2020 2020 2020 2020 2020 2023 7072               #pr
-0000f410: 696e 7428 2773 7461 7274 3a20 2720 2c73  int('start: ' ,s
-0000f420: 7461 7274 290d 0a20 2020 2020 2020 2020  tart)..         
-0000f430: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
-0000f440: 2020 2020 2020 2020 2023 2023 2043 7265           # # Cre
-0000f450: 6174 6520 6120 4c69 6e65 5374 7269 6e67  ate a LineString
-0000f460: 2066 726f 6d20 636f 6f72 6469 6e61 7465   from coordinate
-0000f470: 7320 746f 2065 6173 696c 7920 6765 7420  s to easily get 
-0000f480: 6120 706f 696e 7420 6174 2035 3025 2064  a point at 50% d
-0000f490: 6973 7461 6e63 650d 0a20 2020 2020 2020  istance..       
-0000f4a0: 2020 2020 2020 2020 206c 696e 6520 3d20           line = 
-0000f4b0: 4c69 6e65 5374 7269 6e67 287a 6970 2878  LineString(zip(x
-0000f4c0: 2c20 7929 290d 0a20 2020 2020 2020 2020  , y))..         
-0000f4d0: 2020 2020 2020 2023 2069 6620 6c65 6e28         # if len(
-0000f4e0: 6c69 6e65 2e63 6f6f 7264 7329 203e 3d20  line.coords) >= 
-0000f4f0: 333a 0d0a 2020 2020 2020 2020 2020 2020  3:..            
-0000f500: 2020 2020 2320 2020 2020 2320 4966 2074      #     # If t
-0000f510: 6865 206c 696e 6520 6861 7320 6d6f 7265  he line has more
-0000f520: 2074 6861 6e20 3220 7665 7274 6963 6573   than 2 vertices
-0000f530: 2c20 636f 6c6c 6563 7420 706f 696e 7473  , collect points
-0000f540: 2061 7420 7665 7274 6963 6573 0d0a 2020   at vertices..  
-0000f550: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0000f560: 2020 2020 7665 7274 6963 6573 203d 206c      vertices = l
-0000f570: 6973 7428 6c69 6e65 2e63 6f6f 7264 7329  ist(line.coords)
-0000f580: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000f590: 2020 2320 2020 2020 2370 7269 6e74 2827    #     #print('
-0000f5a0: 7665 7274 6963 733a 2027 2c20 7665 7274  vertics: ', vert
-0000f5b0: 6963 6573 290d 0a20 2020 2020 2020 2020  ices)..         
-0000f5c0: 2020 2020 2020 2023 2020 2020 2076 6572         #     ver
-0000f5d0: 7465 785f 6c69 7374 3d5b 6920 666f 7220  tex_list=[i for 
-0000f5e0: 6920 696e 2076 6572 7469 6365 735d 0d0a  i in vertices]..
-0000f5f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f600: 2320 2020 2020 666f 7220 6b6a 2069 6e20  #     for kj in 
-0000f610: 7665 7274 6578 5f6c 6973 743a 0d0a 2020  vertex_list:..  
-0000f620: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0000f630: 2020 2020 2020 2020 636f 6c6c 6563 7465          collecte
-0000f640: 645f 706f 696e 7473 2e61 7070 656e 6428  d_points.append(
-0000f650: 6b6a 290d 0a20 2020 2020 2020 2020 2020  kj)..           
-0000f660: 2020 2020 2023 2020 2020 2023 636f 6c6c       #     #coll
-0000f670: 6563 7465 645f 706f 696e 7473 2e65 7874  ected_points.ext
-0000f680: 656e 6428 7665 7274 6963 6573 290d 0a20  end(vertices).. 
-0000f690: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0000f6a0: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
-0000f6b0: 2020 2020 2020 2020 2020 2020 0d0a 2020              ..  
-0000f6c0: 2020 2020 2020 2020 2020 2020 2020 6d69                mi
-0000f6d0: 6464 6c65 203d 206c 696e 652e 696e 7465  ddle = line.inte
-0000f6e0: 7270 6f6c 6174 6528 302e 352c 206e 6f72  rpolate(0.5, nor
-0000f6f0: 6d61 6c69 7a65 643d 5472 7565 292e 636f  malized=True).co
-0000f700: 6f72 6473 5b30 5d0d 0a20 2020 2020 2020  ords[0]..       
-0000f710: 2020 2020 2020 2020 2070 3220 3d20 6c69           p2 = li
-0000f720: 6e65 2e69 6e74 6572 706f 6c61 7465 2830  ne.interpolate(0
-0000f730: 2e32 352c 206e 6f72 6d61 6c69 7a65 643d  .25, normalized=
-0000f740: 5472 7565 292e 636f 6f72 6473 5b30 5d0d  True).coords[0].
-0000f750: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000f760: 2070 3120 3d20 6c69 6e65 2e69 6e74 6572   p1 = line.inter
-0000f770: 706f 6c61 7465 2830 2e37 352c 206e 6f72  polate(0.75, nor
-0000f780: 6d61 6c69 7a65 643d 5472 7565 292e 636f  malized=True).co
-0000f790: 6f72 6473 5b30 5d0d 0a0d 0a20 2020 2020  ords[0]....     
-0000f7a0: 2020 2020 2020 2020 2020 2063 6f6c 6c65             colle
-0000f7b0: 6374 6564 5f70 6f69 6e74 732e 6170 7065  cted_points.appe
-0000f7c0: 6e64 285b 7374 6172 742c 206d 6964 646c  nd([start, middl
-0000f7d0: 652c 2065 6e64 2c20 7031 2c70 325d 290d  e, end, p1,p2]).
-0000f7e0: 0a0d 0a20 2020 2020 2020 2072 6574 7572  ...        retur
-0000f7f0: 6e20 636f 6c6c 6563 7465 645f 706f 696e  n collected_poin
-0000f800: 7473 0d0a 0d0a 2020 2020 2320 6465 6620  ts....    # def 
-0000f810: 636f 6c6c 6563 745f 706f 696e 7473 5f66  collect_points_f
-0000f820: 726f 6d5f 6c69 6e65 2867 6466 293a 0d0a  rom_line(gdf):..
-0000f830: 2020 2020 2320 2020 2020 2320 496e 6974      #     # Init
-0000f840: 6961 6c69 7a65 2061 6e20 656d 7074 7920  ialize an empty 
-0000f850: 6c69 7374 2074 6f20 7374 6f72 6520 7468  list to store th
-0000f860: 6520 636f 6f72 6469 6e61 7465 730d 0a20  e coordinates.. 
-0000f870: 2020 2023 2020 2020 2063 6f6c 6c65 6374     #     collect
-0000f880: 6564 5f70 6f69 6e74 7320 3d20 5b5d 0d0a  ed_points = []..
-0000f890: 0d0a 2020 2020 2320 2020 2020 2320 4974  ..    #     # It
-0000f8a0: 6572 6174 6520 7468 726f 7567 6820 7468  erate through th
-0000f8b0: 6520 4765 6f44 6174 6146 7261 6d65 0d0a  e GeoDataFrame..
-0000f8c0: 2020 2020 2320 2020 2020 666f 7220 6765      #     for ge
-0000f8d0: 6f6d 6574 7279 2069 6e20 6764 665b 2767  ometry in gdf['g
-0000f8e0: 656f 6d65 7472 7927 5d3a 0d0a 2020 2020  eometry']:..    
-0000f8f0: 2320 2020 2020 2020 2020 6966 2069 7369  #         if isi
-0000f900: 6e73 7461 6e63 6528 6765 6f6d 6574 7279  nstance(geometry
-0000f910: 2c20 4c69 6e65 5374 7269 6e67 293a 0d0a  , LineString):..
-0000f920: 2020 2020 2320 2020 2020 2020 2020 2020      #           
-0000f930: 2020 2320 436f 756e 7420 7468 6520 6e75    # Count the nu
-0000f940: 6d62 6572 206f 6620 7665 7274 6963 6573  mber of vertices
-0000f950: 2069 6e20 7468 6520 4c69 6e65 5374 7269   in the LineStri
-0000f960: 6e67 0d0a 2020 2020 2320 2020 2020 2020  ng..    #       
-0000f970: 2020 2020 2020 6e75 6d5f 7665 7274 6963        num_vertic
-0000f980: 6573 203d 206c 656e 2867 656f 6d65 7472  es = len(geometr
-0000f990: 792e 636f 6f72 6473 290d 0a20 2020 2020  y.coords)..     
-0000f9a0: 2020 2020 2020 2020 2020 200d 0a20 2020             ..   
-0000f9b0: 2023 2020 2020 2020 2020 2020 2020 2023   #             #
-0000f9c0: 2043 6865 636b 2069 6620 7468 6520 4c69   Check if the Li
-0000f9d0: 6e65 5374 7269 6e67 2069 7320 7374 7261  neString is stra
-0000f9e0: 6967 6874 2028 3320 6f72 2066 6577 6572  ight (3 or fewer
-0000f9f0: 2076 6572 7469 6365 7329 0d0a 2020 2020   vertices)..    
-0000fa00: 2320 2020 2020 2020 2020 2020 2020 6966  #             if
-0000fa10: 206e 756d 5f76 6572 7469 6365 7320 3c3d   num_vertices <=
-0000fa20: 2033 3a0d 0a20 2020 2023 2020 2020 2020   3:..    #      
-0000fa30: 2020 2020 2020 2020 2020 2023 2046 6f72             # For
-0000fa40: 2073 7472 6169 6768 7420 6c69 6e65 732c   straight lines,
-0000fa50: 2074 616b 6520 636f 6f72 6469 6e61 7465   take coordinate
-0000fa60: 7320 6f66 2073 7461 7274 2c20 656e 642c  s of start, end,
-0000fa70: 2061 6e64 206d 6964 646c 650d 0a20 2020   and middle..   
-0000fa80: 2023 2020 2020 2020 2020 2020 2020 2020   #              
-0000fa90: 2020 2073 7461 7274 5f70 6f69 6e74 203d     start_point =
-0000faa0: 2067 656f 6d65 7472 792e 636f 6f72 6473   geometry.coords
-0000fab0: 5b30 5d0d 0a20 2020 2023 2020 2020 2020  [0]..    #      
-0000fac0: 2020 2020 2020 2020 2020 2065 6e64 5f70             end_p
-0000fad0: 6f69 6e74 203d 2067 656f 6d65 7472 792e  oint = geometry.
-0000fae0: 636f 6f72 6473 5b2d 315d 0d0a 2020 2020  coords[-1]..    
-0000faf0: 2320 2020 2020 2020 2020 2020 2020 2020  #               
-0000fb00: 2020 6d69 6464 6c65 5f70 6f69 6e74 203d    middle_point =
-0000fb10: 2067 656f 6d65 7472 792e 696e 7465 7270   geometry.interp
-0000fb20: 6f6c 6174 6528 302e 352c 206e 6f72 6d61  olate(0.5, norma
-0000fb30: 6c69 7a65 643d 5472 7565 292e 636f 6f72  lized=True).coor
-0000fb40: 6473 5b30 5d0d 0a20 2020 2020 2020 2020  ds[0]..         
-0000fb50: 2020 2020 2020 2020 2020 200d 0a20 2020             ..   
-0000fb60: 2023 2020 2020 2020 2020 2020 2020 2020   #              
-0000fb70: 2020 2063 6f6c 6c65 6374 6564 5f70 6f69     collected_poi
-0000fb80: 6e74 732e 6578 7465 6e64 285b 7374 6172  nts.extend([star
-0000fb90: 745f 706f 696e 742c 206d 6964 646c 655f  t_point, middle_
-0000fba0: 706f 696e 742c 2065 6e64 5f70 6f69 6e74  point, end_point
-0000fbb0: 5d29 0d0a 2020 2020 2320 2020 2020 2020  ])..    #       
-0000fbc0: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
-0000fbd0: 2023 2020 2020 2020 2020 2020 2020 2020   #              
-0000fbe0: 2020 2023 2046 6f72 2063 7572 7665 6420     # For curved 
-0000fbf0: 6c69 6e65 732c 2074 616b 6520 636f 6f72  lines, take coor
-0000fc00: 6469 6e61 7465 7320 6f66 2061 6c6c 2076  dinates of all v
-0000fc10: 6572 7469 6365 730d 0a20 2020 2023 2020  ertices..    #  
-0000fc20: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0000fc30: 6f72 2070 6f69 6e74 2069 6e20 6765 6f6d  or point in geom
-0000fc40: 6574 7279 2e63 6f6f 7264 733a 0d0a 2020  etry.coords:..  
-0000fc50: 2020 2320 2020 2020 2020 2020 2020 2020    #             
-0000fc60: 2020 2020 2020 2020 782c 2079 203d 2070          x, y = p
-0000fc70: 6f69 6e74 0d0a 2020 2020 2320 2020 2020  oint..    #     
-0000fc80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fc90: 636f 6c6c 6563 7465 645f 706f 696e 7473  collected_points
-0000fca0: 2e61 7070 656e 6428 2878 2c20 7929 290d  .append((x, y)).
-0000fcb0: 0a20 2020 2020 2020 200d 0a20 2020 2023  .        ..    #
-0000fcc0: 2020 2020 2072 6574 7572 6e20 636f 6c6c       return coll
-0000fcd0: 6563 7465 645f 706f 696e 7473 0d0a 0d0a  ected_points....
-0000fce0: 2320 4e6f 772c 2063 6f6f 7264 696e 6174  # Now, coordinat
-0000fcf0: 6573 5f6c 6973 7420 636f 6e74 6169 6e73  es_list contains
-0000fd00: 2074 6865 2063 6f6f 7264 696e 6174 6573   the coordinates
-0000fd10: 206f 6620 7374 6172 742c 2065 6e64 2c20   of start, end, 
-0000fd20: 6d69 6464 6c65 2c20 616e 6420 616c 6c20  middle, and all 
-0000fd30: 7665 7274 6963 6573 0d0a 2320 6261 7365  vertices..# base
-0000fd40: 6420 6f6e 2077 6865 7468 6572 2074 6865  d on whether the
-0000fd50: 206c 696e 6520 6973 2073 7472 6169 6768   line is straigh
-0000fd60: 7420 2833 206f 7220 6665 7765 7220 7665  t (3 or fewer ve
-0000fd70: 7274 6963 6573 2920 6f72 2063 7572 7665  rtices) or curve
-0000fd80: 640d 0a20 2020 2020 2020 200d 0a20 2020  d..        ..   
-0000fd90: 200d 0a0d 0a20 2020 2064 6566 2064 7261   ....    def dra
-0000fda0: 775f 706c 616e 6573 5f66 726f 6d5f 6c69  w_planes_from_li
-0000fdb0: 6e65 7328 7878 2c79 7929 3a0d 0a20 2020  nes(xx,yy):..   
-0000fdc0: 2020 2020 2067 6c6f 6261 6c20 6178 5f32       global ax_2
-0000fdd0: 642c 2061 785f 3364 2c20 6461 7461 2c20  d, ax_3d, data, 
-0000fde0: 7472 616e 7366 6f72 6d2c 206c 6566 742c  transform, left,
-0000fdf0: 2072 6967 6874 2c20 626f 7474 6f6d 2c20   right, bottom, 
-0000fe00: 746f 702c 2070 6c61 6e65 7320 0d0a 2020  top, planes ..  
-0000fe10: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
-0000fe20: 6461 7461 2c20 7472 616e 7366 6f72 6d2c  data, transform,
-0000fe30: 2070 726f 6a65 6374 696f 6e20 3d20 7265   projection = re
-0000fe40: 6164 5f64 656d 2864 656d 5f64 6174 6129  ad_dem(dem_data)
-0000fe50: 0d0a 0d0a 2020 2020 2020 2020 6764 6620  ....        gdf 
-0000fe60: 3d20 6770 642e 7265 6164 5f66 696c 6528  = gpd.read_file(
-0000fe70: 6c69 6e65 5f73 6861 7065 6669 6c65 290d  line_shapefile).
-0000fe80: 0a20 2020 2020 2020 2069 6620 6764 662e  .        if gdf.
-0000fe90: 6372 732e 746f 5f73 7472 696e 6728 2920  crs.to_string() 
-0000fea0: 213d 2070 726f 6a65 6374 696f 6e3a 0d0a  != projection:..
-0000feb0: 2020 2020 2020 2020 2020 2020 6764 6620              gdf 
-0000fec0: 3d20 6764 662e 746f 5f63 7273 2870 726f  = gdf.to_crs(pro
-0000fed0: 6a65 6374 696f 6e29 0d0a 0d0a 2020 2020  jection)....    
-0000fee0: 2020 2020 706f 696e 745f 7365 7473 203d      point_sets =
-0000fef0: 2063 6f6c 6c65 6374 5f70 6f69 6e74 735f   collect_points_
-0000ff00: 6672 6f6d 5f6c 696e 6528 6764 6629 0d0a  from_line(gdf)..
-0000ff10: 2020 2020 2020 2020 2320 785f 636f 6f72          # x_coor
-0000ff20: 6473 203d 206e 702e 6c69 6e73 7061 6365  ds = np.linspace
-0000ff30: 286c 6566 742c 2072 6967 6874 2c20 6461  (left, right, da
-0000ff40: 7461 2e73 6861 7065 5b31 5d29 0d0a 2020  ta.shape[1])..  
-0000ff50: 2020 2020 2020 2320 795f 636f 6f72 6473        # y_coords
-0000ff60: 203d 206e 702e 6c69 6e73 7061 6365 2874   = np.linspace(t
-0000ff70: 6f70 2c20 626f 7474 6f6d 2c20 6461 7461  op, bottom, data
-0000ff80: 2e73 6861 7065 5b30 5d29 0d0a 2020 2020  .shape[0])..    
-0000ff90: 2020 2020 2320 7878 2c20 7979 203d 206e      # xx, yy = n
-0000ffa0: 702e 6d65 7368 6772 6964 2878 5f63 6f6f  p.meshgrid(x_coo
-0000ffb0: 7264 732c 2079 5f63 6f6f 7264 7329 0d0a  rds, y_coords)..
-0000ffc0: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
-0000ffd0: 2020 6672 6f6d 2074 7164 6d20 696d 706f    from tqdm impo
-0000ffe0: 7274 2074 7164 6d0d 0a20 2020 2020 2020  rt tqdm..       
-0000fff0: 2070 6c61 6e65 733d 5b5d 0d0a 2020 2020   planes=[]..    
-00010000: 2020 2020 666f 7220 706f 696e 7473 2069      for points i
-00010010: 6e20 7471 646d 2870 6f69 6e74 5f73 6574  n tqdm(point_set
-00010020: 732c 2064 6573 633d 2250 726f 6365 7373  s, desc="Process
-00010030: 696e 6720 6669 7474 6564 2070 6c61 6e65  ing fitted plane
-00010040: 7322 293a 0d0a 2020 2020 2020 2020 2020  s"):..          
-00010050: 2020 2370 7269 6e74 2827 706f 696e 7473    #print('points
-00010060: 3a20 272c 2070 6f69 6e74 7329 0d0a 2020  : ', points)..  
-00010070: 2020 2020 2020 2020 2020 237a 5f76 616c            #z_val
-00010080: 7565 7320 3d20 5b64 6174 615b 696e 7428  ues = [data[int(
-00010090: 2870 6f69 6e74 5b31 5d20 2d20 746f 7029  (point[1] - top)
-000100a0: 202f 2061 6273 2874 7261 6e73 666f 726d   / abs(transform
-000100b0: 5b35 5d29 292c 2069 6e74 2828 706f 696e  [5])), int((poin
-000100c0: 745b 305d 202d 206c 6566 7429 202f 2074  t[0] - left) / t
-000100d0: 7261 6e73 666f 726d 5b31 5d29 5d20 666f  ransform[1])] fo
-000100e0: 7220 706f 696e 7420 696e 2070 6f69 6e74  r point in point
-000100f0: 735d 0d0a 2020 2020 2020 2020 2020 2020  s]..            
-00010100: 0d0a 2020 2020 2020 2020 2020 2020 7a5f  ..            z_
-00010110: 7661 6c75 6573 203d 205b 5d0d 0a0d 0a20  values = [].... 
-00010120: 2020 2020 2020 2020 2020 2066 6f72 2070             for p
-00010130: 6f69 6e74 2069 6e20 706f 696e 7473 3a0d  oint in points:.
-00010140: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010150: 2079 5f69 6e64 6578 203d 2069 6e74 2828   y_index = int((
-00010160: 706f 696e 745b 315d 202d 2074 6f70 2920  point[1] - top) 
-00010170: 2f20 6162 7328 7472 616e 7366 6f72 6d5b  / abs(transform[
-00010180: 355d 2929 0d0a 2020 2020 2020 2020 2020  5]))..          
-00010190: 2020 2020 2020 2320 795f 696e 6465 7820        # y_index 
-000101a0: 3d20 696e 7428 2870 6f69 6e74 5b31 5d20  = int((point[1] 
-000101b0: 2d20 746f 7029 202f 2061 6273 2874 7261  - top) / abs(tra
-000101c0: 6e73 666f 726d 5b35 5d29 2920 6966 2069  nsform[5])) if i
-000101d0: 7369 6e73 7461 6e63 6528 706f 696e 745b  sinstance(point[
-000101e0: 315d 2c20 2869 6e74 2c20 666c 6f61 7429  1], (int, float)
-000101f0: 2920 616e 6420 6973 696e 7374 616e 6365  ) and isinstance
-00010200: 2874 7261 6e73 666f 726d 5b35 5d2c 2028  (transform[5], (
-00010210: 696e 742c 2066 6c6f 6174 2929 2065 6c73  int, float)) els
-00010220: 6520 4e6f 6e65 0d0a 2020 2020 2020 2020  e None..        
-00010230: 2020 2020 2020 2020 2320 785f 696e 6465          # x_inde
-00010240: 7820 3d20 696e 7428 2870 6f69 6e74 5b30  x = int((point[0
-00010250: 5d20 2d20 746f 7029 202f 2061 6273 2874  ] - top) / abs(t
-00010260: 7261 6e73 666f 726d 5b31 5d29 2920 6966  ransform[1])) if
-00010270: 2069 7369 6e73 7461 6e63 6528 706f 696e   isinstance(poin
-00010280: 745b 305d 2c20 2869 6e74 2c20 666c 6f61  t[0], (int, floa
-00010290: 7429 2920 616e 6420 6973 696e 7374 616e  t)) and isinstan
-000102a0: 6365 2874 7261 6e73 666f 726d 5b31 5d2c  ce(transform[1],
-000102b0: 2028 696e 742c 2066 6c6f 6174 2929 2065   (int, float)) e
-000102c0: 6c73 6520 4e6f 6e65 0d0a 0d0a 2020 2020  lse None....    
-000102d0: 2020 2020 2020 2020 2020 2020 785f 696e              x_in
-000102e0: 6465 7820 3d20 696e 7428 2870 6f69 6e74  dex = int((point
-000102f0: 5b30 5d20 2d20 6c65 6674 2920 2f20 7472  [0] - left) / tr
-00010300: 616e 7366 6f72 6d5b 315d 290d 0a20 2020  ansform[1])..   
-00010310: 2020 2020 2020 2020 2020 2020 200d 0a20               .. 
-00010320: 2020 2020 2020 2020 2020 2020 2020 207a                 z
-00010330: 5f76 616c 7565 203d 2064 6174 615b 795f  _value = data[y_
-00010340: 696e 6465 785d 5b78 5f69 6e64 6578 5d0d  index][x_index].
-00010350: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010360: 200d 0a20 2020 2020 2020 2020 2020 2020   ..             
-00010370: 2020 207a 5f76 616c 7565 732e 6170 7065     z_values.appe
-00010380: 6e64 287a 5f76 616c 7565 290d 0a0d 0a20  nd(z_value).... 
-00010390: 2020 2020 2020 2020 2020 2078 797a 5f70             xyz_p
-000103a0: 6f69 6e74 7320 3d20 5b70 6f69 6e74 735b  oints = [points[
-000103b0: 695d 202b 2028 7a5f 7661 6c75 6573 5b69  i] + (z_values[i
-000103c0: 5d2c 2920 666f 7220 6920 696e 2072 616e  ],) for i in ran
-000103d0: 6765 286c 656e 287a 5f76 616c 7565 7329  ge(len(z_values)
-000103e0: 295d 0d0a 0d0a 2020 2020 2020 2020 2020  )]....          
-000103f0: 2020 6966 206c 656e 2878 797a 5f70 6f69    if len(xyz_poi
-00010400: 6e74 7329 203e 3d20 333a 0d0a 2020 2020  nts) >= 3:..    
-00010410: 2020 2020 2020 2020 2020 2020 6669 7474              fitt
-00010420: 6564 5f70 6c61 6e65 2c20 612c 2062 2c20  ed_plane, a, b, 
-00010430: 632c 2064 6970 5f61 6e67 6c65 2c20 6469  c, dip_angle, di
-00010440: 705f 6469 7265 6374 696f 6e20 3d20 6669  p_direction = fi
-00010450: 745f 706c 616e 6528 7879 7a5f 706f 696e  t_plane(xyz_poin
-00010460: 7473 2c20 7878 2c20 7979 290d 0a20 2020  ts, xx, yy)..   
-00010470: 2020 2020 2020 2020 2020 2020 200d 0a20               .. 
-00010480: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00010490: 6970 5f61 6e67 6c65 5f6c 6973 742e 6170  ip_angle_list.ap
-000104a0: 7065 6e64 2864 6970 5f61 6e67 6c65 290d  pend(dip_angle).
-000104b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000104c0: 2064 6970 5f64 6972 6563 7469 6f6e 5f6c   dip_direction_l
-000104d0: 6973 742e 6170 7065 6e64 2864 6970 5f64  ist.append(dip_d
-000104e0: 6972 6563 7469 6f6e 290d 0a20 2020 2020  irection)..     
-000104f0: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
-00010500: 2020 2020 2020 2020 2023 2069 6620 6c69           # if li
-00010510: 6d69 745f 6578 7465 6e64 3a0d 0a20 2020  mit_extend:..   
-00010520: 2020 2020 2020 2020 2020 2020 2023 2020               #  
-00010530: 2020 2023 2047 6574 2062 6f75 6e64 696e     # Get boundin
-00010540: 6720 626f 7820 6f66 2074 6865 2073 656c  g box of the sel
-00010550: 6563 7465 6420 706f 696e 7473 0d0a 2020  ected points..  
-00010560: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00010570: 2020 2020 786d 696e 2c20 786d 6178 2c20      xmin, xmax, 
-00010580: 796d 696e 2c20 796d 6178 203d 2062 6f75  ymin, ymax = bou
-00010590: 6e64 696e 675f 626f 7828 7879 7a5f 706f  nding_box(xyz_po
-000105a0: 696e 7473 290d 0a20 2020 2020 2020 2020  ints)..         
-000105b0: 2020 2020 2020 2020 2020 200d 0a20 2020             ..   
-000105c0: 2020 2020 2020 2020 2020 2020 2023 2020               #  
-000105d0: 2020 206d 6173 6b20 3d20 2878 7820 3e3d     mask = (xx >=
-000105e0: 2078 6d69 6e29 2026 2028 7878 203c 3d20   xmin) & (xx <= 
-000105f0: 786d 6178 2920 2620 2879 7920 3e3d 2079  xmax) & (yy >= y
-00010600: 6d69 6e29 2026 2028 7979 203c 3d20 796d  min) & (yy <= ym
-00010610: 6178 290d 0a20 2020 2020 2020 2020 2020  ax)..           
-00010620: 2020 2020 2020 2020 200d 0a20 2020 2020           ..     
-00010630: 2020 2020 2020 2020 2020 2023 2020 2020             #    
-00010640: 2066 6f72 2069 2069 6e20 7261 6e67 6528   for i in range(
-00010650: 7878 2e73 6861 7065 5b30 5d29 3a0d 0a20  xx.shape[0]):.. 
-00010660: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00010670: 2020 2020 2020 2020 2066 6f72 206a 2069           for j i
-00010680: 6e20 7261 6e67 6528 7878 2e73 6861 7065  n range(xx.shape
-00010690: 5b31 5d29 3a0d 0a20 2020 2020 2020 2020  [1]):..         
-000106a0: 2020 2020 2020 2023 2020 2020 2020 2020         #        
-000106b0: 2020 2020 2069 6620 6e6f 7420 6d61 736b       if not mask
-000106c0: 5b69 2c20 6a5d 3a0d 0a20 2020 2020 2020  [i, j]:..       
-000106d0: 2020 2020 2020 2020 2023 2020 2020 2020           #      
-000106e0: 2020 2020 2020 2020 2020 2066 6974 7465             fitte
-000106f0: 645f 706c 616e 655b 692c 206a 5d20 3d20  d_plane[i, j] = 
-00010700: 6e70 2e6e 616e 2020 2320 5365 7420 6f75  np.nan  # Set ou
-00010710: 742d 6f66 2d62 6f75 6e64 7320 7661 6c75  t-of-bounds valu
-00010720: 6573 2074 6f20 4e61 4e0d 0a20 2020 2020  es to NaN..     
-00010730: 2020 2020 2020 2020 2020 2023 2323 2323             #####
-00010740: 2323 2323 2323 0d0a 2020 2020 2020 2020  ######..        
-00010750: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
-00010760: 2020 2020 2020 2020 2020 2323 2323 2323            ######
-00010770: 2323 230d 0a20 2020 2020 2020 2020 2020  ###..           
-00010780: 200d 0a20 2020 2020 2020 2020 2020 2020   ..             
-00010790: 2020 2070 6c61 6e65 732e 6170 7065 6e64     planes.append
-000107a0: 2866 6974 7465 645f 706c 616e 6529 0d0a  (fitted_plane)..
-000107b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000107c0: 2370 6c61 6e65 5f63 6f6c 6f72 203d 2072  #plane_color = r
-000107d0: 616e 646f 6d5f 636f 6c6f 7228 290d 0a20  andom_color().. 
-000107e0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-000107f0: 6c61 6e65 5f63 6f6c 6f72 3d63 6f6c 6f72  lane_color=color
-00010800: 5f66 726f 6d5f 6469 705f 616e 645f 6469  _from_dip_and_di
-00010810: 7265 6374 696f 6e28 6469 705f 616e 676c  rection(dip_angl
-00010820: 652c 2064 6970 5f64 6972 6563 7469 6f6e  e, dip_direction
-00010830: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-00010840: 2020 2070 6c61 6e65 5f63 6f6c 6f72 732e     plane_colors.
-00010850: 6170 7065 6e64 2870 6c61 6e65 5f63 6f6c  append(plane_col
-00010860: 6f72 290d 0a20 2020 2020 2020 2020 2020  or)..           
-00010870: 2020 2020 200d 0a20 2020 2020 2020 2020       ..         
-00010880: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
-00010890: 200d 0a20 2020 2020 2020 2020 2020 2023   ..            #
-000108a0: 2323 230d 0a20 2020 2020 2020 2020 2020  ###..           
-000108b0: 2020 2020 2066 6f72 2070 6f69 6e74 6e20       for pointn 
-000108c0: 696e 2078 797a 5f70 6f69 6e74 733a 0d0a  in xyz_points:..
-000108d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000108e0: 2020 2020 6178 5f32 642e 706c 6f74 2870      ax_2d.plot(p
-000108f0: 6f69 6e74 6e5b 305d 2c20 706f 696e 746e  ointn[0], pointn
-00010900: 5b31 5d2c 2027 6f27 2c20 636f 6c6f 723d  [1], 'o', color=
-00010910: 706c 616e 655f 636f 6c6f 722c 2061 6c70  plane_color, alp
-00010920: 6861 3d30 2e37 290d 0a20 2020 2020 2020  ha=0.7)..       
-00010930: 2020 2020 2020 2020 2063 616e 7661 735f           canvas_
-00010940: 3264 2e64 7261 7728 290d 0a0d 0a20 2020  2d.draw()....   
-00010950: 2020 2020 2020 2020 2020 2020 2023 6178               #ax
-00010960: 5f33 642e 636c 6561 7228 290d 0a20 2020  _3d.clear()..   
-00010970: 2020 2020 2020 2020 2020 2020 2061 785f               ax_
-00010980: 3364 2e73 6574 5f74 6974 6c65 2827 3344  3d.set_title('3D
-00010990: 2044 454d 2077 6974 6820 4669 7474 6564   DEM with Fitted
-000109a0: 2050 6c61 6e65 7327 290d 0a20 2020 2020   Planes')..     
-000109b0: 2020 2020 2020 2020 2020 2061 785f 3364             ax_3d
-000109c0: 2e70 6c6f 745f 7375 7266 6163 6528 7878  .plot_surface(xx
-000109d0: 2c20 7979 2c20 6461 7461 2c20 636d 6170  , yy, data, cmap
-000109e0: 3d27 7465 7272 6169 6e27 2c20 6c69 6e65  ='terrain', line
-000109f0: 7769 6474 683d 302c 2061 6e74 6961 6c69  width=0, antiali
-00010a00: 6173 6564 3d54 7275 652c 2061 6c70 6861  ased=True, alpha
-00010a10: 3d30 2e35 290d 0a20 2020 2020 2020 2020  =0.5)..         
-00010a20: 2020 2020 2020 2023 666f 7220 706c 616e         #for plan
-00010a30: 6520 696e 2070 6c61 6e65 733a 0d0a 2020  e in planes:..  
-00010a40: 2020 2020 2020 2020 2020 2020 2020 6178                ax
-00010a50: 5f33 642e 706c 6f74 5f73 7572 6661 6365  _3d.plot_surface
-00010a60: 2878 782c 2079 792c 2066 6974 7465 645f  (xx, yy, fitted_
-00010a70: 706c 616e 652c 2061 6c70 6861 3d30 2e36  plane, alpha=0.6
-00010a80: 2c20 6c69 6e65 7769 6474 683d 302c 2061  , linewidth=0, a
-00010a90: 6e74 6961 6c69 6173 6564 3d54 7275 652c  ntialiased=True,
-00010aa0: 2063 6f6c 6f72 3d70 6c61 6e65 5f63 6f6c   color=plane_col
-00010ab0: 6f72 290d 0a20 2020 2020 2020 2020 2020  or)..           
-00010ac0: 2020 2020 2063 616e 7661 735f 3364 2e64       canvas_3d.d
-00010ad0: 7261 7728 290d 0a20 2020 2020 2020 2020  raw()..         
-00010ae0: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
-00010af0: 2020 2020 2020 2020 2070 6c6f 745f 706c           plot_pl
-00010b00: 616e 6573 2864 6970 5f61 6e67 6c65 5f6c  anes(dip_angle_l
-00010b10: 6973 742c 2064 6970 5f64 6972 6563 7469  ist, dip_directi
-00010b20: 6f6e 5f6c 6973 742c 2070 6c61 6e65 5f63  on_list, plane_c
-00010b30: 6f6c 6f72 7329 0d0a 2020 2020 2020 2020  olors)..        
-00010b40: 2020 2020 0d0a 2020 2020 2020 2020 0d0a      ..        ..
-00010b50: 2020 2020 0d0a 0d0a 2020 2020 6465 6620      ....    def 
-00010b60: 706c 6f74 5f64 656d 2864 6174 612c 2074  plot_dem(data, t
-00010b70: 7261 6e73 666f 726d 2c20 7072 6f6a 6563  ransform, projec
-00010b80: 7469 6f6e 2c20 7061 7468 5f74 6f5f 7368  tion, path_to_sh
-00010b90: 6170 6566 696c 6529 3a0d 0a20 2020 2020  apefile):..     
-00010ba0: 2020 2067 6c6f 6261 6c20 6178 5f32 642c     global ax_2d,
-00010bb0: 2061 785f 3364 2c20 706f 696e 7473 2c20   ax_3d, points, 
-00010bc0: 6361 6e76 6173 5f32 642c 2063 616e 7661  canvas_2d, canva
-00010bd0: 735f 3364 2c20 706f 696e 7473 5f6c 6973  s_3d, points_lis
-00010be0: 7462 6f78 2c20 706c 616e 6573 2c20 706c  tbox, planes, pl
-00010bf0: 616e 655f 636f 6c6f 7273 2c20 6873 2c20  ane_colors, hs, 
-00010c00: 6c65 6674 2c20 7269 6768 742c 2062 6f74  left, right, bot
-00010c10: 746f 6d2c 2074 6f70 0d0a 2020 2020 2020  tom, top..      
-00010c20: 2020 706f 696e 7473 203d 205b 5d0d 0a20    points = [].. 
-00010c30: 2020 2020 2020 2070 6c61 6e65 7320 3d20         planes = 
-00010c40: 5b5d 0d0a 2020 2020 2020 2020 706c 616e  []..        plan
-00010c50: 655f 636f 6c6f 7273 203d 205b 5d0d 0a20  e_colors = [].. 
-00010c60: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
-00010c70: 200d 0a0d 0a20 2020 2020 2020 2068 7320   ....        hs 
-00010c80: 3d20 6573 2e68 696c 6c73 6861 6465 2864  = es.hillshade(d
-00010c90: 6174 6129 0d0a 0d0a 2020 2020 2020 2020  ata)....        
-00010ca0: 726f 6f74 203d 2074 6b2e 546b 2829 0d0a  root = tk.Tk()..
-00010cb0: 2020 2020 2020 2020 726f 6f74 2e74 6974          root.tit
-00010cc0: 6c65 2822 416b 6864 6566 6f5f 4669 7450  le("Akhdefo_FitP
-00010cd0: 6c61 6e65 7322 290d 0a0d 0a20 2020 2020  lanes")....     
-00010ce0: 2020 206c 6566 742c 2063 656c 6c5f 7369     left, cell_si
-00010cf0: 7a65 5f78 2c20 5f2c 2074 6f70 2c20 5f2c  ze_x, _, top, _,
-00010d00: 2063 656c 6c5f 7369 7a65 5f79 203d 2074   cell_size_y = t
-00010d10: 7261 6e73 666f 726d 0d0a 2020 2020 2020  ransform..      
-00010d20: 2020 0d0a 2020 2020 2020 200d 0a20 2020    ..       ..   
-00010d30: 2020 2020 2072 6967 6874 203d 206c 6566       right = lef
-00010d40: 7420 2b20 6365 6c6c 5f73 697a 655f 7820  t + cell_size_x 
-00010d50: 2a20 6461 7461 2e73 6861 7065 5b31 5d0d  * data.shape[1].
-00010d60: 0a20 2020 2020 2020 2062 6f74 746f 6d20  .        bottom 
-00010d70: 3d20 746f 7020 2b20 6365 6c6c 5f73 697a  = top + cell_siz
-00010d80: 655f 7920 2a20 6461 7461 2e73 6861 7065  e_y * data.shape
-00010d90: 5b30 5d0d 0a0d 0a20 2020 2020 2020 2066  [0]....        f
-00010da0: 6967 3120 3d20 706c 742e 4669 6775 7265  ig1 = plt.Figure
-00010db0: 2866 6967 7369 7a65 3d28 362c 2036 292c  (figsize=(6, 6),
-00010dc0: 2064 7069 3d31 3530 290d 0a20 2020 2020   dpi=150)..     
-00010dd0: 2020 2061 785f 3264 203d 2066 6967 312e     ax_2d = fig1.
-00010de0: 6164 645f 7375 6270 6c6f 7428 3131 3129  add_subplot(111)
-00010df0: 0d0a 2020 2020 2020 2020 6178 5f32 642e  ..        ax_2d.
-00010e00: 696d 7368 6f77 2868 732c 2063 6d61 703d  imshow(hs, cmap=
-00010e10: 2767 7261 7927 2c20 6578 7465 6e74 3d5b  'gray', extent=[
-00010e20: 6c65 6674 2c20 7269 6768 742c 2062 6f74  left, right, bot
-00010e30: 746f 6d2c 2074 6f70 5d29 0d0a 2020 2020  tom, top])..    
-00010e40: 2020 2020 6178 5f32 642e 7365 745f 7469      ax_2d.set_ti
-00010e50: 746c 6528 2748 696c 6c73 6861 6465 272c  tle('Hillshade',
-00010e60: 2066 6f6e 7477 6569 6768 743d 2262 6f6c   fontweight="bol
-00010e70: 6422 2c20 666f 6e74 7369 7a65 3d31 3429  d", fontsize=14)
-00010e80: 0d0a 2020 2020 2020 2020 6178 5f32 642e  ..        ax_2d.
-00010e90: 7365 745f 786c 6162 656c 2822 4c6f 6e67  set_xlabel("Long
-00010ea0: 6974 7564 6522 2c20 666f 6e74 7369 7a65  itude", fontsize
-00010eb0: 3d31 3229 0d0a 2020 2020 2020 2020 6178  =12)..        ax
-00010ec0: 5f32 642e 7365 745f 796c 6162 656c 2822  _2d.set_ylabel("
-00010ed0: 4c61 7469 7475 6465 222c 2066 6f6e 7473  Latitude", fonts
-00010ee0: 697a 653d 3132 290d 0a20 2020 2020 2020  ize=12)..       
-00010ef0: 2061 785f 3264 2e67 7269 6428 5472 7565   ax_2d.grid(True
-00010f00: 2c20 7768 6963 683d 2762 6f74 6827 2c20  , which='both', 
-00010f10: 6c69 6e65 7374 796c 653d 272d 2d27 2c20  linestyle='--', 
-00010f20: 6c69 6e65 7769 6474 683d 302e 3529 0d0a  linewidth=0.5)..
-00010f30: 2020 2020 2020 2020 6178 5f32 642e 7365          ax_2d.se
-00010f40: 745f 6173 7065 6374 2827 6571 7561 6c27  t_aspect('equal'
-00010f50: 290d 0a20 2020 2020 2020 200d 0a20 2020  )..        ..   
-00010f60: 2020 2020 200d 0a20 2020 2020 2020 200d       ..        .
-00010f70: 0a20 2020 2020 2020 2069 6620 7061 7468  .        if path
-00010f80: 5f74 6f5f 7368 6170 6566 696c 6520 6973  _to_shapefile is
-00010f90: 206e 6f74 204e 6f6e 653a 0d0a 2020 2020   not None:..    
-00010fa0: 2020 2020 2020 2020 6764 6620 3d20 6770          gdf = gp
-00010fb0: 642e 7265 6164 5f66 696c 6528 7061 7468  d.read_file(path
-00010fc0: 5f74 6f5f 7368 6170 6566 696c 6529 0d0a  _to_shapefile)..
-00010fd0: 2020 2020 2020 2020 2020 2020 6966 2067              if g
-00010fe0: 6466 2e63 7273 2e74 6f5f 7374 7269 6e67  df.crs.to_string
-00010ff0: 2829 2021 3d20 7072 6f6a 6563 7469 6f6e  () != projection
-00011000: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00011010: 2020 2067 6466 203d 2067 6466 2e74 6f5f     gdf = gdf.to_
-00011020: 6372 7328 7072 6f6a 6563 7469 6f6e 290d  crs(projection).
-00011030: 0a20 2020 2020 2020 2020 2020 2067 6466  .            gdf
-00011040: 2e70 6c6f 7428 6178 3d61 785f 3264 2c20  .plot(ax=ax_2d, 
-00011050: 636f 6c6f 723d 2772 6564 272c 206c 6162  color='red', lab
-00011060: 656c 3d22 4c69 6e65 6172 2046 6561 7475  el="Linear Featu
-00011070: 7265 7322 290d 0a20 2020 2020 2020 2020  res")..         
-00011080: 2020 2061 785f 3264 2e6c 6567 656e 6428     ax_2d.legend(
-00011090: 6c6f 633d 2275 7070 6572 206c 6566 7422  loc="upper left"
-000110a0: 290d 0a20 2020 2020 2020 200d 0a20 2020  )..        ..   
-000110b0: 2020 2020 2066 6967 3220 3d20 706c 742e       fig2 = plt.
-000110c0: 4669 6775 7265 2866 6967 7369 7a65 3d28  Figure(figsize=(
-000110d0: 362c 2036 292c 2064 7069 3d31 3530 290d  6, 6), dpi=150).
-000110e0: 0a20 2020 2020 2020 2023 2043 7265 6174  .        # Creat
-000110f0: 6520 6120 6669 6775 7265 2061 6e64 2061  e a figure and a
-00011100: 7869 730d 0a20 2020 2020 2020 2061 785f  xis..        ax_
-00011110: 3364 203d 2066 6967 322e 6164 645f 7375  3d = fig2.add_su
-00011120: 6270 6c6f 7428 3131 312c 2070 726f 6a65  bplot(111, proje
-00011130: 6374 696f 6e3d 2733 6427 290d 0a20 2020  ction='3d')..   
-00011140: 2020 2020 2061 785f 3364 2e73 6574 5f74       ax_3d.set_t
-00011150: 6974 6c65 2827 3344 2044 454d 2077 6974  itle('3D DEM wit
-00011160: 6820 4669 7474 6564 2050 6c61 6e65 7327  h Fitted Planes'
-00011170: 2c20 666f 6e74 7765 6967 6874 3d22 626f  , fontweight="bo
-00011180: 6c64 222c 2066 6f6e 7473 697a 653d 3134  ld", fontsize=14
-00011190: 290d 0a20 2020 2020 2020 2061 785f 3364  )..        ax_3d
-000111a0: 2e73 6574 5f78 6c61 6265 6c28 224c 6f6e  .set_xlabel("Lon
-000111b0: 6769 7475 6465 222c 2066 6f6e 7473 697a  gitude", fontsiz
-000111c0: 653d 3132 290d 0a20 2020 2020 2020 2061  e=12)..        a
-000111d0: 785f 3364 2e73 6574 5f79 6c61 6265 6c28  x_3d.set_ylabel(
-000111e0: 224c 6174 6974 7564 6522 2c20 666f 6e74  "Latitude", font
-000111f0: 7369 7a65 3d31 3229 0d0a 2020 2020 2020  size=12)..      
-00011200: 2020 6178 5f33 642e 7365 745f 7a6c 6162    ax_3d.set_zlab
-00011210: 656c 2822 456c 6576 6174 696f 6e22 2c20  el("Elevation", 
-00011220: 666f 6e74 7369 7a65 3d31 3229 0d0a 2020  fontsize=12)..  
-00011230: 2020 2020 2020 785f 636f 6f72 6473 203d        x_coords =
-00011240: 206e 702e 6c69 6e73 7061 6365 286c 6566   np.linspace(lef
-00011250: 742c 2072 6967 6874 2c20 6461 7461 2e73  t, right, data.s
-00011260: 6861 7065 5b31 5d29 0d0a 2020 2020 2020  hape[1])..      
-00011270: 2020 795f 636f 6f72 6473 203d 206e 702e    y_coords = np.
-00011280: 6c69 6e73 7061 6365 2874 6f70 2c20 626f  linspace(top, bo
-00011290: 7474 6f6d 2c20 6461 7461 2e73 6861 7065  ttom, data.shape
-000112a0: 5b30 5d29 0d0a 2020 2020 2020 2020 7878  [0])..        xx
-000112b0: 2c20 7979 203d 206e 702e 6d65 7368 6772  , yy = np.meshgr
-000112c0: 6964 2878 5f63 6f6f 7264 732c 2079 5f63  id(x_coords, y_c
-000112d0: 6f6f 7264 7329 0d0a 2020 2020 2020 2020  oords)..        
-000112e0: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
-000112f0: 2020 2020 0d0a 0d0a 2020 2020 2020 2020      ....        
-00011300: 0d0a 0d0a 2020 2020 2020 2020 2320 6178  ....        # ax
-00011310: 5f33 642e 7365 745f 786c 696d 285b 6c65  _3d.set_xlim([le
-00011320: 6674 2c20 7269 6768 745d 290d 0a20 2020  ft, right])..   
-00011330: 2020 2020 2023 2061 785f 3364 2e73 6574       # ax_3d.set
-00011340: 5f79 6c69 6d28 5b62 6f74 746f 6d2c 2074  _ylim([bottom, t
-00011350: 6f70 5d29 0d0a 2020 2020 2020 2020 2320  op])..        # 
-00011360: 6178 5f33 642e 7365 745f 7a6c 696d 285b  ax_3d.set_zlim([
-00011370: 7a6d 696e 2c20 7a6d 6178 5d29 0d0a 0d0a  zmin, zmax])....
-00011380: 2020 2020 2020 2020 6672 616d 655f 3264          frame_2d
-00011390: 203d 2074 6b2e 4672 616d 6528 726f 6f74   = tk.Frame(root
-000113a0: 290d 0a20 2020 2020 2020 2066 7261 6d65  )..        frame
-000113b0: 5f32 642e 6772 6964 2872 6f77 3d30 2c20  _2d.grid(row=0, 
-000113c0: 636f 6c75 6d6e 3d30 2c20 7374 6963 6b79  column=0, sticky
-000113d0: 3d27 6e73 6577 2729 0d0a 2020 2020 2020  ='nsew')..      
-000113e0: 2020 2320 6361 6e76 6173 5f32 6420 3d20    # canvas_2d = 
-000113f0: 4669 6775 7265 4361 6e76 6173 546b 4167  FigureCanvasTkAg
-00011400: 6728 6669 6731 2c20 6d61 7374 6572 3d66  g(fig1, master=f
-00011410: 7261 6d65 5f32 6429 0d0a 2020 2020 2020  rame_2d)..      
-00011420: 2020 2320 6361 6e76 6173 5f32 642e 6765    # canvas_2d.ge
-00011430: 745f 746b 5f77 6964 6765 7428 292e 7061  t_tk_widget().pa
-00011440: 636b 2866 696c 6c3d 746b 2e42 4f54 482c  ck(fill=tk.BOTH,
-00011450: 2065 7870 616e 643d 4661 6c73 6529 0d0a   expand=False)..
-00011460: 2020 2020 2020 2020 2320 746f 6f6c 6261          # toolba
-00011470: 725f 3264 203d 204e 6176 6967 6174 696f  r_2d = Navigatio
-00011480: 6e54 6f6f 6c62 6172 3254 6b28 6361 6e76  nToolbar2Tk(canv
-00011490: 6173 5f32 642c 2066 7261 6d65 5f32 6429  as_2d, frame_2d)
-000114a0: 0d0a 2020 2020 2020 2020 2320 746f 6f6c  ..        # tool
-000114b0: 6261 725f 3264 2e75 7064 6174 6528 290d  bar_2d.update().
-000114c0: 0a20 2020 2020 2020 2023 2043 7265 6174  .        # Creat
-000114d0: 6520 7468 6520 6361 6e76 6173 2066 6f72  e the canvas for
-000114e0: 2074 6865 2070 6c6f 740d 0a20 2020 2020   the plot..     
-000114f0: 2020 2063 616e 7661 735f 3264 203d 2046     canvas_2d = F
-00011500: 6967 7572 6543 616e 7661 7354 6b41 6767  igureCanvasTkAgg
-00011510: 2866 6967 312c 206d 6173 7465 723d 6672  (fig1, master=fr
-00011520: 616d 655f 3264 290d 0a20 2020 2020 2020  ame_2d)..       
-00011530: 2063 616e 7661 735f 3264 2e67 6574 5f74   canvas_2d.get_t
-00011540: 6b5f 7769 6467 6574 2829 2e70 6163 6b28  k_widget().pack(
-00011550: 6669 6c6c 3d74 6b2e 424f 5448 2c20 6578  fill=tk.BOTH, ex
-00011560: 7061 6e64 3d54 7275 6529 2020 2320 4669  pand=True)  # Fi
-00011570: 6c6c 2074 6865 2066 7261 6d65 0d0a 2020  ll the frame..  
-00011580: 2020 2020 2020 2320 4372 6561 7465 2074        # Create t
-00011590: 6865 2074 6f6f 6c62 6172 2061 6e64 2070  he toolbar and p
-000115a0: 6c61 6365 2069 7420 6174 2074 6865 2074  lace it at the t
-000115b0: 6f70 206f 6620 7468 6520 6361 6e76 6173  op of the canvas
-000115c0: 0d0a 2020 2020 2020 2020 746f 6f6c 6261  ..        toolba
-000115d0: 725f 3264 203d 204e 6176 6967 6174 696f  r_2d = Navigatio
-000115e0: 6e54 6f6f 6c62 6172 3254 6b28 6361 6e76  nToolbar2Tk(canv
-000115f0: 6173 5f32 642c 2066 7261 6d65 5f32 6429  as_2d, frame_2d)
-00011600: 0d0a 2020 2020 2020 2020 746f 6f6c 6261  ..        toolba
-00011610: 725f 3264 2e75 7064 6174 6528 290d 0a20  r_2d.update().. 
-00011620: 2020 2020 2020 2074 6f6f 6c62 6172 5f32         toolbar_2
-00011630: 642e 7061 636b 2873 6964 653d 746b 2e54  d.pack(side=tk.T
-00011640: 4f50 2c20 6669 6c6c 3d74 6b2e 5829 2020  OP, fill=tk.X)  
-00011650: 2320 5061 636b 2074 6865 2074 6f6f 6c62  # Pack the toolb
-00011660: 6172 2061 7420 7468 6520 746f 700d 0a20  ar at the top.. 
-00011670: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
-00011680: 2023 2323 2323 2323 6164 6420 636f 6c6f   #######add colo
-00011690: 7262 6172 2066 6967 7572 6520 746f 2043  rbar figure to C
-000116a0: 616e 7661 730d 0a20 2020 2020 2020 200d  anvas..        .
-000116b0: 0a0d 0a0d 0a0d 0a20 2020 2020 2020 2066  .......        f
-000116c0: 7261 6d65 5f33 6420 3d20 746b 2e46 7261  rame_3d = tk.Fra
-000116d0: 6d65 2872 6f6f 7429 0d0a 2020 2020 2020  me(root)..      
-000116e0: 2020 6672 616d 655f 3364 2e67 7269 6428    frame_3d.grid(
-000116f0: 726f 773d 302c 2063 6f6c 756d 6e3d 312c  row=0, column=1,
-00011700: 2073 7469 636b 793d 276e 7365 7727 290d   sticky='nsew').
-00011710: 0a20 2020 2020 2020 2023 2063 616e 7661  .        # canva
-00011720: 735f 3364 203d 2046 6967 7572 6543 616e  s_3d = FigureCan
-00011730: 7661 7354 6b41 6767 2866 6967 322c 206d  vasTkAgg(fig2, m
-00011740: 6173 7465 723d 6672 616d 655f 3364 290d  aster=frame_3d).
-00011750: 0a20 2020 2020 2020 2023 2063 616e 7661  .        # canva
-00011760: 735f 3364 2e67 6574 5f74 6b5f 7769 6467  s_3d.get_tk_widg
-00011770: 6574 2829 2e70 6163 6b28 6669 6c6c 3d74  et().pack(fill=t
-00011780: 6b2e 424f 5448 2c20 6578 7061 6e64 3d46  k.BOTH, expand=F
-00011790: 616c 7365 290d 0a20 2020 2020 2020 2023  alse)..        #
-000117a0: 2074 6f6f 6c62 6172 5f33 6420 3d20 4e61   toolbar_3d = Na
-000117b0: 7669 6761 7469 6f6e 546f 6f6c 6261 7232  vigationToolbar2
-000117c0: 546b 2863 616e 7661 735f 3364 2c20 6672  Tk(canvas_3d, fr
-000117d0: 616d 655f 3364 290d 0a20 2020 2020 2020  ame_3d)..       
-000117e0: 2023 2074 6f6f 6c62 6172 5f33 642e 7570   # toolbar_3d.up
-000117f0: 6461 7465 2829 0d0a 2020 2020 2020 2020  date()..        
-00011800: 6361 6e76 6173 5f33 6420 3d20 4669 6775  canvas_3d = Figu
-00011810: 7265 4361 6e76 6173 546b 4167 6728 6669  reCanvasTkAgg(fi
-00011820: 6732 2c20 6d61 7374 6572 3d66 7261 6d65  g2, master=frame
-00011830: 5f33 6429 0d0a 2020 2020 2020 2020 6361  _3d)..        ca
-00011840: 6e76 6173 5f33 642e 6765 745f 746b 5f77  nvas_3d.get_tk_w
-00011850: 6964 6765 7428 292e 7061 636b 2866 696c  idget().pack(fil
-00011860: 6c3d 746b 2e42 4f54 482c 2065 7870 616e  l=tk.BOTH, expan
-00011870: 643d 5472 7565 2920 2023 2046 696c 6c20  d=True)  # Fill 
-00011880: 7468 6520 6672 616d 650d 0a20 2020 2020  the frame..     
-00011890: 2020 2023 2043 7265 6174 6520 7468 6520     # Create the 
-000118a0: 746f 6f6c 6261 7220 616e 6420 706c 6163  toolbar and plac
-000118b0: 6520 6974 2061 7420 7468 6520 746f 7020  e it at the top 
-000118c0: 6f66 2074 6865 2063 616e 7661 730d 0a20  of the canvas.. 
-000118d0: 2020 2020 2020 2074 6f6f 6c62 6172 5f33         toolbar_3
-000118e0: 6420 3d20 4e61 7669 6761 7469 6f6e 546f  d = NavigationTo
-000118f0: 6f6c 6261 7232 546b 2863 616e 7661 735f  olbar2Tk(canvas_
-00011900: 3364 2c20 6672 616d 655f 3364 290d 0a20  3d, frame_3d).. 
-00011910: 2020 2020 2020 2074 6f6f 6c62 6172 5f33         toolbar_3
-00011920: 642e 7570 6461 7465 2829 0d0a 2020 2020  d.update()..    
-00011930: 2020 2020 746f 6f6c 6261 725f 3364 2e70      toolbar_3d.p
-00011940: 6163 6b28 7369 6465 3d74 6b2e 544f 502c  ack(side=tk.TOP,
-00011950: 2066 696c 6c3d 746b 2e58 2920 2023 2050   fill=tk.X)  # P
-00011960: 6163 6b20 7468 6520 746f 6f6c 6261 7220  ack the toolbar 
-00011970: 6174 2074 6865 2074 6f70 0d0a 0d0a 2020  at the top....  
-00011980: 2020 2020 2020 2320 4372 6561 7465 2061        # Create a
-00011990: 2066 7261 6d65 206f 6e20 7468 6520 7269   frame on the ri
-000119a0: 6768 7420 746f 2068 6f6c 6420 636f 6e74  ght to hold cont
-000119b0: 726f 6c73 0d0a 2020 2020 2020 2020 636f  rols..        co
-000119c0: 6e74 726f 6c73 5f66 7261 6d65 203d 2074  ntrols_frame = t
-000119d0: 6b2e 4672 616d 6528 726f 6f74 290d 0a20  k.Frame(root).. 
-000119e0: 2020 2020 2020 2063 6f6e 7472 6f6c 735f         controls_
-000119f0: 6672 616d 652e 6772 6964 2872 6f77 3d30  frame.grid(row=0
-00011a00: 2c20 636f 6c75 6d6e 3d33 2c20 726f 7773  , column=3, rows
-00011a10: 7061 6e3d 312c 2073 7469 636b 793d 276e  pan=1, sticky='n
-00011a20: 7365 7727 290d 0a20 2020 2020 2020 200d  sew')..        .
-00011a30: 0a0d 0a20 2020 2020 2020 2023 204e 6f77  ...        # Now
-00011a40: 2070 7574 2061 6c6c 2062 7574 746f 6e73   put all buttons
-00011a50: 2061 6e64 204c 6973 7462 6f78 2069 6e73   and Listbox ins
-00011a60: 6964 6520 7468 6973 2063 6f6e 7472 6f6c  ide this control
-00011a70: 735f 6672 616d 650d 0a20 2020 2020 2020  s_frame..       
-00011a80: 2064 7261 775f 6275 7474 6f6e 203d 2074   draw_button = t
-00011a90: 746b 2e42 7574 746f 6e28 636f 6e74 726f  tk.Button(contro
-00011aa0: 6c73 5f66 7261 6d65 2c20 7465 7874 3d22  ls_frame, text="
-00011ab0: 4472 6177 2050 6c61 6e65 222c 2063 6f6d  Draw Plane", com
-00011ac0: 6d61 6e64 3d6c 616d 6264 613a 2064 7261  mand=lambda: dra
-00011ad0: 775f 706c 616e 6528 7878 2c79 7929 290d  w_plane(xx,yy)).
-00011ae0: 0a20 2020 2020 2020 2064 7261 775f 6275  .        draw_bu
-00011af0: 7474 6f6e 2e70 6163 6b28 7061 6479 3d32  tton.pack(pady=2
-00011b00: 2c20 7061 6478 3d32 290d 0a0d 0a20 2020  , padx=2)....   
-00011b10: 2020 2020 206c 696e 655f 706c 616e 655f       line_plane_
-00011b20: 6275 7474 6f6e 203d 2074 746b 2e42 7574  button = ttk.But
-00011b30: 746f 6e28 636f 6e74 726f 6c73 5f66 7261  ton(controls_fra
-00011b40: 6d65 2c20 7465 7874 3d22 4372 6561 7465  me, text="Create
-00011b50: 2050 6c61 6e65 7320 6672 6f6d 204c 696e   Planes from Lin
-00011b60: 6573 222c 2063 6f6d 6d61 6e64 3d6c 616d  es", command=lam
-00011b70: 6264 613a 2064 7261 775f 706c 616e 6573  bda: draw_planes
-00011b80: 5f66 726f 6d5f 6c69 6e65 7328 7878 2c79  _from_lines(xx,y
-00011b90: 7929 290d 0a20 2020 2020 2020 206c 696e  y))..        lin
-00011ba0: 655f 706c 616e 655f 6275 7474 6f6e 2e70  e_plane_button.p
-00011bb0: 6163 6b28 7061 6479 3d32 2c20 7061 6478  ack(pady=2, padx
-00011bc0: 3d32 290d 0a0d 0a20 2020 2020 2020 2073  =2)....        s
-00011bd0: 6176 655f 706c 616e 655f 6275 7474 6f6e  ave_plane_button
-00011be0: 203d 2074 746b 2e42 7574 746f 6e28 636f   = ttk.Button(co
-00011bf0: 6e74 726f 6c73 5f66 7261 6d65 2c20 7465  ntrols_frame, te
-00011c00: 7874 3d22 5361 7665 2050 6c61 6e65 7320  xt="Save Planes 
-00011c10: 746f 204f 424a 222c 2063 6f6d 6d61 6e64  to OBJ", command
-00011c20: 3d73 6176 655f 706c 616e 6573 5f74 6f5f  =save_planes_to_
-00011c30: 6f62 6a29 2023 7361 7665 5f66 6974 7465  obj) #save_fitte
-00011c40: 645f 706c 616e 6573 5f61 735f 6478 660d  d_planes_as_dxf.
-00011c50: 0a20 2020 2020 2020 2073 6176 655f 706c  .        save_pl
-00011c60: 616e 655f 6275 7474 6f6e 2e70 6163 6b28  ane_button.pack(
-00011c70: 7061 6479 3d32 2c20 7061 6478 3d32 290d  pady=2, padx=2).
-00011c80: 0a20 2020 2020 2020 2023 2073 6176 655f  .        # save_
-00011c90: 706c 616e 655f 6275 7474 6f6e 5f64 7866  plane_button_dxf
-00011ca0: 203d 2074 746b 2e42 7574 746f 6e28 636f   = ttk.Button(co
-00011cb0: 6e74 726f 6c73 5f66 7261 6d65 2c20 7465  ntrols_frame, te
-00011cc0: 7874 3d22 5361 7665 2050 6c61 6e65 7320  xt="Save Planes 
-00011cd0: 746f 2044 5846 222c 2063 6f6d 6d61 6e64  to DXF", command
-00011ce0: 3d73 6176 655f 6669 7474 6564 5f70 6c61  =save_fitted_pla
-00011cf0: 6e65 735f 6173 5f64 7866 290d 0a20 2020  nes_as_dxf)..   
-00011d00: 2020 2020 2023 2073 6176 655f 706c 616e       # save_plan
-00011d10: 655f 6275 7474 6f6e 5f64 7866 2e70 6163  e_button_dxf.pac
-00011d20: 6b28 7061 6479 3d31 302c 2070 6164 783d  k(pady=10, padx=
-00011d30: 3130 290d 0a0d 0a20 2020 2020 2020 2070  10)....        p
-00011d40: 6f69 6e74 735f 6c69 7374 626f 7820 3d20  oints_listbox = 
-00011d50: 746b 2e4c 6973 7462 6f78 2863 6f6e 7472  tk.Listbox(contr
-00011d60: 6f6c 735f 6672 616d 652c 2068 6569 6768  ols_frame, heigh
-00011d70: 743d 352c 2077 6964 7468 3d34 302c 2065  t=5, width=40, e
-00011d80: 7870 6f72 7473 656c 6563 7469 6f6e 3d46  xportselection=F
-00011d90: 616c 7365 290d 0a20 2020 2020 2020 2070  alse)..        p
-00011da0: 6f69 6e74 735f 6c69 7374 626f 782e 7061  oints_listbox.pa
-00011db0: 636b 2870 6164 793d 322c 2070 6164 783d  ck(pady=2, padx=
-00011dc0: 322c 2066 696c 6c3d 2762 6f74 6827 2c20  2, fill='both', 
-00011dd0: 6578 7061 6e64 3d54 7275 6529 0d0a 2020  expand=True)..  
-00011de0: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
-00011df0: 7363 726f 6c6c 6261 7220 3d20 7474 6b2e  scrollbar = ttk.
-00011e00: 5363 726f 6c6c 6261 7228 636f 6e74 726f  Scrollbar(contro
-00011e10: 6c73 5f66 7261 6d65 2c20 6f72 6965 6e74  ls_frame, orient
-00011e20: 3d22 7665 7274 6963 616c 222c 2063 6f6d  ="vertical", com
-00011e30: 6d61 6e64 3d70 6f69 6e74 735f 6c69 7374  mand=points_list
-00011e40: 626f 782e 7976 6965 7729 0d0a 2020 2020  box.yview)..    
-00011e50: 2020 2020 7363 726f 6c6c 6261 722e 7061      scrollbar.pa
-00011e60: 636b 2873 6964 653d 746b 2e52 4947 4854  ck(side=tk.RIGHT
-00011e70: 2c20 6669 6c6c 3d74 6b2e 5929 0d0a 2020  , fill=tk.Y)..  
-00011e80: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
-00011e90: 706f 696e 7473 5f6c 6973 7462 6f78 2e63  points_listbox.c
-00011ea0: 6f6e 6669 6728 7973 6372 6f6c 6c63 6f6d  onfig(yscrollcom
-00011eb0: 6d61 6e64 3d73 6372 6f6c 6c62 6172 2e73  mand=scrollbar.s
-00011ec0: 6574 290d 0a20 2020 2020 2020 2070 6f69  et)..        poi
-00011ed0: 6e74 735f 6c69 7374 626f 782e 6269 6e64  nts_listbox.bind
-00011ee0: 2822 3c44 6f75 626c 652d 4275 7474 6f6e  ("<Double-Button
-00011ef0: 2d31 3e22 2c20 6f6e 5f70 6f69 6e74 5f64  -1>", on_point_d
-00011f00: 6f75 626c 655f 636c 6963 6b29 0d0a 2020  ouble_click)..  
-00011f10: 2020 2020 2020 2323 2323 0d0a 2020 2020        ####..    
-00011f20: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
-00011f30: 2020 2020 2323 2323 0d0a 0d0a 2020 2020      ####....    
-00011f40: 2020 2020 6669 6731 2e63 616e 7661 732e      fig1.canvas.
-00011f50: 6d70 6c5f 636f 6e6e 6563 7428 2762 7574  mpl_connect('but
-00011f60: 746f 6e5f 7072 6573 735f 6576 656e 7427  ton_press_event'
-00011f70: 2c20 6c61 6d62 6461 2065 7665 6e74 3a20  , lambda event: 
-00011f80: 6f6e 636c 6963 6b28 6576 656e 742c 2070  onclick(event, p
-00011f90: 6f69 6e74 732c 2064 6174 612c 2074 7261  oints, data, tra
-00011fa0: 6e73 666f 726d 2929 0d0a 2020 2020 2020  nsform))..      
-00011fb0: 2020 0d0a 2020 2020 2020 2020 0d0a 2020    ..        ..  
-00011fc0: 2020 2020 2020 2320 4164 6469 6e67 2074        # Adding t
-00011fd0: 6865 2073 697a 6520 6772 6970 2066 6f72  he size grip for
-00011fe0: 2077 696e 646f 7720 7265 7369 7a69 6e67   window resizing
-00011ff0: 0d0a 2020 2020 2020 2020 7369 7a65 6772  ..        sizegr
-00012000: 6970 203d 2074 746b 2e53 697a 6567 7269  ip = ttk.Sizegri
-00012010: 7028 726f 6f74 290d 0a20 2020 2020 2020  p(root)..       
-00012020: 2073 697a 6567 7269 702e 6772 6964 2872   sizegrip.grid(r
-00012030: 6f77 3d33 2c20 636f 6c75 6d6e 3d31 2c20  ow=3, column=1, 
-00012040: 7374 6963 6b79 3d27 6e73 6577 2729 0d0a  sticky='nsew')..
-00012050: 0d0a 2020 2020 2020 2020 2320 4d61 6b69  ..        # Maki
-00012060: 6e67 2074 6865 2064 6573 6967 6e20 7265  ng the design re
-00012070: 7370 6f6e 7369 7665 0d0a 2020 2020 2020  sponsive..      
-00012080: 2020 726f 6f74 2e67 7269 645f 726f 7763    root.grid_rowc
-00012090: 6f6e 6669 6775 7265 2830 2c20 7765 6967  onfigure(0, weig
-000120a0: 6874 3d31 2920 2023 2043 616e 7661 7320  ht=1)  # Canvas 
-000120b0: 726f 770d 0a20 2020 2020 2020 2072 6f6f  row..        roo
-000120c0: 742e 6772 6964 5f72 6f77 636f 6e66 6967  t.grid_rowconfig
-000120d0: 7572 6528 312c 2077 6569 6768 743d 3029  ure(1, weight=0)
-000120e0: 2020 2320 546f 6f6c 6261 7220 726f 770d    # Toolbar row.
-000120f0: 0a20 2020 2020 2020 2072 6f6f 742e 6772  .        root.gr
-00012100: 6964 5f72 6f77 636f 6e66 6967 7572 6528  id_rowconfigure(
-00012110: 322c 2077 6569 6768 743d 3029 2020 2320  2, weight=0)  # 
-00012120: 4275 7474 6f6e 2072 6f77 0d0a 2020 2020  Button row..    
-00012130: 2020 2020 726f 6f74 2e67 7269 645f 636f      root.grid_co
-00012140: 6c75 6d6e 636f 6e66 6967 7572 6528 302c  lumnconfigure(0,
-00012150: 2077 6569 6768 743d 3129 2020 2320 3244   weight=1)  # 2D
-00012160: 2070 6c6f 7420 636f 6c75 6d6e 0d0a 2020   plot column..  
-00012170: 2020 2020 2020 726f 6f74 2e67 7269 645f        root.grid_
-00012180: 636f 6c75 6d6e 636f 6e66 6967 7572 6528  columnconfigure(
-00012190: 312c 2077 6569 6768 743d 3129 2020 2320  1, weight=1)  # 
-000121a0: 3344 2070 6c6f 7420 636f 6c75 6d6e 0d0a  3D plot column..
-000121b0: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
-000121c0: 2020 0d0a 2020 2020 2020 2020 2020 2020    ..            
-000121d0: 2020 2020 0d0a 2020 2020 2020 2020 726f      ..        ro
-000121e0: 6f74 2e6d 6169 6e6c 6f6f 7028 290d 0a0d  ot.mainloop()...
-000121f0: 0a0d 0a20 2020 200d 0a20 2020 2070 6c6f  ...    ..    plo
-00012200: 745f 6465 6d28 6461 7461 2c20 7472 616e  t_dem(data, tran
-00012210: 7366 6f72 6d2c 2070 726f 6a65 6374 696f  sform, projectio
-00012220: 6e2c 206c 696e 655f 7368 6170 6566 696c  n, line_shapefil
-00012230: 6529 0d0a 2020 200d 0a20 2020 200d 0a23  e)..   ..    ..#
-00012240: 616b 6864 6566 6f5f 6669 7450 6c61 6e65  akhdefo_fitPlane
-00012250: 2864 656d 5f64 6174 613d 2763 7572 7269  (dem_data='curri
-00012260: 652f 6465 6d5f 316d 2e74 6966 272c 206c  e/dem_1m.tif', l
-00012270: 696e 655f 7368 6170 6566 696c 653d 2763  ine_shapefile='c
-00012280: 7572 7269 652f 6c69 6e65 732e 7368 7027  urrie/lines.shp'
-00012290: 2c20 6f75 745f 706c 616e 6546 6f6c 6465  , out_planeFolde
-000122a0: 723d 2750 6c61 6e65 735f 6f75 742f 6e65  r='Planes_out/ne
-000122b0: 7727 2c20 6c69 6d69 745f 6578 7465 6e64  w', limit_extend
-000122c0: 3d46 616c 7365 290d 0a0d 0a69 6d70 6f72  =False)....impor
-000122d0: 7420 6f73 0d0a 696d 706f 7274 2073 6875  t os..import shu
-000122e0: 7469 6c0d 0a0d 0a64 6566 206d 6f76 655f  til....def move_
-000122f0: 6669 6c65 735f 7769 7468 5f73 7472 696e  files_with_strin
-00012300: 6728 736f 7572 6365 5f64 6972 3a20 7374  g(source_dir: st
-00012310: 7220 3d22 222c 2064 6573 745f 6469 723a  r ="", dest_dir:
-00012320: 2073 7472 203d 2222 2c20 7365 6172 6368   str ="", search
-00012330: 5f73 7472 696e 673a 2073 7472 203d 222e  _string: str =".
-00012340: 7469 6622 293a 0d0a 2020 2020 2222 220d  tif"):..    """.
-00012350: 0a20 2020 204d 6f76 6520 6669 6c65 7320  .    Move files 
-00012360: 6672 6f6d 2061 2073 6f75 7263 6520 6469  from a source di
-00012370: 7265 6374 6f72 7920 746f 2061 2064 6573  rectory to a des
-00012380: 7469 6e61 7469 6f6e 2064 6972 6563 746f  tination directo
-00012390: 7279 2062 6173 6564 206f 6e20 6120 7365  ry based on a se
-000123a0: 6172 6368 2073 7472 696e 6720 7072 6573  arch string pres
-000123b0: 656e 7420 696e 2074 6865 6972 2070 6174  ent in their pat
-000123c0: 6873 2e0d 0a0d 0a20 2020 2050 6172 616d  hs.....    Param
-000123d0: 6574 6572 733a 0d0a 2020 2020 2d20 736f  eters:..    - so
-000123e0: 7572 6365 5f64 6972 2028 7374 7229 3a20  urce_dir (str): 
-000123f0: 5468 6520 6469 7265 6374 6f72 7920 6672  The directory fr
-00012400: 6f6d 2077 6869 6368 2066 696c 6573 2061  om which files a
-00012410: 7265 2074 6f20 6265 206d 6f76 6564 2e0d  re to be moved..
-00012420: 0a20 2020 202d 2064 6573 745f 6469 7220  .    - dest_dir 
-00012430: 2873 7472 293a 2054 6865 2064 6573 7469  (str): The desti
-00012440: 6e61 7469 6f6e 2064 6972 6563 746f 7279  nation directory
-00012450: 2077 6865 7265 2066 696c 6573 2077 696c   where files wil
-00012460: 6c20 6265 206d 6f76 6564 2e0d 0a20 2020  l be moved...   
-00012470: 202d 2073 6561 7263 685f 7374 7269 6e67   - search_string
-00012480: 2028 7374 7229 3a20 5468 6520 7374 7269   (str): The stri
-00012490: 6e67 2074 6f20 7365 6172 6368 2066 6f72  ng to search for
-000124a0: 2069 6e20 7468 6520 6669 6c65 2070 6174   in the file pat
-000124b0: 6873 2e0d 0a0d 0a20 2020 2054 6869 7320  hs.....    This 
-000124c0: 6675 6e63 7469 6f6e 2074 7261 7665 7273  function travers
-000124d0: 6573 2074 6865 2073 6f75 7263 6520 6469  es the source di
-000124e0: 7265 6374 6f72 792c 2069 6e63 6c75 6469  rectory, includi
-000124f0: 6e67 2069 7473 2073 7562 6469 7265 6374  ng its subdirect
-00012500: 6f72 6965 732e 200d 0a20 2020 2046 696c  ories. ..    Fil
-00012510: 6573 2077 686f 7365 2070 6174 6873 2063  es whose paths c
-00012520: 6f6e 7461 696e 2074 6865 2073 6561 7263  ontain the searc
-00012530: 6820 7374 7269 6e67 2061 7265 206d 6f76  h string are mov
-00012540: 6564 2074 6f20 7468 6520 6465 7374 696e  ed to the destin
-00012550: 6174 696f 6e20 6469 7265 6374 6f72 792e  ation directory.
-00012560: 200d 0a20 2020 2049 6620 6120 6669 6c65   ..    If a file
-00012570: 2077 6974 6820 7468 6520 7361 6d65 206e   with the same n
-00012580: 616d 6520 6578 6973 7473 2069 6e20 7468  ame exists in th
-00012590: 6520 6465 7374 696e 6174 696f 6e2c 2069  e destination, i
-000125a0: 7427 7320 7265 6e61 6d65 6420 746f 2061  t's renamed to a
-000125b0: 766f 6964 206f 7665 7277 7269 7469 6e67  void overwriting
-000125c0: 2e0d 0a0d 0a20 2020 2045 7272 6f72 7320  .....    Errors 
-000125d0: 6475 7269 6e67 2066 696c 6520 6d6f 7665  during file move
-000125e0: 6d65 6e74 2028 652e 672e 2c20 7065 726d  ment (e.g., perm
-000125f0: 6973 7369 6f6e 2069 7373 7565 732c 206e  ission issues, n
-00012600: 6f6e 2d65 7869 7374 656e 7420 6469 7265  on-existent dire
-00012610: 6374 6f72 6965 7329 2061 7265 206c 6f67  ctories) are log
-00012620: 6765 6420 6275 7420 646f 206e 6f74 2073  ged but do not s
-00012630: 746f 7020 7468 6520 7072 6f63 6573 732e  top the process.
-00012640: 0d0a 2020 2020 2222 220d 0a0d 0a20 2020  ..    """....   
-00012650: 2069 6620 6e6f 7420 6f73 2e70 6174 682e   if not os.path.
-00012660: 6578 6973 7473 2873 6f75 7263 655f 6469  exists(source_di
-00012670: 7229 3a0d 0a20 2020 2020 2020 2072 6169  r):..        rai
-00012680: 7365 2056 616c 7565 4572 726f 7228 6622  se ValueError(f"
-00012690: 536f 7572 6365 2064 6972 6563 746f 7279  Source directory
-000126a0: 2027 7b73 6f75 7263 655f 6469 727d 2720   '{source_dir}' 
-000126b0: 646f 6573 206e 6f74 2065 7869 7374 2e22  does not exist."
-000126c0: 290d 0a0d 0a20 2020 2023 2043 7265 6174  )....    # Creat
-000126d0: 6520 7468 6520 6465 7374 696e 6174 696f  e the destinatio
-000126e0: 6e20 6469 7265 6374 6f72 7920 6966 2069  n directory if i
-000126f0: 7420 646f 6573 6e27 7420 6578 6973 740d  t doesn't exist.
-00012700: 0a20 2020 2069 6620 6e6f 7420 6f73 2e70  .    if not os.p
-00012710: 6174 682e 6578 6973 7473 2864 6573 745f  ath.exists(dest_
-00012720: 6469 7229 3a0d 0a20 2020 2020 2020 206f  dir):..        o
-00012730: 732e 6d61 6b65 6469 7273 2864 6573 745f  s.makedirs(dest_
-00012740: 6469 7229 0d0a 0d0a 2020 2020 666f 7220  dir)....    for 
-00012750: 726f 6f74 2c20 6469 7273 2c20 6669 6c65  root, dirs, file
-00012760: 7320 696e 206f 732e 7761 6c6b 2873 6f75  s in os.walk(sou
-00012770: 7263 655f 6469 7229 3a0d 0a20 2020 2020  rce_dir):..     
-00012780: 2020 2066 6f72 2066 696c 6520 696e 2066     for file in f
-00012790: 696c 6573 3a0d 0a20 2020 2020 2020 2020  iles:..         
-000127a0: 2020 2066 696c 655f 7061 7468 203d 206f     file_path = o
-000127b0: 732e 7061 7468 2e6a 6f69 6e28 726f 6f74  s.path.join(root
-000127c0: 2c20 6669 6c65 290d 0a20 2020 2020 2020  , file)..       
-000127d0: 2020 2020 2069 6620 7365 6172 6368 5f73       if search_s
-000127e0: 7472 696e 6720 696e 2066 696c 655f 7061  tring in file_pa
-000127f0: 7468 3a0d 0a20 2020 2020 2020 2020 2020  th:..           
-00012800: 2020 2020 2064 6573 745f 6669 6c65 5f70       dest_file_p
-00012810: 6174 6820 3d20 6f73 2e70 6174 682e 6a6f  ath = os.path.jo
-00012820: 696e 2864 6573 745f 6469 722c 2066 696c  in(dest_dir, fil
-00012830: 6529 0d0a 0d0a 2020 2020 2020 2020 2020  e)....          
-00012840: 2020 2020 2020 2320 4368 6563 6b20 6966        # Check if
-00012850: 2074 6865 2066 696c 6520 616c 7265 6164   the file alread
-00012860: 7920 6578 6973 7473 2069 6e20 6465 7374  y exists in dest
-00012870: 696e 6174 696f 6e0d 0a20 2020 2020 2020  ination..       
-00012880: 2020 2020 2020 2020 2063 6f75 6e74 6572           counter
-00012890: 203d 2031 0d0a 2020 2020 2020 2020 2020   = 1..          
-000128a0: 2020 2020 2020 7768 696c 6520 6f73 2e70        while os.p
-000128b0: 6174 682e 6578 6973 7473 2864 6573 745f  ath.exists(dest_
-000128c0: 6669 6c65 5f70 6174 6829 3a0d 0a20 2020  file_path):..   
-000128d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000128e0: 2023 2053 706c 6974 2066 696c 656e 616d   # Split filenam
-000128f0: 6520 616e 6420 6578 7465 6e73 696f 6e0d  e and extension.
-00012900: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012910: 2020 2020 2066 696c 655f 6261 7365 2c20       file_base, 
-00012920: 6669 6c65 5f65 7874 656e 7369 6f6e 203d  file_extension =
-00012930: 206f 732e 7061 7468 2e73 706c 6974 6578   os.path.splitex
-00012940: 7428 6669 6c65 290d 0a20 2020 2020 2020  t(file)..       
-00012950: 2020 2020 2020 2020 2020 2020 2023 2043               # C
-00012960: 7265 6174 6520 6120 6e65 7720 6669 6c65  reate a new file
-00012970: 6e61 6d65 2077 6974 6820 6120 636f 756e  name with a coun
-00012980: 7465 7220 746f 2061 766f 6964 206f 7665  ter to avoid ove
-00012990: 7277 7269 7469 6e67 0d0a 2020 2020 2020  rwriting..      
-000129a0: 2020 2020 2020 2020 2020 2020 2020 6465                de
-000129b0: 7374 5f66 696c 655f 7061 7468 203d 206f  st_file_path = o
-000129c0: 732e 7061 7468 2e6a 6f69 6e28 6465 7374  s.path.join(dest
-000129d0: 5f64 6972 2c20 6622 7b66 696c 655f 6261  _dir, f"{file_ba
-000129e0: 7365 7d5f 7b63 6f75 6e74 6572 7d7b 6669  se}_{counter}{fi
-000129f0: 6c65 5f65 7874 656e 7369 6f6e 7d22 290d  le_extension}").
-00012a00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012a10: 2020 2020 2063 6f75 6e74 6572 202b 3d20       counter += 
-00012a20: 310d 0a0d 0a20 2020 2020 2020 2020 2020  1....           
-00012a30: 2020 2020 2023 204d 6f76 6520 7468 6520       # Move the 
-00012a40: 6669 6c65 2074 6f20 7468 6520 6465 7374  file to the dest
-00012a50: 696e 6174 696f 6e20 6469 7265 6374 6f72  ination director
-00012a60: 790d 0a20 2020 2020 2020 2020 2020 2020  y..             
-00012a70: 2020 2074 7279 3a0d 0a20 2020 2020 2020     try:..       
-00012a80: 2020 2020 2020 2020 2020 2020 2073 6875               shu
-00012a90: 7469 6c2e 6d6f 7665 2866 696c 655f 7061  til.move(file_pa
-00012aa0: 7468 2c20 6465 7374 5f66 696c 655f 7061  th, dest_file_pa
-00012ab0: 7468 290d 0a20 2020 2020 2020 2020 2020  th)..           
-00012ac0: 2020 2020 2065 7863 6570 7420 4578 6365       except Exce
-00012ad0: 7074 696f 6e20 6173 2065 3a0d 0a20 2020  ption as e:..   
-00012ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012af0: 2070 7269 6e74 2866 2245 7272 6f72 206d   print(f"Error m
-00012b00: 6f76 696e 6720 6669 6c65 207b 6669 6c65  oving file {file
-00012b10: 5f70 6174 687d 2074 6f20 7b64 6573 745f  _path} to {dest_
-00012b20: 6669 6c65 5f70 6174 687d 3a20 7b65 7d22  file_path}: {e}"
-00012b30: 290d 0a0d 0a23 2323 2323 2323 2323 2323  )....###########
-00012b40: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00012b50: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00012b60: 2323 0d0a 2354 6869 7320 7061 7274 2069  ##..#This part i
-00012b70: 7320 7374 696c 6c20 756e 6465 7220 636f  s still under co
-00012b80: 6e73 7472 7563 7469 6f6e 0d0a 0d0a 696d  nstruction....im
-00012b90: 706f 7274 206e 756d 7079 2061 7320 6e70  port numpy as np
-00012ba0: 0d0a 0d0a 6465 6620 7061 7274 6961 6c5f  ....def partial_
-00012bb0: 6465 7269 7661 7469 7665 2866 2c20 6478  derivative(f, dx
-00012bc0: 2c20 6479 293a 0d0a 2020 2020 2222 220d  , dy):..    """.
-00012bd0: 0a20 2020 2043 616c 6375 6c61 7465 2074  .    Calculate t
-00012be0: 6865 2063 656e 7472 616c 2064 6966 6665  he central diffe
-00012bf0: 7265 6e63 6520 6170 7072 6f78 696d 6174  rence approximat
-00012c00: 696f 6e20 666f 7220 7468 6520 7061 7274  ion for the part
-00012c10: 6961 6c20 6465 7269 7661 7469 7665 730d  ial derivatives.
-00012c20: 0a20 2020 206f 6620 6120 3244 2066 756e  .    of a 2D fun
-00012c30: 6374 696f 6e20 7769 7468 2072 6573 7065  ction with respe
-00012c40: 6374 2074 6f20 7820 616e 6420 792e 0d0a  ct to x and y...
-00012c50: 0d0a 2020 2020 3a70 6172 616d 2066 3a20  ..    :param f: 
-00012c60: 3244 206e 756d 7079 2061 7272 6179 206f  2D numpy array o
-00012c70: 6620 6675 6e63 7469 6f6e 2076 616c 7565  f function value
-00012c80: 732c 2072 6570 7265 7365 6e74 696e 6720  s, representing 
-00012c90: 7468 6520 7261 7374 6572 0d0a 2020 2020  the raster..    
-00012ca0: 3a70 6172 616d 2064 783a 2053 7061 6369  :param dx: Spaci
-00012cb0: 6e67 2069 6e20 7468 6520 782d 6469 7265  ng in the x-dire
-00012cc0: 6374 696f 6e20 2861 7373 756d 6564 2074  ction (assumed t
-00012cd0: 6f20 6265 2063 6f6e 7374 616e 7429 0d0a  o be constant)..
-00012ce0: 2020 2020 3a70 6172 616d 2064 793a 2053      :param dy: S
-00012cf0: 7061 6369 6e67 2069 6e20 7468 6520 792d  pacing in the y-
-00012d00: 6469 7265 6374 696f 6e20 2861 7373 756d  direction (assum
-00012d10: 6564 2074 6f20 6265 2063 6f6e 7374 616e  ed to be constan
-00012d20: 7429 0d0a 2020 2020 3a72 6574 7572 6e3a  t)..    :return:
-00012d30: 2054 776f 2032 4420 6e75 6d70 7920 6172   Two 2D numpy ar
-00012d40: 7261 7973 2c20 6f6e 6520 666f 7220 7468  rays, one for th
-00012d50: 6520 7061 7274 6961 6c20 6465 7269 7661  e partial deriva
-00012d60: 7469 7665 2077 6974 6820 7265 7370 6563  tive with respec
-00012d70: 7420 746f 2078 2028 6466 5f64 7829 0d0a  t to x (df_dx)..
-00012d80: 2020 2020 2020 2020 2020 2020 2061 6e64               and
-00012d90: 206f 6e65 2066 6f72 2074 6865 2070 6172   one for the par
-00012da0: 7469 616c 2064 6572 6976 6174 6976 6520  tial derivative 
-00012db0: 7769 7468 2072 6573 7065 6374 2074 6f20  with respect to 
-00012dc0: 7920 2864 665f 6479 290d 0a20 2020 2022  y (df_dy)..    "
-00012dd0: 2222 0d0a 2020 2020 2023 2049 6e69 7469  ""..     # Initi
-00012de0: 616c 697a 6520 6172 7261 7973 2074 6f20  alize arrays to 
-00012df0: 7374 6f72 6520 7468 6520 7061 7274 6961  store the partia
-00012e00: 6c20 6465 7269 7661 7469 7665 730d 0a20  l derivatives.. 
-00012e10: 2020 2064 665f 6478 203d 206e 702e 7a65     df_dx = np.ze
-00012e20: 726f 735f 6c69 6b65 2866 290d 0a20 2020  ros_like(f)..   
-00012e30: 2064 665f 6479 203d 206e 702e 7a65 726f   df_dy = np.zero
-00012e40: 735f 6c69 6b65 2866 290d 0a0d 0a20 2020  s_like(f)....   
-00012e50: 2023 2043 6f6d 7075 7465 2074 6865 2070   # Compute the p
-00012e60: 6172 7469 616c 2064 6572 6976 6174 6976  artial derivativ
-00012e70: 6573 2066 6f72 2074 6865 2069 6e74 6572  es for the inter
-00012e80: 6e61 6c20 706f 696e 7473 0d0a 2020 2020  nal points..    
-00012e90: 666f 7220 7869 2069 6e20 7261 6e67 6528  for xi in range(
-00012ea0: 312c 2066 2e73 6861 7065 5b30 5d20 2d20  1, f.shape[0] - 
-00012eb0: 3129 3a0d 0a20 2020 2020 2020 2066 6f72  1):..        for
-00012ec0: 2079 6a20 696e 2072 616e 6765 2831 2c20   yj in range(1, 
-00012ed0: 662e 7368 6170 655b 315d 202d 2031 293a  f.shape[1] - 1):
-00012ee0: 0d0a 2020 2020 2020 2020 2020 2020 6466  ..            df
-00012ef0: 5f64 785b 7869 2c20 796a 5d20 3d20 2866  _dx[xi, yj] = (f
-00012f00: 5b78 6920 2b20 312c 2079 6a5d 202d 2066  [xi + 1, yj] - f
-00012f10: 5b78 6920 2d20 312c 2079 6a5d 2920 2f20  [xi - 1, yj]) / 
-00012f20: 2832 202a 2064 7829 0d0a 2020 2020 2020  (2 * dx)..      
-00012f30: 2020 2020 2020 6466 5f64 795b 7869 2c20        df_dy[xi, 
-00012f40: 796a 5d20 3d20 2866 5b78 692c 2079 6a20  yj] = (f[xi, yj 
-00012f50: 2b20 315d 202d 2066 5b78 692c 2079 6a20  + 1] - f[xi, yj 
-00012f60: 2d20 315d 2920 2f20 2832 202a 2064 7929  - 1]) / (2 * dy)
-00012f70: 0d0a 0d0a 2020 2020 2320 4861 6e64 6c65  ....    # Handle
-00012f80: 2074 6865 2062 6f75 6e64 6172 6965 7320   the boundaries 
-00012f90: 6279 2073 6574 7469 6e67 2074 6865 2064  by setting the d
-00012fa0: 6572 6976 6174 6976 6520 746f 207a 6572  erivative to zer
-00012fb0: 6f20 6f72 2075 7369 6e67 206f 6e65 2d73  o or using one-s
-00012fc0: 6964 6564 2064 6966 6665 7265 6e63 6573  ided differences
-00012fd0: 0d0a 2020 2020 2320 4865 7265 2077 6520  ..    # Here we 
-00012fe0: 6368 6f6f 7365 2074 6f20 7365 7420 7468  choose to set th
-00012ff0: 6520 626f 756e 6461 7279 2064 6572 6976  e boundary deriv
-00013000: 6174 6976 6520 746f 207a 6572 6f0d 0a20  ative to zero.. 
-00013010: 2020 2023 2041 6c74 6572 6e61 7469 7665     # Alternative
-00013020: 6c79 2c20 7573 6520 666f 7277 6172 642f  ly, use forward/
-00013030: 6261 636b 7761 7264 2064 6966 6665 7265  backward differe
-00013040: 6e63 6520 6174 2074 6865 2062 6f75 6e64  nce at the bound
-00013050: 6172 6965 7320 6966 206e 6565 6465 640d  aries if needed.
-00013060: 0a0d 0a20 2020 2072 6574 7572 6e20 6466  ...    return df
-00013070: 5f64 782c 2064 665f 6479 0d0a 0d0a 0d0a  _dx, df_dy......
-00013080: 696d 706f 7274 206e 756d 7079 2061 7320  import numpy as 
-00013090: 6e70 0d0a 696d 706f 7274 2072 6173 7465  np..import raste
-000130a0: 7269 6f0d 0a0d 0a64 6566 2063 616c 6375  rio....def calcu
-000130b0: 6c61 7465 5f73 6c6f 7065 2864 656d 2c20  late_slope(dem, 
-000130c0: 6173 7065 6374 2c20 6478 202c 2064 7929  aspect, dx , dy)
-000130d0: 3a0d 0a20 2020 2022 2222 0d0a 2020 2020  :..    """..    
-000130e0: 4361 6c63 756c 6174 6520 7468 6520 736c  Calculate the sl
-000130f0: 6f70 6520 6174 2065 6163 6820 7069 7865  ope at each pixe
-00013100: 6c20 7573 696e 6720 7468 6520 6173 7065  l using the aspe
-00013110: 6374 2074 6f20 6465 7465 726d 696e 6520  ct to determine 
-00013120: 6469 7265 6374 696f 6e2e 0d0a 0d0a 2020  direction.....  
-00013130: 2020 5061 7261 6d65 7465 7273 3a0d 0a20    Parameters:.. 
-00013140: 2020 2064 656d 2028 6e75 6d70 792e 6e64     dem (numpy.nd
-00013150: 6172 7261 7929 3a20 4469 6769 7461 6c20  array): Digital 
-00013160: 456c 6576 6174 696f 6e20 4d6f 6465 6c20  Elevation Model 
-00013170: 2844 454d 2920 6172 7261 792e 0d0a 2020  (DEM) array...  
-00013180: 2020 6173 7065 6374 2028 6e75 6d70 792e    aspect (numpy.
-00013190: 6e64 6172 7261 7929 3a20 4173 7065 6374  ndarray): Aspect
-000131a0: 2061 7272 6179 2e0d 0a20 2020 2064 7820   array...    dx 
-000131b0: 2866 6c6f 6174 293a 2020 7820 5370 6174  (float):  x Spat
-000131c0: 6961 6c20 7265 736f 6c75 7469 6f6e 206f  ial resolution o
-000131d0: 6620 7468 6520 7261 7374 6572 2028 6469  f the raster (di
-000131e0: 7374 616e 6365 2062 6574 7765 656e 2070  stance between p
-000131f0: 6978 656c 7329 2e0d 0a20 2020 2064 7920  ixels)...    dy 
-00013200: 2866 6c6f 6174 293a 2020 7920 5370 6174  (float):  y Spat
-00013210: 6961 6c20 7265 736f 6c75 7469 6f6e 206f  ial resolution o
-00013220: 6620 7468 6520 7261 7374 6572 2028 6469  f the raster (di
-00013230: 7374 616e 6365 2062 6574 7765 656e 2070  stance between p
-00013240: 6978 656c 7329 2e0d 0a0d 0a20 2020 2052  ixels).....    R
-00013250: 6574 7572 6e73 3a0d 0a20 2020 206e 756d  eturns:..    num
-00013260: 7079 2e6e 6461 7272 6179 3a20 4172 7261  py.ndarray: Arra
-00013270: 7920 6f66 2073 6c6f 7065 2076 616c 7565  y of slope value
-00013280: 7320 696e 2064 6567 7265 6573 2e0d 0a20  s in degrees... 
-00013290: 2020 2022 2222 0d0a 2020 2020 0d0a 2020     """..    ..  
-000132a0: 2020 2320 6772 6164 5f79 2c20 6772 6164    # grad_y, grad
-000132b0: 5f78 203d 206e 702e 6772 6164 6965 6e74  _x = np.gradient
-000132c0: 2864 656d 2c20 6478 2c20 6479 290d 0a20  (dem, dx, dy).. 
-000132d0: 2020 200d 0a20 2020 200d 0a20 2020 2023     ..    ..    #
-000132e0: 2041 7373 756d 696e 6720 2764 656d 2720   Assuming 'dem' 
-000132f0: 616e 6420 2761 7370 6563 7427 2061 7265  and 'aspect' are
-00013300: 2079 6f75 7220 6578 6973 7469 6e67 206e   your existing n
-00013310: 756d 7079 2061 7272 6179 730d 0a20 2020  umpy arrays..   
-00013320: 2023 2043 6865 636b 2069 6620 7468 6520   # Check if the 
-00013330: 7368 6170 6573 2061 7265 2064 6966 6665  shapes are diffe
-00013340: 7265 6e74 0d0a 2020 2020 2320 6966 2064  rent..    # if d
-00013350: 656d 2e73 6861 7065 2021 3d20 6173 7065  em.shape != aspe
-00013360: 6374 2e73 6861 7065 3a0d 0a20 2020 2023  ct.shape:..    #
-00013370: 2020 2020 2023 2052 6573 697a 6520 2764       # Resize 'd
-00013380: 656d 2720 746f 206d 6174 6368 2074 6865  em' to match the
-00013390: 2073 6861 7065 206f 6620 2761 7370 6563   shape of 'aspec
-000133a0: 7427 0d0a 2020 2020 2320 2020 2020 6173  t'..    #     as
-000133b0: 7065 6374 203d 206e 702e 7265 7369 7a65  pect = np.resize
-000133c0: 2861 7370 6563 742c 2064 656d 2e73 6861  (aspect, dem.sha
-000133d0: 7065 290d 0a20 2020 2023 2065 6c73 653a  pe)..    # else:
-000133e0: 0d0a 2020 2020 2320 2020 2020 6173 7065  ..    #     aspe
-000133f0: 6374 203d 2061 7370 6563 740d 0a0d 0a0d  ct = aspect.....
-00013400: 0a0d 0a20 2020 2067 7261 645f 792c 2067  ...    grad_y, g
-00013410: 7261 645f 7820 3d20 6e70 2e67 7261 6469  rad_x = np.gradi
-00013420: 656e 7428 6465 6d2c 2064 782c 2064 7929  ent(dem, dx, dy)
-00013430: 0d0a 2020 2020 2367 7261 645f 792c 2067  ..    #grad_y, g
-00013440: 7261 645f 783d 7061 7274 6961 6c5f 6465  rad_x=partial_de
-00013450: 7269 7661 7469 7665 2864 656d 2c20 6478  rivative(dem, dx
-00013460: 2c20 6479 290d 0a0d 0a20 2020 2069 6620  , dy)....    if 
-00013470: 6772 6164 5f78 2e73 6861 7065 2021 3d20  grad_x.shape != 
-00013480: 6772 6164 5f79 2e73 6861 7065 3a0d 0a20  grad_y.shape:.. 
-00013490: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
-000134a0: 7565 4572 726f 7228 2247 7261 6469 656e  ueError("Gradien
-000134b0: 7420 6172 7261 7973 2068 6176 6520 6d69  t arrays have mi
-000134c0: 736d 6174 6368 6564 2073 6861 7065 732e  smatched shapes.
-000134d0: 2229 0d0a 2020 2020 0d0a 2020 2020 6173  ")..    ..    as
-000134e0: 7065 6374 5f72 6164 6961 6e73 203d 206e  pect_radians = n
-000134f0: 702e 6465 6732 7261 6428 6173 7065 6374  p.deg2rad(aspect
-00013500: 290d 0a20 2020 2064 6972 6563 7469 6f6e  )..    direction
-00013510: 616c 5f67 7261 6420 3d20 6e70 2e63 6f73  al_grad = np.cos
-00013520: 2861 7370 6563 745f 7261 6469 616e 7329  (aspect_radians)
-00013530: 202a 2067 7261 645f 7820 2b20 6e70 2e73   * grad_x + np.s
-00013540: 696e 2861 7370 6563 745f 7261 6469 616e  in(aspect_radian
-00013550: 7329 202a 2067 7261 645f 790d 0a20 2020  s) * grad_y..   
-00013560: 2023 736c 6f70 655f 6465 6772 6565 7320   #slope_degrees 
-00013570: 3d20 6e70 2e72 6164 3264 6567 286e 702e  = np.rad2deg(np.
-00013580: 6172 6374 616e 2864 6972 6563 7469 6f6e  arctan(direction
-00013590: 616c 5f67 7261 6429 290d 0a20 2020 0d0a  al_grad))..   ..
-000135a0: 2020 2020 2320 4361 6c63 756c 6174 6520      # Calculate 
-000135b0: 736c 6f70 6520 696e 2072 6164 6961 6e73  slope in radians
-000135c0: 0d0a 2020 2020 736c 6f70 655f 7261 6469  ..    slope_radi
-000135d0: 616e 7320 3d20 6e70 2e61 7263 7461 6e28  ans = np.arctan(
-000135e0: 6469 7265 6374 696f 6e61 6c5f 6772 6164  directional_grad
-000135f0: 290d 0a0d 0a20 2020 2023 2045 6e73 7572  )....    # Ensur
-00013600: 6520 736c 6f70 6520 6973 2077 6974 6869  e slope is withi
-00013610: 6e20 3020 746f 20cf 802f 3220 7261 6469  n 0 to ../2 radi
-00013620: 616e 7320 2830 2074 6f20 3930 2064 6567  ans (0 to 90 deg
-00013630: 7265 6573 2920 7261 6e67 650d 0a20 2020  rees) range..   
-00013640: 2023 736c 6f70 655f 7261 6469 616e 7320   #slope_radians 
-00013650: 3d20 736c 6f70 655f 7261 6469 616e 7320  = slope_radians 
-00013660: 2520 286e 702e 7069 202f 2032 290d 0a0d  % (np.pi / 2)...
-00013670: 0a20 2020 2023 2043 6f6e 7665 7274 2073  .    # Convert s
-00013680: 6c6f 7065 2074 6f20 6465 6772 6565 730d  lope to degrees.
-00013690: 0a20 2020 2073 6c6f 7065 5f64 6567 7265  .    slope_degre
-000136a0: 6573 203d 2028 6e70 2e72 6164 3264 6567  es = (np.rad2deg
-000136b0: 2873 6c6f 7065 5f72 6164 6961 6e73 2929  (slope_radians))
-000136c0: 2025 2039 3020 0d0a 2020 2020 2373 6c6f   % 90 ..    #slo
-000136d0: 7065 5f64 6567 7265 6573 3d20 2831 3335  pe_degrees= (135
-000136e0: 2d73 6c6f 7065 5f64 6567 7265 6573 2925  -slope_degrees)%
-000136f0: 2039 3020 0d0a 2020 2020 0d0a 2020 200d   90 ..    ..   .
-00013700: 0a20 2020 200d 0a20 2020 2072 6574 7572  .    ..    retur
-00013710: 6e20 736c 6f70 655f 6465 6772 6565 732c  n slope_degrees,
-00013720: 2064 6972 6563 7469 6f6e 616c 5f67 7261   directional_gra
-00013730: 640d 0a0d 0a64 6566 2063 616c 6375 6c61  d....def calcula
-00013740: 7465 5f68 6569 6768 745f 6368 616e 6765  te_height_change
-00013750: 2873 6c6f 7065 2c20 6469 7374 616e 6365  (slope, distance
-00013760: 2c20 6465 6d29 3a0d 0a20 2020 2022 2222  , dem):..    """
-00013770: 0d0a 2020 2020 4361 6c63 756c 6174 6520  ..    Calculate 
-00013780: 7468 6520 6865 6967 6874 2063 6861 6e67  the height chang
-00013790: 6520 7573 696e 6720 7468 6520 736c 6f70  e using the slop
-000137a0: 6520 616e 6420 6469 7374 616e 6365 2066  e and distance f
-000137b0: 6f72 2065 6163 6820 7069 7865 6c2e 0d0a  or each pixel...
-000137c0: 0d0a 2020 2020 5061 7261 6d65 7465 7273  ..    Parameters
-000137d0: 3a0d 0a20 2020 2073 6c6f 7065 2028 6e75  :..    slope (nu
-000137e0: 6d70 792e 6e64 6172 7261 7929 3a20 4172  mpy.ndarray): Ar
-000137f0: 7261 7920 6f66 2073 6c6f 7065 2076 616c  ray of slope val
-00013800: 7565 7320 696e 2064 6567 7265 6573 2e0d  ues in degrees..
-00013810: 0a20 2020 2064 6973 7461 6e63 6520 286e  .    distance (n
-00013820: 756d 7079 2e6e 6461 7272 6179 293a 2041  umpy.ndarray): A
-00013830: 7272 6179 206f 6620 6469 7374 616e 6365  rray of distance
-00013840: 2076 616c 7565 732e 0d0a 0d0a 2020 2020   values.....    
-00013850: 5265 7475 726e 733a 0d0a 2020 2020 6e75  Returns:..    nu
-00013860: 6d70 792e 6e64 6172 7261 793a 2041 7272  mpy.ndarray: Arr
-00013870: 6179 206f 6620 6865 6967 6874 2063 6861  ay of height cha
-00013880: 6e67 6573 2e0d 0a20 2020 2022 2222 0d0a  nges...    """..
-00013890: 2020 2020 736c 6f70 655f 7261 6469 616e      slope_radian
-000138a0: 7320 3d20 6e70 2e64 6567 3272 6164 2873  s = np.deg2rad(s
-000138b0: 6c6f 7065 290d 0a20 2020 2068 6569 6768  lope)..    heigh
-000138c0: 745f 6368 616e 6765 203d 206e 702e 7461  t_change = np.ta
-000138d0: 6e28 736c 6f70 655f 7261 6469 616e 7329  n(slope_radians)
-000138e0: 202a 2064 6973 7461 6e63 650d 0a20 2020   * distance..   
-000138f0: 200d 0a20 2020 200d 0a20 2020 200d 0a20   ..    ..    .. 
-00013900: 2020 2072 6574 7572 6e20 6865 6967 6874     return height
-00013910: 5f63 6861 6e67 6520 0d0a 0d0a 6465 6620  _change ....def 
-00013920: 6361 6c63 756c 6174 655f 766f 6c75 6d65  calculate_volume
-00013930: 5f63 6861 6e67 6528 6865 6967 6874 5f63  _change(height_c
-00013940: 6861 6e67 652c 2070 6978 656c 5f61 7265  hange, pixel_are
-00013950: 6129 3a0d 0a20 2020 2022 2222 0d0a 2020  a):..    """..  
-00013960: 2020 4361 6c63 756c 6174 6520 7468 6520    Calculate the 
-00013970: 766f 6c75 6d65 2063 6861 6e67 6520 666f  volume change fo
-00013980: 7220 6561 6368 2070 6978 656c 2e0d 0a0d  r each pixel....
-00013990: 0a20 2020 2050 6172 616d 6574 6572 733a  .    Parameters:
-000139a0: 0d0a 2020 2020 6865 6967 6874 5f63 6861  ..    height_cha
-000139b0: 6e67 6520 286e 756d 7079 2e6e 6461 7272  nge (numpy.ndarr
-000139c0: 6179 293a 2041 7272 6179 206f 6620 6865  ay): Array of he
-000139d0: 6967 6874 2063 6861 6e67 6573 2e0d 0a20  ight changes... 
-000139e0: 2020 2070 6978 656c 5f61 7265 6120 2866     pixel_area (f
-000139f0: 6c6f 6174 293a 2041 7265 6120 6f66 2061  loat): Area of a
-00013a00: 2073 696e 676c 6520 7069 7865 6c2e 0d0a   single pixel...
-00013a10: 2020 2020 0d0a 2020 2020 5265 7475 726e      ..    Return
-00013a20: 733a 0d0a 2020 2020 6e75 6d70 792e 6e64  s:..    numpy.nd
-00013a30: 6172 7261 793a 2041 7272 6179 206f 6620  array: Array of 
-00013a40: 766f 6c75 6d65 2063 6861 6e67 6573 2e0d  volume changes..
-00013a50: 0a20 2020 2022 2222 0d0a 2020 2020 766f  .    """..    vo
-00013a60: 6c75 6d65 5f63 6861 6e67 6520 3d20 6865  lume_change = he
-00013a70: 6967 6874 5f63 6861 6e67 6520 2a20 7069  ight_change * pi
-00013a80: 7865 6c5f 6172 6561 0d0a 2020 2020 7072  xel_area..    pr
-00013a90: 696e 7420 2866 2754 6f74 616c 2056 6f6c  int (f'Total Vol
-00013aa0: 756d 653a 207b 6e70 2e6e 616e 7375 6d28  ume: {np.nansum(
-00013ab0: 766f 6c75 6d65 5f63 6861 6e67 6529 7d20  volume_change)} 
-00013ac0: 6375 6269 6320 6d65 7465 7227 290d 0a20  cubic meter').. 
-00013ad0: 2020 2072 6574 7572 6e20 766f 6c75 6d65     return volume
-00013ae0: 5f63 6861 6e67 650d 0a0d 0a66 726f 6d20  _change....from 
-00013af0: 736b 696d 6167 652e 6669 6c74 6572 7320  skimage.filters 
-00013b00: 696d 706f 7274 2067 6175 7373 6961 6e0d  import gaussian.
-00013b10: 0a0d 0a64 6566 2064 6973 706c 6163 656d  ...def displacem
-00013b20: 656e 745f 746f 5f76 6f6c 756d 6528 6465  ent_to_volume(de
-00013b30: 6d5f 7061 7468 3d22 222c 2061 7370 6563  m_path="", aspec
-00013b40: 745f 7061 7468 3d22 222c 2064 6973 706c  t_path="", displ
-00013b50: 6163 656d 656e 745f 7061 7468 3d22 222c  acement_path="",
-00013b60: 2073 6c6f 7065 5f6f 7574 7075 745f 7061   slope_output_pa
-00013b70: 7468 3d22 222c 2068 6569 6768 745f 6f75  th="", height_ou
-00013b80: 7470 7574 5f70 6174 683d 2222 2c20 766f  tput_path="", vo
-00013b90: 6c75 6d65 5f6f 7574 7075 745f 7061 7468  lume_output_path
-00013ba0: 3d22 222c 2064 783d 4e6f 6e65 202c 2064  ="", dx=None , d
-00013bb0: 793d 4e6f 6e65 202c 2070 6978 656c 5f61  y=None , pixel_a
-00013bc0: 7265 613d 4e6f 6e65 293a 0d0a 2020 2020  rea=None):..    
-00013bd0: 2222 220d 0a20 2020 2050 726f 6365 7373  """..    Process
-00013be0: 2074 6865 2044 454d 2c20 6173 7065 6374   the DEM, aspect
-00013bf0: 2c20 616e 6420 6469 7370 6c61 6365 6d65  , and displaceme
-00013c00: 6e74 2072 6173 7465 7273 2074 6f20 6361  nt rasters to ca
-00013c10: 6c63 756c 6174 6520 616e 6420 6578 706f  lculate and expo
-00013c20: 7274 2074 6865 2073 6c6f 7065 2c20 6865  rt the slope, he
-00013c30: 6967 6874 2063 6861 6e67 652c 2061 6e64  ight change, and
-00013c40: 2076 6f6c 756d 6520 6368 616e 6765 2e0d   volume change..
-00013c50: 0a0d 0a20 2020 2050 6172 616d 6574 6572  ...    Parameter
-00013c60: 733a 0d0a 2020 2020 6465 6d5f 7061 7468  s:..    dem_path
-00013c70: 2028 7374 7229 3a20 5061 7468 2074 6f20   (str): Path to 
-00013c80: 7468 6520 4445 4d20 7261 7374 6572 2066  the DEM raster f
-00013c90: 696c 652e 0d0a 2020 2020 6173 7065 6374  ile...    aspect
-00013ca0: 5f70 6174 6820 2873 7472 293a 2050 6174  _path (str): Pat
-00013cb0: 6820 746f 2074 6865 2061 7370 6563 7420  h to the aspect 
-00013cc0: 7261 7374 6572 2066 696c 652e 0d0a 2020  raster file...  
-00013cd0: 2020 6469 7370 6c61 6365 6d65 6e74 5f70    displacement_p
-00013ce0: 6174 6820 2873 7472 293a 2050 6174 6820  ath (str): Path 
-00013cf0: 746f 2074 6865 2064 6973 706c 6163 656d  to the displacem
-00013d00: 656e 7420 7261 7374 6572 2066 696c 652e  ent raster file.
-00013d10: 0d0a 2020 2020 736c 6f70 655f 6f75 7470  ..    slope_outp
-00013d20: 7574 5f70 6174 6820 2873 7472 293a 2050  ut_path (str): P
-00013d30: 6174 6820 666f 7220 7468 6520 736c 6f70  ath for the slop
-00013d40: 6520 6f75 7470 7574 2047 656f 5449 4646  e output GeoTIFF
-00013d50: 2066 696c 652e 0d0a 2020 2020 6865 6967   file...    heig
-00013d60: 6874 5f6f 7574 7075 745f 7061 7468 2028  ht_output_path (
-00013d70: 7374 7229 3a20 5061 7468 2066 6f72 2074  str): Path for t
-00013d80: 6865 2068 6569 6768 7420 6368 616e 6765  he height change
-00013d90: 206f 7574 7075 7420 4765 6f54 4946 4620   output GeoTIFF 
-00013da0: 6669 6c65 2e0d 0a20 2020 2076 6f6c 756d  file...    volum
-00013db0: 655f 6f75 7470 7574 5f70 6174 6820 2873  e_output_path (s
-00013dc0: 7472 293a 2050 6174 6820 666f 7220 7468  tr): Path for th
-00013dd0: 6520 766f 6c75 6d65 2063 6861 6e67 6520  e volume change 
-00013de0: 6f75 7470 7574 2047 656f 5449 4646 2066  output GeoTIFF f
-00013df0: 696c 652e 0d0a 2020 2020 6478 2028 666c  ile...    dx (fl
-00013e00: 6f61 7429 3a20 2078 2053 7061 7469 616c  oat):  x Spatial
-00013e10: 2072 6573 6f6c 7574 696f 6e20 6f66 2074   resolution of t
-00013e20: 6865 2072 6173 7465 7220 2864 6973 7461  he raster (dista
-00013e30: 6e63 6520 6265 7477 6565 6e20 7069 7865  nce between pixe
-00013e40: 6c73 292e 0d0a 2020 2020 6479 2028 666c  ls)...    dy (fl
-00013e50: 6f61 7429 3a20 2079 2053 7061 7469 616c  oat):  y Spatial
-00013e60: 2072 6573 6f6c 7574 696f 6e20 6f66 2074   resolution of t
-00013e70: 6865 2072 6173 7465 7220 2864 6973 7461  he raster (dista
-00013e80: 6e63 6520 6265 7477 6565 6e20 7069 7865  nce between pixe
-00013e90: 6c73 292e 0d0a 2020 2020 7069 7865 6c5f  ls)...    pixel_
-00013ea0: 6172 6561 2028 666c 6f61 7429 3a20 4172  area (float): Ar
-00013eb0: 6561 206f 6620 6120 7369 6e67 6c65 2070  ea of a single p
-00013ec0: 6978 656c 2e0d 0a0d 0a20 2020 2052 6574  ixel.....    Ret
-00013ed0: 7572 6e73 3a0d 0a20 2020 204e 6f6e 653a  urns:..    None:
-00013ee0: 204f 7574 7075 7473 2047 656f 5449 4646   Outputs GeoTIFF
-00013ef0: 2066 696c 6573 2061 7420 7468 6520 7370   files at the sp
-00013f00: 6563 6966 6965 6420 6f75 7470 7574 2070  ecified output p
-00013f10: 6174 6873 2e0d 0a20 2020 2022 2222 0d0a  aths...    """..
-00013f20: 2020 2020 7769 7468 2072 6173 7465 7269      with rasteri
-00013f30: 6f2e 6f70 656e 2864 656d 5f70 6174 6829  o.open(dem_path)
-00013f40: 2061 7320 6465 6d5f 7261 7374 6572 2c20   as dem_raster, 
-00013f50: 5c0d 0a20 2020 2020 2020 2020 7261 7374  \..         rast
-00013f60: 6572 696f 2e6f 7065 6e28 6173 7065 6374  erio.open(aspect
-00013f70: 5f70 6174 6829 2061 7320 6173 7065 6374  _path) as aspect
-00013f80: 5f72 6173 7465 722c 205c 0d0a 2020 2020  _raster, \..    
-00013f90: 2020 2020 2072 6173 7465 7269 6f2e 6f70       rasterio.op
-00013fa0: 656e 2864 6973 706c 6163 656d 656e 745f  en(displacement_
-00013fb0: 7061 7468 2920 6173 2064 6973 706c 6163  path) as displac
-00013fc0: 656d 656e 745f 7261 7374 6572 3a0d 0a0d  ement_raster:...
-00013fd0: 0a20 2020 2020 2020 2064 656d 203d 2064  .        dem = d
-00013fe0: 656d 5f72 6173 7465 722e 7265 6164 2831  em_raster.read(1
-00013ff0: 2c20 206d 6173 6b65 643d 5472 7565 290d  ,  masked=True).
-00014000: 0a20 2020 2020 2020 2061 7370 6563 7420  .        aspect 
-00014010: 3d20 6173 7065 6374 5f72 6173 7465 722e  = aspect_raster.
-00014020: 7265 6164 2831 2c20 206d 6173 6b65 643d  read(1,  masked=
-00014030: 5472 7565 290d 0a20 2020 2020 2020 2064  True)..        d
-00014040: 6973 706c 6163 656d 656e 7420 3d20 6469  isplacement = di
-00014050: 7370 6c61 6365 6d65 6e74 5f72 6173 7465  splacement_raste
-00014060: 722e 7265 6164 2831 2c20 206d 6173 6b65  r.read(1,  maske
-00014070: 643d 5472 7565 290d 0a20 2020 2020 2020  d=True)..       
-00014080: 200d 0a20 2020 2020 2020 2078 5f72 6573   ..        x_res
-00014090: 6f6c 7574 696f 6e2c 2079 5f72 6573 6f6c  olution, y_resol
-000140a0: 7574 696f 6e20 3d20 6469 7370 6c61 6365  ution = displace
-000140b0: 6d65 6e74 5f72 6173 7465 722e 7265 730d  ment_raster.res.
-000140c0: 0a20 2020 2020 2020 200d 0a20 2020 2020  .        ..     
-000140d0: 2020 2069 6620 6478 2069 7320 4e6f 6e65     if dx is None
-000140e0: 3a0d 0a20 2020 2020 2020 2020 2020 2064  :..            d
-000140f0: 783d 785f 7265 736f 6c75 7469 6f6e 0d0a  x=x_resolution..
-00014100: 2020 2020 2020 2020 6966 2064 7920 6973          if dy is
-00014110: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
-00014120: 2020 2020 6479 3d79 5f72 6573 6f6c 7574      dy=y_resolut
-00014130: 696f 6e0d 0a20 2020 2020 2020 2069 6620  ion..        if 
-00014140: 7069 7865 6c5f 6172 6561 2069 7320 4e6f  pixel_area is No
-00014150: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
-00014160: 2070 6978 656c 5f61 7265 613d 6478 202a   pixel_area=dx *
-00014170: 2064 790d 0a20 2020 2020 2020 2066 726f   dy..        fro
-00014180: 6d20 7363 6970 792e 6e64 696d 6167 6520  m scipy.ndimage 
-00014190: 696d 706f 7274 207a 6f6f 6d0d 0a0d 0a20  import zoom.... 
-000141a0: 2020 2020 2020 2023 2045 7861 6d70 6c65         # Example
-000141b0: 2064 696d 656e 7369 6f6e 7320 2d20 7265   dimensions - re
-000141c0: 706c 6163 6520 7468 6573 6520 7769 7468  place these with
-000141d0: 2061 6374 7561 6c20 6469 6d65 6e73 696f   actual dimensio
-000141e0: 6e73 0d0a 2020 2020 2020 2020 6465 6d5f  ns..        dem_
-000141f0: 7368 6170 6520 3d20 6465 6d2e 7368 6170  shape = dem.shap
-00014200: 650d 0a20 2020 2020 2020 2061 7370 6563  e..        aspec
-00014210: 745f 7368 6170 6520 3d20 6173 7065 6374  t_shape = aspect
-00014220: 2e73 6861 7065 0d0a 2020 2020 2020 2020  .shape..        
-00014230: 6469 7370 6c61 6365 6d65 6e74 5f73 6861  displacement_sha
-00014240: 7065 203d 2064 6973 706c 6163 656d 656e  pe = displacemen
-00014250: 742e 7368 6170 650d 0a0d 0a20 2020 2020  t.shape....     
-00014260: 2020 2023 2043 616c 6375 6c61 7469 6e67     # Calculating
-00014270: 207a 6f6f 6d20 6661 6374 6f72 730d 0a20   zoom factors.. 
-00014280: 2020 2020 2020 207a 6f6f 6d5f 6661 6374         zoom_fact
-00014290: 6f72 5f61 7370 6563 7420 3d20 5b64 656d  or_aspect = [dem
-000142a0: 5f64 696d 202f 2061 7370 6563 745f 6469  _dim / aspect_di
-000142b0: 6d20 666f 7220 6465 6d5f 6469 6d2c 2061  m for dem_dim, a
-000142c0: 7370 6563 745f 6469 6d20 696e 207a 6970  spect_dim in zip
-000142d0: 2864 656d 5f73 6861 7065 2c20 6173 7065  (dem_shape, aspe
-000142e0: 6374 5f73 6861 7065 295d 0d0a 2020 2020  ct_shape)]..    
-000142f0: 2020 2020 7a6f 6f6d 5f66 6163 746f 725f      zoom_factor_
-00014300: 6469 7370 6c61 6365 6d65 6e74 203d 205b  displacement = [
-00014310: 6465 6d5f 6469 6d20 2f20 6469 7370 6c61  dem_dim / displa
-00014320: 6365 6d65 6e74 5f64 696d 2066 6f72 2064  cement_dim for d
-00014330: 656d 5f64 696d 2c20 6469 7370 6c61 6365  em_dim, displace
-00014340: 6d65 6e74 5f64 696d 2069 6e20 7a69 7028  ment_dim in zip(
-00014350: 6465 6d5f 7368 6170 652c 2064 6973 706c  dem_shape, displ
-00014360: 6163 656d 656e 745f 7368 6170 6529 5d0d  acement_shape)].
-00014370: 0a0d 0a20 2020 2020 2020 2023 2052 6573  ...        # Res
-00014380: 697a 696e 6720 6173 7065 6374 2061 6e64  izing aspect and
-00014390: 2064 6973 706c 6163 656d 656e 7420 6172   displacement ar
-000143a0: 7261 7973 0d0a 2020 2020 2020 2020 6173  rays..        as
-000143b0: 7065 6374 203d 207a 6f6f 6d28 6173 7065  pect = zoom(aspe
-000143c0: 6374 2c20 7a6f 6f6d 5f66 6163 746f 725f  ct, zoom_factor_
-000143d0: 6173 7065 6374 2c20 6f72 6465 723d 3129  aspect, order=1)
-000143e0: 2020 2320 6375 6269 6320 696e 7465 7270    # cubic interp
-000143f0: 6f6c 6174 696f 6e0d 0a20 2020 2020 2020  olation..       
-00014400: 2064 6973 706c 6163 656d 656e 7420 3d20   displacement = 
-00014410: 7a6f 6f6d 2864 6973 706c 6163 656d 656e  zoom(displacemen
-00014420: 742c 207a 6f6f 6d5f 6661 6374 6f72 5f64  t, zoom_factor_d
-00014430: 6973 706c 6163 656d 656e 742c 206f 7264  isplacement, ord
-00014440: 6572 3d31 2920 2023 2063 7562 6963 2069  er=1)  # cubic i
-00014450: 6e74 6572 706f 6c61 7469 6f6e 0d0a 2020  nterpolation..  
-00014460: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
-00014470: 2320 6173 7065 6374 203d 206e 702e 7265  # aspect = np.re
-00014480: 7369 7a65 2861 7370 6563 742c 2064 656d  size(aspect, dem
-00014490: 2e73 6861 7065 290d 0a20 2020 2020 2020  .shape)..       
-000144a0: 2023 2064 6973 706c 6163 656d 656e 7420   # displacement 
-000144b0: 3d20 6e70 2e72 6573 697a 6528 6469 7370  = np.resize(disp
-000144c0: 6c61 6365 6d65 6e74 2c20 6465 6d2e 7368  lacement, dem.sh
-000144d0: 6170 6529 0d0a 2020 2020 2020 2020 0d0a  ape)..        ..
-000144e0: 2020 2020 2020 2020 736c 6f70 652c 2064          slope, d
-000144f0: 6972 6563 7469 6f6e 616c 5f67 7261 6420  irectional_grad 
-00014500: 3d20 6361 6c63 756c 6174 655f 736c 6f70  = calculate_slop
-00014510: 6528 6465 6d2c 2061 7370 6563 742c 2064  e(dem, aspect, d
-00014520: 7820 2c20 6479 2029 0d0a 2020 2020 2020  x , dy )..      
-00014530: 2020 6865 6967 6874 5f63 6861 6e67 6520    height_change 
-00014540: 203d 2063 616c 6375 6c61 7465 5f68 6569   = calculate_hei
-00014550: 6768 745f 6368 616e 6765 2873 6c6f 7065  ght_change(slope
-00014560: 2c20 6469 7265 6374 696f 6e61 6c5f 6772  , directional_gr
-00014570: 6164 2c20 6465 6d29 0d0a 2020 2020 2020  ad, dem)..      
-00014580: 2020 2368 6569 6768 745f 6368 616e 6765    #height_change
-00014590: 3d67 6175 7373 6961 6e28 6865 6967 6874  =gaussian(height
-000145a0: 5f63 6861 6e67 652c 2073 6967 6d61 3d33  _change, sigma=3
-000145b0: 290d 0a20 2020 2020 2020 2076 6f6c 756d  )..        volum
-000145c0: 655f 6368 616e 6765 203d 2063 616c 6375  e_change = calcu
-000145d0: 6c61 7465 5f76 6f6c 756d 655f 6368 616e  late_volume_chan
-000145e0: 6765 2868 6569 6768 745f 6368 616e 6765  ge(height_change
-000145f0: 2c20 7069 7865 6c5f 6172 6561 290d 0a20  , pixel_area).. 
-00014600: 2020 2020 2020 0d0a 2020 2020 2020 200d        ..       .
-00014610: 0a0d 0a20 2020 2020 2020 2023 2044 6566  ...        # Def
-00014620: 696e 6520 6120 6675 6e63 7469 6f6e 2074  ine a function t
-00014630: 6f20 6578 706f 7274 2064 6174 6120 746f  o export data to
-00014640: 2061 2047 656f 5449 4646 0d0a 2020 2020   a GeoTIFF..    
-00014650: 2020 2020 6465 6620 6578 706f 7274 5f74      def export_t
-00014660: 6f5f 6765 6f74 6966 6628 6461 7461 2c20  o_geotiff(data, 
-00014670: 6f75 7470 7574 5f70 6174 682c 2072 6566  output_path, ref
-00014680: 6572 656e 6365 5f72 6173 7465 7229 3a0d  erence_raster):.
-00014690: 0a20 2020 2020 2020 2020 2020 2077 6974  .            wit
-000146a0: 6820 7261 7374 6572 696f 2e6f 7065 6e28  h rasterio.open(
-000146b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000146c0: 2020 6f75 7470 7574 5f70 6174 682c 2027    output_path, '
-000146d0: 7727 2c0d 0a20 2020 2020 2020 2020 2020  w',..           
-000146e0: 2020 2020 2064 7269 7665 723d 2747 5469       driver='GTi
-000146f0: 6666 272c 0d0a 2020 2020 2020 2020 2020  ff',..          
-00014700: 2020 2020 2020 6865 6967 6874 3d64 6174        height=dat
-00014710: 612e 7368 6170 655b 305d 2c0d 0a20 2020  a.shape[0],..   
-00014720: 2020 2020 2020 2020 2020 2020 2077 6964               wid
-00014730: 7468 3d64 6174 612e 7368 6170 655b 315d  th=data.shape[1]
-00014740: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
-00014750: 2020 2063 6f75 6e74 3d31 2c0d 0a20 2020     count=1,..   
-00014760: 2020 2020 2020 2020 2020 2020 2064 7479               dty
-00014770: 7065 3d6e 702e 666c 6f61 7433 322c 0d0a  pe=np.float32,..
-00014780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014790: 6372 733d 7265 6665 7265 6e63 655f 7261  crs=reference_ra
-000147a0: 7374 6572 2e63 7273 2c0d 0a20 2020 2020  ster.crs,..     
-000147b0: 2020 2020 2020 2020 2020 2074 7261 6e73             trans
-000147c0: 666f 726d 3d72 6566 6572 656e 6365 5f72  form=reference_r
-000147d0: 6173 7465 722e 7472 616e 7366 6f72 6d2c  aster.transform,
-000147e0: 206e 6f64 6174 613d 6e70 2e6e 616e 0d0a   nodata=np.nan..
-000147f0: 2020 2020 2020 2020 2020 2020 2920 6173              ) as
-00014800: 206f 7574 7075 745f 7261 7374 6572 3a0d   output_raster:.
-00014810: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014820: 206f 7574 7075 745f 7261 7374 6572 2e77   output_raster.w
-00014830: 7269 7465 2864 6174 612c 2031 290d 0a0d  rite(data, 1)...
-00014840: 0a20 2020 2020 2020 2023 2045 7870 6f72  .        # Expor
-00014850: 7469 6e67 2073 6c6f 7065 2c20 6865 6967  ting slope, heig
-00014860: 6874 2063 6861 6e67 652c 2061 6e64 2076  ht change, and v
-00014870: 6f6c 756d 6520 6368 616e 6765 2074 6f20  olume change to 
-00014880: 4765 6f54 4946 4673 0d0a 2020 2020 2020  GeoTIFFs..      
-00014890: 2020 6578 706f 7274 5f74 6f5f 6765 6f74    export_to_geot
-000148a0: 6966 6628 736c 6f70 652c 2073 6c6f 7065  iff(slope, slope
-000148b0: 5f6f 7574 7075 745f 7061 7468 2c20 6465  _output_path, de
-000148c0: 6d5f 7261 7374 6572 290d 0a20 2020 2020  m_raster)..     
-000148d0: 2020 2065 7870 6f72 745f 746f 5f67 656f     export_to_geo
-000148e0: 7469 6666 2868 6569 6768 745f 6368 616e  tiff(height_chan
-000148f0: 6765 2c20 6865 6967 6874 5f6f 7574 7075  ge, height_outpu
-00014900: 745f 7061 7468 2c20 6465 6d5f 7261 7374  t_path, dem_rast
-00014910: 6572 290d 0a20 2020 2020 2020 2065 7870  er)..        exp
-00014920: 6f72 745f 746f 5f67 656f 7469 6666 2876  ort_to_geotiff(v
-00014930: 6f6c 756d 655f 6368 616e 6765 2c20 766f  olume_change, vo
-00014940: 6c75 6d65 5f6f 7574 7075 745f 7061 7468  lume_output_path
-00014950: 2c20 6465 6d5f 7261 7374 6572 290d 0a20  , dem_raster).. 
-00014960: 2020 2020 2020 0d0a 0d0a 0d0a 0d0a 696d        ........im
-00014970: 706f 7274 206e 756d 7079 2061 7320 6e70  port numpy as np
-00014980: 0d0a 6672 6f6d 206f 7367 656f 2069 6d70  ..from osgeo imp
-00014990: 6f72 7420 6764 616c 0d0a 0d0a 6465 6620  ort gdal....def 
-000149a0: 6361 6c63 756c 6174 655f 616e 645f 7361  calculate_and_sa
-000149b0: 7665 5f61 7370 6563 745f 7261 7374 6572  ve_aspect_raster
-000149c0: 2865 775f 7261 7374 6572 5f70 6174 683a  (ew_raster_path:
-000149d0: 2073 7472 203d 2222 2c20 6e73 5f72 6173   str ="", ns_ras
-000149e0: 7465 725f 7061 7468 3a20 7374 7220 3d22  ter_path: str ="
-000149f0: 222c 206f 7574 7075 745f 7261 7374 6572  ", output_raster
-00014a00: 5f70 6174 683a 2073 7472 203d 2222 293a  _path: str =""):
-00014a10: 0d0a 2020 2020 2222 220d 0a20 2020 2043  ..    """..    C
-00014a20: 616c 6375 6c61 7465 2074 6865 2061 7370  alculate the asp
-00014a30: 6563 7420 7261 7374 6572 2066 726f 6d20  ect raster from 
-00014a40: 6561 7374 2d77 6573 7420 616e 6420 6e6f  east-west and no
-00014a50: 7274 682d 736f 7574 6820 6469 7370 6c61  rth-south displa
-00014a60: 6365 6d65 6e74 2072 6173 7465 7273 2061  cement rasters a
-00014a70: 6e64 2073 6176 6520 6974 2e0d 0a0d 0a20  nd save it..... 
-00014a80: 2020 2054 6869 7320 6675 6e63 7469 6f6e     This function
-00014a90: 2072 6561 6473 2074 776f 2072 6173 7465   reads two raste
-00014aa0: 7220 6669 6c65 7320 7265 7072 6573 656e  r files represen
-00014ab0: 7469 6e67 2065 6173 742d 7765 7374 2028  ting east-west (
-00014ac0: 4557 2920 616e 6420 6e6f 7274 682d 736f  EW) and north-so
-00014ad0: 7574 6820 284e 5329 200d 0a20 2020 2064  uth (NS) ..    d
-00014ae0: 6973 706c 6163 656d 656e 7473 2c20 6361  isplacements, ca
-00014af0: 6c63 756c 6174 6573 2074 6865 2061 7370  lculates the asp
-00014b00: 6563 7420 6f66 2065 6163 6820 7069 7865  ect of each pixe
-00014b10: 6c2c 2061 6e64 2073 6176 6573 2074 6865  l, and saves the
-00014b20: 2072 6573 756c 7420 6173 2061 206e 6577   result as a new
-00014b30: 2072 6173 7465 7220 6669 6c65 2e0d 0a20   raster file... 
-00014b40: 2020 2041 7370 6563 7420 6973 2063 616c     Aspect is cal
-00014b50: 6375 6c61 7465 6420 696e 2064 6567 7265  culated in degre
-00014b60: 6573 2066 726f 6d20 6e6f 7274 6820 2830  es from north (0
-00014b70: 2064 6567 7265 6573 292c 2065 6173 7420   degrees), east 
-00014b80: 2839 3020 6465 6772 6565 7329 2c20 736f  (90 degrees), so
-00014b90: 7574 6820 2831 3830 2064 6567 7265 6573  uth (180 degrees
-00014ba0: 292c 0d0a 2020 2020 616e 6420 7765 7374  ),..    and west
-00014bb0: 2028 3237 3020 6465 6772 6565 7329 2e0d   (270 degrees)..
-00014bc0: 0a0d 0a20 2020 2050 6172 616d 6574 6572  ...    Parameter
-00014bd0: 733a 0d0a 2020 2020 2d20 6577 5f72 6173  s:..    - ew_ras
-00014be0: 7465 725f 7061 7468 2028 7374 7229 3a20  ter_path (str): 
-00014bf0: 4669 6c65 2070 6174 6820 666f 7220 7468  File path for th
-00014c00: 6520 6561 7374 2d77 6573 7420 6469 7370  e east-west disp
-00014c10: 6c61 6365 6d65 6e74 2072 6173 7465 722e  lacement raster.
-00014c20: 0d0a 2020 2020 2d20 6e73 5f72 6173 7465  ..    - ns_raste
-00014c30: 725f 7061 7468 2028 7374 7229 3a20 4669  r_path (str): Fi
-00014c40: 6c65 2070 6174 6820 666f 7220 7468 6520  le path for the 
-00014c50: 6e6f 7274 682d 736f 7574 6820 6469 7370  north-south disp
-00014c60: 6c61 6365 6d65 6e74 2072 6173 7465 722e  lacement raster.
-00014c70: 0d0a 2020 2020 2d20 6f75 7470 7574 5f72  ..    - output_r
-00014c80: 6173 7465 725f 7061 7468 2028 7374 7229  aster_path (str)
-00014c90: 3a20 4669 6c65 2070 6174 6820 666f 7220  : File path for 
-00014ca0: 7468 6520 6f75 7470 7574 2061 7370 6563  the output aspec
-00014cb0: 7420 7261 7374 6572 2e0d 0a0d 0a20 2020  t raster.....   
-00014cc0: 2052 6574 7572 6e73 3a0d 0a20 2020 204e   Returns:..    N
-00014cd0: 6f6e 652e 2054 6865 2072 6573 756c 7420  one. The result 
-00014ce0: 6973 2073 6176 6564 2061 7320 6120 6e65  is saved as a ne
-00014cf0: 7720 7261 7374 6572 2066 696c 6520 6174  w raster file at
-00014d00: 2074 6865 2073 7065 6369 6669 6564 206f   the specified o
-00014d10: 7574 7075 7420 7061 7468 2e0d 0a20 2020  utput path...   
-00014d20: 200d 0a20 2020 2022 2222 0d0a 2020 2020   ..    """..    
-00014d30: 6465 6620 7265 6164 5f72 6173 7465 7228  def read_raster(
-00014d40: 6669 6c65 5f70 6174 6829 3a0d 0a20 2020  file_path):..   
-00014d50: 2020 2020 2022 2222 5265 6164 2061 2072       """Read a r
-00014d60: 6173 7465 7220 6669 6c65 2061 6e64 2072  aster file and r
-00014d70: 6574 7572 6e20 7468 6520 6461 7461 2061  eturn the data a
-00014d80: 7272 6179 2061 6e64 2067 656f 7472 616e  rray and geotran
-00014d90: 7366 6f72 6d2e 2222 220d 0a0d 0a20 2020  sform."""....   
-00014da0: 2020 2020 2023 204f 7065 6e20 7468 6520       # Open the 
-00014db0: 6461 7461 7365 740d 0a20 2020 2020 2020  dataset..       
-00014dc0: 2064 6174 6173 6574 203d 2067 6461 6c2e   dataset = gdal.
-00014dd0: 4f70 656e 2866 696c 655f 7061 7468 290d  Open(file_path).
-00014de0: 0a20 2020 2020 2020 2069 6620 6461 7461  .        if data
-00014df0: 7365 7420 6973 204e 6f6e 653a 0d0a 2020  set is None:..  
-00014e00: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00014e10: 494f 4572 726f 7228 2243 6f75 6c64 206e  IOError("Could n
-00014e20: 6f74 206f 7065 6e20 6669 6c65 2061 7420  ot open file at 
-00014e30: 7b7d 222e 666f 726d 6174 2866 696c 655f  {}".format(file_
-00014e40: 7061 7468 2929 0d0a 0d0a 2020 2020 2020  path))....      
-00014e50: 2020 2320 4765 7420 7468 6520 6669 7273    # Get the firs
-00014e60: 7420 7261 7374 6572 2062 616e 640d 0a20  t raster band.. 
-00014e70: 2020 2020 2020 2062 616e 6420 3d20 6461         band = da
-00014e80: 7461 7365 742e 4765 7452 6173 7465 7242  taset.GetRasterB
-00014e90: 616e 6428 3129 0d0a 0d0a 2020 2020 2020  and(1)....      
-00014ea0: 2020 2320 5265 6164 2074 6865 2064 6174    # Read the dat
-00014eb0: 6120 6173 2061 206e 756d 7079 2061 7272  a as a numpy arr
-00014ec0: 6179 0d0a 2020 2020 2020 2020 6461 7461  ay..        data
-00014ed0: 203d 2062 616e 642e 5265 6164 4173 4172   = band.ReadAsAr
-00014ee0: 7261 7928 290d 0a0d 0a20 2020 2020 2020  ray()....       
-00014ef0: 2023 2047 6574 206e 6f2d 6461 7461 2076   # Get no-data v
-00014f00: 616c 7565 2066 726f 6d20 7468 6520 6261  alue from the ba
-00014f10: 6e64 0d0a 2020 2020 2020 2020 6e6f 6461  nd..        noda
-00014f20: 7461 5f76 616c 7565 203d 2062 616e 642e  ta_value = band.
-00014f30: 4765 744e 6f44 6174 6156 616c 7565 2829  GetNoDataValue()
-00014f40: 0d0a 0d0a 2020 2020 2020 2020 2320 4368  ....        # Ch
-00014f50: 6563 6b20 6966 2074 6865 7265 2069 7320  eck if there is 
-00014f60: 6120 6e6f 2d64 6174 6120 7661 6c75 6520  a no-data value 
-00014f70: 6465 6669 6e65 640d 0a20 2020 2020 2020  defined..       
-00014f80: 2069 6620 6e6f 6461 7461 5f76 616c 7565   if nodata_value
-00014f90: 2069 7320 6e6f 7420 4e6f 6e65 3a0d 0a20   is not None:.. 
-00014fa0: 2020 2020 2020 2020 2020 2023 2043 7265             # Cre
-00014fb0: 6174 6520 6120 6d61 736b 2074 6861 7420  ate a mask that 
-00014fc0: 6973 2054 7275 6520 666f 7220 7661 6c69  is True for vali
-00014fd0: 6420 7069 7865 6c73 0d0a 2020 2020 2020  d pixels..      
-00014fe0: 2020 2020 2020 6d61 736b 203d 2064 6174        mask = dat
-00014ff0: 6120 213d 206e 6f64 6174 615f 7661 6c75  a != nodata_valu
-00015000: 650d 0a0d 0a20 2020 2020 2020 2020 2020  e....           
-00015010: 2023 2041 7070 6c79 2074 6865 206d 6173   # Apply the mas
-00015020: 6b20 746f 2066 696c 7465 7220 6f75 7420  k to filter out 
-00015030: 6e6f 2d64 6174 6120 7069 7865 6c73 0d0a  no-data pixels..
-00015040: 2020 2020 2020 2020 2020 2020 7661 6c69              vali
-00015050: 645f 6461 7461 203d 206e 702e 7768 6572  d_data = np.wher
-00015060: 6528 6d61 736b 2c20 6461 7461 2c20 6e70  e(mask, data, np
-00015070: 2e6e 616e 2920 2023 2052 6570 6c61 6365  .nan)  # Replace
-00015080: 206e 6f2d 6461 7461 2077 6974 6820 4e61   no-data with Na
-00015090: 4e0d 0a20 2020 2020 2020 2065 6c73 653a  N..        else:
-000150a0: 0d0a 2020 2020 2020 2020 2020 2020 7661  ..            va
-000150b0: 6c69 645f 6461 7461 203d 2064 6174 6120  lid_data = data 
-000150c0: 2023 2041 6c6c 2064 6174 6120 6973 2076   # All data is v
-000150d0: 616c 6964 2069 6620 7468 6572 6520 6973  alid if there is
-000150e0: 206e 6f20 6e6f 2d64 6174 6120 7661 6c75   no no-data valu
-000150f0: 650d 0a0d 0a20 2020 2020 2020 2023 2052  e....        # R
-00015100: 6574 7269 6576 6520 6765 6f74 7261 6e73  etrieve geotrans
-00015110: 666f 726d 6174 696f 6e0d 0a20 2020 2020  formation..     
-00015120: 2020 2067 656f 7472 616e 7366 6f72 6d20     geotransform 
-00015130: 3d20 6461 7461 7365 742e 4765 7447 656f  = dataset.GetGeo
-00015140: 5472 616e 7366 6f72 6d28 290d 0a0d 0a20  Transform().... 
-00015150: 2020 2020 2020 2023 2043 6c6f 7365 2074         # Close t
-00015160: 6865 2064 6174 6173 6574 0d0a 2020 2020  he dataset..    
-00015170: 2020 2020 2364 6174 6173 6574 203d 204e      #dataset = N
-00015180: 6f6e 650d 0a0d 0a20 2020 2020 2020 2072  one....        r
-00015190: 6574 7572 6e20 7661 6c69 645f 6461 7461  eturn valid_data
-000151a0: 2c20 6765 6f74 7261 6e73 666f 726d 2c20  , geotransform, 
-000151b0: 6461 7461 7365 740d 0a0d 0a20 2020 2064  dataset....    d
-000151c0: 6566 2063 616c 6375 6c61 7465 5f61 7370  ef calculate_asp
-000151d0: 6563 7428 6577 5f64 6174 612c 206e 735f  ect(ew_data, ns_
-000151e0: 6461 7461 293a 0d0a 2020 2020 2020 2020  data):..        
-000151f0: 2222 2243 616c 6375 6c61 7465 2074 6865  """Calculate the
-00015200: 2061 7370 6563 7420 6672 6f6d 2045 5720   aspect from EW 
-00015210: 616e 6420 4e53 2064 6973 706c 6163 656d  and NS displacem
-00015220: 656e 7420 6461 7461 2e22 2222 0d0a 2020  ent data."""..  
-00015230: 2020 2020 2020 7769 7468 206e 702e 6572        with np.er
-00015240: 7273 7461 7465 2864 6976 6964 653d 2769  rstate(divide='i
-00015250: 676e 6f72 6527 2c20 696e 7661 6c69 643d  gnore', invalid=
-00015260: 2769 676e 6f72 6527 293a 0d0a 2020 2020  'ignore'):..    
-00015270: 2020 2020 2020 2020 6173 7065 6374 203d          aspect =
-00015280: 206e 702e 6172 6374 616e 3228 6577 5f64   np.arctan2(ew_d
-00015290: 6174 612c 206e 735f 6461 7461 290d 0a20  ata, ns_data).. 
-000152a0: 2020 2020 2020 2020 2020 2061 7370 6563             aspec
-000152b0: 745f 6465 673d 6e70 2e64 6567 7265 6573  t_deg=np.degrees
-000152c0: 2861 7370 6563 7429 0d0a 2020 2020 2020  (aspect)..      
-000152d0: 2020 2020 2020 6173 7065 6374 5f64 6567        aspect_deg
-000152e0: 203d 2028 3435 3020 2d61 7370 6563 745f   = (450 -aspect_
-000152f0: 6465 6720 2920 2520 3336 300d 0a20 2020  deg ) % 360..   
-00015300: 2020 2020 2072 6574 7572 6e20 6173 7065       return aspe
-00015310: 6374 5f64 6567 0d0a 0d0a 2020 2020 6465  ct_deg....    de
-00015320: 6620 7361 7665 5f72 6173 7465 7228 6f75  f save_raster(ou
-00015330: 7470 7574 5f70 6174 682c 2064 6174 612c  tput_path, data,
-00015340: 2067 656f 5f74 7261 6e73 666f 726d 2c20   geo_transform, 
-00015350: 7265 6665 7265 6e63 655f 6461 7461 7365  reference_datase
-00015360: 7429 3a0d 0a20 2020 2020 2020 2022 2222  t):..        """
-00015370: 5361 7665 2074 6865 2064 6174 6120 6173  Save the data as
-00015380: 2061 2072 6173 7465 7220 6669 6c65 2e22   a raster file."
-00015390: 2222 0d0a 2020 2020 2020 2020 6472 6976  ""..        driv
-000153a0: 6572 203d 2067 6461 6c2e 4765 7444 7269  er = gdal.GetDri
-000153b0: 7665 7242 794e 616d 6528 2747 5469 6666  verByName('GTiff
-000153c0: 2729 0d0a 2020 2020 2020 2020 726f 7773  ')..        rows
-000153d0: 2c20 636f 6c73 203d 2064 6174 612e 7368  , cols = data.sh
-000153e0: 6170 650d 0a20 2020 2020 2020 206f 7574  ape..        out
-000153f0: 5f72 6173 7465 7220 3d20 6472 6976 6572  _raster = driver
-00015400: 2e43 7265 6174 6528 6f75 7470 7574 5f70  .Create(output_p
-00015410: 6174 682c 2063 6f6c 732c 2072 6f77 732c  ath, cols, rows,
-00015420: 2031 2c20 6764 616c 2e47 4454 5f46 6c6f   1, gdal.GDT_Flo
-00015430: 6174 3332 290d 0a20 2020 2020 2020 206f  at32)..        o
-00015440: 7574 5f72 6173 7465 722e 5365 7447 656f  ut_raster.SetGeo
-00015450: 5472 616e 7366 6f72 6d28 6765 6f5f 7472  Transform(geo_tr
-00015460: 616e 7366 6f72 6d29 0d0a 2020 2020 2020  ansform)..      
-00015470: 2020 6f75 745f 6261 6e64 203d 206f 7574    out_band = out
-00015480: 5f72 6173 7465 722e 4765 7452 6173 7465  _raster.GetRaste
-00015490: 7242 616e 6428 3129 0d0a 2020 2020 2020  rBand(1)..      
-000154a0: 2020 6f75 745f 6261 6e64 2e57 7269 7465    out_band.Write
-000154b0: 4172 7261 7928 6461 7461 290d 0a20 2020  Array(data)..   
-000154c0: 2020 2020 206f 7574 5f72 6173 7465 722e       out_raster.
-000154d0: 5365 7450 726f 6a65 6374 696f 6e28 7265  SetProjection(re
-000154e0: 6665 7265 6e63 655f 6461 7461 7365 742e  ference_dataset.
-000154f0: 4765 7450 726f 6a65 6374 696f 6e28 2929  GetProjection())
-00015500: 0d0a 2020 2020 2020 2020 6f75 745f 6261  ..        out_ba
-00015510: 6e64 2e46 6c75 7368 4361 6368 6528 290d  nd.FlushCache().
-00015520: 0a0d 0a20 2020 2023 2052 6561 6420 7468  ...    # Read th
-00015530: 6520 4557 2061 6e64 204e 5320 7261 7374  e EW and NS rast
-00015540: 6572 2064 6174 610d 0a20 2020 2065 775f  er data..    ew_
-00015550: 6461 7461 2c20 6765 6f5f 7472 616e 7366  data, geo_transf
-00015560: 6f72 6d2c 2064 6174 6173 6574 203d 2072  orm, dataset = r
-00015570: 6561 645f 7261 7374 6572 2865 775f 7261  ead_raster(ew_ra
-00015580: 7374 6572 5f70 6174 6829 0d0a 2020 2020  ster_path)..    
-00015590: 6e73 5f64 6174 612c 205f 2c20 5f20 3d20  ns_data, _, _ = 
-000155a0: 7265 6164 5f72 6173 7465 7228 6e73 5f72  read_raster(ns_r
-000155b0: 6173 7465 725f 7061 7468 290d 0a0d 0a20  aster_path).... 
-000155c0: 2020 2023 2043 616c 6375 6c61 7465 2074     # Calculate t
-000155d0: 6865 2061 7370 6563 7420 616e 6420 7361  he aspect and sa
-000155e0: 7665 2074 6865 2072 6573 756c 740d 0a20  ve the result.. 
-000155f0: 2020 2061 7370 6563 745f 6461 7461 203d     aspect_data =
-00015600: 2063 616c 6375 6c61 7465 5f61 7370 6563   calculate_aspec
-00015610: 7428 6577 5f64 6174 612c 206e 735f 6461  t(ew_data, ns_da
-00015620: 7461 290d 0a20 2020 2073 6176 655f 7261  ta)..    save_ra
-00015630: 7374 6572 286f 7574 7075 745f 7261 7374  ster(output_rast
-00015640: 6572 5f70 6174 682c 2061 7370 6563 745f  er_path, aspect_
-00015650: 6461 7461 2c20 6765 6f5f 7472 616e 7366  data, geo_transf
-00015660: 6f72 6d2c 2064 6174 6173 6574 290d 0a0d  orm, dataset)...
-00015670: 0a23 2045 7861 6d70 6c65 2075 7361 6765  .# Example usage
-00015680: 3a0d 0a23 2063 616c 6375 6c61 7465 5f61  :..# calculate_a
-00015690: 6e64 5f73 6176 655f 6173 7065 6374 5f72  nd_save_aspect_r
-000156a0: 6173 7465 7228 2770 6174 685f 746f 5f65  aster('path_to_e
-000156b0: 775f 7261 7374 6572 2e74 6966 272c 2027  w_raster.tif', '
-000156c0: 7061 7468 5f74 6f5f 6e73 5f72 6173 7465  path_to_ns_raste
-000156d0: 722e 7469 6627 2c20 2770 6174 685f 746f  r.tif', 'path_to
-000156e0: 5f6f 7574 7075 745f 6173 7065 6374 5f72  _output_aspect_r
-000156f0: 6173 7465 722e 7469 6627 290d 0a0d 0a0d  aster.tif').....
-00015700: 0a0d 0a23 2323 2323 2323 2323 2323 2323  ...#############
-00015710: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00015720: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00015730: 230d 0a0d 0a                             #....
+00003f60: 6e61 6d65 2929 0d0a 0d0a 0d0a 0d0a 0d0a  name))..........
+00003f70: 696d 706f 7274 206d 6174 706c 6f74 6c69  import matplotli
+00003f80: 622e 7079 706c 6f74 2061 7320 706c 740d  b.pyplot as plt.
+00003f90: 0a69 6d70 6f72 7420 6e75 6d70 7920 6173  .import numpy as
+00003fa0: 206e 700d 0a69 6d70 6f72 7420 7261 7374   np..import rast
+00003fb0: 6572 696f 0d0a 6672 6f6d 2072 6173 7465  erio..from raste
+00003fc0: 7269 6f2e 7472 616e 7366 6f72 6d20 696d  rio.transform im
+00003fd0: 706f 7274 2041 6666 696e 650d 0a0d 0a0d  port Affine.....
+00003fe0: 0a64 6566 2063 616c 6375 6c61 7465 5f76  .def calculate_v
+00003ff0: 6f6c 756d 6528 656c 6576 6174 696f 6e5f  olume(elevation_
+00004000: 6d61 702c 2073 6c6f 7065 5f6d 6170 2c20  map, slope_map, 
+00004010: 6365 6c6c 5f73 697a 652c 206f 7574 7075  cell_size, outpu
+00004020: 745f 6669 6c65 2c20 706c 6f74 5f6d 6170  t_file, plot_map
+00004030: 3d46 616c 7365 2c20 706c 6f74 5f66 696c  =False, plot_fil
+00004040: 653d 4e6f 6e65 293a 0d0a 2020 2020 2222  e=None):..    ""
+00004050: 220d 0a20 2020 2043 616c 6375 6c61 7465  "..    Calculate
+00004060: 2074 6865 2076 6f6c 756d 6520 6261 7365   the volume base
+00004070: 6420 6f6e 2061 6e20 656c 6576 6174 696f  d on an elevatio
+00004080: 6e20 6d61 7020 616e 6420 6120 736c 6f70  n map and a slop
+00004090: 6520 6d61 702c 0d0a 2020 2020 616e 6420  e map,..    and 
+000040a0: 7361 7665 2074 6865 2076 6f6c 756d 6520  save the volume 
+000040b0: 6d61 7020 6173 2061 2047 656f 5449 4646  map as a GeoTIFF
+000040c0: 2066 696c 652e 204f 7074 696f 6e61 6c6c   file. Optionall
+000040d0: 792c 2070 6c6f 7420 7468 6520 766f 6c75  y, plot the volu
+000040e0: 6d65 206d 6170 2061 7320 6120 6669 6775  me map as a figu
+000040f0: 7265 2061 6e64 2073 6176 6520 6974 2e0d  re and save it..
+00004100: 0a0d 0a20 2020 2041 7267 733a 0d0a 2020  ...    Args:..  
+00004110: 2020 2020 2020 656c 6576 6174 696f 6e5f        elevation_
+00004120: 6d61 7020 2873 7472 293a 2046 696c 6520  map (str): File 
+00004130: 7061 7468 2074 6f20 7468 6520 656c 6576  path to the elev
+00004140: 6174 696f 6e20 6d61 7020 7261 7374 6572  ation map raster
+00004150: 2e0d 0a20 2020 2020 2020 2073 6c6f 7065  ...        slope
+00004160: 5f6d 6170 2028 6e64 6172 7261 7929 3a20  _map (ndarray): 
+00004170: 3244 2061 7272 6179 2072 6570 7265 7365  2D array represe
+00004180: 6e74 696e 6720 7468 6520 736c 6f70 6520  nting the slope 
+00004190: 7661 6c75 6573 2e0d 0a20 2020 2020 2020  values...       
+000041a0: 2063 656c 6c5f 7369 7a65 2028 666c 6f61   cell_size (floa
+000041b0: 7429 3a20 5369 7a65 206f 6620 6561 6368  t): Size of each
+000041c0: 2063 656c 6c20 696e 2074 6865 206d 6170   cell in the map
+000041d0: 2028 652e 672e 2c20 6c65 6e67 7468 206f   (e.g., length o
+000041e0: 6620 6f6e 6520 7369 6465 206f 6620 6120  f one side of a 
+000041f0: 7371 7561 7265 2063 656c 6c29 2e0d 0a20  square cell)... 
+00004200: 2020 2020 2020 206f 7574 7075 745f 6669         output_fi
+00004210: 6c65 2028 7374 7229 3a20 4f75 7470 7574  le (str): Output
+00004220: 2066 696c 6520 7061 7468 2066 6f72 2073   file path for s
+00004230: 6176 696e 6720 7468 6520 766f 6c75 6d65  aving the volume
+00004240: 206d 6170 2061 7320 6120 4765 6f54 4946   map as a GeoTIF
+00004250: 462e 0d0a 2020 2020 2020 2020 706c 6f74  F...        plot
+00004260: 5f6d 6170 2028 626f 6f6c 2c20 6f70 7469  _map (bool, opti
+00004270: 6f6e 616c 293a 2057 6865 7468 6572 2074  onal): Whether t
+00004280: 6f20 706c 6f74 2074 6865 2076 6f6c 756d  o plot the volum
+00004290: 6520 6d61 7020 6173 2061 2066 6967 7572  e map as a figur
+000042a0: 652e 2044 6566 6175 6c74 2069 7320 4661  e. Default is Fa
+000042b0: 6c73 652e 0d0a 2020 2020 2020 2020 706c  lse...        pl
+000042c0: 6f74 5f66 696c 6520 2873 7472 2c20 6f70  ot_file (str, op
+000042d0: 7469 6f6e 616c 293a 204f 7574 7075 7420  tional): Output 
+000042e0: 6669 6c65 2070 6174 6820 666f 7220 7361  file path for sa
+000042f0: 7669 6e67 2074 6865 2076 6f6c 756d 6520  ving the volume 
+00004300: 6d61 7020 706c 6f74 2e20 5265 7175 6972  map plot. Requir
+00004310: 6564 2069 6620 706c 6f74 5f6d 6170 2069  ed if plot_map i
+00004320: 7320 5472 7565 2e0d 0a0d 0a20 2020 2052  s True.....    R
+00004330: 6574 7572 6e73 3a0d 0a20 2020 2020 2020  eturns:..       
+00004340: 206e 6461 7272 6179 3a20 5468 6520 6361   ndarray: The ca
+00004350: 6c63 756c 6174 6564 2076 6f6c 756d 6520  lculated volume 
+00004360: 6d61 702e 0d0a 0d0a 2020 2020 2222 220d  map.....    """.
+00004370: 0a20 2020 2023 2052 6561 6420 656c 6576  .    # Read elev
+00004380: 6174 696f 6e20 6d61 7020 7261 7374 6572  ation map raster
+00004390: 2075 7369 6e67 2072 6173 7465 7269 6f0d   using rasterio.
+000043a0: 0a20 2020 2073 7263 3d20 7261 7374 6572  .    src= raster
+000043b0: 696f 2e6f 7065 6e28 656c 6576 6174 696f  io.open(elevatio
+000043c0: 6e5f 6d61 7029 0d0a 2020 2020 2320 4765  n_map)..    # Ge
+000043d0: 7420 4352 5320 6672 6f6d 2065 6c65 7661  t CRS from eleva
+000043e0: 7469 6f6e 5f6d 6170 0d0a 2020 2020 6372  tion_map..    cr
+000043f0: 7320 3d20 7372 632e 6372 730d 0a0d 0a20  s = src.crs.... 
+00004400: 2020 2023 2047 6574 2074 7261 6e73 666f     # Get transfo
+00004410: 726d 2066 726f 6d20 656c 6576 6174 696f  rm from elevatio
+00004420: 6e5f 6d61 700d 0a20 2020 2074 7261 6e73  n_map..    trans
+00004430: 666f 726d 203d 2073 7263 2e74 7261 6e73  form = src.trans
+00004440: 666f 726d 0d0a 0d0a 2020 2020 2023 2052  form....     # R
+00004450: 6561 6420 656c 6576 6174 696f 6e20 6d61  ead elevation ma
+00004460: 7020 6461 7461 0d0a 2020 2020 656c 6576  p data..    elev
+00004470: 6174 696f 6e5f 6461 7461 203d 2073 7263  ation_data = src
+00004480: 2e72 6561 6428 3129 0d0a 0d0a 2020 2020  .read(1)....    
+00004490: 2023 2052 6561 6420 656c 6576 6174 696f   # Read elevatio
+000044a0: 6e20 6d61 7020 7261 7374 6572 2075 7369  n map raster usi
+000044b0: 6e67 2072 6173 7465 7269 6f0d 0a20 2020  ng rasterio..   
+000044c0: 2073 7263 313d 2072 6173 7465 7269 6f2e   src1= rasterio.
+000044d0: 6f70 656e 2873 6c6f 7065 5f6d 6170 290d  open(slope_map).
+000044e0: 0a20 2020 2020 2020 200d 0a20 2020 2020  .        ..     
+000044f0: 2320 5265 6164 2073 6c6f 7065 5f6d 6170  # Read slope_map
+00004500: 2064 6174 610d 0a20 2020 2073 6c6f 7065   data..    slope
+00004510: 5f64 6174 6120 3d20 7372 632e 7265 6164  _data = src.read
+00004520: 2831 290d 0a0d 0a20 2020 2023 2043 616c  (1)....    # Cal
+00004530: 6375 6c61 7465 2074 6865 2064 696d 656e  culate the dimen
+00004540: 7369 6f6e 7320 6f66 2074 6865 206d 6170  sions of the map
+00004550: 730d 0a20 2020 2072 6f77 732c 2063 6f6c  s..    rows, col
+00004560: 7320 3d20 656c 6576 6174 696f 6e5f 6461  s = elevation_da
+00004570: 7461 2e73 6861 7065 0d0a 0d0a 2020 2020  ta.shape....    
+00004580: 2320 496e 6974 6961 6c69 7a65 2074 6865  # Initialize the
+00004590: 2076 6f6c 756d 6520 6d61 700d 0a20 2020   volume map..   
+000045a0: 2076 6f6c 756d 655f 6d61 7020 3d20 6e70   volume_map = np
+000045b0: 2e7a 6572 6f73 5f6c 696b 6528 656c 6576  .zeros_like(elev
+000045c0: 6174 696f 6e5f 6461 7461 2c20 6474 7970  ation_data, dtyp
+000045d0: 653d 666c 6f61 7429 0d0a 0d0a 2020 2020  e=float)....    
+000045e0: 2320 4974 6572 6174 6520 6f76 6572 2065  # Iterate over e
+000045f0: 6163 6820 6365 6c6c 2069 6e20 7468 6520  ach cell in the 
+00004600: 6d61 7073 0d0a 2020 2020 666f 7220 6920  maps..    for i 
+00004610: 696e 2072 616e 6765 2872 6f77 7329 3a0d  in range(rows):.
+00004620: 0a20 2020 2020 2020 2066 6f72 206a 2069  .        for j i
+00004630: 6e20 7261 6e67 6528 636f 6c73 293a 0d0a  n range(cols):..
+00004640: 2020 2020 2020 2020 2020 2020 2320 4361              # Ca
+00004650: 6c63 756c 6174 6520 7468 6520 6365 6c6c  lculate the cell
+00004660: 2061 7265 610d 0a20 2020 2020 2020 2020   area..         
+00004670: 2020 2061 7265 6120 3d20 6365 6c6c 5f73     area = cell_s
+00004680: 697a 6520 2a2a 2032 0d0a 0d0a 2020 2020  ize ** 2....    
+00004690: 2020 2020 2020 2020 2320 4361 6c63 756c          # Calcul
+000046a0: 6174 6520 7468 6520 6365 6c6c 2076 6f6c  ate the cell vol
+000046b0: 756d 6520 636f 6e74 7269 6275 7469 6f6e  ume contribution
+000046c0: 0d0a 2020 2020 2020 2020 2020 2020 766f  ..            vo
+000046d0: 6c75 6d65 5f6d 6170 5b69 2c20 6a5d 202b  lume_map[i, j] +
+000046e0: 3d20 656c 6576 6174 696f 6e5f 6461 7461  = elevation_data
+000046f0: 5b69 2c20 6a5d 202a 2061 7265 610d 0a0d  [i, j] * area...
+00004700: 0a20 2020 2020 2020 2020 2020 2023 2043  .            # C
+00004710: 616c 6375 6c61 7465 2074 6865 2073 6c6f  alculate the slo
+00004720: 7065 2067 7261 6469 656e 740d 0a20 2020  pe gradient..   
+00004730: 2020 2020 2020 2020 2073 6c6f 7065 5f67           slope_g
+00004740: 7261 6469 656e 7420 3d20 6e70 2e74 616e  radient = np.tan
+00004750: 286e 702e 7261 6469 616e 7328 736c 6f70  (np.radians(slop
+00004760: 655f 6461 7461 5b69 2c20 6a5d 2929 0d0a  e_data[i, j]))..
+00004770: 0d0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+00004780: 4361 6c63 756c 6174 6520 7468 6520 6164  Calculate the ad
+00004790: 6469 7469 6f6e 616c 2076 6f6c 756d 6520  ditional volume 
+000047a0: 6475 6520 746f 2074 6865 2073 6c6f 7065  due to the slope
+000047b0: 0d0a 2020 2020 2020 2020 2020 2020 766f  ..            vo
+000047c0: 6c75 6d65 5f6d 6170 5b69 2c20 6a5d 202b  lume_map[i, j] +
+000047d0: 3d20 302e 3520 2a20 736c 6f70 655f 6772  = 0.5 * slope_gr
+000047e0: 6164 6965 6e74 202a 2061 7265 610d 0a0d  adient * area...
+000047f0: 0a20 2020 2023 2053 6176 6520 766f 6c75  .    # Save volu
+00004800: 6d65 206d 6170 2061 7320 4765 6f54 4946  me map as GeoTIF
+00004810: 460d 0a20 2020 2077 6974 6820 7261 7374  F..    with rast
+00004820: 6572 696f 2e6f 7065 6e28 6f75 7470 7574  erio.open(output
+00004830: 5f66 696c 652c 2022 7722 2c20 6472 6976  _file, "w", driv
+00004840: 6572 3d22 4754 6966 6622 2c20 6865 6967  er="GTiff", heig
+00004850: 6874 3d76 6f6c 756d 655f 6d61 702e 7368  ht=volume_map.sh
+00004860: 6170 655b 305d 2c20 7769 6474 683d 766f  ape[0], width=vo
+00004870: 6c75 6d65 5f6d 6170 2e73 6861 7065 5b31  lume_map.shape[1
+00004880: 5d2c 2063 6f75 6e74 3d31 2c20 6474 7970  ], count=1, dtyp
+00004890: 653d 766f 6c75 6d65 5f6d 6170 2e64 7479  e=volume_map.dty
+000048a0: 7065 2c20 6372 733d 6372 732c 2074 7261  pe, crs=crs, tra
+000048b0: 6e73 666f 726d 3d74 7261 6e73 666f 726d  nsform=transform
+000048c0: 2920 6173 2064 7374 3a0d 0a20 2020 2020  ) as dst:..     
+000048d0: 2020 2064 7374 2e77 7269 7465 2876 6f6c     dst.write(vol
+000048e0: 756d 655f 6d61 702c 2031 290d 0a0d 0a20  ume_map, 1).... 
+000048f0: 2020 2023 2050 6c6f 7420 616e 6420 7361     # Plot and sa
+00004900: 7665 2076 6f6c 756d 6520 6d61 7020 6966  ve volume map if
+00004910: 2064 6573 6972 6564 0d0a 2020 2020 6966   desired..    if
+00004920: 2070 6c6f 745f 6d61 703a 0d0a 2020 2020   plot_map:..    
+00004930: 2020 2020 706c 742e 696d 7368 6f77 2876      plt.imshow(v
+00004940: 6f6c 756d 655f 6d61 702c 2063 6d61 703d  olume_map, cmap=
+00004950: 2776 6972 6964 6973 2729 0d0a 2020 2020  'viridis')..    
+00004960: 2020 2020 706c 742e 636f 6c6f 7262 6172      plt.colorbar
+00004970: 286c 6162 656c 3d27 566f 6c75 6d65 2729  (label='Volume')
+00004980: 0d0a 2020 2020 2020 2020 706c 742e 7469  ..        plt.ti
+00004990: 746c 6528 2756 6f6c 756d 6520 4d61 7027  tle('Volume Map'
+000049a0: 290d 0a20 2020 2020 2020 2070 6c74 2e78  )..        plt.x
+000049b0: 6c61 6265 6c28 2743 6f6c 756d 6e27 290d  label('Column').
+000049c0: 0a20 2020 2020 2020 2070 6c74 2e79 6c61  .        plt.yla
+000049d0: 6265 6c28 2752 6f77 2729 0d0a 2020 2020  bel('Row')..    
+000049e0: 2020 2020 706c 742e 7469 6768 745f 6c61      plt.tight_la
+000049f0: 796f 7574 2829 0d0a 2020 2020 2020 2020  yout()..        
+00004a00: 706c 742e 7361 7665 6669 6728 706c 6f74  plt.savefig(plot
+00004a10: 5f66 696c 6529 0d0a 2020 2020 2020 2020  _file)..        
+00004a20: 706c 742e 7368 6f77 2829 0d0a 0d0a 2020  plt.show()....  
+00004a30: 2020 7265 7475 726e 2076 6f6c 756d 655f    return volume_
+00004a40: 6d61 700d 0a0d 0a0d 0a0d 0a0d 0a23 2064  map..........# d
+00004a50: 6566 2074 735f 706c 6f74 2864 662c 2070  ef ts_plot(df, p
+00004a60: 6c6f 745f 6e75 6d62 6572 2c20 7361 7665  lot_number, save
+00004a70: 5f70 6c6f 743d 4661 6c73 6520 2c20 6f75  _plot=False , ou
+00004a80: 7470 7574 5f64 6972 3d22 222c 2070 6c6f  tput_dir="", plo
+00004a90: 745f 6669 6c65 6e61 6d65 3d22 2220 2c20  t_filename="" , 
+00004aa0: 5645 4c5f 5363 616c 653d 2779 6561 7227  VEL_Scale='year'
+00004ab0: 293a 0d0a 0d0a 0d0a 2320 2020 2020 696d  ):......#     im
+00004ac0: 706f 7274 2070 6c6f 746c 792e 6772 6170  port plotly.grap
+00004ad0: 685f 6f62 6a65 6374 7320 6173 2067 6f0d  h_objects as go.
+00004ae0: 0a23 2020 2020 2069 6d70 6f72 7420 706c  .#     import pl
+00004af0: 6f74 6c79 2e65 7870 7265 7373 2061 7320  otly.express as 
+00004b00: 7078 0d0a 2320 2020 2020 696d 706f 7274  px..#     import
+00004b10: 2070 6c6f 746c 792e 6578 7072 6573 7320   plotly.express 
+00004b20: 6173 2070 785f 7465 6d70 0d0a 2320 2020  as px_temp..#   
+00004b30: 2020 696d 706f 7274 2070 616e 6461 7320    import pandas 
+00004b40: 6173 2070 640d 0a23 2020 2020 2069 6d70  as pd..#     imp
+00004b50: 6f72 7420 6e75 6d70 7920 6173 206e 700d  ort numpy as np.
+00004b60: 0a23 2020 2020 2069 6d70 6f72 7420 6d61  .#     import ma
+00004b70: 7470 6c6f 746c 6962 2e70 7970 6c6f 7420  tplotlib.pyplot 
+00004b80: 6173 2070 6c74 0d0a 2320 2020 2020 696d  as plt..#     im
+00004b90: 706f 7274 2067 656f 7061 6e64 6173 2061  port geopandas a
+00004ba0: 7320 6770 6420 0d0a 2320 2020 2020 696d  s gpd ..#     im
+00004bb0: 706f 7274 2070 616e 6461 7320 6173 2070  port pandas as p
+00004bc0: 6420 200d 0a23 2020 2020 2069 6d70 6f72  d  ..#     impor
+00004bd0: 7420 7365 6162 6f72 6e20 6173 2073 6e73  t seaborn as sns
+00004be0: 2020 0d0a 2320 2020 2020 696d 706f 7274    ..#     import
+00004bf0: 2070 6c6f 746c 792e 6f66 666c 696e 6520   plotly.offline 
+00004c00: 6173 2070 795f 6f66 666c 696e 650d 0a23  as py_offline..#
+00004c10: 2020 2020 2069 6d70 6f72 7420 6f73 2020       import os  
+00004c20: 200d 0a23 2020 2020 2069 6d70 6f72 7420   ..#     import 
+00004c30: 7374 6174 736d 6f64 656c 732e 6170 6920  statsmodels.api 
+00004c40: 6173 2073 6d0d 0a23 2020 2020 2066 726f  as sm..#     fro
+00004c50: 6d20 736b 6c65 6172 6e2e 6d65 7472 6963  m sklearn.metric
+00004c60: 7320 696d 706f 7274 206d 6561 6e5f 7371  s import mean_sq
+00004c70: 7561 7265 645f 6572 726f 722c 2072 325f  uared_error, r2_
+00004c80: 7363 6f72 650d 0a23 2020 2020 2069 6d70  score..#     imp
+00004c90: 6f72 7420 6e75 6d70 7920 6173 206e 700d  ort numpy as np.
+00004ca0: 0a23 2020 2020 2066 726f 6d20 736b 6c65  .#     from skle
+00004cb0: 6172 6e2e 6c69 6e65 6172 5f6d 6f64 656c  arn.linear_model
+00004cc0: 2069 6d70 6f72 7420 4c69 6e65 6172 5265   import LinearRe
+00004cd0: 6772 6573 7369 6f6e 0d0a 2320 2020 2020  gression..#     
+00004ce0: 6672 6f6d 2064 6174 6574 696d 6520 696d  from datetime im
+00004cf0: 706f 7274 2064 6174 6574 696d 650d 0a23  port datetime..#
+00004d00: 2020 2020 2069 6d70 6f72 7420 6d61 7468       import math
+00004d10: 0d0a 2020 2020 0d0a 2320 2020 2020 7079  ..    ..#     py
+00004d20: 5f6f 6666 6c69 6e65 2e69 6e69 745f 6e6f  _offline.init_no
+00004d30: 7465 626f 6f6b 5f6d 6f64 6528 290d 0a23  tebook_mode()..#
+00004d40: 2020 2020 2023 256d 6174 706c 6f74 6c69       #%matplotli
+00004d50: 6220 7769 6467 6574 0d0a 2320 2020 2020  b widget..#     
+00004d60: 2364 663d 7064 2e72 6561 645f 6373 7628  #df=pd.read_csv(
+00004d70: 2274 656d 702e 6373 7622 290d 0a23 2020  "temp.csv")..#  
+00004d80: 2020 2064 662e 7265 6e61 6d65 2863 6f6c     df.rename(col
+00004d90: 756d 6e73 3d7b 2064 662e 636f 6c75 6d6e  umns={ df.column
+00004da0: 735b 305d 3a20 2264 6422 207d 2c20 696e  s[0]: "dd" }, in
+00004db0: 706c 6163 6520 3d20 5472 7565 290d 0a23  place = True)..#
+00004dc0: 2020 2020 2064 665b 2764 645f 7374 7227       df['dd_str'
+00004dd0: 5d3d 6466 5b27 6464 275d 2e61 7374 7970  ]=df['dd'].astyp
+00004de0: 6528 7374 7229 0d0a 2320 2020 2020 6466  e(str)..#     df
+00004df0: 5b27 6464 5f73 7472 275d 203d 2064 665b  ['dd_str'] = df[
+00004e00: 2764 645f 7374 7227 5d2e 6173 7479 7065  'dd_str'].astype
+00004e10: 2873 7472 290d 0a23 2020 2020 2064 662e  (str)..#     df.
+00004e20: 7265 6e61 6d65 2863 6f6c 756d 6e73 3d7b  rename(columns={
+00004e30: 2064 662e 636f 6c75 6d6e 735b 315d 3a20   df.columns[1]: 
+00004e40: 2276 616c 2220 7d2c 2069 6e70 6c61 6365  "val" }, inplace
+00004e50: 203d 2054 7275 6529 0d0a 2320 2020 2020   = True)..#     
+00004e60: 6466 5b27 6464 275d 3d20 7064 2e74 6f5f  df['dd']= pd.to_
+00004e70: 6461 7465 7469 6d65 2864 665b 2764 6427  datetime(df['dd'
+00004e80: 5d2e 6173 7479 7065 2873 7472 292c 2066  ].astype(str), f
+00004e90: 6f72 6d61 743d 2725 5925 6d25 6427 290d  ormat='%Y%m%d').
+00004ea0: 0a20 2020 200d 0a23 2020 2020 2064 663d  .    ..#     df=
+00004eb0: 6466 2e73 6574 5f69 6e64 6578 2827 6464  df.set_index('dd
+00004ec0: 2729 0d0a 2020 2020 0d0a 2320 2020 2020  ')..    ..#     
+00004ed0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00004ee0: 2323 2323 2323 2323 0d0a 2320 2020 2020  ########..#     
+00004ef0: 6466 3d64 662e 6472 6f70 6e61 2829 0d0a  df=df.dropna()..
+00004f00: 2320 2020 2020 2320 4d61 6b65 2069 6e64  #     # Make ind
+00004f10: 6578 2070 642e 4461 7465 7469 6d65 496e  ex pd.DatetimeIn
+00004f20: 6465 780d 0a23 2020 2020 2064 662e 696e  dex..#     df.in
+00004f30: 6465 7820 3d20 7064 2e44 6174 6574 696d  dex = pd.Datetim
+00004f40: 6549 6e64 6578 2864 662e 696e 6465 7829  eIndex(df.index)
+00004f50: 0d0a 2320 2020 2020 2320 4d61 6b65 206e  ..#     # Make n
+00004f60: 6577 2069 6e64 6578 0d0a 2320 2020 2020  ew index..#     
+00004f70: 6964 7820 3d20 7064 2e64 6174 655f 7261  idx = pd.date_ra
+00004f80: 6e67 6528 6466 2e69 6e64 6578 2e6d 696e  nge(df.index.min
+00004f90: 2829 2c20 6466 2e69 6e64 6578 2e6d 6178  (), df.index.max
+00004fa0: 2829 290d 0a23 2020 2020 2023 2052 6570  ())..#     # Rep
+00004fb0: 6c61 6365 206f 7269 6769 6e61 6c20 696e  lace original in
+00004fc0: 6465 7820 7769 7468 2069 6478 0d0a 2320  dex with idx..# 
+00004fd0: 2020 2020 6466 203d 2064 662e 7265 696e      df = df.rein
+00004fe0: 6465 7828 696e 6465 7820 3d20 6964 7829  dex(index = idx)
+00004ff0: 0d0a 2320 2020 2020 2320 496e 7365 7274  ..#     # Insert
+00005000: 2072 6f77 2063 6f75 6e74 0d0a 2320 2020   row count..#   
+00005010: 2020 6466 2e69 6e73 6572 7428 6466 2e73    df.insert(df.s
+00005020: 6861 7065 5b31 5d2c 0d0a 2320 2020 2020  hape[1],..#     
+00005030: 2020 2020 2020 2020 2772 6f77 5f63 6f75          'row_cou
+00005040: 6e74 272c 0d0a 2320 2020 2020 2020 2020  nt',..#         
+00005050: 2020 2020 6466 2e69 6e64 6578 2e76 616c      df.index.val
+00005060: 7565 5f63 6f75 6e74 7328 292e 736f 7274  ue_counts().sort
+00005070: 5f69 6e64 6578 2829 2e63 756d 7375 6d28  _index().cumsum(
+00005080: 2929 0d0a 0d0a 2320 2020 2020 6466 3d64  ))....#     df=d
+00005090: 662e 6472 6f70 6e61 2829 0d0a 2020 2020  f.dropna()..    
+000050a0: 0d0a 2320 2020 2020 2364 663d 6466 2e73  ..#     #df=df.s
+000050b0: 6574 5f69 6e64 6578 2864 665b 2772 6f77  et_index(df['row
+000050c0: 5f63 6f75 6e74 275d 2c20 696e 706c 6163  _count'], inplac
+000050d0: 653d 5472 7565 290d 0a0d 0a23 2020 2020  e=True)....#    
+000050e0: 2064 662e 736f 7274 5f69 6e64 6578 2861   df.sort_index(a
+000050f0: 7363 656e 6469 6e67 3d54 7275 652c 2069  scending=True, i
+00005100: 6e70 6c61 6365 3d54 7275 6529 0d0a 2020  nplace=True)..  
+00005110: 2020 0d0a 0d0a 2320 2020 2020 6465 6620    ....#     def 
+00005120: 6265 7374 5f66 6974 5f73 6c6f 7065 5f61  best_fit_slope_a
+00005130: 6e64 5f69 6e74 6572 6365 7074 2878 732c  nd_intercept(xs,
+00005140: 7973 293a 0d0a 2320 2020 2020 2020 2020  ys):..#         
+00005150: 6672 6f6d 2073 7461 7469 7374 6963 7320  from statistics 
+00005160: 696d 706f 7274 206d 6561 6e0d 0a23 2020  import mean..#  
+00005170: 2020 2020 2020 2078 7320 3d20 6e70 2e61         xs = np.a
+00005180: 7272 6179 2878 732c 2064 7479 7065 3d6e  rray(xs, dtype=n
+00005190: 702e 666c 6f61 7436 3429 0d0a 2320 2020  p.float64)..#   
+000051a0: 2020 2020 2020 7973 203d 206e 702e 6172        ys = np.ar
+000051b0: 7261 7928 7973 2c20 6474 7970 653d 6e70  ray(ys, dtype=np
+000051c0: 2e66 6c6f 6174 3634 290d 0a23 2020 2020  .float64)..#    
+000051d0: 2020 2020 206d 203d 2028 2828 6d65 616e       m = (((mean
+000051e0: 2878 7329 2a6d 6561 6e28 7973 2929 202d  (xs)*mean(ys)) -
+000051f0: 206d 6561 6e28 7873 2a79 7329 2920 2f0d   mean(xs*ys)) /.
+00005200: 0a23 2020 2020 2020 2020 2020 2020 2028  .#             (
+00005210: 286d 6561 6e28 7873 292a 6d65 616e 2878  (mean(xs)*mean(x
+00005220: 7329 2920 2d20 6d65 616e 2878 732a 7873  s)) - mean(xs*xs
+00005230: 2929 290d 0a20 2020 2020 2020 200d 0a23  )))..        ..#
+00005240: 2020 2020 2020 2020 2062 203d 206d 6561           b = mea
+00005250: 6e28 7973 2920 2d20 6d2a 6d65 616e 2878  n(ys) - m*mean(x
+00005260: 7329 0d0a 2020 2020 2020 2020 0d0a 2320  s)..        ..# 
+00005270: 2020 2020 2020 2020 7265 7475 726e 206d          return m
+00005280: 2c20 620d 0a0d 0a20 2020 200d 0a0d 0a23  , b....    ....#
+00005290: 2020 2020 2023 636f 6e76 6572 7420 6461       #convert da
+000052a0: 7474 696d 6520 746f 206e 756d 6265 7220  ttime to number 
+000052b0: 6f66 2064 6179 7320 7065 7220 7965 6172  of days per year
+000052c0: 0d0a 2020 2020 0d0a 2020 2020 0d0a 2020  ..    ..    ..  
+000052d0: 2020 0d0a 0d0a 2320 2020 2020 6461 7465    ....#     date
+000052e0: 735f 6c69 7374 3d28 5b64 6174 6574 696d  s_list=([datetim
+000052f0: 652e 7374 7270 7469 6d65 2878 2c20 2725  e.strptime(x, '%
+00005300: 5925 6d25 6427 2920 666f 7220 7820 696e  Y%m%d') for x in
+00005310: 2064 662e 6464 5f73 7472 5d29 0d0a 2320   df.dd_str])..# 
+00005320: 2020 2020 6461 7973 5f6e 756d 3d5b 2820      days_num=[( 
+00005330: 2828 7829 202d 2028 7064 2e54 696d 6573  ((x) - (pd.Times
+00005340: 7461 6d70 2879 6561 723d 782e 7965 6172  tamp(year=x.year
+00005350: 2c20 6d6f 6e74 683d 312c 2064 6179 3d31  , month=1, day=1
+00005360: 2929 292e 6461 7973 202b 2031 2920 666f  ))).days + 1) fo
+00005370: 7220 7820 696e 2064 6174 6573 5f6c 6973  r x in dates_lis
+00005380: 745d 0d0a 2320 2020 2020 7469 6d65 323d  t]..#     time2=
+00005390: 6461 7973 5f6e 756d 5b6c 656e 2864 6179  days_num[len(day
+000053a0: 735f 6e75 6d29 2d31 5d0d 0a23 2020 2020  s_num)-1]..#    
+000053b0: 2074 696d 6531 3d64 6179 735f 6e75 6d5b   time1=days_num[
+000053c0: 305d 0d0a 2320 2020 2020 6465 6c74 613d  0]..#     delta=
+000053d0: 7469 6d65 322d 7469 6d65 310d 0a23 2020  time2-time1..#  
+000053e0: 2020 2064 656c 7461 3d66 6c6f 6174 2864     delta=float(d
+000053f0: 656c 7461 290d 0a23 2020 2020 2070 7269  elta)..#     pri
+00005400: 6e74 2864 6179 735f 6e75 6d2c 2064 656c  nt(days_num, del
+00005410: 7461 290d 0a20 2020 200d 0a23 2020 2020  ta)..    ..#    
+00005420: 206d 2c20 6220 3d20 6265 7374 5f66 6974   m, b = best_fit
+00005430: 5f73 6c6f 7065 5f61 6e64 5f69 6e74 6572  _slope_and_inter
+00005440: 6365 7074 2864 662e 726f 775f 636f 756e  cept(df.row_coun
+00005450: 742c 2064 662e 7661 6c29 0d0a 2320 2020  t, df.val)..#   
+00005460: 2020 7072 696e 7428 226d 3a22 2c20 6d61    print("m:", ma
+00005470: 7468 2e63 6569 6c28 6d2a 3130 3029 2f31  th.ceil(m*100)/1
+00005480: 3030 2c20 2262 3a22 2c6d 6174 682e 6365  00, "b:",math.ce
+00005490: 696c 2862 2a31 3030 292f 3130 3029 0d0a  il(b*100)/100)..
+000054a0: 2320 2020 2020 7265 6772 6573 7369 6f6e  #     regression
+000054b0: 5f6d 6f64 656c 203d 204c 696e 6561 7252  _model = LinearR
+000054c0: 6567 7265 7373 696f 6e28 290d 0a23 2020  egression()..#  
+000054d0: 2020 2076 616c 5f64 6174 6573 5f72 6573     val_dates_res
+000054e0: 203d 2072 6567 7265 7373 696f 6e5f 6d6f   = regression_mo
+000054f0: 6465 6c2e 6669 7428 6e70 2e61 7272 6179  del.fit(np.array
+00005500: 2864 6179 735f 6e75 6d29 2e72 6573 6861  (days_num).resha
+00005510: 7065 282d 312c 3129 2c20 6e70 2e61 7272  pe(-1,1), np.arr
+00005520: 6179 2864 662e 7661 6c29 290d 0a23 2020  ay(df.val))..#  
+00005530: 2020 2079 5f70 7265 6469 6374 6564 203d     y_predicted =
+00005540: 2072 6567 7265 7373 696f 6e5f 6d6f 6465   regression_mode
+00005550: 6c2e 7072 6564 6963 7428 6e70 2e61 7272  l.predict(np.arr
+00005560: 6179 2864 6179 735f 6e75 6d29 2e72 6573  ay(days_num).res
+00005570: 6861 7065 282d 312c 3129 290d 0a20 2020  hape(-1,1))..   
+00005580: 200d 0a23 2020 2020 2069 6620 5645 4c5f   ..#     if VEL_
+00005590: 5363 616c 653d 3d27 7965 6172 273a 0d0a  Scale=='year':..
+000055a0: 2320 2020 2020 2020 2020 7261 7465 5f63  #         rate_c
+000055b0: 6861 6e67 653d 7265 6772 6573 7369 6f6e  hange=regression
+000055c0: 5f6d 6f64 656c 2e63 6f65 665f 5b30 5d2f  _model.coef_[0]/
+000055d0: 6465 6c74 6120 2a20 3336 352e 300d 0a23  delta * 365.0..#
+000055e0: 2020 2020 2065 6c69 6620 5645 4c5f 5363       elif VEL_Sc
+000055f0: 616c 653d 3d27 6d6f 6e74 6827 3a0d 0a23  ale=='month':..#
+00005600: 2020 2020 2020 2020 2072 6174 655f 6368           rate_ch
+00005610: 616e 6765 3d72 6567 7265 7373 696f 6e5f  ange=regression_
+00005620: 6d6f 6465 6c2e 636f 6566 5f5b 305d 2f64  model.coef_[0]/d
+00005630: 656c 7461 202a 2033 300d 0a20 2020 2020  elta * 30..     
+00005640: 2020 200d 0a23 2020 2020 2023 206d 6f64     ..#     # mod
+00005650: 656c 2065 7661 6c75 6174 696f 6e0d 0a23  el evaluation..#
+00005660: 2020 2020 206d 7365 3d6d 6561 6e5f 7371       mse=mean_sq
+00005670: 7561 7265 645f 6572 726f 7228 6e70 2e61  uared_error(np.a
+00005680: 7272 6179 2864 662e 7661 6c29 2c79 5f70  rray(df.val),y_p
+00005690: 7265 6469 6374 6564 290d 0a23 2020 2020  redicted)..#    
+000056a0: 2072 6d73 6520 3d20 6e70 2e73 7172 7428   rmse = np.sqrt(
+000056b0: 6d65 616e 5f73 7175 6172 6564 5f65 7272  mean_squared_err
+000056c0: 6f72 286e 702e 6172 7261 7928 6466 2e76  or(np.array(df.v
+000056d0: 616c 292c 2079 5f70 7265 6469 6374 6564  al), y_predicted
+000056e0: 2929 0d0a 2320 2020 2020 7232 203d 2072  ))..#     r2 = r
+000056f0: 325f 7363 6f72 6528 6e70 2e61 7272 6179  2_score(np.array
+00005700: 2864 662e 7661 6c29 2c20 795f 7072 6564  (df.val), y_pred
+00005710: 6963 7465 6429 0d0a 2020 2020 0d0a 2320  icted)..    ..# 
+00005720: 2020 2020 2320 7072 696e 7469 6e67 2076      # printing v
+00005730: 616c 7565 730d 0a23 2020 2020 2070 7269  alues..#     pri
+00005740: 6e74 2827 536c 6f70 6528 6c69 6e65 6172  nt('Slope(linear
+00005750: 2064 6566 6f72 6d61 7469 6f6e 2072 6174   deformation rat
+00005760: 6529 3a27 202b 2073 7472 286d 6174 682e  e):' + str(math.
+00005770: 6365 696c 2872 6567 7265 7373 696f 6e5f  ceil(regression_
+00005780: 6d6f 6465 6c2e 636f 6566 5f5b 305d 2a31  model.coef_[0]*1
+00005790: 3030 292f 3130 302f 6465 6c74 6129 202b  00)/100/delta) +
+000057a0: 2022 206d 6d2f 6461 7922 290d 0a23 2020   " mm/day")..#  
+000057b0: 2020 2070 7269 6e74 2827 496e 7465 7263     print('Interc
+000057c0: 6570 743a 272c 206d 6174 682e 6365 696c  ept:', math.ceil
+000057d0: 2862 2a31 3030 292f 3130 3029 0d0a 2320  (b*100)/100)..# 
+000057e0: 2020 2020 2370 7269 6e74 2827 4d53 453a      #print('MSE:
+000057f0: 272c 6d73 6529 0d0a 2320 2020 2020 7072  ',mse)..#     pr
+00005800: 696e 7428 2752 6f6f 7420 6d65 616e 2073  int('Root mean s
+00005810: 7175 6172 6564 2065 7272 6f72 3a20 272c  quared error: ',
+00005820: 206d 6174 682e 6365 696c 2872 6d73 652a   math.ceil(rmse*
+00005830: 3130 3029 2f31 3030 290d 0a23 2020 2020  100)/100)..#    
+00005840: 2070 7269 6e74 2827 5232 2073 636f 7265   print('R2 score
+00005850: 3a20 272c 2072 3229 0d0a 2320 2020 2020  : ', r2)..#     
+00005860: 7072 696e 7428 2253 5444 3a20 222c 6d61  print("STD: ",ma
+00005870: 7468 2e63 6569 6c28 6e70 2e73 7464 2879  th.ceil(np.std(y
+00005880: 5f70 7265 6469 6374 6564 292a 3130 3029  _predicted)*100)
+00005890: 2f31 3030 2920 0d0a 2320 2020 2020 2320  /100) ..#     # 
+000058a0: 4372 6561 7465 2066 6967 7572 650d 0a23  Create figure..#
+000058b0: 2020 2020 2023 6669 6720 3d20 676f 2e46       #fig = go.F
+000058c0: 6967 7572 6528 290d 0a20 2020 200d 0a23  igure()..    ..#
+000058d0: 2020 2020 2066 6967 203d 2067 6f2e 4669       fig = go.Fi
+000058e0: 6775 7265 5769 6467 6574 2829 0d0a 2020  gureWidget()..  
+000058f0: 2020 0d0a 2320 2020 2020 706c 6f74 5f6e    ..#     plot_n
+00005900: 756d 6265 723d 2250 6c6f 7420 4e75 6d62  umber="Plot Numb
+00005910: 6572 3a22 2b73 7472 2870 6c6f 745f 6e75  er:"+str(plot_nu
+00005920: 6d62 6572 290d 0a0d 0a23 2020 2020 2066  mber)....#     f
+00005930: 6967 2e61 6464 5f74 7261 6365 2867 6f2e  ig.add_trace(go.
+00005940: 5363 6174 7465 7228 783d 6c69 7374 2864  Scatter(x=list(d
+00005950: 662e 696e 6465 7829 2c20 793d 6c69 7374  f.index), y=list
+00005960: 2864 662e 7661 6c29 2929 0d0a 2320 2020  (df.val)))..#   
+00005970: 2020 6669 6720 3d20 7078 2e73 6361 7474    fig = px.scatt
+00005980: 6572 2864 662c 2078 3d6c 6973 7428 6466  er(df, x=list(df
+00005990: 2e69 6e64 6578 292c 2079 3d6c 6973 7428  .index), y=list(
+000059a0: 6466 2e76 616c 292c 0d0a 2320 2020 2020  df.val),..#     
+000059b0: 2020 2020 2020 2020 2020 2020 636f 6c6f              colo
+000059c0: 723d 2276 616c 222c 2068 6f76 6572 5f6e  r="val", hover_n
+000059d0: 616d 653d 2276 616c 220d 0a23 2020 2020  ame="val"..#    
+000059e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000059f0: 202c 206c 6162 656c 733d 6469 6374 2878   , labels=dict(x
+00005a00: 3d22 4461 7465 7322 2c20 793d 226d 6d2f  ="Dates", y="mm/
+00005a10: 222b 5645 4c5f 5363 616c 6520 2c20 636f  "+VEL_Scale , co
+00005a20: 6c6f 723d 226d 6d2f 222b 5645 4c5f 5363  lor="mm/"+VEL_Sc
+00005a30: 616c 6529 290d 0a20 2020 200d 0a23 2020  ale))..    ..#  
+00005a40: 2020 2023 2066 6967 2e61 6464 5f74 7261     # fig.add_tra
+00005a50: 6365 280d 0a23 2020 2020 2023 2067 6f2e  ce(..#     # go.
+00005a60: 5363 6174 7465 7228 783d 6c69 7374 2864  Scatter(x=list(d
+00005a70: 662e 696e 6465 7829 2c20 793d 6c69 7374  f.index), y=list
+00005a80: 2876 616c 5f66 6974 292c 206d 6f64 6520  (val_fit), mode 
+00005a90: 3d20 226c 696e 6573 222c 6e61 6d65 3d22  = "lines",name="
+00005aa0: 7472 656e 646c 696e 6522 2c20 6d61 726b  trendline", mark
+00005ab0: 6572 5f63 6f6c 6f72 203d 2022 7265 6422  er_color = "red"
+00005ac0: 2929 0d0a 2020 2020 0d0a 2020 2020 0d0a  ))..    ..    ..
+00005ad0: 2020 2020 0d0a 2320 2020 2020 6669 672e      ..#     fig.
+00005ae0: 6164 645f 7472 6163 6528 676f 2e53 6361  add_trace(go.Sca
+00005af0: 7474 6572 2878 3d6c 6973 7428 6466 2e69  tter(x=list(df.i
+00005b00: 6e64 6578 292c 2079 3d6c 6973 7428 6466  ndex), y=list(df
+00005b10: 2e76 616c 292c 6d6f 6465 203d 2027 6c69  .val),mode = 'li
+00005b20: 6e65 7327 2c0d 0a23 2020 2020 2020 2020  nes',..#        
+00005b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005b40: 2020 2020 206e 616d 6520 3d20 2764 7261       name = 'dra
+00005b50: 7720 6c69 6e65 7327 2c20 6c69 6e65 203d  w lines', line =
+00005b60: 2064 6963 7428 7368 6170 6520 3d20 276c   dict(shape = 'l
+00005b70: 696e 6561 7227 2c20 636f 6c6f 7220 3d20  inear', color = 
+00005b80: 2772 6762 2830 2c20 302c 2030 2927 2c20  'rgb(0, 0, 0)', 
+00005b90: 6461 7368 203d 2027 6461 7368 2729 2c20  dash = 'dash'), 
+00005ba0: 636f 6e6e 6563 7467 6170 7320 3d20 5472  connectgaps = Tr
+00005bb0: 7565 2929 0d0a 2020 2020 0d0a 2320 2020  ue))..    ..#   
+00005bc0: 2020 6669 672e 6164 645f 7472 6163 6528    fig.add_trace(
+00005bd0: 0d0a 2320 2020 2020 2020 2020 676f 2e53  ..#         go.S
+00005be0: 6361 7474 6572 2878 3d6c 6973 7428 6466  catter(x=list(df
+00005bf0: 2e69 6e64 6578 292c 2079 3d6c 6973 7428  .index), y=list(
+00005c00: 795f 7072 6564 6963 7465 6429 2c20 6d6f  y_predicted), mo
+00005c10: 6465 203d 2022 6c69 6e65 7322 2c6e 616d  de = "lines",nam
+00005c20: 653d 2274 7265 6e64 6c69 6e65 222c 206d  e="trendline", m
+00005c30: 6172 6b65 725f 636f 6c6f 7220 3d20 2262  arker_color = "b
+00005c40: 6c61 636b 222c 206c 696e 655f 636f 6c6f  lack", line_colo
+00005c50: 723d 2772 6564 2729 290d 0a20 2020 200d  r='red'))..    .
+00005c60: 0a20 2020 200d 0a0d 0a23 2020 2020 2023  .    ....#     #
+00005c70: 2041 6464 2072 616e 6765 2073 6c69 6465   Add range slide
+00005c80: 720d 0a23 2020 2020 2066 6967 2e75 7064  r..#     fig.upd
+00005c90: 6174 655f 6c61 796f 7574 280d 0a23 2020  ate_layout(..#  
+00005ca0: 2020 2020 2020 2078 6178 6973 3d64 6963         xaxis=dic
+00005cb0: 7428 0d0a 2320 2020 2020 2020 2020 2020  t(..#           
+00005cc0: 2020 7261 6e67 6573 656c 6563 746f 723d    rangeselector=
+00005cd0: 6469 6374 280d 0a23 2020 2020 2020 2020  dict(..#        
+00005ce0: 2020 2020 2020 2020 2062 7574 746f 6e73           buttons
+00005cf0: 3d6c 6973 7428 5b0d 0a23 2020 2020 2020  =list([..#      
+00005d00: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00005d10: 6963 7428 636f 756e 743d 312c 0d0a 2320  ict(count=1,..# 
+00005d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005d30: 2020 2020 2020 2020 6c61 6265 6c3d 2231          label="1
+00005d40: 6d22 2c0d 0a23 2020 2020 2020 2020 2020  m",..#          
+00005d50: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00005d60: 7465 703d 226d 6f6e 7468 222c 0d0a 2320  tep="month",..# 
+00005d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005d80: 2020 2020 2020 2020 7374 6570 6d6f 6465          stepmode
+00005d90: 3d22 6261 636b 7761 7264 2229 2c0d 0a23  ="backward"),..#
+00005da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005db0: 2020 2020 2064 6963 7428 636f 756e 743d       dict(count=
+00005dc0: 362c 0d0a 2320 2020 2020 2020 2020 2020  6,..#           
+00005dd0: 2020 2020 2020 2020 2020 2020 2020 6c61                la
+00005de0: 6265 6c3d 2236 6d22 2c0d 0a23 2020 2020  bel="6m",..#    
+00005df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005e00: 2020 2020 2073 7465 703d 226d 6f6e 7468       step="month
+00005e10: 222c 0d0a 2320 2020 2020 2020 2020 2020  ",..#           
+00005e20: 2020 2020 2020 2020 2020 2020 2020 7374                st
+00005e30: 6570 6d6f 6465 3d22 6261 636b 7761 7264  epmode="backward
+00005e40: 2229 2c0d 0a23 2020 2020 2020 2020 2020  "),..#          
+00005e50: 2020 2020 2020 2020 2020 2064 6963 7428             dict(
+00005e60: 636f 756e 743d 312c 0d0a 2320 2020 2020  count=1,..#     
+00005e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005e80: 2020 2020 6c61 6265 6c3d 2259 5444 222c      label="YTD",
+00005e90: 0d0a 2320 2020 2020 2020 2020 2020 2020  ..#             
+00005ea0: 2020 2020 2020 2020 2020 2020 7374 6570              step
+00005eb0: 3d22 7965 6172 222c 0d0a 2320 2020 2020  ="year",..#     
+00005ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005ed0: 2020 2020 7374 6570 6d6f 6465 3d22 746f      stepmode="to
+00005ee0: 6461 7465 2229 2c0d 0a23 2020 2020 2020  date"),..#      
+00005ef0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00005f00: 6963 7428 636f 756e 743d 312c 0d0a 2320  ict(count=1,..# 
+00005f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005f20: 2020 2020 2020 2020 6c61 6265 6c3d 2231          label="1
+00005f30: 7922 2c0d 0a23 2020 2020 2020 2020 2020  y",..#          
+00005f40: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00005f50: 7465 703d 2279 6561 7222 2c0d 0a23 2020  tep="year",..#  
+00005f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005f70: 2020 2020 2020 2073 7465 706d 6f64 653d         stepmode=
+00005f80: 2262 6163 6b77 6172 6422 292c 0d0a 2320  "backward"),..# 
+00005f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005fa0: 2020 2020 6469 6374 2873 7465 703d 2261      dict(step="a
+00005fb0: 6c6c 2229 0d0a 2320 2020 2020 2020 2020  ll")..#         
+00005fc0: 2020 2020 2020 2020 5d29 0d0a 2320 2020          ])..#   
+00005fd0: 2020 2020 2020 2020 2020 292c 0d0a 2320            ),..# 
+00005fe0: 2020 2020 2020 2020 2020 2020 7261 6e67              rang
+00005ff0: 6573 6c69 6465 723d 6469 6374 280d 0a23  eslider=dict(..#
+00006000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006010: 2076 6973 6962 6c65 3d54 7275 650d 0a23   visible=True..#
+00006020: 2020 2020 2020 2020 2020 2020 2029 2c0d               ),.
+00006030: 0a23 2020 2020 2020 2020 2020 2020 2074  .#             t
+00006040: 7970 653d 2264 6174 6522 0d0a 2320 2020  ype="date"..#   
+00006050: 2020 2020 2020 2920 0d0a 2320 2020 2020        ) ..#     
+00006060: 290d 0a23 2020 2020 2066 6967 2e75 7064  )..#     fig.upd
+00006070: 6174 655f 7861 7865 7328 7261 6e67 6573  ate_xaxes(ranges
+00006080: 6c69 6465 725f 7468 6963 6b6e 6573 7320  lider_thickness 
+00006090: 3d20 302e 3035 290d 0a23 2020 2020 2023  = 0.05)..#     #
+000060a0: 6669 672e 7570 6461 7465 5f6c 6179 6f75  fig.update_layou
+000060b0: 7428 7368 6f77 6c65 6765 6e64 3d54 7275  t(showlegend=Tru
+000060c0: 6529 0d0a 0d0a 2320 2020 2020 2366 6967  e)....#     #fig
+000060d0: 2e64 6174 615b 305d 2e75 7064 6174 6528  .data[0].update(
+000060e0: 6c69 6e65 5f63 6f6c 6f72 3d27 626c 6163  line_color='blac
+000060f0: 6b27 290d 0a23 2020 2020 2074 743d 2022  k')..#     tt= "
+00006100: 4465 666f 2d52 6174 653a 222b 7374 7228  Defo-Rate:"+str(
+00006110: 726f 756e 6428 7261 7465 5f63 6861 6e67  round(rate_chang
+00006120: 652c 3229 292b 223a 222b 2022 4465 666f  e,2))+":"+ "Defo
+00006130: 2d52 6174 652d 5354 443a 222b 7374 7228  -Rate-STD:"+str(
+00006140: 726f 756e 6428 6e70 2e73 7464 2879 5f70  round(np.std(y_p
+00006150: 7265 6469 6374 6564 292c 2032 2929 2b20  redicted), 2))+ 
+00006160: 223a 2220 2b70 6c6f 745f 6e75 6d62 6572  ":" +plot_number
+00006170: 0d0a 2020 2020 0d0a 2320 2020 2020 2320  ..    ..#     # 
+00006180: 6d61 6b65 2073 7061 6365 2066 6f72 2065  make space for e
+00006190: 7870 6c61 6e61 7469 6f6e 202f 2061 6e6e  xplanation / ann
+000061a0: 6f74 6174 696f 6e0d 0a23 2020 2020 2066  otation..#     f
+000061b0: 6967 2e75 7064 6174 655f 6c61 796f 7574  ig.update_layout
+000061c0: 286d 6172 6769 6e3d 6469 6374 286c 3d32  (margin=dict(l=2
+000061d0: 302c 2072 3d32 302c 2074 3d32 302c 2062  0, r=20, t=20, b
+000061e0: 3d36 3029 2c70 6170 6572 5f62 6763 6f6c  =60),paper_bgcol
+000061f0: 6f72 3d22 4c69 6768 7453 7465 656c 426c  or="LightSteelBl
+00006200: 7565 2229 0d0a 0d0a 2020 2020 0d0a 2320  ue")....    ..# 
+00006210: 2020 2020 6669 672e 7570 6461 7465 5f6c      fig.update_l
+00006220: 6179 6f75 7428 0d0a 2020 2020 2020 2020  ayout(..        
+00006230: 0d0a 2320 2020 2020 7469 746c 655f 7465  ..#     title_te
+00006240: 7874 3d74 742c 2074 6974 6c65 5f66 6f6e  xt=tt, title_fon
+00006250: 745f 6661 6d69 6c79 3d22 5369 746b 6120  t_family="Sitka 
+00006260: 536d 616c 6c22 2c0d 0a23 2020 2020 2074  Small",..#     t
+00006270: 6974 6c65 5f66 6f6e 745f 636f 6c6f 723d  itle_font_color=
+00006280: 2272 6564 222c 2074 6974 6c65 5f78 3d30  "red", title_x=0
+00006290: 2e35 202c 206c 6567 656e 645f 7469 746c  .5 , legend_titl
+000062a0: 653d 224c 6567 656e 6422 2c0d 0a23 2020  e="Legend",..#  
+000062b0: 2020 2066 6f6e 743d 6469 6374 280d 0a23     font=dict(..#
+000062c0: 2020 2020 2020 2020 2066 616d 696c 793d           family=
+000062d0: 2243 6f75 7269 6572 204e 6577 2c20 6d6f  "Courier New, mo
+000062e0: 6e6f 7370 6163 6522 2c0d 0a23 2020 2020  nospace",..#    
+000062f0: 2020 2020 2073 697a 653d 3135 2c0d 0a23       size=15,..#
+00006300: 2020 2020 2020 2020 2063 6f6c 6f72 3d22           color="
+00006310: 5265 6265 6363 6150 7572 706c 6522 2029  RebeccaPurple" )
+00006320: 290d 0a20 2020 200d 0a23 2020 2020 2066  )..    ..#     f
+00006330: 6967 2e75 7064 6174 655f 6c61 796f 7574  ig.update_layout
+00006340: 286c 6567 656e 643d 6469 6374 280d 0a23  (legend=dict(..#
+00006350: 2020 2020 2079 616e 6368 6f72 3d22 746f       yanchor="to
+00006360: 7022 2c0d 0a23 2020 2020 2079 3d2d 302c  p",..#     y=-0,
+00006370: 0d0a 2320 2020 2020 7861 6e63 686f 723d  ..#     xanchor=
+00006380: 226c 6566 7422 2c0d 0a23 2020 2020 2078  "left",..#     x
+00006390: 3d31 2e30 310d 0a23 2029 290d 0a0d 0a23  =1.01..# ))....#
+000063a0: 2020 2020 2023 2066 6967 2e75 7064 6174       # fig.updat
+000063b0: 655f 6c61 796f 7574 280d 0a23 2020 2020  e_layout(..#    
+000063c0: 2023 2075 7064 6174 656d 656e 7573 3d5b   # updatemenus=[
+000063d0: 0d0a 2320 2020 2020 2320 2020 2020 6469  ..#     #     di
+000063e0: 6374 280d 0a23 2020 2020 2023 2020 2020  ct(..#     #    
+000063f0: 2020 2020 2074 7970 653d 2262 7574 746f       type="butto
+00006400: 6e73 222c 0d0a 2320 2020 2020 2320 2020  ns",..#     #   
+00006410: 2020 2020 2020 6469 7265 6374 696f 6e3d        direction=
+00006420: 2272 6967 6874 222c 0d0a 2320 2020 2020  "right",..#     
+00006430: 2320 2020 2020 2020 2020 6163 7469 7665  #         active
+00006440: 3d30 2c0d 0a23 2020 2020 2023 2020 2020  =0,..#     #    
+00006450: 2020 2020 2078 3d30 2e35 372c 0d0a 2320       x=0.57,..# 
+00006460: 2020 2020 2320 2020 2020 2020 2020 793d      #         y=
+00006470: 312e 322c 0d0a 2320 2020 2020 2320 2020  1.2,..#     #   
+00006480: 2020 2020 2020 6275 7474 6f6e 733d 6c69        buttons=li
+00006490: 7374 285b 0d0a 2320 2020 2020 2320 2020  st([..#     #   
+000064a0: 2020 2020 2020 2020 2020 6469 6374 280d            dict(.
+000064b0: 0a23 2020 2020 2023 2020 2020 2020 2020  .#     #        
+000064c0: 2020 2020 2020 2020 2061 7267 733d 5b22           args=["
+000064d0: 636f 6c6f 7273 6361 6c65 222c 2022 5669  colorscale", "Vi
+000064e0: 7269 6469 7322 5d2c 0d0a 2320 2020 2020  ridis"],..#     
+000064f0: 2320 2020 2020 2020 2020 2020 2020 2020  #               
+00006500: 2020 6c61 6265 6c3d 2256 6972 6964 6973    label="Viridis
+00006510: 222c 0d0a 2320 2020 2020 2320 2020 2020  ",..#     #     
+00006520: 2020 2020 2020 2020 2020 2020 6d65 7468              meth
+00006530: 6f64 3d22 7265 7374 796c 6522 0d0a 2320  od="restyle"..# 
+00006540: 2020 2020 2320 2020 2020 2020 2020 2020      #           
+00006550: 2020 292c 0d0a 2320 2020 2020 2320 2020    ),..#     #   
+00006560: 2020 2020 2020 2020 2020 6469 6374 280d            dict(.
+00006570: 0a23 2020 2020 2023 2020 2020 2020 2020  .#     #        
+00006580: 2020 2020 2020 2020 2061 7267 733d 5b22           args=["
+00006590: 636f 6c6f 7273 6361 6c65 222c 2022 7475  colorscale", "tu
+000065a0: 7262 6f22 5d2c 0d0a 2320 2020 2020 2320  rbo"],..#     # 
+000065b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000065c0: 6c61 6265 6c3d 2274 7572 626f 222c 0d0a  label="turbo",..
+000065d0: 2320 2020 2020 2320 2020 2020 2020 2020  #     #         
+000065e0: 2020 2020 2020 2020 6d65 7468 6f64 3d22          method="
+000065f0: 7265 7374 796c 6522 0d0a 2320 2020 2020  restyle"..#     
+00006600: 2320 2020 2020 2020 2020 2020 2020 290d  #             ).
+00006610: 0a23 2020 2020 2023 2020 2020 2020 2020  .#     #        
+00006620: 205d 292c 0d0a 2320 2020 2020 2320 2020   ]),..#     #   
+00006630: 2020 290d 0a23 2020 2020 2023 205d 290d    )..#     # ]).
+00006640: 0a0d 0a20 2020 200d 0a23 2020 2020 2066  ...    ..#     f
+00006650: 6967 2e75 7064 6174 655f 7861 7865 7328  ig.update_xaxes(
+00006660: 7368 6f77 7370 696b 6573 3d54 7275 652c  showspikes=True,
+00006670: 2073 7069 6b65 6d6f 6465 3d27 746f 6178   spikemode='toax
+00006680: 6973 2720 2c20 7370 696b 6573 6e61 703d  is' , spikesnap=
+00006690: 2763 7572 736f 7227 2c20 7370 696b 6564  'cursor', spiked
+000066a0: 6173 683d 2764 6f74 272c 2073 7069 6b65  ash='dot', spike
+000066b0: 636f 6c6f 723d 2762 6c75 6527 2c20 7363  color='blue', sc
+000066c0: 616c 6561 6e63 686f 723d 2779 272c 2074  aleanchor='y', t
+000066d0: 6974 6c65 5f66 6f6e 745f 6661 6d69 6c79  itle_font_family
+000066e0: 3d22 4172 6961 6c22 2c20 0d0a 2320 2020  ="Arial", ..#   
+000066f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006700: 2020 7469 746c 655f 666f 6e74 3d64 6963    title_font=dic
+00006710: 7428 7369 7a65 3d31 3529 290d 0a23 2020  t(size=15))..#  
+00006720: 2020 2066 6967 2e75 7064 6174 655f 7961     fig.update_ya
+00006730: 7865 7328 7368 6f77 7370 696b 6573 3d54  xes(showspikes=T
+00006740: 7275 652c 2073 7069 6b65 6d6f 6465 3d27  rue, spikemode='
+00006750: 746f 6178 6973 2720 2c20 7370 696b 6573  toaxis' , spikes
+00006760: 6e61 703d 2763 7572 736f 7227 2c20 7370  nap='cursor', sp
+00006770: 696b 6564 6173 683d 2764 6f74 272c 2073  ikedash='dot', s
+00006780: 7069 6b65 636f 6c6f 723d 2762 6c75 6527  pikecolor='blue'
+00006790: 2c20 7363 616c 6561 6e63 686f 723d 2778  , scaleanchor='x
+000067a0: 272c 2074 6974 6c65 5f66 6f6e 745f 6661  ', title_font_fa
+000067b0: 6d69 6c79 3d22 4172 6961 6c22 2c0d 0a23  mily="Arial",..#
+000067c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000067d0: 2020 2020 2074 6974 6c65 5f66 6f6e 743d       title_font=
+000067e0: 6469 6374 2873 697a 653d 3135 2929 0d0a  dict(size=15))..
+000067f0: 0d0a 2020 2020 0d0a 2020 2020 0d0a 2320  ..    ..    ..# 
+00006800: 2020 2020 6966 2073 6176 655f 706c 6f74      if save_plot
+00006810: 3d3d 5472 7565 3a0d 0a20 2020 200d 0a23  ==True:..    ..#
+00006820: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+00006830: 6f73 2e70 6174 682e 6578 6973 7473 286f  os.path.exists(o
+00006840: 7574 7075 745f 6469 7229 3a0d 0a23 2020  utput_dir):..#  
+00006850: 2020 2020 2020 2020 2020 206f 732e 6d6b             os.mk
+00006860: 6469 7228 6f75 7470 7574 5f64 6972 290d  dir(output_dir).
+00006870: 0a0d 0a23 2020 2020 2020 2020 2066 6967  ...#         fig
+00006880: 2e77 7269 7465 5f68 746d 6c28 6f75 7470  .write_html(outp
+00006890: 7574 5f64 6972 202b 2022 2f22 202b 2070  ut_dir + "/" + p
+000068a0: 6c6f 745f 6669 6c65 6e61 6d65 202b 2022  lot_filename + "
+000068b0: 2e68 746d 6c22 2029 0d0a 2320 2020 2020  .html" )..#     
+000068c0: 2020 2020 6669 672e 7772 6974 655f 696d      fig.write_im
+000068d0: 6167 6528 6f75 7470 7574 5f64 6972 202b  age(output_dir +
+000068e0: 2022 2f22 202b 2070 6c6f 745f 6669 6c65   "/" + plot_file
+000068f0: 6e61 6d65 202b 2022 2e6a 7065 6722 2c20  name + ".jpeg", 
+00006900: 7363 616c 653d 312c 2077 6964 7468 3d31  scale=1, width=1
+00006910: 3038 302c 2068 6569 6768 743d 3330 3020  080, height=300 
+00006920: 290d 0a20 2020 2020 2020 200d 0a20 2020  )..        ..   
+00006930: 200d 0a23 2020 2020 2064 6566 207a 6f6f   ..#     def zoo
+00006940: 6d28 6c61 796f 7574 2c20 7872 616e 6765  m(layout, xrange
+00006950: 293a 0d0a 2320 2020 2020 2020 2020 696e  ):..#         in
+00006960: 5f76 6965 7720 3d20 6466 2e6c 6f63 5b66  _view = df.loc[f
+00006970: 6967 2e6c 6179 6f75 742e 7861 7869 732e  ig.layout.xaxis.
+00006980: 7261 6e67 655b 305d 3a66 6967 2e6c 6179  range[0]:fig.lay
+00006990: 6f75 742e 7861 7869 732e 7261 6e67 655b  out.xaxis.range[
+000069a0: 315d 5d0d 0a23 2020 2020 2020 2020 2066  1]]..#         f
+000069b0: 6967 2e6c 6179 6f75 742e 7961 7869 732e  ig.layout.yaxis.
+000069c0: 7261 6e67 6520 3d20 5b69 6e5f 7669 6577  range = [in_view
+000069d0: 2e48 6967 682e 6d69 6e28 2920 2d20 3130  .High.min() - 10
+000069e0: 2c20 696e 5f76 6965 772e 4869 6768 2e6d  , in_view.High.m
+000069f0: 6178 2829 202b 2031 305d 0d0a 0d0a 2320  ax() + 10]....# 
+00006a00: 2020 2020 6669 672e 6c61 796f 7574 2e6f      fig.layout.o
+00006a10: 6e5f 6368 616e 6765 287a 6f6f 6d2c 2027  n_change(zoom, '
+00006a20: 7861 7869 732e 7261 6e67 6527 290d 0a20  xaxis.range').. 
+00006a30: 2020 200d 0a23 2020 2020 2066 6967 2e73     ..#     fig.s
+00006a40: 686f 7728 290d 0a20 2020 200d 0a20 2020  how()..    ..   
+00006a50: 200d 0a0d 0a0d 0a0d 0a0d 0a20 2020 200d   ..........    .
+00006a60: 0a23 2020 2020 2073 7461 7274 3d69 6e74  .#     start=int
+00006a70: 2873 7461 7274 2e74 696d 6573 7461 6d70  (start.timestamp
+00006a80: 2829 202a 2031 3030 3029 0d0a 2320 2020  () * 1000)..#   
+00006a90: 2020 656e 643d 696e 7428 656e 642e 7469    end=int(end.ti
+00006aa0: 6d65 7374 616d 7028 2920 2a20 3130 3030  mestamp() * 1000
+00006ab0: 290d 0a0d 0a23 2020 2020 2023 6466 3d70  )....#     #df=p
+00006ac0: 642e 7265 6164 5f63 7376 2827 7465 6d70  d.read_csv('temp
+00006ad0: 322e 6373 7627 290d 0a20 2020 200d 0a23  2.csv')..    ..#
+00006ae0: 2020 2020 2064 662e 7265 6e61 6d65 2863       df.rename(c
+00006af0: 6f6c 756d 6e73 3d7b 2064 662e 636f 6c75  olumns={ df.colu
+00006b00: 6d6e 735b 305d 3a20 2264 6422 207d 2c20  mns[0]: "dd" }, 
+00006b10: 696e 706c 6163 6520 3d20 5472 7565 290d  inplace = True).
+00006b20: 0a23 2020 2020 2064 665b 2764 645f 7374  .#     df['dd_st
+00006b30: 7227 5d3d 6466 5b27 6464 275d 2e61 7374  r']=df['dd'].ast
+00006b40: 7970 6528 7374 7229 0d0a 2320 2020 2020  ype(str)..#     
+00006b50: 6466 5b27 6464 5f73 7472 275d 203d 2064  df['dd_str'] = d
+00006b60: 665b 2764 645f 7374 7227 5d2e 6173 7479  f['dd_str'].asty
+00006b70: 7065 2873 7472 290d 0a23 2020 2020 2064  pe(str)..#     d
+00006b80: 662e 7265 6e61 6d65 2863 6f6c 756d 6e73  f.rename(columns
+00006b90: 3d7b 2064 662e 636f 6c75 6d6e 735b 315d  ={ df.columns[1]
+00006ba0: 3a20 2276 616c 2220 7d2c 2069 6e70 6c61  : "val" }, inpla
+00006bb0: 6365 203d 2054 7275 6529 0d0a 2320 2020  ce = True)..#   
+00006bc0: 2020 6466 5b27 6464 275d 3d20 7064 2e74    df['dd']= pd.t
+00006bd0: 6f5f 6461 7465 7469 6d65 2864 665b 2764  o_datetime(df['d
+00006be0: 6427 5d2e 6173 7479 7065 2873 7472 292c  d'].astype(str),
+00006bf0: 2066 6f72 6d61 743d 2725 592d 256d 2d25   format='%Y-%m-%
+00006c00: 6427 290d 0a23 2020 2020 2064 662e 696e  d')..#     df.in
+00006c10: 7365 7274 2864 662e 7368 6170 655b 315d  sert(df.shape[1]
+00006c20: 2c0d 0a23 2020 2020 2020 2020 2020 2020  ,..#            
+00006c30: 2027 726f 775f 636f 756e 7427 2c0d 0a23   'row_count',..#
+00006c40: 2020 2020 2020 2020 2020 2020 2064 662e               df.
+00006c50: 696e 6465 782e 7661 6c75 655f 636f 756e  index.value_coun
+00006c60: 7473 2829 2e73 6f72 745f 696e 6465 7828  ts().sort_index(
+00006c70: 292e 6375 6d73 756d 2829 290d 0a23 2020  ).cumsum())..#  
+00006c80: 2020 2023 6466 3d64 662e 7365 745f 696e     #df=df.set_in
+00006c90: 6465 7828 2764 6427 290d 0a23 2020 2020  dex('dd')..#    
+00006ca0: 2023 6466 2e69 6e64 6578 203d 2070 642e   #df.index = pd.
+00006cb0: 4461 7465 7469 6d65 496e 6465 7828 6466  DatetimeIndex(df
+00006cc0: 2e69 6e64 6578 290d 0a23 2020 2020 2064  .index)..#     d
+00006cd0: 662e 6464 5f73 7472 203d 2070 642e 4461  f.dd_str = pd.Da
+00006ce0: 7465 7469 6d65 496e 6465 7828 6466 2e64  tetimeIndex(df.d
+00006cf0: 645f 7374 7229 0d0a 2320 2020 2020 6466  d_str)..#     df
+00006d00: 5b27 6464 5f69 6e74 275d 203d 205b 696e  ['dd_int'] = [in
+00006d10: 7428 692e 7469 6d65 7374 616d 7028 292a  t(i.timestamp()*
+00006d20: 3130 3030 2920 666f 7220 6920 696e 2064  1000) for i in d
+00006d30: 662e 6464 5f73 7472 5d0d 0a23 2020 2020  f.dd_str]..#    
+00006d40: 2069 6d70 6f72 7420 6e75 6d70 7920 6173   import numpy as
+00006d50: 206e 7020 0d0a 2320 2020 2020 6465 6620   np ..#     def 
+00006d60: 6669 6e64 5f6e 6561 7265 7374 2861 7272  find_nearest(arr
+00006d70: 6179 2c20 7661 6c75 6529 3a0d 0a23 2020  ay, value):..#  
+00006d80: 2020 2020 2020 2061 7272 6179 203d 206e         array = n
+00006d90: 702e 6173 6172 7261 7928 6172 7261 7929  p.asarray(array)
+00006da0: 0d0a 2320 2020 2020 2020 2020 6964 7820  ..#         idx 
+00006db0: 3d20 286e 702e 6162 7328 6172 7261 7920  = (np.abs(array 
+00006dc0: 2d20 7661 6c75 6529 292e 6172 676d 696e  - value)).argmin
+00006dd0: 2829 0d0a 2320 2020 2020 2020 2020 7265  ()..#         re
+00006de0: 7475 726e 2061 7272 6179 5b69 6478 5d0d  turn array[idx].
+00006df0: 0a23 2020 2020 2073 3d66 696e 645f 6e65  .#     s=find_ne
+00006e00: 6172 6573 7428 6e70 2e61 7272 6179 2864  arest(np.array(d
+00006e10: 662e 6464 5f69 6e74 292c 2073 7461 7274  f.dd_int), start
+00006e20: 290d 0a23 2020 2020 2065 3d66 696e 645f  )..#     e=find_
+00006e30: 6e65 6172 6573 7428 6e70 2e61 7272 6179  nearest(np.array
+00006e40: 2864 662e 6464 5f69 6e74 292c 2065 6e64  (df.dd_int), end
+00006e50: 290d 0a0d 0a23 2020 2020 2073 3d28 6466  )....#     s=(df
+00006e60: 5b64 665b 2764 645f 696e 7427 5d3d 3d73  [df['dd_int']==s
+00006e70: 5d2e 696e 6465 7829 0d0a 2320 2020 2020  ].index)..#     
+00006e80: 653d 2864 665b 6466 5b27 6464 5f69 6e74  e=(df[df['dd_int
+00006e90: 275d 3d3d 655d 2e69 6e64 6578 290d 0a0d  ']==e].index)...
+00006ea0: 0a23 2020 2020 2064 665f 6669 6c74 6572  .#     df_filter
+00006eb0: 3d64 665b 735b 305d 3a65 5b30 5d5d 0d0a  =df[s[0]:e[0]]..
+00006ec0: 2320 2020 2020 7072 696e 7428 6466 5f66  #     print(df_f
+00006ed0: 696c 7465 7229 0d0a 0d0a 2320 2020 2020  ilter)....#     
+00006ee0: 6466 3d64 665f 6669 6c74 6572 2020 0d0a  df=df_filter  ..
+00006ef0: 2020 2020 0d0a 2320 696d 706f 7274 2070      ..# import p
+00006f00: 616e 6461 7320 6173 2070 640d 0a23 2069  andas as pd..# i
+00006f10: 6d70 6f72 7420 6970 7977 6964 6765 7473  mport ipywidgets
+00006f20: 2061 7320 7769 6467 6574 730d 0a23 2066   as widgets..# f
+00006f30: 726f 6d20 4950 7974 686f 6e2e 6469 7370  rom IPython.disp
+00006f40: 6c61 7920 696d 706f 7274 2064 6973 706c  lay import displ
+00006f50: 6179 0d0a 0d0a 2320 636c 6173 7320 4461  ay....# class Da
+00006f60: 7465 5261 6e67 6550 6963 6b65 7228 6f62  teRangePicker(ob
+00006f70: 6a65 6374 293a 0d0a 2320 2020 2020 6465  ject):..#     de
+00006f80: 6620 5f5f 696e 6974 5f5f 2873 656c 662c  f __init__(self,
+00006f90: 7374 6172 742c 656e 642c 6672 6571 3d27  start,end,freq='
+00006fa0: 4427 2c66 6d74 3d27 2559 2d25 6d2d 2564  D',fmt='%Y-%m-%d
+00006fb0: 2729 3a0d 0a23 2020 2020 2020 2020 2022  '):..#         "
+00006fc0: 2222 0d0a 2320 2020 2020 2020 2020 5061  ""..#         Pa
+00006fd0: 7261 6d65 7465 7273 0d0a 2320 2020 2020  rameters..#     
+00006fe0: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0d0a      ----------..
+00006ff0: 2320 2020 2020 2020 2020 7374 6172 7420  #         start 
+00007000: 3a20 7374 7269 6e67 206f 7220 6461 7465  : string or date
+00007010: 7469 6d65 2d6c 696b 650d 0a23 2020 2020  time-like..#    
+00007020: 2020 2020 2020 2020 204c 6566 7420 626f           Left bo
+00007030: 756e 6420 6f66 2074 6865 2070 6572 696f  und of the perio
+00007040: 640d 0a23 2020 2020 2020 2020 2065 6e64  d..#         end
+00007050: 203a 2073 7472 696e 6720 6f72 2064 6174   : string or dat
+00007060: 6574 696d 652d 6c69 6b65 0d0a 2320 2020  etime-like..#   
+00007070: 2020 2020 2020 2020 2020 4c65 6674 2062            Left b
+00007080: 6f75 6e64 206f 6620 7468 6520 7065 7269  ound of the peri
+00007090: 6f64 0d0a 2320 2020 2020 2020 2020 6672  od..#         fr
+000070a0: 6571 203a 2073 7472 696e 6720 6f72 2070  eq : string or p
+000070b0: 616e 6461 732e 4461 7465 4f66 6673 6574  andas.DateOffset
+000070c0: 2c20 6465 6661 756c 743d 2744 270d 0a23  , default='D'..#
+000070d0: 2020 2020 2020 2020 2020 2020 2046 7265               Fre
+000070e0: 7175 656e 6379 2073 7472 696e 6773 2063  quency strings c
+000070f0: 616e 2068 6176 6520 6d75 6c74 6970 6c65  an have multiple
+00007100: 732c 2065 2e67 2e20 2735 4827 200d 0a23  s, e.g. '5H' ..#
+00007110: 2020 2020 2020 2020 2066 6d74 203a 2073           fmt : s
+00007120: 7472 696e 672c 2064 6566 6175 6c79 203d  tring, defauly =
+00007130: 2027 2559 2d25 6d2d 2564 270d 0a23 2020   '%Y-%m-%d'..#  
+00007140: 2020 2020 2020 2020 2020 2046 6f72 6d61             Forma
+00007150: 7420 746f 2075 7365 2074 6f20 6469 7370  t to use to disp
+00007160: 6c61 7920 7468 6520 7365 6c65 6374 6564  lay the selected
+00007170: 2070 6572 696f 640d 0a0d 0a23 2020 2020   period....#    
+00007180: 2020 2020 2022 2222 0d0a 2320 2020 2020       """..#     
+00007190: 2020 2020 7365 6c66 2e64 6174 655f 7261      self.date_ra
+000071a0: 6e67 653d 7064 2e64 6174 655f 7261 6e67  nge=pd.date_rang
+000071b0: 6528 7374 6172 743d 7374 6172 742c 656e  e(start=start,en
+000071c0: 643d 656e 642c 6672 6571 3d66 7265 7129  d=end,freq=freq)
+000071d0: 0d0a 2320 2020 2020 2020 2020 6f70 7469  ..#         opti
+000071e0: 6f6e 7320 3d20 5b28 6974 656d 2e73 7472  ons = [(item.str
+000071f0: 6674 696d 6528 666d 7429 2c69 7465 6d29  ftime(fmt),item)
+00007200: 2066 6f72 2069 7465 6d20 696e 2073 656c   for item in sel
+00007210: 662e 6461 7465 5f72 616e 6765 5d0d 0a23  f.date_range]..#
+00007220: 2020 2020 2020 2020 2073 656c 662e 736c           self.sl
+00007230: 6964 6572 5f73 7461 7274 203d 2077 6964  ider_start = wid
+00007240: 6765 7473 2e53 656c 6563 7469 6f6e 536c  gets.SelectionSl
+00007250: 6964 6572 280d 0a23 2020 2020 2020 2020  ider(..#        
+00007260: 2020 2020 2064 6573 6372 6970 7469 6f6e       description
+00007270: 3d27 7374 6172 7427 2c0d 0a23 2020 2020  ='start',..#    
+00007280: 2020 2020 2020 2020 206f 7074 696f 6e73           options
+00007290: 3d6f 7074 696f 6e73 2c0d 0a23 2020 2020  =options,..#    
+000072a0: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
+000072b0: 6f75 735f 7570 6461 7465 3d46 616c 7365  ous_update=False
+000072c0: 0d0a 2320 2020 2020 2020 2020 290d 0a23  ..#         )..#
+000072d0: 2020 2020 2020 2020 2073 656c 662e 736c           self.sl
+000072e0: 6964 6572 5f65 6e64 203d 2077 6964 6765  ider_end = widge
+000072f0: 7473 2e53 656c 6563 7469 6f6e 536c 6964  ts.SelectionSlid
+00007300: 6572 280d 0a23 2020 2020 2020 2020 2020  er(..#          
+00007310: 2020 2064 6573 6372 6970 7469 6f6e 3d27     description='
+00007320: 656e 6427 2c0d 0a23 2020 2020 2020 2020  end',..#        
+00007330: 2020 2020 206f 7074 696f 6e73 3d6f 7074       options=opt
+00007340: 696f 6e73 2c0d 0a23 2020 2020 2020 2020  ions,..#        
+00007350: 2020 2020 2063 6f6e 7469 6e75 6f75 735f       continuous_
+00007360: 7570 6461 7465 3d46 616c 7365 2c0d 0a23  update=False,..#
+00007370: 2020 2020 2020 2020 2020 2020 2076 616c               val
+00007380: 7565 3d6f 7074 696f 6e73 5b2d 315d 5b31  ue=options[-1][1
+00007390: 5d0d 0a23 2020 2020 2020 2020 2029 0d0a  ]..#         )..
+000073a0: 0d0a 2320 2020 2020 2020 2020 7365 6c66  ..#         self
+000073b0: 2e73 6c69 6465 725f 7374 6172 742e 6f6e  .slider_start.on
+000073c0: 5f74 7261 6974 5f63 6861 6e67 6528 7365  _trait_change(se
+000073d0: 6c66 2e73 6c69 6465 725f 7374 6172 745f  lf.slider_start_
+000073e0: 6368 616e 6765 642c 2027 7661 6c75 6527  changed, 'value'
+000073f0: 290d 0a23 2020 2020 2020 2020 2073 656c  )..#         sel
+00007400: 662e 736c 6964 6572 5f65 6e64 2e6f 6e5f  f.slider_end.on_
+00007410: 7472 6169 745f 6368 616e 6765 2873 656c  trait_change(sel
+00007420: 662e 736c 6964 6572 5f65 6e64 5f63 6861  f.slider_end_cha
+00007430: 6e67 6564 2c20 2776 616c 7565 2729 0d0a  nged, 'value')..
+00007440: 0d0a 2320 2020 2020 2020 2020 7365 6c66  ..#         self
+00007450: 2e77 6964 6765 7420 3d20 7769 6467 6574  .widget = widget
+00007460: 732e 426f 7828 6368 696c 6472 656e 3d5b  s.Box(children=[
+00007470: 7365 6c66 2e73 6c69 6465 725f 7374 6172  self.slider_star
+00007480: 742c 7365 6c66 2e73 6c69 6465 725f 656e  t,self.slider_en
+00007490: 645d 290d 0a0d 0a23 2020 2020 2064 6566  d])....#     def
+000074a0: 2073 6c69 6465 725f 7374 6172 745f 6368   slider_start_ch
+000074b0: 616e 6765 6428 7365 6c66 2c6b 6579 2c76  anged(self,key,v
+000074c0: 616c 7565 293a 0d0a 2320 2020 2020 2020  alue):..#       
+000074d0: 2020 7365 6c66 2e73 6c69 6465 725f 656e    self.slider_en
+000074e0: 642e 7661 6c75 653d 6d61 7828 7365 6c66  d.value=max(self
+000074f0: 2e73 6c69 6465 725f 7374 6172 742e 7661  .slider_start.va
+00007500: 6c75 652c 7365 6c66 2e73 6c69 6465 725f  lue,self.slider_
+00007510: 656e 642e 7661 6c75 6529 0d0a 2320 2020  end.value)..#   
+00007520: 2020 2020 2020 7365 6c66 2e5f 6f62 7365        self._obse
+00007530: 7276 6528 7374 6172 743d 7365 6c66 2e73  rve(start=self.s
+00007540: 6c69 6465 725f 7374 6172 742e 7661 6c75  lider_start.valu
+00007550: 652c 656e 643d 7365 6c66 2e73 6c69 6465  e,end=self.slide
+00007560: 725f 656e 642e 7661 6c75 6529 0d0a 0d0a  r_end.value)....
+00007570: 2320 2020 2020 6465 6620 736c 6964 6572  #     def slider
+00007580: 5f65 6e64 5f63 6861 6e67 6564 2873 656c  _end_changed(sel
+00007590: 662c 6b65 792c 7661 6c75 6529 3a0d 0a23  f,key,value):..#
+000075a0: 2020 2020 2020 2020 2073 656c 662e 736c           self.sl
+000075b0: 6964 6572 5f73 7461 7274 2e76 616c 7565  ider_start.value
+000075c0: 3d6d 696e 2873 656c 662e 736c 6964 6572  =min(self.slider
+000075d0: 5f73 7461 7274 2e76 616c 7565 2c73 656c  _start.value,sel
+000075e0: 662e 736c 6964 6572 5f65 6e64 2e76 616c  f.slider_end.val
+000075f0: 7565 290d 0a23 2020 2020 2020 2020 2073  ue)..#         s
+00007600: 656c 662e 5f6f 6273 6572 7665 2873 7461  elf._observe(sta
+00007610: 7274 3d73 656c 662e 736c 6964 6572 5f73  rt=self.slider_s
+00007620: 7461 7274 2e76 616c 7565 2c65 6e64 3d73  tart.value,end=s
+00007630: 656c 662e 736c 6964 6572 5f65 6e64 2e76  elf.slider_end.v
+00007640: 616c 7565 290d 0a0d 0a23 2020 2020 2064  alue)....#     d
+00007650: 6566 2064 6973 706c 6179 2873 656c 6629  ef display(self)
+00007660: 3a0d 0a23 2020 2020 2020 2020 2064 6973  :..#         dis
+00007670: 706c 6179 2873 656c 662e 736c 6964 6572  play(self.slider
+00007680: 5f73 7461 7274 2c73 656c 662e 736c 6964  _start,self.slid
+00007690: 6572 5f65 6e64 290d 0a0d 0a23 2020 2020  er_end)....#    
+000076a0: 2064 6566 205f 6f62 7365 7276 6528 7365   def _observe(se
+000076b0: 6c66 2c2a 2a6b 7761 7267 7329 3a0d 0a23  lf,**kwargs):..#
+000076c0: 2020 2020 2020 2020 2069 6620 6861 7361           if hasa
+000076d0: 7474 7228 7365 6c66 2c27 6f62 7365 7276  ttr(self,'observ
+000076e0: 6527 293a 0d0a 2320 2020 2020 2020 2020  e'):..#         
+000076f0: 2020 2020 7365 6c66 2e6f 6273 6572 7665      self.observe
+00007700: 282a 2a6b 7761 7267 7329 0d0a 0d0a 2320  (**kwargs)....# 
+00007710: 6465 6620 6663 7428 7374 6172 742c 656e  def fct(start,en
+00007720: 6429 3a0d 0a23 2020 2020 2070 7269 6e74  d):..#     print
+00007730: 2028 7374 6172 742c 656e 6429 0d0a 2020   (start,end)..  
+00007740: 2020 0d0a 2320 2020 2020 7374 6172 743d    ..#     start=
+00007750: 696e 7428 7374 6172 742e 7469 6d65 7374  int(start.timest
+00007760: 616d 7028 2920 2a20 3130 3030 290d 0a23  amp() * 1000)..#
+00007770: 2020 2020 2065 6e64 3d69 6e74 2865 6e64       end=int(end
+00007780: 2e74 696d 6573 7461 6d70 2829 202a 2031  .timestamp() * 1
+00007790: 3030 3029 0d0a 0d0a 2320 2020 2020 6466  000)....#     df
+000077a0: 3d70 642e 7265 6164 5f63 7376 2827 7465  =pd.read_csv('te
+000077b0: 6d70 322e 6373 7627 290d 0a0d 0a23 2020  mp2.csv')....#  
+000077c0: 2020 2064 662e 7265 6e61 6d65 2863 6f6c     df.rename(col
+000077d0: 756d 6e73 3d7b 2064 662e 636f 6c75 6d6e  umns={ df.column
+000077e0: 735b 305d 3a20 2264 6422 207d 2c20 696e  s[0]: "dd" }, in
+000077f0: 706c 6163 6520 3d20 5472 7565 290d 0a23  place = True)..#
+00007800: 2020 2020 2064 665b 2764 645f 7374 7227       df['dd_str'
+00007810: 5d3d 6466 5b27 6464 275d 2e61 7374 7970  ]=df['dd'].astyp
+00007820: 6528 7374 7229 0d0a 2320 2020 2020 6466  e(str)..#     df
+00007830: 5b27 6464 5f73 7472 275d 203d 2064 665b  ['dd_str'] = df[
+00007840: 2764 645f 7374 7227 5d2e 6173 7479 7065  'dd_str'].astype
+00007850: 2873 7472 290d 0a23 2020 2020 2064 662e  (str)..#     df.
+00007860: 7265 6e61 6d65 2863 6f6c 756d 6e73 3d7b  rename(columns={
+00007870: 2064 662e 636f 6c75 6d6e 735b 315d 3a20   df.columns[1]: 
+00007880: 2276 616c 2220 7d2c 2069 6e70 6c61 6365  "val" }, inplace
+00007890: 203d 2054 7275 6529 0d0a 2320 2020 2020   = True)..#     
+000078a0: 6466 5b27 6464 275d 3d20 7064 2e74 6f5f  df['dd']= pd.to_
+000078b0: 6461 7465 7469 6d65 2864 665b 2764 6427  datetime(df['dd'
+000078c0: 5d2e 6173 7479 7065 2873 7472 292c 2066  ].astype(str), f
+000078d0: 6f72 6d61 743d 2725 592d 256d 2d25 6427  ormat='%Y-%m-%d'
+000078e0: 290d 0a23 2020 2020 2064 662e 696e 7365  )..#     df.inse
+000078f0: 7274 2864 662e 7368 6170 655b 315d 2c0d  rt(df.shape[1],.
+00007900: 0a23 2020 2020 2020 2020 2020 2020 2027  .#             '
+00007910: 726f 775f 636f 756e 7427 2c0d 0a23 2020  row_count',..#  
+00007920: 2020 2020 2020 2020 2020 2064 662e 696e             df.in
+00007930: 6465 782e 7661 6c75 655f 636f 756e 7473  dex.value_counts
+00007940: 2829 2e73 6f72 745f 696e 6465 7828 292e  ().sort_index().
+00007950: 6375 6d73 756d 2829 290d 0a23 2020 2020  cumsum())..#    
+00007960: 2023 6466 3d64 662e 7365 745f 696e 6465   #df=df.set_inde
+00007970: 7828 2764 6427 290d 0a23 2020 2020 2023  x('dd')..#     #
+00007980: 6466 2e69 6e64 6578 203d 2070 642e 4461  df.index = pd.Da
+00007990: 7465 7469 6d65 496e 6465 7828 6466 2e69  tetimeIndex(df.i
+000079a0: 6e64 6578 290d 0a23 2020 2020 2064 662e  ndex)..#     df.
+000079b0: 6464 5f73 7472 203d 2070 642e 4461 7465  dd_str = pd.Date
+000079c0: 7469 6d65 496e 6465 7828 6466 2e64 645f  timeIndex(df.dd_
+000079d0: 7374 7229 0d0a 2320 2020 2020 6466 5b27  str)..#     df['
+000079e0: 6464 5f69 6e74 275d 203d 205b 696e 7428  dd_int'] = [int(
+000079f0: 692e 7469 6d65 7374 616d 7028 292a 3130  i.timestamp()*10
+00007a00: 3030 2920 666f 7220 6920 696e 2064 662e  00) for i in df.
+00007a10: 6464 5f73 7472 5d0d 0a23 2020 2020 2069  dd_str]..#     i
+00007a20: 6d70 6f72 7420 6e75 6d70 7920 6173 206e  mport numpy as n
+00007a30: 7020 0d0a 2320 2020 2020 6465 6620 6669  p ..#     def fi
+00007a40: 6e64 5f6e 6561 7265 7374 2861 7272 6179  nd_nearest(array
+00007a50: 2c20 7661 6c75 6529 3a0d 0a23 2020 2020  , value):..#    
+00007a60: 2020 2020 2061 7272 6179 203d 206e 702e       array = np.
+00007a70: 6173 6172 7261 7928 6172 7261 7929 0d0a  asarray(array)..
+00007a80: 2320 2020 2020 2020 2020 6964 7820 3d20  #         idx = 
+00007a90: 286e 702e 6162 7328 6172 7261 7920 2d20  (np.abs(array - 
+00007aa0: 7661 6c75 6529 292e 6172 676d 696e 2829  value)).argmin()
+00007ab0: 0d0a 2320 2020 2020 2020 2020 7265 7475  ..#         retu
+00007ac0: 726e 2061 7272 6179 5b69 6478 5d0d 0a23  rn array[idx]..#
+00007ad0: 2020 2020 2073 3d66 696e 645f 6e65 6172       s=find_near
+00007ae0: 6573 7428 6e70 2e61 7272 6179 2864 662e  est(np.array(df.
+00007af0: 6464 5f69 6e74 292c 2073 7461 7274 290d  dd_int), start).
+00007b00: 0a23 2020 2020 2065 3d66 696e 645f 6e65  .#     e=find_ne
+00007b10: 6172 6573 7428 6e70 2e61 7272 6179 2864  arest(np.array(d
+00007b20: 662e 6464 5f69 6e74 292c 2065 6e64 290d  f.dd_int), end).
+00007b30: 0a0d 0a23 2020 2020 2073 3d28 6466 5b64  ...#     s=(df[d
+00007b40: 665b 2764 645f 696e 7427 5d3d 3d73 5d2e  f['dd_int']==s].
+00007b50: 696e 6465 7829 0d0a 2320 2020 2020 653d  index)..#     e=
+00007b60: 2864 665b 6466 5b27 6464 5f69 6e74 275d  (df[df['dd_int']
+00007b70: 3d3d 655d 2e69 6e64 6578 290d 0a0d 0a23  ==e].index)....#
+00007b80: 2020 2020 2064 665f 6669 6c74 6572 3d64       df_filter=d
+00007b90: 665b 735b 305d 3a65 5b30 5d5d 0d0a 2320  f[s[0]:e[0]]..# 
+00007ba0: 2020 2020 7072 696e 7428 6466 5f66 696c      print(df_fil
+00007bb0: 7465 7229 0d0a 2320 2020 2020 7265 7475  ter)..#     retu
+00007bc0: 726e 2028 7374 6172 742c 2065 6e64 290d  rn (start, end).
+00007bd0: 0a20 2020 200d 0a23 2077 3d44 6174 6552  .    ..# w=DateR
+00007be0: 616e 6765 5069 636b 6572 2873 7461 7274  angePicker(start
+00007bf0: 3d27 3230 3232 2d30 382d 3032 272c 656e  ='2022-08-02',en
+00007c00: 643d 2232 3032 322d 3039 2d30 3222 2c66  d="2022-09-02",f
+00007c10: 7265 713d 2744 272c 666d 743d 2725 592d  req='D',fmt='%Y-
+00007c20: 256d 2d25 6427 290d 0a23 2077 2e6f 6273  %m-%d')..# w.obs
+00007c30: 6572 7665 3d66 6374 0d0a 2320 772e 6469  erve=fct..# w.di
+00007c40: 7370 6c61 7928 290d 0a0d 0a23 2023 613d  splay()....# #a=
+00007c50: 6663 745b 305d 0d0a 2320 7072 696e 7428  fct[0]..# print(
+00007c60: 772e 6f62 7365 7276 655b 305d 290d 0a0d  w.observe[0])...
+00007c70: 0a23 2323 2323 2323 2323 2323 2323 2323  .###############
+00007c80: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00007c90: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00007ca0: 2323 2323 2323 2323 2323 2323 230d 0a0d  #############...
+00007cb0: 0a0d 0a64 6566 2061 6b68 6465 666f 5f66  ...def akhdefo_f
+00007cc0: 6974 506c 616e 6528 6465 6d5f 6461 7461  itPlane(dem_data
+00007cd0: 3d27 272c 206c 696e 655f 7368 6170 6566  ='', line_shapef
+00007ce0: 696c 653d 4e6f 6e65 202c 206f 7574 5f70  ile=None , out_p
+00007cf0: 6c61 6e65 466f 6c64 6572 3d27 506c 616e  laneFolder='Plan
+00007d00: 6573 5f6f 7574 2729 3a0d 0a20 2020 2022  es_out'):..    "
+00007d10: 2222 0d0a 2020 2020 4669 7420 706c 616e  ""..    Fit plan
+00007d20: 6573 2074 6f20 706f 696e 7473 2069 6e20  es to points in 
+00007d30: 6120 4469 6769 7461 6c20 456c 6576 6174  a Digital Elevat
+00007d40: 696f 6e20 4d6f 6465 6c20 2844 454d 2920  ion Model (DEM) 
+00007d50: 616e 6420 7669 7375 616c 697a 6520 7468  and visualize th
+00007d60: 6520 7265 7375 6c74 732e 0d0a 0d0a 2020  e results.....  
+00007d70: 2020 5061 7261 6d65 7465 7273 3a0d 0a20    Parameters:.. 
+00007d80: 2020 2020 2020 202d 2064 656d 5f64 6174         - dem_dat
+00007d90: 6120 2873 7472 293a 2050 6174 6820 746f  a (str): Path to
+00007da0: 2074 6865 2044 454d 2064 6174 6120 6669   the DEM data fi
+00007db0: 6c65 2028 4765 6f54 4946 4620 666f 726d  le (GeoTIFF form
+00007dc0: 6174 292e 0d0a 2020 2020 2020 2020 2d20  at)...        - 
+00007dd0: 6c69 6e65 5f73 6861 7065 6669 6c65 2028  line_shapefile (
+00007de0: 7374 7229 3a20 5061 7468 2074 6f20 7468  str): Path to th
+00007df0: 6520 7368 6170 6566 696c 6520 636f 6e74  e shapefile cont
+00007e00: 6169 6e69 6e67 206c 696e 6520 6665 6174  aining line feat
+00007e10: 7572 6573 2072 6570 7265 7365 6e74 696e  ures representin
+00007e20: 6720 706c 616e 6573 2e0d 0a20 2020 2020  g planes...     
+00007e30: 2020 202d 206f 7574 5f70 6c61 6e65 466f     - out_planeFo
+00007e40: 6c64 6572 2028 7374 7229 3a20 5061 7468  lder (str): Path
+00007e50: 2074 6f20 7468 6520 666f 6c64 6572 2077   to the folder w
+00007e60: 6865 7265 2074 6865 206f 7574 7075 7420  here the output 
+00007e70: 706c 616e 6520 6461 7461 2077 696c 6c20  plane data will 
+00007e80: 6265 2073 6176 6564 2e0d 0a0d 0a20 2020  be saved.....   
+00007e90: 2048 6f77 2049 7420 576f 726b 733a 0d0a   How It Works:..
+00007ea0: 2020 2020 2020 2020 5468 6973 2066 756e          This fun
+00007eb0: 6374 696f 6e20 7265 6164 7320 6120 4445  ction reads a DE
+00007ec0: 4d20 616e 6420 7368 6170 6566 696c 652c  M and shapefile,
+00007ed0: 2061 6c6c 6f77 7320 7468 6520 7573 6572   allows the user
+00007ee0: 2074 6f20 696e 7465 7261 6374 6976 656c   to interactivel
+00007ef0: 7920 7365 6c65 6374 2070 6f69 6e74 7320  y select points 
+00007f00: 6672 6f6d 2074 6865 2044 454d 2c0d 0a20  from the DEM,.. 
+00007f10: 2020 2020 2020 2066 6974 7320 706c 616e         fits plan
+00007f20: 6573 2074 6f20 7468 6520 7365 6c65 6374  es to the select
+00007f30: 6564 2070 6f69 6e74 732c 2061 6e64 2076  ed points, and v
+00007f40: 6973 7561 6c69 7a65 7320 7468 6520 7265  isualizes the re
+00007f50: 7375 6c74 7320 696e 2032 4420 616e 6420  sults in 2D and 
+00007f60: 3344 2070 6c6f 7473 2e20 4974 2061 6c73  3D plots. It als
+00007f70: 6f20 7072 6f76 6964 6573 206f 7074 696f  o provides optio
+00007f80: 6e73 0d0a 2020 2020 2020 2020 746f 2073  ns..        to s
+00007f90: 6176 6520 7468 6520 6669 7474 6564 2070  ave the fitted p
+00007fa0: 6c61 6e65 7320 6173 2058 595a 2061 6e64  lanes as XYZ and
+00007fb0: 2044 5846 2066 696c 6573 2e20 6164 6469   DXF files. addi
+00007fc0: 7469 6f6e 616c 6c79 2070 6c6f 7473 2070  tionally plots p
+00007fd0: 6f6c 6573 2074 6f20 706c 616e 6573 206f  oles to planes o
+00007fe0: 6e20 706f 6c61 7220 6772 6964 2061 6e64  n polar grid and
+00007ff0: 2072 6f73 6520 6469 6167 7261 6d20 666f   rose diagram fo
+00008000: 7220 7374 7269 6b65 2f74 7265 6e64 7320  r strike/trends 
+00008010: 6f66 2070 6c61 6e65 730d 0a0d 0a20 2020  of planes....   
+00008020: 204e 6f74 653a 0d0a 2020 2020 2020 2020   Note:..        
+00008030: 2d20 5468 6520 6675 6e63 7469 6f6e 2075  - The function u
+00008040: 7469 6c69 7a65 7320 7661 7269 6f75 7320  tilizes various 
+00008050: 6c69 6272 6172 6965 7320 7375 6368 2061  libraries such a
+00008060: 7320 6e75 6d70 792c 206d 6174 706c 6f74  s numpy, matplot
+00008070: 6c69 622c 2074 6b69 6e74 6572 2c20 6f73  lib, tkinter, os
+00008080: 6765 6f20 2847 4441 4c29 2c20 616e 6420  geo (GDAL), and 
+00008090: 6765 6f70 616e 6461 732e 0d0a 2020 2020  geopandas...    
+000080a0: 2020 2020 2d20 456e 7375 7265 2074 6861      - Ensure tha
+000080b0: 7420 7468 6520 7265 7175 6972 6564 206c  t the required l
+000080c0: 6962 7261 7269 6573 2061 6e64 2064 6570  ibraries and dep
+000080d0: 656e 6465 6e63 6965 7320 6172 6520 696e  endencies are in
+000080e0: 7374 616c 6c65 6420 746f 2075 7365 2074  stalled to use t
+000080f0: 6869 7320 6675 6e63 7469 6f6e 2065 6666  his function eff
+00008100: 6563 7469 7665 6c79 2e0d 0a0d 0a20 2020  ectively.....   
+00008110: 2045 7861 6d70 6c65 2055 7361 6765 3a0d   Example Usage:.
+00008120: 0a20 2020 2020 2020 2061 6b68 6465 666f  .        akhdefo
+00008130: 5f66 6974 506c 616e 6528 6465 6d5f 6461  _fitPlane(dem_da
+00008140: 7461 3d27 7061 7468 2f74 6f2f 6465 6d2e  ta='path/to/dem.
+00008150: 7469 6627 2c6c 696e 655f 7368 6170 6566  tif',line_shapef
+00008160: 696c 653d 2770 6174 682f 746f 2f6c 696e  ile='path/to/lin
+00008170: 6573 2e73 6870 272c 6f75 745f 706c 616e  es.shp',out_plan
+00008180: 6546 6f6c 6465 723d 276f 7574 7075 742f  eFolder='output/
+00008190: 666f 6c64 6572 2729 0d0a 2020 2020 2020  folder')..      
+000081a0: 2020 0d0a 2020 2020 2222 220d 0a20 2020    ..    """..   
+000081b0: 200d 0a20 2020 2067 6c6f 6261 6c20 6469   ..    global di
+000081c0: 705f 616e 676c 655f 6c69 7374 2c20 6469  p_angle_list, di
+000081d0: 705f 6469 7265 6374 696f 6e5f 6c69 7374  p_direction_list
+000081e0: 202c 2066 6967 315f 636d 6170 2c20 706c   , fig1_cmap, pl
+000081f0: 616e 655f 636f 6c6f 7273 0d0a 2020 2020  ane_colors..    
+00008200: 0d0a 2020 2020 6469 705f 616e 676c 655f  ..    dip_angle_
+00008210: 6c69 7374 3d5b 5d0d 0a20 2020 2064 6970  list=[]..    dip
+00008220: 5f64 6972 6563 7469 6f6e 5f6c 6973 743d  _direction_list=
+00008230: 5b5d 0d0a 2020 2020 706c 616e 655f 636f  []..    plane_co
+00008240: 6c6f 7273 3d5b 5d0d 0a20 2020 200d 0a20  lors=[]..    .. 
+00008250: 2020 2023 2064 6566 2063 6d61 705f 706c     # def cmap_pl
+00008260: 6f74 2870 6c61 6e65 5f63 6f6c 6f72 732c  ot(plane_colors,
+00008270: 2020 6c61 6265 6c3d 2743 6f6c 6f72 2729    label='Color')
+00008280: 3a0d 0a20 2020 2020 2020 200d 0a20 2020  :..        ..   
+00008290: 2023 2020 2020 2066 726f 6d20 6d61 7470   #     from matp
+000082a0: 6c6f 746c 6962 2e63 6f6c 6f72 7320 696d  lotlib.colors im
+000082b0: 706f 7274 204c 6973 7465 6443 6f6c 6f72  port ListedColor
+000082c0: 6d61 700d 0a20 2020 2023 2020 2020 2069  map..    #     i
+000082d0: 6d70 6f72 7420 6e75 6d70 7920 6173 206e  mport numpy as n
+000082e0: 700d 0a20 2020 2023 2020 2020 2074 7279  p..    #     try
+000082f0: 3a0d 0a20 2020 2023 2020 2020 2020 2020  :..    #        
+00008300: 2063 6d61 7020 3d20 4c69 7374 6564 436f   cmap = ListedCo
+00008310: 6c6f 726d 6170 2870 6c61 6e65 5f63 6f6c  lormap(plane_col
+00008320: 6f72 7329 0d0a 2020 2020 2320 2020 2020  ors)..    #     
+00008330: 2020 2020 6669 672c 2061 7820 3d20 706c      fig, ax = pl
+00008340: 742e 7375 6270 6c6f 7473 2866 6967 7369  t.subplots(figsi
+00008350: 7a65 3d28 362c 2031 2929 0d0a 2020 2020  ze=(6, 1))..    
+00008360: 2320 2020 2020 2020 2020 6669 672e 7375  #         fig.su
+00008370: 6270 6c6f 7473 5f61 646a 7573 7428 626f  bplots_adjust(bo
+00008380: 7474 6f6d 3d30 2e35 290d 0a20 2020 2023  ttom=0.5)..    #
+00008390: 2020 2020 2020 2020 2063 6261 7220 3d20           cbar = 
+000083a0: 706c 742e 636f 6c6f 7262 6172 2870 6c74  plt.colorbar(plt
+000083b0: 2e63 6d2e 5363 616c 6172 4d61 7070 6162  .cm.ScalarMappab
+000083c0: 6c65 2863 6d61 703d 636d 6170 292c 2063  le(cmap=cmap), c
+000083d0: 6178 3d61 782c 206f 7269 656e 7461 7469  ax=ax, orientati
+000083e0: 6f6e 3d27 686f 7269 7a6f 6e74 616c 2729  on='horizontal')
+000083f0: 0d0a 2020 2020 2320 2020 2020 2020 2020  ..    #         
+00008400: 6362 6172 2e73 6574 5f6c 6162 656c 286c  cbar.set_label(l
+00008410: 6162 656c 290d 0a20 2020 2023 2020 2020  abel)..    #    
+00008420: 2020 2020 2070 6c74 2e73 686f 7728 290d       plt.show().
+00008430: 0a20 2020 2023 2020 2020 2065 7863 6570  .    #     excep
+00008440: 7420 4578 6365 7074 696f 6e20 6173 2065  t Exception as e
+00008450: 783a 0d0a 2020 2020 2320 2020 2020 2020  x:..    #       
+00008460: 2020 7072 696e 7428 2222 290d 0a20 2020    print("")..   
+00008470: 2020 2020 200d 0a20 2020 2023 2020 2020       ..    #    
+00008480: 2072 6574 7572 6e20 6669 670d 0a20 2020   return fig..   
+00008490: 200d 0a20 2020 2069 6d70 6f72 7420 6f73   ..    import os
+000084a0: 0d0a 2020 2020 696d 706f 7274 206e 756d  ..    import num
+000084b0: 7079 2061 7320 6e70 0d0a 2020 2020 696d  py as np..    im
+000084c0: 706f 7274 206d 6174 706c 6f74 6c69 622e  port matplotlib.
+000084d0: 7079 706c 6f74 2061 7320 706c 740d 0a20  pyplot as plt.. 
+000084e0: 2020 2066 726f 6d20 6f73 6765 6f20 696d     from osgeo im
+000084f0: 706f 7274 2067 6461 6c0d 0a20 2020 2069  port gdal..    i
+00008500: 6d70 6f72 7420 746b 696e 7465 7220 6173  mport tkinter as
+00008510: 2074 6b0d 0a20 2020 2066 726f 6d20 746b   tk..    from tk
+00008520: 696e 7465 7220 696d 706f 7274 2074 746b  inter import ttk
+00008530: 0d0a 2020 2020 6672 6f6d 206d 6174 706c  ..    from matpl
+00008540: 6f74 6c69 622e 6261 636b 656e 6473 2e62  otlib.backends.b
+00008550: 6163 6b65 6e64 5f74 6b61 6767 2069 6d70  ackend_tkagg imp
+00008560: 6f72 7420 4669 6775 7265 4361 6e76 6173  ort FigureCanvas
+00008570: 546b 4167 670d 0a20 2020 2066 726f 6d20  TkAgg..    from 
+00008580: 6d61 7470 6c6f 746c 6962 2e63 6f6c 6f72  matplotlib.color
+00008590: 7320 696d 706f 7274 204c 6967 6874 536f  s import LightSo
+000085a0: 7572 6365 0d0a 2020 2020 696d 706f 7274  urce..    import
+000085b0: 2065 6172 7468 7079 2e73 7061 7469 616c   earthpy.spatial
+000085c0: 2061 7320 6573 0d0a 2020 2020 696d 706f   as es..    impo
+000085d0: 7274 2067 656f 7061 6e64 6173 2061 7320  rt geopandas as 
+000085e0: 6770 640d 0a20 2020 2069 6d70 6f72 7420  gpd..    import 
+000085f0: 7261 6e64 6f6d 0d0a 2020 2020 6672 6f6d  random..    from
+00008600: 206d 6174 706c 6f74 6c69 622e 6261 636b   matplotlib.back
+00008610: 656e 6473 2e62 6163 6b65 6e64 5f74 6b61  ends.backend_tka
+00008620: 6767 2069 6d70 6f72 7420 4e61 7669 6761  gg import Naviga
+00008630: 7469 6f6e 546f 6f6c 6261 7232 546b 0d0a  tionToolbar2Tk..
+00008640: 2020 2020 6672 6f6d 2073 6861 7065 6c79      from shapely
+00008650: 2e67 656f 6d65 7472 7920 696d 706f 7274  .geometry import
+00008660: 204c 696e 6553 7472 696e 670d 0a20 2020   LineString..   
+00008670: 200d 0a20 2020 200d 0a20 2020 2069 6620   ..    ..    if 
+00008680: 6e6f 7420 6f73 2e70 6174 682e 6578 6973  not os.path.exis
+00008690: 7473 286f 7574 5f70 6c61 6e65 466f 6c64  ts(out_planeFold
+000086a0: 6572 293a 0d0a 2020 2020 2020 2020 6f73  er):..        os
+000086b0: 2e6d 616b 6564 6972 7328 6f75 745f 706c  .makedirs(out_pl
+000086c0: 616e 6546 6f6c 6465 7229 0d0a 2020 2020  aneFolder)..    
+000086d0: 0d0a 2020 2020 6465 6620 636f 6c6f 725f  ..    def color_
+000086e0: 6672 6f6d 5f64 6970 5f61 6e64 5f64 6972  from_dip_and_dir
+000086f0: 6563 7469 6f6e 2864 6970 2c20 6469 7265  ection(dip, dire
+00008700: 6374 696f 6e29 3a0d 0a20 2020 2020 2020  ction):..       
+00008710: 2063 6d61 705f 6469 7020 3d20 706c 742e   cmap_dip = plt.
+00008720: 6765 745f 636d 6170 2827 6873 7627 290d  get_cmap('hsv').
+00008730: 0a20 2020 2020 2020 2063 6d61 705f 6469  .        cmap_di
+00008740: 7265 6374 696f 6e20 3d20 706c 742e 6765  rection = plt.ge
+00008750: 745f 636d 6170 2827 6873 7627 290d 0a0d  t_cmap('hsv')...
+00008760: 0a20 2020 2020 2020 2063 6f6c 5f64 6970  .        col_dip
+00008770: 203d 2063 6d61 705f 6469 7028 6469 7020   = cmap_dip(dip 
+00008780: 2f20 3930 2e30 290d 0a20 2020 2020 2020  / 90.0)..       
+00008790: 2063 6f6c 5f64 6972 6563 7469 6f6e 203d   col_direction =
+000087a0: 2063 6d61 705f 6469 7265 6374 696f 6e28   cmap_direction(
+000087b0: 6469 7265 6374 696f 6e20 2f20 3336 302e  direction / 360.
+000087c0: 3029 0d0a 0d0a 2020 2020 2020 2020 636f  0)....        co
+000087d0: 6c6f 7220 3d20 5b30 2e35 2a28 636f 6c5f  lor = [0.5*(col_
+000087e0: 6469 705b 695d 202b 2063 6f6c 5f64 6972  dip[i] + col_dir
+000087f0: 6563 7469 6f6e 5b69 5d29 2066 6f72 2069  ection[i]) for i
+00008800: 2069 6e20 7261 6e67 6528 3329 5d0d 0a20   in range(3)].. 
+00008810: 2020 200d 0a20 2020 2020 2020 2072 6574     ..        ret
+00008820: 7572 6e20 636f 6c6f 720d 0a0d 0a20 2020  urn color....   
+00008830: 2064 6566 2072 616e 646f 6d5f 636f 6c6f   def random_colo
+00008840: 7228 293a 0d0a 2020 2020 2020 2020 2222  r():..        ""
+00008850: 2247 656e 6572 6174 6520 6120 7261 6e64  "Generate a rand
+00008860: 6f6d 2063 6f6c 6f72 2e22 2222 0d0a 2020  om color."""..  
+00008870: 2020 2020 2020 7265 7475 726e 2028 7261        return (ra
+00008880: 6e64 6f6d 2e75 6e69 666f 726d 2830 2c20  ndom.uniform(0, 
+00008890: 3129 2c20 7261 6e64 6f6d 2e75 6e69 666f  1), random.unifo
+000088a0: 726d 2830 2c20 3129 2c20 7261 6e64 6f6d  rm(0, 1), random
+000088b0: 2e75 6e69 666f 726d 2830 2c20 3129 290d  .uniform(0, 1)).
+000088c0: 0a0d 0a20 2020 2064 6566 2072 6561 645f  ...    def read_
+000088d0: 6465 6d28 6465 6d5f 6669 6c65 293a 0d0a  dem(dem_file):..
+000088e0: 2020 2020 2020 2020 6473 203d 2067 6461          ds = gda
+000088f0: 6c2e 4f70 656e 2864 656d 5f66 696c 6529  l.Open(dem_file)
+00008900: 0d0a 2020 2020 2020 2020 6461 7461 203d  ..        data =
+00008910: 2064 732e 5265 6164 4173 4172 7261 7928   ds.ReadAsArray(
+00008920: 290d 0a20 2020 2020 2020 2074 7261 6e73  )..        trans
+00008930: 666f 726d 203d 2064 732e 4765 7447 656f  form = ds.GetGeo
+00008940: 5472 616e 7366 6f72 6d28 290d 0a20 2020  Transform()..   
+00008950: 2020 2020 2070 726f 6a65 6374 696f 6e20       projection 
+00008960: 3d20 6473 2e47 6574 5072 6f6a 6563 7469  = ds.GetProjecti
+00008970: 6f6e 2829 0d0a 2020 2020 2020 2020 6473  on()..        ds
+00008980: 203d 204e 6f6e 6520 2023 2043 6c6f 7365   = None  # Close
+00008990: 2074 6865 2064 6174 6173 6574 0d0a 2020   the dataset..  
+000089a0: 2020 2020 2020 7265 7475 726e 2064 6174        return dat
+000089b0: 612c 2074 7261 6e73 666f 726d 2c20 7072  a, transform, pr
+000089c0: 6f6a 6563 7469 6f6e 0d0a 2020 2020 0d0a  ojection..    ..
+000089d0: 2020 2020 6461 7461 2c20 7472 616e 7366      data, transf
+000089e0: 6f72 6d2c 2070 726f 6a65 6374 696f 6e20  orm, projection 
+000089f0: 3d20 7265 6164 5f64 656d 2864 656d 5f64  = read_dem(dem_d
+00008a00: 6174 6129 0d0a 2020 2020 0d0a 2020 2020  ata)..    ..    
+00008a10: 696d 706f 7274 206d 6174 680d 0a0d 0a20  import math.... 
+00008a20: 2020 2064 6566 2063 616c 6375 6c61 7465     def calculate
+00008a30: 5f64 6970 5f61 6e67 6c65 5f61 6e64 5f64  _dip_angle_and_d
+00008a40: 6972 6563 7469 6f6e 2841 2c20 4229 3a0d  irection(A, B):.
+00008a50: 0a20 2020 2020 2020 2023 2043 616c 6375  .        # Calcu
+00008a60: 6c61 7465 2074 6865 2064 6970 2061 6e67  late the dip ang
+00008a70: 6c65 2028 696e 636c 696e 6174 696f 6e29  le (inclination)
+00008a80: 0d0a 2020 2020 2020 2020 6469 705f 616e  ..        dip_an
+00008a90: 676c 6520 3d20 6d61 7468 2e64 6567 7265  gle = math.degre
+00008aa0: 6573 286d 6174 682e 6174 616e 286d 6174  es(math.atan(mat
+00008ab0: 682e 7371 7274 2841 2a2a 3220 2b20 422a  h.sqrt(A**2 + B*
+00008ac0: 2a32 2929 290d 0a20 2020 2020 2020 0d0a  *2)))..       ..
+00008ad0: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
+00008ae0: 2020 2320 4361 6c63 756c 6174 6520 7468    # Calculate th
+00008af0: 6520 6469 7020 6469 7265 6374 696f 6e20  e dip direction 
+00008b00: 2861 7a69 6d75 7468 290d 0a20 2020 2020  (azimuth)..     
+00008b10: 2020 2064 6970 5f64 6972 6563 7469 6f6e     dip_direction
+00008b20: 203d 206d 6174 682e 6465 6772 6565 7328   = math.degrees(
+00008b30: 6d61 7468 2e61 7461 6e32 282d 422c 202d  math.atan2(-B, -
+00008b40: 4129 290d 0a20 2020 2020 2020 200d 0a20  A))..        .. 
+00008b50: 2020 2020 2020 2023 2045 6e73 7572 6520         # Ensure 
+00008b60: 6469 705f 6469 7265 6374 696f 6e20 6973  dip_direction is
+00008b70: 2069 6e20 7468 6520 7261 6e67 6520 5b30   in the range [0
+00008b80: 2c20 3336 3029 0d0a 2020 2020 2020 2020  , 360)..        
+00008b90: 6469 705f 6469 7265 6374 696f 6e20 3d20  dip_direction = 
+00008ba0: 2864 6970 5f64 6972 6563 7469 6f6e 202b  (dip_direction +
+00008bb0: 2039 3029 2025 2033 3630 0d0a 2020 2020   90) % 360..    
+00008bc0: 2020 2020 0d0a 2020 2020 2020 2020 7265      ..        re
+00008bd0: 7475 726e 2064 6970 5f61 6e67 6c65 2c20  turn dip_angle, 
+00008be0: 6469 705f 6469 7265 6374 696f 6e0d 0a20  dip_direction.. 
+00008bf0: 2020 200d 0a20 2020 2064 6566 2066 6974     ..    def fit
+00008c00: 5f70 6c61 6e65 2870 6f69 6e74 732c 2078  _plane(points, x
+00008c10: 782c 2079 7929 3a0d 0a20 2020 2020 2020  x, yy):..       
+00008c20: 206d 696e 5f72 616e 6765 203d 206e 702e   min_range = np.
+00008c30: 6e61 6e6d 696e 2864 6174 6129 0d0a 2020  nanmin(data)..  
+00008c40: 2020 2020 2020 6d61 785f 7261 6e67 6520        max_range 
+00008c50: 3d20 6e70 2e6e 616e 6d61 7828 6461 7461  = np.nanmax(data
+00008c60: 290d 0a20 2020 2020 2020 200d 0a20 2020  )..        ..   
+00008c70: 2020 2020 2023 2078 7820 3d20 2878 7820       # xx = (xx 
+00008c80: 2d20 6e70 2e6e 616e 6d69 6e28 7878 2929  - np.nanmin(xx))
+00008c90: 202f 2028 6e70 2e6e 616e 6d61 7828 7878   / (np.nanmax(xx
+00008ca0: 2920 2d20 6e70 2e6e 616e 6d69 6e28 7878  ) - np.nanmin(xx
+00008cb0: 2929 0d0a 2020 2020 2020 2020 2320 7878  ))..        # xx
+00008cc0: 203d 2078 7820 2a20 286d 6178 5f72 616e   = xx * (max_ran
+00008cd0: 6765 202d 206d 696e 5f72 616e 6765 2920  ge - min_range) 
+00008ce0: 2b20 6d69 6e5f 7261 6e67 650d 0a20 2020  + min_range..   
+00008cf0: 2020 2020 200d 0a20 2020 2020 2020 2023       ..        #
+00008d00: 2079 7920 3d20 2879 7920 2d20 6e70 2e6e   yy = (yy - np.n
+00008d10: 616e 6d69 6e28 7979 2929 202f 2028 6e70  anmin(yy)) / (np
+00008d20: 2e6e 616e 6d61 7828 7979 2920 2d20 6e70  .nanmax(yy) - np
+00008d30: 2e6e 616e 6d69 6e28 7979 2929 0d0a 2020  .nanmin(yy))..  
+00008d40: 2020 2020 2020 2320 7979 203d 2079 7920        # yy = yy 
+00008d50: 2a20 286d 6178 5f72 616e 6765 202d 206d  * (max_range - m
+00008d60: 696e 5f72 616e 6765 2920 2b20 6d69 6e5f  in_range) + min_
+00008d70: 7261 6e67 650d 0a20 2020 2020 2020 200d  range..        .
+00008d80: 0a20 2020 2020 2020 2078 5f76 616c 732c  .        x_vals,
+00008d90: 2079 5f76 616c 732c 207a 5f76 616c 7320   y_vals, z_vals 
+00008da0: 3d20 7a69 7028 2a70 6f69 6e74 7329 0d0a  = zip(*points)..
+00008db0: 2020 2020 0d0a 2020 2020 2020 2020 4120      ..        A 
+00008dc0: 3d20 6e70 2e76 7374 6163 6b28 5b78 5f76  = np.vstack([x_v
+00008dd0: 616c 732c 2079 5f76 616c 732c 206e 702e  als, y_vals, np.
+00008de0: 6f6e 6573 286c 656e 2878 5f76 616c 7329  ones(len(x_vals)
+00008df0: 295d 292e 540d 0a20 2020 2020 2020 2061  )]).T..        a
+00008e00: 2c20 622c 2063 203d 206e 702e 6c69 6e61  , b, c = np.lina
+00008e10: 6c67 2e6c 7374 7371 2841 2c20 7a5f 7661  lg.lstsq(A, z_va
+00008e20: 6c73 2c20 7263 6f6e 643d 4e6f 6e65 295b  ls, rcond=None)[
+00008e30: 305d 0d0a 2020 2020 2020 2020 0d0a 2020  0]..        ..  
+00008e40: 2020 2020 2020 7072 696e 7428 6622 506c        print(f"Pl
+00008e50: 616e 6520 6571 7561 7469 6f6e 3a20 7a20  ane equation: z 
+00008e60: 3d20 7b61 7d78 202b 207b 627d 7920 2b20  = {a}x + {b}y + 
+00008e70: 7b63 7d22 2920 2023 2044 6562 7567 6769  {c}")  # Debuggi
+00008e80: 6e67 206c 696e 650d 0a20 2020 2020 2020  ng line..       
+00008e90: 200d 0a20 2020 2020 2020 207a 7a20 3d20   ..        zz = 
+00008ea0: 6120 2a20 7878 202b 2062 202a 2079 7920  a * xx + b * yy 
+00008eb0: 2b20 630d 0a20 2020 2020 2020 2023 2323  + c..        ###
+00008ec0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00008ed0: 2323 2323 2323 2323 2323 2323 2323 230d  ###############.
+00008ee0: 0a20 2020 2020 2020 2023 2070 6f69 6e74  .        # point
+00008ef0: 7320 3d20 6e70 2e61 7272 6179 2870 6f69  s = np.array(poi
+00008f00: 6e74 7329 200d 0a20 2020 2020 2020 2023  nts) ..        #
+00008f10: 2023 2043 6f6d 7075 7465 2074 6865 2063   # Compute the c
+00008f20: 656e 7472 6f69 6420 6f66 2074 6865 2070  entroid of the p
+00008f30: 6f69 6e74 730d 0a20 2020 2020 2020 2023  oints..        #
+00008f40: 2063 656e 7472 6f69 6420 3d20 6e70 2e6d   centroid = np.m
+00008f50: 6561 6e28 706f 696e 7473 2c20 6178 6973  ean(points, axis
+00008f60: 3d30 290d 0a0d 0a20 2020 2020 2020 2023  =0)....        #
+00008f70: 2023 2053 7562 7472 6163 7420 7468 6520   # Subtract the 
+00008f80: 6365 6e74 726f 6964 2066 726f 6d20 7468  centroid from th
+00008f90: 6520 706f 696e 7473 2074 6f20 6365 6e74  e points to cent
+00008fa0: 6572 2074 6865 6d0d 0a20 2020 2020 2020  er them..       
+00008fb0: 2023 2063 656e 7465 7265 645f 706f 696e   # centered_poin
+00008fc0: 7473 203d 2070 6f69 6e74 7320 2d20 6365  ts = points - ce
+00008fd0: 6e74 726f 6964 0d0a 0d0a 2020 2020 2020  ntroid....      
+00008fe0: 2020 2320 2320 5065 7266 6f72 6d20 5356    # # Perform SV
+00008ff0: 4420 6f6e 2074 6865 2063 656e 7465 7265  D on the centere
+00009000: 6420 706f 696e 7473 0d0a 2020 2020 2020  d points..      
+00009010: 2020 2320 552c 2053 2c20 5674 203d 206e    # U, S, Vt = n
+00009020: 702e 6c69 6e61 6c67 2e73 7664 2863 656e  p.linalg.svd(cen
+00009030: 7465 7265 645f 706f 696e 7473 290d 0a0d  tered_points)...
+00009040: 0a20 2020 2020 2020 2023 2023 2054 6865  .        # # The
+00009050: 206e 6f72 6d61 6c20 7665 6374 6f72 206f   normal vector o
+00009060: 6620 7468 6520 706c 616e 6520 6973 2074  f the plane is t
+00009070: 6865 206c 6173 7420 726f 7720 6f66 2056  he last row of V
+00009080: 740d 0a20 2020 2020 2020 2023 206e 6f72  t..        # nor
+00009090: 6d61 6c5f 7665 6374 6f72 203d 2056 745b  mal_vector = Vt[
+000090a0: 2d31 2c20 3a5d 0d0a 0d0a 2020 2020 2020  -1, :]....      
+000090b0: 2020 2320 2320 4e6f 726d 616c 697a 6520    # # Normalize 
+000090c0: 7468 6520 6e6f 726d 616c 2076 6563 746f  the normal vecto
+000090d0: 720d 0a20 2020 2020 2020 2023 206e 6f72  r..        # nor
+000090e0: 6d61 6c5f 7665 6374 6f72 202f 3d20 6e70  mal_vector /= np
+000090f0: 2e6c 696e 616c 672e 6e6f 726d 286e 6f72  .linalg.norm(nor
+00009100: 6d61 6c5f 7665 6374 6f72 290d 0a0d 0a20  mal_vector).... 
+00009110: 2020 2020 2020 2023 2023 2054 6865 2065         # # The e
+00009120: 7175 6174 696f 6e20 6f66 2074 6865 2070  quation of the p
+00009130: 6c61 6e65 2069 733a 2061 7820 2b20 6279  lane is: ax + by
+00009140: 202b 2063 7a20 2b20 6420 3d20 302c 2077   + cz + d = 0, w
+00009150: 6865 7265 205b 612c 2062 2c20 635d 2069  here [a, b, c] i
+00009160: 7320 7468 6520 6e6f 726d 616c 2076 6563  s the normal vec
+00009170: 746f 720d 0a20 2020 2020 2020 2023 2061  tor..        # a
+00009180: 2c20 622c 2063 203d 206e 6f72 6d61 6c5f  , b, c = normal_
+00009190: 7665 6374 6f72 0d0a 0d0a 2020 2020 2020  vector....      
+000091a0: 2020 2320 2320 4361 6c63 756c 6174 6520    # # Calculate 
+000091b0: 6420 7573 696e 6720 7468 6520 706c 616e  d using the plan
+000091c0: 6520 6571 7561 7469 6f6e 2061 6e64 2074  e equation and t
+000091d0: 6865 2063 656e 7472 6f69 640d 0a20 2020  he centroid..   
+000091e0: 2020 2020 2023 2064 203d 202d 6e70 2e64       # d = -np.d
+000091f0: 6f74 286e 6f72 6d61 6c5f 7665 6374 6f72  ot(normal_vector
+00009200: 2c20 6365 6e74 726f 6964 290d 0a20 2020  , centroid)..   
+00009210: 2020 2020 2023 207a 7a20 3d20 282d 6120       # zz = (-a 
+00009220: 2a20 7878 202d 2062 202a 2079 7920 2d20  * xx - b * yy - 
+00009230: 6429 202f 2063 2020 2320 536f 6c76 6520  d) / c  # Solve 
+00009240: 666f 7220 7a0d 0a20 2020 2020 2020 200d  for z..        .
+00009250: 0a20 2020 2020 2020 0d0a 2020 2020 2020  .       ..      
+00009260: 2020 6469 705f 616e 676c 652c 2064 6970    dip_angle, dip
+00009270: 5f64 6972 6563 7469 6f6e 203d 2063 616c  _direction = cal
+00009280: 6375 6c61 7465 5f64 6970 5f61 6e67 6c65  culate_dip_angle
+00009290: 5f61 6e64 5f64 6972 6563 7469 6f6e 2861  _and_direction(a
+000092a0: 2c20 6229 0d0a 0d0a 2020 2020 2020 2020  , b)....        
+000092b0: 7072 696e 7428 6622 4469 7020 416e 676c  print(f"Dip Angl
+000092c0: 6520 2849 6e63 6c69 6e61 7469 6f6e 293a  e (Inclination):
+000092d0: 207b 6469 705f 616e 676c 657d 2064 6567   {dip_angle} deg
+000092e0: 7265 6573 2229 0d0a 2020 2020 2020 2020  rees")..        
+000092f0: 7072 696e 7428 6622 4469 7020 4469 7265  print(f"Dip Dire
+00009300: 6374 696f 6e20 2841 7a69 6d75 7468 293a  ction (Azimuth):
+00009310: 207b 6469 705f 6469 7265 6374 696f 6e7d   {dip_direction}
+00009320: 2064 6567 7265 6573 2229 0d0a 2020 2020   degrees")..    
+00009330: 2020 2020 0d0a 2020 2020 2020 2020 0d0a      ..        ..
+00009340: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
+00009350: 200d 0a20 2020 2020 2020 200d 0a20 2020   ..        ..   
+00009360: 2020 2020 2023 2020 2320 436c 6970 2074       #  # Clip t
+00009370: 6865 2076 616c 7565 7320 746f 2074 6865  he values to the
+00009380: 2064 6573 6972 6564 2072 616e 6765 0d0a   desired range..
+00009390: 2020 2020 2020 2020 237a 7a20 3d20 6e70          #zz = np
+000093a0: 2e63 6c69 7028 7a7a 2c20 6d69 6e5f 7261  .clip(zz, min_ra
+000093b0: 6e67 652c 206d 6178 5f72 616e 6765 290d  nge, max_range).
+000093c0: 0a20 2020 2020 2020 200d 0a20 2020 2020  .        ..     
+000093d0: 2020 207a 7a5b 7a7a 203c 206d 696e 5f72     zz[zz < min_r
+000093e0: 616e 6765 5d20 3d20 6e70 2e6e 616e 0d0a  ange] = np.nan..
+000093f0: 2020 2020 2020 2020 7a7a 5b7a 7a20 3e20          zz[zz > 
+00009400: 6d61 785f 7261 6e67 655d 203d 206e 702e  max_range] = np.
+00009410: 6e61 6e0d 0a20 2020 2020 2020 0d0a 2020  nan..       ..  
+00009420: 2020 2020 200d 0a20 2020 2020 2020 2023       ..        #
+00009430: 2023 2044 6566 696e 6520 7468 6520 6465   # Define the de
+00009440: 7369 7265 6420 7261 6e67 6520 6261 7365  sired range base
+00009450: 6420 6f6e 2079 6f75 7220 2764 6174 6127  d on your 'data'
+00009460: 0d0a 2020 2020 2020 2020 2320 6966 206c  ..        # if l
+00009470: 696d 6974 5f65 7874 656e 643d 3d46 616c  imit_extend==Fal
+00009480: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
+00009490: 0d0a 2020 2020 2020 2020 2320 2320 2320  ..        # # # 
+000094a0: 2320 4e6f 726d 616c 697a 6520 277a 7a27  # Normalize 'zz'
+000094b0: 2074 6f20 6d61 7463 6820 7468 6520 276d   to match the 'm
+000094c0: 696e 5f72 616e 6765 2720 616e 6420 276d  in_range' and 'm
+000094d0: 6178 5f72 616e 6765 2720 6f66 2027 6461  ax_range' of 'da
+000094e0: 7461 270d 0a20 2020 2020 2020 2023 207a  ta'..        # z
+000094f0: 7a20 3d20 287a 7a20 2d20 6e70 2e6e 616e  z = (zz - np.nan
+00009500: 6d69 6e28 7a7a 2929 202f 2028 6e70 2e6e  min(zz)) / (np.n
+00009510: 616e 6d61 7828 7a7a 2920 2d20 6e70 2e6e  anmax(zz) - np.n
+00009520: 616e 6d69 6e28 7a7a 2929 0d0a 2020 2020  anmin(zz))..    
+00009530: 2020 2020 2320 7a7a 203d 207a 7a20 2a20      # zz = zz * 
+00009540: 286d 6178 5f72 616e 6765 202d 206d 696e  (max_range - min
+00009550: 5f72 616e 6765 2920 2b20 6d69 6e5f 7261  _range) + min_ra
+00009560: 6e67 650d 0a20 2020 2020 2020 200d 0a20  nge..        .. 
+00009570: 2020 2020 2020 2020 2020 2020 2020 0d0a                ..
+00009580: 2020 2020 2020 2020 2320 7072 696e 7428          # print(
+00009590: 7a7a 2e73 6861 7065 290d 0a20 2020 2020  zz.shape)..     
+000095a0: 2020 2023 2070 7269 6e74 287a 7a29 0d0a     # print(zz)..
+000095b0: 2020 2020 2020 2020 7265 7475 726e 207a          return z
+000095c0: 7a2c 2061 2c20 622c 2063 2c20 6469 705f  z, a, b, c, dip_
+000095d0: 616e 676c 652c 2064 6970 5f64 6972 6563  angle, dip_direc
+000095e0: 7469 6f6e 0d0a 2020 2020 0d0a 2020 200d  tion..    ..   .
+000095f0: 0a20 2020 0d0a 2020 200d 0a0d 0a20 2020  .   ..   ....   
+00009600: 2064 6566 206f 6e63 6c69 636b 2865 7665   def onclick(eve
+00009610: 6e74 2c20 706f 696e 7473 2c20 6461 7461  nt, points, data
+00009620: 2c20 7472 616e 7366 6f72 6d29 3a0d 0a20  , transform):.. 
+00009630: 2020 2020 2020 2078 2c20 7920 3d20 6576         x, y = ev
+00009640: 656e 742e 7864 6174 612c 2065 7665 6e74  ent.xdata, event
+00009650: 2e79 6461 7461 0d0a 2020 2020 2020 2020  .ydata..        
+00009660: 636f 6c20 3d20 696e 7428 2878 202d 2074  col = int((x - t
+00009670: 7261 6e73 666f 726d 5b30 5d29 202f 2074  ransform[0]) / t
+00009680: 7261 6e73 666f 726d 5b31 5d29 0d0a 2020  ransform[1])..  
+00009690: 2020 2020 2020 726f 7720 3d20 696e 7428        row = int(
+000096a0: 2879 202d 2074 7261 6e73 666f 726d 5b33  (y - transform[3
+000096b0: 5d29 202f 2074 7261 6e73 666f 726d 5b35  ]) / transform[5
+000096c0: 5d29 0d0a 0d0a 2020 2020 2020 2020 6966  ])....        if
+000096d0: 2030 203c 3d20 636f 6c20 3c20 6461 7461   0 <= col < data
+000096e0: 2e73 6861 7065 5b31 5d20 616e 6420 3020  .shape[1] and 0 
+000096f0: 3c3d 2072 6f77 203c 2064 6174 612e 7368  <= row < data.sh
+00009700: 6170 655b 305d 3a0d 0a20 2020 2020 2020  ape[0]:..       
+00009710: 2020 2020 207a 203d 2064 6174 615b 726f       z = data[ro
+00009720: 772c 2063 6f6c 5d0d 0a20 2020 2020 2020  w, col]..       
+00009730: 2020 2020 2070 6f69 6e74 732e 6170 7065       points.appe
+00009740: 6e64 285b 782c 2079 2c20 7a5d 290d 0a20  nd([x, y, z]).. 
+00009750: 2020 2020 2020 2020 2020 2061 785f 3264             ax_2d
+00009760: 2e70 6c6f 7428 782c 2079 2c20 276f 272c  .plot(x, y, 'o',
+00009770: 2063 6f6c 6f72 3d27 626c 6163 6b27 290d   color='black').
+00009780: 0a20 2020 2020 2020 2020 2020 2063 616e  .            can
+00009790: 7661 735f 3264 2e64 7261 7728 290d 0a0d  vas_2d.draw()...
+000097a0: 0a20 2020 2020 2020 2020 2020 2070 6f69  .            poi
+000097b0: 6e74 5f73 7472 203d 2066 2278 3d7b 783a  nt_str = f"x={x:
+000097c0: 2e32 667d 2c20 793d 7b79 3a2e 3266 7d2c  .2f}, y={y:.2f},
+000097d0: 207a 3d7b 7a3a 2e32 667d 220d 0a20 2020   z={z:.2f}"..   
+000097e0: 2020 2020 2020 2020 2070 6f69 6e74 735f           points_
+000097f0: 6c69 7374 626f 782e 696e 7365 7274 2874  listbox.insert(t
+00009800: 6b2e 454e 442c 2070 6f69 6e74 5f73 7472  k.END, point_str
+00009810: 290d 0a0d 0a20 2020 2064 6566 206f 6e5f  )....    def on_
+00009820: 706f 696e 745f 646f 7562 6c65 5f63 6c69  point_double_cli
+00009830: 636b 2865 7665 6e74 293a 0d0a 2020 2020  ck(event):..    
+00009840: 2020 2020 676c 6f62 616c 2070 6f69 6e74      global point
+00009850: 732c 2061 785f 3264 2c20 706f 696e 7473  s, ax_2d, points
+00009860: 5f6c 6973 7462 6f78 2c20 6873 0d0a 2020  _listbox, hs..  
+00009870: 2020 2020 2020 6964 7820 3d20 706f 696e        idx = poin
+00009880: 7473 5f6c 6973 7462 6f78 2e63 7572 7365  ts_listbox.curse
+00009890: 6c65 6374 696f 6e28 295b 305d 2020 2320  lection()[0]  # 
+000098a0: 496e 6465 7820 6f66 2073 656c 6563 7465  Index of selecte
+000098b0: 6420 706f 696e 7420 696e 2074 6865 206c  d point in the l
+000098c0: 6973 7462 6f78 0d0a 2020 2020 2020 2020  istbox..        
+000098d0: 706f 696e 7420 3d20 706f 696e 7473 5b69  point = points[i
+000098e0: 6478 5d0d 0a20 2020 2020 2020 200d 0a20  dx]..        .. 
+000098f0: 2020 2020 2020 2023 2052 656d 6f76 6520         # Remove 
+00009900: 7468 6520 706f 696e 7420 6672 6f6d 206f  the point from o
+00009910: 7572 2064 6174 610d 0a20 2020 2020 2020  ur data..       
+00009920: 2070 6f69 6e74 732e 706f 7028 6964 7829   points.pop(idx)
+00009930: 0d0a 2020 2020 2020 2020 706f 696e 7473  ..        points
+00009940: 5f6c 6973 7462 6f78 2e64 656c 6574 6528  _listbox.delete(
+00009950: 6964 7829 0d0a 0d0a 2020 2020 2020 2020  idx)....        
+00009960: 2320 4964 656e 7469 6679 2061 6e64 2072  # Identify and r
+00009970: 656d 6f76 6520 7468 6520 636f 7272 6573  emove the corres
+00009980: 706f 6e64 696e 6720 706f 696e 7420 6672  ponding point fr
+00009990: 6f6d 2074 6865 2061 785f 3264 2070 6c6f  om the ax_2d plo
+000099a0: 740d 0a20 2020 2020 2020 2066 6f72 206c  t..        for l
+000099b0: 696e 6520 696e 2061 785f 3264 2e6c 696e  ine in ax_2d.lin
+000099c0: 6573 3a0d 0a20 2020 2020 2020 2020 2020  es:..           
+000099d0: 2078 6461 7461 2c20 7964 6174 6120 3d20   xdata, ydata = 
+000099e0: 6c69 6e65 2e67 6574 5f78 6461 7461 2829  line.get_xdata()
+000099f0: 2c20 6c69 6e65 2e67 6574 5f79 6461 7461  , line.get_ydata
+00009a00: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
+00009a10: 6966 2078 6461 7461 5b30 5d20 3d3d 2070  if xdata[0] == p
+00009a20: 6f69 6e74 5b30 5d20 616e 6420 7964 6174  oint[0] and ydat
+00009a30: 615b 305d 203d 3d20 706f 696e 745b 315d  a[0] == point[1]
+00009a40: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00009a50: 2020 206c 696e 652e 7265 6d6f 7665 2829     line.remove()
+00009a60: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00009a70: 2020 6272 6561 6b0d 0a0d 0a20 2020 2020    break....     
+00009a80: 2020 2063 616e 7661 735f 3264 2e64 7261     canvas_2d.dra
+00009a90: 7728 290d 0a20 2020 2020 2020 200d 0a20  w()..        .. 
+00009aa0: 2020 2020 2020 200d 0a20 2020 200d 0a20         ..    .. 
+00009ab0: 2020 200d 0a20 2020 2064 6566 2070 6c6f     ..    def plo
+00009ac0: 745f 706c 616e 6573 2864 6970 5f6c 6973  t_planes(dip_lis
+00009ad0: 742c 2061 7a69 6d75 7468 5f6c 6973 742c  t, azimuth_list,
+00009ae0: 2072 6762 5f63 6f6c 6f72 732c 206f 7574   rgb_colors, out
+00009af0: 5f70 6c61 6e65 466f 6c64 6572 3d6f 7574  _planeFolder=out
+00009b00: 5f70 6c61 6e65 466f 6c64 6572 293a 0d0a  _planeFolder):..
+00009b10: 2020 2020 2020 2020 2366 726f 6d20 6d70          #from mp
+00009b20: 6c73 7465 7265 6f6e 6574 2069 6d70 6f72  lstereonet impor
+00009b30: 7420 5374 6572 656f 6e65 7441 7865 730d  t StereonetAxes.
+00009b40: 0a20 2020 2020 2020 2020 2320 4372 6561  .         # Crea
+00009b50: 7465 2061 2073 7465 7265 6f20 6e65 7420  te a stereo net 
+00009b60: 706c 6f74 0d0a 2020 2020 2020 2020 6669  plot..        fi
+00009b70: 6720 3d20 706c 742e 6669 6775 7265 2866  g = plt.figure(f
+00009b80: 6967 7369 7a65 3d28 3130 2c20 3130 292c  igsize=(10, 10),
+00009b90: 2064 7069 3d33 3030 290d 0a20 2020 2020   dpi=300)..     
+00009ba0: 2020 2023 6178 203d 2066 6967 2e61 6464     #ax = fig.add
+00009bb0: 5f73 7562 706c 6f74 2831 3231 2c20 7072  _subplot(121, pr
+00009bc0: 6f6a 6563 7469 6f6e 3d27 7374 6572 656f  ojection='stereo
+00009bd0: 6e65 7427 290d 0a20 2020 2020 2020 2061  net')..        a
+00009be0: 783d 6669 672e 6164 645f 7375 6270 6c6f  x=fig.add_subplo
+00009bf0: 7428 3132 312c 2070 6f6c 6172 3d54 7275  t(121, polar=Tru
+00009c00: 6529 0d0a 0d0a 2020 2020 2020 2020 666f  e)....        fo
+00009c10: 7220 6469 705f 616e 676c 6573 2c20 6469  r dip_angles, di
+00009c20: 705f 6469 7265 6374 696f 6e73 2c20 636f  p_directions, co
+00009c30: 6c6f 7220 696e 207a 6970 2864 6970 5f6c  lor in zip(dip_l
+00009c40: 6973 742c 2061 7a69 6d75 7468 5f6c 6973  ist, azimuth_lis
+00009c50: 742c 2072 6762 5f63 6f6c 6f72 7329 3a0d  t, rgb_colors):.
+00009c60: 0a20 2020 2020 2020 2020 2020 2023 2043  .            # C
+00009c70: 6f6e 7665 7274 2064 6970 2064 6972 6563  onvert dip direc
+00009c80: 7469 6f6e 7320 616e 6420 6469 7020 616e  tions and dip an
+00009c90: 676c 6573 2074 6f20 7261 6469 616e 730d  gles to radians.
+00009ca0: 0a20 2020 2020 2020 2020 2020 2023 6469  .            #di
+00009cb0: 705f 6469 7265 6374 696f 6e73 203d 2028  p_directions = (
+00009cc0: 6469 705f 6469 7265 6374 696f 6e73 202b  dip_directions +
+00009cd0: 2039 3029 2025 2033 3630 2023 636f 6e76   90) % 360 #conv
+00009ce0: 6572 7465 6420 6469 7020 6469 7265 6374  erted dip direct
+00009cf0: 696f 6e20 746f 2073 7472 696b 650d 0a20  ion to strike.. 
+00009d00: 2020 2020 2020 2020 2020 2064 6970 5f61             dip_a
+00009d10: 6e67 6c65 7320 3d20 2839 3020 2d20 6e70  ngles = (90 - np
+00009d20: 2e61 7272 6179 2864 6970 5f61 6e67 6c65  .array(dip_angle
+00009d30: 7329 2920 2023 2043 6f6e 7665 7274 2064  s))  # Convert d
+00009d40: 6970 2061 6e67 6c65 7320 746f 2063 6f6d  ip angles to com
+00009d50: 706c 656d 656e 7461 7279 2061 6e67 6c65  plementary angle
+00009d60: 730d 0a20 2020 2020 2020 2020 2020 2020  s..             
+00009d70: 2320 436f 6e76 6572 7420 6469 7020 617a  # Convert dip az
+00009d80: 696d 7574 6873 2074 6f20 7261 6469 616e  imuths to radian
+00009d90: 730d 0a20 2020 2020 2020 2020 2020 2064  s..            d
+00009da0: 6970 5f61 7a69 6d75 7468 735f 7261 6420  ip_azimuths_rad 
+00009db0: 3d20 6e70 2e72 6164 6961 6e73 2864 6970  = np.radians(dip
+00009dc0: 5f64 6972 6563 7469 6f6e 7329 0d0a 2020  _directions)..  
+00009dd0: 2020 2020 2020 2020 2020 2320 506c 6f74            # Plot
+00009de0: 2074 6865 2070 6f6c 6573 206f 6620 706c   the poles of pl
+00009df0: 616e 6573 2061 7320 646f 7473 0d0a 2020  anes as dots..  
+00009e00: 2020 2020 2020 2020 2020 6178 2e73 6361            ax.sca
+00009e10: 7474 6572 2864 6970 5f61 7a69 6d75 7468  tter(dip_azimuth
+00009e20: 735f 7261 642c 2064 6970 5f61 6e67 6c65  s_rad, dip_angle
+00009e30: 732c 2063 6f6c 6f72 3d63 6f6c 6f72 2920  s, color=color) 
+00009e40: 2020 0d0a 0d0a 2020 2020 2020 2020 6178    ....        ax
+00009e50: 2e67 7269 6428 5472 7565 290d 0a20 2020  .grid(True)..   
+00009e60: 2020 2020 2061 782e 7365 745f 7468 6574       ax.set_thet
+00009e70: 615f 7a65 726f 5f6c 6f63 6174 696f 6e28  a_zero_location(
+00009e80: 274e 2729 2020 2320 5365 7420 3020 6465  'N')  # Set 0 de
+00009e90: 6772 6565 7320 6174 2074 6865 2074 6f70  grees at the top
+00009ea0: 0d0a 2020 2020 2020 2020 6178 2e73 6574  ..        ax.set
+00009eb0: 5f74 6865 7461 5f64 6972 6563 7469 6f6e  _theta_direction
+00009ec0: 282d 3129 2020 2320 5265 7665 7273 6520  (-1)  # Reverse 
+00009ed0: 7468 6520 6469 7265 6374 696f 6e20 6f66  the direction of
+00009ee0: 2074 6865 2061 6e67 6c65 730d 0a0d 0a20   the angles.... 
+00009ef0: 2020 2020 2020 2023 2053 6574 206c 6162         # Set lab
+00009f00: 656c 7320 666f 7220 6361 7264 696e 616c  els for cardinal
+00009f10: 2064 6972 6563 7469 6f6e 730d 0a20 2020   directions..   
+00009f20: 2020 2020 2061 782e 7365 745f 7874 6963       ax.set_xtic
+00009f30: 6b73 286e 702e 7261 6469 616e 7328 5b30  ks(np.radians([0
+00009f40: 2c20 3435 2c20 3930 2c20 3133 352c 2031  , 45, 90, 135, 1
+00009f50: 3830 2c20 3232 352c 2032 3730 2c20 3331  80, 225, 270, 31
+00009f60: 355d 2929 0d0a 2020 2020 2020 2020 6178  5]))..        ax
+00009f70: 2e73 6574 5f78 7469 636b 6c61 6265 6c73  .set_xticklabels
+00009f80: 285b 274e 272c 2027 4e45 272c 2027 4527  (['N', 'NE', 'E'
+00009f90: 2c20 2753 4527 2c20 2753 272c 2027 5357  , 'SE', 'S', 'SW
+00009fa0: 272c 2027 5727 2c20 274e 5727 5d29 0d0a  ', 'W', 'NW'])..
+00009fb0: 0d0a 2020 2020 2020 2020 2320 5365 7420  ..        # Set 
+00009fc0: 7468 6520 7261 6469 616c 2067 7269 6420  the radial grid 
+00009fd0: 616e 6420 6c61 6265 6c73 0d0a 2020 2020  and labels..    
+00009fe0: 2020 2020 6178 2e73 6574 5f72 6c61 6265      ax.set_rlabe
+00009ff0: 6c5f 706f 7369 7469 6f6e 2839 3029 0d0a  l_position(90)..
+0000a000: 2020 2020 2020 2020 6178 2e73 6574 5f79          ax.set_y
+0000a010: 7469 636b 7328 5b31 352c 2033 302c 2034  ticks([15, 30, 4
+0000a020: 352c 2036 302c 2037 355d 290d 0a20 2020  5, 60, 75])..   
+0000a030: 2020 2020 2061 782e 7365 745f 726d 6178       ax.set_rmax
+0000a040: 2839 3029 2020 2320 5365 7420 7468 6520  (90)  # Set the 
+0000a050: 6d61 7869 6d75 6d20 7261 6469 616c 2064  maximum radial d
+0000a060: 6973 7461 6e63 650d 0a20 2020 2020 2020  istance..       
+0000a070: 2061 782e 7365 745f 7469 746c 6528 2250   ax.set_title("P
+0000a080: 6f6c 6573 2074 6f20 506c 616e 6573 2229  oles to Planes")
+0000a090: 0d0a 2020 2020 2020 2020 2320 4375 7374  ..        # Cust
+0000a0a0: 6f6d 697a 6520 7469 636b 206d 6172 6b73  omize tick marks
+0000a0b0: 202d 2073 7065 6369 6679 2061 6e67 6c65   - specify angle
+0000a0c0: 7320 696e 2072 6164 6961 6e73 0d0a 2020  s in radians..  
+0000a0d0: 2020 2020 2020 2320 6178 2e73 6574 5f78        # ax.set_x
+0000a0e0: 7469 636b 7328 6e70 2e72 6164 6961 6e73  ticks(np.radians
+0000a0f0: 2872 616e 6765 2830 2c20 3336 302c 2031  (range(0, 360, 1
+0000a100: 3029 2929 2020 2320 3130 2d64 6567 7265  0)))  # 10-degre
+0000a110: 6520 696e 7465 7276 616c 730d 0a20 2020  e intervals..   
+0000a120: 2020 2020 2023 2061 782e 7365 745f 7974       # ax.set_yt
+0000a130: 6963 6b73 286e 702e 7261 6469 616e 7328  icks(np.radians(
+0000a140: 7261 6e67 6528 2d39 302c 2039 302c 2031  range(-90, 90, 1
+0000a150: 3029 2929 0d0a 0d0a 2020 2020 2020 2020  0)))....        
+0000a160: 7374 7269 6b65 733d 5b5d 0d0a 2020 2020  strikes=[]..    
+0000a170: 2020 2020 616c 6c5f 636f 6c6f 7273 3d5b      all_colors=[
+0000a180: 5d0d 0a20 2020 2020 2020 2066 6f72 2064  ]..        for d
+0000a190: 6970 5f61 6e67 6c65 732c 2064 6970 5f64  ip_angles, dip_d
+0000a1a0: 6972 6563 7469 6f6e 732c 2063 6f6c 6f72  irections, color
+0000a1b0: 2069 6e20 7a69 7028 6469 705f 6c69 7374   in zip(dip_list
+0000a1c0: 2c20 617a 696d 7574 685f 6c69 7374 2c20  , azimuth_list, 
+0000a1d0: 7267 625f 636f 6c6f 7273 293a 0d0a 2020  rgb_colors):..  
+0000a1e0: 2020 2020 2020 2020 2020 6469 705f 617a            dip_az
+0000a1f0: 696d 7574 6873 5f72 6164 203d 206e 702e  imuths_rad = np.
+0000a200: 7261 6469 616e 7328 6469 705f 6469 7265  radians(dip_dire
+0000a210: 6374 696f 6e73 290d 0a20 2020 2020 2020  ctions)..       
+0000a220: 2020 2020 2023 6469 705f 6469 7265 6374       #dip_direct
+0000a230: 696f 6e73 203d 2028 6469 705f 6469 7265  ions = (dip_dire
+0000a240: 6374 696f 6e73 202b 2039 3029 2025 2033  ctions + 90) % 3
+0000a250: 3630 0d0a 2020 2020 2020 2020 2020 2020  60..            
+0000a260: 6469 705f 616e 676c 6573 203d 2028 3930  dip_angles = (90
+0000a270: 202d 206e 702e 6172 7261 7928 6469 705f   - np.array(dip_
+0000a280: 616e 676c 6573 2929 2020 2320 436f 6e76  angles))  # Conv
+0000a290: 6572 7420 6469 7020 616e 676c 6573 2074  ert dip angles t
+0000a2a0: 6f20 636f 6d70 6c65 6d65 6e74 6172 7920  o complementary 
+0000a2b0: 616e 676c 6573 0d0a 2020 2020 2020 2020  angles..        
+0000a2c0: 2020 2020 7374 7269 6b65 732e 6170 7065      strikes.appe
+0000a2d0: 6e64 2828 6469 705f 617a 696d 7574 6873  nd((dip_azimuths
+0000a2e0: 5f72 6164 202b 2039 3029 2025 2033 3630  _rad + 90) % 360
+0000a2f0: 290d 0a20 2020 2020 2020 2020 2020 2061  )..            a
+0000a300: 6c6c 5f63 6f6c 6f72 732e 6170 7065 6e64  ll_colors.append
+0000a310: 2863 6f6c 6f72 290d 0a20 2020 2020 2020  (color)..       
+0000a320: 200d 0a0d 0a20 2020 2020 2020 2020 2320   ....         # 
+0000a330: 4361 6c63 756c 6174 6520 7468 6520 6e75  Calculate the nu
+0000a340: 6d62 6572 206f 6620 6269 6e73 2075 7369  mber of bins usi
+0000a350: 6e67 2053 636f 7474 2773 2052 756c 650d  ng Scott's Rule.
+0000a360: 0a20 2020 2020 2020 206e 203d 206c 656e  .        n = len
+0000a370: 2873 7472 696b 6573 290d 0a0d 0a20 2020  (strikes)....   
+0000a380: 2020 2020 2023 2043 616c 6375 6c61 7465       # Calculate
+0000a390: 2074 6865 2073 7461 6e64 6172 6420 6465   the standard de
+0000a3a0: 7669 6174 696f 6e20 6f66 2074 6865 2064  viation of the d
+0000a3b0: 6174 610d 0a20 2020 2020 2020 2073 7464  ata..        std
+0000a3c0: 5f64 6576 203d 206e 702e 7374 6428 7374  _dev = np.std(st
+0000a3d0: 7269 6b65 7329 0d0a 0d0a 2020 2020 2020  rikes)....      
+0000a3e0: 2020 2320 4361 6c63 756c 6174 6520 7468    # Calculate th
+0000a3f0: 6520 6269 6e20 7769 6474 6820 7573 696e  e bin width usin
+0000a400: 6720 5363 6f74 7427 7320 5275 6c65 2066  g Scott's Rule f
+0000a410: 6f72 6d75 6c61 2c20 656e 7375 7269 6e67  ormula, ensuring
+0000a420: 2069 7427 7320 6e6f 7420 7a65 726f 0d0a   it's not zero..
+0000a430: 2020 2020 2020 2020 6966 2073 7464 5f64          if std_d
+0000a440: 6576 2021 3d20 303a 0d0a 2020 2020 2020  ev != 0:..      
+0000a450: 2020 2020 2020 6269 6e5f 7769 6474 6820        bin_width 
+0000a460: 3d20 302e 3520 2a20 7374 645f 6465 7620  = 0.5 * std_dev 
+0000a470: 2f20 286e 2a2a 2831 2f33 2929 2020 2320  / (n**(1/3))  # 
+0000a480: 5363 6f74 7427 7320 5275 6c65 2066 6f72  Scott's Rule for
+0000a490: 6d75 6c61 0d0a 2020 2020 2020 2020 2020  mula..          
+0000a4a0: 2020 6e75 6d5f 6269 6e73 203d 206d 6178    num_bins = max
+0000a4b0: 2869 6e74 2828 6d61 7828 7374 7269 6b65  (int((max(strike
+0000a4c0: 7329 202d 206d 696e 2873 7472 696b 6573  s) - min(strikes
+0000a4d0: 2929 202f 2062 696e 5f77 6964 7468 292c  )) / bin_width),
+0000a4e0: 2031 2920 2023 2045 6e73 7572 6520 6e75   1)  # Ensure nu
+0000a4f0: 6d5f 6269 6e73 2069 7320 6174 206c 6561  m_bins is at lea
+0000a500: 7374 2031 0d0a 2020 2020 2020 2020 656c  st 1..        el
+0000a510: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
+0000a520: 206e 756d 5f62 696e 7320 3d20 3132 2020   num_bins = 12  
+0000a530: 2320 4120 6465 6661 756c 7420 6e75 6d62  # A default numb
+0000a540: 6572 206f 6620 6269 6e73 2069 6620 7374  er of bins if st
+0000a550: 645f 6465 7620 6973 207a 6572 6f0d 0a20  d_dev is zero.. 
+0000a560: 2020 2020 2020 2023 2043 7265 6174 6520         # Create 
+0000a570: 6120 726f 7365 2064 6961 6772 616d 2028  a rose diagram (
+0000a580: 6369 7263 756c 6172 2068 6973 746f 6772  circular histogr
+0000a590: 616d 290d 0a20 2020 2020 2020 2061 785f  am)..        ax_
+0000a5a0: 726f 7365 203d 2066 6967 2e61 6464 5f73  rose = fig.add_s
+0000a5b0: 7562 706c 6f74 2831 3232 2c20 706f 6c61  ubplot(122, pola
+0000a5c0: 723d 5472 7565 290d 0a0d 0a20 2020 2020  r=True)....     
+0000a5d0: 2020 2066 6f72 2064 6970 2c20 7374 7269     for dip, stri
+0000a5e0: 6b65 2c20 636f 6c6f 722c 2061 7a20 696e  ke, color, az in
+0000a5f0: 207a 6970 2864 6970 5f6c 6973 742c 2073   zip(dip_list, s
+0000a600: 7472 696b 6573 2c20 616c 6c5f 636f 6c6f  trikes, all_colo
+0000a610: 7273 2c20 617a 696d 7574 685f 6c69 7374  rs, azimuth_list
+0000a620: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+0000a630: 2320 436f 6e76 6572 7420 6469 7020 617a  # Convert dip az
+0000a640: 696d 7574 6873 2074 6f20 7261 6469 616e  imuths to radian
+0000a650: 730d 0a20 2020 2020 2020 2020 2020 2064  s..            d
+0000a660: 6970 5f61 7a69 6d75 7468 735f 7261 6420  ip_azimuths_rad 
+0000a670: 3d20 6e70 2e72 6164 6961 6e73 2861 7a29  = np.radians(az)
+0000a680: 0d0a 2020 2020 2020 2020 2020 2020 6469  ..            di
+0000a690: 705f 616e 676c 6573 203d 2028 3930 202d  p_angles = (90 -
+0000a6a0: 206e 702e 6172 7261 7928 6469 705f 616e   np.array(dip_an
+0000a6b0: 676c 6573 2929 2020 2320 436f 6e76 6572  gles))  # Conver
+0000a6c0: 7420 6469 7020 616e 676c 6573 2074 6f20  t dip angles to 
+0000a6d0: 636f 6d70 6c65 6d65 6e74 6172 7920 616e  complementary an
+0000a6e0: 676c 6573 0d0a 2020 2020 2020 2020 2020  gles..          
+0000a6f0: 2020 0d0a 2020 2020 2020 2020 2020 2020    ..            
+0000a700: 2320 506c 6f74 2064 6970 2061 6e67 6c65  # Plot dip angle
+0000a710: 7320 6173 2072 6164 6969 2061 6e64 2064  s as radii and d
+0000a720: 6970 2061 7a69 6d75 7468 7320 6173 2061  ip azimuths as a
+0000a730: 6e67 6c65 730d 0a20 2020 2020 2020 2020  ngles..         
+0000a740: 2020 2023 6178 5f72 6f73 652e 7363 6174     #ax_rose.scat
+0000a750: 7465 7228 6469 705f 617a 696d 7574 6873  ter(dip_azimuths
+0000a760: 5f72 6164 2c20 6469 705f 616e 676c 6573  _rad, dip_angles
+0000a770: 2c20 633d 636f 6c6f 722c 2061 6c70 6861  , c=color, alpha
+0000a780: 3d30 2e35 290d 0a20 2020 2020 2020 2020  =0.5)..         
+0000a790: 2020 2023 2050 6c6f 7420 7468 6520 6f72     # Plot the or
+0000a7a0: 6965 6e74 6174 696f 6e20 6461 7461 2061  ientation data a
+0000a7b0: 7320 6120 726f 7365 2064 6961 6772 616d  s a rose diagram
+0000a7c0: 0d0a 2020 2020 2020 2020 2020 2020 6e2c  ..            n,
+0000a7d0: 2062 696e 732c 2070 6174 6368 6573 3d61   bins, patches=a
+0000a7e0: 785f 726f 7365 2e68 6973 7428 7374 7269  x_rose.hist(stri
+0000a7f0: 6b65 2c20 6269 6e73 3d6e 756d 5f62 696e  ke, bins=num_bin
+0000a800: 732c 2063 6f6c 6f72 3d63 6f6c 6f72 2c20  s, color=color, 
+0000a810: 616c 7068 613d 302e 3529 0d0a 2020 2020  alpha=0.5)..    
+0000a820: 2020 2020 2020 2020 2023 2041 6e6e 6f74           # Annot
+0000a830: 6174 6520 7468 6520 6e75 6d62 6572 206f  ate the number o
+0000a840: 6620 6461 7461 2070 6f69 6e74 7320 616e  f data points an
+0000a850: 6420 6269 6e20 6e75 6d62 6572 0d0a 2020  d bin number..  
+0000a860: 2020 2020 2020 2020 2020 6178 5f72 6f73            ax_ros
+0000a870: 652e 7465 7874 2830 2c20 2d30 2e31 2c20  e.text(0, -0.1, 
+0000a880: 6622 4461 7461 2050 6f69 6e74 733a 207b  f"Data Points: {
+0000a890: 6c65 6e28 7374 7269 6b65 7329 7d22 2c20  len(strikes)}", 
+0000a8a0: 6861 3d27 6365 6e74 6572 272c 2076 613d  ha='center', va=
+0000a8b0: 2763 656e 7465 7227 2c20 7472 616e 7366  'center', transf
+0000a8c0: 6f72 6d3d 6178 5f72 6f73 652e 7472 616e  orm=ax_rose.tran
+0000a8d0: 7341 7865 7329 0d0a 2020 2020 2020 2020  sAxes)..        
+0000a8e0: 2020 2020 6178 5f72 6f73 652e 7465 7874      ax_rose.text
+0000a8f0: 2830 2c20 2d30 2e31 352c 2066 2242 696e  (0, -0.15, f"Bin
+0000a900: 2043 6f75 6e74 3a20 7b6e 756d 5f62 696e   Count: {num_bin
+0000a910: 737d 222c 2068 613d 2763 656e 7465 7227  s}", ha='center'
+0000a920: 2c20 7661 3d27 6365 6e74 6572 272c 2074  , va='center', t
+0000a930: 7261 6e73 666f 726d 3d61 785f 726f 7365  ransform=ax_rose
+0000a940: 2e74 7261 6e73 4178 6573 290d 0a0d 0a20  .transAxes).... 
+0000a950: 2020 2020 2020 2023 2023 2043 7573 746f         # # Custo
+0000a960: 6d69 7a65 2074 6865 2072 6f73 6520 6469  mize the rose di
+0000a970: 6167 7261 6d0d 0a20 2020 2020 2020 2023  agram..        #
+0000a980: 2061 785f 726f 7365 2e73 6574 5f74 6865   ax_rose.set_the
+0000a990: 7461 5f7a 6572 6f5f 6c6f 6361 7469 6f6e  ta_zero_location
+0000a9a0: 2822 4e22 290d 0a20 2020 2020 2020 2023  ("N")..        #
+0000a9b0: 2061 785f 726f 7365 2e73 6574 5f74 6865   ax_rose.set_the
+0000a9c0: 7461 5f64 6972 6563 7469 6f6e 282d 3129  ta_direction(-1)
+0000a9d0: 0d0a 2020 2020 2020 2020 2320 4375 7374  ..        # Cust
+0000a9e0: 6f6d 697a 6520 7468 6520 706f 6c61 7220  omize the polar 
+0000a9f0: 706c 6f74 0d0a 2020 2020 2020 2020 6178  plot..        ax
+0000aa00: 5f72 6f73 652e 7365 745f 7468 6574 615f  _rose.set_theta_
+0000aa10: 7a65 726f 5f6c 6f63 6174 696f 6e28 274e  zero_location('N
+0000aa20: 2729 2020 2320 5365 7420 3020 6465 6772  ')  # Set 0 degr
+0000aa30: 6565 7320 6174 2074 6865 2074 6f70 0d0a  ees at the top..
+0000aa40: 2020 2020 2020 2020 6178 5f72 6f73 652e          ax_rose.
+0000aa50: 7365 745f 7468 6574 615f 6469 7265 6374  set_theta_direct
+0000aa60: 696f 6e28 2d31 2920 2023 2052 6576 6572  ion(-1)  # Rever
+0000aa70: 7365 2074 6865 2064 6972 6563 7469 6f6e  se the direction
+0000aa80: 206f 6620 7468 6520 616e 676c 6573 0d0a   of the angles..
+0000aa90: 0d0a 2020 2020 2020 2020 2320 5365 7420  ..        # Set 
+0000aaa0: 6c61 6265 6c73 2066 6f72 2063 6172 6469  labels for cardi
+0000aab0: 6e61 6c20 6469 7265 6374 696f 6e73 0d0a  nal directions..
+0000aac0: 2020 2020 2020 2020 6178 5f72 6f73 652e          ax_rose.
+0000aad0: 7365 745f 7874 6963 6b73 286e 702e 7261  set_xticks(np.ra
+0000aae0: 6469 616e 7328 5b30 2c20 3435 2c20 3930  dians([0, 45, 90
+0000aaf0: 2c20 3133 352c 2031 3830 2c20 3232 352c  , 135, 180, 225,
+0000ab00: 2032 3730 2c20 3331 355d 2929 0d0a 2020   270, 315]))..  
+0000ab10: 2020 2020 2020 6178 5f72 6f73 652e 7365        ax_rose.se
+0000ab20: 745f 7874 6963 6b6c 6162 656c 7328 5b27  t_xticklabels(['
+0000ab30: 4e27 2c20 274e 4527 2c20 2745 272c 2027  N', 'NE', 'E', '
+0000ab40: 5345 272c 2027 5327 2c20 2753 5727 2c20  SE', 'S', 'SW', 
+0000ab50: 2757 272c 2027 4e57 275d 290d 0a20 2020  'W', 'NW'])..   
+0000ab60: 2020 2020 0d0a 0d0a 2020 2020 2020 2020      ....        
+0000ab70: 2320 5365 7420 7468 6520 7261 6469 616c  # Set the radial
+0000ab80: 2067 7269 6420 616e 6420 6c61 6265 6c73   grid and labels
+0000ab90: 0d0a 2020 2020 2020 2020 2320 6178 5f72  ..        # ax_r
+0000aba0: 6f73 652e 7365 745f 726c 6162 656c 5f70  ose.set_rlabel_p
+0000abb0: 6f73 6974 696f 6e28 3930 290d 0a20 2020  osition(90)..   
+0000abc0: 2020 2020 2023 2061 785f 726f 7365 2e73       # ax_rose.s
+0000abd0: 6574 5f79 7469 636b 7328 5b31 352c 2033  et_yticks([15, 3
+0000abe0: 302c 2034 352c 2036 302c 2037 355d 290d  0, 45, 60, 75]).
+0000abf0: 0a20 2020 2020 2020 2023 2061 785f 726f  .        # ax_ro
+0000ac00: 7365 2e73 6574 5f72 6d61 7828 3930 2920  se.set_rmax(90) 
+0000ac10: 2023 2053 6574 2074 6865 206d 6178 696d   # Set the maxim
+0000ac20: 756d 2072 6164 6961 6c20 6469 7374 616e  um radial distan
+0000ac30: 6365 0d0a 2020 2020 2020 2020 6178 5f72  ce..        ax_r
+0000ac40: 6f73 652e 7365 745f 7469 746c 6528 2252  ose.set_title("R
+0000ac50: 6f73 6520 4469 6167 7261 6d20 5374 7269  ose Diagram Stri
+0000ac60: 6b65 2229 0d0a 0d0a 2020 2020 2020 2020  ke")....        
+0000ac70: 2320 4164 6a75 7374 2073 7061 6369 6e67  # Adjust spacing
+0000ac80: 2062 6574 7765 656e 2073 7562 706c 6f74   between subplot
+0000ac90: 730d 0a20 2020 2020 2020 2070 6c74 2e73  s..        plt.s
+0000aca0: 7562 706c 6f74 735f 6164 6a75 7374 2877  ubplots_adjust(w
+0000acb0: 7370 6163 653d 302e 3229 0d0a 0d0a 2020  space=0.2)....  
+0000acc0: 2020 2020 2020 706c 742e 7361 7665 6669        plt.savefi
+0000acd0: 6728 6f75 745f 706c 616e 6546 6f6c 6465  g(out_planeFolde
+0000ace0: 7220 2b20 222f 2220 2b20 2273 7465 7265  r + "/" + "stere
+0000acf0: 6f70 6c6f 742e 706e 6722 2c20 6470 693d  oplot.png", dpi=
+0000ad00: 3330 3029 0d0a 2020 2020 2020 2020 706c  300)..        pl
+0000ad10: 742e 7469 6768 745f 6c61 796f 7574 0d0a  t.tight_layout..
+0000ad20: 2020 2020 2020 2020 2370 6c74 2e63 6c6f          #plt.clo
+0000ad30: 7365 2829 0d0a 2020 2020 2020 2020 706c  se()..        pl
+0000ad40: 742e 636c 6f73 6528 290d 0a20 2020 2020  t.close()..     
+0000ad50: 2020 200d 0a20 2020 200d 0a20 2020 200d     ..    ..    .
+0000ad60: 0a20 2020 2020 2020 200d 0a20 2020 2064  .        ..    d
+0000ad70: 6566 2064 7261 775f 706c 616e 6528 7878  ef draw_plane(xx
+0000ad80: 2c79 7929 3a0d 0a20 2020 2020 2020 200d  ,yy):..        .
+0000ad90: 0a20 2020 2020 2020 2069 6620 6c65 6e28  .        if len(
+0000ada0: 706f 696e 7473 2920 3e3d 2033 3a0d 0a20  points) >= 3:.. 
+0000adb0: 2020 2020 2020 2020 2020 2066 6974 7465             fitte
+0000adc0: 645f 706c 616e 652c 2061 2c20 622c 2063  d_plane, a, b, c
+0000add0: 202c 2064 6970 5f61 6e67 6c65 2c20 6469   , dip_angle, di
+0000ade0: 705f 6469 7265 6374 696f 6e20 3d20 6669  p_direction = fi
+0000adf0: 745f 706c 616e 6528 706f 696e 7473 2c20  t_plane(points, 
+0000ae00: 7878 2c20 7979 290d 0a20 2020 2020 2020  xx, yy)..       
+0000ae10: 2020 2020 200d 0a20 2020 2020 2020 2020       ..         
+0000ae20: 2020 2064 6970 5f61 6e67 6c65 5f6c 6973     dip_angle_lis
+0000ae30: 742e 6170 7065 6e64 2864 6970 5f61 6e67  t.append(dip_ang
+0000ae40: 6c65 290d 0a20 2020 2020 2020 2020 2020  le)..           
+0000ae50: 2064 6970 5f64 6972 6563 7469 6f6e 5f6c   dip_direction_l
+0000ae60: 6973 742e 6170 7065 6e64 2864 6970 5f64  ist.append(dip_d
+0000ae70: 6972 6563 7469 6f6e 290d 0a20 2020 2020  irection)..     
+0000ae80: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
+0000ae90: 2020 2020 2023 2069 6620 6c69 6d69 745f       # if limit_
+0000aea0: 6578 7465 6e64 3a0d 0a20 2020 2020 2020  extend:..       
+0000aeb0: 2020 2020 2023 2020 2347 6574 2062 6f75       #  #Get bou
+0000aec0: 6e64 696e 6720 626f 7820 6f66 2074 6865  nding box of the
+0000aed0: 2073 656c 6563 7465 6420 706f 696e 7473   selected points
+0000aee0: 0d0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+0000aef0: 2020 2020 786d 696e 2c20 786d 6178 2c20      xmin, xmax, 
+0000af00: 796d 696e 2c20 796d 6178 203d 2062 6f75  ymin, ymax = bou
+0000af10: 6e64 696e 675f 626f 7828 706f 696e 7473  nding_box(points
+0000af20: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+0000af30: 2020 200d 0a20 2020 2020 2020 2020 2020     ..           
+0000af40: 2023 2020 2020 206d 6173 6b20 3d20 2878   #     mask = (x
+0000af50: 7820 3e3d 2078 6d69 6e29 2026 2028 7878  x >= xmin) & (xx
+0000af60: 203c 3d20 786d 6178 2920 2620 2879 7920   <= xmax) & (yy 
+0000af70: 3e3d 2079 6d69 6e29 2026 2028 7979 203c  >= ymin) & (yy <
+0000af80: 3d20 796d 6178 290d 0a20 2020 2020 2020  = ymax)..       
+0000af90: 2020 2020 2020 2020 200d 0a20 2020 2020           ..     
+0000afa0: 2020 2020 2020 2023 2020 2020 2066 6f72         #     for
+0000afb0: 2069 2069 6e20 7261 6e67 6528 7878 2e73   i in range(xx.s
+0000afc0: 6861 7065 5b30 5d29 3a0d 0a20 2020 2020  hape[0]):..     
+0000afd0: 2020 2020 2020 2023 2020 2020 2020 2020         #        
+0000afe0: 2066 6f72 206a 2069 6e20 7261 6e67 6528   for j in range(
+0000aff0: 7878 2e73 6861 7065 5b31 5d29 3a0d 0a20  xx.shape[1]):.. 
+0000b000: 2020 2020 2020 2020 2020 2023 2020 2020             #    
+0000b010: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+0000b020: 6d61 736b 5b69 2c20 6a5d 3a0d 0a20 2020  mask[i, j]:..   
+0000b030: 2020 2020 2020 2020 2023 2020 2020 2020           #      
+0000b040: 2020 2020 2020 2020 2020 2066 6974 7465             fitte
+0000b050: 645f 706c 616e 655b 692c 206a 5d20 3d20  d_plane[i, j] = 
+0000b060: 6e70 2e6e 616e 2020 2320 5365 7420 6f75  np.nan  # Set ou
+0000b070: 742d 6f66 2d62 6f75 6e64 7320 7661 6c75  t-of-bounds valu
+0000b080: 6573 2074 6f20 4e61 4e0d 0a20 2020 2020  es to NaN..     
+0000b090: 2020 200d 0a20 2020 2020 2020 2020 2020     ..           
+0000b0a0: 2070 6c61 6e65 732e 6170 7065 6e64 2866   planes.append(f
+0000b0b0: 6974 7465 645f 706c 616e 6529 0d0a 2020  itted_plane)..  
+0000b0c0: 2020 2020 2020 2020 2020 0d0a 2020 2020            ..    
+0000b0d0: 2020 2020 2020 2020 2370 6c61 6e65 5f63          #plane_c
+0000b0e0: 6f6c 6f72 203d 2072 616e 646f 6d5f 636f  olor = random_co
+0000b0f0: 6c6f 7228 290d 0a20 2020 2020 2020 2020  lor()..         
+0000b100: 2020 2070 6c61 6e65 5f63 6f6c 6f72 3d63     plane_color=c
+0000b110: 6f6c 6f72 5f66 726f 6d5f 6469 705f 616e  olor_from_dip_an
+0000b120: 645f 6469 7265 6374 696f 6e28 6469 705f  d_direction(dip_
+0000b130: 616e 676c 652c 2064 6970 5f64 6972 6563  angle, dip_direc
+0000b140: 7469 6f6e 290d 0a20 2020 2020 2020 2020  tion)..         
+0000b150: 2020 2070 7269 6e74 2827 706c 616e 6520     print('plane 
+0000b160: 636f 6c6f 723a 2027 2c20 706c 616e 655f  color: ', plane_
+0000b170: 636f 6c6f 7229 0d0a 2020 2020 2020 2020  color)..        
+0000b180: 2020 2020 706c 616e 655f 636f 6c6f 7273      plane_colors
+0000b190: 2e61 7070 656e 6428 706c 616e 655f 636f  .append(plane_co
+0000b1a0: 6c6f 7229 0d0a 0d0a 2020 2020 2020 2020  lor)....        
+0000b1b0: 2020 2020 666f 7220 706f 696e 7420 2069      for point  i
+0000b1c0: 6e20 706f 696e 7473 3a0d 0a20 2020 2020  n points:..     
+0000b1d0: 2020 2020 2020 2020 2020 2061 785f 3264             ax_2d
+0000b1e0: 2e70 6c6f 7428 706f 696e 745b 305d 2c20  .plot(point[0], 
+0000b1f0: 706f 696e 745b 315d 2c20 276f 272c 2063  point[1], 'o', c
+0000b200: 6f6c 6f72 3d70 6c61 6e65 5f63 6f6c 6f72  olor=plane_color
+0000b210: 202c 2061 6c70 6861 3d30 2e37 290d 0a20   , alpha=0.7).. 
+0000b220: 2020 2020 2020 2020 200d 0a20 2020 2020           ..     
+0000b230: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
+0000b240: 200d 0a20 2020 2020 2020 2020 2020 2063   ..            c
+0000b250: 616e 7661 735f 3264 2e64 7261 7728 290d  anvas_2d.draw().
+0000b260: 0a20 2020 2020 2020 2020 2020 200d 0a0d  .            ...
+0000b270: 0a20 2020 2020 2020 2020 2020 2023 6178  .            #ax
+0000b280: 5f33 642e 636c 6561 7228 290d 0a20 2020  _3d.clear()..   
+0000b290: 2020 2020 2020 2020 2061 785f 3364 2e73           ax_3d.s
+0000b2a0: 6574 5f74 6974 6c65 2827 3344 2044 454d  et_title('3D DEM
+0000b2b0: 2077 6974 6820 4669 7474 6564 2050 6c61   with Fitted Pla
+0000b2c0: 6e65 7327 290d 0a20 2020 2020 2020 2020  nes')..         
+0000b2d0: 2020 2061 785f 3364 2e70 6c6f 745f 7375     ax_3d.plot_su
+0000b2e0: 7266 6163 6528 7878 2c20 7979 2c20 6461  rface(xx, yy, da
+0000b2f0: 7461 2c20 636d 6170 3d27 7465 7272 6169  ta, cmap='terrai
+0000b300: 6e27 2c20 6c69 6e65 7769 6474 683d 302c  n', linewidth=0,
+0000b310: 2061 6e74 6961 6c69 6173 6564 3d54 7275   antialiased=Tru
+0000b320: 652c 2061 6c70 6861 3d30 2e35 290d 0a20  e, alpha=0.5).. 
+0000b330: 2020 2020 2020 2020 2020 2023 666f 7220             #for 
+0000b340: 706c 616e 6520 696e 2070 6c61 6e65 733a  plane in planes:
+0000b350: 0d0a 2020 2020 2020 2020 2020 2020 7375  ..            su
+0000b360: 7266 3d61 785f 3364 2e70 6c6f 745f 7375  rf=ax_3d.plot_su
+0000b370: 7266 6163 6528 7878 2c20 7979 2c20 6669  rface(xx, yy, fi
+0000b380: 7474 6564 5f70 6c61 6e65 2c20 616c 7068  tted_plane, alph
+0000b390: 613d 302e 362c 206c 696e 6577 6964 7468  a=0.6, linewidth
+0000b3a0: 3d30 2c20 616e 7469 616c 6961 7365 643d  =0, antialiased=
+0000b3b0: 5472 7565 2c20 636f 6c6f 723d 706c 616e  True, color=plan
+0000b3c0: 655f 636f 6c6f 7229 0d0a 2020 2020 2020  e_color)..      
+0000b3d0: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
+0000b3e0: 2020 2020 2020 2020 2370 6c6f 7420 706f          #plot po
+0000b3f0: 696e 7473 2069 6e20 3344 0d0a 2020 2020  ints in 3D..    
+0000b400: 2020 2020 2020 2020 666f 7220 706f 696e          for poin
+0000b410: 7420 696e 2070 6f69 6e74 733a 0d0a 2020  t in points:..  
+0000b420: 2020 2020 2020 2020 2020 2020 2020 6178                ax
+0000b430: 5f33 642e 706c 6f74 2870 6f69 6e74 5b30  _3d.plot(point[0
+0000b440: 5d2c 2070 6f69 6e74 5b31 5d2c 2027 6f27  ], point[1], 'o'
+0000b450: 2c20 636f 6c6f 723d 706c 616e 655f 636f  , color=plane_co
+0000b460: 6c6f 7229 0d0a 2020 2020 2020 2020 2020  lor)..          
+0000b470: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
+0000b480: 2020 2020 6361 6e76 6173 5f33 642e 6472      canvas_3d.dr
+0000b490: 6177 2829 0d0a 2020 2020 2020 2020 2020  aw()..          
+0000b4a0: 2020 0d0a 2020 2020 2020 2020 2020 2020    ..            
+0000b4b0: 0d0a 2020 2020 2020 2020 2020 2020 0d0a  ..            ..
+0000b4c0: 0d0a 2020 2020 2020 2020 2020 2020 706f  ..            po
+0000b4d0: 696e 7473 5f6c 6973 7462 6f78 2e64 656c  ints_listbox.del
+0000b4e0: 6574 6528 302c 2074 6b2e 454e 4429 0d0a  ete(0, tk.END)..
+0000b4f0: 2020 2020 2020 2020 2020 2020 706f 696e              poin
+0000b500: 7473 2e63 6c65 6172 2829 0d0a 2020 2020  ts.clear()..    
+0000b510: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
+0000b520: 2020 2020 2020 706c 6f74 5f70 6c61 6e65        plot_plane
+0000b530: 7328 6469 705f 616e 676c 655f 6c69 7374  s(dip_angle_list
+0000b540: 2c20 6469 705f 6469 7265 6374 696f 6e5f  , dip_direction_
+0000b550: 6c69 7374 2c20 706c 616e 655f 636f 6c6f  list, plane_colo
+0000b560: 7273 290d 0a20 2020 2020 2020 2020 2020  rs)..           
+0000b570: 200d 0a20 2020 2020 2020 2020 2020 2023   ..            #
+0000b580: 2041 7373 756d 696e 6720 796f 7520 6861   Assuming you ha
+0000b590: 7665 2061 2027 706c 616e 6573 2720 6c69  ve a 'planes' li
+0000b5a0: 7374 2c20 796f 7520 6361 6e20 6368 6563  st, you can chec
+0000b5b0: 6b20 6974 7320 666f 726d 6174 0d0a 2020  k its format..  
+0000b5c0: 2020 2020 2020 2020 2020 2320 666f 7220            # for 
+0000b5d0: 706c 616e 6520 696e 2070 6c61 6e65 733a  plane in planes:
+0000b5e0: 0d0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+0000b5f0: 2020 2020 7072 696e 7428 7479 7065 2870      print(type(p
+0000b600: 6c61 6e65 2929 0d0a 2020 2020 2020 2020  lane))..        
+0000b610: 2020 2020 2320 2020 2020 7072 696e 7428      #     print(
+0000b620: 6c65 6e28 706c 616e 6529 2920 2023 2054  len(plane))  # T
+0000b630: 6869 7320 7769 6c6c 2067 6976 6520 796f  his will give yo
+0000b640: 7520 7468 6520 6c65 6e67 7468 206f 7220  u the length or 
+0000b650: 6e75 6d62 6572 206f 6620 656c 656d 656e  number of elemen
+0000b660: 7473 2069 6e20 7468 6520 706c 616e 650d  ts in the plane.
+0000b670: 0a0d 0a20 2020 2020 2020 2020 2020 2023  ...            #
+0000b680: 2020 2020 2023 2049 6620 6974 2773 2061       # If it's a
+0000b690: 204e 756d 5079 2061 7272 6179 2c20 796f   NumPy array, yo
+0000b6a0: 7520 6361 6e20 7072 696e 7420 6974 7320  u can print its 
+0000b6b0: 7368 6170 6520 746f 2073 6565 2074 6865  shape to see the
+0000b6c0: 2064 696d 656e 7369 6f6e 730d 0a20 2020   dimensions..   
+0000b6d0: 2020 2020 2020 2020 2023 2020 2020 2069           #     i
+0000b6e0: 6620 6973 696e 7374 616e 6365 2870 6c61  f isinstance(pla
+0000b6f0: 6e65 2c20 6e70 2e6e 6461 7272 6179 293a  ne, np.ndarray):
+0000b700: 0d0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+0000b710: 2020 2020 2020 2020 7072 696e 7428 706c          print(pl
+0000b720: 616e 652e 7368 6170 6529 0d0a 2020 2020  ane.shape)..    
+0000b730: 2020 2020 2020 2020 2020 2020 0d0a 2020              ..  
+0000b740: 2020 2020 2020 2020 2020 2320 2020 2020            #     
+0000b750: 2320 5072 696e 7420 7468 6520 6669 7273  # Print the firs
+0000b760: 7420 656c 656d 656e 7420 2861 7373 756d  t element (assum
+0000b770: 696e 6720 6974 2773 2061 206c 6973 7420  ing it's a list 
+0000b780: 6f72 204e 756d 5079 2061 7272 6179 290d  or NumPy array).
+0000b790: 0a20 2020 2020 2020 2020 2020 2023 2020  .            #  
+0000b7a0: 2020 2070 7269 6e74 2870 6c61 6e65 5b30     print(plane[0
+0000b7b0: 5d29 0d0a 0d0a 2020 2020 2020 2020 2020  ])....          
+0000b7c0: 2020 2320 2320 5072 696e 7420 7468 6520    # # Print the 
+0000b7d0: 6c65 6e67 7468 206f 6620 7468 6520 2770  length of the 'p
+0000b7e0: 6c61 6e65 7327 206c 6973 740d 0a20 2020  lanes' list..   
+0000b7f0: 2020 2020 2020 2020 2023 2070 7269 6e74           # print
+0000b800: 286c 656e 2870 6c61 6e65 7329 290d 0a20  (len(planes)).. 
+0000b810: 2020 2020 2020 2020 2020 200d 0a20 2020             ..   
+0000b820: 2020 2020 2020 2020 200d 0a20 2020 2020           ..     
+0000b830: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
+0000b840: 200d 0a0d 0a20 2020 2064 6566 2062 6f75   ....    def bou
+0000b850: 6e64 696e 675f 626f 7828 706f 696e 7473  nding_box(points
+0000b860: 293a 0d0a 2020 2020 2020 2020 2222 2246  ):..        """F
+0000b870: 696e 6420 7468 6520 626f 756e 6469 6e67  ind the bounding
+0000b880: 2062 6f78 2066 6f72 2061 2073 6574 206f   box for a set o
+0000b890: 6620 706f 696e 7473 2e22 2222 0d0a 2020  f points."""..  
+0000b8a0: 2020 2020 2020 785f 7661 6c73 2c20 795f        x_vals, y_
+0000b8b0: 7661 6c73 2c20 5f20 3d20 7a69 7028 2a70  vals, _ = zip(*p
+0000b8c0: 6f69 6e74 7329 0d0a 2020 2020 2020 2020  oints)..        
+0000b8d0: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
+0000b8e0: 2020 2020 7265 7475 726e 206d 696e 2878      return min(x
+0000b8f0: 5f76 616c 7329 202c 206d 6178 2878 5f76  _vals) , max(x_v
+0000b900: 616c 7329 2c20 6d69 6e28 795f 7661 6c73  als), min(y_vals
+0000b910: 292c 206d 6178 2879 5f76 616c 7329 0d0a  ), max(y_vals)..
+0000b920: 0d0a 2020 2020 2323 2323 2323 2323 0d0a  ..    ########..
+0000b930: 0d0a 2020 200d 0a20 2020 200d 0a20 2020  ..   ..    ..   
+0000b940: 2069 6d70 6f72 7420 657a 6478 660d 0a20   import ezdxf.. 
+0000b950: 2020 2066 726f 6d20 7363 6970 792e 7370     from scipy.sp
+0000b960: 6174 6961 6c20 696d 706f 7274 2044 656c  atial import Del
+0000b970: 6175 6e61 790d 0a20 2020 2069 6d70 6f72  aunay..    impor
+0000b980: 7420 6e75 6d70 7920 6173 206e 700d 0a20  t numpy as np.. 
+0000b990: 2020 2069 6d70 6f72 7420 6f73 0d0a 0d0a     import os....
+0000b9a0: 2020 2020 6465 6620 6c69 7374 5f78 797a      def list_xyz
+0000b9b0: 5f66 696c 6573 5f69 6e5f 666f 6c64 6572  _files_in_folder
+0000b9c0: 2866 6f6c 6465 725f 7061 7468 293a 0d0a  (folder_path):..
+0000b9d0: 2020 2020 2020 2020 7879 7a5f 6669 6c65          xyz_file
+0000b9e0: 7320 3d20 5b5d 0d0a 2020 2020 2020 2020  s = []..        
+0000b9f0: 666f 7220 6669 6c65 6e61 6d65 2069 6e20  for filename in 
+0000ba00: 6f73 2e6c 6973 7464 6972 2866 6f6c 6465  os.listdir(folde
+0000ba10: 725f 7061 7468 293a 0d0a 2020 2020 2020  r_path):..      
+0000ba20: 2020 2020 2020 6966 2066 696c 656e 616d        if filenam
+0000ba30: 652e 656e 6473 7769 7468 2822 2e78 797a  e.endswith(".xyz
+0000ba40: 2229 3a0d 0a20 2020 2020 2020 2020 2020  "):..           
+0000ba50: 2020 2020 2078 797a 5f66 696c 6573 2e61       xyz_files.a
+0000ba60: 7070 656e 6428 6f73 2e70 6174 682e 6a6f  ppend(os.path.jo
+0000ba70: 696e 2866 6f6c 6465 725f 7061 7468 2c20  in(folder_path, 
+0000ba80: 6669 6c65 6e61 6d65 2929 0d0a 2020 2020  filename))..    
+0000ba90: 2020 2020 7265 7475 726e 2078 797a 5f66      return xyz_f
+0000baa0: 696c 6573 0d0a 0d0a 2020 2020 6465 6620  iles....    def 
+0000bab0: 6372 6561 7465 5f64 7866 5f66 726f 6d5f  create_dxf_from_
+0000bac0: 7879 7a5f 6669 6c65 7328 7879 7a5f 6669  xyz_files(xyz_fi
+0000bad0: 6c65 732c 206f 7574 7075 745f 7061 7468  les, output_path
+0000bae0: 2c20 7369 6e67 6c65 3d4e 6f6e 6529 3a0d  , single=None):.
+0000baf0: 0a20 2020 2020 2020 200d 0a20 2020 2020  .        ..     
+0000bb00: 2020 2069 6620 7369 6e67 6c65 2069 7320     if single is 
+0000bb10: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
+0000bb20: 2020 2020 2320 4372 6561 7465 2061 206e      # Create a n
+0000bb30: 6577 2044 5846 2064 6f63 756d 656e 740d  ew DXF document.
+0000bb40: 0a20 2020 2020 2020 2020 2020 2064 6f63  .            doc
+0000bb50: 203d 2065 7a64 7866 2e6e 6577 2829 0d0a   = ezdxf.new()..
+0000bb60: 0d0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+0000bb70: 4372 6561 7465 2061 206e 6577 2044 5846  Create a new DXF
+0000bb80: 206d 6f64 656c 2073 7061 6365 0d0a 2020   model space..  
+0000bb90: 2020 2020 2020 2020 2020 6d73 7020 3d20            msp = 
+0000bba0: 646f 632e 6d6f 6465 6c73 7061 6365 2829  doc.modelspace()
+0000bbb0: 0d0a 2020 2020 2020 2020 2020 2020 0d0a  ..            ..
+0000bbc0: 2020 2020 2020 2020 2020 200d 0a0d 0a20             .... 
+0000bbd0: 2020 2020 2020 2066 6f72 2078 797a 5f66         for xyz_f
+0000bbe0: 696c 6520 696e 2078 797a 5f66 696c 6573  ile in xyz_files
+0000bbf0: 3a0d 0a20 2020 2020 2020 2020 2020 200d  :..            .
+0000bc00: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0000bc10: 7369 6e67 6c65 2069 7320 6e6f 7420 4e6f  single is not No
+0000bc20: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
+0000bc30: 2020 2020 2023 2043 7265 6174 6520 6120       # Create a 
+0000bc40: 6e65 7720 4458 4620 646f 6375 6d65 6e74  new DXF document
+0000bc50: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000bc60: 2020 646f 6320 3d20 657a 6478 662e 6e65    doc = ezdxf.ne
+0000bc70: 7728 290d 0a0d 0a20 2020 2020 2020 2020  w()....         
+0000bc80: 2020 2020 2020 2023 2043 7265 6174 6520         # Create 
+0000bc90: 6120 6e65 7720 4458 4620 6d6f 6465 6c20  a new DXF model 
+0000bca0: 7370 6163 650d 0a20 2020 2020 2020 2020  space..         
+0000bcb0: 2020 2020 2020 206d 7370 203d 2064 6f63         msp = doc
+0000bcc0: 2e6d 6f64 656c 7370 6163 6528 290d 0a20  .modelspace().. 
+0000bcd0: 2020 2020 2020 2020 2020 2023 204c 6f61             # Loa
+0000bce0: 6420 5859 5a20 6461 7461 2066 726f 6d20  d XYZ data from 
+0000bcf0: 6120 6669 6c65 0d0a 2020 2020 2020 2020  a file..        
+0000bd00: 2020 2020 6461 7461 203d 206e 702e 6c6f      data = np.lo
+0000bd10: 6164 7478 7428 7879 7a5f 6669 6c65 290d  adtxt(xyz_file).
+0000bd20: 0a20 2020 2020 2020 2020 2020 200d 0a0d  .            ...
+0000bd30: 0a20 2020 2020 2020 2020 2020 2023 2053  .            # S
+0000bd40: 6570 6172 6174 6520 7468 6520 5859 5a20  eparate the XYZ 
+0000bd50: 6461 7461 2069 6e74 6f20 696e 6469 7669  data into indivi
+0000bd60: 6475 616c 2061 7272 6179 730d 0a20 2020  dual arrays..   
+0000bd70: 2020 2020 2020 2020 2078 203d 2064 6174           x = dat
+0000bd80: 615b 3a2c 2030 5d0d 0a20 2020 2020 2020  a[:, 0]..       
+0000bd90: 2020 2020 2079 203d 2064 6174 615b 3a2c       y = data[:,
+0000bda0: 2031 5d0d 0a20 2020 2020 2020 2020 2020   1]..           
+0000bdb0: 207a 203d 2064 6174 615b 3a2c 2032 5d0d   z = data[:, 2].
+0000bdc0: 0a0d 0a20 2020 2020 2020 2020 2020 2023  ...            #
+0000bdd0: 2043 7265 6174 6520 6120 4465 6c61 756e   Create a Delaun
+0000bde0: 6179 2074 7269 616e 6775 6c61 7469 6f6e  ay triangulation
+0000bdf0: 206f 6620 7468 6520 706f 696e 7473 0d0a   of the points..
+0000be00: 2020 2020 2020 2020 2020 2020 7472 6920              tri 
+0000be10: 3d20 4465 6c61 756e 6179 286e 702e 636f  = Delaunay(np.co
+0000be20: 6c75 6d6e 5f73 7461 636b 2828 782c 2079  lumn_stack((x, y
+0000be30: 2929 290d 0a0d 0a20 2020 2020 2020 2020  )))....         
+0000be40: 2020 2023 2041 6464 2074 6865 2074 7269     # Add the tri
+0000be50: 616e 676c 6573 2074 6f20 7468 6520 6d6f  angles to the mo
+0000be60: 6465 6c20 7370 6163 650d 0a20 2020 2020  del space..     
+0000be70: 2020 2020 2020 2066 6f72 2073 696d 706c         for simpl
+0000be80: 6578 2069 6e20 7472 692e 7369 6d70 6c69  ex in tri.simpli
+0000be90: 6365 733a 0d0a 2020 2020 2020 2020 2020  ces:..          
+0000bea0: 2020 2020 2020 7665 7274 6963 6573 203d        vertices =
+0000beb0: 205b 2878 5b69 5d2c 2079 5b69 5d2c 207a   [(x[i], y[i], z
+0000bec0: 5b69 5d29 2066 6f72 2069 2069 6e20 7369  [i]) for i in si
+0000bed0: 6d70 6c65 785d 0d0a 2020 2020 2020 2020  mplex]..        
+0000bee0: 2020 2020 2020 2020 6d73 702e 6164 645f          msp.add_
+0000bef0: 3364 6661 6365 2870 6f69 6e74 733d 7665  3dface(points=ve
+0000bf00: 7274 6963 6573 290d 0a20 2020 2020 2020  rtices)..       
+0000bf10: 2020 2020 200d 0a20 2020 2020 2020 2020       ..         
+0000bf20: 2020 2069 6620 7369 6e67 6c65 2069 7320     if single is 
+0000bf30: 6e6f 7420 4e6f 6e65 3a0d 0a20 2020 2020  not None:..     
+0000bf40: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0000bf50: 2053 6176 6520 7468 6520 4458 4620 6669   Save the DXF fi
+0000bf60: 6c65 0d0a 2020 2020 2020 2020 2020 2020  le..            
+0000bf70: 2020 2020 646f 632e 7361 7665 6173 286f      doc.saveas(o
+0000bf80: 7574 7075 745f 7061 7468 290d 0a20 2020  utput_path)..   
+0000bf90: 2020 2020 2020 2020 200d 0a20 2020 2020           ..     
+0000bfa0: 2020 2069 6620 7369 6e67 6c65 2069 7320     if single is 
+0000bfb0: 4e6f 6e65 3a20 0d0a 0d0a 2020 2020 2020  None: ....      
+0000bfc0: 2020 2020 2020 2320 5361 7665 2074 6865        # Save the
+0000bfd0: 2044 5846 2066 696c 650d 0a20 2020 2020   DXF file..     
+0000bfe0: 2020 2020 2020 2064 6f63 2e73 6176 6561         doc.savea
+0000bff0: 7328 6f75 7470 7574 5f70 6174 6829 0d0a  s(output_path)..
+0000c000: 2020 2020 2020 2020 0d0a 2020 2020 0d0a          ..    ..
+0000c010: 2020 2020 6465 6620 7361 7665 5f70 6c61      def save_pla
+0000c020: 6e65 735f 746f 5f6f 626a 2829 3a0d 0a20  nes_to_obj():.. 
+0000c030: 2020 2020 2020 2078 5f63 6f6f 7264 7320         x_coords 
+0000c040: 3d20 6e70 2e6c 696e 7370 6163 6528 6c65  = np.linspace(le
+0000c050: 6674 2c20 7269 6768 742c 2064 6174 612e  ft, right, data.
+0000c060: 7368 6170 655b 315d 290d 0a20 2020 2020  shape[1])..     
+0000c070: 2020 2079 5f63 6f6f 7264 7320 3d20 6e70     y_coords = np
+0000c080: 2e6c 696e 7370 6163 6528 746f 702c 2062  .linspace(top, b
+0000c090: 6f74 746f 6d2c 2064 6174 612e 7368 6170  ottom, data.shap
+0000c0a0: 655b 305d 290d 0a20 2020 2020 2020 2078  e[0])..        x
+0000c0b0: 782c 2079 7920 3d20 6e70 2e6d 6573 6867  x, yy = np.meshg
+0000c0c0: 7269 6428 785f 636f 6f72 6473 2c20 795f  rid(x_coords, y_
+0000c0d0: 636f 6f72 6473 290d 0a20 2020 2020 2020  coords)..       
+0000c0e0: 0d0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
+0000c0f0: 2070 6c61 6e65 733a 0d0a 2020 2020 2020   planes:..      
+0000c100: 2020 2020 2020 7072 696e 7428 224e 6f20        print("No 
+0000c110: 706c 616e 6573 2074 6f20 7361 7665 2e22  planes to save."
+0000c120: 290d 0a20 2020 2020 2020 2020 2020 2072  )..            r
+0000c130: 6574 7572 6e0d 0a20 2020 2020 2020 200d  eturn..        .
+0000c140: 0a20 2020 2020 2020 200d 0a20 2020 2020  .        ..     
+0000c150: 2020 206f 7574 7075 745f 6669 6c65 6e61     output_filena
+0000c160: 6d65 5f64 7866 203d 2066 227b 6f75 745f  me_dxf = f"{out_
+0000c170: 706c 616e 6546 6f6c 6465 727d 2f70 6c61  planeFolder}/pla
+0000c180: 6e65 732e 6478 6622 0d0a 2020 2020 2020  nes.dxf"..      
+0000c190: 2020 666f 7220 6964 782c 2070 6c61 6e65    for idx, plane
+0000c1a0: 2069 6e20 656e 756d 6572 6174 6528 706c   in enumerate(pl
+0000c1b0: 616e 6573 293a 0d0a 2020 2020 2020 2020  anes):..        
+0000c1c0: 2020 2020 6f75 7470 7574 5f66 696c 656e      output_filen
+0000c1d0: 616d 6520 3d20 6622 7b6f 7574 5f70 6c61  ame = f"{out_pla
+0000c1e0: 6e65 466f 6c64 6572 7d2f 706c 616e 6573  neFolder}/planes
+0000c1f0: 5f7b 6964 787d 2e78 797a 220d 0a20 2020  _{idx}.xyz"..   
+0000c200: 2020 2020 2020 2020 206f 7574 7075 745f           output_
+0000c210: 6669 6c65 6e61 6d65 5f69 6478 203d 2066  filename_idx = f
+0000c220: 227b 6f75 745f 706c 616e 6546 6f6c 6465  "{out_planeFolde
+0000c230: 727d 2f70 6c61 6e65 735f 7b69 6478 7d2e  r}/planes_{idx}.
+0000c240: 6478 6622 0d0a 2020 2020 2020 2020 2020  dxf"..          
+0000c250: 2020 0d0a 2020 2020 2020 2020 2020 2020    ..            
+0000c260: 2320 496e 6974 6961 6c69 7a65 206c 6973  # Initialize lis
+0000c270: 7473 2074 6f20 7374 6f72 6520 7665 7274  ts to store vert
+0000c280: 6963 6573 2061 6e64 2066 6163 6573 0d0a  ices and faces..
+0000c290: 2020 2020 2020 2020 2020 2020 7665 7274              vert
+0000c2a0: 6963 6573 203d 205b 5d0d 0a20 2020 2020  ices = []..     
+0000c2b0: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
+0000c2c0: 2020 2020 2023 2053 616d 706c 6564 2070       # Sampled p
+0000c2d0: 6f69 6e74 2069 6e74 6572 7661 6c0d 0a20  oint interval.. 
+0000c2e0: 2020 2020 2020 2020 2020 2073 616d 706c             sampl
+0000c2f0: 655f 696e 7465 7276 616c 203d 2032 3030  e_interval = 200
+0000c300: 0d0a 2020 2020 2020 2020 2020 2020 0d0a  ..            ..
+0000c310: 2020 2020 2020 2020 2020 2020 2320 4f70              # Op
+0000c320: 656e 2074 6865 2058 595a 2066 696c 6520  en the XYZ file 
+0000c330: 666f 7220 7772 6974 696e 670d 0a20 2020  for writing..   
+0000c340: 2020 2020 2020 2020 2077 6974 6820 6f70           with op
+0000c350: 656e 286f 7574 7075 745f 6669 6c65 6e61  en(output_filena
+0000c360: 6d65 2c20 2777 2729 2061 7320 7879 7a5f  me, 'w') as xyz_
+0000c370: 6669 6c65 3a0d 0a20 2020 2020 2020 2020  file:..         
+0000c380: 2020 2020 2020 2066 6f72 2069 2069 6e20         for i in 
+0000c390: 7261 6e67 6528 302c 2070 6c61 6e65 2e73  range(0, plane.s
+0000c3a0: 6861 7065 5b30 5d2c 2073 616d 706c 655f  hape[0], sample_
+0000c3b0: 696e 7465 7276 616c 293a 0d0a 2020 2020  interval):..    
+0000c3c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c3d0: 666f 7220 6a20 696e 2072 616e 6765 2830  for j in range(0
+0000c3e0: 2c20 706c 616e 652e 7368 6170 655b 315d  , plane.shape[1]
+0000c3f0: 2c20 7361 6d70 6c65 5f69 6e74 6572 7661  , sample_interva
+0000c400: 6c29 3a0d 0a20 2020 2020 2020 2020 2020  l):..           
+0000c410: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0000c420: 6920 3c20 7878 2e73 6861 7065 5b30 5d20  i < xx.shape[0] 
+0000c430: 616e 6420 6a20 3c20 7878 2e73 6861 7065  and j < xx.shape
+0000c440: 5b31 5d3a 0d0a 2020 2020 2020 2020 2020  [1]:..          
+0000c450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c460: 2020 7820 3d20 7878 5b69 2c20 6a5d 0d0a    x = xx[i, j]..
+0000c470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c480: 2020 2020 2020 2020 2020 2020 7920 3d20              y = 
+0000c490: 7979 5b69 2c20 6a5d 0d0a 2020 2020 2020  yy[i, j]..      
+0000c4a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c4b0: 2020 2020 2020 7a20 3d20 706c 616e 655b        z = plane[
+0000c4c0: 692c 206a 5d0d 0a0d 0a20 2020 2020 2020  i, j]....       
+0000c4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c4e0: 2020 2020 2023 2043 6865 636b 2066 6f72       # Check for
+0000c4f0: 204e 614e 2076 616c 7565 730d 0a20 2020   NaN values..   
+0000c500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c510: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+0000c520: 6e70 2e69 736e 616e 2878 2920 616e 6420  np.isnan(x) and 
+0000c530: 6e6f 7420 6e70 2e69 736e 616e 2879 2920  not np.isnan(y) 
+0000c540: 616e 6420 6e6f 7420 6e70 2e69 736e 616e  and not np.isnan
+0000c550: 287a 293a 0d0a 2020 2020 2020 2020 2020  (z):..          
+0000c560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c570: 2020 2020 2020 2320 4164 6420 7468 6520        # Add the 
+0000c580: 7665 7274 6578 2074 6f20 7468 6520 6c69  vertex to the li
+0000c590: 7374 0d0a 2020 2020 2020 2020 2020 2020  st..            
+0000c5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c5b0: 2020 2020 7665 7274 6963 6573 2e61 7070      vertices.app
+0000c5c0: 656e 6428 2878 2c20 792c 207a 2929 0d0a  end((x, y, z))..
+0000c5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c5e0: 2020 2020 2020 2020 2020 2020 2020 200d                 .
+0000c5f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000c600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c610: 2023 2057 7269 7465 2076 6572 7465 7820   # Write vertex 
+0000c620: 6461 7461 2074 6f20 7468 6520 5859 5a20  data to the XYZ 
+0000c630: 6669 6c65 0d0a 2020 2020 2020 2020 2020  file..          
+0000c640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c650: 2020 2020 2020 7879 7a5f 6669 6c65 2e77        xyz_file.w
+0000c660: 7269 7465 2866 277b 787d 207b 797d 207b  rite(f'{x} {y} {
+0000c670: 7a7d 5c6e 2729 0d0a 2020 2020 2020 2020  z}\n')..        
+0000c680: 2020 2020 0d0a 2020 2020 2020 2020 2020      ..          
+0000c690: 2020 6372 6561 7465 5f64 7866 5f66 726f    create_dxf_fro
+0000c6a0: 6d5f 7879 7a5f 6669 6c65 7328 6c69 7374  m_xyz_files(list
+0000c6b0: 5f78 797a 5f66 696c 6573 5f69 6e5f 666f  _xyz_files_in_fo
+0000c6c0: 6c64 6572 286f 7574 5f70 6c61 6e65 466f  lder(out_planeFo
+0000c6d0: 6c64 6572 292c 206f 7574 7075 745f 6669  lder), output_fi
+0000c6e0: 6c65 6e61 6d65 5f69 6478 2c20 7369 6e67  lename_idx, sing
+0000c6f0: 6c65 3d69 6478 290d 0a20 2020 2020 2020  le=idx)..       
+0000c700: 2020 2020 200d 0a20 2020 2020 2020 2020       ..         
+0000c710: 2020 2020 2020 2020 200d 0a20 2020 2020           ..     
+0000c720: 2020 2070 7269 6e74 2866 277a 7a20 7661     print(f'zz va
+0000c730: 6c75 6573 2073 6176 6564 2074 6f20 7b6f  lues saved to {o
+0000c740: 7574 7075 745f 6669 6c65 6e61 6d65 7d27  utput_filename}'
+0000c750: 290d 0a20 2020 2020 2020 2020 2020 200d  )..            .
+0000c760: 0a20 2020 2020 2020 200d 0a20 2020 0d0a  .        ..   ..
+0000c770: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
+0000c780: 2020 0d0a 2020 2020 6465 6620 636f 6c6c    ..    def coll
+0000c790: 6563 745f 706f 696e 7473 5f66 726f 6d5f  ect_points_from_
+0000c7a0: 6c69 6e65 2867 6466 293a 0d0a 2020 2020  line(gdf):..    
+0000c7b0: 2020 2020 2222 2243 6f6c 6c65 6374 2073      """Collect s
+0000c7c0: 7461 7274 2c20 6d69 6464 6c65 2c20 616e  tart, middle, an
+0000c7d0: 6420 656e 6420 706f 696e 7473 2066 726f  d end points fro
+0000c7e0: 6d20 6561 6368 206c 696e 6520 6665 6174  m each line feat
+0000c7f0: 7572 652e 2222 220d 0a20 2020 2020 2020  ure."""..       
+0000c800: 2063 6f6c 6c65 6374 6564 5f70 6f69 6e74   collected_point
+0000c810: 7320 3d20 5b5d 0d0a 0d0a 2020 2020 2020  s = []....      
+0000c820: 2020 666f 7220 6765 6f6d 6574 7279 2069    for geometry i
+0000c830: 6e20 6764 662e 6765 6f6d 6574 7279 3a0d  n gdf.geometry:.
+0000c840: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0000c850: 6765 6f6d 6574 7279 2e67 656f 6d5f 7479  geometry.geom_ty
+0000c860: 7065 203d 3d20 224c 696e 6553 7472 696e  pe == "LineStrin
+0000c870: 6722 3a0d 0a20 2020 2020 2020 2020 2020  g":..           
+0000c880: 2020 2020 2078 2c20 7920 3d20 6765 6f6d       x, y = geom
+0000c890: 6574 7279 2e78 790d 0a20 2020 2020 2020  etry.xy..       
+0000c8a0: 2020 2020 2020 2020 2073 7461 7274 203d           start =
+0000c8b0: 2028 785b 305d 2c20 795b 305d 290d 0a20   (x[0], y[0]).. 
+0000c8c0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0000c8d0: 6e64 203d 2028 785b 2d31 5d2c 2079 5b2d  nd = (x[-1], y[-
+0000c8e0: 315d 290d 0a20 2020 2020 2020 2020 2020  1])..           
+0000c8f0: 2020 2020 200d 0a20 2020 2020 2020 2020       ..         
+0000c900: 2020 2020 2020 2023 7072 696e 7428 2773         #print('s
+0000c910: 7461 7274 3a20 2720 2c73 7461 7274 290d  tart: ' ,start).
+0000c920: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000c930: 200d 0a20 2020 2020 2020 2020 2020 2020   ..             
+0000c940: 2020 2023 2023 2043 7265 6174 6520 6120     # # Create a 
+0000c950: 4c69 6e65 5374 7269 6e67 2066 726f 6d20  LineString from 
+0000c960: 636f 6f72 6469 6e61 7465 7320 746f 2065  coordinates to e
+0000c970: 6173 696c 7920 6765 7420 6120 706f 696e  asily get a poin
+0000c980: 7420 6174 2035 3025 2064 6973 7461 6e63  t at 50% distanc
+0000c990: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
+0000c9a0: 2020 206c 696e 6520 3d20 4c69 6e65 5374     line = LineSt
+0000c9b0: 7269 6e67 287a 6970 2878 2c20 7929 290d  ring(zip(x, y)).
+0000c9c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000c9d0: 2023 2069 6620 6c65 6e28 6c69 6e65 2e63   # if len(line.c
+0000c9e0: 6f6f 7264 7329 203e 3d20 333a 0d0a 2020  oords) >= 3:..  
+0000c9f0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0000ca00: 2020 2020 2320 4966 2074 6865 206c 696e      # If the lin
+0000ca10: 6520 6861 7320 6d6f 7265 2074 6861 6e20  e has more than 
+0000ca20: 3220 7665 7274 6963 6573 2c20 636f 6c6c  2 vertices, coll
+0000ca30: 6563 7420 706f 696e 7473 2061 7420 7665  ect points at ve
+0000ca40: 7274 6963 6573 0d0a 2020 2020 2020 2020  rtices..        
+0000ca50: 2020 2020 2020 2020 2320 2020 2020 7665          #     ve
+0000ca60: 7274 6963 6573 203d 206c 6973 7428 6c69  rtices = list(li
+0000ca70: 6e65 2e63 6f6f 7264 7329 0d0a 2020 2020  ne.coords)..    
+0000ca80: 2020 2020 2020 2020 2020 2020 2320 2020              #   
+0000ca90: 2020 2370 7269 6e74 2827 7665 7274 6963    #print('vertic
+0000caa0: 733a 2027 2c20 7665 7274 6963 6573 290d  s: ', vertices).
+0000cab0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000cac0: 2023 2020 2020 2076 6572 7465 785f 6c69   #     vertex_li
+0000cad0: 7374 3d5b 6920 666f 7220 6920 696e 2076  st=[i for i in v
+0000cae0: 6572 7469 6365 735d 0d0a 2020 2020 2020  ertices]..      
+0000caf0: 2020 2020 2020 2020 2020 2320 2020 2020            #     
+0000cb00: 666f 7220 6b6a 2069 6e20 7665 7274 6578  for kj in vertex
+0000cb10: 5f6c 6973 743a 0d0a 2020 2020 2020 2020  _list:..        
+0000cb20: 2020 2020 2020 2020 2320 2020 2020 2020          #       
+0000cb30: 2020 636f 6c6c 6563 7465 645f 706f 696e    collected_poin
+0000cb40: 7473 2e61 7070 656e 6428 6b6a 290d 0a20  ts.append(kj).. 
+0000cb50: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0000cb60: 2020 2020 2023 636f 6c6c 6563 7465 645f       #collected_
+0000cb70: 706f 696e 7473 2e65 7874 656e 6428 7665  points.extend(ve
+0000cb80: 7274 6963 6573 290d 0a20 2020 2020 2020  rtices)..       
+0000cb90: 2020 2020 2020 2020 2023 2065 6c73 653a           # else:
+0000cba0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000cbb0: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
+0000cbc0: 2020 2020 2020 2020 6d69 6464 6c65 203d          middle =
+0000cbd0: 206c 696e 652e 696e 7465 7270 6f6c 6174   line.interpolat
+0000cbe0: 6528 302e 352c 206e 6f72 6d61 6c69 7a65  e(0.5, normalize
+0000cbf0: 643d 5472 7565 292e 636f 6f72 6473 5b30  d=True).coords[0
+0000cc00: 5d0d 0a20 2020 2020 2020 2020 2020 2020  ]..             
+0000cc10: 2020 2070 3220 3d20 6c69 6e65 2e69 6e74     p2 = line.int
+0000cc20: 6572 706f 6c61 7465 2830 2e32 352c 206e  erpolate(0.25, n
+0000cc30: 6f72 6d61 6c69 7a65 643d 5472 7565 292e  ormalized=True).
+0000cc40: 636f 6f72 6473 5b30 5d0d 0a20 2020 2020  coords[0]..     
+0000cc50: 2020 2020 2020 2020 2020 2070 3120 3d20             p1 = 
+0000cc60: 6c69 6e65 2e69 6e74 6572 706f 6c61 7465  line.interpolate
+0000cc70: 2830 2e37 352c 206e 6f72 6d61 6c69 7a65  (0.75, normalize
+0000cc80: 643d 5472 7565 292e 636f 6f72 6473 5b30  d=True).coords[0
+0000cc90: 5d0d 0a0d 0a20 2020 2020 2020 2020 2020  ]....           
+0000cca0: 2020 2020 2063 6f6c 6c65 6374 6564 5f70       collected_p
+0000ccb0: 6f69 6e74 732e 6170 7065 6e64 285b 7374  oints.append([st
+0000ccc0: 6172 742c 206d 6964 646c 652c 2065 6e64  art, middle, end
+0000ccd0: 2c20 7031 2c70 325d 290d 0a0d 0a20 2020  , p1,p2])....   
+0000cce0: 2020 2020 2072 6574 7572 6e20 636f 6c6c       return coll
+0000ccf0: 6563 7465 645f 706f 696e 7473 0d0a 0d0a  ected_points....
+0000cd00: 2020 2020 2320 6465 6620 636f 6c6c 6563      # def collec
+0000cd10: 745f 706f 696e 7473 5f66 726f 6d5f 6c69  t_points_from_li
+0000cd20: 6e65 2867 6466 293a 0d0a 2020 2020 2320  ne(gdf):..    # 
+0000cd30: 2020 2020 2320 496e 6974 6961 6c69 7a65      # Initialize
+0000cd40: 2061 6e20 656d 7074 7920 6c69 7374 2074   an empty list t
+0000cd50: 6f20 7374 6f72 6520 7468 6520 636f 6f72  o store the coor
+0000cd60: 6469 6e61 7465 730d 0a20 2020 2023 2020  dinates..    #  
+0000cd70: 2020 2063 6f6c 6c65 6374 6564 5f70 6f69     collected_poi
+0000cd80: 6e74 7320 3d20 5b5d 0d0a 0d0a 2020 2020  nts = []....    
+0000cd90: 2320 2020 2020 2320 4974 6572 6174 6520  #     # Iterate 
+0000cda0: 7468 726f 7567 6820 7468 6520 4765 6f44  through the GeoD
+0000cdb0: 6174 6146 7261 6d65 0d0a 2020 2020 2320  ataFrame..    # 
+0000cdc0: 2020 2020 666f 7220 6765 6f6d 6574 7279      for geometry
+0000cdd0: 2069 6e20 6764 665b 2767 656f 6d65 7472   in gdf['geometr
+0000cde0: 7927 5d3a 0d0a 2020 2020 2320 2020 2020  y']:..    #     
+0000cdf0: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+0000ce00: 6528 6765 6f6d 6574 7279 2c20 4c69 6e65  e(geometry, Line
+0000ce10: 5374 7269 6e67 293a 0d0a 2020 2020 2320  String):..    # 
+0000ce20: 2020 2020 2020 2020 2020 2020 2320 436f              # Co
+0000ce30: 756e 7420 7468 6520 6e75 6d62 6572 206f  unt the number o
+0000ce40: 6620 7665 7274 6963 6573 2069 6e20 7468  f vertices in th
+0000ce50: 6520 4c69 6e65 5374 7269 6e67 0d0a 2020  e LineString..  
+0000ce60: 2020 2320 2020 2020 2020 2020 2020 2020    #             
+0000ce70: 6e75 6d5f 7665 7274 6963 6573 203d 206c  num_vertices = l
+0000ce80: 656e 2867 656f 6d65 7472 792e 636f 6f72  en(geometry.coor
+0000ce90: 6473 290d 0a20 2020 2020 2020 2020 2020  ds)..           
+0000cea0: 2020 2020 200d 0a20 2020 2023 2020 2020       ..    #    
+0000ceb0: 2020 2020 2020 2020 2023 2043 6865 636b           # Check
+0000cec0: 2069 6620 7468 6520 4c69 6e65 5374 7269   if the LineStri
+0000ced0: 6e67 2069 7320 7374 7261 6967 6874 2028  ng is straight (
+0000cee0: 3320 6f72 2066 6577 6572 2076 6572 7469  3 or fewer verti
+0000cef0: 6365 7329 0d0a 2020 2020 2320 2020 2020  ces)..    #     
+0000cf00: 2020 2020 2020 2020 6966 206e 756d 5f76          if num_v
+0000cf10: 6572 7469 6365 7320 3c3d 2033 3a0d 0a20  ertices <= 3:.. 
+0000cf20: 2020 2023 2020 2020 2020 2020 2020 2020     #            
+0000cf30: 2020 2020 2023 2046 6f72 2073 7472 6169       # For strai
+0000cf40: 6768 7420 6c69 6e65 732c 2074 616b 6520  ght lines, take 
+0000cf50: 636f 6f72 6469 6e61 7465 7320 6f66 2073  coordinates of s
+0000cf60: 7461 7274 2c20 656e 642c 2061 6e64 206d  tart, end, and m
+0000cf70: 6964 646c 650d 0a20 2020 2023 2020 2020  iddle..    #    
+0000cf80: 2020 2020 2020 2020 2020 2020 2073 7461               sta
+0000cf90: 7274 5f70 6f69 6e74 203d 2067 656f 6d65  rt_point = geome
+0000cfa0: 7472 792e 636f 6f72 6473 5b30 5d0d 0a20  try.coords[0].. 
+0000cfb0: 2020 2023 2020 2020 2020 2020 2020 2020     #            
+0000cfc0: 2020 2020 2065 6e64 5f70 6f69 6e74 203d       end_point =
+0000cfd0: 2067 656f 6d65 7472 792e 636f 6f72 6473   geometry.coords
+0000cfe0: 5b2d 315d 0d0a 2020 2020 2320 2020 2020  [-1]..    #     
+0000cff0: 2020 2020 2020 2020 2020 2020 6d69 6464              midd
+0000d000: 6c65 5f70 6f69 6e74 203d 2067 656f 6d65  le_point = geome
+0000d010: 7472 792e 696e 7465 7270 6f6c 6174 6528  try.interpolate(
+0000d020: 302e 352c 206e 6f72 6d61 6c69 7a65 643d  0.5, normalized=
+0000d030: 5472 7565 292e 636f 6f72 6473 5b30 5d0d  True).coords[0].
+0000d040: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d050: 2020 2020 200d 0a20 2020 2023 2020 2020       ..    #    
+0000d060: 2020 2020 2020 2020 2020 2020 2063 6f6c               col
+0000d070: 6c65 6374 6564 5f70 6f69 6e74 732e 6578  lected_points.ex
+0000d080: 7465 6e64 285b 7374 6172 745f 706f 696e  tend([start_poin
+0000d090: 742c 206d 6964 646c 655f 706f 696e 742c  t, middle_point,
+0000d0a0: 2065 6e64 5f70 6f69 6e74 5d29 0d0a 2020   end_point])..  
+0000d0b0: 2020 2320 2020 2020 2020 2020 2020 2020    #             
+0000d0c0: 656c 7365 3a0d 0a20 2020 2023 2020 2020  else:..    #    
+0000d0d0: 2020 2020 2020 2020 2020 2020 2023 2046               # F
+0000d0e0: 6f72 2063 7572 7665 6420 6c69 6e65 732c  or curved lines,
+0000d0f0: 2074 616b 6520 636f 6f72 6469 6e61 7465   take coordinate
+0000d100: 7320 6f66 2061 6c6c 2076 6572 7469 6365  s of all vertice
+0000d110: 730d 0a20 2020 2023 2020 2020 2020 2020  s..    #        
+0000d120: 2020 2020 2020 2020 2066 6f72 2070 6f69           for poi
+0000d130: 6e74 2069 6e20 6765 6f6d 6574 7279 2e63  nt in geometry.c
+0000d140: 6f6f 7264 733a 0d0a 2020 2020 2320 2020  oords:..    #   
+0000d150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d160: 2020 782c 2079 203d 2070 6f69 6e74 0d0a    x, y = point..
+0000d170: 2020 2020 2320 2020 2020 2020 2020 2020      #           
+0000d180: 2020 2020 2020 2020 2020 636f 6c6c 6563            collec
+0000d190: 7465 645f 706f 696e 7473 2e61 7070 656e  ted_points.appen
+0000d1a0: 6428 2878 2c20 7929 290d 0a20 2020 2020  d((x, y))..     
+0000d1b0: 2020 200d 0a20 2020 2023 2020 2020 2072     ..    #     r
+0000d1c0: 6574 7572 6e20 636f 6c6c 6563 7465 645f  eturn collected_
+0000d1d0: 706f 696e 7473 0d0a 0d0a 2320 4e6f 772c  points....# Now,
+0000d1e0: 2063 6f6f 7264 696e 6174 6573 5f6c 6973   coordinates_lis
+0000d1f0: 7420 636f 6e74 6169 6e73 2074 6865 2063  t contains the c
+0000d200: 6f6f 7264 696e 6174 6573 206f 6620 7374  oordinates of st
+0000d210: 6172 742c 2065 6e64 2c20 6d69 6464 6c65  art, end, middle
+0000d220: 2c20 616e 6420 616c 6c20 7665 7274 6963  , and all vertic
+0000d230: 6573 0d0a 2320 6261 7365 6420 6f6e 2077  es..# based on w
+0000d240: 6865 7468 6572 2074 6865 206c 696e 6520  hether the line 
+0000d250: 6973 2073 7472 6169 6768 7420 2833 206f  is straight (3 o
+0000d260: 7220 6665 7765 7220 7665 7274 6963 6573  r fewer vertices
+0000d270: 2920 6f72 2063 7572 7665 640d 0a20 2020  ) or curved..   
+0000d280: 2020 2020 200d 0a20 2020 200d 0a0d 0a20       ..    .... 
+0000d290: 2020 2064 6566 2064 7261 775f 706c 616e     def draw_plan
+0000d2a0: 6573 5f66 726f 6d5f 6c69 6e65 7328 7878  es_from_lines(xx
+0000d2b0: 2c79 7929 3a0d 0a20 2020 2020 2020 2067  ,yy):..        g
+0000d2c0: 6c6f 6261 6c20 6178 5f32 642c 2061 785f  lobal ax_2d, ax_
+0000d2d0: 3364 2c20 6461 7461 2c20 7472 616e 7366  3d, data, transf
+0000d2e0: 6f72 6d2c 206c 6566 742c 2072 6967 6874  orm, left, right
+0000d2f0: 2c20 626f 7474 6f6d 2c20 746f 702c 2070  , bottom, top, p
+0000d300: 6c61 6e65 7320 0d0a 2020 2020 2020 2020  lanes ..        
+0000d310: 0d0a 2020 2020 2020 2020 6461 7461 2c20  ..        data, 
+0000d320: 7472 616e 7366 6f72 6d2c 2070 726f 6a65  transform, proje
+0000d330: 6374 696f 6e20 3d20 7265 6164 5f64 656d  ction = read_dem
+0000d340: 2864 656d 5f64 6174 6129 0d0a 0d0a 2020  (dem_data)....  
+0000d350: 2020 2020 2020 6764 6620 3d20 6770 642e        gdf = gpd.
+0000d360: 7265 6164 5f66 696c 6528 6c69 6e65 5f73  read_file(line_s
+0000d370: 6861 7065 6669 6c65 290d 0a20 2020 2020  hapefile)..     
+0000d380: 2020 2069 6620 6764 662e 6372 732e 746f     if gdf.crs.to
+0000d390: 5f73 7472 696e 6728 2920 213d 2070 726f  _string() != pro
+0000d3a0: 6a65 6374 696f 6e3a 0d0a 2020 2020 2020  jection:..      
+0000d3b0: 2020 2020 2020 6764 6620 3d20 6764 662e        gdf = gdf.
+0000d3c0: 746f 5f63 7273 2870 726f 6a65 6374 696f  to_crs(projectio
+0000d3d0: 6e29 0d0a 0d0a 2020 2020 2020 2020 706f  n)....        po
+0000d3e0: 696e 745f 7365 7473 203d 2063 6f6c 6c65  int_sets = colle
+0000d3f0: 6374 5f70 6f69 6e74 735f 6672 6f6d 5f6c  ct_points_from_l
+0000d400: 696e 6528 6764 6629 0d0a 2020 2020 2020  ine(gdf)..      
+0000d410: 2020 2320 785f 636f 6f72 6473 203d 206e    # x_coords = n
+0000d420: 702e 6c69 6e73 7061 6365 286c 6566 742c  p.linspace(left,
+0000d430: 2072 6967 6874 2c20 6461 7461 2e73 6861   right, data.sha
+0000d440: 7065 5b31 5d29 0d0a 2020 2020 2020 2020  pe[1])..        
+0000d450: 2320 795f 636f 6f72 6473 203d 206e 702e  # y_coords = np.
+0000d460: 6c69 6e73 7061 6365 2874 6f70 2c20 626f  linspace(top, bo
+0000d470: 7474 6f6d 2c20 6461 7461 2e73 6861 7065  ttom, data.shape
+0000d480: 5b30 5d29 0d0a 2020 2020 2020 2020 2320  [0])..        # 
+0000d490: 7878 2c20 7979 203d 206e 702e 6d65 7368  xx, yy = np.mesh
+0000d4a0: 6772 6964 2878 5f63 6f6f 7264 732c 2079  grid(x_coords, y
+0000d4b0: 5f63 6f6f 7264 7329 0d0a 2020 2020 2020  _coords)..      
+0000d4c0: 2020 0d0a 2020 2020 2020 2020 6672 6f6d    ..        from
+0000d4d0: 2074 7164 6d20 696d 706f 7274 2074 7164   tqdm import tqd
+0000d4e0: 6d0d 0a20 2020 2020 2020 2070 6c61 6e65  m..        plane
+0000d4f0: 733d 5b5d 0d0a 2020 2020 2020 2020 666f  s=[]..        fo
+0000d500: 7220 706f 696e 7473 2069 6e20 7471 646d  r points in tqdm
+0000d510: 2870 6f69 6e74 5f73 6574 732c 2064 6573  (point_sets, des
+0000d520: 633d 2250 726f 6365 7373 696e 6720 6669  c="Processing fi
+0000d530: 7474 6564 2070 6c61 6e65 7322 293a 0d0a  tted planes"):..
+0000d540: 2020 2020 2020 2020 2020 2020 2370 7269              #pri
+0000d550: 6e74 2827 706f 696e 7473 3a20 272c 2070  nt('points: ', p
+0000d560: 6f69 6e74 7329 0d0a 2020 2020 2020 2020  oints)..        
+0000d570: 2020 2020 237a 5f76 616c 7565 7320 3d20      #z_values = 
+0000d580: 5b64 6174 615b 696e 7428 2870 6f69 6e74  [data[int((point
+0000d590: 5b31 5d20 2d20 746f 7029 202f 2061 6273  [1] - top) / abs
+0000d5a0: 2874 7261 6e73 666f 726d 5b35 5d29 292c  (transform[5])),
+0000d5b0: 2069 6e74 2828 706f 696e 745b 305d 202d   int((point[0] -
+0000d5c0: 206c 6566 7429 202f 2074 7261 6e73 666f   left) / transfo
+0000d5d0: 726d 5b31 5d29 5d20 666f 7220 706f 696e  rm[1])] for poin
+0000d5e0: 7420 696e 2070 6f69 6e74 735d 0d0a 2020  t in points]..  
+0000d5f0: 2020 2020 2020 2020 2020 0d0a 2020 2020            ..    
+0000d600: 2020 2020 2020 2020 7a5f 7661 6c75 6573          z_values
+0000d610: 203d 205b 5d0d 0a0d 0a20 2020 2020 2020   = []....       
+0000d620: 2020 2020 2066 6f72 2070 6f69 6e74 2069       for point i
+0000d630: 6e20 706f 696e 7473 3a0d 0a20 2020 2020  n points:..     
+0000d640: 2020 2020 2020 2020 2020 2079 5f69 6e64             y_ind
+0000d650: 6578 203d 2069 6e74 2828 706f 696e 745b  ex = int((point[
+0000d660: 315d 202d 2074 6f70 2920 2f20 6162 7328  1] - top) / abs(
+0000d670: 7472 616e 7366 6f72 6d5b 355d 2929 0d0a  transform[5]))..
+0000d680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d690: 2320 795f 696e 6465 7820 3d20 696e 7428  # y_index = int(
+0000d6a0: 2870 6f69 6e74 5b31 5d20 2d20 746f 7029  (point[1] - top)
+0000d6b0: 202f 2061 6273 2874 7261 6e73 666f 726d   / abs(transform
+0000d6c0: 5b35 5d29 2920 6966 2069 7369 6e73 7461  [5])) if isinsta
+0000d6d0: 6e63 6528 706f 696e 745b 315d 2c20 2869  nce(point[1], (i
+0000d6e0: 6e74 2c20 666c 6f61 7429 2920 616e 6420  nt, float)) and 
+0000d6f0: 6973 696e 7374 616e 6365 2874 7261 6e73  isinstance(trans
+0000d700: 666f 726d 5b35 5d2c 2028 696e 742c 2066  form[5], (int, f
+0000d710: 6c6f 6174 2929 2065 6c73 6520 4e6f 6e65  loat)) else None
+0000d720: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000d730: 2020 2320 785f 696e 6465 7820 3d20 696e    # x_index = in
+0000d740: 7428 2870 6f69 6e74 5b30 5d20 2d20 746f  t((point[0] - to
+0000d750: 7029 202f 2061 6273 2874 7261 6e73 666f  p) / abs(transfo
+0000d760: 726d 5b31 5d29 2920 6966 2069 7369 6e73  rm[1])) if isins
+0000d770: 7461 6e63 6528 706f 696e 745b 305d 2c20  tance(point[0], 
+0000d780: 2869 6e74 2c20 666c 6f61 7429 2920 616e  (int, float)) an
+0000d790: 6420 6973 696e 7374 616e 6365 2874 7261  d isinstance(tra
+0000d7a0: 6e73 666f 726d 5b31 5d2c 2028 696e 742c  nsform[1], (int,
+0000d7b0: 2066 6c6f 6174 2929 2065 6c73 6520 4e6f   float)) else No
+0000d7c0: 6e65 0d0a 0d0a 2020 2020 2020 2020 2020  ne....          
+0000d7d0: 2020 2020 2020 785f 696e 6465 7820 3d20        x_index = 
+0000d7e0: 696e 7428 2870 6f69 6e74 5b30 5d20 2d20  int((point[0] - 
+0000d7f0: 6c65 6674 2920 2f20 7472 616e 7366 6f72  left) / transfor
+0000d800: 6d5b 315d 290d 0a20 2020 2020 2020 2020  m[1])..         
+0000d810: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
+0000d820: 2020 2020 2020 2020 207a 5f76 616c 7565           z_value
+0000d830: 203d 2064 6174 615b 795f 696e 6465 785d   = data[y_index]
+0000d840: 5b78 5f69 6e64 6578 5d0d 0a20 2020 2020  [x_index]..     
+0000d850: 2020 2020 2020 2020 2020 200d 0a20 2020             ..   
+0000d860: 2020 2020 2020 2020 2020 2020 207a 5f76               z_v
+0000d870: 616c 7565 732e 6170 7065 6e64 287a 5f76  alues.append(z_v
+0000d880: 616c 7565 290d 0a0d 0a20 2020 2020 2020  alue)....       
+0000d890: 2020 2020 2078 797a 5f70 6f69 6e74 7320       xyz_points 
+0000d8a0: 3d20 5b70 6f69 6e74 735b 695d 202b 2028  = [points[i] + (
+0000d8b0: 7a5f 7661 6c75 6573 5b69 5d2c 2920 666f  z_values[i],) fo
+0000d8c0: 7220 6920 696e 2072 616e 6765 286c 656e  r i in range(len
+0000d8d0: 287a 5f76 616c 7565 7329 295d 0d0a 0d0a  (z_values))]....
+0000d8e0: 2020 2020 2020 2020 2020 2020 6966 206c              if l
+0000d8f0: 656e 2878 797a 5f70 6f69 6e74 7329 203e  en(xyz_points) >
+0000d900: 3d20 333a 0d0a 2020 2020 2020 2020 2020  = 3:..          
+0000d910: 2020 2020 2020 6669 7474 6564 5f70 6c61        fitted_pla
+0000d920: 6e65 2c20 612c 2062 2c20 632c 2064 6970  ne, a, b, c, dip
+0000d930: 5f61 6e67 6c65 2c20 6469 705f 6469 7265  _angle, dip_dire
+0000d940: 6374 696f 6e20 3d20 6669 745f 706c 616e  ction = fit_plan
+0000d950: 6528 7879 7a5f 706f 696e 7473 2c20 7878  e(xyz_points, xx
+0000d960: 2c20 7979 290d 0a20 2020 2020 2020 2020  , yy)..         
+0000d970: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
+0000d980: 2020 2020 2020 2020 2064 6970 5f61 6e67           dip_ang
+0000d990: 6c65 5f6c 6973 742e 6170 7065 6e64 2864  le_list.append(d
+0000d9a0: 6970 5f61 6e67 6c65 290d 0a20 2020 2020  ip_angle)..     
+0000d9b0: 2020 2020 2020 2020 2020 2064 6970 5f64             dip_d
+0000d9c0: 6972 6563 7469 6f6e 5f6c 6973 742e 6170  irection_list.ap
+0000d9d0: 7065 6e64 2864 6970 5f64 6972 6563 7469  pend(dip_directi
+0000d9e0: 6f6e 290d 0a20 2020 2020 2020 2020 2020  on)..           
+0000d9f0: 200d 0a20 2020 2020 2020 2020 2020 2020   ..             
+0000da00: 2020 2023 2069 6620 6c69 6d69 745f 6578     # if limit_ex
+0000da10: 7465 6e64 3a0d 0a20 2020 2020 2020 2020  tend:..         
+0000da20: 2020 2020 2020 2023 2020 2020 2023 2047         #     # G
+0000da30: 6574 2062 6f75 6e64 696e 6720 626f 7820  et bounding box 
+0000da40: 6f66 2074 6865 2073 656c 6563 7465 6420  of the selected 
+0000da50: 706f 696e 7473 0d0a 2020 2020 2020 2020  points..        
+0000da60: 2020 2020 2020 2020 2320 2020 2020 786d          #     xm
+0000da70: 696e 2c20 786d 6178 2c20 796d 696e 2c20  in, xmax, ymin, 
+0000da80: 796d 6178 203d 2062 6f75 6e64 696e 675f  ymax = bounding_
+0000da90: 626f 7828 7879 7a5f 706f 696e 7473 290d  box(xyz_points).
+0000daa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000dab0: 2020 2020 200d 0a20 2020 2020 2020 2020       ..         
+0000dac0: 2020 2020 2020 2023 2020 2020 206d 6173         #     mas
+0000dad0: 6b20 3d20 2878 7820 3e3d 2078 6d69 6e29  k = (xx >= xmin)
+0000dae0: 2026 2028 7878 203c 3d20 786d 6178 2920   & (xx <= xmax) 
+0000daf0: 2620 2879 7920 3e3d 2079 6d69 6e29 2026  & (yy >= ymin) &
+0000db00: 2028 7979 203c 3d20 796d 6178 290d 0a20   (yy <= ymax).. 
+0000db10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000db20: 2020 200d 0a20 2020 2020 2020 2020 2020     ..           
+0000db30: 2020 2020 2023 2020 2020 2066 6f72 2069       #     for i
+0000db40: 2069 6e20 7261 6e67 6528 7878 2e73 6861   in range(xx.sha
+0000db50: 7065 5b30 5d29 3a0d 0a20 2020 2020 2020  pe[0]):..       
+0000db60: 2020 2020 2020 2020 2023 2020 2020 2020           #      
+0000db70: 2020 2066 6f72 206a 2069 6e20 7261 6e67     for j in rang
+0000db80: 6528 7878 2e73 6861 7065 5b31 5d29 3a0d  e(xx.shape[1]):.
+0000db90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000dba0: 2023 2020 2020 2020 2020 2020 2020 2069   #             i
+0000dbb0: 6620 6e6f 7420 6d61 736b 5b69 2c20 6a5d  f not mask[i, j]
+0000dbc0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0000dbd0: 2020 2023 2020 2020 2020 2020 2020 2020     #            
+0000dbe0: 2020 2020 2066 6974 7465 645f 706c 616e       fitted_plan
+0000dbf0: 655b 692c 206a 5d20 3d20 6e70 2e6e 616e  e[i, j] = np.nan
+0000dc00: 2020 2320 5365 7420 6f75 742d 6f66 2d62    # Set out-of-b
+0000dc10: 6f75 6e64 7320 7661 6c75 6573 2074 6f20  ounds values to 
+0000dc20: 4e61 4e0d 0a20 2020 2020 2020 2020 2020  NaN..           
+0000dc30: 2020 2020 2023 2323 2323 2323 2323 2323       ###########
+0000dc40: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000dc50: 2020 0d0a 2020 2020 2020 2020 2020 2020    ..            
+0000dc60: 2020 2020 2323 2323 2323 2323 230d 0a20      #########.. 
+0000dc70: 2020 2020 2020 2020 2020 200d 0a20 2020             ..   
+0000dc80: 2020 2020 2020 2020 2020 2020 2070 6c61               pla
+0000dc90: 6e65 732e 6170 7065 6e64 2866 6974 7465  nes.append(fitte
+0000dca0: 645f 706c 616e 6529 0d0a 2020 2020 2020  d_plane)..      
+0000dcb0: 2020 2020 2020 2020 2020 2370 6c61 6e65            #plane
+0000dcc0: 5f63 6f6c 6f72 203d 2072 616e 646f 6d5f  _color = random_
+0000dcd0: 636f 6c6f 7228 290d 0a20 2020 2020 2020  color()..       
+0000dce0: 2020 2020 2020 2020 2070 6c61 6e65 5f63           plane_c
+0000dcf0: 6f6c 6f72 3d63 6f6c 6f72 5f66 726f 6d5f  olor=color_from_
+0000dd00: 6469 705f 616e 645f 6469 7265 6374 696f  dip_and_directio
+0000dd10: 6e28 6469 705f 616e 676c 652c 2064 6970  n(dip_angle, dip
+0000dd20: 5f64 6972 6563 7469 6f6e 290d 0a20 2020  _direction)..   
+0000dd30: 2020 2020 2020 2020 2020 2020 2070 6c61               pla
+0000dd40: 6e65 5f63 6f6c 6f72 732e 6170 7065 6e64  ne_colors.append
+0000dd50: 2870 6c61 6e65 5f63 6f6c 6f72 290d 0a20  (plane_color).. 
+0000dd60: 2020 2020 2020 2020 2020 2020 2020 200d                 .
+0000dd70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000dd80: 200d 0a20 2020 2020 2020 200d 0a20 2020   ..        ..   
+0000dd90: 2020 2020 2020 2020 2023 2323 230d 0a20           ####.. 
+0000dda0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0000ddb0: 6f72 2070 6f69 6e74 6e20 696e 2078 797a  or pointn in xyz
+0000ddc0: 5f70 6f69 6e74 733a 0d0a 2020 2020 2020  _points:..      
+0000ddd0: 2020 2020 2020 2020 2020 2020 2020 6178                ax
+0000dde0: 5f32 642e 706c 6f74 2870 6f69 6e74 6e5b  _2d.plot(pointn[
+0000ddf0: 305d 2c20 706f 696e 746e 5b31 5d2c 2027  0], pointn[1], '
+0000de00: 6f27 2c20 636f 6c6f 723d 706c 616e 655f  o', color=plane_
+0000de10: 636f 6c6f 722c 2061 6c70 6861 3d30 2e37  color, alpha=0.7
+0000de20: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+0000de30: 2020 2063 616e 7661 735f 3264 2e64 7261     canvas_2d.dra
+0000de40: 7728 290d 0a0d 0a20 2020 2020 2020 2020  w()....         
+0000de50: 2020 2020 2020 2023 6178 5f33 642e 636c         #ax_3d.cl
+0000de60: 6561 7228 290d 0a20 2020 2020 2020 2020  ear()..         
+0000de70: 2020 2020 2020 2061 785f 3364 2e73 6574         ax_3d.set
+0000de80: 5f74 6974 6c65 2827 3344 2044 454d 2077  _title('3D DEM w
+0000de90: 6974 6820 4669 7474 6564 2050 6c61 6e65  ith Fitted Plane
+0000dea0: 7327 290d 0a20 2020 2020 2020 2020 2020  s')..           
+0000deb0: 2020 2020 2061 785f 3364 2e70 6c6f 745f       ax_3d.plot_
+0000dec0: 7375 7266 6163 6528 7878 2c20 7979 2c20  surface(xx, yy, 
+0000ded0: 6461 7461 2c20 636d 6170 3d27 7465 7272  data, cmap='terr
+0000dee0: 6169 6e27 2c20 6c69 6e65 7769 6474 683d  ain', linewidth=
+0000def0: 302c 2061 6e74 6961 6c69 6173 6564 3d54  0, antialiased=T
+0000df00: 7275 652c 2061 6c70 6861 3d30 2e35 290d  rue, alpha=0.5).
+0000df10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000df20: 2023 666f 7220 706c 616e 6520 696e 2070   #for plane in p
+0000df30: 6c61 6e65 733a 0d0a 2020 2020 2020 2020  lanes:..        
+0000df40: 2020 2020 2020 2020 6178 5f33 642e 706c          ax_3d.pl
+0000df50: 6f74 5f73 7572 6661 6365 2878 782c 2079  ot_surface(xx, y
+0000df60: 792c 2066 6974 7465 645f 706c 616e 652c  y, fitted_plane,
+0000df70: 2061 6c70 6861 3d30 2e36 2c20 6c69 6e65   alpha=0.6, line
+0000df80: 7769 6474 683d 302c 2061 6e74 6961 6c69  width=0, antiali
+0000df90: 6173 6564 3d54 7275 652c 2063 6f6c 6f72  ased=True, color
+0000dfa0: 3d70 6c61 6e65 5f63 6f6c 6f72 290d 0a20  =plane_color).. 
+0000dfb0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0000dfc0: 616e 7661 735f 3364 2e64 7261 7728 290d  anvas_3d.draw().
+0000dfd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000dfe0: 200d 0a20 2020 2020 2020 2020 2020 2020   ..             
+0000dff0: 2020 2070 6c6f 745f 706c 616e 6573 2864     plot_planes(d
+0000e000: 6970 5f61 6e67 6c65 5f6c 6973 742c 2064  ip_angle_list, d
+0000e010: 6970 5f64 6972 6563 7469 6f6e 5f6c 6973  ip_direction_lis
+0000e020: 742c 2070 6c61 6e65 5f63 6f6c 6f72 7329  t, plane_colors)
+0000e030: 0d0a 2020 2020 2020 2020 2020 2020 0d0a  ..            ..
+0000e040: 2020 2020 2020 2020 0d0a 2020 2020 0d0a          ..    ..
+0000e050: 0d0a 2020 2020 6465 6620 706c 6f74 5f64  ..    def plot_d
+0000e060: 656d 2864 6174 612c 2074 7261 6e73 666f  em(data, transfo
+0000e070: 726d 2c20 7072 6f6a 6563 7469 6f6e 2c20  rm, projection, 
+0000e080: 7061 7468 5f74 6f5f 7368 6170 6566 696c  path_to_shapefil
+0000e090: 6529 3a0d 0a20 2020 2020 2020 2067 6c6f  e):..        glo
+0000e0a0: 6261 6c20 6178 5f32 642c 2061 785f 3364  bal ax_2d, ax_3d
+0000e0b0: 2c20 706f 696e 7473 2c20 6361 6e76 6173  , points, canvas
+0000e0c0: 5f32 642c 2063 616e 7661 735f 3364 2c20  _2d, canvas_3d, 
+0000e0d0: 706f 696e 7473 5f6c 6973 7462 6f78 2c20  points_listbox, 
+0000e0e0: 706c 616e 6573 2c20 706c 616e 655f 636f  planes, plane_co
+0000e0f0: 6c6f 7273 2c20 6873 2c20 6c65 6674 2c20  lors, hs, left, 
+0000e100: 7269 6768 742c 2062 6f74 746f 6d2c 2074  right, bottom, t
+0000e110: 6f70 0d0a 2020 2020 2020 2020 706f 696e  op..        poin
+0000e120: 7473 203d 205b 5d0d 0a20 2020 2020 2020  ts = []..       
+0000e130: 2070 6c61 6e65 7320 3d20 5b5d 0d0a 2020   planes = []..  
+0000e140: 2020 2020 2020 706c 616e 655f 636f 6c6f        plane_colo
+0000e150: 7273 203d 205b 5d0d 0a20 2020 2020 2020  rs = []..       
+0000e160: 200d 0a20 2020 2020 2020 200d 0a0d 0a20   ..        .... 
+0000e170: 2020 2020 2020 2068 7320 3d20 6573 2e68         hs = es.h
+0000e180: 696c 6c73 6861 6465 2864 6174 6129 0d0a  illshade(data)..
+0000e190: 0d0a 2020 2020 2020 2020 726f 6f74 203d  ..        root =
+0000e1a0: 2074 6b2e 546b 2829 0d0a 2020 2020 2020   tk.Tk()..      
+0000e1b0: 2020 726f 6f74 2e74 6974 6c65 2822 416b    root.title("Ak
+0000e1c0: 6864 6566 6f5f 4669 7450 6c61 6e65 7322  hdefo_FitPlanes"
+0000e1d0: 290d 0a0d 0a20 2020 2020 2020 206c 6566  )....        lef
+0000e1e0: 742c 2063 656c 6c5f 7369 7a65 5f78 2c20  t, cell_size_x, 
+0000e1f0: 5f2c 2074 6f70 2c20 5f2c 2063 656c 6c5f  _, top, _, cell_
+0000e200: 7369 7a65 5f79 203d 2074 7261 6e73 666f  size_y = transfo
+0000e210: 726d 0d0a 2020 2020 2020 2020 0d0a 2020  rm..        ..  
+0000e220: 2020 2020 200d 0a20 2020 2020 2020 2072       ..        r
+0000e230: 6967 6874 203d 206c 6566 7420 2b20 6365  ight = left + ce
+0000e240: 6c6c 5f73 697a 655f 7820 2a20 6461 7461  ll_size_x * data
+0000e250: 2e73 6861 7065 5b31 5d0d 0a20 2020 2020  .shape[1]..     
+0000e260: 2020 2062 6f74 746f 6d20 3d20 746f 7020     bottom = top 
+0000e270: 2b20 6365 6c6c 5f73 697a 655f 7920 2a20  + cell_size_y * 
+0000e280: 6461 7461 2e73 6861 7065 5b30 5d0d 0a0d  data.shape[0]...
+0000e290: 0a20 2020 2020 2020 2066 6967 3120 3d20  .        fig1 = 
+0000e2a0: 706c 742e 4669 6775 7265 2866 6967 7369  plt.Figure(figsi
+0000e2b0: 7a65 3d28 362c 2036 292c 2064 7069 3d31  ze=(6, 6), dpi=1
+0000e2c0: 3530 290d 0a20 2020 2020 2020 2061 785f  50)..        ax_
+0000e2d0: 3264 203d 2066 6967 312e 6164 645f 7375  2d = fig1.add_su
+0000e2e0: 6270 6c6f 7428 3131 3129 0d0a 2020 2020  bplot(111)..    
+0000e2f0: 2020 2020 6178 5f32 642e 696d 7368 6f77      ax_2d.imshow
+0000e300: 2868 732c 2063 6d61 703d 2767 7261 7927  (hs, cmap='gray'
+0000e310: 2c20 6578 7465 6e74 3d5b 6c65 6674 2c20  , extent=[left, 
+0000e320: 7269 6768 742c 2062 6f74 746f 6d2c 2074  right, bottom, t
+0000e330: 6f70 5d29 0d0a 2020 2020 2020 2020 6178  op])..        ax
+0000e340: 5f32 642e 7365 745f 7469 746c 6528 2748  _2d.set_title('H
+0000e350: 696c 6c73 6861 6465 272c 2066 6f6e 7477  illshade', fontw
+0000e360: 6569 6768 743d 2262 6f6c 6422 2c20 666f  eight="bold", fo
+0000e370: 6e74 7369 7a65 3d31 3429 0d0a 2020 2020  ntsize=14)..    
+0000e380: 2020 2020 6178 5f32 642e 7365 745f 786c      ax_2d.set_xl
+0000e390: 6162 656c 2822 4c6f 6e67 6974 7564 6522  abel("Longitude"
+0000e3a0: 2c20 666f 6e74 7369 7a65 3d31 3229 0d0a  , fontsize=12)..
+0000e3b0: 2020 2020 2020 2020 6178 5f32 642e 7365          ax_2d.se
+0000e3c0: 745f 796c 6162 656c 2822 4c61 7469 7475  t_ylabel("Latitu
+0000e3d0: 6465 222c 2066 6f6e 7473 697a 653d 3132  de", fontsize=12
+0000e3e0: 290d 0a20 2020 2020 2020 2061 785f 3264  )..        ax_2d
+0000e3f0: 2e67 7269 6428 5472 7565 2c20 7768 6963  .grid(True, whic
+0000e400: 683d 2762 6f74 6827 2c20 6c69 6e65 7374  h='both', linest
+0000e410: 796c 653d 272d 2d27 2c20 6c69 6e65 7769  yle='--', linewi
+0000e420: 6474 683d 302e 3529 0d0a 2020 2020 2020  dth=0.5)..      
+0000e430: 2020 6178 5f32 642e 7365 745f 6173 7065    ax_2d.set_aspe
+0000e440: 6374 2827 6571 7561 6c27 290d 0a20 2020  ct('equal')..   
+0000e450: 2020 2020 200d 0a20 2020 2020 2020 200d       ..        .
+0000e460: 0a20 2020 2020 2020 200d 0a20 2020 2020  .        ..     
+0000e470: 2020 2069 6620 7061 7468 5f74 6f5f 7368     if path_to_sh
+0000e480: 6170 6566 696c 6520 6973 206e 6f74 204e  apefile is not N
+0000e490: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
+0000e4a0: 2020 6764 6620 3d20 6770 642e 7265 6164    gdf = gpd.read
+0000e4b0: 5f66 696c 6528 7061 7468 5f74 6f5f 7368  _file(path_to_sh
+0000e4c0: 6170 6566 696c 6529 0d0a 2020 2020 2020  apefile)..      
+0000e4d0: 2020 2020 2020 6966 2067 6466 2e63 7273        if gdf.crs
+0000e4e0: 2e74 6f5f 7374 7269 6e67 2829 2021 3d20  .to_string() != 
+0000e4f0: 7072 6f6a 6563 7469 6f6e 3a0d 0a20 2020  projection:..   
+0000e500: 2020 2020 2020 2020 2020 2020 2067 6466               gdf
+0000e510: 203d 2067 6466 2e74 6f5f 6372 7328 7072   = gdf.to_crs(pr
+0000e520: 6f6a 6563 7469 6f6e 290d 0a20 2020 2020  ojection)..     
+0000e530: 2020 2020 2020 2067 6466 2e70 6c6f 7428         gdf.plot(
+0000e540: 6178 3d61 785f 3264 2c20 636f 6c6f 723d  ax=ax_2d, color=
+0000e550: 2772 6564 272c 206c 6162 656c 3d22 4c69  'red', label="Li
+0000e560: 6e65 6172 2046 6561 7475 7265 7322 290d  near Features").
+0000e570: 0a20 2020 2020 2020 2020 2020 2061 785f  .            ax_
+0000e580: 3264 2e6c 6567 656e 6428 6c6f 633d 2275  2d.legend(loc="u
+0000e590: 7070 6572 206c 6566 7422 290d 0a20 2020  pper left")..   
+0000e5a0: 2020 2020 200d 0a20 2020 2020 2020 2066       ..        f
+0000e5b0: 6967 3220 3d20 706c 742e 4669 6775 7265  ig2 = plt.Figure
+0000e5c0: 2866 6967 7369 7a65 3d28 362c 2036 292c  (figsize=(6, 6),
+0000e5d0: 2064 7069 3d31 3530 290d 0a20 2020 2020   dpi=150)..     
+0000e5e0: 2020 2023 2043 7265 6174 6520 6120 6669     # Create a fi
+0000e5f0: 6775 7265 2061 6e64 2061 7869 730d 0a20  gure and axis.. 
+0000e600: 2020 2020 2020 2061 785f 3364 203d 2066         ax_3d = f
+0000e610: 6967 322e 6164 645f 7375 6270 6c6f 7428  ig2.add_subplot(
+0000e620: 3131 312c 2070 726f 6a65 6374 696f 6e3d  111, projection=
+0000e630: 2733 6427 290d 0a20 2020 2020 2020 2061  '3d')..        a
+0000e640: 785f 3364 2e73 6574 5f74 6974 6c65 2827  x_3d.set_title('
+0000e650: 3344 2044 454d 2077 6974 6820 4669 7474  3D DEM with Fitt
+0000e660: 6564 2050 6c61 6e65 7327 2c20 666f 6e74  ed Planes', font
+0000e670: 7765 6967 6874 3d22 626f 6c64 222c 2066  weight="bold", f
+0000e680: 6f6e 7473 697a 653d 3134 290d 0a20 2020  ontsize=14)..   
+0000e690: 2020 2020 2061 785f 3364 2e73 6574 5f78       ax_3d.set_x
+0000e6a0: 6c61 6265 6c28 224c 6f6e 6769 7475 6465  label("Longitude
+0000e6b0: 222c 2066 6f6e 7473 697a 653d 3132 290d  ", fontsize=12).
+0000e6c0: 0a20 2020 2020 2020 2061 785f 3364 2e73  .        ax_3d.s
+0000e6d0: 6574 5f79 6c61 6265 6c28 224c 6174 6974  et_ylabel("Latit
+0000e6e0: 7564 6522 2c20 666f 6e74 7369 7a65 3d31  ude", fontsize=1
+0000e6f0: 3229 0d0a 2020 2020 2020 2020 6178 5f33  2)..        ax_3
+0000e700: 642e 7365 745f 7a6c 6162 656c 2822 456c  d.set_zlabel("El
+0000e710: 6576 6174 696f 6e22 2c20 666f 6e74 7369  evation", fontsi
+0000e720: 7a65 3d31 3229 0d0a 2020 2020 2020 2020  ze=12)..        
+0000e730: 785f 636f 6f72 6473 203d 206e 702e 6c69  x_coords = np.li
+0000e740: 6e73 7061 6365 286c 6566 742c 2072 6967  nspace(left, rig
+0000e750: 6874 2c20 6461 7461 2e73 6861 7065 5b31  ht, data.shape[1
+0000e760: 5d29 0d0a 2020 2020 2020 2020 795f 636f  ])..        y_co
+0000e770: 6f72 6473 203d 206e 702e 6c69 6e73 7061  ords = np.linspa
+0000e780: 6365 2874 6f70 2c20 626f 7474 6f6d 2c20  ce(top, bottom, 
+0000e790: 6461 7461 2e73 6861 7065 5b30 5d29 0d0a  data.shape[0])..
+0000e7a0: 2020 2020 2020 2020 7878 2c20 7979 203d          xx, yy =
+0000e7b0: 206e 702e 6d65 7368 6772 6964 2878 5f63   np.meshgrid(x_c
+0000e7c0: 6f6f 7264 732c 2079 5f63 6f6f 7264 7329  oords, y_coords)
+0000e7d0: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
+0000e7e0: 2020 2020 0d0a 2020 2020 2020 2020 0d0a      ..        ..
+0000e7f0: 0d0a 2020 2020 2020 2020 0d0a 0d0a 2020  ..        ....  
+0000e800: 2020 2020 2020 2320 6178 5f33 642e 7365        # ax_3d.se
+0000e810: 745f 786c 696d 285b 6c65 6674 2c20 7269  t_xlim([left, ri
+0000e820: 6768 745d 290d 0a20 2020 2020 2020 2023  ght])..        #
+0000e830: 2061 785f 3364 2e73 6574 5f79 6c69 6d28   ax_3d.set_ylim(
+0000e840: 5b62 6f74 746f 6d2c 2074 6f70 5d29 0d0a  [bottom, top])..
+0000e850: 2020 2020 2020 2020 2320 6178 5f33 642e          # ax_3d.
+0000e860: 7365 745f 7a6c 696d 285b 7a6d 696e 2c20  set_zlim([zmin, 
+0000e870: 7a6d 6178 5d29 0d0a 0d0a 2020 2020 2020  zmax])....      
+0000e880: 2020 6672 616d 655f 3264 203d 2074 6b2e    frame_2d = tk.
+0000e890: 4672 616d 6528 726f 6f74 290d 0a20 2020  Frame(root)..   
+0000e8a0: 2020 2020 2066 7261 6d65 5f32 642e 6772       frame_2d.gr
+0000e8b0: 6964 2872 6f77 3d30 2c20 636f 6c75 6d6e  id(row=0, column
+0000e8c0: 3d30 2c20 7374 6963 6b79 3d27 6e73 6577  =0, sticky='nsew
+0000e8d0: 2729 0d0a 2020 2020 2020 2020 2320 6361  ')..        # ca
+0000e8e0: 6e76 6173 5f32 6420 3d20 4669 6775 7265  nvas_2d = Figure
+0000e8f0: 4361 6e76 6173 546b 4167 6728 6669 6731  CanvasTkAgg(fig1
+0000e900: 2c20 6d61 7374 6572 3d66 7261 6d65 5f32  , master=frame_2
+0000e910: 6429 0d0a 2020 2020 2020 2020 2320 6361  d)..        # ca
+0000e920: 6e76 6173 5f32 642e 6765 745f 746b 5f77  nvas_2d.get_tk_w
+0000e930: 6964 6765 7428 292e 7061 636b 2866 696c  idget().pack(fil
+0000e940: 6c3d 746b 2e42 4f54 482c 2065 7870 616e  l=tk.BOTH, expan
+0000e950: 643d 4661 6c73 6529 0d0a 2020 2020 2020  d=False)..      
+0000e960: 2020 2320 746f 6f6c 6261 725f 3264 203d    # toolbar_2d =
+0000e970: 204e 6176 6967 6174 696f 6e54 6f6f 6c62   NavigationToolb
+0000e980: 6172 3254 6b28 6361 6e76 6173 5f32 642c  ar2Tk(canvas_2d,
+0000e990: 2066 7261 6d65 5f32 6429 0d0a 2020 2020   frame_2d)..    
+0000e9a0: 2020 2020 2320 746f 6f6c 6261 725f 3264      # toolbar_2d
+0000e9b0: 2e75 7064 6174 6528 290d 0a20 2020 2020  .update()..     
+0000e9c0: 2020 2023 2043 7265 6174 6520 7468 6520     # Create the 
+0000e9d0: 6361 6e76 6173 2066 6f72 2074 6865 2070  canvas for the p
+0000e9e0: 6c6f 740d 0a20 2020 2020 2020 2063 616e  lot..        can
+0000e9f0: 7661 735f 3264 203d 2046 6967 7572 6543  vas_2d = FigureC
+0000ea00: 616e 7661 7354 6b41 6767 2866 6967 312c  anvasTkAgg(fig1,
+0000ea10: 206d 6173 7465 723d 6672 616d 655f 3264   master=frame_2d
+0000ea20: 290d 0a20 2020 2020 2020 2063 616e 7661  )..        canva
+0000ea30: 735f 3264 2e67 6574 5f74 6b5f 7769 6467  s_2d.get_tk_widg
+0000ea40: 6574 2829 2e70 6163 6b28 6669 6c6c 3d74  et().pack(fill=t
+0000ea50: 6b2e 424f 5448 2c20 6578 7061 6e64 3d54  k.BOTH, expand=T
+0000ea60: 7275 6529 2020 2320 4669 6c6c 2074 6865  rue)  # Fill the
+0000ea70: 2066 7261 6d65 0d0a 2020 2020 2020 2020   frame..        
+0000ea80: 2320 4372 6561 7465 2074 6865 2074 6f6f  # Create the too
+0000ea90: 6c62 6172 2061 6e64 2070 6c61 6365 2069  lbar and place i
+0000eaa0: 7420 6174 2074 6865 2074 6f70 206f 6620  t at the top of 
+0000eab0: 7468 6520 6361 6e76 6173 0d0a 2020 2020  the canvas..    
+0000eac0: 2020 2020 746f 6f6c 6261 725f 3264 203d      toolbar_2d =
+0000ead0: 204e 6176 6967 6174 696f 6e54 6f6f 6c62   NavigationToolb
+0000eae0: 6172 3254 6b28 6361 6e76 6173 5f32 642c  ar2Tk(canvas_2d,
+0000eaf0: 2066 7261 6d65 5f32 6429 0d0a 2020 2020   frame_2d)..    
+0000eb00: 2020 2020 746f 6f6c 6261 725f 3264 2e75      toolbar_2d.u
+0000eb10: 7064 6174 6528 290d 0a20 2020 2020 2020  pdate()..       
+0000eb20: 2074 6f6f 6c62 6172 5f32 642e 7061 636b   toolbar_2d.pack
+0000eb30: 2873 6964 653d 746b 2e54 4f50 2c20 6669  (side=tk.TOP, fi
+0000eb40: 6c6c 3d74 6b2e 5829 2020 2320 5061 636b  ll=tk.X)  # Pack
+0000eb50: 2074 6865 2074 6f6f 6c62 6172 2061 7420   the toolbar at 
+0000eb60: 7468 6520 746f 700d 0a20 2020 2020 2020  the top..       
+0000eb70: 200d 0a20 2020 2020 2020 2023 2323 2323   ..        #####
+0000eb80: 2323 6164 6420 636f 6c6f 7262 6172 2066  ##add colorbar f
+0000eb90: 6967 7572 6520 746f 2043 616e 7661 730d  igure to Canvas.
+0000eba0: 0a20 2020 2020 2020 200d 0a0d 0a0d 0a0d  .        .......
+0000ebb0: 0a20 2020 2020 2020 2066 7261 6d65 5f33  .        frame_3
+0000ebc0: 6420 3d20 746b 2e46 7261 6d65 2872 6f6f  d = tk.Frame(roo
+0000ebd0: 7429 0d0a 2020 2020 2020 2020 6672 616d  t)..        fram
+0000ebe0: 655f 3364 2e67 7269 6428 726f 773d 302c  e_3d.grid(row=0,
+0000ebf0: 2063 6f6c 756d 6e3d 312c 2073 7469 636b   column=1, stick
+0000ec00: 793d 276e 7365 7727 290d 0a20 2020 2020  y='nsew')..     
+0000ec10: 2020 2023 2063 616e 7661 735f 3364 203d     # canvas_3d =
+0000ec20: 2046 6967 7572 6543 616e 7661 7354 6b41   FigureCanvasTkA
+0000ec30: 6767 2866 6967 322c 206d 6173 7465 723d  gg(fig2, master=
+0000ec40: 6672 616d 655f 3364 290d 0a20 2020 2020  frame_3d)..     
+0000ec50: 2020 2023 2063 616e 7661 735f 3364 2e67     # canvas_3d.g
+0000ec60: 6574 5f74 6b5f 7769 6467 6574 2829 2e70  et_tk_widget().p
+0000ec70: 6163 6b28 6669 6c6c 3d74 6b2e 424f 5448  ack(fill=tk.BOTH
+0000ec80: 2c20 6578 7061 6e64 3d46 616c 7365 290d  , expand=False).
+0000ec90: 0a20 2020 2020 2020 2023 2074 6f6f 6c62  .        # toolb
+0000eca0: 6172 5f33 6420 3d20 4e61 7669 6761 7469  ar_3d = Navigati
+0000ecb0: 6f6e 546f 6f6c 6261 7232 546b 2863 616e  onToolbar2Tk(can
+0000ecc0: 7661 735f 3364 2c20 6672 616d 655f 3364  vas_3d, frame_3d
+0000ecd0: 290d 0a20 2020 2020 2020 2023 2074 6f6f  )..        # too
+0000ece0: 6c62 6172 5f33 642e 7570 6461 7465 2829  lbar_3d.update()
+0000ecf0: 0d0a 2020 2020 2020 2020 6361 6e76 6173  ..        canvas
+0000ed00: 5f33 6420 3d20 4669 6775 7265 4361 6e76  _3d = FigureCanv
+0000ed10: 6173 546b 4167 6728 6669 6732 2c20 6d61  asTkAgg(fig2, ma
+0000ed20: 7374 6572 3d66 7261 6d65 5f33 6429 0d0a  ster=frame_3d)..
+0000ed30: 2020 2020 2020 2020 6361 6e76 6173 5f33          canvas_3
+0000ed40: 642e 6765 745f 746b 5f77 6964 6765 7428  d.get_tk_widget(
+0000ed50: 292e 7061 636b 2866 696c 6c3d 746b 2e42  ).pack(fill=tk.B
+0000ed60: 4f54 482c 2065 7870 616e 643d 5472 7565  OTH, expand=True
+0000ed70: 2920 2023 2046 696c 6c20 7468 6520 6672  )  # Fill the fr
+0000ed80: 616d 650d 0a20 2020 2020 2020 2023 2043  ame..        # C
+0000ed90: 7265 6174 6520 7468 6520 746f 6f6c 6261  reate the toolba
+0000eda0: 7220 616e 6420 706c 6163 6520 6974 2061  r and place it a
+0000edb0: 7420 7468 6520 746f 7020 6f66 2074 6865  t the top of the
+0000edc0: 2063 616e 7661 730d 0a20 2020 2020 2020   canvas..       
+0000edd0: 2074 6f6f 6c62 6172 5f33 6420 3d20 4e61   toolbar_3d = Na
+0000ede0: 7669 6761 7469 6f6e 546f 6f6c 6261 7232  vigationToolbar2
+0000edf0: 546b 2863 616e 7661 735f 3364 2c20 6672  Tk(canvas_3d, fr
+0000ee00: 616d 655f 3364 290d 0a20 2020 2020 2020  ame_3d)..       
+0000ee10: 2074 6f6f 6c62 6172 5f33 642e 7570 6461   toolbar_3d.upda
+0000ee20: 7465 2829 0d0a 2020 2020 2020 2020 746f  te()..        to
+0000ee30: 6f6c 6261 725f 3364 2e70 6163 6b28 7369  olbar_3d.pack(si
+0000ee40: 6465 3d74 6b2e 544f 502c 2066 696c 6c3d  de=tk.TOP, fill=
+0000ee50: 746b 2e58 2920 2023 2050 6163 6b20 7468  tk.X)  # Pack th
+0000ee60: 6520 746f 6f6c 6261 7220 6174 2074 6865  e toolbar at the
+0000ee70: 2074 6f70 0d0a 0d0a 2020 2020 2020 2020   top....        
+0000ee80: 2320 4372 6561 7465 2061 2066 7261 6d65  # Create a frame
+0000ee90: 206f 6e20 7468 6520 7269 6768 7420 746f   on the right to
+0000eea0: 2068 6f6c 6420 636f 6e74 726f 6c73 0d0a   hold controls..
+0000eeb0: 2020 2020 2020 2020 636f 6e74 726f 6c73          controls
+0000eec0: 5f66 7261 6d65 203d 2074 6b2e 4672 616d  _frame = tk.Fram
+0000eed0: 6528 726f 6f74 290d 0a20 2020 2020 2020  e(root)..       
+0000eee0: 2063 6f6e 7472 6f6c 735f 6672 616d 652e   controls_frame.
+0000eef0: 6772 6964 2872 6f77 3d30 2c20 636f 6c75  grid(row=0, colu
+0000ef00: 6d6e 3d33 2c20 726f 7773 7061 6e3d 312c  mn=3, rowspan=1,
+0000ef10: 2073 7469 636b 793d 276e 7365 7727 290d   sticky='nsew').
+0000ef20: 0a20 2020 2020 2020 200d 0a0d 0a20 2020  .        ....   
+0000ef30: 2020 2020 2023 204e 6f77 2070 7574 2061       # Now put a
+0000ef40: 6c6c 2062 7574 746f 6e73 2061 6e64 204c  ll buttons and L
+0000ef50: 6973 7462 6f78 2069 6e73 6964 6520 7468  istbox inside th
+0000ef60: 6973 2063 6f6e 7472 6f6c 735f 6672 616d  is controls_fram
+0000ef70: 650d 0a20 2020 2020 2020 2064 7261 775f  e..        draw_
+0000ef80: 6275 7474 6f6e 203d 2074 746b 2e42 7574  button = ttk.But
+0000ef90: 746f 6e28 636f 6e74 726f 6c73 5f66 7261  ton(controls_fra
+0000efa0: 6d65 2c20 7465 7874 3d22 4472 6177 2050  me, text="Draw P
+0000efb0: 6c61 6e65 222c 2063 6f6d 6d61 6e64 3d6c  lane", command=l
+0000efc0: 616d 6264 613a 2064 7261 775f 706c 616e  ambda: draw_plan
+0000efd0: 6528 7878 2c79 7929 290d 0a20 2020 2020  e(xx,yy))..     
+0000efe0: 2020 2064 7261 775f 6275 7474 6f6e 2e70     draw_button.p
+0000eff0: 6163 6b28 7061 6479 3d32 2c20 7061 6478  ack(pady=2, padx
+0000f000: 3d32 290d 0a0d 0a20 2020 2020 2020 206c  =2)....        l
+0000f010: 696e 655f 706c 616e 655f 6275 7474 6f6e  ine_plane_button
+0000f020: 203d 2074 746b 2e42 7574 746f 6e28 636f   = ttk.Button(co
+0000f030: 6e74 726f 6c73 5f66 7261 6d65 2c20 7465  ntrols_frame, te
+0000f040: 7874 3d22 4372 6561 7465 2050 6c61 6e65  xt="Create Plane
+0000f050: 7320 6672 6f6d 204c 696e 6573 222c 2063  s from Lines", c
+0000f060: 6f6d 6d61 6e64 3d6c 616d 6264 613a 2064  ommand=lambda: d
+0000f070: 7261 775f 706c 616e 6573 5f66 726f 6d5f  raw_planes_from_
+0000f080: 6c69 6e65 7328 7878 2c79 7929 290d 0a20  lines(xx,yy)).. 
+0000f090: 2020 2020 2020 206c 696e 655f 706c 616e         line_plan
+0000f0a0: 655f 6275 7474 6f6e 2e70 6163 6b28 7061  e_button.pack(pa
+0000f0b0: 6479 3d32 2c20 7061 6478 3d32 290d 0a0d  dy=2, padx=2)...
+0000f0c0: 0a20 2020 2020 2020 2073 6176 655f 706c  .        save_pl
+0000f0d0: 616e 655f 6275 7474 6f6e 203d 2074 746b  ane_button = ttk
+0000f0e0: 2e42 7574 746f 6e28 636f 6e74 726f 6c73  .Button(controls
+0000f0f0: 5f66 7261 6d65 2c20 7465 7874 3d22 5361  _frame, text="Sa
+0000f100: 7665 2050 6c61 6e65 7320 746f 204f 424a  ve Planes to OBJ
+0000f110: 222c 2063 6f6d 6d61 6e64 3d73 6176 655f  ", command=save_
+0000f120: 706c 616e 6573 5f74 6f5f 6f62 6a29 2023  planes_to_obj) #
+0000f130: 7361 7665 5f66 6974 7465 645f 706c 616e  save_fitted_plan
+0000f140: 6573 5f61 735f 6478 660d 0a20 2020 2020  es_as_dxf..     
+0000f150: 2020 2073 6176 655f 706c 616e 655f 6275     save_plane_bu
+0000f160: 7474 6f6e 2e70 6163 6b28 7061 6479 3d32  tton.pack(pady=2
+0000f170: 2c20 7061 6478 3d32 290d 0a20 2020 2020  , padx=2)..     
+0000f180: 2020 2023 2073 6176 655f 706c 616e 655f     # save_plane_
+0000f190: 6275 7474 6f6e 5f64 7866 203d 2074 746b  button_dxf = ttk
+0000f1a0: 2e42 7574 746f 6e28 636f 6e74 726f 6c73  .Button(controls
+0000f1b0: 5f66 7261 6d65 2c20 7465 7874 3d22 5361  _frame, text="Sa
+0000f1c0: 7665 2050 6c61 6e65 7320 746f 2044 5846  ve Planes to DXF
+0000f1d0: 222c 2063 6f6d 6d61 6e64 3d73 6176 655f  ", command=save_
+0000f1e0: 6669 7474 6564 5f70 6c61 6e65 735f 6173  fitted_planes_as
+0000f1f0: 5f64 7866 290d 0a20 2020 2020 2020 2023  _dxf)..        #
+0000f200: 2073 6176 655f 706c 616e 655f 6275 7474   save_plane_butt
+0000f210: 6f6e 5f64 7866 2e70 6163 6b28 7061 6479  on_dxf.pack(pady
+0000f220: 3d31 302c 2070 6164 783d 3130 290d 0a0d  =10, padx=10)...
+0000f230: 0a20 2020 2020 2020 2070 6f69 6e74 735f  .        points_
+0000f240: 6c69 7374 626f 7820 3d20 746b 2e4c 6973  listbox = tk.Lis
+0000f250: 7462 6f78 2863 6f6e 7472 6f6c 735f 6672  tbox(controls_fr
+0000f260: 616d 652c 2068 6569 6768 743d 352c 2077  ame, height=5, w
+0000f270: 6964 7468 3d34 302c 2065 7870 6f72 7473  idth=40, exports
+0000f280: 656c 6563 7469 6f6e 3d46 616c 7365 290d  election=False).
+0000f290: 0a20 2020 2020 2020 2070 6f69 6e74 735f  .        points_
+0000f2a0: 6c69 7374 626f 782e 7061 636b 2870 6164  listbox.pack(pad
+0000f2b0: 793d 322c 2070 6164 783d 322c 2066 696c  y=2, padx=2, fil
+0000f2c0: 6c3d 2762 6f74 6827 2c20 6578 7061 6e64  l='both', expand
+0000f2d0: 3d54 7275 6529 0d0a 2020 2020 2020 2020  =True)..        
+0000f2e0: 0d0a 2020 2020 2020 2020 7363 726f 6c6c  ..        scroll
+0000f2f0: 6261 7220 3d20 7474 6b2e 5363 726f 6c6c  bar = ttk.Scroll
+0000f300: 6261 7228 636f 6e74 726f 6c73 5f66 7261  bar(controls_fra
+0000f310: 6d65 2c20 6f72 6965 6e74 3d22 7665 7274  me, orient="vert
+0000f320: 6963 616c 222c 2063 6f6d 6d61 6e64 3d70  ical", command=p
+0000f330: 6f69 6e74 735f 6c69 7374 626f 782e 7976  oints_listbox.yv
+0000f340: 6965 7729 0d0a 2020 2020 2020 2020 7363  iew)..        sc
+0000f350: 726f 6c6c 6261 722e 7061 636b 2873 6964  rollbar.pack(sid
+0000f360: 653d 746b 2e52 4947 4854 2c20 6669 6c6c  e=tk.RIGHT, fill
+0000f370: 3d74 6b2e 5929 0d0a 2020 2020 2020 2020  =tk.Y)..        
+0000f380: 0d0a 2020 2020 2020 2020 706f 696e 7473  ..        points
+0000f390: 5f6c 6973 7462 6f78 2e63 6f6e 6669 6728  _listbox.config(
+0000f3a0: 7973 6372 6f6c 6c63 6f6d 6d61 6e64 3d73  yscrollcommand=s
+0000f3b0: 6372 6f6c 6c62 6172 2e73 6574 290d 0a20  crollbar.set).. 
+0000f3c0: 2020 2020 2020 2070 6f69 6e74 735f 6c69         points_li
+0000f3d0: 7374 626f 782e 6269 6e64 2822 3c44 6f75  stbox.bind("<Dou
+0000f3e0: 626c 652d 4275 7474 6f6e 2d31 3e22 2c20  ble-Button-1>", 
+0000f3f0: 6f6e 5f70 6f69 6e74 5f64 6f75 626c 655f  on_point_double_
+0000f400: 636c 6963 6b29 0d0a 2020 2020 2020 2020  click)..        
+0000f410: 2323 2323 0d0a 2020 2020 0d0a 2020 2020  ####..    ..    
+0000f420: 2020 2020 0d0a 2020 2020 2020 2020 2323      ..        ##
+0000f430: 2323 0d0a 0d0a 2020 2020 2020 2020 6669  ##....        fi
+0000f440: 6731 2e63 616e 7661 732e 6d70 6c5f 636f  g1.canvas.mpl_co
+0000f450: 6e6e 6563 7428 2762 7574 746f 6e5f 7072  nnect('button_pr
+0000f460: 6573 735f 6576 656e 7427 2c20 6c61 6d62  ess_event', lamb
+0000f470: 6461 2065 7665 6e74 3a20 6f6e 636c 6963  da event: onclic
+0000f480: 6b28 6576 656e 742c 2070 6f69 6e74 732c  k(event, points,
+0000f490: 2064 6174 612c 2074 7261 6e73 666f 726d   data, transform
+0000f4a0: 2929 0d0a 2020 2020 2020 2020 0d0a 2020  ))..        ..  
+0000f4b0: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
+0000f4c0: 2320 4164 6469 6e67 2074 6865 2073 697a  # Adding the siz
+0000f4d0: 6520 6772 6970 2066 6f72 2077 696e 646f  e grip for windo
+0000f4e0: 7720 7265 7369 7a69 6e67 0d0a 2020 2020  w resizing..    
+0000f4f0: 2020 2020 7369 7a65 6772 6970 203d 2074      sizegrip = t
+0000f500: 746b 2e53 697a 6567 7269 7028 726f 6f74  tk.Sizegrip(root
+0000f510: 290d 0a20 2020 2020 2020 2073 697a 6567  )..        sizeg
+0000f520: 7269 702e 6772 6964 2872 6f77 3d33 2c20  rip.grid(row=3, 
+0000f530: 636f 6c75 6d6e 3d31 2c20 7374 6963 6b79  column=1, sticky
+0000f540: 3d27 6e73 6577 2729 0d0a 0d0a 2020 2020  ='nsew')....    
+0000f550: 2020 2020 2320 4d61 6b69 6e67 2074 6865      # Making the
+0000f560: 2064 6573 6967 6e20 7265 7370 6f6e 7369   design responsi
+0000f570: 7665 0d0a 2020 2020 2020 2020 726f 6f74  ve..        root
+0000f580: 2e67 7269 645f 726f 7763 6f6e 6669 6775  .grid_rowconfigu
+0000f590: 7265 2830 2c20 7765 6967 6874 3d31 2920  re(0, weight=1) 
+0000f5a0: 2023 2043 616e 7661 7320 726f 770d 0a20   # Canvas row.. 
+0000f5b0: 2020 2020 2020 2072 6f6f 742e 6772 6964         root.grid
+0000f5c0: 5f72 6f77 636f 6e66 6967 7572 6528 312c  _rowconfigure(1,
+0000f5d0: 2077 6569 6768 743d 3029 2020 2320 546f   weight=0)  # To
+0000f5e0: 6f6c 6261 7220 726f 770d 0a20 2020 2020  olbar row..     
+0000f5f0: 2020 2072 6f6f 742e 6772 6964 5f72 6f77     root.grid_row
+0000f600: 636f 6e66 6967 7572 6528 322c 2077 6569  configure(2, wei
+0000f610: 6768 743d 3029 2020 2320 4275 7474 6f6e  ght=0)  # Button
+0000f620: 2072 6f77 0d0a 2020 2020 2020 2020 726f   row..        ro
+0000f630: 6f74 2e67 7269 645f 636f 6c75 6d6e 636f  ot.grid_columnco
+0000f640: 6e66 6967 7572 6528 302c 2077 6569 6768  nfigure(0, weigh
+0000f650: 743d 3129 2020 2320 3244 2070 6c6f 7420  t=1)  # 2D plot 
+0000f660: 636f 6c75 6d6e 0d0a 2020 2020 2020 2020  column..        
+0000f670: 726f 6f74 2e67 7269 645f 636f 6c75 6d6e  root.grid_column
+0000f680: 636f 6e66 6967 7572 6528 312c 2077 6569  configure(1, wei
+0000f690: 6768 743d 3129 2020 2320 3344 2070 6c6f  ght=1)  # 3D plo
+0000f6a0: 7420 636f 6c75 6d6e 0d0a 2020 2020 2020  t column..      
+0000f6b0: 2020 0d0a 2020 2020 2020 2020 0d0a 2020    ..        ..  
+0000f6c0: 2020 2020 2020 2020 2020 2020 2020 0d0a                ..
+0000f6d0: 2020 2020 2020 2020 726f 6f74 2e6d 6169          root.mai
+0000f6e0: 6e6c 6f6f 7028 290d 0a0d 0a0d 0a20 2020  nloop()......   
+0000f6f0: 200d 0a20 2020 2070 6c6f 745f 6465 6d28   ..    plot_dem(
+0000f700: 6461 7461 2c20 7472 616e 7366 6f72 6d2c  data, transform,
+0000f710: 2070 726f 6a65 6374 696f 6e2c 206c 696e   projection, lin
+0000f720: 655f 7368 6170 6566 696c 6529 0d0a 2020  e_shapefile)..  
+0000f730: 200d 0a20 2020 200d 0a23 616b 6864 6566   ..    ..#akhdef
+0000f740: 6f5f 6669 7450 6c61 6e65 2864 656d 5f64  o_fitPlane(dem_d
+0000f750: 6174 613d 2763 7572 7269 652f 6465 6d5f  ata='currie/dem_
+0000f760: 316d 2e74 6966 272c 206c 696e 655f 7368  1m.tif', line_sh
+0000f770: 6170 6566 696c 653d 2763 7572 7269 652f  apefile='currie/
+0000f780: 6c69 6e65 732e 7368 7027 2c20 6f75 745f  lines.shp', out_
+0000f790: 706c 616e 6546 6f6c 6465 723d 2750 6c61  planeFolder='Pla
+0000f7a0: 6e65 735f 6f75 742f 6e65 7727 2c20 6c69  nes_out/new', li
+0000f7b0: 6d69 745f 6578 7465 6e64 3d46 616c 7365  mit_extend=False
+0000f7c0: 290d 0a0d 0a69 6d70 6f72 7420 6f73 0d0a  )....import os..
+0000f7d0: 696d 706f 7274 2073 6875 7469 6c0d 0a0d  import shutil...
+0000f7e0: 0a64 6566 206d 6f76 655f 6669 6c65 735f  .def move_files_
+0000f7f0: 7769 7468 5f73 7472 696e 6728 736f 7572  with_string(sour
+0000f800: 6365 5f64 6972 3a20 7374 7220 3d22 222c  ce_dir: str ="",
+0000f810: 2064 6573 745f 6469 723a 2073 7472 203d   dest_dir: str =
+0000f820: 2222 2c20 7365 6172 6368 5f73 7472 696e  "", search_strin
+0000f830: 673a 2073 7472 203d 222e 7469 6622 293a  g: str =".tif"):
+0000f840: 0d0a 2020 2020 2222 220d 0a20 2020 204d  ..    """..    M
+0000f850: 6f76 6520 6669 6c65 7320 6672 6f6d 2061  ove files from a
+0000f860: 2073 6f75 7263 6520 6469 7265 6374 6f72   source director
+0000f870: 7920 746f 2061 2064 6573 7469 6e61 7469  y to a destinati
+0000f880: 6f6e 2064 6972 6563 746f 7279 2062 6173  on directory bas
+0000f890: 6564 206f 6e20 6120 7365 6172 6368 2073  ed on a search s
+0000f8a0: 7472 696e 6720 7072 6573 656e 7420 696e  tring present in
+0000f8b0: 2074 6865 6972 2070 6174 6873 2e0d 0a0d   their paths....
+0000f8c0: 0a20 2020 2050 6172 616d 6574 6572 733a  .    Parameters:
+0000f8d0: 0d0a 2020 2020 2d20 736f 7572 6365 5f64  ..    - source_d
+0000f8e0: 6972 2028 7374 7229 3a20 5468 6520 6469  ir (str): The di
+0000f8f0: 7265 6374 6f72 7920 6672 6f6d 2077 6869  rectory from whi
+0000f900: 6368 2066 696c 6573 2061 7265 2074 6f20  ch files are to 
+0000f910: 6265 206d 6f76 6564 2e0d 0a20 2020 202d  be moved...    -
+0000f920: 2064 6573 745f 6469 7220 2873 7472 293a   dest_dir (str):
+0000f930: 2054 6865 2064 6573 7469 6e61 7469 6f6e   The destination
+0000f940: 2064 6972 6563 746f 7279 2077 6865 7265   directory where
+0000f950: 2066 696c 6573 2077 696c 6c20 6265 206d   files will be m
+0000f960: 6f76 6564 2e0d 0a20 2020 202d 2073 6561  oved...    - sea
+0000f970: 7263 685f 7374 7269 6e67 2028 7374 7229  rch_string (str)
+0000f980: 3a20 5468 6520 7374 7269 6e67 2074 6f20  : The string to 
+0000f990: 7365 6172 6368 2066 6f72 2069 6e20 7468  search for in th
+0000f9a0: 6520 6669 6c65 2070 6174 6873 2e0d 0a0d  e file paths....
+0000f9b0: 0a20 2020 2054 6869 7320 6675 6e63 7469  .    This functi
+0000f9c0: 6f6e 2074 7261 7665 7273 6573 2074 6865  on traverses the
+0000f9d0: 2073 6f75 7263 6520 6469 7265 6374 6f72   source director
+0000f9e0: 792c 2069 6e63 6c75 6469 6e67 2069 7473  y, including its
+0000f9f0: 2073 7562 6469 7265 6374 6f72 6965 732e   subdirectories.
+0000fa00: 200d 0a20 2020 2046 696c 6573 2077 686f   ..    Files who
+0000fa10: 7365 2070 6174 6873 2063 6f6e 7461 696e  se paths contain
+0000fa20: 2074 6865 2073 6561 7263 6820 7374 7269   the search stri
+0000fa30: 6e67 2061 7265 206d 6f76 6564 2074 6f20  ng are moved to 
+0000fa40: 7468 6520 6465 7374 696e 6174 696f 6e20  the destination 
+0000fa50: 6469 7265 6374 6f72 792e 200d 0a20 2020  directory. ..   
+0000fa60: 2049 6620 6120 6669 6c65 2077 6974 6820   If a file with 
+0000fa70: 7468 6520 7361 6d65 206e 616d 6520 6578  the same name ex
+0000fa80: 6973 7473 2069 6e20 7468 6520 6465 7374  ists in the dest
+0000fa90: 696e 6174 696f 6e2c 2069 7427 7320 7265  ination, it's re
+0000faa0: 6e61 6d65 6420 746f 2061 766f 6964 206f  named to avoid o
+0000fab0: 7665 7277 7269 7469 6e67 2e0d 0a0d 0a20  verwriting..... 
+0000fac0: 2020 2045 7272 6f72 7320 6475 7269 6e67     Errors during
+0000fad0: 2066 696c 6520 6d6f 7665 6d65 6e74 2028   file movement (
+0000fae0: 652e 672e 2c20 7065 726d 6973 7369 6f6e  e.g., permission
+0000faf0: 2069 7373 7565 732c 206e 6f6e 2d65 7869   issues, non-exi
+0000fb00: 7374 656e 7420 6469 7265 6374 6f72 6965  stent directorie
+0000fb10: 7329 2061 7265 206c 6f67 6765 6420 6275  s) are logged bu
+0000fb20: 7420 646f 206e 6f74 2073 746f 7020 7468  t do not stop th
+0000fb30: 6520 7072 6f63 6573 732e 0d0a 2020 2020  e process...    
+0000fb40: 2222 220d 0a0d 0a20 2020 2069 6620 6e6f  """....    if no
+0000fb50: 7420 6f73 2e70 6174 682e 6578 6973 7473  t os.path.exists
+0000fb60: 2873 6f75 7263 655f 6469 7229 3a0d 0a20  (source_dir):.. 
+0000fb70: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
+0000fb80: 7565 4572 726f 7228 6622 536f 7572 6365  ueError(f"Source
+0000fb90: 2064 6972 6563 746f 7279 2027 7b73 6f75   directory '{sou
+0000fba0: 7263 655f 6469 727d 2720 646f 6573 206e  rce_dir}' does n
+0000fbb0: 6f74 2065 7869 7374 2e22 290d 0a0d 0a20  ot exist.").... 
+0000fbc0: 2020 2023 2043 7265 6174 6520 7468 6520     # Create the 
+0000fbd0: 6465 7374 696e 6174 696f 6e20 6469 7265  destination dire
+0000fbe0: 6374 6f72 7920 6966 2069 7420 646f 6573  ctory if it does
+0000fbf0: 6e27 7420 6578 6973 740d 0a20 2020 2069  n't exist..    i
+0000fc00: 6620 6e6f 7420 6f73 2e70 6174 682e 6578  f not os.path.ex
+0000fc10: 6973 7473 2864 6573 745f 6469 7229 3a0d  ists(dest_dir):.
+0000fc20: 0a20 2020 2020 2020 206f 732e 6d61 6b65  .        os.make
+0000fc30: 6469 7273 2864 6573 745f 6469 7229 0d0a  dirs(dest_dir)..
+0000fc40: 0d0a 2020 2020 666f 7220 726f 6f74 2c20  ..    for root, 
+0000fc50: 6469 7273 2c20 6669 6c65 7320 696e 206f  dirs, files in o
+0000fc60: 732e 7761 6c6b 2873 6f75 7263 655f 6469  s.walk(source_di
+0000fc70: 7229 3a0d 0a20 2020 2020 2020 2066 6f72  r):..        for
+0000fc80: 2066 696c 6520 696e 2066 696c 6573 3a0d   file in files:.
+0000fc90: 0a20 2020 2020 2020 2020 2020 2066 696c  .            fil
+0000fca0: 655f 7061 7468 203d 206f 732e 7061 7468  e_path = os.path
+0000fcb0: 2e6a 6f69 6e28 726f 6f74 2c20 6669 6c65  .join(root, file
+0000fcc0: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
+0000fcd0: 6620 7365 6172 6368 5f73 7472 696e 6720  f search_string 
+0000fce0: 696e 2066 696c 655f 7061 7468 3a0d 0a20  in file_path:.. 
+0000fcf0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+0000fd00: 6573 745f 6669 6c65 5f70 6174 6820 3d20  est_file_path = 
+0000fd10: 6f73 2e70 6174 682e 6a6f 696e 2864 6573  os.path.join(des
+0000fd20: 745f 6469 722c 2066 696c 6529 0d0a 0d0a  t_dir, file)....
+0000fd30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fd40: 2320 4368 6563 6b20 6966 2074 6865 2066  # Check if the f
+0000fd50: 696c 6520 616c 7265 6164 7920 6578 6973  ile already exis
+0000fd60: 7473 2069 6e20 6465 7374 696e 6174 696f  ts in destinatio
+0000fd70: 6e0d 0a20 2020 2020 2020 2020 2020 2020  n..             
+0000fd80: 2020 2063 6f75 6e74 6572 203d 2031 0d0a     counter = 1..
+0000fd90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fda0: 7768 696c 6520 6f73 2e70 6174 682e 6578  while os.path.ex
+0000fdb0: 6973 7473 2864 6573 745f 6669 6c65 5f70  ists(dest_file_p
+0000fdc0: 6174 6829 3a0d 0a20 2020 2020 2020 2020  ath):..         
+0000fdd0: 2020 2020 2020 2020 2020 2023 2053 706c             # Spl
+0000fde0: 6974 2066 696c 656e 616d 6520 616e 6420  it filename and 
+0000fdf0: 6578 7465 6e73 696f 6e0d 0a20 2020 2020  extension..     
+0000fe00: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0000fe10: 696c 655f 6261 7365 2c20 6669 6c65 5f65  ile_base, file_e
+0000fe20: 7874 656e 7369 6f6e 203d 206f 732e 7061  xtension = os.pa
+0000fe30: 7468 2e73 706c 6974 6578 7428 6669 6c65  th.splitext(file
+0000fe40: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+0000fe50: 2020 2020 2020 2023 2043 7265 6174 6520         # Create 
+0000fe60: 6120 6e65 7720 6669 6c65 6e61 6d65 2077  a new filename w
+0000fe70: 6974 6820 6120 636f 756e 7465 7220 746f  ith a counter to
+0000fe80: 2061 766f 6964 206f 7665 7277 7269 7469   avoid overwriti
+0000fe90: 6e67 0d0a 2020 2020 2020 2020 2020 2020  ng..            
+0000fea0: 2020 2020 2020 2020 6465 7374 5f66 696c          dest_fil
+0000feb0: 655f 7061 7468 203d 206f 732e 7061 7468  e_path = os.path
+0000fec0: 2e6a 6f69 6e28 6465 7374 5f64 6972 2c20  .join(dest_dir, 
+0000fed0: 6622 7b66 696c 655f 6261 7365 7d5f 7b63  f"{file_base}_{c
+0000fee0: 6f75 6e74 6572 7d7b 6669 6c65 5f65 7874  ounter}{file_ext
+0000fef0: 656e 7369 6f6e 7d22 290d 0a20 2020 2020  ension}")..     
+0000ff00: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0000ff10: 6f75 6e74 6572 202b 3d20 310d 0a0d 0a20  ounter += 1.... 
+0000ff20: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0000ff30: 204d 6f76 6520 7468 6520 6669 6c65 2074   Move the file t
+0000ff40: 6f20 7468 6520 6465 7374 696e 6174 696f  o the destinatio
+0000ff50: 6e20 6469 7265 6374 6f72 790d 0a20 2020  n directory..   
+0000ff60: 2020 2020 2020 2020 2020 2020 2074 7279               try
+0000ff70: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0000ff80: 2020 2020 2020 2073 6875 7469 6c2e 6d6f         shutil.mo
+0000ff90: 7665 2866 696c 655f 7061 7468 2c20 6465  ve(file_path, de
+0000ffa0: 7374 5f66 696c 655f 7061 7468 290d 0a20  st_file_path).. 
+0000ffb0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0000ffc0: 7863 6570 7420 4578 6365 7074 696f 6e20  xcept Exception 
+0000ffd0: 6173 2065 3a0d 0a20 2020 2020 2020 2020  as e:..         
+0000ffe0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+0000fff0: 2866 2245 7272 6f72 206d 6f76 696e 6720  (f"Error moving 
+00010000: 6669 6c65 207b 6669 6c65 5f70 6174 687d  file {file_path}
+00010010: 2074 6f20 7b64 6573 745f 6669 6c65 5f70   to {dest_file_p
+00010020: 6174 687d 3a20 7b65 7d22 290d 0a0d 0a23  ath}: {e}")....#
+00010030: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00010040: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00010050: 2323 2323 2323 2323 2323 2323 0d0a 2354  ############..#T
+00010060: 6869 7320 7061 7274 2069 7320 7374 696c  his part is stil
+00010070: 6c20 756e 6465 7220 636f 6e73 7472 7563  l under construc
+00010080: 7469 6f6e 0d0a 0d0a 696d 706f 7274 206e  tion....import n
+00010090: 756d 7079 2061 7320 6e70 0d0a 0d0a 6465  umpy as np....de
+000100a0: 6620 7061 7274 6961 6c5f 6465 7269 7661  f partial_deriva
+000100b0: 7469 7665 2866 2c20 6478 2c20 6479 293a  tive(f, dx, dy):
+000100c0: 0d0a 2020 2020 2222 220d 0a20 2020 2043  ..    """..    C
+000100d0: 616c 6375 6c61 7465 2074 6865 2063 656e  alculate the cen
+000100e0: 7472 616c 2064 6966 6665 7265 6e63 6520  tral difference 
+000100f0: 6170 7072 6f78 696d 6174 696f 6e20 666f  approximation fo
+00010100: 7220 7468 6520 7061 7274 6961 6c20 6465  r the partial de
+00010110: 7269 7661 7469 7665 730d 0a20 2020 206f  rivatives..    o
+00010120: 6620 6120 3244 2066 756e 6374 696f 6e20  f a 2D function 
+00010130: 7769 7468 2072 6573 7065 6374 2074 6f20  with respect to 
+00010140: 7820 616e 6420 792e 0d0a 0d0a 2020 2020  x and y.....    
+00010150: 3a70 6172 616d 2066 3a20 3244 206e 756d  :param f: 2D num
+00010160: 7079 2061 7272 6179 206f 6620 6675 6e63  py array of func
+00010170: 7469 6f6e 2076 616c 7565 732c 2072 6570  tion values, rep
+00010180: 7265 7365 6e74 696e 6720 7468 6520 7261  resenting the ra
+00010190: 7374 6572 0d0a 2020 2020 3a70 6172 616d  ster..    :param
+000101a0: 2064 783a 2053 7061 6369 6e67 2069 6e20   dx: Spacing in 
+000101b0: 7468 6520 782d 6469 7265 6374 696f 6e20  the x-direction 
+000101c0: 2861 7373 756d 6564 2074 6f20 6265 2063  (assumed to be c
+000101d0: 6f6e 7374 616e 7429 0d0a 2020 2020 3a70  onstant)..    :p
+000101e0: 6172 616d 2064 793a 2053 7061 6369 6e67  aram dy: Spacing
+000101f0: 2069 6e20 7468 6520 792d 6469 7265 6374   in the y-direct
+00010200: 696f 6e20 2861 7373 756d 6564 2074 6f20  ion (assumed to 
+00010210: 6265 2063 6f6e 7374 616e 7429 0d0a 2020  be constant)..  
+00010220: 2020 3a72 6574 7572 6e3a 2054 776f 2032    :return: Two 2
+00010230: 4420 6e75 6d70 7920 6172 7261 7973 2c20  D numpy arrays, 
+00010240: 6f6e 6520 666f 7220 7468 6520 7061 7274  one for the part
+00010250: 6961 6c20 6465 7269 7661 7469 7665 2077  ial derivative w
+00010260: 6974 6820 7265 7370 6563 7420 746f 2078  ith respect to x
+00010270: 2028 6466 5f64 7829 0d0a 2020 2020 2020   (df_dx)..      
+00010280: 2020 2020 2020 2061 6e64 206f 6e65 2066         and one f
+00010290: 6f72 2074 6865 2070 6172 7469 616c 2064  or the partial d
+000102a0: 6572 6976 6174 6976 6520 7769 7468 2072  erivative with r
+000102b0: 6573 7065 6374 2074 6f20 7920 2864 665f  espect to y (df_
+000102c0: 6479 290d 0a20 2020 2022 2222 0d0a 2020  dy)..    """..  
+000102d0: 2020 2023 2049 6e69 7469 616c 697a 6520     # Initialize 
+000102e0: 6172 7261 7973 2074 6f20 7374 6f72 6520  arrays to store 
+000102f0: 7468 6520 7061 7274 6961 6c20 6465 7269  the partial deri
+00010300: 7661 7469 7665 730d 0a20 2020 2064 665f  vatives..    df_
+00010310: 6478 203d 206e 702e 7a65 726f 735f 6c69  dx = np.zeros_li
+00010320: 6b65 2866 290d 0a20 2020 2064 665f 6479  ke(f)..    df_dy
+00010330: 203d 206e 702e 7a65 726f 735f 6c69 6b65   = np.zeros_like
+00010340: 2866 290d 0a0d 0a20 2020 2023 2043 6f6d  (f)....    # Com
+00010350: 7075 7465 2074 6865 2070 6172 7469 616c  pute the partial
+00010360: 2064 6572 6976 6174 6976 6573 2066 6f72   derivatives for
+00010370: 2074 6865 2069 6e74 6572 6e61 6c20 706f   the internal po
+00010380: 696e 7473 0d0a 2020 2020 666f 7220 7869  ints..    for xi
+00010390: 2069 6e20 7261 6e67 6528 312c 2066 2e73   in range(1, f.s
+000103a0: 6861 7065 5b30 5d20 2d20 3129 3a0d 0a20  hape[0] - 1):.. 
+000103b0: 2020 2020 2020 2066 6f72 2079 6a20 696e         for yj in
+000103c0: 2072 616e 6765 2831 2c20 662e 7368 6170   range(1, f.shap
+000103d0: 655b 315d 202d 2031 293a 0d0a 2020 2020  e[1] - 1):..    
+000103e0: 2020 2020 2020 2020 6466 5f64 785b 7869          df_dx[xi
+000103f0: 2c20 796a 5d20 3d20 2866 5b78 6920 2b20  , yj] = (f[xi + 
+00010400: 312c 2079 6a5d 202d 2066 5b78 6920 2d20  1, yj] - f[xi - 
+00010410: 312c 2079 6a5d 2920 2f20 2832 202a 2064  1, yj]) / (2 * d
+00010420: 7829 0d0a 2020 2020 2020 2020 2020 2020  x)..            
+00010430: 6466 5f64 795b 7869 2c20 796a 5d20 3d20  df_dy[xi, yj] = 
+00010440: 2866 5b78 692c 2079 6a20 2b20 315d 202d  (f[xi, yj + 1] -
+00010450: 2066 5b78 692c 2079 6a20 2d20 315d 2920   f[xi, yj - 1]) 
+00010460: 2f20 2832 202a 2064 7929 0d0a 0d0a 2020  / (2 * dy)....  
+00010470: 2020 2320 4861 6e64 6c65 2074 6865 2062    # Handle the b
+00010480: 6f75 6e64 6172 6965 7320 6279 2073 6574  oundaries by set
+00010490: 7469 6e67 2074 6865 2064 6572 6976 6174  ting the derivat
+000104a0: 6976 6520 746f 207a 6572 6f20 6f72 2075  ive to zero or u
+000104b0: 7369 6e67 206f 6e65 2d73 6964 6564 2064  sing one-sided d
+000104c0: 6966 6665 7265 6e63 6573 0d0a 2020 2020  ifferences..    
+000104d0: 2320 4865 7265 2077 6520 6368 6f6f 7365  # Here we choose
+000104e0: 2074 6f20 7365 7420 7468 6520 626f 756e   to set the boun
+000104f0: 6461 7279 2064 6572 6976 6174 6976 6520  dary derivative 
+00010500: 746f 207a 6572 6f0d 0a20 2020 2023 2041  to zero..    # A
+00010510: 6c74 6572 6e61 7469 7665 6c79 2c20 7573  lternatively, us
+00010520: 6520 666f 7277 6172 642f 6261 636b 7761  e forward/backwa
+00010530: 7264 2064 6966 6665 7265 6e63 6520 6174  rd difference at
+00010540: 2074 6865 2062 6f75 6e64 6172 6965 7320   the boundaries 
+00010550: 6966 206e 6565 6465 640d 0a0d 0a20 2020  if needed....   
+00010560: 2072 6574 7572 6e20 6466 5f64 782c 2064   return df_dx, d
+00010570: 665f 6479 0d0a 0d0a 0d0a 696d 706f 7274  f_dy......import
+00010580: 206e 756d 7079 2061 7320 6e70 0d0a 696d   numpy as np..im
+00010590: 706f 7274 2072 6173 7465 7269 6f0d 0a0d  port rasterio...
+000105a0: 0a64 6566 2063 616c 6375 6c61 7465 5f73  .def calculate_s
+000105b0: 6c6f 7065 2864 656d 2c20 6173 7065 6374  lope(dem, aspect
+000105c0: 2c20 6478 202c 2064 7929 3a0d 0a20 2020  , dx , dy):..   
+000105d0: 2022 2222 0d0a 2020 2020 4361 6c63 756c   """..    Calcul
+000105e0: 6174 6520 7468 6520 736c 6f70 6520 6174  ate the slope at
+000105f0: 2065 6163 6820 7069 7865 6c20 7573 696e   each pixel usin
+00010600: 6720 7468 6520 6173 7065 6374 2074 6f20  g the aspect to 
+00010610: 6465 7465 726d 696e 6520 6469 7265 6374  determine direct
+00010620: 696f 6e2e 0d0a 0d0a 2020 2020 5061 7261  ion.....    Para
+00010630: 6d65 7465 7273 3a0d 0a20 2020 2064 656d  meters:..    dem
+00010640: 2028 6e75 6d70 792e 6e64 6172 7261 7929   (numpy.ndarray)
+00010650: 3a20 4469 6769 7461 6c20 456c 6576 6174  : Digital Elevat
+00010660: 696f 6e20 4d6f 6465 6c20 2844 454d 2920  ion Model (DEM) 
+00010670: 6172 7261 792e 0d0a 2020 2020 6173 7065  array...    aspe
+00010680: 6374 2028 6e75 6d70 792e 6e64 6172 7261  ct (numpy.ndarra
+00010690: 7929 3a20 4173 7065 6374 2061 7272 6179  y): Aspect array
+000106a0: 2e0d 0a20 2020 2064 7820 2866 6c6f 6174  ...    dx (float
+000106b0: 293a 2020 7820 5370 6174 6961 6c20 7265  ):  x Spatial re
+000106c0: 736f 6c75 7469 6f6e 206f 6620 7468 6520  solution of the 
+000106d0: 7261 7374 6572 2028 6469 7374 616e 6365  raster (distance
+000106e0: 2062 6574 7765 656e 2070 6978 656c 7329   between pixels)
+000106f0: 2e0d 0a20 2020 2064 7920 2866 6c6f 6174  ...    dy (float
+00010700: 293a 2020 7920 5370 6174 6961 6c20 7265  ):  y Spatial re
+00010710: 736f 6c75 7469 6f6e 206f 6620 7468 6520  solution of the 
+00010720: 7261 7374 6572 2028 6469 7374 616e 6365  raster (distance
+00010730: 2062 6574 7765 656e 2070 6978 656c 7329   between pixels)
+00010740: 2e0d 0a0d 0a20 2020 2052 6574 7572 6e73  .....    Returns
+00010750: 3a0d 0a20 2020 206e 756d 7079 2e6e 6461  :..    numpy.nda
+00010760: 7272 6179 3a20 4172 7261 7920 6f66 2073  rray: Array of s
+00010770: 6c6f 7065 2076 616c 7565 7320 696e 2064  lope values in d
+00010780: 6567 7265 6573 2e0d 0a20 2020 2022 2222  egrees...    """
+00010790: 0d0a 2020 2020 0d0a 2020 2020 2320 6772  ..    ..    # gr
+000107a0: 6164 5f79 2c20 6772 6164 5f78 203d 206e  ad_y, grad_x = n
+000107b0: 702e 6772 6164 6965 6e74 2864 656d 2c20  p.gradient(dem, 
+000107c0: 6478 2c20 6479 290d 0a20 2020 200d 0a20  dx, dy)..    .. 
+000107d0: 2020 200d 0a20 2020 2023 2041 7373 756d     ..    # Assum
+000107e0: 696e 6720 2764 656d 2720 616e 6420 2761  ing 'dem' and 'a
+000107f0: 7370 6563 7427 2061 7265 2079 6f75 7220  spect' are your 
+00010800: 6578 6973 7469 6e67 206e 756d 7079 2061  existing numpy a
+00010810: 7272 6179 730d 0a20 2020 2023 2043 6865  rrays..    # Che
+00010820: 636b 2069 6620 7468 6520 7368 6170 6573  ck if the shapes
+00010830: 2061 7265 2064 6966 6665 7265 6e74 0d0a   are different..
+00010840: 2020 2020 2320 6966 2064 656d 2e73 6861      # if dem.sha
+00010850: 7065 2021 3d20 6173 7065 6374 2e73 6861  pe != aspect.sha
+00010860: 7065 3a0d 0a20 2020 2023 2020 2020 2023  pe:..    #     #
+00010870: 2052 6573 697a 6520 2764 656d 2720 746f   Resize 'dem' to
+00010880: 206d 6174 6368 2074 6865 2073 6861 7065   match the shape
+00010890: 206f 6620 2761 7370 6563 7427 0d0a 2020   of 'aspect'..  
+000108a0: 2020 2320 2020 2020 6173 7065 6374 203d    #     aspect =
+000108b0: 206e 702e 7265 7369 7a65 2861 7370 6563   np.resize(aspec
+000108c0: 742c 2064 656d 2e73 6861 7065 290d 0a20  t, dem.shape).. 
+000108d0: 2020 2023 2065 6c73 653a 0d0a 2020 2020     # else:..    
+000108e0: 2320 2020 2020 6173 7065 6374 203d 2061  #     aspect = a
+000108f0: 7370 6563 740d 0a0d 0a0d 0a0d 0a20 2020  spect........   
+00010900: 2067 7261 645f 792c 2067 7261 645f 7820   grad_y, grad_x 
+00010910: 3d20 6e70 2e67 7261 6469 656e 7428 6465  = np.gradient(de
+00010920: 6d2c 2064 782c 2064 7929 0d0a 2020 2020  m, dx, dy)..    
+00010930: 2367 7261 645f 792c 2067 7261 645f 783d  #grad_y, grad_x=
+00010940: 7061 7274 6961 6c5f 6465 7269 7661 7469  partial_derivati
+00010950: 7665 2864 656d 2c20 6478 2c20 6479 290d  ve(dem, dx, dy).
+00010960: 0a0d 0a20 2020 2069 6620 6772 6164 5f78  ...    if grad_x
+00010970: 2e73 6861 7065 2021 3d20 6772 6164 5f79  .shape != grad_y
+00010980: 2e73 6861 7065 3a0d 0a20 2020 2020 2020  .shape:..       
+00010990: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
+000109a0: 7228 2247 7261 6469 656e 7420 6172 7261  r("Gradient arra
+000109b0: 7973 2068 6176 6520 6d69 736d 6174 6368  ys have mismatch
+000109c0: 6564 2073 6861 7065 732e 2229 0d0a 2020  ed shapes.")..  
+000109d0: 2020 0d0a 2020 2020 6173 7065 6374 5f72    ..    aspect_r
+000109e0: 6164 6961 6e73 203d 206e 702e 6465 6732  adians = np.deg2
+000109f0: 7261 6428 6173 7065 6374 290d 0a20 2020  rad(aspect)..   
+00010a00: 2064 6972 6563 7469 6f6e 616c 5f67 7261   directional_gra
+00010a10: 6420 3d20 6e70 2e63 6f73 2861 7370 6563  d = np.cos(aspec
+00010a20: 745f 7261 6469 616e 7329 202a 2067 7261  t_radians) * gra
+00010a30: 645f 7820 2b20 6e70 2e73 696e 2861 7370  d_x + np.sin(asp
+00010a40: 6563 745f 7261 6469 616e 7329 202a 2067  ect_radians) * g
+00010a50: 7261 645f 790d 0a20 2020 2023 736c 6f70  rad_y..    #slop
+00010a60: 655f 6465 6772 6565 7320 3d20 6e70 2e72  e_degrees = np.r
+00010a70: 6164 3264 6567 286e 702e 6172 6374 616e  ad2deg(np.arctan
+00010a80: 2864 6972 6563 7469 6f6e 616c 5f67 7261  (directional_gra
+00010a90: 6429 290d 0a20 2020 0d0a 2020 2020 2320  d))..   ..    # 
+00010aa0: 4361 6c63 756c 6174 6520 736c 6f70 6520  Calculate slope 
+00010ab0: 696e 2072 6164 6961 6e73 0d0a 2020 2020  in radians..    
+00010ac0: 736c 6f70 655f 7261 6469 616e 7320 3d20  slope_radians = 
+00010ad0: 6e70 2e61 7263 7461 6e28 6469 7265 6374  np.arctan(direct
+00010ae0: 696f 6e61 6c5f 6772 6164 290d 0a0d 0a20  ional_grad).... 
+00010af0: 2020 2023 2045 6e73 7572 6520 736c 6f70     # Ensure slop
+00010b00: 6520 6973 2077 6974 6869 6e20 3020 746f  e is within 0 to
+00010b10: 20cf 802f 3220 7261 6469 616e 7320 2830   ../2 radians (0
+00010b20: 2074 6f20 3930 2064 6567 7265 6573 2920   to 90 degrees) 
+00010b30: 7261 6e67 650d 0a20 2020 2023 736c 6f70  range..    #slop
+00010b40: 655f 7261 6469 616e 7320 3d20 736c 6f70  e_radians = slop
+00010b50: 655f 7261 6469 616e 7320 2520 286e 702e  e_radians % (np.
+00010b60: 7069 202f 2032 290d 0a0d 0a20 2020 2023  pi / 2)....    #
+00010b70: 2043 6f6e 7665 7274 2073 6c6f 7065 2074   Convert slope t
+00010b80: 6f20 6465 6772 6565 730d 0a20 2020 2073  o degrees..    s
+00010b90: 6c6f 7065 5f64 6567 7265 6573 203d 2028  lope_degrees = (
+00010ba0: 6e70 2e72 6164 3264 6567 2873 6c6f 7065  np.rad2deg(slope
+00010bb0: 5f72 6164 6961 6e73 2929 2025 2039 3020  _radians)) % 90 
+00010bc0: 0d0a 2020 2020 2373 6c6f 7065 5f64 6567  ..    #slope_deg
+00010bd0: 7265 6573 3d20 2831 3335 2d73 6c6f 7065  rees= (135-slope
+00010be0: 5f64 6567 7265 6573 2925 2039 3020 0d0a  _degrees)% 90 ..
+00010bf0: 2020 2020 0d0a 2020 200d 0a20 2020 200d      ..   ..    .
+00010c00: 0a20 2020 2072 6574 7572 6e20 736c 6f70  .    return slop
+00010c10: 655f 6465 6772 6565 732c 2064 6972 6563  e_degrees, direc
+00010c20: 7469 6f6e 616c 5f67 7261 640d 0a0d 0a64  tional_grad....d
+00010c30: 6566 2063 616c 6375 6c61 7465 5f68 6569  ef calculate_hei
+00010c40: 6768 745f 6368 616e 6765 2873 6c6f 7065  ght_change(slope
+00010c50: 2c20 6469 7374 616e 6365 2c20 6465 6d29  , distance, dem)
+00010c60: 3a0d 0a20 2020 2022 2222 0d0a 2020 2020  :..    """..    
+00010c70: 4361 6c63 756c 6174 6520 7468 6520 6865  Calculate the he
+00010c80: 6967 6874 2063 6861 6e67 6520 7573 696e  ight change usin
+00010c90: 6720 7468 6520 736c 6f70 6520 616e 6420  g the slope and 
+00010ca0: 6469 7374 616e 6365 2066 6f72 2065 6163  distance for eac
+00010cb0: 6820 7069 7865 6c2e 0d0a 0d0a 2020 2020  h pixel.....    
+00010cc0: 5061 7261 6d65 7465 7273 3a0d 0a20 2020  Parameters:..   
+00010cd0: 2073 6c6f 7065 2028 6e75 6d70 792e 6e64   slope (numpy.nd
+00010ce0: 6172 7261 7929 3a20 4172 7261 7920 6f66  array): Array of
+00010cf0: 2073 6c6f 7065 2076 616c 7565 7320 696e   slope values in
+00010d00: 2064 6567 7265 6573 2e0d 0a20 2020 2064   degrees...    d
+00010d10: 6973 7461 6e63 6520 286e 756d 7079 2e6e  istance (numpy.n
+00010d20: 6461 7272 6179 293a 2041 7272 6179 206f  darray): Array o
+00010d30: 6620 6469 7374 616e 6365 2076 616c 7565  f distance value
+00010d40: 732e 0d0a 0d0a 2020 2020 5265 7475 726e  s.....    Return
+00010d50: 733a 0d0a 2020 2020 6e75 6d70 792e 6e64  s:..    numpy.nd
+00010d60: 6172 7261 793a 2041 7272 6179 206f 6620  array: Array of 
+00010d70: 6865 6967 6874 2063 6861 6e67 6573 2e0d  height changes..
+00010d80: 0a20 2020 2022 2222 0d0a 2020 2020 736c  .    """..    sl
+00010d90: 6f70 655f 7261 6469 616e 7320 3d20 6e70  ope_radians = np
+00010da0: 2e64 6567 3272 6164 2873 6c6f 7065 290d  .deg2rad(slope).
+00010db0: 0a20 2020 2068 6569 6768 745f 6368 616e  .    height_chan
+00010dc0: 6765 203d 206e 702e 7461 6e28 736c 6f70  ge = np.tan(slop
+00010dd0: 655f 7261 6469 616e 7329 202a 2064 6973  e_radians) * dis
+00010de0: 7461 6e63 650d 0a20 2020 200d 0a20 2020  tance..    ..   
+00010df0: 200d 0a20 2020 200d 0a20 2020 2072 6574   ..    ..    ret
+00010e00: 7572 6e20 6865 6967 6874 5f63 6861 6e67  urn height_chang
+00010e10: 6520 0d0a 0d0a 6465 6620 6361 6c63 756c  e ....def calcul
+00010e20: 6174 655f 766f 6c75 6d65 5f63 6861 6e67  ate_volume_chang
+00010e30: 6528 6865 6967 6874 5f63 6861 6e67 652c  e(height_change,
+00010e40: 2070 6978 656c 5f61 7265 6129 3a0d 0a20   pixel_area):.. 
+00010e50: 2020 2022 2222 0d0a 2020 2020 4361 6c63     """..    Calc
+00010e60: 756c 6174 6520 7468 6520 766f 6c75 6d65  ulate the volume
+00010e70: 2063 6861 6e67 6520 666f 7220 6561 6368   change for each
+00010e80: 2070 6978 656c 2e0d 0a0d 0a20 2020 2050   pixel.....    P
+00010e90: 6172 616d 6574 6572 733a 0d0a 2020 2020  arameters:..    
+00010ea0: 6865 6967 6874 5f63 6861 6e67 6520 286e  height_change (n
+00010eb0: 756d 7079 2e6e 6461 7272 6179 293a 2041  umpy.ndarray): A
+00010ec0: 7272 6179 206f 6620 6865 6967 6874 2063  rray of height c
+00010ed0: 6861 6e67 6573 2e0d 0a20 2020 2070 6978  hanges...    pix
+00010ee0: 656c 5f61 7265 6120 2866 6c6f 6174 293a  el_area (float):
+00010ef0: 2041 7265 6120 6f66 2061 2073 696e 676c   Area of a singl
+00010f00: 6520 7069 7865 6c2e 0d0a 2020 2020 0d0a  e pixel...    ..
+00010f10: 2020 2020 5265 7475 726e 733a 0d0a 2020      Returns:..  
+00010f20: 2020 6e75 6d70 792e 6e64 6172 7261 793a    numpy.ndarray:
+00010f30: 2041 7272 6179 206f 6620 766f 6c75 6d65   Array of volume
+00010f40: 2063 6861 6e67 6573 2e0d 0a20 2020 2022   changes...    "
+00010f50: 2222 0d0a 2020 2020 766f 6c75 6d65 5f63  ""..    volume_c
+00010f60: 6861 6e67 6520 3d20 6865 6967 6874 5f63  hange = height_c
+00010f70: 6861 6e67 6520 2a20 7069 7865 6c5f 6172  hange * pixel_ar
+00010f80: 6561 0d0a 2020 2020 7072 696e 7420 2866  ea..    print (f
+00010f90: 2754 6f74 616c 2056 6f6c 756d 653a 207b  'Total Volume: {
+00010fa0: 6e70 2e6e 616e 7375 6d28 766f 6c75 6d65  np.nansum(volume
+00010fb0: 5f63 6861 6e67 6529 7d20 6375 6269 6320  _change)} cubic 
+00010fc0: 6d65 7465 7227 290d 0a20 2020 2072 6574  meter')..    ret
+00010fd0: 7572 6e20 766f 6c75 6d65 5f63 6861 6e67  urn volume_chang
+00010fe0: 650d 0a0d 0a66 726f 6d20 736b 696d 6167  e....from skimag
+00010ff0: 652e 6669 6c74 6572 7320 696d 706f 7274  e.filters import
+00011000: 2067 6175 7373 6961 6e0d 0a0d 0a64 6566   gaussian....def
+00011010: 2064 6973 706c 6163 656d 656e 745f 746f   displacement_to
+00011020: 5f76 6f6c 756d 6528 6465 6d5f 7061 7468  _volume(dem_path
+00011030: 3d22 222c 2061 7370 6563 745f 7061 7468  ="", aspect_path
+00011040: 3d22 222c 2064 6973 706c 6163 656d 656e  ="", displacemen
+00011050: 745f 7061 7468 3d22 222c 2073 6c6f 7065  t_path="", slope
+00011060: 5f6f 7574 7075 745f 7061 7468 3d22 222c  _output_path="",
+00011070: 2068 6569 6768 745f 6f75 7470 7574 5f70   height_output_p
+00011080: 6174 683d 2222 2c20 766f 6c75 6d65 5f6f  ath="", volume_o
+00011090: 7574 7075 745f 7061 7468 3d22 222c 2064  utput_path="", d
+000110a0: 783d 4e6f 6e65 202c 2064 793d 4e6f 6e65  x=None , dy=None
+000110b0: 202c 2070 6978 656c 5f61 7265 613d 4e6f   , pixel_area=No
+000110c0: 6e65 293a 0d0a 2020 2020 2222 220d 0a20  ne):..    """.. 
+000110d0: 2020 2050 726f 6365 7373 2074 6865 2044     Process the D
+000110e0: 454d 2c20 6173 7065 6374 2c20 616e 6420  EM, aspect, and 
+000110f0: 6469 7370 6c61 6365 6d65 6e74 2072 6173  displacement ras
+00011100: 7465 7273 2074 6f20 6361 6c63 756c 6174  ters to calculat
+00011110: 6520 616e 6420 6578 706f 7274 2074 6865  e and export the
+00011120: 2073 6c6f 7065 2c20 6865 6967 6874 2063   slope, height c
+00011130: 6861 6e67 652c 2061 6e64 2076 6f6c 756d  hange, and volum
+00011140: 6520 6368 616e 6765 2e0d 0a0d 0a20 2020  e change.....   
+00011150: 2050 6172 616d 6574 6572 733a 0d0a 2020   Parameters:..  
+00011160: 2020 6465 6d5f 7061 7468 2028 7374 7229    dem_path (str)
+00011170: 3a20 5061 7468 2074 6f20 7468 6520 4445  : Path to the DE
+00011180: 4d20 7261 7374 6572 2066 696c 652e 0d0a  M raster file...
+00011190: 2020 2020 6173 7065 6374 5f70 6174 6820      aspect_path 
+000111a0: 2873 7472 293a 2050 6174 6820 746f 2074  (str): Path to t
+000111b0: 6865 2061 7370 6563 7420 7261 7374 6572  he aspect raster
+000111c0: 2066 696c 652e 0d0a 2020 2020 6469 7370   file...    disp
+000111d0: 6c61 6365 6d65 6e74 5f70 6174 6820 2873  lacement_path (s
+000111e0: 7472 293a 2050 6174 6820 746f 2074 6865  tr): Path to the
+000111f0: 2064 6973 706c 6163 656d 656e 7420 7261   displacement ra
+00011200: 7374 6572 2066 696c 652e 0d0a 2020 2020  ster file...    
+00011210: 736c 6f70 655f 6f75 7470 7574 5f70 6174  slope_output_pat
+00011220: 6820 2873 7472 293a 2050 6174 6820 666f  h (str): Path fo
+00011230: 7220 7468 6520 736c 6f70 6520 6f75 7470  r the slope outp
+00011240: 7574 2047 656f 5449 4646 2066 696c 652e  ut GeoTIFF file.
+00011250: 0d0a 2020 2020 6865 6967 6874 5f6f 7574  ..    height_out
+00011260: 7075 745f 7061 7468 2028 7374 7229 3a20  put_path (str): 
+00011270: 5061 7468 2066 6f72 2074 6865 2068 6569  Path for the hei
+00011280: 6768 7420 6368 616e 6765 206f 7574 7075  ght change outpu
+00011290: 7420 4765 6f54 4946 4620 6669 6c65 2e0d  t GeoTIFF file..
+000112a0: 0a20 2020 2076 6f6c 756d 655f 6f75 7470  .    volume_outp
+000112b0: 7574 5f70 6174 6820 2873 7472 293a 2050  ut_path (str): P
+000112c0: 6174 6820 666f 7220 7468 6520 766f 6c75  ath for the volu
+000112d0: 6d65 2063 6861 6e67 6520 6f75 7470 7574  me change output
+000112e0: 2047 656f 5449 4646 2066 696c 652e 0d0a   GeoTIFF file...
+000112f0: 2020 2020 6478 2028 666c 6f61 7429 3a20      dx (float): 
+00011300: 2078 2053 7061 7469 616c 2072 6573 6f6c   x Spatial resol
+00011310: 7574 696f 6e20 6f66 2074 6865 2072 6173  ution of the ras
+00011320: 7465 7220 2864 6973 7461 6e63 6520 6265  ter (distance be
+00011330: 7477 6565 6e20 7069 7865 6c73 292e 0d0a  tween pixels)...
+00011340: 2020 2020 6479 2028 666c 6f61 7429 3a20      dy (float): 
+00011350: 2079 2053 7061 7469 616c 2072 6573 6f6c   y Spatial resol
+00011360: 7574 696f 6e20 6f66 2074 6865 2072 6173  ution of the ras
+00011370: 7465 7220 2864 6973 7461 6e63 6520 6265  ter (distance be
+00011380: 7477 6565 6e20 7069 7865 6c73 292e 0d0a  tween pixels)...
+00011390: 2020 2020 7069 7865 6c5f 6172 6561 2028      pixel_area (
+000113a0: 666c 6f61 7429 3a20 4172 6561 206f 6620  float): Area of 
+000113b0: 6120 7369 6e67 6c65 2070 6978 656c 2e0d  a single pixel..
+000113c0: 0a0d 0a20 2020 2052 6574 7572 6e73 3a0d  ...    Returns:.
+000113d0: 0a20 2020 204e 6f6e 653a 204f 7574 7075  .    None: Outpu
+000113e0: 7473 2047 656f 5449 4646 2066 696c 6573  ts GeoTIFF files
+000113f0: 2061 7420 7468 6520 7370 6563 6966 6965   at the specifie
+00011400: 6420 6f75 7470 7574 2070 6174 6873 2e0d  d output paths..
+00011410: 0a20 2020 2022 2222 0d0a 2020 2020 7769  .    """..    wi
+00011420: 7468 2072 6173 7465 7269 6f2e 6f70 656e  th rasterio.open
+00011430: 2864 656d 5f70 6174 6829 2061 7320 6465  (dem_path) as de
+00011440: 6d5f 7261 7374 6572 2c20 5c0d 0a20 2020  m_raster, \..   
+00011450: 2020 2020 2020 7261 7374 6572 696f 2e6f        rasterio.o
+00011460: 7065 6e28 6173 7065 6374 5f70 6174 6829  pen(aspect_path)
+00011470: 2061 7320 6173 7065 6374 5f72 6173 7465   as aspect_raste
+00011480: 722c 205c 0d0a 2020 2020 2020 2020 2072  r, \..         r
+00011490: 6173 7465 7269 6f2e 6f70 656e 2864 6973  asterio.open(dis
+000114a0: 706c 6163 656d 656e 745f 7061 7468 2920  placement_path) 
+000114b0: 6173 2064 6973 706c 6163 656d 656e 745f  as displacement_
+000114c0: 7261 7374 6572 3a0d 0a0d 0a20 2020 2020  raster:....     
+000114d0: 2020 2064 656d 203d 2064 656d 5f72 6173     dem = dem_ras
+000114e0: 7465 722e 7265 6164 2831 2c20 206d 6173  ter.read(1,  mas
+000114f0: 6b65 643d 5472 7565 290d 0a20 2020 2020  ked=True)..     
+00011500: 2020 2061 7370 6563 7420 3d20 6173 7065     aspect = aspe
+00011510: 6374 5f72 6173 7465 722e 7265 6164 2831  ct_raster.read(1
+00011520: 2c20 206d 6173 6b65 643d 5472 7565 290d  ,  masked=True).
+00011530: 0a20 2020 2020 2020 2064 6973 706c 6163  .        displac
+00011540: 656d 656e 7420 3d20 6469 7370 6c61 6365  ement = displace
+00011550: 6d65 6e74 5f72 6173 7465 722e 7265 6164  ment_raster.read
+00011560: 2831 2c20 206d 6173 6b65 643d 5472 7565  (1,  masked=True
+00011570: 290d 0a20 2020 2020 2020 200d 0a20 2020  )..        ..   
+00011580: 2020 2020 2078 5f72 6573 6f6c 7574 696f       x_resolutio
+00011590: 6e2c 2079 5f72 6573 6f6c 7574 696f 6e20  n, y_resolution 
+000115a0: 3d20 6469 7370 6c61 6365 6d65 6e74 5f72  = displacement_r
+000115b0: 6173 7465 722e 7265 730d 0a20 2020 2020  aster.res..     
+000115c0: 2020 200d 0a20 2020 2020 2020 2069 6620     ..        if 
+000115d0: 6478 2069 7320 4e6f 6e65 3a0d 0a20 2020  dx is None:..   
+000115e0: 2020 2020 2020 2020 2064 783d 785f 7265           dx=x_re
+000115f0: 736f 6c75 7469 6f6e 0d0a 2020 2020 2020  solution..      
+00011600: 2020 6966 2064 7920 6973 204e 6f6e 653a    if dy is None:
+00011610: 0d0a 2020 2020 2020 2020 2020 2020 6479  ..            dy
+00011620: 3d79 5f72 6573 6f6c 7574 696f 6e0d 0a20  =y_resolution.. 
+00011630: 2020 2020 2020 2069 6620 7069 7865 6c5f         if pixel_
+00011640: 6172 6561 2069 7320 4e6f 6e65 3a0d 0a20  area is None:.. 
+00011650: 2020 2020 2020 2020 2020 2070 6978 656c             pixel
+00011660: 5f61 7265 613d 6478 202a 2064 790d 0a20  _area=dx * dy.. 
+00011670: 2020 2020 2020 2066 726f 6d20 7363 6970         from scip
+00011680: 792e 6e64 696d 6167 6520 696d 706f 7274  y.ndimage import
+00011690: 207a 6f6f 6d0d 0a0d 0a20 2020 2020 2020   zoom....       
+000116a0: 2023 2045 7861 6d70 6c65 2064 696d 656e   # Example dimen
+000116b0: 7369 6f6e 7320 2d20 7265 706c 6163 6520  sions - replace 
+000116c0: 7468 6573 6520 7769 7468 2061 6374 7561  these with actua
+000116d0: 6c20 6469 6d65 6e73 696f 6e73 0d0a 2020  l dimensions..  
+000116e0: 2020 2020 2020 6465 6d5f 7368 6170 6520        dem_shape 
+000116f0: 3d20 6465 6d2e 7368 6170 650d 0a20 2020  = dem.shape..   
+00011700: 2020 2020 2061 7370 6563 745f 7368 6170       aspect_shap
+00011710: 6520 3d20 6173 7065 6374 2e73 6861 7065  e = aspect.shape
+00011720: 0d0a 2020 2020 2020 2020 6469 7370 6c61  ..        displa
+00011730: 6365 6d65 6e74 5f73 6861 7065 203d 2064  cement_shape = d
+00011740: 6973 706c 6163 656d 656e 742e 7368 6170  isplacement.shap
+00011750: 650d 0a0d 0a20 2020 2020 2020 2023 2043  e....        # C
+00011760: 616c 6375 6c61 7469 6e67 207a 6f6f 6d20  alculating zoom 
+00011770: 6661 6374 6f72 730d 0a20 2020 2020 2020  factors..       
+00011780: 207a 6f6f 6d5f 6661 6374 6f72 5f61 7370   zoom_factor_asp
+00011790: 6563 7420 3d20 5b64 656d 5f64 696d 202f  ect = [dem_dim /
+000117a0: 2061 7370 6563 745f 6469 6d20 666f 7220   aspect_dim for 
+000117b0: 6465 6d5f 6469 6d2c 2061 7370 6563 745f  dem_dim, aspect_
+000117c0: 6469 6d20 696e 207a 6970 2864 656d 5f73  dim in zip(dem_s
+000117d0: 6861 7065 2c20 6173 7065 6374 5f73 6861  hape, aspect_sha
+000117e0: 7065 295d 0d0a 2020 2020 2020 2020 7a6f  pe)]..        zo
+000117f0: 6f6d 5f66 6163 746f 725f 6469 7370 6c61  om_factor_displa
+00011800: 6365 6d65 6e74 203d 205b 6465 6d5f 6469  cement = [dem_di
+00011810: 6d20 2f20 6469 7370 6c61 6365 6d65 6e74  m / displacement
+00011820: 5f64 696d 2066 6f72 2064 656d 5f64 696d  _dim for dem_dim
+00011830: 2c20 6469 7370 6c61 6365 6d65 6e74 5f64  , displacement_d
+00011840: 696d 2069 6e20 7a69 7028 6465 6d5f 7368  im in zip(dem_sh
+00011850: 6170 652c 2064 6973 706c 6163 656d 656e  ape, displacemen
+00011860: 745f 7368 6170 6529 5d0d 0a0d 0a20 2020  t_shape)]....   
+00011870: 2020 2020 2023 2052 6573 697a 696e 6720       # Resizing 
+00011880: 6173 7065 6374 2061 6e64 2064 6973 706c  aspect and displ
+00011890: 6163 656d 656e 7420 6172 7261 7973 0d0a  acement arrays..
+000118a0: 2020 2020 2020 2020 6173 7065 6374 203d          aspect =
+000118b0: 207a 6f6f 6d28 6173 7065 6374 2c20 7a6f   zoom(aspect, zo
+000118c0: 6f6d 5f66 6163 746f 725f 6173 7065 6374  om_factor_aspect
+000118d0: 2c20 6f72 6465 723d 3129 2020 2320 6375  , order=1)  # cu
+000118e0: 6269 6320 696e 7465 7270 6f6c 6174 696f  bic interpolatio
+000118f0: 6e0d 0a20 2020 2020 2020 2064 6973 706c  n..        displ
+00011900: 6163 656d 656e 7420 3d20 7a6f 6f6d 2864  acement = zoom(d
+00011910: 6973 706c 6163 656d 656e 742c 207a 6f6f  isplacement, zoo
+00011920: 6d5f 6661 6374 6f72 5f64 6973 706c 6163  m_factor_displac
+00011930: 656d 656e 742c 206f 7264 6572 3d31 2920  ement, order=1) 
+00011940: 2023 2063 7562 6963 2069 6e74 6572 706f   # cubic interpo
+00011950: 6c61 7469 6f6e 0d0a 2020 2020 2020 2020  lation..        
+00011960: 0d0a 2020 2020 2020 2020 2320 6173 7065  ..        # aspe
+00011970: 6374 203d 206e 702e 7265 7369 7a65 2861  ct = np.resize(a
+00011980: 7370 6563 742c 2064 656d 2e73 6861 7065  spect, dem.shape
+00011990: 290d 0a20 2020 2020 2020 2023 2064 6973  )..        # dis
+000119a0: 706c 6163 656d 656e 7420 3d20 6e70 2e72  placement = np.r
+000119b0: 6573 697a 6528 6469 7370 6c61 6365 6d65  esize(displaceme
+000119c0: 6e74 2c20 6465 6d2e 7368 6170 6529 0d0a  nt, dem.shape)..
+000119d0: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
+000119e0: 2020 736c 6f70 652c 2064 6972 6563 7469    slope, directi
+000119f0: 6f6e 616c 5f67 7261 6420 3d20 6361 6c63  onal_grad = calc
+00011a00: 756c 6174 655f 736c 6f70 6528 6465 6d2c  ulate_slope(dem,
+00011a10: 2061 7370 6563 742c 2064 7820 2c20 6479   aspect, dx , dy
+00011a20: 2029 0d0a 2020 2020 2020 2020 6865 6967   )..        heig
+00011a30: 6874 5f63 6861 6e67 6520 203d 2063 616c  ht_change  = cal
+00011a40: 6375 6c61 7465 5f68 6569 6768 745f 6368  culate_height_ch
+00011a50: 616e 6765 2873 6c6f 7065 2c20 6469 7265  ange(slope, dire
+00011a60: 6374 696f 6e61 6c5f 6772 6164 2c20 6465  ctional_grad, de
+00011a70: 6d29 0d0a 2020 2020 2020 2020 2368 6569  m)..        #hei
+00011a80: 6768 745f 6368 616e 6765 3d67 6175 7373  ght_change=gauss
+00011a90: 6961 6e28 6865 6967 6874 5f63 6861 6e67  ian(height_chang
+00011aa0: 652c 2073 6967 6d61 3d33 290d 0a20 2020  e, sigma=3)..   
+00011ab0: 2020 2020 2076 6f6c 756d 655f 6368 616e       volume_chan
+00011ac0: 6765 203d 2063 616c 6375 6c61 7465 5f76  ge = calculate_v
+00011ad0: 6f6c 756d 655f 6368 616e 6765 2868 6569  olume_change(hei
+00011ae0: 6768 745f 6368 616e 6765 2c20 7069 7865  ght_change, pixe
+00011af0: 6c5f 6172 6561 290d 0a20 2020 2020 2020  l_area)..       
+00011b00: 0d0a 2020 2020 2020 200d 0a0d 0a20 2020  ..       ....   
+00011b10: 2020 2020 2023 2044 6566 696e 6520 6120       # Define a 
+00011b20: 6675 6e63 7469 6f6e 2074 6f20 6578 706f  function to expo
+00011b30: 7274 2064 6174 6120 746f 2061 2047 656f  rt data to a Geo
+00011b40: 5449 4646 0d0a 2020 2020 2020 2020 6465  TIFF..        de
+00011b50: 6620 6578 706f 7274 5f74 6f5f 6765 6f74  f export_to_geot
+00011b60: 6966 6628 6461 7461 2c20 6f75 7470 7574  iff(data, output
+00011b70: 5f70 6174 682c 2072 6566 6572 656e 6365  _path, reference
+00011b80: 5f72 6173 7465 7229 3a0d 0a20 2020 2020  _raster):..     
+00011b90: 2020 2020 2020 2077 6974 6820 7261 7374         with rast
+00011ba0: 6572 696f 2e6f 7065 6e28 0d0a 2020 2020  erio.open(..    
+00011bb0: 2020 2020 2020 2020 2020 2020 6f75 7470              outp
+00011bc0: 7574 5f70 6174 682c 2027 7727 2c0d 0a20  ut_path, 'w',.. 
+00011bd0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00011be0: 7269 7665 723d 2747 5469 6666 272c 0d0a  river='GTiff',..
+00011bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011c00: 6865 6967 6874 3d64 6174 612e 7368 6170  height=data.shap
+00011c10: 655b 305d 2c0d 0a20 2020 2020 2020 2020  e[0],..         
+00011c20: 2020 2020 2020 2077 6964 7468 3d64 6174         width=dat
+00011c30: 612e 7368 6170 655b 315d 2c0d 0a20 2020  a.shape[1],..   
+00011c40: 2020 2020 2020 2020 2020 2020 2063 6f75               cou
+00011c50: 6e74 3d31 2c0d 0a20 2020 2020 2020 2020  nt=1,..         
+00011c60: 2020 2020 2020 2064 7479 7065 3d6e 702e         dtype=np.
+00011c70: 666c 6f61 7433 322c 0d0a 2020 2020 2020  float32,..      
+00011c80: 2020 2020 2020 2020 2020 6372 733d 7265            crs=re
+00011c90: 6665 7265 6e63 655f 7261 7374 6572 2e63  ference_raster.c
+00011ca0: 7273 2c0d 0a20 2020 2020 2020 2020 2020  rs,..           
+00011cb0: 2020 2020 2074 7261 6e73 666f 726d 3d72       transform=r
+00011cc0: 6566 6572 656e 6365 5f72 6173 7465 722e  eference_raster.
+00011cd0: 7472 616e 7366 6f72 6d2c 206e 6f64 6174  transform, nodat
+00011ce0: 613d 6e70 2e6e 616e 0d0a 2020 2020 2020  a=np.nan..      
+00011cf0: 2020 2020 2020 2920 6173 206f 7574 7075        ) as outpu
+00011d00: 745f 7261 7374 6572 3a0d 0a20 2020 2020  t_raster:..     
+00011d10: 2020 2020 2020 2020 2020 206f 7574 7075             outpu
+00011d20: 745f 7261 7374 6572 2e77 7269 7465 2864  t_raster.write(d
+00011d30: 6174 612c 2031 290d 0a0d 0a20 2020 2020  ata, 1)....     
+00011d40: 2020 2023 2045 7870 6f72 7469 6e67 2073     # Exporting s
+00011d50: 6c6f 7065 2c20 6865 6967 6874 2063 6861  lope, height cha
+00011d60: 6e67 652c 2061 6e64 2076 6f6c 756d 6520  nge, and volume 
+00011d70: 6368 616e 6765 2074 6f20 4765 6f54 4946  change to GeoTIF
+00011d80: 4673 0d0a 2020 2020 2020 2020 6578 706f  Fs..        expo
+00011d90: 7274 5f74 6f5f 6765 6f74 6966 6628 736c  rt_to_geotiff(sl
+00011da0: 6f70 652c 2073 6c6f 7065 5f6f 7574 7075  ope, slope_outpu
+00011db0: 745f 7061 7468 2c20 6465 6d5f 7261 7374  t_path, dem_rast
+00011dc0: 6572 290d 0a20 2020 2020 2020 2065 7870  er)..        exp
+00011dd0: 6f72 745f 746f 5f67 656f 7469 6666 2868  ort_to_geotiff(h
+00011de0: 6569 6768 745f 6368 616e 6765 2c20 6865  eight_change, he
+00011df0: 6967 6874 5f6f 7574 7075 745f 7061 7468  ight_output_path
+00011e00: 2c20 6465 6d5f 7261 7374 6572 290d 0a20  , dem_raster).. 
+00011e10: 2020 2020 2020 2065 7870 6f72 745f 746f         export_to
+00011e20: 5f67 656f 7469 6666 2876 6f6c 756d 655f  _geotiff(volume_
+00011e30: 6368 616e 6765 2c20 766f 6c75 6d65 5f6f  change, volume_o
+00011e40: 7574 7075 745f 7061 7468 2c20 6465 6d5f  utput_path, dem_
+00011e50: 7261 7374 6572 290d 0a20 2020 2020 2020  raster)..       
+00011e60: 0d0a 0d0a 0d0a 0d0a 696d 706f 7274 206e  ........import n
+00011e70: 756d 7079 2061 7320 6e70 0d0a 6672 6f6d  umpy as np..from
+00011e80: 206f 7367 656f 2069 6d70 6f72 7420 6764   osgeo import gd
+00011e90: 616c 0d0a 0d0a 6465 6620 6361 6c63 756c  al....def calcul
+00011ea0: 6174 655f 616e 645f 7361 7665 5f61 7370  ate_and_save_asp
+00011eb0: 6563 745f 7261 7374 6572 2865 775f 7261  ect_raster(ew_ra
+00011ec0: 7374 6572 5f70 6174 683a 2073 7472 203d  ster_path: str =
+00011ed0: 2222 2c20 6e73 5f72 6173 7465 725f 7061  "", ns_raster_pa
+00011ee0: 7468 3a20 7374 7220 3d22 222c 206f 7574  th: str ="", out
+00011ef0: 7075 745f 7261 7374 6572 5f70 6174 683a  put_raster_path:
+00011f00: 2073 7472 203d 2222 293a 0d0a 2020 2020   str =""):..    
+00011f10: 2222 220d 0a20 2020 2043 616c 6375 6c61  """..    Calcula
+00011f20: 7465 2074 6865 2061 7370 6563 7420 7261  te the aspect ra
+00011f30: 7374 6572 2066 726f 6d20 6561 7374 2d77  ster from east-w
+00011f40: 6573 7420 616e 6420 6e6f 7274 682d 736f  est and north-so
+00011f50: 7574 6820 6469 7370 6c61 6365 6d65 6e74  uth displacement
+00011f60: 2072 6173 7465 7273 2061 6e64 2073 6176   rasters and sav
+00011f70: 6520 6974 2e0d 0a0d 0a20 2020 2054 6869  e it.....    Thi
+00011f80: 7320 6675 6e63 7469 6f6e 2072 6561 6473  s function reads
+00011f90: 2074 776f 2072 6173 7465 7220 6669 6c65   two raster file
+00011fa0: 7320 7265 7072 6573 656e 7469 6e67 2065  s representing e
+00011fb0: 6173 742d 7765 7374 2028 4557 2920 616e  ast-west (EW) an
+00011fc0: 6420 6e6f 7274 682d 736f 7574 6820 284e  d north-south (N
+00011fd0: 5329 200d 0a20 2020 2064 6973 706c 6163  S) ..    displac
+00011fe0: 656d 656e 7473 2c20 6361 6c63 756c 6174  ements, calculat
+00011ff0: 6573 2074 6865 2061 7370 6563 7420 6f66  es the aspect of
+00012000: 2065 6163 6820 7069 7865 6c2c 2061 6e64   each pixel, and
+00012010: 2073 6176 6573 2074 6865 2072 6573 756c   saves the resul
+00012020: 7420 6173 2061 206e 6577 2072 6173 7465  t as a new raste
+00012030: 7220 6669 6c65 2e0d 0a20 2020 2041 7370  r file...    Asp
+00012040: 6563 7420 6973 2063 616c 6375 6c61 7465  ect is calculate
+00012050: 6420 696e 2064 6567 7265 6573 2066 726f  d in degrees fro
+00012060: 6d20 6e6f 7274 6820 2830 2064 6567 7265  m north (0 degre
+00012070: 6573 292c 2065 6173 7420 2839 3020 6465  es), east (90 de
+00012080: 6772 6565 7329 2c20 736f 7574 6820 2831  grees), south (1
+00012090: 3830 2064 6567 7265 6573 292c 0d0a 2020  80 degrees),..  
+000120a0: 2020 616e 6420 7765 7374 2028 3237 3020    and west (270 
+000120b0: 6465 6772 6565 7329 2e0d 0a0d 0a20 2020  degrees).....   
+000120c0: 2050 6172 616d 6574 6572 733a 0d0a 2020   Parameters:..  
+000120d0: 2020 2d20 6577 5f72 6173 7465 725f 7061    - ew_raster_pa
+000120e0: 7468 2028 7374 7229 3a20 4669 6c65 2070  th (str): File p
+000120f0: 6174 6820 666f 7220 7468 6520 6561 7374  ath for the east
+00012100: 2d77 6573 7420 6469 7370 6c61 6365 6d65  -west displaceme
+00012110: 6e74 2072 6173 7465 722e 0d0a 2020 2020  nt raster...    
+00012120: 2d20 6e73 5f72 6173 7465 725f 7061 7468  - ns_raster_path
+00012130: 2028 7374 7229 3a20 4669 6c65 2070 6174   (str): File pat
+00012140: 6820 666f 7220 7468 6520 6e6f 7274 682d  h for the north-
+00012150: 736f 7574 6820 6469 7370 6c61 6365 6d65  south displaceme
+00012160: 6e74 2072 6173 7465 722e 0d0a 2020 2020  nt raster...    
+00012170: 2d20 6f75 7470 7574 5f72 6173 7465 725f  - output_raster_
+00012180: 7061 7468 2028 7374 7229 3a20 4669 6c65  path (str): File
+00012190: 2070 6174 6820 666f 7220 7468 6520 6f75   path for the ou
+000121a0: 7470 7574 2061 7370 6563 7420 7261 7374  tput aspect rast
+000121b0: 6572 2e0d 0a0d 0a20 2020 2052 6574 7572  er.....    Retur
+000121c0: 6e73 3a0d 0a20 2020 204e 6f6e 652e 2054  ns:..    None. T
+000121d0: 6865 2072 6573 756c 7420 6973 2073 6176  he result is sav
+000121e0: 6564 2061 7320 6120 6e65 7720 7261 7374  ed as a new rast
+000121f0: 6572 2066 696c 6520 6174 2074 6865 2073  er file at the s
+00012200: 7065 6369 6669 6564 206f 7574 7075 7420  pecified output 
+00012210: 7061 7468 2e0d 0a20 2020 200d 0a20 2020  path...    ..   
+00012220: 2022 2222 0d0a 2020 2020 6465 6620 7265   """..    def re
+00012230: 6164 5f72 6173 7465 7228 6669 6c65 5f70  ad_raster(file_p
+00012240: 6174 6829 3a0d 0a20 2020 2020 2020 2022  ath):..        "
+00012250: 2222 5265 6164 2061 2072 6173 7465 7220  ""Read a raster 
+00012260: 6669 6c65 2061 6e64 2072 6574 7572 6e20  file and return 
+00012270: 7468 6520 6461 7461 2061 7272 6179 2061  the data array a
+00012280: 6e64 2067 656f 7472 616e 7366 6f72 6d2e  nd geotransform.
+00012290: 2222 220d 0a0d 0a20 2020 2020 2020 2023  """....        #
+000122a0: 204f 7065 6e20 7468 6520 6461 7461 7365   Open the datase
+000122b0: 740d 0a20 2020 2020 2020 2064 6174 6173  t..        datas
+000122c0: 6574 203d 2067 6461 6c2e 4f70 656e 2866  et = gdal.Open(f
+000122d0: 696c 655f 7061 7468 290d 0a20 2020 2020  ile_path)..     
+000122e0: 2020 2069 6620 6461 7461 7365 7420 6973     if dataset is
+000122f0: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
+00012300: 2020 2020 7261 6973 6520 494f 4572 726f      raise IOErro
+00012310: 7228 2243 6f75 6c64 206e 6f74 206f 7065  r("Could not ope
+00012320: 6e20 6669 6c65 2061 7420 7b7d 222e 666f  n file at {}".fo
+00012330: 726d 6174 2866 696c 655f 7061 7468 2929  rmat(file_path))
+00012340: 0d0a 0d0a 2020 2020 2020 2020 2320 4765  ....        # Ge
+00012350: 7420 7468 6520 6669 7273 7420 7261 7374  t the first rast
+00012360: 6572 2062 616e 640d 0a20 2020 2020 2020  er band..       
+00012370: 2062 616e 6420 3d20 6461 7461 7365 742e   band = dataset.
+00012380: 4765 7452 6173 7465 7242 616e 6428 3129  GetRasterBand(1)
+00012390: 0d0a 0d0a 2020 2020 2020 2020 2320 5265  ....        # Re
+000123a0: 6164 2074 6865 2064 6174 6120 6173 2061  ad the data as a
+000123b0: 206e 756d 7079 2061 7272 6179 0d0a 2020   numpy array..  
+000123c0: 2020 2020 2020 6461 7461 203d 2062 616e        data = ban
+000123d0: 642e 5265 6164 4173 4172 7261 7928 290d  d.ReadAsArray().
+000123e0: 0a0d 0a20 2020 2020 2020 2023 2047 6574  ...        # Get
+000123f0: 206e 6f2d 6461 7461 2076 616c 7565 2066   no-data value f
+00012400: 726f 6d20 7468 6520 6261 6e64 0d0a 2020  rom the band..  
+00012410: 2020 2020 2020 6e6f 6461 7461 5f76 616c        nodata_val
+00012420: 7565 203d 2062 616e 642e 4765 744e 6f44  ue = band.GetNoD
+00012430: 6174 6156 616c 7565 2829 0d0a 0d0a 2020  ataValue()....  
+00012440: 2020 2020 2020 2320 4368 6563 6b20 6966        # Check if
+00012450: 2074 6865 7265 2069 7320 6120 6e6f 2d64   there is a no-d
+00012460: 6174 6120 7661 6c75 6520 6465 6669 6e65  ata value define
+00012470: 640d 0a20 2020 2020 2020 2069 6620 6e6f  d..        if no
+00012480: 6461 7461 5f76 616c 7565 2069 7320 6e6f  data_value is no
+00012490: 7420 4e6f 6e65 3a0d 0a20 2020 2020 2020  t None:..       
+000124a0: 2020 2020 2023 2043 7265 6174 6520 6120       # Create a 
+000124b0: 6d61 736b 2074 6861 7420 6973 2054 7275  mask that is Tru
+000124c0: 6520 666f 7220 7661 6c69 6420 7069 7865  e for valid pixe
+000124d0: 6c73 0d0a 2020 2020 2020 2020 2020 2020  ls..            
+000124e0: 6d61 736b 203d 2064 6174 6120 213d 206e  mask = data != n
+000124f0: 6f64 6174 615f 7661 6c75 650d 0a0d 0a20  odata_value.... 
+00012500: 2020 2020 2020 2020 2020 2023 2041 7070             # App
+00012510: 6c79 2074 6865 206d 6173 6b20 746f 2066  ly the mask to f
+00012520: 696c 7465 7220 6f75 7420 6e6f 2d64 6174  ilter out no-dat
+00012530: 6120 7069 7865 6c73 0d0a 2020 2020 2020  a pixels..      
+00012540: 2020 2020 2020 7661 6c69 645f 6461 7461        valid_data
+00012550: 203d 206e 702e 7768 6572 6528 6d61 736b   = np.where(mask
+00012560: 2c20 6461 7461 2c20 6e70 2e6e 616e 2920  , data, np.nan) 
+00012570: 2023 2052 6570 6c61 6365 206e 6f2d 6461   # Replace no-da
+00012580: 7461 2077 6974 6820 4e61 4e0d 0a20 2020  ta with NaN..   
+00012590: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+000125a0: 2020 2020 2020 2020 7661 6c69 645f 6461          valid_da
+000125b0: 7461 203d 2064 6174 6120 2023 2041 6c6c  ta = data  # All
+000125c0: 2064 6174 6120 6973 2076 616c 6964 2069   data is valid i
+000125d0: 6620 7468 6572 6520 6973 206e 6f20 6e6f  f there is no no
+000125e0: 2d64 6174 6120 7661 6c75 650d 0a0d 0a20  -data value.... 
+000125f0: 2020 2020 2020 2023 2052 6574 7269 6576         # Retriev
+00012600: 6520 6765 6f74 7261 6e73 666f 726d 6174  e geotransformat
+00012610: 696f 6e0d 0a20 2020 2020 2020 2067 656f  ion..        geo
+00012620: 7472 616e 7366 6f72 6d20 3d20 6461 7461  transform = data
+00012630: 7365 742e 4765 7447 656f 5472 616e 7366  set.GetGeoTransf
+00012640: 6f72 6d28 290d 0a0d 0a20 2020 2020 2020  orm()....       
+00012650: 2023 2043 6c6f 7365 2074 6865 2064 6174   # Close the dat
+00012660: 6173 6574 0d0a 2020 2020 2020 2020 2364  aset..        #d
+00012670: 6174 6173 6574 203d 204e 6f6e 650d 0a0d  ataset = None...
+00012680: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00012690: 7661 6c69 645f 6461 7461 2c20 6765 6f74  valid_data, geot
+000126a0: 7261 6e73 666f 726d 2c20 6461 7461 7365  ransform, datase
+000126b0: 740d 0a0d 0a20 2020 2064 6566 2063 616c  t....    def cal
+000126c0: 6375 6c61 7465 5f61 7370 6563 7428 6577  culate_aspect(ew
+000126d0: 5f64 6174 612c 206e 735f 6461 7461 293a  _data, ns_data):
+000126e0: 0d0a 2020 2020 2020 2020 2222 2243 616c  ..        """Cal
+000126f0: 6375 6c61 7465 2074 6865 2061 7370 6563  culate the aspec
+00012700: 7420 6672 6f6d 2045 5720 616e 6420 4e53  t from EW and NS
+00012710: 2064 6973 706c 6163 656d 656e 7420 6461   displacement da
+00012720: 7461 2e22 2222 0d0a 2020 2020 2020 2020  ta."""..        
+00012730: 7769 7468 206e 702e 6572 7273 7461 7465  with np.errstate
+00012740: 2864 6976 6964 653d 2769 676e 6f72 6527  (divide='ignore'
+00012750: 2c20 696e 7661 6c69 643d 2769 676e 6f72  , invalid='ignor
+00012760: 6527 293a 0d0a 2020 2020 2020 2020 2020  e'):..          
+00012770: 2020 6173 7065 6374 203d 206e 702e 6172    aspect = np.ar
+00012780: 6374 616e 3228 6577 5f64 6174 612c 206e  ctan2(ew_data, n
+00012790: 735f 6461 7461 290d 0a20 2020 2020 2020  s_data)..       
+000127a0: 2020 2020 2061 7370 6563 745f 6465 673d       aspect_deg=
+000127b0: 6e70 2e64 6567 7265 6573 2861 7370 6563  np.degrees(aspec
+000127c0: 7429 0d0a 2020 2020 2020 2020 2020 2020  t)..            
+000127d0: 6173 7065 6374 5f64 6567 203d 2028 3435  aspect_deg = (45
+000127e0: 3020 2d61 7370 6563 745f 6465 6720 2920  0 -aspect_deg ) 
+000127f0: 2520 3336 300d 0a20 2020 2020 2020 2072  % 360..        r
+00012800: 6574 7572 6e20 6173 7065 6374 5f64 6567  eturn aspect_deg
+00012810: 0d0a 0d0a 2020 2020 6465 6620 7361 7665  ....    def save
+00012820: 5f72 6173 7465 7228 6f75 7470 7574 5f70  _raster(output_p
+00012830: 6174 682c 2064 6174 612c 2067 656f 5f74  ath, data, geo_t
+00012840: 7261 6e73 666f 726d 2c20 7265 6665 7265  ransform, refere
+00012850: 6e63 655f 6461 7461 7365 7429 3a0d 0a20  nce_dataset):.. 
+00012860: 2020 2020 2020 2022 2222 5361 7665 2074         """Save t
+00012870: 6865 2064 6174 6120 6173 2061 2072 6173  he data as a ras
+00012880: 7465 7220 6669 6c65 2e22 2222 0d0a 2020  ter file."""..  
+00012890: 2020 2020 2020 6472 6976 6572 203d 2067        driver = g
+000128a0: 6461 6c2e 4765 7444 7269 7665 7242 794e  dal.GetDriverByN
+000128b0: 616d 6528 2747 5469 6666 2729 0d0a 2020  ame('GTiff')..  
+000128c0: 2020 2020 2020 726f 7773 2c20 636f 6c73        rows, cols
+000128d0: 203d 2064 6174 612e 7368 6170 650d 0a20   = data.shape.. 
+000128e0: 2020 2020 2020 206f 7574 5f72 6173 7465         out_raste
+000128f0: 7220 3d20 6472 6976 6572 2e43 7265 6174  r = driver.Creat
+00012900: 6528 6f75 7470 7574 5f70 6174 682c 2063  e(output_path, c
+00012910: 6f6c 732c 2072 6f77 732c 2031 2c20 6764  ols, rows, 1, gd
+00012920: 616c 2e47 4454 5f46 6c6f 6174 3332 290d  al.GDT_Float32).
+00012930: 0a20 2020 2020 2020 206f 7574 5f72 6173  .        out_ras
+00012940: 7465 722e 5365 7447 656f 5472 616e 7366  ter.SetGeoTransf
+00012950: 6f72 6d28 6765 6f5f 7472 616e 7366 6f72  orm(geo_transfor
+00012960: 6d29 0d0a 2020 2020 2020 2020 6f75 745f  m)..        out_
+00012970: 6261 6e64 203d 206f 7574 5f72 6173 7465  band = out_raste
+00012980: 722e 4765 7452 6173 7465 7242 616e 6428  r.GetRasterBand(
+00012990: 3129 0d0a 2020 2020 2020 2020 6f75 745f  1)..        out_
+000129a0: 6261 6e64 2e57 7269 7465 4172 7261 7928  band.WriteArray(
+000129b0: 6461 7461 290d 0a20 2020 2020 2020 206f  data)..        o
+000129c0: 7574 5f72 6173 7465 722e 5365 7450 726f  ut_raster.SetPro
+000129d0: 6a65 6374 696f 6e28 7265 6665 7265 6e63  jection(referenc
+000129e0: 655f 6461 7461 7365 742e 4765 7450 726f  e_dataset.GetPro
+000129f0: 6a65 6374 696f 6e28 2929 0d0a 2020 2020  jection())..    
+00012a00: 2020 2020 6f75 745f 6261 6e64 2e46 6c75      out_band.Flu
+00012a10: 7368 4361 6368 6528 290d 0a0d 0a20 2020  shCache()....   
+00012a20: 2023 2052 6561 6420 7468 6520 4557 2061   # Read the EW a
+00012a30: 6e64 204e 5320 7261 7374 6572 2064 6174  nd NS raster dat
+00012a40: 610d 0a20 2020 2065 775f 6461 7461 2c20  a..    ew_data, 
+00012a50: 6765 6f5f 7472 616e 7366 6f72 6d2c 2064  geo_transform, d
+00012a60: 6174 6173 6574 203d 2072 6561 645f 7261  ataset = read_ra
+00012a70: 7374 6572 2865 775f 7261 7374 6572 5f70  ster(ew_raster_p
+00012a80: 6174 6829 0d0a 2020 2020 6e73 5f64 6174  ath)..    ns_dat
+00012a90: 612c 205f 2c20 5f20 3d20 7265 6164 5f72  a, _, _ = read_r
+00012aa0: 6173 7465 7228 6e73 5f72 6173 7465 725f  aster(ns_raster_
+00012ab0: 7061 7468 290d 0a0d 0a20 2020 2023 2043  path)....    # C
+00012ac0: 616c 6375 6c61 7465 2074 6865 2061 7370  alculate the asp
+00012ad0: 6563 7420 616e 6420 7361 7665 2074 6865  ect and save the
+00012ae0: 2072 6573 756c 740d 0a20 2020 2061 7370   result..    asp
+00012af0: 6563 745f 6461 7461 203d 2063 616c 6375  ect_data = calcu
+00012b00: 6c61 7465 5f61 7370 6563 7428 6577 5f64  late_aspect(ew_d
+00012b10: 6174 612c 206e 735f 6461 7461 290d 0a20  ata, ns_data).. 
+00012b20: 2020 2073 6176 655f 7261 7374 6572 286f     save_raster(o
+00012b30: 7574 7075 745f 7261 7374 6572 5f70 6174  utput_raster_pat
+00012b40: 682c 2061 7370 6563 745f 6461 7461 2c20  h, aspect_data, 
+00012b50: 6765 6f5f 7472 616e 7366 6f72 6d2c 2064  geo_transform, d
+00012b60: 6174 6173 6574 290d 0a0d 0a23 2045 7861  ataset)....# Exa
+00012b70: 6d70 6c65 2075 7361 6765 3a0d 0a23 2063  mple usage:..# c
+00012b80: 616c 6375 6c61 7465 5f61 6e64 5f73 6176  alculate_and_sav
+00012b90: 655f 6173 7065 6374 5f72 6173 7465 7228  e_aspect_raster(
+00012ba0: 2770 6174 685f 746f 5f65 775f 7261 7374  'path_to_ew_rast
+00012bb0: 6572 2e74 6966 272c 2027 7061 7468 5f74  er.tif', 'path_t
+00012bc0: 6f5f 6e73 5f72 6173 7465 722e 7469 6627  o_ns_raster.tif'
+00012bd0: 2c20 2770 6174 685f 746f 5f6f 7574 7075  , 'path_to_outpu
+00012be0: 745f 6173 7065 6374 5f72 6173 7465 722e  t_aspect_raster.
+00012bf0: 7469 6627 290d 0a0d 0a0d 0a0d 0a23 2323  tif')........###
+00012c00: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00012c10: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00012c20: 2323 2323 2323 2323 2323 230d 0a0d 0a    ###########....
```

## akhdefo_functions/Akhdefo_Utilities.py

```diff
@@ -89,15 +89,15 @@
 # with rasterio.open(output_path, 'w', driver='GTiff', height=vertical_disp.shape[0], width=vertical_disp.shape[1], count=1, dtype=vertical_disp.dtype, crs=crs, transform=transform) as dst:
 #     dst.write(vertical_disp, 1)
 
 # output_path
 
 
 # '''
-from akhdefo_functions import utm_to_latlon
+###Start###
 from akhdefo_functions import akhdefo_viewer
 from osgeo import gdal
 import numpy as np
 import matplotlib.pyplot as plt
 import rasterio
 import os
 import rasterio as rio
@@ -109,14 +109,71 @@
 from planet import Session, OrdersClient
 from pathlib import Path
 import shutil
 from osgeo import osr
 import cmocean
 import geopandas as gpd
 import gstools as gs
+      
+import numpy as np
+import geopandas as gpd
+import gstools as gs
+import matplotlib.pyplot as plt
+import pykrige.kriging_tools as kt
+from pykrige.ok import OrdinaryKriging
+from pykrige.uk import UniversalKriging
+import rasterio
+from rasterio.features import geometry_mask
+from scipy.ndimage import median_filter
+from skimage.filters import gaussian
+import os
+
+import asf_search as asf
+import hyp3_sdk as sdk
+import pandas as pd
+
+
+import rasterio
+from rasterio.warp import calculate_default_transform, reproject, Resampling
+import numpy as np
+import matplotlib.pyplot as plt
+import geopandas as gpd
+from rasterio.mask import mask
+from skimage import exposure
+
+import warnings
+import time 
+from skimage.registration import phase_cross_correlation
+import matplotlib
+import pandas as pd
+import tempfile
+
+from scipy.ndimage import convolve
+import matplotlib
+matplotlib.use('Agg')
+import cv2
+import numpy as np
+import matplotlib.pyplot as plt
+import subprocess
+from skimage.metrics import structural_similarity as ssim
+# import required libraries
+# from vidgear.gears import CamGear
+# from vidgear.gears import StreamGear
+import queue
+import time
+
+from osgeo import gdal, osr
+import os
+import gc
+import time
+from shapely.geometry import box
+import os
+import geopandas as gpd
+from shapely.geometry import Point
+
 
 def Akhdefo_resample(input_raster="", output_raster="" , xres=3.125 , yres=3.125, SavFig=False , convert_units=None):
     """
     This program performs raster resampling for  rasters
    
     Parameters:
     ------------
@@ -398,28 +455,16 @@
                    pixel_resolution_meters=None, output_file_name="trend.jpg", 
                    alpha=0.5, unit_conversion=None, no_data_mask=True, 
                    colormap=cmocean.cm.phase, min_value=None, max_value=None, 
                    normalize=True, colorbar_label='degrees', show_figure=True)
 
 
         
-        
-import numpy as np
-import geopandas as gpd
-import gstools as gs
-import matplotlib.pyplot as plt
-import pykrige.kriging_tools as kt
-from pykrige.ok import OrdinaryKriging
-from pykrige.uk import UniversalKriging
-import rasterio
-from rasterio.features import geometry_mask
-from scipy.ndimage import median_filter
-from skimage.filters import gaussian
-import os
-from akhdefo_functions import mask_raster
+  
+#from akhdefo_functions import mask_raster
 
 def set_gdf_to_utm(gdf):
     # Ensure the GeoDataFrame has a valid CRS
     if gdf.crs is None:
         gdf.crs = "EPSG:4326"  # WGS 84
     
     # Calculate the median longitude to estimate the UTM zone
@@ -1610,17 +1655,14 @@
     #Clean up
     src_ds = None
     dem_ds = None
     dst_ds = None
 
 
 
-import asf_search as asf
-import hyp3_sdk as sdk
-import pandas as pd
 
 def download_RTC(username: str = '', password: str = '', prompt=False, asf_datapool_results_file: str = '', save_dir: str = '',
                  job_name: str = 'rtc-test', dem_matching: bool = True, include_dem: bool = True,
                  include_inc_map: bool = True, include_rgb: bool = False, 
                  include_scattering_area: bool = False, scale: str = 'amplitude',
                  resolution: int = 10, speckle_filter: bool = True, radiometry='gamma0', dem_name='copernicus',
                    download: bool=False, limit: int =None , path_number: int =None, frame_number: int =None,
@@ -1829,21 +1871,14 @@
         print(f"set value download= {download} to True to submit the jobs and download RTC data")
         print(f"List of granules: {granules_to_download}")
     
     
    
 
 
-import rasterio
-from rasterio.warp import calculate_default_transform, reproject, Resampling
-import numpy as np
-import matplotlib.pyplot as plt
-import geopandas as gpd
-from rasterio.mask import mask
-from skimage import exposure
 
 def reproject_raster_to_match_shapefile(src_path, dst_path, dst_crs):
 
     """
     Reproject a raster to match the coordinate reference system (CRS) of a shapefile.
 
     Parameters:
@@ -2041,20 +2076,15 @@
     
     Returns:
     --------- 
         Video output with motion vectors and magnitude.
     
     '''
     #import datetime
-    import warnings
-    import time 
-    from skimage.registration import phase_cross_correlation
-    import matplotlib
-    import pandas as pd
-    import tempfile
+    
    
         # Suppress the Matplotlib GUI warning
     warnings.filterwarnings("ignore", category=UserWarning, message="Starting a Matplotlib GUI outside of the main thread will likely fail")
 
     backSub = cv2.createBackgroundSubtractorMOG2(detectShadows=True, varThreshold=48)
     backSub1 = cv2.createBackgroundSubtractorMOG2(detectShadows=True, varThreshold=48)
     cap = cv2.VideoCapture(hls_url)
@@ -2124,15 +2154,15 @@
     
     ##Save to video
     # Adjust 'XVID' with 'MP4V' or another codec if needed
     fourcc = cv2.VideoWriter_fourcc(*'mp4v') #MJPG
     
     
     #############################
-    from scipy.ndimage import convolve
+    
 
     def detect_outliers(image, threshold=3):
         """Detect outliers based on deviation from local mean."""
         mean_filter = np.ones((3, 3)) / 9.0
         local_mean = convolve(image.astype(float), mean_filter)
         deviation = np.abs(image - local_mean)
         return deviation > threshold
@@ -3254,26 +3284,15 @@
         normally, winsize for a Gaussian window should be set to a larger value to achieve the same level of robustness.
     
     Returns:
     ---------- 
         Video output with motion vectors and magnitude.
     
     '''
-    import matplotlib
-    matplotlib.use('Agg')
-    import cv2
-    import numpy as np
-    import matplotlib.pyplot as plt
-    import subprocess
-    from skimage.metrics import structural_similarity as ssim
-    # import required libraries
-    # from vidgear.gears import CamGear
-    # from vidgear.gears import StreamGear
-    import queue
-    import time
+    
     # Set the new dimensions for resizing
     new_width = 1000
     new_height = 600
     
     cap = cv2.VideoCapture(hls_url)
     
     if not cap.isOpened():
@@ -3582,19 +3601,14 @@
     plt.savefig(save_fig_frames)
     
     return vid
 
 
 ##########################################
 
-from osgeo import gdal, osr
-import os
-import gc
-import time
-from shapely.geometry import box
 
 def calculate_new_geotransform(overlap_box, src_transform):
     """
     Calculate a new geotransform matrix based on the overlap of image boundaries.
 
     Parameters:
     ------------
@@ -3711,17 +3725,15 @@
             except Exception as e:
                 print(f"Unexpected error while overwriting {image_path}: {e}")
 
 # # Test the function with your paths
 # input_folder = 'geo/flowx'
 # crop_to_overlap(input_folder)
 
-import os
-import geopandas as gpd
-from shapely.geometry import Point
+
 
 def crop_point_shapefile_with_aoi(point_shapefile, aoi_shapefile, output_folder):
     
     """
     Crop a point shapefile with an Area of Interest (AOI) polygon shapefile.
 
     Parameters:
```

## akhdefo_functions/Filter_PreProc.py

```diff
@@ -1,1691 +1,1690 @@
-00000000: 0d0a 0d0a 6465 6620 4669 6c74 6572 5f50  ....def Filter_P
-00000010: 7265 5072 6f63 6573 7328 756e 6669 6c74  reProcess(unfilt
-00000020: 6572 6564 5f66 6f6c 6465 7250 6174 683d  ered_folderPath=
-00000030: 7222 222c 2055 444d 325f 6d61 736b 666f  r"", UDM2_maskfo
-00000040: 6c64 6572 5061 7468 3d72 2222 2c20 6f75  lderPath=r"", ou
-00000050: 7470 6174 685f 6469 723d 7222 2220 2c20  tpath_dir=r"" , 
-00000060: 5564 6d5f 4d61 736b 5f4f 7074 696f 6e3d  Udm_Mask_Option=
-00000070: 4661 6c73 652c 2070 6c6f 745f 6669 6775  False, plot_figu
-00000080: 7265 3d46 616c 7365 293a 0d0a 0d0a 0d0a  re=False):......
-00000090: 2020 2020 2222 220d 0a20 2020 2054 6869      """..    Thi
-000000a0: 7320 7072 6f67 7261 6d20 7072 6570 6172  s program prepar
-000000b0: 6520 616e 6420 7573 6573 2066 696c 7465  e and uses filte
-000000c0: 7273 2074 6f20 6261 6c61 6e61 6365 2072  rs to balanace r
-000000d0: 6173 7465 7220 696d 6167 6520 6272 6967  aster image brig
-000000e0: 6874 6e65 7373 0d0a 0d0a 2020 2020 5061  htness....    Pa
-000000f0: 7261 6d65 7465 7273 0d0a 2020 2020 2d2d  rameters..    --
-00000100: 2d2d 2d2d 2d2d 2d2d 0d0a 2020 2020 756e  --------..    un
-00000110: 6669 6c74 6572 6564 5f66 6f6c 6465 7250  filtered_folderP
-00000120: 6174 683a 2020 7374 720d 0a0d 0a20 2020  ath:  str....   
-00000130: 2055 444d 325f 6d61 736b 666f 6c64 6572   UDM2_maskfolder
-00000140: 5061 7468 3a20 2020 2073 7472 0d0a 0d0a  Path:    str....
-00000150: 2020 2020 6f75 7470 6174 685f 6469 723a      outpath_dir:
-00000160: 2020 2020 7374 720d 0a0d 0a20 2020 2055      str....    U
-00000170: 646d 5f4d 6173 6b5f 4f70 7469 6f6e 3a20  dm_Mask_Option: 
-00000180: 2020 2062 6f6f 6c0d 0a20 2020 2020 2020     bool..       
-00000190: 2046 616c 7365 2069 6620 5472 7565 2074   False if True t
-000001a0: 6865 2070 726f 6772 616d 2075 7365 7320  he program uses 
-000001b0: 706c 616e 6574 6c61 6273 2069 6d61 6765  planetlabs image
-000001c0: 7279 2075 6e75 7361 626c 6520 7069 7865  ry unusable pixe
-000001d0: 6c20 6d61 736b 2074 6f20 6967 6e6f 7265  l mask to ignore
-000001e0: 2061 6e64 206d 6173 6b20 6261 6420 696d   and mask bad im
-000001f0: 6167 6520 7069 7865 6c73 200d 0a0d 0a20  age pixels .... 
-00000200: 2020 2070 6c6f 745f 6669 6775 7265 3a20     plot_figure: 
-00000210: 2020 2062 6f6f 6c0d 0a20 2020 2020 2020     bool..       
-00000220: 2054 7275 6520 6966 2079 6f75 2077 616e   True if you wan
-00000230: 7420 746f 2064 6973 706c 6179 206f 7574  t to display out
-00000240: 7075 7420 6669 6775 7265 2064 6972 6563  put figure direc
-00000250: 746c 7920 696e 7369 6465 2070 7974 686f  tly inside pytho
-00000260: 6e0d 0a20 2020 200d 0a20 2020 200d 0a20  n..    ..    .. 
-00000270: 2020 2052 6574 7572 6e73 0d0a 2020 2020     Returns..    
-00000280: 2d2d 2d2d 2d2d 2d0d 0a20 2020 2067 656f  -------..    geo
-00000290: 7469 6620 7261 7374 6572 730d 0a20 2020  tif rasters..   
-000002a0: 2020 2020 2046 696c 7465 7265 6420 6765       Filtered ge
-000002b0: 6f74 6966 2072 6173 7465 7273 0d0a 2020  otif rasters..  
-000002c0: 2020 4669 6775 7265 730d 0a20 2020 2020    Figures..     
-000002d0: 2020 2070 6c6f 7474 6564 2066 696c 7465     plotted filte
-000002e0: 7265 6420 7261 7374 6572 7320 616e 6420  red rasters and 
-000002f0: 6d61 736b 2066 6f72 2062 6164 2070 6978  mask for bad pix
-00000300: 656c 730d 0a0d 0a20 2020 2022 2222 0d0a  els....    """..
-00000310: 2020 2020 0d0a 2020 2020 696d 706f 7274      ..    import
-00000320: 2067 6c6f 620d 0a20 2020 2066 726f 6d20   glob..    from 
-00000330: 6974 6572 746f 6f6c 7320 696d 706f 7274  itertools import
-00000340: 2063 6f75 6e74 0d0a 2020 2020 696d 706f   count..    impo
-00000350: 7274 206f 730d 0a20 2020 2069 6d70 6f72  rt os..    impor
-00000360: 7420 7261 7374 6572 696f 0d0a 2020 2020  t rasterio..    
-00000370: 6672 6f6d 2072 6173 7465 7269 6f2e 706c  from rasterio.pl
-00000380: 6f74 2069 6d70 6f72 7420 7368 6f77 0d0a  ot import show..
-00000390: 2020 2020 6672 6f6d 2073 6b69 6d61 6765      from skimage
-000003a0: 2069 6d70 6f72 7420 6578 706f 7375 7265   import exposure
-000003b0: 0d0a 2020 2020 696d 706f 7274 206e 756d  ..    import num
-000003c0: 7079 2061 7320 6e70 0d0a 2020 2020 696d  py as np..    im
-000003d0: 706f 7274 2063 7632 0d0a 2020 2020 6672  port cv2..    fr
-000003e0: 6f6d 2072 6173 7465 7269 6f2e 706c 6f74  om rasterio.plot
-000003f0: 2069 6d70 6f72 7420 7368 6f77 5f68 6973   import show_his
-00000400: 740d 0a20 2020 2069 6d70 6f72 7420 6d61  t..    import ma
-00000410: 7470 6c6f 746c 6962 2e70 7970 6c6f 7420  tplotlib.pyplot 
-00000420: 6173 2070 6c74 0d0a 0d0a 2020 2020 696d  as plt....    im
-00000430: 706f 7274 2073 6561 626f 726e 5f69 6d61  port seaborn_ima
-00000440: 6765 2061 7320 7365 615f 696d 670d 0a20  ge as sea_img.. 
-00000450: 2020 200d 0a20 2020 200d 0a20 2020 206d     ..    ..    m
-00000460: 7970 6174 6820 3d20 756e 6669 6c74 6572  ypath = unfilter
-00000470: 6564 5f66 6f6c 6465 7250 6174 680d 0a20  ed_folderPath.. 
-00000480: 2020 2070 7269 6e74 2822 7374 7261 7420     print("strat 
-00000490: 776f 726b 696e 6720 6f6e 2066 6f6c 6465  working on folde
-000004a0: 7222 2c20 6d79 7061 7468 290d 0a0d 0a20  r", mypath).... 
-000004b0: 2020 2023 5365 7475 7020 466f 6c64 6572     #Setup Folder
-000004c0: 2064 6972 6563 746f 7269 6573 0d0a 2020   directories..  
-000004d0: 2020 0d0a 2020 2020 6966 206e 6f74 206f    ..    if not o
-000004e0: 732e 7061 7468 2e65 7869 7374 7328 6f75  s.path.exists(ou
-000004f0: 7470 6174 685f 6469 7229 3a0d 0a20 2020  tpath_dir):..   
-00000500: 2020 2020 206f 732e 6d61 6b65 6469 7273       os.makedirs
-00000510: 286f 7574 7061 7468 5f64 6972 290d 0a0d  (outpath_dir)...
-00000520: 0a20 2020 2066 6967 735f 6469 723d 7222  .    figs_dir=r"
-00000530: 4669 6773 5f61 6e61 6c79 7369 732f 6669  Figs_analysis/fi
-00000540: 6c74 6572 5f66 6967 7322 0d0a 2020 2020  lter_figs"..    
-00000550: 6669 675f 6d61 736b 733d 7222 4669 6773  fig_masks=r"Figs
-00000560: 5f61 6e61 6c79 7369 732f 6d61 736b 5f66  _analysis/mask_f
-00000570: 6967 7322 0d0a 0d0a 2020 2020 6966 206e  igs"....    if n
-00000580: 6f74 206f 732e 7061 7468 2e65 7869 7374  ot os.path.exist
-00000590: 7328 6669 6773 5f64 6972 293a 0d0a 2020  s(figs_dir):..  
-000005a0: 2020 2020 2020 6f73 2e6d 616b 6564 6972        os.makedir
-000005b0: 7328 6669 6773 5f64 6972 290d 0a20 2020  s(figs_dir)..   
-000005c0: 2069 6620 6e6f 7420 6f73 2e70 6174 682e   if not os.path.
-000005d0: 6578 6973 7473 2866 6967 5f6d 6173 6b73  exists(fig_masks
-000005e0: 293a 0d0a 2020 2020 2020 2020 6f73 2e6d  ):..        os.m
-000005f0: 616b 6564 6972 7328 6669 675f 6d61 736b  akedirs(fig_mask
-00000600: 7329 0d0a 0d0a 2020 2020 696d 675f 6c69  s)....    img_li
-00000610: 7374 3d73 6f72 7465 6428 676c 6f62 2e67  st=sorted(glob.g
-00000620: 6c6f 6228 756e 6669 6c74 6572 6564 5f66  lob(unfiltered_f
-00000630: 6f6c 6465 7250 6174 682b 2022 2f22 202b  olderPath+ "/" +
-00000640: 222a 2e74 6966 2229 290d 0a20 2020 2075  "*.tif"))..    u
-00000650: 646d 5f6c 6973 743d 736f 7274 6564 2867  dm_list=sorted(g
-00000660: 6c6f 622e 676c 6f62 2855 444d 325f 6d61  lob.glob(UDM2_ma
-00000670: 736b 666f 6c64 6572 5061 7468 202b 2022  skfolderPath + "
-00000680: 2f22 202b 2022 2a2e 7469 6622 2929 0d0a  /" + "*.tif"))..
-00000690: 2020 2020 0d0a 0d0a 2020 2020 2323 2323      ....    ####
-000006a0: 2323 2323 2323 2323 2323 230d 0a0d 0a20  ###########.... 
-000006b0: 2020 2066 6f72 2069 6478 2c20 6974 656d     for idx, item
-000006c0: 2069 6e20 656e 756d 6572 6174 6528 696d   in enumerate(im
-000006d0: 675f 6c69 7374 293a 0d0a 0d0a 2020 2020  g_list):....    
-000006e0: 2020 2020 7072 696e 7428 2220 7374 6172      print(" star
-000006f0: 7420 5072 6f63 6573 7369 6e67 2049 6d61  t Processing Ima
-00000700: 6765 204e 756d 6265 723a 2022 2c20 6964  ge Number: ", id
-00000710: 782c 2022 3a22 2c20 6974 656d 290d 0a20  x, ":", item).. 
-00000720: 2020 2020 2020 2023 696d 675f 6974 656d         #img_item
-00000730: 3d69 6d67 5f6c 6973 745b 6964 785d 0d0a  =img_list[idx]..
-00000740: 2020 2020 2020 2020 236d 736b 5f69 7465          #msk_ite
-00000750: 6d3d 7564 6d5f 6c69 7374 5b69 6478 5d0d  m=udm_list[idx].
-00000760: 0a20 2020 2020 2020 2066 696c 6570 6174  .        filepat
-00000770: 6831 2c20 6669 6c65 6e61 6d65 203d 206f  h1, filename = o
-00000780: 732e 7061 7468 2e73 706c 6974 2869 6d67  s.path.split(img
-00000790: 5f6c 6973 745b 6964 785d 290d 0a20 2020  _list[idx])..   
-000007a0: 2020 2020 2023 6669 6c65 6e61 6d65 3d66       #filename=f
-000007b0: 696c 656e 616d 652e 7265 706c 6163 6528  ilename.replace(
-000007c0: 222d 222c 2022 2229 0d0a 2020 2020 2020  "-", "")..      
-000007d0: 2020 2372 6762 3d72 6762 5f6e 6f72 6d61    #rgb=rgb_norma
-000007e0: 6c69 7a65 2869 6d67 5f6c 6973 745b 6964  lize(img_list[id
-000007f0: 785d 290d 0a20 2020 2020 2020 2069 6d67  x])..        img
-00000800: 5f73 7263 3d72 6173 7465 7269 6f2e 6f70  _src=rasterio.op
-00000810: 656e 2869 6d67 5f6c 6973 745b 6964 785d  en(img_list[idx]
-00000820: 290d 0a20 2020 2020 2020 200d 0a20 2020  )..        ..   
-00000830: 2020 2020 206d 6574 613d 696d 675f 7372       meta=img_sr
-00000840: 632e 6d65 7461 0d0a 2020 2020 2020 2020  c.meta..        
-00000850: 2320 6d65 7461 2e75 7064 6174 6528 7b27  # meta.update({'
-00000860: 6e6f 6461 7461 273a 307d 290d 0a20 2020  nodata':0})..   
-00000870: 2020 2020 2023 206d 6574 612e 7570 6461       # meta.upda
-00000880: 7465 287b 2763 6f75 6e74 273a 2033 7d29  te({'count': 3})
-00000890: 0d0a 2020 2020 2020 2020 2320 6d65 7461  ..        # meta
-000008a0: 2e75 7064 6174 6528 7b27 6474 7970 6527  .update({'dtype'
-000008b0: 3a20 6e70 2e75 696e 7438 7d29 0d0a 0d0a  : np.uint8})....
-000008c0: 2020 2020 2020 2020 696d 675f 6461 7461          img_data
-000008d0: 203d 2069 6d67 5f73 7263 2e72 6561 6428   = img_src.read(
-000008e0: 5b33 2c20 322c 2031 5d2c 206d 6173 6b65  [3, 2, 1], maske
-000008f0: 643d 5472 7565 292f 3130 3030 300d 0a20  d=True)/10000.. 
-00000900: 2020 2020 2020 2069 6d67 5f64 6174 615f         img_data_
-00000910: 636f 7079 3d69 6d67 5f64 6174 612e 636f  copy=img_data.co
-00000920: 7079 2829 0d0a 0d0a 2020 2020 2020 2020  py()....        
-00000930: 6966 2055 444d 325f 6d61 736b 666f 6c64  if UDM2_maskfold
-00000940: 6572 5061 7468 2021 3d20 2222 3a0d 0a20  erPath != "":.. 
-00000950: 2020 2020 2020 2020 2020 2075 646d 5f73             udm_s
-00000960: 7263 3d72 6173 7465 7269 6f2e 6f70 656e  rc=rasterio.open
-00000970: 2875 646d 5f6c 6973 745b 6964 785d 290d  (udm_list[idx]).
-00000980: 0a0d 0a0d 0a20 2020 2020 2020 2020 2020  .....           
-00000990: 2063 6c65 616e 5f6d 6173 6b20 3d20 7564   clean_mask = ud
-000009a0: 6d5f 7372 632e 7265 6164 2831 292e 6173  m_src.read(1).as
-000009b0: 7479 7065 2862 6f6f 6c29 0d0a 2020 2020  type(bool)..    
-000009c0: 2020 2020 2020 2020 736e 6f77 5f6d 6173          snow_mas
-000009d0: 6b20 3d20 7564 6d5f 7372 632e 7265 6164  k = udm_src.read
-000009e0: 2832 292e 6173 7479 7065 2862 6f6f 6c29  (2).astype(bool)
-000009f0: 0d0a 2020 2020 2020 2020 2020 2020 7368  ..            sh
-00000a00: 6164 6f77 5f6d 6173 6b20 3d20 7564 6d5f  adow_mask = udm_
-00000a10: 7372 632e 7265 6164 2833 292e 6173 7479  src.read(3).asty
-00000a20: 7065 2862 6f6f 6c29 0d0a 2020 2020 2020  pe(bool)..      
-00000a30: 2020 2020 2020 6c69 6768 745f 6861 7a65        light_haze
-00000a40: 5f6d 6173 6b20 3d20 7564 6d5f 7372 632e  _mask = udm_src.
-00000a50: 7265 6164 2834 292e 6173 7479 7065 2862  read(4).astype(b
-00000a60: 6f6f 6c29 0d0a 2020 2020 2020 2020 2020  ool)..          
-00000a70: 2020 6865 6176 795f 6861 7a65 5f6d 6173    heavy_haze_mas
-00000a80: 6b20 3d20 7564 6d5f 7372 632e 7265 6164  k = udm_src.read
-00000a90: 2835 292e 6173 7479 7065 2862 6f6f 6c29  (5).astype(bool)
-00000aa0: 0d0a 2020 2020 2020 2020 2020 2020 636c  ..            cl
-00000ab0: 6f75 645f 6d61 736b 203d 2075 646d 5f73  oud_mask = udm_s
-00000ac0: 7263 2e72 6561 6428 3629 2e61 7374 7970  rc.read(6).astyp
-00000ad0: 6528 626f 6f6c 290d 0a20 2020 2020 2020  e(bool)..       
-00000ae0: 2020 2020 2062 6164 5f6d 6173 6b3d 736e       bad_mask=sn
-00000af0: 6f77 5f6d 6173 6b2b 7368 6164 6f77 5f6d  ow_mask+shadow_m
-00000b00: 6173 6b2b 636c 6f75 645f 6d61 736b 2b6c  ask+cloud_mask+l
-00000b10: 6967 6874 5f68 617a 655f 6d61 736b 2b68  ight_haze_mask+h
-00000b20: 6561 7679 5f68 617a 655f 6d61 736b 0d0a  eavy_haze_mask..
-00000b30: 2020 2020 2020 2020 2020 2020 6d69 6e69              mini
-00000b40: 6d75 6d5f 6d61 736b 3d73 6861 646f 775f  mum_mask=shadow_
-00000b50: 6d61 736b 2b63 6c6f 7564 5f6d 6173 6b2b  mask+cloud_mask+
-00000b60: 736e 6f77 5f6d 6173 6b0d 0a20 2020 2020  snow_mask..     
-00000b70: 2020 2020 2020 2062 6164 5f6d 6173 6b3d         bad_mask=
-00000b80: 7e63 6c65 616e 5f6d 6173 6b20 2b20 736e  ~clean_mask + sn
-00000b90: 6f77 5f6d 6173 6b0d 0a20 2020 2020 2020  ow_mask..       
-00000ba0: 2020 2020 2069 6d67 5f64 6174 612e 6d61       img_data.ma
-00000bb0: 736b 203d 2062 6164 5f6d 6173 6b20 0d0a  sk = bad_mask ..
-00000bc0: 2020 2020 2020 2020 2020 2020 696d 675f              img_
-00000bd0: 6461 7461 203d 2069 6d67 5f64 6174 612e  data = img_data.
-00000be0: 6669 6c6c 6564 2866 696c 6c5f 7661 6c75  filled(fill_valu
-00000bf0: 653d 3029 0d0a 2020 2020 2020 2020 0d0a  e=0)..        ..
-00000c00: 2020 2020 2020 2020 6465 6620 6e6f 726d          def norm
-00000c10: 616c 697a 6528 6172 7261 7929 3a0d 0a20  alize(array):.. 
-00000c20: 2020 2020 2020 2020 2020 2061 7272 6179             array
-00000c30: 5f6d 696e 2c20 6172 7261 795f 6d61 7820  _min, array_max 
-00000c40: 3d20 6172 7261 792e 6d69 6e28 292c 2061  = array.min(), a
-00000c50: 7272 6179 2e6d 6178 2829 0d0a 2020 2020  rray.max()..    
-00000c60: 2020 2020 2020 2020 2861 7272 6179 202d          (array -
-00000c70: 2061 7272 6179 5f6d 696e 2920 2f20 2861   array_min) / (a
-00000c80: 7272 6179 5f6d 6178 202d 2061 7272 6179  rray_max - array
-00000c90: 5f6d 696e 290d 0a20 2020 2020 2020 2020  _min)..         
-00000ca0: 2020 2061 7272 6179 3d65 7870 6f73 7572     array=exposur
-00000cb0: 652e 7265 7363 616c 655f 696e 7465 6e73  e.rescale_intens
-00000cc0: 6974 7928 6172 7261 792c 206f 7574 5f72  ity(array, out_r
-00000cd0: 616e 6765 3d28 302c 2032 3535 2929 2e61  ange=(0, 255)).a
-00000ce0: 7374 7970 6528 6e70 2e75 696e 7438 290d  stype(np.uint8).
-00000cf0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00000d00: 7572 6e20 6172 7261 790d 0a20 2020 2020  urn array..     
-00000d10: 2020 2064 6566 2070 6374 5f63 6c69 7028     def pct_clip(
-00000d20: 6172 7261 792c 7063 743d 5b32 2c39 385d  array,pct=[2,98]
-00000d30: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-00000d40: 6172 7261 795f 6d69 6e2c 2061 7272 6179  array_min, array
-00000d50: 5f6d 6178 203d 206e 702e 6e61 6e70 6572  _max = np.nanper
-00000d60: 6365 6e74 696c 6528 6172 7261 792c 7063  centile(array,pc
-00000d70: 745b 305d 292c 206e 702e 6e61 6e70 6572  t[0]), np.nanper
-00000d80: 6365 6e74 696c 6528 6172 7261 792c 7063  centile(array,pc
-00000d90: 745b 315d 290d 0a20 2020 2020 2020 2020  t[1])..         
-00000da0: 2020 2063 6c69 7020 3d20 2861 7272 6179     clip = (array
-00000db0: 202d 2061 7272 6179 5f6d 696e 2920 2f20   - array_min) / 
-00000dc0: 2861 7272 6179 5f6d 6178 202d 2061 7272  (array_max - arr
-00000dd0: 6179 5f6d 696e 290d 0a20 2020 2020 2020  ay_min)..       
-00000de0: 2020 2020 2063 6c69 705b 636c 6970 3e31       clip[clip>1
-00000df0: 5d3d 310d 0a20 2020 2020 2020 2020 2020  ]=1..           
-00000e00: 2063 6c69 705b 636c 6970 3c30 5d3d 300d   clip[clip<0]=0.
-00000e10: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00000e20: 7572 6e20 636c 6970 0d0a 0d0a 2020 2020  urn clip....    
-00000e30: 2020 2020 2320 436f 6e76 6572 7420 746f      # Convert to
-00000e40: 206e 756d 7079 2061 7272 6179 730d 0a20   numpy arrays.. 
-00000e50: 2020 2020 2020 2072 5f6f 203d 2069 6d67         r_o = img
-00000e60: 5f73 7263 2e72 6561 6428 3329 0d0a 2020  _src.read(3)..  
-00000e70: 2020 2020 2020 625f 6f20 3d20 696d 675f        b_o = img_
-00000e80: 7372 632e 7265 6164 2832 290d 0a20 2020  src.read(2)..   
-00000e90: 2020 2020 2067 5f6f 203d 2069 6d67 5f73       g_o = img_s
-00000ea0: 7263 2e72 6561 6428 3129 0d0a 0d0a 2020  rc.read(1)....  
-00000eb0: 2020 2020 2020 725f 6f3d 6578 706f 7375        r_o=exposu
-00000ec0: 7265 2e72 6573 6361 6c65 5f69 6e74 656e  re.rescale_inten
-00000ed0: 7369 7479 2872 5f6f 2c20 6f75 745f 7261  sity(r_o, out_ra
-00000ee0: 6e67 653d 2830 2c20 3235 3529 292e 6173  nge=(0, 255)).as
-00000ef0: 7479 7065 286e 702e 7569 6e74 3829 0d0a  type(np.uint8)..
-00000f00: 0d0a 2020 2020 2020 2020 625f 6f3d 6578  ..        b_o=ex
-00000f10: 706f 7375 7265 2e72 6573 6361 6c65 5f69  posure.rescale_i
-00000f20: 6e74 656e 7369 7479 2862 5f6f 2c20 6f75  ntensity(b_o, ou
-00000f30: 745f 7261 6e67 653d 2830 2c20 3235 3529  t_range=(0, 255)
-00000f40: 292e 6173 7479 7065 286e 702e 7569 6e74  ).astype(np.uint
-00000f50: 3829 0d0a 0d0a 2020 2020 2020 2020 675f  8)....        g_
-00000f60: 6f3d 6578 706f 7375 7265 2e72 6573 6361  o=exposure.resca
-00000f70: 6c65 5f69 6e74 656e 7369 7479 2867 5f6f  le_intensity(g_o
-00000f80: 2c20 6f75 745f 7261 6e67 653d 2830 2c20  , out_range=(0, 
-00000f90: 3235 3529 292e 6173 7479 7065 286e 702e  255)).astype(np.
-00000fa0: 7569 6e74 3829 0d0a 0d0a 2020 2020 2020  uint8)....      
-00000fb0: 2020 7267 625f 696d 675f 6461 7461 203d    rgb_img_data =
-00000fc0: 206e 702e 6473 7461 636b 2828 725f 6f2c   np.dstack((r_o,
-00000fd0: 2062 5f6f 2c20 675f 6f29 290d 0a20 2020   b_o, g_o))..   
-00000fe0: 2020 2020 2072 6762 5f69 6d67 5f64 6174       rgb_img_dat
-00000ff0: 613d 6e70 2e74 7261 6e73 706f 7365 2872  a=np.transpose(r
-00001000: 6762 5f69 6d67 5f64 6174 612c 2028 322c  gb_img_data, (2,
-00001010: 302c 3129 290d 0a0d 0a20 2020 2020 2020  0,1))....       
-00001020: 2069 6620 5544 4d32 5f6d 6173 6b66 6f6c   if UDM2_maskfol
-00001030: 6465 7250 6174 6821 3d22 223a 0d0a 2020  derPath!="":..  
-00001040: 2020 2020 2020 2020 2020 7220 3d20 6578            r = ex
-00001050: 706f 7375 7265 2e65 7175 616c 697a 655f  posure.equalize_
-00001060: 6869 7374 2872 5f6f 2c20 6d61 736b 3d63  hist(r_o, mask=c
-00001070: 6c65 616e 5f6d 6173 6b2b 207e 736e 6f77  lean_mask+ ~snow
-00001080: 5f6d 6173 6b29 0d0a 2020 2020 2020 2020  _mask)..        
-00001090: 2020 2020 6220 3d20 6578 706f 7375 7265      b = exposure
-000010a0: 2e65 7175 616c 697a 655f 6869 7374 2862  .equalize_hist(b
-000010b0: 5f6f 2c20 6d61 736b 3d63 6c65 616e 5f6d  _o, mask=clean_m
-000010c0: 6173 6b2b 207e 736e 6f77 5f6d 6173 6b29  ask+ ~snow_mask)
-000010d0: 0d0a 2020 2020 2020 2020 2020 2020 6720  ..            g 
-000010e0: 3d20 6578 706f 7375 7265 2e65 7175 616c  = exposure.equal
-000010f0: 697a 655f 6869 7374 2867 5f6f 2c20 6d61  ize_hist(g_o, ma
-00001100: 736b 3d63 6c65 616e 5f6d 6173 6b2b 207e  sk=clean_mask+ ~
-00001110: 736e 6f77 5f6d 6173 6b29 0d0a 2020 2020  snow_mask)..    
-00001120: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
-00001130: 2020 2020 2020 2072 203d 2065 7870 6f73         r = expos
-00001140: 7572 652e 6571 7561 6c69 7a65 5f68 6973  ure.equalize_his
-00001150: 7428 725f 6f29 0d0a 2020 2020 2020 2020  t(r_o)..        
-00001160: 2020 2020 6220 3d20 6578 706f 7375 7265      b = exposure
-00001170: 2e65 7175 616c 697a 655f 6869 7374 2862  .equalize_hist(b
-00001180: 5f6f 290d 0a20 2020 2020 2020 2020 2020  _o)..           
-00001190: 2067 203d 2065 7870 6f73 7572 652e 6571   g = exposure.eq
-000011a0: 7561 6c69 7a65 5f68 6973 7428 675f 6f29  ualize_hist(g_o)
-000011b0: 0d0a 2020 2020 2020 2020 2020 2020 0d0a  ..            ..
-000011c0: 2020 2020 2020 2020 7220 3d20 6578 706f          r = expo
-000011d0: 7375 7265 2e65 7175 616c 697a 655f 6164  sure.equalize_ad
-000011e0: 6170 7468 6973 7428 722c 206b 6572 6e65  apthist(r, kerne
-000011f0: 6c5f 7369 7a65 3d31 3238 2c20 636c 6970  l_size=128, clip
-00001200: 5f6c 696d 6974 3d30 2e30 312c 206e 6269  _limit=0.01, nbi
-00001210: 6e73 3d32 3536 290d 0a20 2020 2020 2020  ns=256)..       
-00001220: 2062 203d 2065 7870 6f73 7572 652e 6571   b = exposure.eq
-00001230: 7561 6c69 7a65 5f61 6461 7074 6869 7374  ualize_adapthist
-00001240: 2862 2c20 6b65 726e 656c 5f73 697a 653d  (b, kernel_size=
-00001250: 3132 382c 2063 6c69 705f 6c69 6d69 743d  128, clip_limit=
-00001260: 302e 3031 2c20 6e62 696e 733d 3235 3629  0.01, nbins=256)
-00001270: 0d0a 2020 2020 2020 2020 6720 3d20 6578  ..        g = ex
-00001280: 706f 7375 7265 2e65 7175 616c 697a 655f  posure.equalize_
-00001290: 6164 6170 7468 6973 7428 672c 206b 6572  adapthist(g, ker
-000012a0: 6e65 6c5f 7369 7a65 3d31 3238 2c20 636c  nel_size=128, cl
-000012b0: 6970 5f6c 696d 6974 3d30 2e30 312c 206e  ip_limit=0.01, n
-000012c0: 6269 6e73 3d32 3536 290d 0a0d 0a20 2020  bins=256)....   
-000012d0: 2020 2020 2072 3d72 2e61 7374 7970 6528       r=r.astype(
-000012e0: 2266 6c6f 6174 3634 2229 0d0a 2020 2020  "float64")..    
-000012f0: 2020 2020 623d 622e 6173 7479 7065 2822      b=b.astype("
-00001300: 666c 6f61 7436 3422 290d 0a20 2020 2020  float64")..     
-00001310: 2020 2067 3d67 2e61 7374 7970 6528 2266     g=g.astype("f
-00001320: 6c6f 6174 3634 2229 0d0a 0d0a 2020 2020  loat64")....    
-00001330: 2020 2020 725b 725f 6f3d 3d30 5d3d 300d      r[r_o==0]=0.
-00001340: 0a20 2020 2020 2020 2062 5b62 5f6f 3d3d  .        b[b_o==
-00001350: 305d 3d30 0d0a 2020 2020 2020 2020 675b  0]=0..        g[
-00001360: 675f 6f3d 3d30 5d3d 300d 0a0d 0a20 2020  g_o==0]=0....   
-00001370: 2020 2020 2072 3d70 6374 5f63 6c69 7028       r=pct_clip(
-00001380: 7229 0d0a 2020 2020 2020 2020 623d 7063  r)..        b=pc
-00001390: 745f 636c 6970 2862 290d 0a20 2020 2020  t_clip(b)..     
-000013a0: 2020 2067 3d70 6374 5f63 6c69 7028 6229     g=pct_clip(b)
-000013b0: 0d0a 0d0a 2020 2020 2020 2020 7267 6220  ....        rgb 
-000013c0: 3d20 6e70 2e64 7374 6163 6b28 2872 2c20  = np.dstack((r, 
-000013d0: 622c 2067 2929 0d0a 2020 2020 2020 2020  b, g))..        
-000013e0: 7267 623d 6e70 2e74 7261 6e73 706f 7365  rgb=np.transpose
-000013f0: 2872 6762 2c20 2832 2c30 2c31 2929 0d0a  (rgb, (2,0,1))..
-00001400: 2020 2020 2020 2020 2372 6762 5b72 6762          #rgb[rgb
-00001410: 3d3d 305d 3d32 3535 0d0a 2020 2020 2020  ==0]=255..      
-00001420: 2020 6966 2055 646d 5f4d 6173 6b5f 4f70    if Udm_Mask_Op
-00001430: 7469 6f6e 3d3d 5472 7565 3a0d 0a20 2020  tion==True:..   
-00001440: 2020 2020 2020 2020 2072 6762 5b69 6d67           rgb[img
-00001450: 5f64 6174 613d 3d30 5d3d 300d 0a20 2020  _data==0]=0..   
-00001460: 2020 2020 2020 2020 200d 0a20 2020 2020           ..     
-00001470: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
-00001480: 2020 2020 2020 7267 625b 696d 675f 6461        rgb[img_da
-00001490: 7461 5f63 6f70 793d 3d30 5d3d 300d 0a20  ta_copy==0]=0.. 
-000014a0: 2020 2020 2020 2020 2020 200d 0a0d 0a0d             .....
-000014b0: 0a20 2020 2020 2020 2070 7269 6e74 2028  .        print (
-000014c0: 7267 622e 7368 6170 6529 0d0a 2020 2020  rgb.shape)..    
-000014d0: 2020 2020 0d0a 2020 2020 2020 2020 7267      ..        rg
-000014e0: 623d 6578 706f 7375 7265 2e72 6573 6361  b=exposure.resca
-000014f0: 6c65 5f69 6e74 656e 7369 7479 2872 6762  le_intensity(rgb
-00001500: 2c20 6f75 745f 7261 6e67 653d 2830 2c20  , out_range=(0, 
-00001510: 3235 3529 292e 6173 7479 7065 286e 702e  255)).astype(np.
-00001520: 7569 6e74 3829 0d0a 2020 2020 2020 2020  uint8)..        
-00001530: 0d0a 2020 2020 2020 2020 7769 7468 2072  ..        with r
-00001540: 6173 7465 7269 6f2e 6f70 656e 2820 6f75  asterio.open( ou
-00001550: 7470 6174 685f 6469 7220 2b20 222f 2220  tpath_dir + "/" 
-00001560: 2b20 7374 7228 6669 6c65 6e61 6d65 292c  + str(filename),
-00001570: 2022 7722 2c20 6472 6976 6572 3d27 4754   "w", driver='GT
-00001580: 6966 6627 2c20 7769 6474 683d 696d 675f  iff', width=img_
-00001590: 7372 632e 7368 6170 655b 315d 2c0d 0a20  src.shape[1],.. 
-000015a0: 2020 2020 2020 2020 2020 2068 6569 6768             heigh
-000015b0: 743d 696d 675f 7372 632e 7368 6170 655b  t=img_src.shape[
-000015c0: 305d 2c20 636f 756e 743d 332c 2064 7479  0], count=3, dty
-000015d0: 7065 3d27 7569 6e74 3827 2c20 6372 733d  pe='uint8', crs=
-000015e0: 696d 675f 7372 632e 6372 732c 2074 7261  img_src.crs, tra
-000015f0: 6e73 666f 726d 3d69 6d67 5f73 7263 2e74  nsform=img_src.t
-00001600: 7261 6e73 666f 726d 2c20 6e6f 6461 7461  ransform, nodata
-00001610: 3d30 2920 6173 2064 7374 3a0d 0a20 2020  =0) as dst:..   
-00001620: 2020 2020 2020 2020 2064 7374 2e77 7269           dst.wri
-00001630: 7465 2872 6762 290d 0a20 2020 2020 2020  te(rgb)..       
-00001640: 200d 0a20 2020 2020 2020 2023 2353 6574   ..        ##Set
-00001650: 2070 6c6f 7420 6578 7465 6e74 0d0a 2020   plot extent..  
-00001660: 2020 2020 2020 2320 696d 706f 7274 2072        # import r
-00001670: 696f 7861 7272 6179 2061 7320 7278 720d  ioxarray as rxr.
-00001680: 0a20 2020 2020 2020 2023 2066 726f 6d20  .        # from 
-00001690: 7261 7374 6572 696f 2e70 6c6f 7420 696d  rasterio.plot im
-000016a0: 706f 7274 2070 6c6f 7474 696e 675f 6578  port plotting_ex
-000016b0: 7465 6e74 0d0a 2020 2020 2020 2020 2320  tent..        # 
-000016c0: 7273 203d 2072 7872 2e6f 7065 6e5f 7261  rs = rxr.open_ra
-000016d0: 7374 6572 696f 2875 646d 5f6c 6973 745b  sterio(udm_list[
-000016e0: 305d 2c20 6d61 736b 6564 3d54 7275 6529  0], masked=True)
-000016f0: 0d0a 2020 2020 2020 2020 2372 735f 706c  ..        #rs_pl
-00001700: 6f74 7469 6e67 5f65 7874 656e 7420 3d20  otting_extent = 
-00001710: 706c 6f74 7469 6e67 5f65 7874 656e 7428  plotting_extent(
-00001720: 7273 5b30 5d2c 2072 732e 7269 6f2e 7472  rs[0], rs.rio.tr
-00001730: 616e 7366 6f72 6d28 2929 0d0a 2020 2020  ansform())..    
-00001740: 2020 2020 6669 6731 2c20 2828 6178 3132      fig1, ((ax12
-00001750: 2c20 6178 3232 292c 2028 6178 3332 2c20  , ax22), (ax32, 
-00001760: 6178 3432 2920 2920 3d20 706c 742e 7375  ax42) ) = plt.su
-00001770: 6270 6c6f 7473 2832 2c20 322c 2066 6967  bplots(2, 2, fig
-00001780: 7369 7a65 3d28 3330 2c32 3029 290d 0a20  size=(30,20)).. 
-00001790: 2020 2020 2020 2073 686f 7728 7267 625f         show(rgb_
-000017a0: 696d 675f 6461 7461 2c20 6178 3d61 7831  img_data, ax=ax1
-000017b0: 3229 0d0a 2020 2020 2020 2020 7368 6f77  2)..        show
-000017c0: 5f68 6973 7428 7267 625f 696d 675f 6461  _hist(rgb_img_da
-000017d0: 7461 2c20 6178 3d61 7832 322c 2062 696e  ta, ax=ax22, bin
-000017e0: 733d 3130 2c20 6c77 3d30 2e30 2c20 0d0a  s=10, lw=0.0, ..
-000017f0: 2020 2020 2020 2020 7374 6163 6b65 643d          stacked=
-00001800: 4661 6c73 652c 2061 6c70 6861 3d30 2e33  False, alpha=0.3
-00001810: 2c20 6869 7374 7479 7065 3d27 7374 6570  , histtype='step
-00001820: 6669 6c6c 6564 272c 2064 656e 7369 7479  filled', density
-00001830: 3d54 7275 652c 2074 6974 6c65 3d22 496e  =True, title="In
-00001840: 6974 6961 6c3a 2022 2b73 7472 2866 696c  itial: "+str(fil
-00001850: 656e 616d 655b 3a31 305d 2929 0d0a 2020  ename[:10]))..  
-00001860: 2020 2020 2020 6178 3232 2e67 6574 5f6c        ax22.get_l
-00001870: 6567 656e 6428 292e 7265 6d6f 7665 2829  egend().remove()
-00001880: 0d0a 2020 2020 2020 2020 7368 6f77 2872  ..        show(r
-00001890: 6762 2c20 6178 3d61 7833 3220 290d 0a20  gb, ax=ax32 ).. 
-000018a0: 2020 2020 2020 2073 686f 775f 6869 7374         show_hist
-000018b0: 2872 6762 2c20 6178 3d61 7834 322c 2062  (rgb, ax=ax42, b
-000018c0: 696e 733d 3130 2c20 6c77 3d30 2e30 2c20  ins=10, lw=0.0, 
-000018d0: 0d0a 2020 2020 2020 2020 7374 6163 6b65  ..        stacke
-000018e0: 643d 4661 6c73 652c 2061 6c70 6861 3d30  d=False, alpha=0
-000018f0: 2e33 2c20 6869 7374 7479 7065 3d27 7374  .3, histtype='st
-00001900: 6570 6669 6c6c 6564 272c 2064 656e 7369  epfilled', densi
-00001910: 7479 3d54 7275 652c 2074 6974 6c65 3d22  ty=True, title="
-00001920: 434c 4148 453a 2022 2b73 7472 2866 696c  CLAHE: "+str(fil
-00001930: 656e 616d 655b 3a31 305d 2929 0d0a 2020  ename[:10]))..  
-00001940: 2020 2020 2020 6178 3432 2e67 6574 5f6c        ax42.get_l
-00001950: 6567 656e 6428 292e 7265 6d6f 7665 2829  egend().remove()
-00001960: 0d0a 2020 2020 2020 2020 626e 3d69 6d67  ..        bn=img
-00001970: 5f64 6174 612e 7368 6170 650d 0a20 2020  _data.shape..   
-00001980: 2020 2020 2078 733d 626e 5b32 5d0d 0a20       xs=bn[2].. 
-00001990: 2020 2020 2020 2079 733d 626e 5b31 5d0d         ys=bn[1].
-000019a0: 0a20 2020 2020 2020 2061 7831 322e 7365  .        ax12.se
-000019b0: 745f 786c 696d 2830 2c20 7873 290d 0a20  t_xlim(0, xs).. 
-000019c0: 2020 2020 2020 2061 7831 322e 7365 745f         ax12.set_
-000019d0: 796c 696d 2879 732c 3029 0d0a 2020 2020  ylim(ys,0)..    
-000019e0: 2020 2020 6178 3332 2e73 6574 5f78 6c69      ax32.set_xli
-000019f0: 6d28 302c 2078 7329 0d0a 2020 2020 2020  m(0, xs)..      
-00001a00: 2020 6178 3332 2e73 6574 5f79 6c69 6d28    ax32.set_ylim(
-00001a10: 7973 2c30 290d 0a20 2020 2020 2020 200d  ys,0)..        .
-00001a20: 0a20 2020 2020 2020 2066 6967 312e 7361  .        fig1.sa
-00001a30: 7665 6669 6728 6669 6773 5f64 6972 2b20  vefig(figs_dir+ 
-00001a40: 222f 2220 2b20 2073 7472 2866 696c 656e  "/" +  str(filen
-00001a50: 616d 655b 3a31 305d 292b 2022 2e6a 7067  ame[:10])+ ".jpg
-00001a60: 222c 2064 7069 3d31 3530 290d 0a20 2020  ", dpi=150)..   
-00001a70: 2020 2020 200d 0a20 2020 2020 2020 2069       ..        i
-00001a80: 6620 706c 6f74 5f66 6967 7572 653d 3d54  f plot_figure==T
-00001a90: 7275 653a 0d0a 2020 2020 2020 2020 2020  rue:..          
-00001aa0: 2020 706c 742e 7368 6f77 2829 0d0a 2020    plt.show()..  
-00001ab0: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
-00001ac0: 2020 2020 2020 2020 2070 6c74 2e63 6c6f           plt.clo
-00001ad0: 7365 2866 6967 3129 2020 200d 0a0d 0a20  se(fig1)   .... 
-00001ae0: 2020 2020 2020 2069 6620 5544 4d32 5f6d         if UDM2_m
-00001af0: 6173 6b66 6f6c 6465 7250 6174 6821 3d22  askfolderPath!="
-00001b00: 223a 0d0a 2020 2020 2020 2020 2020 2020  ":..            
-00001b10: 6669 6732 2c20 2861 7831 3220 2c20 6178  fig2, (ax12 , ax
-00001b20: 3232 2920 3d20 706c 742e 7375 6270 6c6f  22) = plt.subplo
-00001b30: 7473 2832 2c31 2c20 6669 6773 697a 653d  ts(2,1, figsize=
-00001b40: 2831 352c 3130 2929 0d0a 2020 2020 2020  (15,10))..      
-00001b50: 2020 2020 2020 7368 6f77 2872 6762 2c20        show(rgb, 
-00001b60: 6178 3d61 7831 3229 0d0a 2020 2020 2020  ax=ax12)..      
-00001b70: 2020 2020 2020 7368 6f77 287e 636c 6561        show(~clea
-00001b80: 6e5f 6d61 736b 2c20 636d 6170 3d22 6269  n_mask, cmap="bi
-00001b90: 6e61 7279 222c 2061 783d 6178 3232 290d  nary", ax=ax22).
-00001ba0: 0a20 2020 2020 2020 2020 2020 2023 706c  .            #pl
-00001bb0: 742e 7368 6f77 2829 0d0a 2020 2020 2020  t.show()..      
-00001bc0: 2020 2020 2020 626e 3d69 6d67 5f64 6174        bn=img_dat
-00001bd0: 612e 7368 6170 650d 0a20 2020 2020 2020  a.shape..       
-00001be0: 2020 2020 2078 733d 626e 5b32 5d0d 0a20       xs=bn[2].. 
-00001bf0: 2020 2020 2020 2020 2020 2079 733d 626e             ys=bn
-00001c00: 5b31 5d0d 0a20 2020 2020 2020 2020 2020  [1]..           
-00001c10: 2061 7831 322e 7365 745f 786c 696d 2830   ax12.set_xlim(0
-00001c20: 2c20 7873 290d 0a20 2020 2020 2020 2020  , xs)..         
-00001c30: 2020 2061 7831 322e 7365 745f 796c 696d     ax12.set_ylim
-00001c40: 2879 732c 3029 0d0a 2020 2020 2020 2020  (ys,0)..        
-00001c50: 2020 2020 6178 3232 2e73 6574 5f78 6c69      ax22.set_xli
-00001c60: 6d28 302c 2078 7329 0d0a 2020 2020 2020  m(0, xs)..      
-00001c70: 2020 2020 2020 6178 3232 2e73 6574 5f79        ax22.set_y
-00001c80: 6c69 6d28 7973 2c30 290d 0a20 2020 2020  lim(ys,0)..     
-00001c90: 2020 2020 2020 2066 6967 322e 7361 7665         fig2.save
-00001ca0: 6669 6728 6669 675f 6d61 736b 7320 2b20  fig(fig_masks + 
-00001cb0: 222f 2220 2b20 2073 7472 2866 696c 656e  "/" +  str(filen
-00001cc0: 616d 655b 3a31 305d 292b 2022 2e6a 7067  ame[:10])+ ".jpg
-00001cd0: 222c 2064 7069 3d31 3530 290d 0a20 2020  ", dpi=150)..   
-00001ce0: 2020 2020 200d 0a20 2020 2020 2020 2020       ..         
-00001cf0: 2020 2069 6620 706c 6f74 5f66 6967 7572     if plot_figur
-00001d00: 653d 3d54 7275 653a 0d0a 2020 2020 2020  e==True:..      
-00001d10: 2020 2020 2020 2020 2020 706c 742e 7368            plt.sh
-00001d20: 6f77 2829 0d0a 2020 2020 2020 2020 2020  ow()..          
-00001d30: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
-00001d40: 2020 2020 2020 2020 2070 6c74 2e63 6c6f           plt.clo
-00001d50: 7365 2866 6967 3229 0d0a 2020 2020 2020  se(fig2)..      
-00001d60: 2020 2020 2020 2020 2020 0d0a 2020 2020            ..    
-00001d70: 2020 2020 6966 2069 6478 203d 3d20 6c65      if idx == le
-00001d80: 6e28 696d 675f 6c69 7374 293a 0d0a 2020  n(img_list):..  
-00001d90: 2020 2020 2020 2020 2020 6272 6561 6b0d            break.
-00001da0: 0a20 2020 2020 2020 2070 7269 6e74 2822  .        print("
-00001db0: 7072 6f63 6573 7320 6973 2063 6f6d 706c  process is compl
-00001dc0: 6574 6564 2229 0d0a 2020 2020 2020 200d  eted")..       .
-00001dd0: 0a20 2020 2070 7269 6e74 2822 416c 6c20  .    print("All 
-00001de0: 7072 6f63 6573 7320 6973 2063 6f6d 706c  process is compl
-00001df0: 6574 6564 2229 0d0a 2020 2020 2020 2020  eted")..        
-00001e00: 0d0a 0d0a 2020 2020 2020 2020 0d0a 2020  ....        ..  
-00001e10: 2020 2020 2020 2320 2373 686f 7728 6261        # #show(ba
-00001e20: 645f 6d61 736b 2c20 7469 746c 653d 2262  d_mask, title="b
-00001e30: 6164 5f6d 6173 6b3a 2022 2b73 7472 2875  ad_mask: "+str(u
-00001e40: 646d 5f6c 6973 745b 6964 785d 292c 2063  dm_list[idx]), c
-00001e50: 6d61 703d 2262 696e 6172 7922 290d 0a0d  map="binary")...
-00001e60: 0a20 2020 2020 2020 2023 2069 6620 436f  .        # if Co
-00001e70: 6c6f 723d 3d54 7275 653a 0d0a 2020 2020  lor==True:..    
-00001e80: 2020 2020 2320 2020 2020 2020 2020 5247      #         RG
-00001e90: 423d 5b33 2c32 2c31 5d0d 0a20 2020 2020  B=[3,2,1]..     
-00001ea0: 2020 2023 2020 2020 2020 2020 2069 6d67     #         img
-00001eb0: 5f64 6174 6120 3d20 696d 675f 7372 632e  _data = img_src.
-00001ec0: 7265 6164 285b 5247 425b 305d 2c20 5247  read([RGB[0], RG
-00001ed0: 425b 315d 2c20 5247 425b 325d 5d29 2f31  B[1], RGB[2]])/1
-00001ee0: 3030 3020 2023 2061 7070 6c79 2052 4742  000  # apply RGB
-00001ef0: 206f 7264 6572 696e 6720 616e 6420 7363   ordering and sc
-00001f00: 616c 6520 646f 776e 0d0a 2020 2020 2020  ale down..      
-00001f10: 2020 2320 2020 2020 2020 2020 696d 675f    #         img_
-00001f20: 636f 7079 3d69 6d67 5f64 6174 612e 636f  copy=img_data.co
-00001f30: 7079 2829 0d0a 2020 2020 2020 2020 2320  py()..        # 
-00001f40: 2020 2020 2020 2020 6d65 7461 2e75 7064          meta.upd
-00001f50: 6174 6528 7b27 6472 6976 6572 273a 2747  ate({'driver':'G
-00001f60: 5469 6666 272c 0d0a 2020 2020 2020 2020  Tiff',..        
-00001f70: 2320 2020 2020 2020 2020 2027 7769 6474  #          'widt
-00001f80: 6827 3a69 6d67 5f73 7263 2e73 6861 7065  h':img_src.shape
-00001f90: 5b31 5d2c 0d0a 2020 2020 2020 2020 2320  [1],..        # 
-00001fa0: 2020 2020 2020 2020 2027 6865 6967 6874           'height
-00001fb0: 273a 696d 675f 7372 632e 7368 6170 655b  ':img_src.shape[
-00001fc0: 305d 2c0d 0a20 2020 2020 2020 2023 2020  0],..        #  
-00001fd0: 2020 2020 2020 2020 2763 6f75 6e74 273a          'count':
-00001fe0: 332c 0d0a 2020 2020 2020 2020 2320 2020  3,..        #   
-00001ff0: 2020 2020 2020 2027 6474 7970 6527 3a27         'dtype':'
-00002000: 666c 6f61 7433 3227 2c0d 0a20 2020 2020  float32',..     
-00002010: 2020 2023 2020 2020 2020 2020 2020 2763     #          'c
-00002020: 7273 273a 696d 675f 7372 632e 6372 732c  rs':img_src.crs,
-00002030: 200d 0a20 2020 2020 2020 2023 2020 2020   ..        #    
-00002040: 2020 2020 2020 2774 7261 6e73 666f 726d        'transform
-00002050: 273a 696d 675f 7372 632e 7472 616e 7366  ':img_src.transf
-00002060: 6f72 6d2c 0d0a 2020 2020 2020 2020 2320  orm,..        # 
-00002070: 2020 2020 2020 2020 2027 6e6f 6461 7461           'nodata
-00002080: 273a 307d 290d 0a20 2020 2020 2020 2023  ':0})..        #
-00002090: 2020 2020 2020 2020 2069 6620 5564 6d5f           if Udm_
-000020a0: 4d61 736b 5f4f 7074 696f 6e3d 3d54 7275  Mask_Option==Tru
-000020b0: 653a 0d0a 2020 2020 2020 2020 2320 2020  e:..        #   
-000020c0: 2020 2020 2020 2020 2020 696d 675f 6461            img_da
-000020d0: 7461 203d 2069 6d67 5f73 7263 2e72 6561  ta = img_src.rea
-000020e0: 6428 5b52 4742 5b30 5d2c 2052 4742 5b31  d([RGB[0], RGB[1
-000020f0: 5d2c 2052 4742 5b32 5d5d 2c20 6d61 736b  ], RGB[2]], mask
-00002100: 6564 3d54 7275 6529 2f31 3030 300d 0a20  ed=True)/1000.. 
-00002110: 2020 2020 2020 2023 2020 2020 2020 2020         #        
-00002120: 2020 2020 2069 6d67 5f64 6174 612e 6d61       img_data.ma
-00002130: 736b 203d 2062 6164 5f6d 6173 6b0d 0a20  sk = bad_mask.. 
-00002140: 2020 2020 2020 2023 2020 2020 2020 2020         #        
-00002150: 2020 2020 2069 6d67 5f64 6174 6120 3d20       img_data = 
-00002160: 696d 675f 6461 7461 2e66 696c 6c65 6428  img_data.filled(
-00002170: 6669 6c6c 5f76 616c 7565 3d30 290d 0a20  fill_value=0).. 
-00002180: 2020 2020 2020 2023 2020 2020 2020 2020         #        
-00002190: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
-000021a0: 2320 2020 2020 2020 2020 2020 2020 696d  #             im
-000021b0: 675f 6461 7461 3d69 6d67 5f64 6174 610d  g_data=img_data.
-000021c0: 0a0d 0a20 2020 2020 2020 2023 2065 6c69  ...        # eli
-000021d0: 6620 436f 6c6f 723d 3d46 616c 7365 3a0d  f Color==False:.
-000021e0: 0a20 2020 2020 2020 2023 2020 2020 2063  .        #     c
-000021f0: 6c65 616e 5f6d 6173 6b20 3d20 7564 6d5f  lean_mask = udm_
-00002200: 7372 632e 7265 6164 2831 292e 6173 7479  src.read(1).asty
-00002210: 7065 2862 6f6f 6c29 0d0a 2020 2020 2020  pe(bool)..      
-00002220: 2020 2320 2020 2020 6772 6179 3d32 0d0a    #     gray=2..
-00002230: 2020 2020 2020 2020 2320 2020 2020 696d          #     im
-00002240: 675f 6461 7461 203d 2069 6d67 5f73 7263  g_data = img_src
-00002250: 2e72 6561 6428 6772 6179 2920 2023 2061  .read(gray)  # a
-00002260: 7070 6c79 2052 4742 206f 7264 6572 696e  pply RGB orderin
-00002270: 6720 616e 6420 7363 616c 6520 646f 776e  g and scale down
-00002280: 0d0a 2020 2020 2020 2020 2320 2020 2020  ..        #     
-00002290: 696d 675f 6461 7461 3d69 6d67 5f64 6174  img_data=img_dat
-000022a0: 612e 6173 7479 7065 2822 666c 6f61 7422  a.astype("float"
-000022b0: 290d 0a20 2020 2020 2020 2023 2020 2020  )..        #    
-000022c0: 2069 6d67 5f64 6174 615b 636c 6561 6e5f   img_data[clean_
-000022d0: 6d61 736b 3d3d 4661 6c73 655d 3d6e 702e  mask==False]=np.
-000022e0: 6e61 6e0d 0a20 2020 2020 2020 2023 2020  nan..        #  
-000022f0: 2020 2069 6d67 5f63 6f70 793d 696d 675f     img_copy=img_
-00002300: 6461 7461 2e63 6f70 7928 290d 0a20 2020  data.copy()..   
-00002310: 2020 2020 2023 2020 2020 206d 6574 612e       #     meta.
-00002320: 7570 6461 7465 287b 2764 7269 7665 7227  update({'driver'
-00002330: 3a27 4754 6966 6627 2c0d 0a20 2020 2020  :'GTiff',..     
-00002340: 2020 2023 2020 2020 2020 2020 2020 2777     #          'w
-00002350: 6964 7468 273a 696d 675f 7372 632e 7368  idth':img_src.sh
-00002360: 6170 655b 315d 2c0d 0a20 2020 2020 2020  ape[1],..       
-00002370: 2023 2020 2020 2020 2020 2020 2768 6569   #          'hei
-00002380: 6768 7427 3a69 6d67 5f73 7263 2e73 6861  ght':img_src.sha
-00002390: 7065 5b30 5d2c 0d0a 2020 2020 2020 2020  pe[0],..        
-000023a0: 2320 2020 2020 2020 2020 2027 636f 756e  #          'coun
-000023b0: 7427 3a31 2c0d 0a20 2020 2020 2020 2023  t':1,..        #
-000023c0: 2020 2020 2020 2020 2020 2764 7479 7065            'dtype
-000023d0: 273a 2766 6c6f 6174 3332 272c 0d0a 2020  ':'float32',..  
-000023e0: 2020 2020 2020 2320 2020 2020 2020 2020        #         
-000023f0: 2027 6372 7327 3a69 6d67 5f73 7263 2e63   'crs':img_src.c
-00002400: 7273 2c20 0d0a 2020 2020 2020 2020 2320  rs, ..        # 
-00002410: 2020 2020 2020 2020 2027 7472 616e 7366           'transf
-00002420: 6f72 6d27 3a69 6d67 5f73 7263 2e74 7261  orm':img_src.tra
-00002430: 6e73 666f 726d 2c0d 0a20 2020 2020 2020  nsform,..       
-00002440: 2023 2020 2020 2020 2020 2020 276e 6f64   #          'nod
-00002450: 6174 6127 3a30 7d29 0d0a 0d0a 0d0a 2020  ata':0})......  
-00002460: 2020 2020 2020 2320 7072 696e 7420 2822        # print ("
-00002470: 696d 675f 6461 7461 2073 6861 7065 3a20  img_data shape: 
-00002480: 222c 2069 6d67 5f64 6174 612e 7368 6170  ", img_data.shap
-00002490: 6529 0d0a 0d0a 2020 2020 2020 2020 2320  e)....        # 
-000024a0: 696d 675f 6461 7461 3d65 7870 6f73 7572  img_data=exposur
-000024b0: 652e 7265 7363 616c 655f 696e 7465 6e73  e.rescale_intens
-000024c0: 6974 7928 696d 675f 6461 7461 2c20 6f75  ity(img_data, ou
-000024d0: 745f 7261 6e67 653d 2830 2c20 3235 3529  t_range=(0, 255)
-000024e0: 292e 6173 7479 7065 286e 702e 7569 6e74  ).astype(np.uint
-000024f0: 3829 0d0a 2020 2020 2020 2020 0d0a 2020  8)..        ..  
-00002500: 2020 2020 2020 2320 2347 6c6f 6261 6c20        # #Global 
-00002510: 4869 7374 6f67 7261 6d20 4571 7561 6c69  Histogram Equali
-00002520: 7a61 7469 6f6e 0d0a 2020 2020 2020 2020  zation..        
-00002530: 2320 696d 675f 6869 7374 6f5f 6571 7520  # img_histo_equ 
-00002540: 3d20 6578 706f 7375 7265 2e65 7175 616c  = exposure.equal
-00002550: 697a 655f 6869 7374 2869 6d67 5f64 6174  ize_hist(img_dat
-00002560: 612c 206d 6173 6b3d 636c 6561 6e5f 6d61  a, mask=clean_ma
-00002570: 736b 290d 0a0d 0a20 2020 2020 2020 200d  sk)....        .
-00002580: 0a20 2020 2020 2020 2023 2069 6d67 5f68  .        # img_h
-00002590: 6973 746f 5f65 7175 5b69 6d67 5f63 6f70  isto_equ[img_cop
-000025a0: 793d 3d30 5d3d 300d 0a0d 0a20 2020 2020  y==0]=0....     
-000025b0: 2020 2023 2069 6d67 5f68 6973 746f 5f65     # img_histo_e
-000025c0: 7175 3d65 7870 6f73 7572 652e 7265 7363  qu=exposure.resc
-000025d0: 616c 655f 696e 7465 6e73 6974 7928 696d  ale_intensity(im
-000025e0: 675f 6869 7374 6f5f 6571 752c 206f 7574  g_histo_equ, out
-000025f0: 5f72 616e 6765 3d28 302c 2032 3535 2929  _range=(0, 255))
-00002600: 2e61 7374 7970 6528 6e70 2e75 696e 7438  .astype(np.uint8
-00002610: 290d 0a0d 0a20 2020 2020 2020 2023 2023  )....        # #
-00002620: 4170 706c 7920 434c 4148 4520 4669 6c74  Apply CLAHE Filt
-00002630: 6572 2031 2061 6e64 2032 0d0a 2020 2020  er 1 and 2..    
-00002640: 2020 2020 2320 6669 6c74 6572 6564 696d      # filteredim
-00002650: 6167 6520 3d20 6578 706f 7375 7265 2e65  age = exposure.e
-00002660: 7175 616c 697a 655f 6164 6170 7468 6973  qualize_adapthis
-00002670: 7428 696d 675f 6869 7374 6f5f 6571 752c  t(img_histo_equ,
-00002680: 2063 6c69 705f 6c69 6d69 743d 302e 3031   clip_limit=0.01
-00002690: 2c20 6e62 696e 733d 3235 3629 0d0a 0d0a  , nbins=256)....
-000026a0: 2020 2020 2020 2020 2320 6669 6c74 6572          # filter
-000026b0: 6564 696d 6167 655b 696d 675f 636f 7079  edimage[img_copy
-000026c0: 3d3d 305d 3d30 0d0a 0d0a 2020 2020 2020  ==0]=0....      
-000026d0: 2020 2320 6966 2055 646d 5f4d 6173 6b5f    # if Udm_Mask_
-000026e0: 4f70 7469 6f6e 3d3d 5472 7565 3a0d 0a20  Option==True:.. 
-000026f0: 2020 2020 2020 2023 2020 2020 2066 696c         #     fil
-00002700: 7465 7265 6469 6d61 6765 3d66 696c 7465  teredimage=filte
-00002710: 7265 6469 6d61 6765 2e61 7374 7970 6528  redimage.astype(
-00002720: 2266 6c6f 6174 2229 0d0a 2020 2020 2020  "float")..      
-00002730: 2020 2320 2020 2020 6669 6c74 6572 6564    #     filtered
-00002740: 696d 6167 655b 636c 6561 6e5f 6d61 736b  image[clean_mask
-00002750: 3d3d 4661 6c73 655d 3d6e 702e 6e61 6e0d  ==False]=np.nan.
-00002760: 0a0d 0a20 2020 2020 2020 2023 2066 696c  ...        # fil
-00002770: 7465 7265 6469 6d61 6765 3d65 7870 6f73  teredimage=expos
-00002780: 7572 652e 7265 7363 616c 655f 696e 7465  ure.rescale_inte
-00002790: 6e73 6974 7928 6669 6c74 6572 6564 696d  nsity(filteredim
-000027a0: 6167 652c 206f 7574 5f72 616e 6765 3d28  age, out_range=(
-000027b0: 302c 2032 3535 2929 2e61 7374 7970 6528  0, 255)).astype(
-000027c0: 6e70 2e75 696e 7438 290d 0a0d 0a20 2020  np.uint8)....   
-000027d0: 2020 2020 2023 2066 696c 7465 7265 6469       # filteredi
-000027e0: 6d61 6765 203d 2065 7870 6f73 7572 652e  mage = exposure.
-000027f0: 6571 7561 6c69 7a65 5f61 6461 7074 6869  equalize_adapthi
-00002800: 7374 2866 696c 7465 7265 6469 6d61 6765  st(filteredimage
-00002810: 2c20 636c 6970 5f6c 696d 6974 3d30 2e30  , clip_limit=0.0
-00002820: 312c 206e 6269 6e73 3d32 3536 290d 0a0d  1, nbins=256)...
-00002830: 0a20 2020 2020 2020 2023 2066 696c 7465  .        # filte
-00002840: 7265 6469 6d61 6765 5b69 6d67 5f63 6f70  redimage[img_cop
-00002850: 793d 3d30 5d3d 300d 0a0d 0a20 2020 2020  y==0]=0....     
-00002860: 2020 2023 2069 6620 5564 6d5f 4d61 736b     # if Udm_Mask
-00002870: 5f4f 7074 696f 6e3d 3d54 7275 653a 0d0a  _Option==True:..
-00002880: 2020 2020 2020 2020 2320 2020 2020 6669          #     fi
-00002890: 6c74 6572 6564 696d 6167 653d 6669 6c74  lteredimage=filt
-000028a0: 6572 6564 696d 6167 652e 6173 7479 7065  eredimage.astype
-000028b0: 2822 666c 6f61 7422 290d 0a20 2020 2020  ("float")..     
-000028c0: 2020 2023 2020 2020 2066 696c 7465 7265     #     filtere
-000028d0: 6469 6d61 6765 5b63 6c65 616e 5f6d 6173  dimage[clean_mas
-000028e0: 6b3d 3d46 616c 7365 5d3d 6e70 2e6e 616e  k==False]=np.nan
-000028f0: 0d0a 0d0a 2020 2020 2020 2020 0d0a 2020  ....        ..  
-00002900: 2020 2020 2020 2320 6669 6c74 6572 6564        # filtered
-00002910: 696d 6167 653d 6578 706f 7375 7265 2e72  image=exposure.r
-00002920: 6573 6361 6c65 5f69 6e74 656e 7369 7479  escale_intensity
-00002930: 2866 696c 7465 7265 6469 6d61 6765 2c20  (filteredimage, 
-00002940: 6f75 745f 7261 6e67 653d 2830 2c20 3235  out_range=(0, 25
-00002950: 3529 292e 6173 7479 7065 286e 702e 7569  5)).astype(np.ui
-00002960: 6e74 3829 0d0a 2020 2020 2020 200d 0a20  nt8)..       .. 
-00002970: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
-00002980: 0d0a 2020 2020 0d0a 2020 2020 2020 2020  ..    ..        
-00002990: 2320 6669 6c74 6572 6564 696d 6167 655b  # filteredimage[
-000029a0: 696d 675f 636f 7079 3d3d 305d 3d30 0d0a  img_copy==0]=0..
-000029b0: 2020 2020 2020 2020 2320 6966 2055 646d          # if Udm
-000029c0: 5f4d 6173 6b5f 4f70 7469 6f6e 3d3d 5472  _Mask_Option==Tr
-000029d0: 7565 3a0d 0a20 2020 2020 2020 2023 2020  ue:..        #  
-000029e0: 2020 2066 696c 7465 7265 6469 6d61 6765     filteredimage
-000029f0: 3d66 696c 7465 7265 6469 6d61 6765 2e61  =filteredimage.a
-00002a00: 7374 7970 6528 2266 6c6f 6174 2229 0d0a  stype("float")..
-00002a10: 2020 2020 2020 2020 2320 2020 2020 6669          #     fi
-00002a20: 6c74 6572 6564 696d 6167 655b 636c 6561  lteredimage[clea
-00002a30: 6e5f 6d61 736b 3d3d 4661 6c73 655d 3d6e  n_mask==False]=n
-00002a40: 702e 6e61 6e0d 0a0d 0a20 2020 2020 2020  p.nan....       
-00002a50: 2023 2023 6669 6c74 6572 6564 696d 6167   # #filteredimag
-00002a60: 653d 6e70 2e74 7261 6e73 706f 7365 2866  e=np.transpose(f
-00002a70: 696c 7465 7265 6469 6d61 6765 2c20 2831  ilteredimage, (1
-00002a80: 2c30 2929 0d0a 2020 2020 2020 2020 2320  ,0))..        # 
-00002a90: 6669 6c74 6572 6564 696d 6167 653d 6e70  filteredimage=np
-00002aa0: 2e74 7261 6e73 706f 7365 2866 696c 7465  .transpose(filte
-00002ab0: 7265 6469 6d61 6765 2c20 2830 2c31 2c20  redimage, (0,1, 
-00002ac0: 3229 290d 0a20 2020 2020 2020 2023 2070  2))..        # p
-00002ad0: 7269 6e74 2028 6669 6c74 6572 6564 696d  rint (filteredim
-00002ae0: 6167 652e 7368 6170 6529 0d0a 2020 2020  age.shape)..    
-00002af0: 2020 2020 2320 7769 7468 2072 6173 7465      # with raste
-00002b00: 7269 6f2e 6f70 656e 286f 7574 7061 7468  rio.open(outpath
-00002b10: 5f64 6972 2b20 222f 2220 2b20 7374 7228  _dir+ "/" + str(
-00002b20: 6669 6c65 6e61 6d65 292c 2020 2777 2b27  filename),  'w+'
-00002b30: 2c20 2a2a 6d65 7461 2920 6173 2064 7374  , **meta) as dst
-00002b40: 3a0d 0a20 2020 2020 2020 2023 2020 2020  :..        #    
-00002b50: 2064 7374 2e77 7269 7465 2866 696c 7465   dst.write(filte
-00002b60: 7265 6469 6d61 6765 290d 0a0d 0a69 6d70  redimage)....imp
-00002b70: 6f72 7420 6f73 0d0a 6672 6f6d 206f 7367  ort os..from osg
-00002b80: 656f 2069 6d70 6f72 7420 6764 616c 0d0a  eo import gdal..
-00002b90: 696d 706f 7274 206e 756d 7079 2061 7320  import numpy as 
-00002ba0: 6e70 0d0a 696d 706f 7274 206d 6174 706c  np..import matpl
-00002bb0: 6f74 6c69 622e 7079 706c 6f74 2061 7320  otlib.pyplot as 
-00002bc0: 706c 740d 0a0d 0a23 2064 6566 2070 6374  plt....# def pct
-00002bd0: 5f63 6c69 7028 6172 7261 792c 2070 6374  _clip(array, pct
-00002be0: 3d5b 322c 2039 385d 293a 0d0a 2320 2020  =[2, 98]):..#   
-00002bf0: 2020 2222 220d 0a23 2020 2020 2043 6c69    """..#     Cli
-00002c00: 7020 616e 2061 7272 6179 2062 6173 6564  p an array based
-00002c10: 206f 6e20 7065 7263 656e 7469 6c65 732e   on percentiles.
-00002c20: 0d0a 0d0a 2320 2020 2020 4172 6773 3a0d  ....#     Args:.
-00002c30: 0a23 2020 2020 2020 2020 2061 7272 6179  .#         array
-00002c40: 2028 6e64 6172 7261 7929 3a20 496e 7075   (ndarray): Inpu
-00002c50: 7420 6172 7261 792e 0d0a 2320 2020 2020  t array...#     
-00002c60: 2020 2020 7063 7420 286c 6973 7429 3a20      pct (list): 
-00002c70: 4c69 7374 206f 6620 7065 7263 656e 7469  List of percenti
-00002c80: 6c65 7320 5b6c 6f77 6572 2c20 7570 7065  les [lower, uppe
-00002c90: 725d 2066 6f72 2063 6c69 7070 696e 672e  r] for clipping.
-00002ca0: 0d0a 2020 2020 0d0a 2320 2020 2020 5265  ..    ..#     Re
-00002cb0: 7475 726e 733a 0d0a 2320 2020 2020 2020  turns:..#       
-00002cc0: 2020 6e64 6172 7261 793a 2043 6c69 7070    ndarray: Clipp
-00002cd0: 6564 2061 7272 6179 2e0d 0a23 2020 2020  ed array...#    
-00002ce0: 2022 2222 0d0a 2320 2020 2020 6172 7261   """..#     arra
-00002cf0: 795f 6d69 6e2c 2061 7272 6179 5f6d 6178  y_min, array_max
-00002d00: 203d 206e 702e 6e61 6e70 6572 6365 6e74   = np.nanpercent
-00002d10: 696c 6528 6172 7261 792c 2070 6374 5b30  ile(array, pct[0
-00002d20: 5d29 2c20 6e70 2e6e 616e 7065 7263 656e  ]), np.nanpercen
-00002d30: 7469 6c65 2861 7272 6179 2c20 7063 745b  tile(array, pct[
-00002d40: 315d 290d 0a23 2020 2020 2063 6c69 7020  1])..#     clip 
-00002d50: 3d20 2861 7272 6179 202d 2061 7272 6179  = (array - array
-00002d60: 5f6d 696e 2920 2f20 2861 7272 6179 5f6d  _min) / (array_m
-00002d70: 6178 202d 2061 7272 6179 5f6d 696e 290d  ax - array_min).
-00002d80: 0a23 2020 2020 2063 6c69 705b 636c 6970  .#     clip[clip
-00002d90: 203e 2031 5d20 3d20 310d 0a23 2020 2020   > 1] = 1..#    
-00002da0: 2063 6c69 705b 636c 6970 203c 2030 5d20   clip[clip < 0] 
-00002db0: 3d20 300d 0a23 2020 2020 2072 6574 7572  = 0..#     retur
-00002dc0: 6e20 636c 6970 0d0a 0d0a 696d 706f 7274  n clip....import
-00002dd0: 206e 756d 7079 2061 7320 6e70 0d0a 696d   numpy as np..im
-00002de0: 706f 7274 2063 7632 0d0a 6672 6f6d 206f  port cv2..from o
-00002df0: 7367 656f 2069 6d70 6f72 7420 6764 616c  sgeo import gdal
-00002e00: 0d0a 696d 706f 7274 206f 730d 0a66 726f  ..import os..fro
-00002e10: 6d20 736b 696d 6167 6520 696d 706f 7274  m skimage import
-00002e20: 2072 6573 746f 7261 7469 6f6e 2c20 6578   restoration, ex
-00002e30: 706f 7375 7265 0d0a 696d 706f 7274 206d  posure..import m
-00002e40: 6174 706c 6f74 6c69 622e 7079 706c 6f74  atplotlib.pyplot
-00002e50: 2061 7320 706c 740d 0a66 726f 6d20 7471   as plt..from tq
-00002e60: 646d 2069 6d70 6f72 7420 7471 646d 0d0a  dm import tqdm..
-00002e70: 6672 6f6d 2073 6b69 6d61 6765 2e66 696c  from skimage.fil
-00002e80: 7465 7273 2069 6d70 6f72 7420 6761 7573  ters import gaus
-00002e90: 7369 616e 0d0a 696d 706f 7274 2072 6173  sian..import ras
-00002ea0: 7465 7269 6f0d 0a0d 0a64 6566 2052 6173  terio....def Ras
-00002eb0: 7465 725f 436f 7272 6563 7469 6f6e 2869  ter_Correction(i
-00002ec0: 6e70 7574 5f70 6174 682c 206f 7574 7075  nput_path, outpu
-00002ed0: 745f 7061 7468 2c20 6c69 6d69 743d 4e6f  t_path, limit=No
-00002ee0: 6e65 2c20 6c6f 7770 6173 735f 6b65 726e  ne, lowpass_kern
-00002ef0: 656c 5f73 697a 653d 352c 0d0a 2020 2020  el_size=5,..    
-00002f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002f10: 2020 6269 6c61 7465 7261 6c5f 7769 6e5f    bilateral_win_
-00002f20: 7369 7a65 3d39 2c20 6269 6c61 7465 7261  size=9, bilatera
-00002f30: 6c5f 7369 676d 615f 636f 6c6f 723d 3735  l_sigma_color=75
-00002f40: 2c20 6269 6c61 7465 7261 6c5f 7369 676d  , bilateral_sigm
-00002f50: 615f 7370 6174 6961 6c3d 3735 2c0d 0a20  a_spatial=75,.. 
-00002f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002f70: 2020 2020 2063 6c69 705f 7065 7263 656e       clip_percen
-00002f80: 7469 6c65 733d 5b32 2c20 3938 5d2c 206f  tiles=[2, 98], o
-00002f90: 7074 6963 616c 3d46 616c 7365 2c20 7363  ptical=False, sc
-00002fa0: 616c 653d 2770 6f77 6572 272c 2056 6567  ale='power', Veg
-00002fb0: 6574 6174 696f 6e5f 6d61 736b 3d4e 6f6e  etation_mask=Non
-00002fc0: 652c 2043 4c41 4845 5f66 696c 7465 723d  e, CLAHE_filter=
-00002fd0: 4661 6c73 6529 3a0d 0a20 2020 2022 2222  False):..    """
-00002fe0: 0d0a 2020 2020 5065 7266 6f72 6d73 2061  ..    Performs a
-00002ff0: 2073 6572 6965 7320 6f66 2069 6d61 6765   series of image
-00003000: 2063 6f72 7265 6374 696f 6e20 616e 6420   correction and 
-00003010: 656e 6861 6e63 656d 656e 7420 6f70 6572  enhancement oper
-00003020: 6174 696f 6e73 206f 6e20 7261 7374 6572  ations on raster
-00003030: 2069 6d61 6765 732c 0d0a 2020 2020 7370   images,..    sp
-00003040: 6563 6966 6963 616c 6c79 2074 6169 6c6f  ecifically tailo
-00003050: 7265 6420 666f 7220 5379 6e74 6865 7469  red for Syntheti
-00003060: 6320 4170 6572 7475 7265 2052 6164 6172  c Aperture Radar
-00003070: 2028 5341 5229 2064 6174 612c 2062 7574   (SAR) data, but
-00003080: 2063 616e 2062 6520 7573 6564 2066 6f72   can be used for
-00003090: 206f 7468 6572 2072 6173 7465 7273 2074   other rasters t
-000030a0: 6f6f 2e0d 0a0d 0a20 2020 2054 6869 7320  oo.....    This 
-000030b0: 6675 6e63 7469 6f6e 2061 6368 6965 7665  function achieve
-000030c0: 7320 6465 6e6f 6973 696e 672c 206e 6f72  s denoising, nor
-000030d0: 6d61 6c69 7a61 7469 6f6e 2c20 616e 6420  malization, and 
-000030e0: 636f 6e74 7261 7374 2065 6e68 616e 6365  contrast enhance
-000030f0: 6d65 6e74 2066 6f72 2072 6173 7465 7220  ment for raster 
-00003100: 696d 6167 6573 0d0a 2020 2020 6261 7365  images..    base
-00003110: 6420 6f6e 2075 7365 722d 7370 6563 6966  d on user-specif
-00003120: 6965 6420 7061 7261 6d65 7465 7273 2e20  ied parameters. 
-00003130: 5468 6520 6675 6e63 7469 6f6e 2069 7320  The function is 
-00003140: 6465 7369 676e 6564 2074 6f20 776f 726b  designed to work
-00003150: 2065 6666 6563 7469 7665 6c79 2077 6974   effectively wit
-00003160: 6820 626f 7468 200d 0a20 2020 206f 7074  h both ..    opt
-00003170: 6963 616c 2061 6e64 2053 4152 2069 6d61  ical and SAR ima
-00003180: 6765 7279 2e0d 0a0d 0a20 2020 2041 7267  gery.....    Arg
-00003190: 733a 0d0a 2020 2020 2020 2020 696e 7075  s:..        inpu
-000031a0: 745f 7061 7468 2028 7374 7229 3a20 5061  t_path (str): Pa
-000031b0: 7468 2074 6f20 7468 6520 6469 7265 6374  th to the direct
-000031c0: 6f72 7920 636f 6e74 6169 6e69 6e67 2069  ory containing i
-000031d0: 6e70 7574 2072 6173 7465 7220 696d 6167  nput raster imag
-000031e0: 6573 2e0d 0a20 2020 2020 2020 200d 0a20  es...        .. 
-000031f0: 2020 2020 2020 206f 7574 7075 745f 7061         output_pa
-00003200: 7468 2028 7374 7229 3a20 4469 7265 6374  th (str): Direct
-00003210: 6f72 7920 7768 6572 6520 636f 7272 6563  ory where correc
-00003220: 7465 6420 696d 6167 6573 2061 6e64 2070  ted images and p
-00003230: 6c6f 7473 2077 696c 6c20 6265 2073 6176  lots will be sav
-00003240: 6564 2e0d 0a20 2020 2020 2020 200d 0a20  ed...        .. 
-00003250: 2020 2020 2020 206c 696d 6974 2028 696e         limit (in
-00003260: 742c 206f 7074 696f 6e61 6c29 3a20 4d61  t, optional): Ma
-00003270: 7869 6d75 6d20 6e75 6d62 6572 206f 6620  ximum number of 
-00003280: 696d 6167 6573 2074 6f20 7072 6f63 6573  images to proces
-00003290: 732e 2049 6620 4e6f 6e65 2c20 616c 6c20  s. If None, all 
-000032a0: 696d 6167 6573 2061 7265 2070 726f 6365  images are proce
-000032b0: 7373 6564 2e0d 0a20 2020 2020 2020 200d  ssed...        .
-000032c0: 0a20 2020 2020 2020 206c 6f77 7061 7373  .        lowpass
-000032d0: 5f6b 6572 6e65 6c5f 7369 7a65 2028 696e  _kernel_size (in
-000032e0: 742c 206f 7074 696f 6e61 6c29 3a20 5369  t, optional): Si
-000032f0: 7a65 206f 6620 7468 6520 4761 7573 7369  ze of the Gaussi
-00003300: 616e 206c 6f77 2d70 6173 7320 6669 6c74  an low-pass filt
-00003310: 6572 206b 6572 6e65 6c2e 0d0a 2020 2020  er kernel...    
-00003320: 2020 2020 0d0a 2020 2020 2020 2020 6269      ..        bi
-00003330: 6c61 7465 7261 6c5f 7769 6e5f 7369 7a65  lateral_win_size
-00003340: 2028 696e 7429 3a20 5369 7a65 206f 6620   (int): Size of 
-00003350: 7468 6520 6269 6c61 7465 7261 6c20 6669  the bilateral fi
-00003360: 6c74 6572 2077 696e 646f 772e 0d0a 2020  lter window...  
-00003370: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
-00003380: 6269 6c61 7465 7261 6c5f 7369 676d 615f  bilateral_sigma_
-00003390: 636f 6c6f 7220 2869 6e74 293a 2053 7461  color (int): Sta
-000033a0: 6e64 6172 6420 6465 7669 6174 696f 6e20  ndard deviation 
-000033b0: 666f 7220 636f 6c6f 7220 7370 6163 6520  for color space 
-000033c0: 696e 2062 696c 6174 6572 616c 2066 696c  in bilateral fil
-000033d0: 7465 722e 0d0a 2020 2020 2020 2020 0d0a  ter...        ..
-000033e0: 2020 2020 2020 2020 6269 6c61 7465 7261          bilatera
-000033f0: 6c5f 7369 676d 615f 7370 6174 6961 6c20  l_sigma_spatial 
-00003400: 2869 6e74 293a 2053 7461 6e64 6172 6420  (int): Standard 
-00003410: 6465 7669 6174 696f 6e20 666f 7220 7370  deviation for sp
-00003420: 6174 6961 6c20 7370 6163 6520 696e 2062  atial space in b
-00003430: 696c 6174 6572 616c 2066 696c 7465 722e  ilateral filter.
-00003440: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
-00003450: 2020 2020 636c 6970 5f70 6572 6365 6e74      clip_percent
-00003460: 696c 6573 2028 6c69 7374 293a 2032 2d65  iles (list): 2-e
-00003470: 6c65 6d65 6e74 206c 6973 7420 636f 6e74  lement list cont
-00003480: 6169 6e69 6e67 206c 6f77 6572 2061 6e64  aining lower and
-00003490: 2075 7070 6572 2070 6572 6365 6e74 696c   upper percentil
-000034a0: 6573 2066 6f72 2063 6c69 7070 696e 6720  es for clipping 
-000034b0: 7069 7865 6c20 7661 6c75 6573 2e0d 0a20  pixel values... 
-000034c0: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
-000034d0: 206f 7074 6963 616c 2028 626f 6f6c 293a   optical (bool):
-000034e0: 2049 6e64 6963 6174 6573 2069 6620 7468   Indicates if th
-000034f0: 6520 7261 7374 6572 2069 7320 6f70 7469  e raster is opti
-00003500: 6361 6c20 696d 6167 6572 792e 2041 6374  cal imagery. Act
-00003510: 6976 6174 6573 2063 6572 7461 696e 2063  ivates certain c
-00003520: 6f72 7265 6374 696f 6e73 2073 7065 6369  orrections speci
-00003530: 6669 6320 746f 206f 7074 6963 616c 2064  fic to optical d
-00003540: 6174 612e 0d0a 2020 2020 2020 2020 0d0a  ata...        ..
-00003550: 2020 2020 2020 2020 7363 616c 6520 2873          scale (s
-00003560: 7472 293a 204d 6f64 6520 6f66 2073 6361  tr): Mode of sca
-00003570: 6c69 6e67 2028 2770 6f77 6572 2720 666f  ling ('power' fo
-00003580: 7220 6c6f 6761 7269 7468 6d69 6320 6e6f  r logarithmic no
-00003590: 726d 616c 697a 6174 696f 6e20 616e 6420  rmalization and 
-000035a0: 2761 6d70 6c69 7475 6465 2720 666f 7220  'amplitude' for 
-000035b0: 6c69 6e65 6172 292e 0d0a 2020 2020 2020  linear)...      
-000035c0: 2020 0d0a 2020 2020 2020 2020 5665 6765    ..        Vege
-000035d0: 7461 7469 6f6e 5f6d 6173 6b20 2873 7472  tation_mask (str
-000035e0: 2c20 6f70 7469 6f6e 616c 293a 2050 6174  , optional): Pat
-000035f0: 6820 746f 2061 2072 6173 7465 7220 6669  h to a raster fi
-00003600: 6c65 2074 6861 7420 7265 7072 6573 656e  le that represen
-00003610: 7473 2061 2076 6567 6574 6174 696f 6e20  ts a vegetation 
-00003620: 6d61 736b 2e20 5069 7865 6c73 2069 6e20  mask. Pixels in 
-00003630: 7468 6520 696e 7075 7420 696d 6167 6520  the input image 
-00003640: 7468 6174 2063 6f72 7265 7370 6f6e 6420  that correspond 
-00003650: 746f 206e 6f6e 2d76 6567 6574 6174 696f  to non-vegetatio
-00003660: 6e20 696e 2074 6865 206d 6173 6b20 7769  n in the mask wi
-00003670: 6c6c 2062 6520 7365 7420 746f 206f 6e65  ll be set to one
-00003680: 2e0d 0a0d 0a20 2020 2052 6574 7572 6e73  .....    Returns
-00003690: 3a0d 0a20 2020 2020 2020 204e 6f6e 652e  :..        None.
-000036a0: 204f 7574 7075 7473 2061 7265 2073 6176   Outputs are sav
-000036b0: 6564 2074 6f20 7468 6520 7370 6563 6966  ed to the specif
-000036c0: 6965 6420 6469 7265 6374 6f72 792e 0d0a  ied directory...
-000036d0: 0d0a 2020 2020 4f75 7470 7574 733a 0d0a  ..    Outputs:..
-000036e0: 2020 2020 2020 2020 2d20 436f 7272 6563          - Correc
-000036f0: 7465 6420 7261 7374 6572 2069 6d61 6765  ted raster image
-00003700: 7320 7361 7665 6420 696e 2047 656f 5449  s saved in GeoTI
-00003710: 4646 2066 6f72 6d61 742e 0d0a 2020 2020  FF format...    
-00003720: 2020 2020 2d20 506c 6f74 7320 636f 6d70      - Plots comp
-00003730: 6172 696e 6720 6f72 6967 696e 616c 2c20  aring original, 
-00003740: 6669 6c74 6572 6564 2c20 616e 6420 636f  filtered, and co
-00003750: 7272 6563 7465 6420 696d 6167 6573 2061  rrected images a
-00003760: 6c6f 6e67 2077 6974 6820 7468 6569 7220  long with their 
-00003770: 6869 7374 6f67 7261 6d73 2e0d 0a0d 0a20  histograms..... 
-00003780: 2020 2055 7361 6765 3a0d 0a20 2020 2020     Usage:..     
-00003790: 2020 2053 7569 7461 626c 6520 666f 7220     Suitable for 
-000037a0: 626f 7468 2053 4152 2061 6e64 206f 7074  both SAR and opt
-000037b0: 6963 616c 2069 6d61 6765 7279 2063 6f72  ical imagery cor
-000037c0: 7265 6374 696f 6e2e 2041 646a 7573 7420  rection. Adjust 
-000037d0: 6669 6c74 6572 2070 6172 616d 6574 6572  filter parameter
-000037e0: 7320 6173 2070 6572 2074 6865 206e 6174  s as per the nat
-000037f0: 7572 6520 6f66 2069 6e70 7574 2072 6173  ure of input ras
-00003800: 7465 720d 0a20 2020 2020 2020 2061 6e64  ter..        and
-00003810: 2064 6573 6972 6564 206f 7574 7075 742e   desired output.
-00003820: 0d0a 0d0a 2020 2020 4e6f 7465 733a 0d0a  ....    Notes:..
-00003830: 2020 2020 2020 2020 2d20 456e 7375 7265          - Ensure
-00003840: 2074 6861 7420 7468 6520 4744 414c 2061   that the GDAL a
-00003850: 6e64 206f 7468 6572 206e 6563 6573 7361  nd other necessa
-00003860: 7279 206c 6962 7261 7269 6573 2061 7265  ry libraries are
-00003870: 2063 6f72 7265 6374 6c79 2069 6e73 7461   correctly insta
-00003880: 6c6c 6564 2e0d 0a20 2020 2020 2020 202d  lled...        -
-00003890: 2054 6865 2066 756e 6374 696f 6e20 7573   The function us
-000038a0: 6573 2074 7164 6d20 746f 2070 726f 7669  es tqdm to provi
-000038b0: 6465 2061 2070 726f 6772 6573 7320 6261  de a progress ba
-000038c0: 722c 2073 6f20 656e 7375 7265 2069 7427  r, so ensure it'
-000038d0: 7320 696e 7374 616c 6c65 6420 6966 2079  s installed if y
-000038e0: 6f75 2077 616e 7420 7468 6520 7072 6f67  ou want the prog
-000038f0: 7265 7373 2076 6973 7561 6c69 7a61 7469  ress visualizati
-00003900: 6f6e 2e0d 0a20 2020 2020 2020 202d 2054  on...        - T
-00003910: 6865 2066 756e 6374 696f 6e20 6861 7320  he function has 
-00003920: 6265 656e 206f 7074 696d 697a 6564 2066  been optimized f
-00003930: 6f72 2061 2062 616c 616e 6365 2062 6574  or a balance bet
-00003940: 7765 656e 2070 6572 666f 726d 616e 6365  ween performance
-00003950: 2061 6e64 2071 7561 6c69 7479 2c20 6275   and quality, bu
-00003960: 7420 7072 6f63 6573 7369 6e67 206c 6172  t processing lar
-00003970: 6765 2072 6173 7465 7220 6461 7461 7365  ge raster datase
-00003980: 7473 0d0a 2020 2020 2020 2020 2020 6d69  ts..          mi
-00003990: 6768 7420 7374 696c 6c20 6265 2063 6f6d  ght still be com
-000039a0: 7075 7461 7469 6f6e 616c 6c79 2069 6e74  putationally int
-000039b0: 656e 7369 7665 2e0d 0a20 2020 2022 2222  ensive...    """
-000039c0: 0d0a 2020 2020 6465 6620 7063 745f 636c  ..    def pct_cl
-000039d0: 6970 2861 7272 6179 2c20 7063 743d 636c  ip(array, pct=cl
-000039e0: 6970 5f70 6572 6365 6e74 696c 6573 293a  ip_percentiles):
-000039f0: 0d0a 2020 2020 2020 2020 6172 7261 7920  ..        array 
-00003a00: 3d20 6172 7261 792e 636f 7079 2829 2020  = array.copy()  
-00003a10: 2320 4372 6561 7465 2061 2077 7269 7461  # Create a writa
-00003a20: 626c 6520 636f 7079 0d0a 2020 2020 2020  ble copy..      
-00003a30: 2020 6172 7261 795f 6d69 6e2c 2061 7272    array_min, arr
-00003a40: 6179 5f6d 6178 203d 206e 702e 6e61 6e70  ay_max = np.nanp
-00003a50: 6572 6365 6e74 696c 6528 6172 7261 792c  ercentile(array,
-00003a60: 2070 6374 5b30 5d29 2c20 6e70 2e6e 616e   pct[0]), np.nan
-00003a70: 7065 7263 656e 7469 6c65 2861 7272 6179  percentile(array
-00003a80: 2c20 7063 745b 315d 290d 0a20 2020 2020  , pct[1])..     
-00003a90: 2020 2063 6c69 7020 3d20 2861 7272 6179     clip = (array
-00003aa0: 202d 2061 7272 6179 5f6d 696e 2920 2f20   - array_min) / 
-00003ab0: 2861 7272 6179 5f6d 6178 202d 2061 7272  (array_max - arr
-00003ac0: 6179 5f6d 696e 290d 0a20 2020 2020 2020  ay_min)..       
-00003ad0: 2063 6c69 705b 636c 6970 203e 2031 5d20   clip[clip > 1] 
-00003ae0: 3d20 310d 0a20 2020 2020 2020 2063 6c69  = 1..        cli
-00003af0: 705b 636c 6970 203c 2030 5d20 3d20 300d  p[clip < 0] = 0.
-00003b00: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00003b10: 636c 6970 0d0a 0d0a 2020 2020 696d 6167  clip....    imag
-00003b20: 655f 6578 7465 6e73 696f 6e73 203d 2028  e_extensions = (
-00003b30: 272e 7469 6627 2c20 272e 7469 6666 272c  '.tif', '.tiff',
-00003b40: 2027 2e6a 7067 272c 2027 2e6a 7065 6727   '.jpg', '.jpeg'
-00003b50: 2c20 272e 706e 6727 2920 2023 2041 6464  , '.png')  # Add
-00003b60: 206d 6f72 6520 6578 7465 6e73 696f 6e73   more extensions
-00003b70: 2069 6620 6e65 6564 6564 0d0a 0d0a 2020   if needed....  
-00003b80: 2020 6966 206c 696d 6974 2069 7320 6e6f    if limit is no
-00003b90: 7420 4e6f 6e65 3a0d 0a20 2020 2020 2020  t None:..       
-00003ba0: 2023 2047 6574 2061 206c 6973 7420 6f66   # Get a list of
-00003bb0: 2069 6d61 6765 2066 696c 6573 2069 6e20   image files in 
-00003bc0: 7468 6520 6469 7265 6374 6f72 790d 0a20  the directory.. 
-00003bd0: 2020 2020 2020 2069 6d61 6765 5f66 696c         image_fil
-00003be0: 6573 203d 205b 6669 6c65 2066 6f72 2066  es = [file for f
-00003bf0: 696c 6520 696e 206f 732e 6c69 7374 6469  ile in os.listdi
-00003c00: 7228 696e 7075 745f 7061 7468 2920 6966  r(input_path) if
-00003c10: 2061 6e79 2866 696c 652e 656e 6473 7769   any(file.endswi
-00003c20: 7468 2865 7874 2920 666f 7220 6578 7420  th(ext) for ext 
-00003c30: 696e 2069 6d61 6765 5f65 7874 656e 7369  in image_extensi
-00003c40: 6f6e 7329 5d5b 3a6c 696d 6974 5d0d 0a20  ons)][:limit].. 
-00003c50: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
-00003c60: 2020 696d 6167 655f 6669 6c65 7320 3d20    image_files = 
-00003c70: 5b66 696c 6520 666f 7220 6669 6c65 2069  [file for file i
-00003c80: 6e20 6f73 2e6c 6973 7464 6972 2869 6e70  n os.listdir(inp
-00003c90: 7574 5f70 6174 6829 2069 6620 616e 7928  ut_path) if any(
-00003ca0: 6669 6c65 2e65 6e64 7377 6974 6828 6578  file.endswith(ex
-00003cb0: 7429 2066 6f72 2065 7874 2069 6e20 696d  t) for ext in im
-00003cc0: 6167 655f 6578 7465 6e73 696f 6e73 295d  age_extensions)]
-00003cd0: 0d0a 0d0a 0d0a 2020 2020 2320 4372 6561  ......    # Crea
-00003ce0: 7465 2074 6865 2070 6c6f 7420 6469 7265  te the plot dire
-00003cf0: 6374 6f72 7920 6966 2069 7420 646f 6573  ctory if it does
-00003d00: 6e27 7420 6578 6973 740d 0a20 2020 2070  n't exist..    p
-00003d10: 6c6f 745f 6469 7265 6374 6f72 7920 3d20  lot_directory = 
-00003d20: 6f73 2e70 6174 682e 6a6f 696e 286f 7574  os.path.join(out
-00003d30: 7075 745f 7061 7468 2c20 2270 6c6f 7473  put_path, "plots
-00003d40: 2229 0d0a 2020 2020 6f73 2e6d 616b 6564  ")..    os.maked
-00003d50: 6972 7328 706c 6f74 5f64 6972 6563 746f  irs(plot_directo
-00003d60: 7279 2c20 6578 6973 745f 6f6b 3d54 7275  ry, exist_ok=Tru
-00003d70: 6529 0d0a 0d0a 2020 2020 2320 496e 6974  e)....    # Init
-00003d80: 6961 6c69 7a65 2070 726f 6772 6573 7320  ialize progress 
-00003d90: 6261 720d 0a20 2020 2070 726f 6772 6573  bar..    progres
-00003da0: 735f 6261 7220 3d20 7471 646d 2874 6f74  s_bar = tqdm(tot
-00003db0: 616c 3d6c 656e 2869 6d61 6765 5f66 696c  al=len(image_fil
-00003dc0: 6573 292c 2064 6573 633d 2250 726f 6365  es), desc="Proce
-00003dd0: 7373 696e 6720 696d 6167 6573 222c 2075  ssing images", u
-00003de0: 6e69 743d 2269 6d61 6765 2229 0d0a 0d0a  nit="image")....
-00003df0: 2020 2020 6966 2056 6567 6574 6174 696f      if Vegetatio
-00003e00: 6e5f 6d61 736b 2069 7320 6e6f 7420 4e6f  n_mask is not No
-00003e10: 6e65 3a0d 0a20 2020 2020 2020 2066 726f  ne:..        fro
-00003e20: 6d20 7363 6970 792e 6e64 696d 6167 6520  m scipy.ndimage 
-00003e30: 696d 706f 7274 207a 6f6f 6d0d 0a20 2020  import zoom..   
-00003e40: 2020 2020 206d 6173 6b5f 6669 6c65 3d72       mask_file=r
-00003e50: 6173 7465 7269 6f2e 6f70 656e 2856 6567  asterio.open(Veg
-00003e60: 6574 6174 696f 6e5f 6d61 736b 290d 0a20  etation_mask).. 
-00003e70: 2020 2020 2020 206d 6173 6b5f 6461 7461         mask_data
-00003e80: 3d6d 6173 6b5f 6669 6c65 2e72 6561 6428  =mask_file.read(
-00003e90: 3129 0d0a 2020 2020 2020 2020 2320 456e  1)..        # En
-00003ea0: 7375 7265 206d 6173 6b5f 6461 7461 2069  sure mask_data i
-00003eb0: 7320 626f 6f6c 6561 6e20 2830 206f 7220  s boolean (0 or 
-00003ec0: 3129 0d0a 0d0a 2020 2020 666f 7220 696d  1)....    for im
-00003ed0: 6167 655f 6669 6c65 2069 6e20 696d 6167  age_file in imag
-00003ee0: 655f 6669 6c65 733a 0d0a 2020 2020 2020  e_files:..      
-00003ef0: 2020 7472 793a 0d0a 2020 2020 2020 2020    try:..        
-00003f00: 2020 2020 2320 4f70 656e 2074 6865 2069      # Open the i
-00003f10: 6e70 7574 2072 6173 7465 720d 0a20 2020  nput raster..   
-00003f20: 2020 2020 2020 2020 2064 6174 6173 6574           dataset
-00003f30: 203d 2067 6461 6c2e 4f70 656e 286f 732e   = gdal.Open(os.
-00003f40: 7061 7468 2e6a 6f69 6e28 696e 7075 745f  path.join(input_
-00003f50: 7061 7468 2c20 696d 6167 655f 6669 6c65  path, image_file
-00003f60: 2929 0d0a 0d0a 2020 2020 2020 2020 2020  ))....          
-00003f70: 2020 6966 2064 6174 6173 6574 2069 7320    if dataset is 
-00003f80: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
-00003f90: 2020 2020 2020 2072 6169 7365 2045 7863         raise Exc
-00003fa0: 6570 7469 6f6e 2866 2246 6169 6c65 6420  eption(f"Failed 
-00003fb0: 746f 206f 7065 6e20 7261 7374 6572 3a20  to open raster: 
-00003fc0: 7b69 6d61 6765 5f66 696c 657d 2229 0d0a  {image_file}")..
-00003fd0: 0d0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-00003fe0: 5265 6164 2074 6865 2072 6173 7465 7220  Read the raster 
-00003ff0: 6461 7461 0d0a 2020 2020 2020 2020 2020  data..          
-00004000: 2020 6261 6e64 203d 2064 6174 6173 6574    band = dataset
-00004010: 2e47 6574 5261 7374 6572 4261 6e64 2831  .GetRasterBand(1
-00004020: 290d 0a20 2020 2020 2020 2020 2020 2064  )..            d
-00004030: 6174 6120 3d20 6261 6e64 2e52 6561 6441  ata = band.ReadA
-00004040: 7341 7272 6179 2829 0d0a 2020 2020 2020  sArray()..      
-00004050: 2020 2020 2020 6e6f 6461 7461 5f76 616c        nodata_val
-00004060: 7565 203d 2062 616e 642e 4765 744e 6f44  ue = band.GetNoD
-00004070: 6174 6156 616c 7565 2829 0d0a 2020 2020  ataValue()..    
-00004080: 2020 2020 2020 2020 0d0a 0d0a 2020 2020          ....    
-00004090: 2020 2020 2020 2020 6461 7461 203d 206e          data = n
-000040a0: 702e 6d61 2e6d 6173 6b65 645f 696e 7661  p.ma.masked_inva
-000040b0: 6c69 6428 6461 7461 290d 0a20 2020 2020  lid(data)..     
-000040c0: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
-000040d0: 2020 2020 2069 6620 5665 6765 7461 7469       if Vegetati
-000040e0: 6f6e 5f6d 6173 6b20 6973 206e 6f74 204e  on_mask is not N
-000040f0: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
-00004100: 2020 2020 2020 2320 4966 2074 6865 2073        # If the s
-00004110: 6861 7065 7320 646f 6e27 7420 6d61 7463  hapes don't matc
-00004120: 6820 616e 6420 6465 6d5f 6172 7261 7920  h and dem_array 
-00004130: 6973 2070 726f 7669 6465 642c 2072 6573  is provided, res
-00004140: 697a 6520 6d61 736b 5f61 7272 6179 0d0a  ize mask_array..
-00004150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004160: 6966 2064 6174 6120 6973 206e 6f74 204e  if data is not N
-00004170: 6f6e 6520 616e 6420 6461 7461 2e73 6861  one and data.sha
-00004180: 7065 2021 3d20 6d61 736b 5f64 6174 612e  pe != mask_data.
-00004190: 7368 6170 653a 0d0a 2020 2020 2020 2020  shape:..        
-000041a0: 2020 2020 2020 2020 2020 2020 795f 7363              y_sc
-000041b0: 616c 6520 3d20 6461 7461 2e73 6861 7065  ale = data.shape
-000041c0: 5b30 5d20 2f20 6d61 736b 5f64 6174 612e  [0] / mask_data.
-000041d0: 7368 6170 655b 305d 0d0a 2020 2020 2020  shape[0]..      
-000041e0: 2020 2020 2020 2020 2020 2020 2020 785f                x_
-000041f0: 7363 616c 6520 3d20 6461 7461 2e73 6861  scale = data.sha
-00004200: 7065 5b31 5d20 2f20 6d61 736b 5f64 6174  pe[1] / mask_dat
-00004210: 612e 7368 6170 655b 315d 0d0a 2020 2020  a.shape[1]..    
-00004220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004230: 6d61 736b 5f64 6174 6120 3d20 7a6f 6f6d  mask_data = zoom
-00004240: 286d 6173 6b5f 6461 7461 2c20 2879 5f73  (mask_data, (y_s
-00004250: 6361 6c65 2c20 785f 7363 616c 6529 290d  cale, x_scale)).
-00004260: 0a0d 0a20 2020 2020 2020 2020 2020 2020  ...             
-00004270: 2020 2023 2054 6872 6573 686f 6c64 206d     # Threshold m
-00004280: 6173 6b5f 6172 7261 790d 0a20 2020 2020  ask_array..     
-00004290: 2020 2020 2020 2020 2020 206d 6173 6b5f             mask_
-000042a0: 6461 7461 203d 2028 6d61 736b 5f64 6174  data = (mask_dat
-000042b0: 6120 3e3d 2030 2e35 292e 6173 7479 7065  a >= 0.5).astype
-000042c0: 286e 702e 696e 7433 3229 0d0a 2020 2020  (np.int32)..    
-000042d0: 2020 2020 2020 2020 2020 2020 6d61 736b              mask
-000042e0: 5f64 6174 6120 3d20 6d61 736b 5f64 6174  _data = mask_dat
-000042f0: 612e 6173 7479 7065 2862 6f6f 6c29 0d0a  a.astype(bool)..
-00004300: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00004310: 2020 6461 7461 203d 206e 702e 7768 6572    data = np.wher
-00004320: 6528 6d61 736b 5f64 6174 6120 3d3d 2031  e(mask_data == 1
-00004330: 2c20 6461 7461 2c20 3029 0d0a 2020 2020  , data, 0)..    
-00004340: 2020 2020 2020 2020 2020 2020 0d0a 2020              ..  
-00004350: 2020 2020 2020 2020 2020 6966 2073 6361            if sca
-00004360: 6c65 3d3d 2770 6f77 6572 273a 0d0a 2020  le=='power':..  
-00004370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004380: 2020 2320 6966 206e 702e 616e 7928 6461    # if np.any(da
-00004390: 7461 203c 202d 3129 3a0d 0a20 2020 2020  ta < -1):..     
-000043a0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-000043b0: 2020 2020 2064 6174 615f 6d69 6e20 3d20       data_min = 
-000043c0: 6461 7461 2e6d 696e 2829 0d0a 2020 2020  data.min()..    
-000043d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000043e0: 2320 2020 2020 6461 7461 5f6d 6178 203d  #     data_max =
-000043f0: 2064 6174 612e 6d61 7828 290d 0a20 2020   data.max()..   
-00004400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004410: 2023 2020 2020 2064 6174 6120 3d20 2864   #     data = (d
-00004420: 6174 6120 2d20 6461 7461 5f6d 696e 2920  ata - data_min) 
-00004430: 2f20 2864 6174 615f 6d61 7820 2d20 6461  / (data_max - da
-00004440: 7461 5f6d 696e 2920 2a20 6461 7461 5f6d  ta_min) * data_m
-00004450: 6178 0d0a 2020 2020 2020 2020 2020 2020  ax..            
-00004460: 2020 2020 2020 2020 2320 4c6f 6720 6e6f          # Log no
-00004470: 726d 616c 697a 6520 7468 6520 696d 6167  rmalize the imag
-00004480: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
-00004490: 2020 2020 2020 2064 6174 6120 3d20 6e70         data = np
-000044a0: 2e6c 6f67 3170 2864 6174 6129 2020 2320  .log1p(data)  # 
-000044b0: 4170 706c 7920 6c6f 6720 7472 616e 7366  Apply log transf
-000044c0: 6f72 6d61 7469 6f6e 2074 6f20 7468 6520  ormation to the 
-000044d0: 696d 6167 650d 0a20 2020 2020 2020 2020  image..         
-000044e0: 2020 2020 2020 2020 2020 200d 0a20 2020             ..   
-000044f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004500: 2023 2053 7465 7020 323a 2041 7070 6c79   # Step 2: Apply
-00004510: 2062 696c 6174 6572 616c 2066 696c 7465   bilateral filte
-00004520: 7220 666f 7220 6465 6e6f 6973 696e 670d  r for denoising.
-00004530: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004540: 2020 2020 2069 6620 6269 6c61 7465 7261       if bilatera
-00004550: 6c5f 7769 6e5f 7369 7a65 2069 7320 6e6f  l_win_size is no
-00004560: 7420 4e6f 6e65 3a0d 0a20 2020 2020 2020  t None:..       
-00004570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004580: 2064 656e 6f69 7365 5f62 696c 6174 6572   denoise_bilater
-00004590: 616c 203d 2063 7632 2e62 696c 6174 6572  al = cv2.bilater
-000045a0: 616c 4669 6c74 6572 2864 6174 612c 2064  alFilter(data, d
-000045b0: 3d62 696c 6174 6572 616c 5f77 696e 5f73  =bilateral_win_s
-000045c0: 697a 652c 2073 6967 6d61 436f 6c6f 723d  ize, sigmaColor=
-000045d0: 6269 6c61 7465 7261 6c5f 7369 676d 615f  bilateral_sigma_
-000045e0: 636f 6c6f 722c 2073 6967 6d61 5370 6163  color, sigmaSpac
-000045f0: 653d 6269 6c61 7465 7261 6c5f 7369 676d  e=bilateral_sigm
-00004600: 615f 7370 6174 6961 6c29 0d0a 2020 2020  a_spatial)..    
+00000000: 2323 2353 7461 7274 2323 230d 0a69 6d70  ###Start###..imp
+00000010: 6f72 7420 676c 6f62 0d0a 6672 6f6d 2069  ort glob..from i
+00000020: 7465 7274 6f6f 6c73 2069 6d70 6f72 7420  tertools import 
+00000030: 636f 756e 740d 0a69 6d70 6f72 7420 6f73  count..import os
+00000040: 0d0a 696d 706f 7274 2072 6173 7465 7269  ..import rasteri
+00000050: 6f0d 0a66 726f 6d20 7261 7374 6572 696f  o..from rasterio
+00000060: 2e70 6c6f 7420 696d 706f 7274 2073 686f  .plot import sho
+00000070: 770d 0a66 726f 6d20 736b 696d 6167 6520  w..from skimage 
+00000080: 696d 706f 7274 2065 7870 6f73 7572 650d  import exposure.
+00000090: 0a69 6d70 6f72 7420 6e75 6d70 7920 6173  .import numpy as
+000000a0: 206e 700d 0a69 6d70 6f72 7420 6376 320d   np..import cv2.
+000000b0: 0a66 726f 6d20 7261 7374 6572 696f 2e70  .from rasterio.p
+000000c0: 6c6f 7420 696d 706f 7274 2073 686f 775f  lot import show_
+000000d0: 6869 7374 0d0a 696d 706f 7274 206d 6174  hist..import mat
+000000e0: 706c 6f74 6c69 622e 7079 706c 6f74 2061  plotlib.pyplot a
+000000f0: 7320 706c 740d 0a69 6d70 6f72 7420 7365  s plt..import se
+00000100: 6162 6f72 6e5f 696d 6167 6520 6173 2073  aborn_image as s
+00000110: 6561 5f69 6d67 0d0a 696d 706f 7274 206f  ea_img..import o
+00000120: 730d 0a66 726f 6d20 6f73 6765 6f20 696d  s..from osgeo im
+00000130: 706f 7274 2067 6461 6c0d 0a69 6d70 6f72  port gdal..impor
+00000140: 7420 6e75 6d70 7920 6173 206e 700d 0a69  t numpy as np..i
+00000150: 6d70 6f72 7420 6d61 7470 6c6f 746c 6962  mport matplotlib
+00000160: 2e70 7970 6c6f 7420 6173 2070 6c74 0d0a  .pyplot as plt..
+00000170: 696d 706f 7274 206e 756d 7079 2061 7320  import numpy as 
+00000180: 6e70 0d0a 696d 706f 7274 2063 7632 0d0a  np..import cv2..
+00000190: 6672 6f6d 206f 7367 656f 2069 6d70 6f72  from osgeo impor
+000001a0: 7420 6764 616c 0d0a 696d 706f 7274 206f  t gdal..import o
+000001b0: 730d 0a66 726f 6d20 736b 696d 6167 6520  s..from skimage 
+000001c0: 696d 706f 7274 2072 6573 746f 7261 7469  import restorati
+000001d0: 6f6e 2c20 6578 706f 7375 7265 0d0a 696d  on, exposure..im
+000001e0: 706f 7274 206d 6174 706c 6f74 6c69 622e  port matplotlib.
+000001f0: 7079 706c 6f74 2061 7320 706c 740d 0a66  pyplot as plt..f
+00000200: 726f 6d20 7471 646d 2069 6d70 6f72 7420  rom tqdm import 
+00000210: 7471 646d 0d0a 6672 6f6d 2073 6b69 6d61  tqdm..from skima
+00000220: 6765 2e66 696c 7465 7273 2069 6d70 6f72  ge.filters impor
+00000230: 7420 6761 7573 7369 616e 0d0a 696d 706f  t gaussian..impo
+00000240: 7274 2072 6173 7465 7269 6f0d 0a0d 0a64  rt rasterio....d
+00000250: 6566 2046 696c 7465 725f 5072 6550 726f  ef Filter_PrePro
+00000260: 6365 7373 2875 6e66 696c 7465 7265 645f  cess(unfiltered_
+00000270: 666f 6c64 6572 5061 7468 3d72 2222 2c20  folderPath=r"", 
+00000280: 5544 4d32 5f6d 6173 6b66 6f6c 6465 7250  UDM2_maskfolderP
+00000290: 6174 683d 7222 222c 206f 7574 7061 7468  ath=r"", outpath
+000002a0: 5f64 6972 3d72 2222 202c 2055 646d 5f4d  _dir=r"" , Udm_M
+000002b0: 6173 6b5f 4f70 7469 6f6e 3d46 616c 7365  ask_Option=False
+000002c0: 2c20 706c 6f74 5f66 6967 7572 653d 4661  , plot_figure=Fa
+000002d0: 6c73 6529 3a0d 0a0d 0a0d 0a20 2020 2022  lse):......    "
+000002e0: 2222 0d0a 2020 2020 5468 6973 2070 726f  ""..    This pro
+000002f0: 6772 616d 2070 7265 7061 7265 2061 6e64  gram prepare and
+00000300: 2075 7365 7320 6669 6c74 6572 7320 746f   uses filters to
+00000310: 2062 616c 616e 6163 6520 7261 7374 6572   balanace raster
+00000320: 2069 6d61 6765 2062 7269 6768 746e 6573   image brightnes
+00000330: 730d 0a0d 0a20 2020 2050 6172 616d 6574  s....    Paramet
+00000340: 6572 730d 0a20 2020 202d 2d2d 2d2d 2d2d  ers..    -------
+00000350: 2d2d 2d0d 0a20 2020 2075 6e66 696c 7465  ---..    unfilte
+00000360: 7265 645f 666f 6c64 6572 5061 7468 3a20  red_folderPath: 
+00000370: 2073 7472 0d0a 0d0a 2020 2020 5544 4d32   str....    UDM2
+00000380: 5f6d 6173 6b66 6f6c 6465 7250 6174 683a  _maskfolderPath:
+00000390: 2020 2020 7374 720d 0a0d 0a20 2020 206f      str....    o
+000003a0: 7574 7061 7468 5f64 6972 3a20 2020 2073  utpath_dir:    s
+000003b0: 7472 0d0a 0d0a 2020 2020 5564 6d5f 4d61  tr....    Udm_Ma
+000003c0: 736b 5f4f 7074 696f 6e3a 2020 2020 626f  sk_Option:    bo
+000003d0: 6f6c 0d0a 2020 2020 2020 2020 4661 6c73  ol..        Fals
+000003e0: 6520 6966 2054 7275 6520 7468 6520 7072  e if True the pr
+000003f0: 6f67 7261 6d20 7573 6573 2070 6c61 6e65  ogram uses plane
+00000400: 746c 6162 7320 696d 6167 6572 7920 756e  tlabs imagery un
+00000410: 7573 6162 6c65 2070 6978 656c 206d 6173  usable pixel mas
+00000420: 6b20 746f 2069 676e 6f72 6520 616e 6420  k to ignore and 
+00000430: 6d61 736b 2062 6164 2069 6d61 6765 2070  mask bad image p
+00000440: 6978 656c 7320 0d0a 0d0a 2020 2020 706c  ixels ....    pl
+00000450: 6f74 5f66 6967 7572 653a 2020 2020 626f  ot_figure:    bo
+00000460: 6f6c 0d0a 2020 2020 2020 2020 5472 7565  ol..        True
+00000470: 2069 6620 796f 7520 7761 6e74 2074 6f20   if you want to 
+00000480: 6469 7370 6c61 7920 6f75 7470 7574 2066  display output f
+00000490: 6967 7572 6520 6469 7265 6374 6c79 2069  igure directly i
+000004a0: 6e73 6964 6520 7079 7468 6f6e 0d0a 2020  nside python..  
+000004b0: 2020 0d0a 2020 2020 0d0a 2020 2020 5265    ..    ..    Re
+000004c0: 7475 726e 730d 0a20 2020 202d 2d2d 2d2d  turns..    -----
+000004d0: 2d2d 0d0a 2020 2020 6765 6f74 6966 2072  --..    geotif r
+000004e0: 6173 7465 7273 0d0a 2020 2020 2020 2020  asters..        
+000004f0: 4669 6c74 6572 6564 2067 656f 7469 6620  Filtered geotif 
+00000500: 7261 7374 6572 730d 0a20 2020 2046 6967  rasters..    Fig
+00000510: 7572 6573 0d0a 2020 2020 2020 2020 706c  ures..        pl
+00000520: 6f74 7465 6420 6669 6c74 6572 6564 2072  otted filtered r
+00000530: 6173 7465 7273 2061 6e64 206d 6173 6b20  asters and mask 
+00000540: 666f 7220 6261 6420 7069 7865 6c73 0d0a  for bad pixels..
+00000550: 0d0a 2020 2020 2222 220d 0a20 2020 200d  ..    """..    .
+00000560: 0a20 2020 200d 0a20 2020 200d 0a20 2020  .    ..    ..   
+00000570: 200d 0a20 2020 206d 7970 6174 6820 3d20   ..    mypath = 
+00000580: 756e 6669 6c74 6572 6564 5f66 6f6c 6465  unfiltered_folde
+00000590: 7250 6174 680d 0a20 2020 2070 7269 6e74  rPath..    print
+000005a0: 2822 7374 7261 7420 776f 726b 696e 6720  ("strat working 
+000005b0: 6f6e 2066 6f6c 6465 7222 2c20 6d79 7061  on folder", mypa
+000005c0: 7468 290d 0a0d 0a20 2020 2023 5365 7475  th)....    #Setu
+000005d0: 7020 466f 6c64 6572 2064 6972 6563 746f  p Folder directo
+000005e0: 7269 6573 0d0a 2020 2020 0d0a 2020 2020  ries..    ..    
+000005f0: 6966 206e 6f74 206f 732e 7061 7468 2e65  if not os.path.e
+00000600: 7869 7374 7328 6f75 7470 6174 685f 6469  xists(outpath_di
+00000610: 7229 3a0d 0a20 2020 2020 2020 206f 732e  r):..        os.
+00000620: 6d61 6b65 6469 7273 286f 7574 7061 7468  makedirs(outpath
+00000630: 5f64 6972 290d 0a0d 0a20 2020 2066 6967  _dir)....    fig
+00000640: 735f 6469 723d 7222 4669 6773 5f61 6e61  s_dir=r"Figs_ana
+00000650: 6c79 7369 732f 6669 6c74 6572 5f66 6967  lysis/filter_fig
+00000660: 7322 0d0a 2020 2020 6669 675f 6d61 736b  s"..    fig_mask
+00000670: 733d 7222 4669 6773 5f61 6e61 6c79 7369  s=r"Figs_analysi
+00000680: 732f 6d61 736b 5f66 6967 7322 0d0a 0d0a  s/mask_figs"....
+00000690: 2020 2020 6966 206e 6f74 206f 732e 7061      if not os.pa
+000006a0: 7468 2e65 7869 7374 7328 6669 6773 5f64  th.exists(figs_d
+000006b0: 6972 293a 0d0a 2020 2020 2020 2020 6f73  ir):..        os
+000006c0: 2e6d 616b 6564 6972 7328 6669 6773 5f64  .makedirs(figs_d
+000006d0: 6972 290d 0a20 2020 2069 6620 6e6f 7420  ir)..    if not 
+000006e0: 6f73 2e70 6174 682e 6578 6973 7473 2866  os.path.exists(f
+000006f0: 6967 5f6d 6173 6b73 293a 0d0a 2020 2020  ig_masks):..    
+00000700: 2020 2020 6f73 2e6d 616b 6564 6972 7328      os.makedirs(
+00000710: 6669 675f 6d61 736b 7329 0d0a 0d0a 2020  fig_masks)....  
+00000720: 2020 696d 675f 6c69 7374 3d73 6f72 7465    img_list=sorte
+00000730: 6428 676c 6f62 2e67 6c6f 6228 756e 6669  d(glob.glob(unfi
+00000740: 6c74 6572 6564 5f66 6f6c 6465 7250 6174  ltered_folderPat
+00000750: 682b 2022 2f22 202b 222a 2e74 6966 2229  h+ "/" +"*.tif")
+00000760: 290d 0a20 2020 2075 646d 5f6c 6973 743d  )..    udm_list=
+00000770: 736f 7274 6564 2867 6c6f 622e 676c 6f62  sorted(glob.glob
+00000780: 2855 444d 325f 6d61 736b 666f 6c64 6572  (UDM2_maskfolder
+00000790: 5061 7468 202b 2022 2f22 202b 2022 2a2e  Path + "/" + "*.
+000007a0: 7469 6622 2929 0d0a 2020 2020 0d0a 0d0a  tif"))..    ....
+000007b0: 2020 2020 2323 2323 2323 2323 2323 2323      ############
+000007c0: 2323 230d 0a0d 0a20 2020 2066 6f72 2069  ###....    for i
+000007d0: 6478 2c20 6974 656d 2069 6e20 656e 756d  dx, item in enum
+000007e0: 6572 6174 6528 696d 675f 6c69 7374 293a  erate(img_list):
+000007f0: 0d0a 0d0a 2020 2020 2020 2020 7072 696e  ....        prin
+00000800: 7428 2220 7374 6172 7420 5072 6f63 6573  t(" start Proces
+00000810: 7369 6e67 2049 6d61 6765 204e 756d 6265  sing Image Numbe
+00000820: 723a 2022 2c20 6964 782c 2022 3a22 2c20  r: ", idx, ":", 
+00000830: 6974 656d 290d 0a20 2020 2020 2020 2023  item)..        #
+00000840: 696d 675f 6974 656d 3d69 6d67 5f6c 6973  img_item=img_lis
+00000850: 745b 6964 785d 0d0a 2020 2020 2020 2020  t[idx]..        
+00000860: 236d 736b 5f69 7465 6d3d 7564 6d5f 6c69  #msk_item=udm_li
+00000870: 7374 5b69 6478 5d0d 0a20 2020 2020 2020  st[idx]..       
+00000880: 2066 696c 6570 6174 6831 2c20 6669 6c65   filepath1, file
+00000890: 6e61 6d65 203d 206f 732e 7061 7468 2e73  name = os.path.s
+000008a0: 706c 6974 2869 6d67 5f6c 6973 745b 6964  plit(img_list[id
+000008b0: 785d 290d 0a20 2020 2020 2020 2023 6669  x])..        #fi
+000008c0: 6c65 6e61 6d65 3d66 696c 656e 616d 652e  lename=filename.
+000008d0: 7265 706c 6163 6528 222d 222c 2022 2229  replace("-", "")
+000008e0: 0d0a 2020 2020 2020 2020 2372 6762 3d72  ..        #rgb=r
+000008f0: 6762 5f6e 6f72 6d61 6c69 7a65 2869 6d67  gb_normalize(img
+00000900: 5f6c 6973 745b 6964 785d 290d 0a20 2020  _list[idx])..   
+00000910: 2020 2020 2069 6d67 5f73 7263 3d72 6173       img_src=ras
+00000920: 7465 7269 6f2e 6f70 656e 2869 6d67 5f6c  terio.open(img_l
+00000930: 6973 745b 6964 785d 290d 0a20 2020 2020  ist[idx])..     
+00000940: 2020 200d 0a20 2020 2020 2020 206d 6574     ..        met
+00000950: 613d 696d 675f 7372 632e 6d65 7461 0d0a  a=img_src.meta..
+00000960: 2020 2020 2020 2020 2320 6d65 7461 2e75          # meta.u
+00000970: 7064 6174 6528 7b27 6e6f 6461 7461 273a  pdate({'nodata':
+00000980: 307d 290d 0a20 2020 2020 2020 2023 206d  0})..        # m
+00000990: 6574 612e 7570 6461 7465 287b 2763 6f75  eta.update({'cou
+000009a0: 6e74 273a 2033 7d29 0d0a 2020 2020 2020  nt': 3})..      
+000009b0: 2020 2320 6d65 7461 2e75 7064 6174 6528    # meta.update(
+000009c0: 7b27 6474 7970 6527 3a20 6e70 2e75 696e  {'dtype': np.uin
+000009d0: 7438 7d29 0d0a 0d0a 2020 2020 2020 2020  t8})....        
+000009e0: 696d 675f 6461 7461 203d 2069 6d67 5f73  img_data = img_s
+000009f0: 7263 2e72 6561 6428 5b33 2c20 322c 2031  rc.read([3, 2, 1
+00000a00: 5d2c 206d 6173 6b65 643d 5472 7565 292f  ], masked=True)/
+00000a10: 3130 3030 300d 0a20 2020 2020 2020 2069  10000..        i
+00000a20: 6d67 5f64 6174 615f 636f 7079 3d69 6d67  mg_data_copy=img
+00000a30: 5f64 6174 612e 636f 7079 2829 0d0a 0d0a  _data.copy()....
+00000a40: 2020 2020 2020 2020 6966 2055 444d 325f          if UDM2_
+00000a50: 6d61 736b 666f 6c64 6572 5061 7468 2021  maskfolderPath !
+00000a60: 3d20 2222 3a0d 0a20 2020 2020 2020 2020  = "":..         
+00000a70: 2020 2075 646d 5f73 7263 3d72 6173 7465     udm_src=raste
+00000a80: 7269 6f2e 6f70 656e 2875 646d 5f6c 6973  rio.open(udm_lis
+00000a90: 745b 6964 785d 290d 0a0d 0a0d 0a20 2020  t[idx])......   
+00000aa0: 2020 2020 2020 2020 2063 6c65 616e 5f6d           clean_m
+00000ab0: 6173 6b20 3d20 7564 6d5f 7372 632e 7265  ask = udm_src.re
+00000ac0: 6164 2831 292e 6173 7479 7065 2862 6f6f  ad(1).astype(boo
+00000ad0: 6c29 0d0a 2020 2020 2020 2020 2020 2020  l)..            
+00000ae0: 736e 6f77 5f6d 6173 6b20 3d20 7564 6d5f  snow_mask = udm_
+00000af0: 7372 632e 7265 6164 2832 292e 6173 7479  src.read(2).asty
+00000b00: 7065 2862 6f6f 6c29 0d0a 2020 2020 2020  pe(bool)..      
+00000b10: 2020 2020 2020 7368 6164 6f77 5f6d 6173        shadow_mas
+00000b20: 6b20 3d20 7564 6d5f 7372 632e 7265 6164  k = udm_src.read
+00000b30: 2833 292e 6173 7479 7065 2862 6f6f 6c29  (3).astype(bool)
+00000b40: 0d0a 2020 2020 2020 2020 2020 2020 6c69  ..            li
+00000b50: 6768 745f 6861 7a65 5f6d 6173 6b20 3d20  ght_haze_mask = 
+00000b60: 7564 6d5f 7372 632e 7265 6164 2834 292e  udm_src.read(4).
+00000b70: 6173 7479 7065 2862 6f6f 6c29 0d0a 2020  astype(bool)..  
+00000b80: 2020 2020 2020 2020 2020 6865 6176 795f            heavy_
+00000b90: 6861 7a65 5f6d 6173 6b20 3d20 7564 6d5f  haze_mask = udm_
+00000ba0: 7372 632e 7265 6164 2835 292e 6173 7479  src.read(5).asty
+00000bb0: 7065 2862 6f6f 6c29 0d0a 2020 2020 2020  pe(bool)..      
+00000bc0: 2020 2020 2020 636c 6f75 645f 6d61 736b        cloud_mask
+00000bd0: 203d 2075 646d 5f73 7263 2e72 6561 6428   = udm_src.read(
+00000be0: 3629 2e61 7374 7970 6528 626f 6f6c 290d  6).astype(bool).
+00000bf0: 0a20 2020 2020 2020 2020 2020 2062 6164  .            bad
+00000c00: 5f6d 6173 6b3d 736e 6f77 5f6d 6173 6b2b  _mask=snow_mask+
+00000c10: 7368 6164 6f77 5f6d 6173 6b2b 636c 6f75  shadow_mask+clou
+00000c20: 645f 6d61 736b 2b6c 6967 6874 5f68 617a  d_mask+light_haz
+00000c30: 655f 6d61 736b 2b68 6561 7679 5f68 617a  e_mask+heavy_haz
+00000c40: 655f 6d61 736b 0d0a 2020 2020 2020 2020  e_mask..        
+00000c50: 2020 2020 6d69 6e69 6d75 6d5f 6d61 736b      minimum_mask
+00000c60: 3d73 6861 646f 775f 6d61 736b 2b63 6c6f  =shadow_mask+clo
+00000c70: 7564 5f6d 6173 6b2b 736e 6f77 5f6d 6173  ud_mask+snow_mas
+00000c80: 6b0d 0a20 2020 2020 2020 2020 2020 2062  k..            b
+00000c90: 6164 5f6d 6173 6b3d 7e63 6c65 616e 5f6d  ad_mask=~clean_m
+00000ca0: 6173 6b20 2b20 736e 6f77 5f6d 6173 6b0d  ask + snow_mask.
+00000cb0: 0a20 2020 2020 2020 2020 2020 2069 6d67  .            img
+00000cc0: 5f64 6174 612e 6d61 736b 203d 2062 6164  _data.mask = bad
+00000cd0: 5f6d 6173 6b20 0d0a 2020 2020 2020 2020  _mask ..        
+00000ce0: 2020 2020 696d 675f 6461 7461 203d 2069      img_data = i
+00000cf0: 6d67 5f64 6174 612e 6669 6c6c 6564 2866  mg_data.filled(f
+00000d00: 696c 6c5f 7661 6c75 653d 3029 0d0a 2020  ill_value=0)..  
+00000d10: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
+00000d20: 6465 6620 6e6f 726d 616c 697a 6528 6172  def normalize(ar
+00000d30: 7261 7929 3a0d 0a20 2020 2020 2020 2020  ray):..         
+00000d40: 2020 2061 7272 6179 5f6d 696e 2c20 6172     array_min, ar
+00000d50: 7261 795f 6d61 7820 3d20 6172 7261 792e  ray_max = array.
+00000d60: 6d69 6e28 292c 2061 7272 6179 2e6d 6178  min(), array.max
+00000d70: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
+00000d80: 2861 7272 6179 202d 2061 7272 6179 5f6d  (array - array_m
+00000d90: 696e 2920 2f20 2861 7272 6179 5f6d 6178  in) / (array_max
+00000da0: 202d 2061 7272 6179 5f6d 696e 290d 0a20   - array_min).. 
+00000db0: 2020 2020 2020 2020 2020 2061 7272 6179             array
+00000dc0: 3d65 7870 6f73 7572 652e 7265 7363 616c  =exposure.rescal
+00000dd0: 655f 696e 7465 6e73 6974 7928 6172 7261  e_intensity(arra
+00000de0: 792c 206f 7574 5f72 616e 6765 3d28 302c  y, out_range=(0,
+00000df0: 2032 3535 2929 2e61 7374 7970 6528 6e70   255)).astype(np
+00000e00: 2e75 696e 7438 290d 0a20 2020 2020 2020  .uint8)..       
+00000e10: 2020 2020 2072 6574 7572 6e20 6172 7261       return arra
+00000e20: 790d 0a20 2020 2020 2020 2064 6566 2070  y..        def p
+00000e30: 6374 5f63 6c69 7028 6172 7261 792c 7063  ct_clip(array,pc
+00000e40: 743d 5b32 2c39 385d 293a 0d0a 2020 2020  t=[2,98]):..    
+00000e50: 2020 2020 2020 2020 6172 7261 795f 6d69          array_mi
+00000e60: 6e2c 2061 7272 6179 5f6d 6178 203d 206e  n, array_max = n
+00000e70: 702e 6e61 6e70 6572 6365 6e74 696c 6528  p.nanpercentile(
+00000e80: 6172 7261 792c 7063 745b 305d 292c 206e  array,pct[0]), n
+00000e90: 702e 6e61 6e70 6572 6365 6e74 696c 6528  p.nanpercentile(
+00000ea0: 6172 7261 792c 7063 745b 315d 290d 0a20  array,pct[1]).. 
+00000eb0: 2020 2020 2020 2020 2020 2063 6c69 7020             clip 
+00000ec0: 3d20 2861 7272 6179 202d 2061 7272 6179  = (array - array
+00000ed0: 5f6d 696e 2920 2f20 2861 7272 6179 5f6d  _min) / (array_m
+00000ee0: 6178 202d 2061 7272 6179 5f6d 696e 290d  ax - array_min).
+00000ef0: 0a20 2020 2020 2020 2020 2020 2063 6c69  .            cli
+00000f00: 705b 636c 6970 3e31 5d3d 310d 0a20 2020  p[clip>1]=1..   
+00000f10: 2020 2020 2020 2020 2063 6c69 705b 636c           clip[cl
+00000f20: 6970 3c30 5d3d 300d 0a20 2020 2020 2020  ip<0]=0..       
+00000f30: 2020 2020 2072 6574 7572 6e20 636c 6970       return clip
+00000f40: 0d0a 0d0a 2020 2020 2020 2020 2320 436f  ....        # Co
+00000f50: 6e76 6572 7420 746f 206e 756d 7079 2061  nvert to numpy a
+00000f60: 7272 6179 730d 0a20 2020 2020 2020 2072  rrays..        r
+00000f70: 5f6f 203d 2069 6d67 5f73 7263 2e72 6561  _o = img_src.rea
+00000f80: 6428 3329 0d0a 2020 2020 2020 2020 625f  d(3)..        b_
+00000f90: 6f20 3d20 696d 675f 7372 632e 7265 6164  o = img_src.read
+00000fa0: 2832 290d 0a20 2020 2020 2020 2067 5f6f  (2)..        g_o
+00000fb0: 203d 2069 6d67 5f73 7263 2e72 6561 6428   = img_src.read(
+00000fc0: 3129 0d0a 0d0a 2020 2020 2020 2020 725f  1)....        r_
+00000fd0: 6f3d 6578 706f 7375 7265 2e72 6573 6361  o=exposure.resca
+00000fe0: 6c65 5f69 6e74 656e 7369 7479 2872 5f6f  le_intensity(r_o
+00000ff0: 2c20 6f75 745f 7261 6e67 653d 2830 2c20  , out_range=(0, 
+00001000: 3235 3529 292e 6173 7479 7065 286e 702e  255)).astype(np.
+00001010: 7569 6e74 3829 0d0a 0d0a 2020 2020 2020  uint8)....      
+00001020: 2020 625f 6f3d 6578 706f 7375 7265 2e72    b_o=exposure.r
+00001030: 6573 6361 6c65 5f69 6e74 656e 7369 7479  escale_intensity
+00001040: 2862 5f6f 2c20 6f75 745f 7261 6e67 653d  (b_o, out_range=
+00001050: 2830 2c20 3235 3529 292e 6173 7479 7065  (0, 255)).astype
+00001060: 286e 702e 7569 6e74 3829 0d0a 0d0a 2020  (np.uint8)....  
+00001070: 2020 2020 2020 675f 6f3d 6578 706f 7375        g_o=exposu
+00001080: 7265 2e72 6573 6361 6c65 5f69 6e74 656e  re.rescale_inten
+00001090: 7369 7479 2867 5f6f 2c20 6f75 745f 7261  sity(g_o, out_ra
+000010a0: 6e67 653d 2830 2c20 3235 3529 292e 6173  nge=(0, 255)).as
+000010b0: 7479 7065 286e 702e 7569 6e74 3829 0d0a  type(np.uint8)..
+000010c0: 0d0a 2020 2020 2020 2020 7267 625f 696d  ..        rgb_im
+000010d0: 675f 6461 7461 203d 206e 702e 6473 7461  g_data = np.dsta
+000010e0: 636b 2828 725f 6f2c 2062 5f6f 2c20 675f  ck((r_o, b_o, g_
+000010f0: 6f29 290d 0a20 2020 2020 2020 2072 6762  o))..        rgb
+00001100: 5f69 6d67 5f64 6174 613d 6e70 2e74 7261  _img_data=np.tra
+00001110: 6e73 706f 7365 2872 6762 5f69 6d67 5f64  nspose(rgb_img_d
+00001120: 6174 612c 2028 322c 302c 3129 290d 0a0d  ata, (2,0,1))...
+00001130: 0a20 2020 2020 2020 2069 6620 5544 4d32  .        if UDM2
+00001140: 5f6d 6173 6b66 6f6c 6465 7250 6174 6821  _maskfolderPath!
+00001150: 3d22 223a 0d0a 2020 2020 2020 2020 2020  ="":..          
+00001160: 2020 7220 3d20 6578 706f 7375 7265 2e65    r = exposure.e
+00001170: 7175 616c 697a 655f 6869 7374 2872 5f6f  qualize_hist(r_o
+00001180: 2c20 6d61 736b 3d63 6c65 616e 5f6d 6173  , mask=clean_mas
+00001190: 6b2b 207e 736e 6f77 5f6d 6173 6b29 0d0a  k+ ~snow_mask)..
+000011a0: 2020 2020 2020 2020 2020 2020 6220 3d20              b = 
+000011b0: 6578 706f 7375 7265 2e65 7175 616c 697a  exposure.equaliz
+000011c0: 655f 6869 7374 2862 5f6f 2c20 6d61 736b  e_hist(b_o, mask
+000011d0: 3d63 6c65 616e 5f6d 6173 6b2b 207e 736e  =clean_mask+ ~sn
+000011e0: 6f77 5f6d 6173 6b29 0d0a 2020 2020 2020  ow_mask)..      
+000011f0: 2020 2020 2020 6720 3d20 6578 706f 7375        g = exposu
+00001200: 7265 2e65 7175 616c 697a 655f 6869 7374  re.equalize_hist
+00001210: 2867 5f6f 2c20 6d61 736b 3d63 6c65 616e  (g_o, mask=clean
+00001220: 5f6d 6173 6b2b 207e 736e 6f77 5f6d 6173  _mask+ ~snow_mas
+00001230: 6b29 0d0a 2020 2020 2020 2020 656c 7365  k)..        else
+00001240: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
+00001250: 203d 2065 7870 6f73 7572 652e 6571 7561   = exposure.equa
+00001260: 6c69 7a65 5f68 6973 7428 725f 6f29 0d0a  lize_hist(r_o)..
+00001270: 2020 2020 2020 2020 2020 2020 6220 3d20              b = 
+00001280: 6578 706f 7375 7265 2e65 7175 616c 697a  exposure.equaliz
+00001290: 655f 6869 7374 2862 5f6f 290d 0a20 2020  e_hist(b_o)..   
+000012a0: 2020 2020 2020 2020 2067 203d 2065 7870           g = exp
+000012b0: 6f73 7572 652e 6571 7561 6c69 7a65 5f68  osure.equalize_h
+000012c0: 6973 7428 675f 6f29 0d0a 2020 2020 2020  ist(g_o)..      
+000012d0: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
+000012e0: 7220 3d20 6578 706f 7375 7265 2e65 7175  r = exposure.equ
+000012f0: 616c 697a 655f 6164 6170 7468 6973 7428  alize_adapthist(
+00001300: 722c 206b 6572 6e65 6c5f 7369 7a65 3d31  r, kernel_size=1
+00001310: 3238 2c20 636c 6970 5f6c 696d 6974 3d30  28, clip_limit=0
+00001320: 2e30 312c 206e 6269 6e73 3d32 3536 290d  .01, nbins=256).
+00001330: 0a20 2020 2020 2020 2062 203d 2065 7870  .        b = exp
+00001340: 6f73 7572 652e 6571 7561 6c69 7a65 5f61  osure.equalize_a
+00001350: 6461 7074 6869 7374 2862 2c20 6b65 726e  dapthist(b, kern
+00001360: 656c 5f73 697a 653d 3132 382c 2063 6c69  el_size=128, cli
+00001370: 705f 6c69 6d69 743d 302e 3031 2c20 6e62  p_limit=0.01, nb
+00001380: 696e 733d 3235 3629 0d0a 2020 2020 2020  ins=256)..      
+00001390: 2020 6720 3d20 6578 706f 7375 7265 2e65    g = exposure.e
+000013a0: 7175 616c 697a 655f 6164 6170 7468 6973  qualize_adapthis
+000013b0: 7428 672c 206b 6572 6e65 6c5f 7369 7a65  t(g, kernel_size
+000013c0: 3d31 3238 2c20 636c 6970 5f6c 696d 6974  =128, clip_limit
+000013d0: 3d30 2e30 312c 206e 6269 6e73 3d32 3536  =0.01, nbins=256
+000013e0: 290d 0a0d 0a20 2020 2020 2020 2072 3d72  )....        r=r
+000013f0: 2e61 7374 7970 6528 2266 6c6f 6174 3634  .astype("float64
+00001400: 2229 0d0a 2020 2020 2020 2020 623d 622e  ")..        b=b.
+00001410: 6173 7479 7065 2822 666c 6f61 7436 3422  astype("float64"
+00001420: 290d 0a20 2020 2020 2020 2067 3d67 2e61  )..        g=g.a
+00001430: 7374 7970 6528 2266 6c6f 6174 3634 2229  stype("float64")
+00001440: 0d0a 0d0a 2020 2020 2020 2020 725b 725f  ....        r[r_
+00001450: 6f3d 3d30 5d3d 300d 0a20 2020 2020 2020  o==0]=0..       
+00001460: 2062 5b62 5f6f 3d3d 305d 3d30 0d0a 2020   b[b_o==0]=0..  
+00001470: 2020 2020 2020 675b 675f 6f3d 3d30 5d3d        g[g_o==0]=
+00001480: 300d 0a0d 0a20 2020 2020 2020 2072 3d70  0....        r=p
+00001490: 6374 5f63 6c69 7028 7229 0d0a 2020 2020  ct_clip(r)..    
+000014a0: 2020 2020 623d 7063 745f 636c 6970 2862      b=pct_clip(b
+000014b0: 290d 0a20 2020 2020 2020 2067 3d70 6374  )..        g=pct
+000014c0: 5f63 6c69 7028 6229 0d0a 0d0a 2020 2020  _clip(b)....    
+000014d0: 2020 2020 7267 6220 3d20 6e70 2e64 7374      rgb = np.dst
+000014e0: 6163 6b28 2872 2c20 622c 2067 2929 0d0a  ack((r, b, g))..
+000014f0: 2020 2020 2020 2020 7267 623d 6e70 2e74          rgb=np.t
+00001500: 7261 6e73 706f 7365 2872 6762 2c20 2832  ranspose(rgb, (2
+00001510: 2c30 2c31 2929 0d0a 2020 2020 2020 2020  ,0,1))..        
+00001520: 2372 6762 5b72 6762 3d3d 305d 3d32 3535  #rgb[rgb==0]=255
+00001530: 0d0a 2020 2020 2020 2020 6966 2055 646d  ..        if Udm
+00001540: 5f4d 6173 6b5f 4f70 7469 6f6e 3d3d 5472  _Mask_Option==Tr
+00001550: 7565 3a0d 0a20 2020 2020 2020 2020 2020  ue:..           
+00001560: 2072 6762 5b69 6d67 5f64 6174 613d 3d30   rgb[img_data==0
+00001570: 5d3d 300d 0a20 2020 2020 2020 2020 2020  ]=0..           
+00001580: 200d 0a20 2020 2020 2020 2065 6c73 653a   ..        else:
+00001590: 0d0a 2020 2020 2020 2020 2020 2020 7267  ..            rg
+000015a0: 625b 696d 675f 6461 7461 5f63 6f70 793d  b[img_data_copy=
+000015b0: 3d30 5d3d 300d 0a20 2020 2020 2020 2020  =0]=0..         
+000015c0: 2020 200d 0a0d 0a0d 0a20 2020 2020 2020     ......       
+000015d0: 2070 7269 6e74 2028 7267 622e 7368 6170   print (rgb.shap
+000015e0: 6529 0d0a 2020 2020 2020 2020 0d0a 2020  e)..        ..  
+000015f0: 2020 2020 2020 7267 623d 6578 706f 7375        rgb=exposu
+00001600: 7265 2e72 6573 6361 6c65 5f69 6e74 656e  re.rescale_inten
+00001610: 7369 7479 2872 6762 2c20 6f75 745f 7261  sity(rgb, out_ra
+00001620: 6e67 653d 2830 2c20 3235 3529 292e 6173  nge=(0, 255)).as
+00001630: 7479 7065 286e 702e 7569 6e74 3829 0d0a  type(np.uint8)..
+00001640: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
+00001650: 2020 7769 7468 2072 6173 7465 7269 6f2e    with rasterio.
+00001660: 6f70 656e 2820 6f75 7470 6174 685f 6469  open( outpath_di
+00001670: 7220 2b20 222f 2220 2b20 7374 7228 6669  r + "/" + str(fi
+00001680: 6c65 6e61 6d65 292c 2022 7722 2c20 6472  lename), "w", dr
+00001690: 6976 6572 3d27 4754 6966 6627 2c20 7769  iver='GTiff', wi
+000016a0: 6474 683d 696d 675f 7372 632e 7368 6170  dth=img_src.shap
+000016b0: 655b 315d 2c0d 0a20 2020 2020 2020 2020  e[1],..         
+000016c0: 2020 2068 6569 6768 743d 696d 675f 7372     height=img_sr
+000016d0: 632e 7368 6170 655b 305d 2c20 636f 756e  c.shape[0], coun
+000016e0: 743d 332c 2064 7479 7065 3d27 7569 6e74  t=3, dtype='uint
+000016f0: 3827 2c20 6372 733d 696d 675f 7372 632e  8', crs=img_src.
+00001700: 6372 732c 2074 7261 6e73 666f 726d 3d69  crs, transform=i
+00001710: 6d67 5f73 7263 2e74 7261 6e73 666f 726d  mg_src.transform
+00001720: 2c20 6e6f 6461 7461 3d30 2920 6173 2064  , nodata=0) as d
+00001730: 7374 3a0d 0a20 2020 2020 2020 2020 2020  st:..           
+00001740: 2064 7374 2e77 7269 7465 2872 6762 290d   dst.write(rgb).
+00001750: 0a20 2020 2020 2020 200d 0a20 2020 2020  .        ..     
+00001760: 2020 2023 2353 6574 2070 6c6f 7420 6578     ##Set plot ex
+00001770: 7465 6e74 0d0a 2020 2020 2020 2020 2320  tent..        # 
+00001780: 696d 706f 7274 2072 696f 7861 7272 6179  import rioxarray
+00001790: 2061 7320 7278 720d 0a20 2020 2020 2020   as rxr..       
+000017a0: 2023 2066 726f 6d20 7261 7374 6572 696f   # from rasterio
+000017b0: 2e70 6c6f 7420 696d 706f 7274 2070 6c6f  .plot import plo
+000017c0: 7474 696e 675f 6578 7465 6e74 0d0a 2020  tting_extent..  
+000017d0: 2020 2020 2020 2320 7273 203d 2072 7872        # rs = rxr
+000017e0: 2e6f 7065 6e5f 7261 7374 6572 696f 2875  .open_rasterio(u
+000017f0: 646d 5f6c 6973 745b 305d 2c20 6d61 736b  dm_list[0], mask
+00001800: 6564 3d54 7275 6529 0d0a 2020 2020 2020  ed=True)..      
+00001810: 2020 2372 735f 706c 6f74 7469 6e67 5f65    #rs_plotting_e
+00001820: 7874 656e 7420 3d20 706c 6f74 7469 6e67  xtent = plotting
+00001830: 5f65 7874 656e 7428 7273 5b30 5d2c 2072  _extent(rs[0], r
+00001840: 732e 7269 6f2e 7472 616e 7366 6f72 6d28  s.rio.transform(
+00001850: 2929 0d0a 2020 2020 2020 2020 6669 6731  ))..        fig1
+00001860: 2c20 2828 6178 3132 2c20 6178 3232 292c  , ((ax12, ax22),
+00001870: 2028 6178 3332 2c20 6178 3432 2920 2920   (ax32, ax42) ) 
+00001880: 3d20 706c 742e 7375 6270 6c6f 7473 2832  = plt.subplots(2
+00001890: 2c20 322c 2066 6967 7369 7a65 3d28 3330  , 2, figsize=(30
+000018a0: 2c32 3029 290d 0a20 2020 2020 2020 2073  ,20))..        s
+000018b0: 686f 7728 7267 625f 696d 675f 6461 7461  how(rgb_img_data
+000018c0: 2c20 6178 3d61 7831 3229 0d0a 2020 2020  , ax=ax12)..    
+000018d0: 2020 2020 7368 6f77 5f68 6973 7428 7267      show_hist(rg
+000018e0: 625f 696d 675f 6461 7461 2c20 6178 3d61  b_img_data, ax=a
+000018f0: 7832 322c 2062 696e 733d 3130 2c20 6c77  x22, bins=10, lw
+00001900: 3d30 2e30 2c20 0d0a 2020 2020 2020 2020  =0.0, ..        
+00001910: 7374 6163 6b65 643d 4661 6c73 652c 2061  stacked=False, a
+00001920: 6c70 6861 3d30 2e33 2c20 6869 7374 7479  lpha=0.3, histty
+00001930: 7065 3d27 7374 6570 6669 6c6c 6564 272c  pe='stepfilled',
+00001940: 2064 656e 7369 7479 3d54 7275 652c 2074   density=True, t
+00001950: 6974 6c65 3d22 496e 6974 6961 6c3a 2022  itle="Initial: "
+00001960: 2b73 7472 2866 696c 656e 616d 655b 3a31  +str(filename[:1
+00001970: 305d 2929 0d0a 2020 2020 2020 2020 6178  0]))..        ax
+00001980: 3232 2e67 6574 5f6c 6567 656e 6428 292e  22.get_legend().
+00001990: 7265 6d6f 7665 2829 0d0a 2020 2020 2020  remove()..      
+000019a0: 2020 7368 6f77 2872 6762 2c20 6178 3d61    show(rgb, ax=a
+000019b0: 7833 3220 290d 0a20 2020 2020 2020 2073  x32 )..        s
+000019c0: 686f 775f 6869 7374 2872 6762 2c20 6178  how_hist(rgb, ax
+000019d0: 3d61 7834 322c 2062 696e 733d 3130 2c20  =ax42, bins=10, 
+000019e0: 6c77 3d30 2e30 2c20 0d0a 2020 2020 2020  lw=0.0, ..      
+000019f0: 2020 7374 6163 6b65 643d 4661 6c73 652c    stacked=False,
+00001a00: 2061 6c70 6861 3d30 2e33 2c20 6869 7374   alpha=0.3, hist
+00001a10: 7479 7065 3d27 7374 6570 6669 6c6c 6564  type='stepfilled
+00001a20: 272c 2064 656e 7369 7479 3d54 7275 652c  ', density=True,
+00001a30: 2074 6974 6c65 3d22 434c 4148 453a 2022   title="CLAHE: "
+00001a40: 2b73 7472 2866 696c 656e 616d 655b 3a31  +str(filename[:1
+00001a50: 305d 2929 0d0a 2020 2020 2020 2020 6178  0]))..        ax
+00001a60: 3432 2e67 6574 5f6c 6567 656e 6428 292e  42.get_legend().
+00001a70: 7265 6d6f 7665 2829 0d0a 2020 2020 2020  remove()..      
+00001a80: 2020 626e 3d69 6d67 5f64 6174 612e 7368    bn=img_data.sh
+00001a90: 6170 650d 0a20 2020 2020 2020 2078 733d  ape..        xs=
+00001aa0: 626e 5b32 5d0d 0a20 2020 2020 2020 2079  bn[2]..        y
+00001ab0: 733d 626e 5b31 5d0d 0a20 2020 2020 2020  s=bn[1]..       
+00001ac0: 2061 7831 322e 7365 745f 786c 696d 2830   ax12.set_xlim(0
+00001ad0: 2c20 7873 290d 0a20 2020 2020 2020 2061  , xs)..        a
+00001ae0: 7831 322e 7365 745f 796c 696d 2879 732c  x12.set_ylim(ys,
+00001af0: 3029 0d0a 2020 2020 2020 2020 6178 3332  0)..        ax32
+00001b00: 2e73 6574 5f78 6c69 6d28 302c 2078 7329  .set_xlim(0, xs)
+00001b10: 0d0a 2020 2020 2020 2020 6178 3332 2e73  ..        ax32.s
+00001b20: 6574 5f79 6c69 6d28 7973 2c30 290d 0a20  et_ylim(ys,0).. 
+00001b30: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
+00001b40: 2066 6967 312e 7361 7665 6669 6728 6669   fig1.savefig(fi
+00001b50: 6773 5f64 6972 2b20 222f 2220 2b20 2073  gs_dir+ "/" +  s
+00001b60: 7472 2866 696c 656e 616d 655b 3a31 305d  tr(filename[:10]
+00001b70: 292b 2022 2e6a 7067 222c 2064 7069 3d31  )+ ".jpg", dpi=1
+00001b80: 3530 290d 0a20 2020 2020 2020 200d 0a20  50)..        .. 
+00001b90: 2020 2020 2020 2069 6620 706c 6f74 5f66         if plot_f
+00001ba0: 6967 7572 653d 3d54 7275 653a 0d0a 2020  igure==True:..  
+00001bb0: 2020 2020 2020 2020 2020 706c 742e 7368            plt.sh
+00001bc0: 6f77 2829 0d0a 2020 2020 2020 2020 656c  ow()..        el
+00001bd0: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
+00001be0: 2070 6c74 2e63 6c6f 7365 2866 6967 3129   plt.close(fig1)
+00001bf0: 2020 200d 0a0d 0a20 2020 2020 2020 2069     ....        i
+00001c00: 6620 5544 4d32 5f6d 6173 6b66 6f6c 6465  f UDM2_maskfolde
+00001c10: 7250 6174 6821 3d22 223a 0d0a 2020 2020  rPath!="":..    
+00001c20: 2020 2020 2020 2020 6669 6732 2c20 2861          fig2, (a
+00001c30: 7831 3220 2c20 6178 3232 2920 3d20 706c  x12 , ax22) = pl
+00001c40: 742e 7375 6270 6c6f 7473 2832 2c31 2c20  t.subplots(2,1, 
+00001c50: 6669 6773 697a 653d 2831 352c 3130 2929  figsize=(15,10))
+00001c60: 0d0a 2020 2020 2020 2020 2020 2020 7368  ..            sh
+00001c70: 6f77 2872 6762 2c20 6178 3d61 7831 3229  ow(rgb, ax=ax12)
+00001c80: 0d0a 2020 2020 2020 2020 2020 2020 7368  ..            sh
+00001c90: 6f77 287e 636c 6561 6e5f 6d61 736b 2c20  ow(~clean_mask, 
+00001ca0: 636d 6170 3d22 6269 6e61 7279 222c 2061  cmap="binary", a
+00001cb0: 783d 6178 3232 290d 0a20 2020 2020 2020  x=ax22)..       
+00001cc0: 2020 2020 2023 706c 742e 7368 6f77 2829       #plt.show()
+00001cd0: 0d0a 2020 2020 2020 2020 2020 2020 626e  ..            bn
+00001ce0: 3d69 6d67 5f64 6174 612e 7368 6170 650d  =img_data.shape.
+00001cf0: 0a20 2020 2020 2020 2020 2020 2078 733d  .            xs=
+00001d00: 626e 5b32 5d0d 0a20 2020 2020 2020 2020  bn[2]..         
+00001d10: 2020 2079 733d 626e 5b31 5d0d 0a20 2020     ys=bn[1]..   
+00001d20: 2020 2020 2020 2020 2061 7831 322e 7365           ax12.se
+00001d30: 745f 786c 696d 2830 2c20 7873 290d 0a20  t_xlim(0, xs).. 
+00001d40: 2020 2020 2020 2020 2020 2061 7831 322e             ax12.
+00001d50: 7365 745f 796c 696d 2879 732c 3029 0d0a  set_ylim(ys,0)..
+00001d60: 2020 2020 2020 2020 2020 2020 6178 3232              ax22
+00001d70: 2e73 6574 5f78 6c69 6d28 302c 2078 7329  .set_xlim(0, xs)
+00001d80: 0d0a 2020 2020 2020 2020 2020 2020 6178  ..            ax
+00001d90: 3232 2e73 6574 5f79 6c69 6d28 7973 2c30  22.set_ylim(ys,0
+00001da0: 290d 0a20 2020 2020 2020 2020 2020 2066  )..            f
+00001db0: 6967 322e 7361 7665 6669 6728 6669 675f  ig2.savefig(fig_
+00001dc0: 6d61 736b 7320 2b20 222f 2220 2b20 2073  masks + "/" +  s
+00001dd0: 7472 2866 696c 656e 616d 655b 3a31 305d  tr(filename[:10]
+00001de0: 292b 2022 2e6a 7067 222c 2064 7069 3d31  )+ ".jpg", dpi=1
+00001df0: 3530 290d 0a20 2020 2020 2020 200d 0a20  50)..        .. 
+00001e00: 2020 2020 2020 2020 2020 2069 6620 706c             if pl
+00001e10: 6f74 5f66 6967 7572 653d 3d54 7275 653a  ot_figure==True:
+00001e20: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00001e30: 2020 706c 742e 7368 6f77 2829 0d0a 2020    plt.show()..  
+00001e40: 2020 2020 2020 2020 2020 656c 7365 3a0d            else:.
+00001e50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00001e60: 2070 6c74 2e63 6c6f 7365 2866 6967 3229   plt.close(fig2)
+00001e70: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00001e80: 2020 0d0a 2020 2020 2020 2020 6966 2069    ..        if i
+00001e90: 6478 203d 3d20 6c65 6e28 696d 675f 6c69  dx == len(img_li
+00001ea0: 7374 293a 0d0a 2020 2020 2020 2020 2020  st):..          
+00001eb0: 2020 6272 6561 6b0d 0a20 2020 2020 2020    break..       
+00001ec0: 2070 7269 6e74 2822 7072 6f63 6573 7320   print("process 
+00001ed0: 6973 2063 6f6d 706c 6574 6564 2229 0d0a  is completed")..
+00001ee0: 2020 2020 2020 200d 0a20 2020 2070 7269         ..    pri
+00001ef0: 6e74 2822 416c 6c20 7072 6f63 6573 7320  nt("All process 
+00001f00: 6973 2063 6f6d 706c 6574 6564 2229 0d0a  is completed")..
+00001f10: 2020 2020 2020 2020 0d0a 0d0a 2020 2020          ....    
+00001f20: 2020 2020 0d0a 2020 2020 2020 2020 2320      ..        # 
+00001f30: 2373 686f 7728 6261 645f 6d61 736b 2c20  #show(bad_mask, 
+00001f40: 7469 746c 653d 2262 6164 5f6d 6173 6b3a  title="bad_mask:
+00001f50: 2022 2b73 7472 2875 646d 5f6c 6973 745b   "+str(udm_list[
+00001f60: 6964 785d 292c 2063 6d61 703d 2262 696e  idx]), cmap="bin
+00001f70: 6172 7922 290d 0a0d 0a20 2020 2020 2020  ary")....       
+00001f80: 2023 2069 6620 436f 6c6f 723d 3d54 7275   # if Color==Tru
+00001f90: 653a 0d0a 2020 2020 2020 2020 2320 2020  e:..        #   
+00001fa0: 2020 2020 2020 5247 423d 5b33 2c32 2c31        RGB=[3,2,1
+00001fb0: 5d0d 0a20 2020 2020 2020 2023 2020 2020  ]..        #    
+00001fc0: 2020 2020 2069 6d67 5f64 6174 6120 3d20       img_data = 
+00001fd0: 696d 675f 7372 632e 7265 6164 285b 5247  img_src.read([RG
+00001fe0: 425b 305d 2c20 5247 425b 315d 2c20 5247  B[0], RGB[1], RG
+00001ff0: 425b 325d 5d29 2f31 3030 3020 2023 2061  B[2]])/1000  # a
+00002000: 7070 6c79 2052 4742 206f 7264 6572 696e  pply RGB orderin
+00002010: 6720 616e 6420 7363 616c 6520 646f 776e  g and scale down
+00002020: 0d0a 2020 2020 2020 2020 2320 2020 2020  ..        #     
+00002030: 2020 2020 696d 675f 636f 7079 3d69 6d67      img_copy=img
+00002040: 5f64 6174 612e 636f 7079 2829 0d0a 2020  _data.copy()..  
+00002050: 2020 2020 2020 2320 2020 2020 2020 2020        #         
+00002060: 6d65 7461 2e75 7064 6174 6528 7b27 6472  meta.update({'dr
+00002070: 6976 6572 273a 2747 5469 6666 272c 0d0a  iver':'GTiff',..
+00002080: 2020 2020 2020 2020 2320 2020 2020 2020          #       
+00002090: 2020 2027 7769 6474 6827 3a69 6d67 5f73     'width':img_s
+000020a0: 7263 2e73 6861 7065 5b31 5d2c 0d0a 2020  rc.shape[1],..  
+000020b0: 2020 2020 2020 2320 2020 2020 2020 2020        #         
+000020c0: 2027 6865 6967 6874 273a 696d 675f 7372   'height':img_sr
+000020d0: 632e 7368 6170 655b 305d 2c0d 0a20 2020  c.shape[0],..   
+000020e0: 2020 2020 2023 2020 2020 2020 2020 2020       #          
+000020f0: 2763 6f75 6e74 273a 332c 0d0a 2020 2020  'count':3,..    
+00002100: 2020 2020 2320 2020 2020 2020 2020 2027      #          '
+00002110: 6474 7970 6527 3a27 666c 6f61 7433 3227  dtype':'float32'
+00002120: 2c0d 0a20 2020 2020 2020 2023 2020 2020  ,..        #    
+00002130: 2020 2020 2020 2763 7273 273a 696d 675f        'crs':img_
+00002140: 7372 632e 6372 732c 200d 0a20 2020 2020  src.crs, ..     
+00002150: 2020 2023 2020 2020 2020 2020 2020 2774     #          't
+00002160: 7261 6e73 666f 726d 273a 696d 675f 7372  ransform':img_sr
+00002170: 632e 7472 616e 7366 6f72 6d2c 0d0a 2020  c.transform,..  
+00002180: 2020 2020 2020 2320 2020 2020 2020 2020        #         
+00002190: 2027 6e6f 6461 7461 273a 307d 290d 0a20   'nodata':0}).. 
+000021a0: 2020 2020 2020 2023 2020 2020 2020 2020         #        
+000021b0: 2069 6620 5564 6d5f 4d61 736b 5f4f 7074   if Udm_Mask_Opt
+000021c0: 696f 6e3d 3d54 7275 653a 0d0a 2020 2020  ion==True:..    
+000021d0: 2020 2020 2320 2020 2020 2020 2020 2020      #           
+000021e0: 2020 696d 675f 6461 7461 203d 2069 6d67    img_data = img
+000021f0: 5f73 7263 2e72 6561 6428 5b52 4742 5b30  _src.read([RGB[0
+00002200: 5d2c 2052 4742 5b31 5d2c 2052 4742 5b32  ], RGB[1], RGB[2
+00002210: 5d5d 2c20 6d61 736b 6564 3d54 7275 6529  ]], masked=True)
+00002220: 2f31 3030 300d 0a20 2020 2020 2020 2023  /1000..        #
+00002230: 2020 2020 2020 2020 2020 2020 2069 6d67               img
+00002240: 5f64 6174 612e 6d61 736b 203d 2062 6164  _data.mask = bad
+00002250: 5f6d 6173 6b0d 0a20 2020 2020 2020 2023  _mask..        #
+00002260: 2020 2020 2020 2020 2020 2020 2069 6d67               img
+00002270: 5f64 6174 6120 3d20 696d 675f 6461 7461  _data = img_data
+00002280: 2e66 696c 6c65 6428 6669 6c6c 5f76 616c  .filled(fill_val
+00002290: 7565 3d30 290d 0a20 2020 2020 2020 2023  ue=0)..        #
+000022a0: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
+000022b0: 2020 2020 2020 2020 2320 2020 2020 2020          #       
+000022c0: 2020 2020 2020 696d 675f 6461 7461 3d69        img_data=i
+000022d0: 6d67 5f64 6174 610d 0a0d 0a20 2020 2020  mg_data....     
+000022e0: 2020 2023 2065 6c69 6620 436f 6c6f 723d     # elif Color=
+000022f0: 3d46 616c 7365 3a0d 0a20 2020 2020 2020  =False:..       
+00002300: 2023 2020 2020 2063 6c65 616e 5f6d 6173   #     clean_mas
+00002310: 6b20 3d20 7564 6d5f 7372 632e 7265 6164  k = udm_src.read
+00002320: 2831 292e 6173 7479 7065 2862 6f6f 6c29  (1).astype(bool)
+00002330: 0d0a 2020 2020 2020 2020 2320 2020 2020  ..        #     
+00002340: 6772 6179 3d32 0d0a 2020 2020 2020 2020  gray=2..        
+00002350: 2320 2020 2020 696d 675f 6461 7461 203d  #     img_data =
+00002360: 2069 6d67 5f73 7263 2e72 6561 6428 6772   img_src.read(gr
+00002370: 6179 2920 2023 2061 7070 6c79 2052 4742  ay)  # apply RGB
+00002380: 206f 7264 6572 696e 6720 616e 6420 7363   ordering and sc
+00002390: 616c 6520 646f 776e 0d0a 2020 2020 2020  ale down..      
+000023a0: 2020 2320 2020 2020 696d 675f 6461 7461    #     img_data
+000023b0: 3d69 6d67 5f64 6174 612e 6173 7479 7065  =img_data.astype
+000023c0: 2822 666c 6f61 7422 290d 0a20 2020 2020  ("float")..     
+000023d0: 2020 2023 2020 2020 2069 6d67 5f64 6174     #     img_dat
+000023e0: 615b 636c 6561 6e5f 6d61 736b 3d3d 4661  a[clean_mask==Fa
+000023f0: 6c73 655d 3d6e 702e 6e61 6e0d 0a20 2020  lse]=np.nan..   
+00002400: 2020 2020 2023 2020 2020 2069 6d67 5f63       #     img_c
+00002410: 6f70 793d 696d 675f 6461 7461 2e63 6f70  opy=img_data.cop
+00002420: 7928 290d 0a20 2020 2020 2020 2023 2020  y()..        #  
+00002430: 2020 206d 6574 612e 7570 6461 7465 287b     meta.update({
+00002440: 2764 7269 7665 7227 3a27 4754 6966 6627  'driver':'GTiff'
+00002450: 2c0d 0a20 2020 2020 2020 2023 2020 2020  ,..        #    
+00002460: 2020 2020 2020 2777 6964 7468 273a 696d        'width':im
+00002470: 675f 7372 632e 7368 6170 655b 315d 2c0d  g_src.shape[1],.
+00002480: 0a20 2020 2020 2020 2023 2020 2020 2020  .        #      
+00002490: 2020 2020 2768 6569 6768 7427 3a69 6d67      'height':img
+000024a0: 5f73 7263 2e73 6861 7065 5b30 5d2c 0d0a  _src.shape[0],..
+000024b0: 2020 2020 2020 2020 2320 2020 2020 2020          #       
+000024c0: 2020 2027 636f 756e 7427 3a31 2c0d 0a20     'count':1,.. 
+000024d0: 2020 2020 2020 2023 2020 2020 2020 2020         #        
+000024e0: 2020 2764 7479 7065 273a 2766 6c6f 6174    'dtype':'float
+000024f0: 3332 272c 0d0a 2020 2020 2020 2020 2320  32',..        # 
+00002500: 2020 2020 2020 2020 2027 6372 7327 3a69           'crs':i
+00002510: 6d67 5f73 7263 2e63 7273 2c20 0d0a 2020  mg_src.crs, ..  
+00002520: 2020 2020 2020 2320 2020 2020 2020 2020        #         
+00002530: 2027 7472 616e 7366 6f72 6d27 3a69 6d67   'transform':img
+00002540: 5f73 7263 2e74 7261 6e73 666f 726d 2c0d  _src.transform,.
+00002550: 0a20 2020 2020 2020 2023 2020 2020 2020  .        #      
+00002560: 2020 2020 276e 6f64 6174 6127 3a30 7d29      'nodata':0})
+00002570: 0d0a 0d0a 0d0a 2020 2020 2020 2020 2320  ......        # 
+00002580: 7072 696e 7420 2822 696d 675f 6461 7461  print ("img_data
+00002590: 2073 6861 7065 3a20 222c 2069 6d67 5f64   shape: ", img_d
+000025a0: 6174 612e 7368 6170 6529 0d0a 0d0a 2020  ata.shape)....  
+000025b0: 2020 2020 2020 2320 696d 675f 6461 7461        # img_data
+000025c0: 3d65 7870 6f73 7572 652e 7265 7363 616c  =exposure.rescal
+000025d0: 655f 696e 7465 6e73 6974 7928 696d 675f  e_intensity(img_
+000025e0: 6461 7461 2c20 6f75 745f 7261 6e67 653d  data, out_range=
+000025f0: 2830 2c20 3235 3529 292e 6173 7479 7065  (0, 255)).astype
+00002600: 286e 702e 7569 6e74 3829 0d0a 2020 2020  (np.uint8)..    
+00002610: 2020 2020 0d0a 2020 2020 2020 2020 2320      ..        # 
+00002620: 2347 6c6f 6261 6c20 4869 7374 6f67 7261  #Global Histogra
+00002630: 6d20 4571 7561 6c69 7a61 7469 6f6e 0d0a  m Equalization..
+00002640: 2020 2020 2020 2020 2320 696d 675f 6869          # img_hi
+00002650: 7374 6f5f 6571 7520 3d20 6578 706f 7375  sto_equ = exposu
+00002660: 7265 2e65 7175 616c 697a 655f 6869 7374  re.equalize_hist
+00002670: 2869 6d67 5f64 6174 612c 206d 6173 6b3d  (img_data, mask=
+00002680: 636c 6561 6e5f 6d61 736b 290d 0a0d 0a20  clean_mask).... 
+00002690: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
+000026a0: 2023 2069 6d67 5f68 6973 746f 5f65 7175   # img_histo_equ
+000026b0: 5b69 6d67 5f63 6f70 793d 3d30 5d3d 300d  [img_copy==0]=0.
+000026c0: 0a0d 0a20 2020 2020 2020 2023 2069 6d67  ...        # img
+000026d0: 5f68 6973 746f 5f65 7175 3d65 7870 6f73  _histo_equ=expos
+000026e0: 7572 652e 7265 7363 616c 655f 696e 7465  ure.rescale_inte
+000026f0: 6e73 6974 7928 696d 675f 6869 7374 6f5f  nsity(img_histo_
+00002700: 6571 752c 206f 7574 5f72 616e 6765 3d28  equ, out_range=(
+00002710: 302c 2032 3535 2929 2e61 7374 7970 6528  0, 255)).astype(
+00002720: 6e70 2e75 696e 7438 290d 0a0d 0a20 2020  np.uint8)....   
+00002730: 2020 2020 2023 2023 4170 706c 7920 434c       # #Apply CL
+00002740: 4148 4520 4669 6c74 6572 2031 2061 6e64  AHE Filter 1 and
+00002750: 2032 0d0a 2020 2020 2020 2020 2320 6669   2..        # fi
+00002760: 6c74 6572 6564 696d 6167 6520 3d20 6578  lteredimage = ex
+00002770: 706f 7375 7265 2e65 7175 616c 697a 655f  posure.equalize_
+00002780: 6164 6170 7468 6973 7428 696d 675f 6869  adapthist(img_hi
+00002790: 7374 6f5f 6571 752c 2063 6c69 705f 6c69  sto_equ, clip_li
+000027a0: 6d69 743d 302e 3031 2c20 6e62 696e 733d  mit=0.01, nbins=
+000027b0: 3235 3629 0d0a 0d0a 2020 2020 2020 2020  256)....        
+000027c0: 2320 6669 6c74 6572 6564 696d 6167 655b  # filteredimage[
+000027d0: 696d 675f 636f 7079 3d3d 305d 3d30 0d0a  img_copy==0]=0..
+000027e0: 0d0a 2020 2020 2020 2020 2320 6966 2055  ..        # if U
+000027f0: 646d 5f4d 6173 6b5f 4f70 7469 6f6e 3d3d  dm_Mask_Option==
+00002800: 5472 7565 3a0d 0a20 2020 2020 2020 2023  True:..        #
+00002810: 2020 2020 2066 696c 7465 7265 6469 6d61       filteredima
+00002820: 6765 3d66 696c 7465 7265 6469 6d61 6765  ge=filteredimage
+00002830: 2e61 7374 7970 6528 2266 6c6f 6174 2229  .astype("float")
+00002840: 0d0a 2020 2020 2020 2020 2320 2020 2020  ..        #     
+00002850: 6669 6c74 6572 6564 696d 6167 655b 636c  filteredimage[cl
+00002860: 6561 6e5f 6d61 736b 3d3d 4661 6c73 655d  ean_mask==False]
+00002870: 3d6e 702e 6e61 6e0d 0a0d 0a20 2020 2020  =np.nan....     
+00002880: 2020 2023 2066 696c 7465 7265 6469 6d61     # filteredima
+00002890: 6765 3d65 7870 6f73 7572 652e 7265 7363  ge=exposure.resc
+000028a0: 616c 655f 696e 7465 6e73 6974 7928 6669  ale_intensity(fi
+000028b0: 6c74 6572 6564 696d 6167 652c 206f 7574  lteredimage, out
+000028c0: 5f72 616e 6765 3d28 302c 2032 3535 2929  _range=(0, 255))
+000028d0: 2e61 7374 7970 6528 6e70 2e75 696e 7438  .astype(np.uint8
+000028e0: 290d 0a0d 0a20 2020 2020 2020 2023 2066  )....        # f
+000028f0: 696c 7465 7265 6469 6d61 6765 203d 2065  ilteredimage = e
+00002900: 7870 6f73 7572 652e 6571 7561 6c69 7a65  xposure.equalize
+00002910: 5f61 6461 7074 6869 7374 2866 696c 7465  _adapthist(filte
+00002920: 7265 6469 6d61 6765 2c20 636c 6970 5f6c  redimage, clip_l
+00002930: 696d 6974 3d30 2e30 312c 206e 6269 6e73  imit=0.01, nbins
+00002940: 3d32 3536 290d 0a0d 0a20 2020 2020 2020  =256)....       
+00002950: 2023 2066 696c 7465 7265 6469 6d61 6765   # filteredimage
+00002960: 5b69 6d67 5f63 6f70 793d 3d30 5d3d 300d  [img_copy==0]=0.
+00002970: 0a0d 0a20 2020 2020 2020 2023 2069 6620  ...        # if 
+00002980: 5564 6d5f 4d61 736b 5f4f 7074 696f 6e3d  Udm_Mask_Option=
+00002990: 3d54 7275 653a 0d0a 2020 2020 2020 2020  =True:..        
+000029a0: 2320 2020 2020 6669 6c74 6572 6564 696d  #     filteredim
+000029b0: 6167 653d 6669 6c74 6572 6564 696d 6167  age=filteredimag
+000029c0: 652e 6173 7479 7065 2822 666c 6f61 7422  e.astype("float"
+000029d0: 290d 0a20 2020 2020 2020 2023 2020 2020  )..        #    
+000029e0: 2066 696c 7465 7265 6469 6d61 6765 5b63   filteredimage[c
+000029f0: 6c65 616e 5f6d 6173 6b3d 3d46 616c 7365  lean_mask==False
+00002a00: 5d3d 6e70 2e6e 616e 0d0a 0d0a 2020 2020  ]=np.nan....    
+00002a10: 2020 2020 0d0a 2020 2020 2020 2020 2320      ..        # 
+00002a20: 6669 6c74 6572 6564 696d 6167 653d 6578  filteredimage=ex
+00002a30: 706f 7375 7265 2e72 6573 6361 6c65 5f69  posure.rescale_i
+00002a40: 6e74 656e 7369 7479 2866 696c 7465 7265  ntensity(filtere
+00002a50: 6469 6d61 6765 2c20 6f75 745f 7261 6e67  dimage, out_rang
+00002a60: 653d 2830 2c20 3235 3529 292e 6173 7479  e=(0, 255)).asty
+00002a70: 7065 286e 702e 7569 6e74 3829 0d0a 2020  pe(np.uint8)..  
+00002a80: 2020 2020 200d 0a20 2020 2020 2020 0d0a       ..       ..
+00002a90: 2020 2020 2020 2020 0d0a 2020 2020 0d0a          ..    ..
+00002aa0: 2020 2020 2020 2020 2320 6669 6c74 6572          # filter
+00002ab0: 6564 696d 6167 655b 696d 675f 636f 7079  edimage[img_copy
+00002ac0: 3d3d 305d 3d30 0d0a 2020 2020 2020 2020  ==0]=0..        
+00002ad0: 2320 6966 2055 646d 5f4d 6173 6b5f 4f70  # if Udm_Mask_Op
+00002ae0: 7469 6f6e 3d3d 5472 7565 3a0d 0a20 2020  tion==True:..   
+00002af0: 2020 2020 2023 2020 2020 2066 696c 7465       #     filte
+00002b00: 7265 6469 6d61 6765 3d66 696c 7465 7265  redimage=filtere
+00002b10: 6469 6d61 6765 2e61 7374 7970 6528 2266  dimage.astype("f
+00002b20: 6c6f 6174 2229 0d0a 2020 2020 2020 2020  loat")..        
+00002b30: 2320 2020 2020 6669 6c74 6572 6564 696d  #     filteredim
+00002b40: 6167 655b 636c 6561 6e5f 6d61 736b 3d3d  age[clean_mask==
+00002b50: 4661 6c73 655d 3d6e 702e 6e61 6e0d 0a0d  False]=np.nan...
+00002b60: 0a20 2020 2020 2020 2023 2023 6669 6c74  .        # #filt
+00002b70: 6572 6564 696d 6167 653d 6e70 2e74 7261  eredimage=np.tra
+00002b80: 6e73 706f 7365 2866 696c 7465 7265 6469  nspose(filteredi
+00002b90: 6d61 6765 2c20 2831 2c30 2929 0d0a 2020  mage, (1,0))..  
+00002ba0: 2020 2020 2020 2320 6669 6c74 6572 6564        # filtered
+00002bb0: 696d 6167 653d 6e70 2e74 7261 6e73 706f  image=np.transpo
+00002bc0: 7365 2866 696c 7465 7265 6469 6d61 6765  se(filteredimage
+00002bd0: 2c20 2830 2c31 2c20 3229 290d 0a20 2020  , (0,1, 2))..   
+00002be0: 2020 2020 2023 2070 7269 6e74 2028 6669       # print (fi
+00002bf0: 6c74 6572 6564 696d 6167 652e 7368 6170  lteredimage.shap
+00002c00: 6529 0d0a 2020 2020 2020 2020 2320 7769  e)..        # wi
+00002c10: 7468 2072 6173 7465 7269 6f2e 6f70 656e  th rasterio.open
+00002c20: 286f 7574 7061 7468 5f64 6972 2b20 222f  (outpath_dir+ "/
+00002c30: 2220 2b20 7374 7228 6669 6c65 6e61 6d65  " + str(filename
+00002c40: 292c 2020 2777 2b27 2c20 2a2a 6d65 7461  ),  'w+', **meta
+00002c50: 2920 6173 2064 7374 3a0d 0a20 2020 2020  ) as dst:..     
+00002c60: 2020 2023 2020 2020 2064 7374 2e77 7269     #     dst.wri
+00002c70: 7465 2866 696c 7465 7265 6469 6d61 6765  te(filteredimage
+00002c80: 290d 0a0d 0a0d 0a0d 0a23 2064 6566 2070  )........# def p
+00002c90: 6374 5f63 6c69 7028 6172 7261 792c 2070  ct_clip(array, p
+00002ca0: 6374 3d5b 322c 2039 385d 293a 0d0a 2320  ct=[2, 98]):..# 
+00002cb0: 2020 2020 2222 220d 0a23 2020 2020 2043      """..#     C
+00002cc0: 6c69 7020 616e 2061 7272 6179 2062 6173  lip an array bas
+00002cd0: 6564 206f 6e20 7065 7263 656e 7469 6c65  ed on percentile
+00002ce0: 732e 0d0a 0d0a 2320 2020 2020 4172 6773  s.....#     Args
+00002cf0: 3a0d 0a23 2020 2020 2020 2020 2061 7272  :..#         arr
+00002d00: 6179 2028 6e64 6172 7261 7929 3a20 496e  ay (ndarray): In
+00002d10: 7075 7420 6172 7261 792e 0d0a 2320 2020  put array...#   
+00002d20: 2020 2020 2020 7063 7420 286c 6973 7429        pct (list)
+00002d30: 3a20 4c69 7374 206f 6620 7065 7263 656e  : List of percen
+00002d40: 7469 6c65 7320 5b6c 6f77 6572 2c20 7570  tiles [lower, up
+00002d50: 7065 725d 2066 6f72 2063 6c69 7070 696e  per] for clippin
+00002d60: 672e 0d0a 2020 2020 0d0a 2320 2020 2020  g...    ..#     
+00002d70: 5265 7475 726e 733a 0d0a 2320 2020 2020  Returns:..#     
+00002d80: 2020 2020 6e64 6172 7261 793a 2043 6c69      ndarray: Cli
+00002d90: 7070 6564 2061 7272 6179 2e0d 0a23 2020  pped array...#  
+00002da0: 2020 2022 2222 0d0a 2320 2020 2020 6172     """..#     ar
+00002db0: 7261 795f 6d69 6e2c 2061 7272 6179 5f6d  ray_min, array_m
+00002dc0: 6178 203d 206e 702e 6e61 6e70 6572 6365  ax = np.nanperce
+00002dd0: 6e74 696c 6528 6172 7261 792c 2070 6374  ntile(array, pct
+00002de0: 5b30 5d29 2c20 6e70 2e6e 616e 7065 7263  [0]), np.nanperc
+00002df0: 656e 7469 6c65 2861 7272 6179 2c20 7063  entile(array, pc
+00002e00: 745b 315d 290d 0a23 2020 2020 2063 6c69  t[1])..#     cli
+00002e10: 7020 3d20 2861 7272 6179 202d 2061 7272  p = (array - arr
+00002e20: 6179 5f6d 696e 2920 2f20 2861 7272 6179  ay_min) / (array
+00002e30: 5f6d 6178 202d 2061 7272 6179 5f6d 696e  _max - array_min
+00002e40: 290d 0a23 2020 2020 2063 6c69 705b 636c  )..#     clip[cl
+00002e50: 6970 203e 2031 5d20 3d20 310d 0a23 2020  ip > 1] = 1..#  
+00002e60: 2020 2063 6c69 705b 636c 6970 203c 2030     clip[clip < 0
+00002e70: 5d20 3d20 300d 0a23 2020 2020 2072 6574  ] = 0..#     ret
+00002e80: 7572 6e20 636c 6970 0d0a 0d0a 0d0a 0d0a  urn clip........
+00002e90: 6465 6620 5261 7374 6572 5f43 6f72 7265  def Raster_Corre
+00002ea0: 6374 696f 6e28 696e 7075 745f 7061 7468  ction(input_path
+00002eb0: 2c20 6f75 7470 7574 5f70 6174 682c 206c  , output_path, l
+00002ec0: 696d 6974 3d4e 6f6e 652c 206c 6f77 7061  imit=None, lowpa
+00002ed0: 7373 5f6b 6572 6e65 6c5f 7369 7a65 3d35  ss_kernel_size=5
+00002ee0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00002ef0: 2020 2020 2020 2020 2062 696c 6174 6572           bilater
+00002f00: 616c 5f77 696e 5f73 697a 653d 392c 2062  al_win_size=9, b
+00002f10: 696c 6174 6572 616c 5f73 6967 6d61 5f63  ilateral_sigma_c
+00002f20: 6f6c 6f72 3d37 352c 2062 696c 6174 6572  olor=75, bilater
+00002f30: 616c 5f73 6967 6d61 5f73 7061 7469 616c  al_sigma_spatial
+00002f40: 3d37 352c 0d0a 2020 2020 2020 2020 2020  =75,..          
+00002f50: 2020 2020 2020 2020 2020 2020 636c 6970              clip
+00002f60: 5f70 6572 6365 6e74 696c 6573 3d5b 322c  _percentiles=[2,
+00002f70: 2039 385d 2c20 6f70 7469 6361 6c3d 4661   98], optical=Fa
+00002f80: 6c73 652c 2073 6361 6c65 3d27 706f 7765  lse, scale='powe
+00002f90: 7227 2c20 5665 6765 7461 7469 6f6e 5f6d  r', Vegetation_m
+00002fa0: 6173 6b3d 4e6f 6e65 2c20 434c 4148 455f  ask=None, CLAHE_
+00002fb0: 6669 6c74 6572 3d46 616c 7365 293a 0d0a  filter=False):..
+00002fc0: 2020 2020 2222 220d 0a20 2020 2050 6572      """..    Per
+00002fd0: 666f 726d 7320 6120 7365 7269 6573 206f  forms a series o
+00002fe0: 6620 696d 6167 6520 636f 7272 6563 7469  f image correcti
+00002ff0: 6f6e 2061 6e64 2065 6e68 616e 6365 6d65  on and enhanceme
+00003000: 6e74 206f 7065 7261 7469 6f6e 7320 6f6e  nt operations on
+00003010: 2072 6173 7465 7220 696d 6167 6573 2c0d   raster images,.
+00003020: 0a20 2020 2073 7065 6369 6669 6361 6c6c  .    specificall
+00003030: 7920 7461 696c 6f72 6564 2066 6f72 2053  y tailored for S
+00003040: 796e 7468 6574 6963 2041 7065 7274 7572  ynthetic Apertur
+00003050: 6520 5261 6461 7220 2853 4152 2920 6461  e Radar (SAR) da
+00003060: 7461 2c20 6275 7420 6361 6e20 6265 2075  ta, but can be u
+00003070: 7365 6420 666f 7220 6f74 6865 7220 7261  sed for other ra
+00003080: 7374 6572 7320 746f 6f2e 0d0a 0d0a 2020  sters too.....  
+00003090: 2020 5468 6973 2066 756e 6374 696f 6e20    This function 
+000030a0: 6163 6869 6576 6573 2064 656e 6f69 7369  achieves denoisi
+000030b0: 6e67 2c20 6e6f 726d 616c 697a 6174 696f  ng, normalizatio
+000030c0: 6e2c 2061 6e64 2063 6f6e 7472 6173 7420  n, and contrast 
+000030d0: 656e 6861 6e63 656d 656e 7420 666f 7220  enhancement for 
+000030e0: 7261 7374 6572 2069 6d61 6765 730d 0a20  raster images.. 
+000030f0: 2020 2062 6173 6564 206f 6e20 7573 6572     based on user
+00003100: 2d73 7065 6369 6669 6564 2070 6172 616d  -specified param
+00003110: 6574 6572 732e 2054 6865 2066 756e 6374  eters. The funct
+00003120: 696f 6e20 6973 2064 6573 6967 6e65 6420  ion is designed 
+00003130: 746f 2077 6f72 6b20 6566 6665 6374 6976  to work effectiv
+00003140: 656c 7920 7769 7468 2062 6f74 6820 0d0a  ely with both ..
+00003150: 2020 2020 6f70 7469 6361 6c20 616e 6420      optical and 
+00003160: 5341 5220 696d 6167 6572 792e 0d0a 0d0a  SAR imagery.....
+00003170: 2020 2020 4172 6773 3a0d 0a20 2020 2020      Args:..     
+00003180: 2020 2069 6e70 7574 5f70 6174 6820 2873     input_path (s
+00003190: 7472 293a 2050 6174 6820 746f 2074 6865  tr): Path to the
+000031a0: 2064 6972 6563 746f 7279 2063 6f6e 7461   directory conta
+000031b0: 696e 696e 6720 696e 7075 7420 7261 7374  ining input rast
+000031c0: 6572 2069 6d61 6765 732e 0d0a 2020 2020  er images...    
+000031d0: 2020 2020 0d0a 2020 2020 2020 2020 6f75      ..        ou
+000031e0: 7470 7574 5f70 6174 6820 2873 7472 293a  tput_path (str):
+000031f0: 2044 6972 6563 746f 7279 2077 6865 7265   Directory where
+00003200: 2063 6f72 7265 6374 6564 2069 6d61 6765   corrected image
+00003210: 7320 616e 6420 706c 6f74 7320 7769 6c6c  s and plots will
+00003220: 2062 6520 7361 7665 642e 0d0a 2020 2020   be saved...    
+00003230: 2020 2020 0d0a 2020 2020 2020 2020 6c69      ..        li
+00003240: 6d69 7420 2869 6e74 2c20 6f70 7469 6f6e  mit (int, option
+00003250: 616c 293a 204d 6178 696d 756d 206e 756d  al): Maximum num
+00003260: 6265 7220 6f66 2069 6d61 6765 7320 746f  ber of images to
+00003270: 2070 726f 6365 7373 2e20 4966 204e 6f6e   process. If Non
+00003280: 652c 2061 6c6c 2069 6d61 6765 7320 6172  e, all images ar
+00003290: 6520 7072 6f63 6573 7365 642e 0d0a 2020  e processed...  
+000032a0: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
+000032b0: 6c6f 7770 6173 735f 6b65 726e 656c 5f73  lowpass_kernel_s
+000032c0: 697a 6520 2869 6e74 2c20 6f70 7469 6f6e  ize (int, option
+000032d0: 616c 293a 2053 697a 6520 6f66 2074 6865  al): Size of the
+000032e0: 2047 6175 7373 6961 6e20 6c6f 772d 7061   Gaussian low-pa
+000032f0: 7373 2066 696c 7465 7220 6b65 726e 656c  ss filter kernel
+00003300: 2e0d 0a20 2020 2020 2020 200d 0a20 2020  ...        ..   
+00003310: 2020 2020 2062 696c 6174 6572 616c 5f77       bilateral_w
+00003320: 696e 5f73 697a 6520 2869 6e74 293a 2053  in_size (int): S
+00003330: 697a 6520 6f66 2074 6865 2062 696c 6174  ize of the bilat
+00003340: 6572 616c 2066 696c 7465 7220 7769 6e64  eral filter wind
+00003350: 6f77 2e0d 0a20 2020 2020 2020 200d 0a20  ow...        .. 
+00003360: 2020 2020 2020 2062 696c 6174 6572 616c         bilateral
+00003370: 5f73 6967 6d61 5f63 6f6c 6f72 2028 696e  _sigma_color (in
+00003380: 7429 3a20 5374 616e 6461 7264 2064 6576  t): Standard dev
+00003390: 6961 7469 6f6e 2066 6f72 2063 6f6c 6f72  iation for color
+000033a0: 2073 7061 6365 2069 6e20 6269 6c61 7465   space in bilate
+000033b0: 7261 6c20 6669 6c74 6572 2e0d 0a20 2020  ral filter...   
+000033c0: 2020 2020 200d 0a20 2020 2020 2020 2062       ..        b
+000033d0: 696c 6174 6572 616c 5f73 6967 6d61 5f73  ilateral_sigma_s
+000033e0: 7061 7469 616c 2028 696e 7429 3a20 5374  patial (int): St
+000033f0: 616e 6461 7264 2064 6576 6961 7469 6f6e  andard deviation
+00003400: 2066 6f72 2073 7061 7469 616c 2073 7061   for spatial spa
+00003410: 6365 2069 6e20 6269 6c61 7465 7261 6c20  ce in bilateral 
+00003420: 6669 6c74 6572 2e0d 0a20 2020 2020 2020  filter...       
+00003430: 200d 0a20 2020 2020 2020 2063 6c69 705f   ..        clip_
+00003440: 7065 7263 656e 7469 6c65 7320 286c 6973  percentiles (lis
+00003450: 7429 3a20 322d 656c 656d 656e 7420 6c69  t): 2-element li
+00003460: 7374 2063 6f6e 7461 696e 696e 6720 6c6f  st containing lo
+00003470: 7765 7220 616e 6420 7570 7065 7220 7065  wer and upper pe
+00003480: 7263 656e 7469 6c65 7320 666f 7220 636c  rcentiles for cl
+00003490: 6970 7069 6e67 2070 6978 656c 2076 616c  ipping pixel val
+000034a0: 7565 732e 0d0a 2020 2020 2020 2020 0d0a  ues...        ..
+000034b0: 2020 2020 2020 2020 6f70 7469 6361 6c20          optical 
+000034c0: 2862 6f6f 6c29 3a20 496e 6469 6361 7465  (bool): Indicate
+000034d0: 7320 6966 2074 6865 2072 6173 7465 7220  s if the raster 
+000034e0: 6973 206f 7074 6963 616c 2069 6d61 6765  is optical image
+000034f0: 7279 2e20 4163 7469 7661 7465 7320 6365  ry. Activates ce
+00003500: 7274 6169 6e20 636f 7272 6563 7469 6f6e  rtain correction
+00003510: 7320 7370 6563 6966 6963 2074 6f20 6f70  s specific to op
+00003520: 7469 6361 6c20 6461 7461 2e0d 0a20 2020  tical data...   
+00003530: 2020 2020 200d 0a20 2020 2020 2020 2073       ..        s
+00003540: 6361 6c65 2028 7374 7229 3a20 4d6f 6465  cale (str): Mode
+00003550: 206f 6620 7363 616c 696e 6720 2827 706f   of scaling ('po
+00003560: 7765 7227 2066 6f72 206c 6f67 6172 6974  wer' for logarit
+00003570: 686d 6963 206e 6f72 6d61 6c69 7a61 7469  hmic normalizati
+00003580: 6f6e 2061 6e64 2027 616d 706c 6974 7564  on and 'amplitud
+00003590: 6527 2066 6f72 206c 696e 6561 7229 2e0d  e' for linear)..
+000035a0: 0a20 2020 2020 2020 200d 0a20 2020 2020  .        ..     
+000035b0: 2020 2056 6567 6574 6174 696f 6e5f 6d61     Vegetation_ma
+000035c0: 736b 2028 7374 722c 206f 7074 696f 6e61  sk (str, optiona
+000035d0: 6c29 3a20 5061 7468 2074 6f20 6120 7261  l): Path to a ra
+000035e0: 7374 6572 2066 696c 6520 7468 6174 2072  ster file that r
+000035f0: 6570 7265 7365 6e74 7320 6120 7665 6765  epresents a vege
+00003600: 7461 7469 6f6e 206d 6173 6b2e 2050 6978  tation mask. Pix
+00003610: 656c 7320 696e 2074 6865 2069 6e70 7574  els in the input
+00003620: 2069 6d61 6765 2074 6861 7420 636f 7272   image that corr
+00003630: 6573 706f 6e64 2074 6f20 6e6f 6e2d 7665  espond to non-ve
+00003640: 6765 7461 7469 6f6e 2069 6e20 7468 6520  getation in the 
+00003650: 6d61 736b 2077 696c 6c20 6265 2073 6574  mask will be set
+00003660: 2074 6f20 6f6e 652e 0d0a 0d0a 2020 2020   to one.....    
+00003670: 5265 7475 726e 733a 0d0a 2020 2020 2020  Returns:..      
+00003680: 2020 4e6f 6e65 2e20 4f75 7470 7574 7320    None. Outputs 
+00003690: 6172 6520 7361 7665 6420 746f 2074 6865  are saved to the
+000036a0: 2073 7065 6369 6669 6564 2064 6972 6563   specified direc
+000036b0: 746f 7279 2e0d 0a0d 0a20 2020 204f 7574  tory.....    Out
+000036c0: 7075 7473 3a0d 0a20 2020 2020 2020 202d  puts:..        -
+000036d0: 2043 6f72 7265 6374 6564 2072 6173 7465   Corrected raste
+000036e0: 7220 696d 6167 6573 2073 6176 6564 2069  r images saved i
+000036f0: 6e20 4765 6f54 4946 4620 666f 726d 6174  n GeoTIFF format
+00003700: 2e0d 0a20 2020 2020 2020 202d 2050 6c6f  ...        - Plo
+00003710: 7473 2063 6f6d 7061 7269 6e67 206f 7269  ts comparing ori
+00003720: 6769 6e61 6c2c 2066 696c 7465 7265 642c  ginal, filtered,
+00003730: 2061 6e64 2063 6f72 7265 6374 6564 2069   and corrected i
+00003740: 6d61 6765 7320 616c 6f6e 6720 7769 7468  mages along with
+00003750: 2074 6865 6972 2068 6973 746f 6772 616d   their histogram
+00003760: 732e 0d0a 0d0a 2020 2020 5573 6167 653a  s.....    Usage:
+00003770: 0d0a 2020 2020 2020 2020 5375 6974 6162  ..        Suitab
+00003780: 6c65 2066 6f72 2062 6f74 6820 5341 5220  le for both SAR 
+00003790: 616e 6420 6f70 7469 6361 6c20 696d 6167  and optical imag
+000037a0: 6572 7920 636f 7272 6563 7469 6f6e 2e20  ery correction. 
+000037b0: 4164 6a75 7374 2066 696c 7465 7220 7061  Adjust filter pa
+000037c0: 7261 6d65 7465 7273 2061 7320 7065 7220  rameters as per 
+000037d0: 7468 6520 6e61 7475 7265 206f 6620 696e  the nature of in
+000037e0: 7075 7420 7261 7374 6572 0d0a 2020 2020  put raster..    
+000037f0: 2020 2020 616e 6420 6465 7369 7265 6420      and desired 
+00003800: 6f75 7470 7574 2e0d 0a0d 0a20 2020 204e  output.....    N
+00003810: 6f74 6573 3a0d 0a20 2020 2020 2020 202d  otes:..        -
+00003820: 2045 6e73 7572 6520 7468 6174 2074 6865   Ensure that the
+00003830: 2047 4441 4c20 616e 6420 6f74 6865 7220   GDAL and other 
+00003840: 6e65 6365 7373 6172 7920 6c69 6272 6172  necessary librar
+00003850: 6965 7320 6172 6520 636f 7272 6563 746c  ies are correctl
+00003860: 7920 696e 7374 616c 6c65 642e 0d0a 2020  y installed...  
+00003870: 2020 2020 2020 2d20 5468 6520 6675 6e63        - The func
+00003880: 7469 6f6e 2075 7365 7320 7471 646d 2074  tion uses tqdm t
+00003890: 6f20 7072 6f76 6964 6520 6120 7072 6f67  o provide a prog
+000038a0: 7265 7373 2062 6172 2c20 736f 2065 6e73  ress bar, so ens
+000038b0: 7572 6520 6974 2773 2069 6e73 7461 6c6c  ure it's install
+000038c0: 6564 2069 6620 796f 7520 7761 6e74 2074  ed if you want t
+000038d0: 6865 2070 726f 6772 6573 7320 7669 7375  he progress visu
+000038e0: 616c 697a 6174 696f 6e2e 0d0a 2020 2020  alization...    
+000038f0: 2020 2020 2d20 5468 6520 6675 6e63 7469      - The functi
+00003900: 6f6e 2068 6173 2062 6565 6e20 6f70 7469  on has been opti
+00003910: 6d69 7a65 6420 666f 7220 6120 6261 6c61  mized for a bala
+00003920: 6e63 6520 6265 7477 6565 6e20 7065 7266  nce between perf
+00003930: 6f72 6d61 6e63 6520 616e 6420 7175 616c  ormance and qual
+00003940: 6974 792c 2062 7574 2070 726f 6365 7373  ity, but process
+00003950: 696e 6720 6c61 7267 6520 7261 7374 6572  ing large raster
+00003960: 2064 6174 6173 6574 730d 0a20 2020 2020   datasets..     
+00003970: 2020 2020 206d 6967 6874 2073 7469 6c6c       might still
+00003980: 2062 6520 636f 6d70 7574 6174 696f 6e61   be computationa
+00003990: 6c6c 7920 696e 7465 6e73 6976 652e 0d0a  lly intensive...
+000039a0: 2020 2020 2222 220d 0a20 2020 2064 6566      """..    def
+000039b0: 2070 6374 5f63 6c69 7028 6172 7261 792c   pct_clip(array,
+000039c0: 2070 6374 3d63 6c69 705f 7065 7263 656e   pct=clip_percen
+000039d0: 7469 6c65 7329 3a0d 0a20 2020 2020 2020  tiles):..       
+000039e0: 2061 7272 6179 203d 2061 7272 6179 2e63   array = array.c
+000039f0: 6f70 7928 2920 2023 2043 7265 6174 6520  opy()  # Create 
+00003a00: 6120 7772 6974 6162 6c65 2063 6f70 790d  a writable copy.
+00003a10: 0a20 2020 2020 2020 2061 7272 6179 5f6d  .        array_m
+00003a20: 696e 2c20 6172 7261 795f 6d61 7820 3d20  in, array_max = 
+00003a30: 6e70 2e6e 616e 7065 7263 656e 7469 6c65  np.nanpercentile
+00003a40: 2861 7272 6179 2c20 7063 745b 305d 292c  (array, pct[0]),
+00003a50: 206e 702e 6e61 6e70 6572 6365 6e74 696c   np.nanpercentil
+00003a60: 6528 6172 7261 792c 2070 6374 5b31 5d29  e(array, pct[1])
+00003a70: 0d0a 2020 2020 2020 2020 636c 6970 203d  ..        clip =
+00003a80: 2028 6172 7261 7920 2d20 6172 7261 795f   (array - array_
+00003a90: 6d69 6e29 202f 2028 6172 7261 795f 6d61  min) / (array_ma
+00003aa0: 7820 2d20 6172 7261 795f 6d69 6e29 0d0a  x - array_min)..
+00003ab0: 2020 2020 2020 2020 636c 6970 5b63 6c69          clip[cli
+00003ac0: 7020 3e20 315d 203d 2031 0d0a 2020 2020  p > 1] = 1..    
+00003ad0: 2020 2020 636c 6970 5b63 6c69 7020 3c20      clip[clip < 
+00003ae0: 305d 203d 2030 0d0a 2020 2020 2020 2020  0] = 0..        
+00003af0: 7265 7475 726e 2063 6c69 700d 0a0d 0a20  return clip.... 
+00003b00: 2020 2069 6d61 6765 5f65 7874 656e 7369     image_extensi
+00003b10: 6f6e 7320 3d20 2827 2e74 6966 272c 2027  ons = ('.tif', '
+00003b20: 2e74 6966 6627 2c20 272e 6a70 6727 2c20  .tiff', '.jpg', 
+00003b30: 272e 6a70 6567 272c 2027 2e70 6e67 2729  '.jpeg', '.png')
+00003b40: 2020 2320 4164 6420 6d6f 7265 2065 7874    # Add more ext
+00003b50: 656e 7369 6f6e 7320 6966 206e 6565 6465  ensions if neede
+00003b60: 640d 0a0d 0a20 2020 2069 6620 6c69 6d69  d....    if limi
+00003b70: 7420 6973 206e 6f74 204e 6f6e 653a 0d0a  t is not None:..
+00003b80: 2020 2020 2020 2020 2320 4765 7420 6120          # Get a 
+00003b90: 6c69 7374 206f 6620 696d 6167 6520 6669  list of image fi
+00003ba0: 6c65 7320 696e 2074 6865 2064 6972 6563  les in the direc
+00003bb0: 746f 7279 0d0a 2020 2020 2020 2020 696d  tory..        im
+00003bc0: 6167 655f 6669 6c65 7320 3d20 5b66 696c  age_files = [fil
+00003bd0: 6520 666f 7220 6669 6c65 2069 6e20 6f73  e for file in os
+00003be0: 2e6c 6973 7464 6972 2869 6e70 7574 5f70  .listdir(input_p
+00003bf0: 6174 6829 2069 6620 616e 7928 6669 6c65  ath) if any(file
+00003c00: 2e65 6e64 7377 6974 6828 6578 7429 2066  .endswith(ext) f
+00003c10: 6f72 2065 7874 2069 6e20 696d 6167 655f  or ext in image_
+00003c20: 6578 7465 6e73 696f 6e73 295d 5b3a 6c69  extensions)][:li
+00003c30: 6d69 745d 0d0a 2020 2020 656c 7365 3a0d  mit]..    else:.
+00003c40: 0a20 2020 2020 2020 2069 6d61 6765 5f66  .        image_f
+00003c50: 696c 6573 203d 205b 6669 6c65 2066 6f72  iles = [file for
+00003c60: 2066 696c 6520 696e 206f 732e 6c69 7374   file in os.list
+00003c70: 6469 7228 696e 7075 745f 7061 7468 2920  dir(input_path) 
+00003c80: 6966 2061 6e79 2866 696c 652e 656e 6473  if any(file.ends
+00003c90: 7769 7468 2865 7874 2920 666f 7220 6578  with(ext) for ex
+00003ca0: 7420 696e 2069 6d61 6765 5f65 7874 656e  t in image_exten
+00003cb0: 7369 6f6e 7329 5d0d 0a0d 0a0d 0a20 2020  sions)]......   
+00003cc0: 2023 2043 7265 6174 6520 7468 6520 706c   # Create the pl
+00003cd0: 6f74 2064 6972 6563 746f 7279 2069 6620  ot directory if 
+00003ce0: 6974 2064 6f65 736e 2774 2065 7869 7374  it doesn't exist
+00003cf0: 0d0a 2020 2020 706c 6f74 5f64 6972 6563  ..    plot_direc
+00003d00: 746f 7279 203d 206f 732e 7061 7468 2e6a  tory = os.path.j
+00003d10: 6f69 6e28 6f75 7470 7574 5f70 6174 682c  oin(output_path,
+00003d20: 2022 706c 6f74 7322 290d 0a20 2020 206f   "plots")..    o
+00003d30: 732e 6d61 6b65 6469 7273 2870 6c6f 745f  s.makedirs(plot_
+00003d40: 6469 7265 6374 6f72 792c 2065 7869 7374  directory, exist
+00003d50: 5f6f 6b3d 5472 7565 290d 0a0d 0a20 2020  _ok=True)....   
+00003d60: 2023 2049 6e69 7469 616c 697a 6520 7072   # Initialize pr
+00003d70: 6f67 7265 7373 2062 6172 0d0a 2020 2020  ogress bar..    
+00003d80: 7072 6f67 7265 7373 5f62 6172 203d 2074  progress_bar = t
+00003d90: 7164 6d28 746f 7461 6c3d 6c65 6e28 696d  qdm(total=len(im
+00003da0: 6167 655f 6669 6c65 7329 2c20 6465 7363  age_files), desc
+00003db0: 3d22 5072 6f63 6573 7369 6e67 2069 6d61  ="Processing ima
+00003dc0: 6765 7322 2c20 756e 6974 3d22 696d 6167  ges", unit="imag
+00003dd0: 6522 290d 0a0d 0a20 2020 2069 6620 5665  e")....    if Ve
+00003de0: 6765 7461 7469 6f6e 5f6d 6173 6b20 6973  getation_mask is
+00003df0: 206e 6f74 204e 6f6e 653a 0d0a 2020 2020   not None:..    
+00003e00: 2020 2020 6672 6f6d 2073 6369 7079 2e6e      from scipy.n
+00003e10: 6469 6d61 6765 2069 6d70 6f72 7420 7a6f  dimage import zo
+00003e20: 6f6d 0d0a 2020 2020 2020 2020 6d61 736b  om..        mask
+00003e30: 5f66 696c 653d 7261 7374 6572 696f 2e6f  _file=rasterio.o
+00003e40: 7065 6e28 5665 6765 7461 7469 6f6e 5f6d  pen(Vegetation_m
+00003e50: 6173 6b29 0d0a 2020 2020 2020 2020 6d61  ask)..        ma
+00003e60: 736b 5f64 6174 613d 6d61 736b 5f66 696c  sk_data=mask_fil
+00003e70: 652e 7265 6164 2831 290d 0a20 2020 2020  e.read(1)..     
+00003e80: 2020 2023 2045 6e73 7572 6520 6d61 736b     # Ensure mask
+00003e90: 5f64 6174 6120 6973 2062 6f6f 6c65 616e  _data is boolean
+00003ea0: 2028 3020 6f72 2031 290d 0a0d 0a20 2020   (0 or 1)....   
+00003eb0: 2066 6f72 2069 6d61 6765 5f66 696c 6520   for image_file 
+00003ec0: 696e 2069 6d61 6765 5f66 696c 6573 3a0d  in image_files:.
+00003ed0: 0a20 2020 2020 2020 2074 7279 3a0d 0a20  .        try:.. 
+00003ee0: 2020 2020 2020 2020 2020 2023 204f 7065             # Ope
+00003ef0: 6e20 7468 6520 696e 7075 7420 7261 7374  n the input rast
+00003f00: 6572 0d0a 2020 2020 2020 2020 2020 2020  er..            
+00003f10: 6461 7461 7365 7420 3d20 6764 616c 2e4f  dataset = gdal.O
+00003f20: 7065 6e28 6f73 2e70 6174 682e 6a6f 696e  pen(os.path.join
+00003f30: 2869 6e70 7574 5f70 6174 682c 2069 6d61  (input_path, ima
+00003f40: 6765 5f66 696c 6529 290d 0a0d 0a20 2020  ge_file))....   
+00003f50: 2020 2020 2020 2020 2069 6620 6461 7461           if data
+00003f60: 7365 7420 6973 204e 6f6e 653a 0d0a 2020  set is None:..  
+00003f70: 2020 2020 2020 2020 2020 2020 2020 7261                ra
+00003f80: 6973 6520 4578 6365 7074 696f 6e28 6622  ise Exception(f"
+00003f90: 4661 696c 6564 2074 6f20 6f70 656e 2072  Failed to open r
+00003fa0: 6173 7465 723a 207b 696d 6167 655f 6669  aster: {image_fi
+00003fb0: 6c65 7d22 290d 0a0d 0a20 2020 2020 2020  le}")....       
+00003fc0: 2020 2020 2023 2052 6561 6420 7468 6520       # Read the 
+00003fd0: 7261 7374 6572 2064 6174 610d 0a20 2020  raster data..   
+00003fe0: 2020 2020 2020 2020 2062 616e 6420 3d20           band = 
+00003ff0: 6461 7461 7365 742e 4765 7452 6173 7465  dataset.GetRaste
+00004000: 7242 616e 6428 3129 0d0a 2020 2020 2020  rBand(1)..      
+00004010: 2020 2020 2020 6461 7461 203d 2062 616e        data = ban
+00004020: 642e 5265 6164 4173 4172 7261 7928 290d  d.ReadAsArray().
+00004030: 0a20 2020 2020 2020 2020 2020 206e 6f64  .            nod
+00004040: 6174 615f 7661 6c75 6520 3d20 6261 6e64  ata_value = band
+00004050: 2e47 6574 4e6f 4461 7461 5661 6c75 6528  .GetNoDataValue(
+00004060: 290d 0a20 2020 2020 2020 2020 2020 200d  )..            .
+00004070: 0a0d 0a20 2020 2020 2020 2020 2020 2064  ...            d
+00004080: 6174 6120 3d20 6e70 2e6d 612e 6d61 736b  ata = np.ma.mask
+00004090: 6564 5f69 6e76 616c 6964 2864 6174 6129  ed_invalid(data)
+000040a0: 0d0a 2020 2020 2020 2020 2020 2020 0d0a  ..            ..
+000040b0: 2020 2020 2020 2020 2020 2020 6966 2056              if V
+000040c0: 6567 6574 6174 696f 6e5f 6d61 736b 2069  egetation_mask i
+000040d0: 7320 6e6f 7420 4e6f 6e65 3a0d 0a20 2020  s not None:..   
+000040e0: 2020 2020 2020 2020 2020 2020 2023 2049               # I
+000040f0: 6620 7468 6520 7368 6170 6573 2064 6f6e  f the shapes don
+00004100: 2774 206d 6174 6368 2061 6e64 2064 656d  't match and dem
+00004110: 5f61 7272 6179 2069 7320 7072 6f76 6964  _array is provid
+00004120: 6564 2c20 7265 7369 7a65 206d 6173 6b5f  ed, resize mask_
+00004130: 6172 7261 790d 0a20 2020 2020 2020 2020  array..         
+00004140: 2020 2020 2020 2069 6620 6461 7461 2069         if data i
+00004150: 7320 6e6f 7420 4e6f 6e65 2061 6e64 2064  s not None and d
+00004160: 6174 612e 7368 6170 6520 213d 206d 6173  ata.shape != mas
+00004170: 6b5f 6461 7461 2e73 6861 7065 3a0d 0a20  k_data.shape:.. 
+00004180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004190: 2020 2079 5f73 6361 6c65 203d 2064 6174     y_scale = dat
+000041a0: 612e 7368 6170 655b 305d 202f 206d 6173  a.shape[0] / mas
+000041b0: 6b5f 6461 7461 2e73 6861 7065 5b30 5d0d  k_data.shape[0].
+000041c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000041d0: 2020 2020 2078 5f73 6361 6c65 203d 2064       x_scale = d
+000041e0: 6174 612e 7368 6170 655b 315d 202f 206d  ata.shape[1] / m
+000041f0: 6173 6b5f 6461 7461 2e73 6861 7065 5b31  ask_data.shape[1
+00004200: 5d0d 0a20 2020 2020 2020 2020 2020 2020  ]..             
+00004210: 2020 2020 2020 206d 6173 6b5f 6461 7461         mask_data
+00004220: 203d 207a 6f6f 6d28 6d61 736b 5f64 6174   = zoom(mask_dat
+00004230: 612c 2028 795f 7363 616c 652c 2078 5f73  a, (y_scale, x_s
+00004240: 6361 6c65 2929 0d0a 0d0a 2020 2020 2020  cale))....      
+00004250: 2020 2020 2020 2020 2020 2320 5468 7265            # Thre
+00004260: 7368 6f6c 6420 6d61 736b 5f61 7272 6179  shold mask_array
+00004270: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00004280: 2020 6d61 736b 5f64 6174 6120 3d20 286d    mask_data = (m
+00004290: 6173 6b5f 6461 7461 203e 3d20 302e 3529  ask_data >= 0.5)
+000042a0: 2e61 7374 7970 6528 6e70 2e69 6e74 3332  .astype(np.int32
+000042b0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+000042c0: 2020 206d 6173 6b5f 6461 7461 203d 206d     mask_data = m
+000042d0: 6173 6b5f 6461 7461 2e61 7374 7970 6528  ask_data.astype(
+000042e0: 626f 6f6c 290d 0a0d 0a20 2020 2020 2020  bool)....       
+000042f0: 2020 2020 2020 2020 2064 6174 6120 3d20           data = 
+00004300: 6e70 2e77 6865 7265 286d 6173 6b5f 6461  np.where(mask_da
+00004310: 7461 203d 3d20 312c 2064 6174 612c 2030  ta == 1, data, 0
+00004320: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00004330: 2020 200d 0a20 2020 2020 2020 2020 2020     ..           
+00004340: 2069 6620 7363 616c 653d 3d27 706f 7765   if scale=='powe
+00004350: 7227 3a0d 0a20 2020 2020 2020 2020 2020  r':..           
+00004360: 2020 2020 2020 2020 2023 2069 6620 6e70           # if np
+00004370: 2e61 6e79 2864 6174 6120 3c20 2d31 293a  .any(data < -1):
+00004380: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00004390: 2020 2020 2020 2320 2020 2020 6461 7461        #     data
+000043a0: 5f6d 696e 203d 2064 6174 612e 6d69 6e28  _min = data.min(
+000043b0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+000043c0: 2020 2020 2020 2023 2020 2020 2064 6174         #     dat
+000043d0: 615f 6d61 7820 3d20 6461 7461 2e6d 6178  a_max = data.max
+000043e0: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
+000043f0: 2020 2020 2020 2020 2320 2020 2020 6461          #     da
+00004400: 7461 203d 2028 6461 7461 202d 2064 6174  ta = (data - dat
+00004410: 615f 6d69 6e29 202f 2028 6461 7461 5f6d  a_min) / (data_m
+00004420: 6178 202d 2064 6174 615f 6d69 6e29 202a  ax - data_min) *
+00004430: 2064 6174 615f 6d61 780d 0a20 2020 2020   data_max..     
+00004440: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00004450: 204c 6f67 206e 6f72 6d61 6c69 7a65 2074   Log normalize t
+00004460: 6865 2069 6d61 6765 0d0a 2020 2020 2020  he image..      
+00004470: 2020 2020 2020 2020 2020 2020 2020 6461                da
+00004480: 7461 203d 206e 702e 6c6f 6731 7028 6461  ta = np.log1p(da
+00004490: 7461 2920 2023 2041 7070 6c79 206c 6f67  ta)  # Apply log
+000044a0: 2074 7261 6e73 666f 726d 6174 696f 6e20   transformation 
+000044b0: 746f 2074 6865 2069 6d61 6765 0d0a 2020  to the image..  
+000044c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000044d0: 2020 0d0a 2020 2020 2020 2020 2020 2020    ..            
+000044e0: 2020 2020 2020 2020 2320 5374 6570 2032          # Step 2
+000044f0: 3a20 4170 706c 7920 6269 6c61 7465 7261  : Apply bilatera
+00004500: 6c20 6669 6c74 6572 2066 6f72 2064 656e  l filter for den
+00004510: 6f69 7369 6e67 0d0a 2020 2020 2020 2020  oising..        
+00004520: 2020 2020 2020 2020 2020 2020 6966 2062              if b
+00004530: 696c 6174 6572 616c 5f77 696e 5f73 697a  ilateral_win_siz
+00004540: 6520 6973 206e 6f74 204e 6f6e 653a 0d0a  e is not None:..
+00004550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004560: 2020 2020 2020 2020 6465 6e6f 6973 655f          denoise_
+00004570: 6269 6c61 7465 7261 6c20 3d20 6376 322e  bilateral = cv2.
+00004580: 6269 6c61 7465 7261 6c46 696c 7465 7228  bilateralFilter(
+00004590: 6461 7461 2c20 643d 6269 6c61 7465 7261  data, d=bilatera
+000045a0: 6c5f 7769 6e5f 7369 7a65 2c20 7369 676d  l_win_size, sigm
+000045b0: 6143 6f6c 6f72 3d62 696c 6174 6572 616c  aColor=bilateral
+000045c0: 5f73 6967 6d61 5f63 6f6c 6f72 2c20 7369  _sigma_color, si
+000045d0: 676d 6153 7061 6365 3d62 696c 6174 6572  gmaSpace=bilater
+000045e0: 616c 5f73 6967 6d61 5f73 7061 7469 616c  al_sigma_spatial
+000045f0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00004600: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
 00004610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004620: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
-00004630: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00004640: 656e 6f69 7365 5f62 696c 6174 6572 616c  enoise_bilateral
-00004650: 3d64 6174 610d 0a0d 0a20 2020 2020 2020  =data....       
-00004660: 2020 2020 2020 2020 2020 2020 2023 2053               # S
-00004670: 7465 7020 333a 204e 6f72 6d61 6c69 7a65  tep 3: Normalize
-00004680: 2074 6f20 302d 3235 3520 7363 616c 650d   to 0-255 scale.
-00004690: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000046a0: 2020 2020 2023 6e6f 726d 616c 697a 6564       #normalized
-000046b0: 5f64 6174 6120 3d20 6376 322e 6e6f 726d  _data = cv2.norm
-000046c0: 616c 697a 6528 6465 6e6f 6973 655f 6269  alize(denoise_bi
-000046d0: 6c61 7465 7261 6c2c 204e 6f6e 652c 2061  lateral, None, a
-000046e0: 6c70 6861 3d30 2c20 6265 7461 3d32 3535  lpha=0, beta=255
-000046f0: 2c20 6e6f 726d 5f74 7970 653d 6376 322e  , norm_type=cv2.
-00004700: 4e4f 524d 5f4d 494e 4d41 5829 0d0a 2020  NORM_MINMAX)..  
-00004710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004720: 2020 2320 5573 6520 7265 7363 616c 655f    # Use rescale_
-00004730: 696e 7465 6e73 6974 7920 746f 2073 7472  intensity to str
-00004740: 6574 6368 2074 6865 2069 6e74 656e 7369  etch the intensi
-00004750: 7479 2072 616e 6765 2074 6f20 2830 2c20  ty range to (0, 
-00004760: 3235 3529 0d0a 2020 2020 2020 2020 2020  255)..          
-00004770: 2020 2020 2020 2020 2020 6e6f 726d 616c            normal
-00004780: 697a 6564 5f64 6174 6120 3d20 2865 7870  ized_data = (exp
-00004790: 6f73 7572 652e 7265 7363 616c 655f 696e  osure.rescale_in
-000047a0: 7465 6e73 6974 7928 6465 6e6f 6973 655f  tensity(denoise_
-000047b0: 6269 6c61 7465 7261 6c2c 2069 6e5f 7261  bilateral, in_ra
-000047c0: 6e67 653d 286e 702e 6e61 6e6d 696e 2864  nge=(np.nanmin(d
-000047d0: 656e 6f69 7365 5f62 696c 6174 6572 616c  enoise_bilateral
-000047e0: 292c 206e 702e 6e61 6e6d 6178 2864 656e  ), np.nanmax(den
-000047f0: 6f69 7365 5f62 696c 6174 6572 616c 2929  oise_bilateral))
-00004800: 2c20 6f75 745f 7261 6e67 653d 2830 2c20  , out_range=(0, 
-00004810: 3235 3529 2929 2e61 7374 7970 6528 6e70  255))).astype(np
-00004820: 2e75 696e 7438 290d 0a0d 0a20 2020 2020  .uint8)....     
-00004830: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00004840: 2049 6620 6465 6e6f 6973 655f 6269 6c61   If denoise_bila
-00004850: 7465 7261 6c20 6973 2061 2066 6c6f 6174  teral is a float
-00004860: 2069 6d61 6765 2c20 656e 7375 7265 2074   image, ensure t
-00004870: 6865 206f 7574 7075 7420 6973 2069 6e20  he output is in 
-00004880: 7569 6e74 3820 666f 726d 6174 2066 6f72  uint8 format for
-00004890: 2070 726f 7065 7220 7669 7375 616c 697a   proper visualiz
-000048a0: 6174 696f 6e0d 0a20 2020 2020 2020 2020  ation..         
-000048b0: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-000048c0: 726d 616c 697a 6564 5f64 6174 612e 6474  rmalized_data.dt
-000048d0: 7970 6520 3d3d 206e 702e 666c 6f61 7436  ype == np.float6
-000048e0: 343a 0d0a 2020 2020 2020 2020 2020 2020  4:..            
-000048f0: 2020 2020 2020 2020 2020 2020 6e6f 726d              norm
-00004900: 616c 697a 6564 5f64 6174 6120 3d20 286e  alized_data = (n
-00004910: 6f72 6d61 6c69 7a65 645f 6461 7461 202a  ormalized_data *
-00004920: 2032 3535 292e 6173 7479 7065 286e 702e   255).astype(np.
-00004930: 7569 6e74 3829 0d0a 2020 2020 2020 2020  uint8)..        
-00004940: 2020 2020 2020 2020 2020 2020 0d0a 2020              ..  
-00004950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004960: 2020 2020 2023 2041 7070 6c79 206c 6f77       # Apply low
-00004970: 2d70 6173 7320 6669 6c74 6572 0d0a 2020  -pass filter..  
-00004980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004990: 2020 6966 206c 6f77 7061 7373 5f6b 6572    if lowpass_ker
-000049a0: 6e65 6c5f 7369 7a65 2069 7320 6e6f 7420  nel_size is not 
-000049b0: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
-000049c0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-000049d0: 6f72 6d61 6c69 7a65 645f 6461 7461 203d  ormalized_data =
-000049e0: 2067 6175 7373 6961 6e28 6e6f 726d 616c   gaussian(normal
-000049f0: 697a 6564 5f64 6174 612c 2073 6967 6d61  ized_data, sigma
-00004a00: 3d6c 6f77 7061 7373 5f6b 6572 6e65 6c5f  =lowpass_kernel_
-00004a10: 7369 7a65 2c20 7072 6573 6572 7665 5f72  size, preserve_r
-00004a20: 616e 6765 203d 5472 7565 2029 2020 2320  ange =True )  # 
-00004a30: 4164 6a75 7374 2073 6967 6d61 2061 6363  Adjust sigma acc
-00004a40: 6f72 6469 6e67 2074 6f20 796f 7572 2064  ording to your d
-00004a50: 6573 6972 6564 2073 6d6f 6f74 6869 6e67  esired smoothing
-00004a60: 2073 7472 656e 6774 680d 0a20 2020 2020   strength..     
-00004a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004a80: 2020 2066 696c 7465 7265 645f 6c61 6265     filtered_labe
-00004a90: 6c3d 274c 6f77 2050 6173 7320 4669 6c74  l='Low Pass Filt
-00004aa0: 6572 270d 0a20 2020 2020 2020 2020 2020  er'..           
-00004ab0: 2020 2020 2020 2020 2020 2020 2066 696c               fil
-00004ac0: 7465 7265 643d 6e6f 726d 616c 697a 6564  tered=normalized
-00004ad0: 5f64 6174 610d 0a20 2020 2020 2020 2020  _data..         
-00004ae0: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
-00004af0: 6c6f 7770 6173 735f 6b65 726e 656c 5f73  lowpass_kernel_s
-00004b00: 697a 6520 6973 204e 6f6e 6520 616e 6420  ize is None and 
-00004b10: 6f70 7469 6361 6c3d 3d46 616c 7365 3a0d  optical==False:.
-00004b20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004b30: 2020 2020 2020 2020 2023 6669 6c74 6572           #filter
-00004b40: 6564 3d63 7632 2e6d 6564 6961 6e42 6c75  ed=cv2.medianBlu
-00004b50: 7228 6465 6e6f 6973 655f 6269 6c61 7465  r(denoise_bilate
-00004b60: 7261 6c2c 2035 290d 0a20 2020 2020 2020  ral, 5)..       
-00004b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004b80: 2066 696c 7465 7265 643d 6e6f 726d 616c   filtered=normal
-00004b90: 697a 6564 5f64 6174 610d 0a20 2020 2020  ized_data..     
-00004ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004bb0: 2020 2066 696c 7465 7265 645f 6c61 6265     filtered_labe
-00004bc0: 6c3d 2742 696c 6174 6572 616c 2046 696c  l='Bilateral Fil
-00004bd0: 7465 7227 0d0a 2020 2020 2020 2020 2020  ter'..          
-00004be0: 2020 2020 2020 2020 2020 656c 7365 3a0d            else:.
-00004bf0: 0a0d 0a20 2020 2020 2020 2020 2020 2020  ...             
-00004c00: 2020 2020 2020 2020 2020 2066 696c 7465             filte
-00004c10: 7265 645f 6c61 6265 6c3d 274e 6f2d 4669  red_label='No-Fi
-00004c20: 6c74 6572 2041 7070 6c69 6564 270d 0a0d  lter Applied'...
-00004c30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004c40: 2020 2020 2020 2020 206e 6f72 6d61 6c69           normali
-00004c50: 7a65 645f 6461 7461 3d64 656e 6f69 7365  zed_data=denoise
-00004c60: 5f62 696c 6174 6572 616c 0d0a 2020 2020  _bilateral..    
-00004c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004c80: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00004c90: 2020 2020 2020 636f 7272 6563 7465 645f        corrected_
-00004ca0: 6461 7461 203d 206e 6f72 6d61 6c69 7a65  data = normalize
-00004cb0: 645f 6461 7461 0d0a 2020 2020 2020 2020  d_data..        
-00004cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004cd0: 0d0a 2020 2020 2020 2020 2020 2020 656c  ..            el
-00004ce0: 6966 2073 6361 6c65 3d3d 2761 6d70 6c69  if scale=='ampli
-00004cf0: 7475 6465 273a 0d0a 2020 2020 2020 2020  tude':..        
-00004d00: 2020 2020 2020 2020 2020 2020 6461 7461              data
-00004d10: 3d64 6174 610d 0a20 2020 2020 2020 2020  =data..         
-00004d20: 2020 2020 2020 2020 2020 2023 2053 7465             # Ste
-00004d30: 7020 333a 204e 6f72 6d61 6c69 7a65 2074  p 3: Normalize t
-00004d40: 6f20 302d 3235 3520 7363 616c 650d 0a20  o 0-255 scale.. 
-00004d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004d60: 2020 2023 636c 6970 7065 645f 6461 7461     #clipped_data
-00004d70: 203d 2070 6374 5f63 6c69 7028 6669 6c74   = pct_clip(filt
-00004d80: 6572 6564 290d 0a20 2020 2020 2020 2020  ered)..         
-00004d90: 2020 2020 2020 2020 2020 2069 6620 6269             if bi
-00004da0: 6c61 7465 7261 6c5f 7769 6e5f 7369 7a65  lateral_win_size
-00004db0: 2069 7320 6e6f 7420 4e6f 6e65 3a0d 0a20   is not None:.. 
+00004620: 2020 2020 2020 6465 6e6f 6973 655f 6269        denoise_bi
+00004630: 6c61 7465 7261 6c3d 6461 7461 0d0a 0d0a  lateral=data....
+00004640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004650: 2020 2020 2320 5374 6570 2033 3a20 4e6f      # Step 3: No
+00004660: 726d 616c 697a 6520 746f 2030 2d32 3535  rmalize to 0-255
+00004670: 2073 6361 6c65 0d0a 2020 2020 2020 2020   scale..        
+00004680: 2020 2020 2020 2020 2020 2020 236e 6f72              #nor
+00004690: 6d61 6c69 7a65 645f 6461 7461 203d 2063  malized_data = c
+000046a0: 7632 2e6e 6f72 6d61 6c69 7a65 2864 656e  v2.normalize(den
+000046b0: 6f69 7365 5f62 696c 6174 6572 616c 2c20  oise_bilateral, 
+000046c0: 4e6f 6e65 2c20 616c 7068 613d 302c 2062  None, alpha=0, b
+000046d0: 6574 613d 3235 352c 206e 6f72 6d5f 7479  eta=255, norm_ty
+000046e0: 7065 3d63 7632 2e4e 4f52 4d5f 4d49 4e4d  pe=cv2.NORM_MINM
+000046f0: 4158 290d 0a20 2020 2020 2020 2020 2020  AX)..           
+00004700: 2020 2020 2020 2020 2023 2055 7365 2072           # Use r
+00004710: 6573 6361 6c65 5f69 6e74 656e 7369 7479  escale_intensity
+00004720: 2074 6f20 7374 7265 7463 6820 7468 6520   to stretch the 
+00004730: 696e 7465 6e73 6974 7920 7261 6e67 6520  intensity range 
+00004740: 746f 2028 302c 2032 3535 290d 0a20 2020  to (0, 255)..   
+00004750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004760: 206e 6f72 6d61 6c69 7a65 645f 6461 7461   normalized_data
+00004770: 203d 2028 6578 706f 7375 7265 2e72 6573   = (exposure.res
+00004780: 6361 6c65 5f69 6e74 656e 7369 7479 2864  cale_intensity(d
+00004790: 656e 6f69 7365 5f62 696c 6174 6572 616c  enoise_bilateral
+000047a0: 2c20 696e 5f72 616e 6765 3d28 6e70 2e6e  , in_range=(np.n
+000047b0: 616e 6d69 6e28 6465 6e6f 6973 655f 6269  anmin(denoise_bi
+000047c0: 6c61 7465 7261 6c29 2c20 6e70 2e6e 616e  lateral), np.nan
+000047d0: 6d61 7828 6465 6e6f 6973 655f 6269 6c61  max(denoise_bila
+000047e0: 7465 7261 6c29 292c 206f 7574 5f72 616e  teral)), out_ran
+000047f0: 6765 3d28 302c 2032 3535 2929 292e 6173  ge=(0, 255))).as
+00004800: 7479 7065 286e 702e 7569 6e74 3829 0d0a  type(np.uint8)..
+00004810: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00004820: 2020 2020 2020 2320 4966 2064 656e 6f69        # If denoi
+00004830: 7365 5f62 696c 6174 6572 616c 2069 7320  se_bilateral is 
+00004840: 6120 666c 6f61 7420 696d 6167 652c 2065  a float image, e
+00004850: 6e73 7572 6520 7468 6520 6f75 7470 7574  nsure the output
+00004860: 2069 7320 696e 2075 696e 7438 2066 6f72   is in uint8 for
+00004870: 6d61 7420 666f 7220 7072 6f70 6572 2076  mat for proper v
+00004880: 6973 7561 6c69 7a61 7469 6f6e 0d0a 2020  isualization..  
+00004890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000048a0: 2020 6966 206e 6f72 6d61 6c69 7a65 645f    if normalized_
+000048b0: 6461 7461 2e64 7479 7065 203d 3d20 6e70  data.dtype == np
+000048c0: 2e66 6c6f 6174 3634 3a0d 0a20 2020 2020  .float64:..     
+000048d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000048e0: 2020 206e 6f72 6d61 6c69 7a65 645f 6461     normalized_da
+000048f0: 7461 203d 2028 6e6f 726d 616c 697a 6564  ta = (normalized
+00004900: 5f64 6174 6120 2a20 3235 3529 2e61 7374  _data * 255).ast
+00004910: 7970 6528 6e70 2e75 696e 7438 290d 0a20  ype(np.uint8).. 
+00004920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004930: 2020 200d 0a20 2020 2020 2020 2020 2020     ..           
+00004940: 2020 2020 2020 2020 2020 2020 2320 4170              # Ap
+00004950: 706c 7920 6c6f 772d 7061 7373 2066 696c  ply low-pass fil
+00004960: 7465 720d 0a20 2020 2020 2020 2020 2020  ter..           
+00004970: 2020 2020 2020 2020 2069 6620 6c6f 7770           if lowp
+00004980: 6173 735f 6b65 726e 656c 5f73 697a 6520  ass_kernel_size 
+00004990: 6973 206e 6f74 204e 6f6e 653a 0d0a 2020  is not None:..  
+000049a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000049b0: 2020 2020 2020 6e6f 726d 616c 697a 6564        normalized
+000049c0: 5f64 6174 6120 3d20 6761 7573 7369 616e  _data = gaussian
+000049d0: 286e 6f72 6d61 6c69 7a65 645f 6461 7461  (normalized_data
+000049e0: 2c20 7369 676d 613d 6c6f 7770 6173 735f  , sigma=lowpass_
+000049f0: 6b65 726e 656c 5f73 697a 652c 2070 7265  kernel_size, pre
+00004a00: 7365 7276 655f 7261 6e67 6520 3d54 7275  serve_range =Tru
+00004a10: 6520 2920 2023 2041 646a 7573 7420 7369  e )  # Adjust si
+00004a20: 676d 6120 6163 636f 7264 696e 6720 746f  gma according to
+00004a30: 2079 6f75 7220 6465 7369 7265 6420 736d   your desired sm
+00004a40: 6f6f 7468 696e 6720 7374 7265 6e67 7468  oothing strength
+00004a50: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00004a60: 2020 2020 2020 2020 2020 6669 6c74 6572            filter
+00004a70: 6564 5f6c 6162 656c 3d27 4c6f 7720 5061  ed_label='Low Pa
+00004a80: 7373 2046 696c 7465 7227 0d0a 2020 2020  ss Filter'..    
+00004a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004aa0: 2020 2020 6669 6c74 6572 6564 3d6e 6f72      filtered=nor
+00004ab0: 6d61 6c69 7a65 645f 6461 7461 0d0a 2020  malized_data..  
+00004ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004ad0: 2020 656c 6966 206c 6f77 7061 7373 5f6b    elif lowpass_k
+00004ae0: 6572 6e65 6c5f 7369 7a65 2069 7320 4e6f  ernel_size is No
+00004af0: 6e65 2061 6e64 206f 7074 6963 616c 3d3d  ne and optical==
+00004b00: 4661 6c73 653a 0d0a 2020 2020 2020 2020  False:..        
+00004b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004b20: 2366 696c 7465 7265 643d 6376 322e 6d65  #filtered=cv2.me
+00004b30: 6469 616e 426c 7572 2864 656e 6f69 7365  dianBlur(denoise
+00004b40: 5f62 696c 6174 6572 616c 2c20 3529 0d0a  _bilateral, 5)..
+00004b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004b60: 2020 2020 2020 2020 6669 6c74 6572 6564          filtered
+00004b70: 3d6e 6f72 6d61 6c69 7a65 645f 6461 7461  =normalized_data
+00004b80: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00004b90: 2020 2020 2020 2020 2020 6669 6c74 6572            filter
+00004ba0: 6564 5f6c 6162 656c 3d27 4269 6c61 7465  ed_label='Bilate
+00004bb0: 7261 6c20 4669 6c74 6572 270d 0a20 2020  ral Filter'..   
+00004bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004bd0: 2065 6c73 653a 0d0a 0d0a 2020 2020 2020   else:....      
+00004be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004bf0: 2020 6669 6c74 6572 6564 5f6c 6162 656c    filtered_label
+00004c00: 3d27 4e6f 2d46 696c 7465 7220 4170 706c  ='No-Filter Appl
+00004c10: 6965 6427 0d0a 0d0a 2020 2020 2020 2020  ied'....        
+00004c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004c30: 6e6f 726d 616c 697a 6564 5f64 6174 613d  normalized_data=
+00004c40: 6465 6e6f 6973 655f 6269 6c61 7465 7261  denoise_bilatera
+00004c50: 6c0d 0a20 2020 2020 2020 2020 2020 2020  l..             
+00004c60: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
+00004c70: 2020 2020 2020 2020 2020 2020 2063 6f72               cor
+00004c80: 7265 6374 6564 5f64 6174 6120 3d20 6e6f  rected_data = no
+00004c90: 726d 616c 697a 6564 5f64 6174 610d 0a20  rmalized_data.. 
+00004ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004cb0: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
+00004cc0: 2020 2020 2065 6c69 6620 7363 616c 653d       elif scale=
+00004cd0: 3d27 616d 706c 6974 7564 6527 3a0d 0a20  ='amplitude':.. 
+00004ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004cf0: 2020 2064 6174 613d 6461 7461 0d0a 2020     data=data..  
+00004d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004d10: 2020 2320 5374 6570 2033 3a20 4e6f 726d    # Step 3: Norm
+00004d20: 616c 697a 6520 746f 2030 2d32 3535 2073  alize to 0-255 s
+00004d30: 6361 6c65 0d0a 2020 2020 2020 2020 2020  cale..          
+00004d40: 2020 2020 2020 2020 2020 2363 6c69 7070            #clipp
+00004d50: 6564 5f64 6174 6120 3d20 7063 745f 636c  ed_data = pct_cl
+00004d60: 6970 2866 696c 7465 7265 6429 0d0a 2020  ip(filtered)..  
+00004d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004d80: 2020 6966 2062 696c 6174 6572 616c 5f77    if bilateral_w
+00004d90: 696e 5f73 697a 6520 6973 206e 6f74 204e  in_size is not N
+00004da0: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
+00004db0: 2020 2020 2020 2020 2020 2020 2020 0d0a                ..
 00004dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004dd0: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
-00004de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004df0: 2064 656e 6f69 7365 5f62 696c 6174 6572   denoise_bilater
-00004e00: 616c 203d 2063 7632 2e62 696c 6174 6572  al = cv2.bilater
-00004e10: 616c 4669 6c74 6572 2864 6174 612c 2064  alFilter(data, d
-00004e20: 3d62 696c 6174 6572 616c 5f77 696e 5f73  =bilateral_win_s
-00004e30: 697a 652c 2073 6967 6d61 436f 6c6f 723d  ize, sigmaColor=
-00004e40: 6269 6c61 7465 7261 6c5f 7369 676d 615f  bilateral_sigma_
-00004e50: 636f 6c6f 722c 2073 6967 6d61 5370 6163  color, sigmaSpac
-00004e60: 653d 6269 6c61 7465 7261 6c5f 7369 676d  e=bilateral_sigm
-00004e70: 615f 7370 6174 6961 6c29 2020 0d0a 2020  a_spatial)  ..  
+00004dd0: 2020 2020 2020 2020 6465 6e6f 6973 655f          denoise_
+00004de0: 6269 6c61 7465 7261 6c20 3d20 6376 322e  bilateral = cv2.
+00004df0: 6269 6c61 7465 7261 6c46 696c 7465 7228  bilateralFilter(
+00004e00: 6461 7461 2c20 643d 6269 6c61 7465 7261  data, d=bilatera
+00004e10: 6c5f 7769 6e5f 7369 7a65 2c20 7369 676d  l_win_size, sigm
+00004e20: 6143 6f6c 6f72 3d62 696c 6174 6572 616c  aColor=bilateral
+00004e30: 5f73 6967 6d61 5f63 6f6c 6f72 2c20 7369  _sigma_color, si
+00004e40: 676d 6153 7061 6365 3d62 696c 6174 6572  gmaSpace=bilater
+00004e50: 616c 5f73 6967 6d61 5f73 7061 7469 616c  al_sigma_spatial
+00004e60: 2920 200d 0a20 2020 2020 2020 2020 2020  )  ..           
+00004e70: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
 00004e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004e90: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
-00004ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004eb0: 2064 656e 6f69 7365 5f62 696c 6174 6572   denoise_bilater
-00004ec0: 616c 3d64 6174 610d 0a20 2020 2020 2020  al=data..       
-00004ed0: 2020 2020 2020 2020 2020 2020 2023 6e6f               #no
-00004ee0: 726d 616c 697a 6564 5f64 6174 6120 3d20  rmalized_data = 
-00004ef0: 6376 322e 6e6f 726d 616c 697a 6528 6465  cv2.normalize(de
-00004f00: 6e6f 6973 655f 6269 6c61 7465 7261 6c2c  noise_bilateral,
-00004f10: 204e 6f6e 652c 2061 6c70 6861 3d30 2c20   None, alpha=0, 
-00004f20: 6265 7461 3d32 3535 2c20 6e6f 726d 5f74  beta=255, norm_t
-00004f30: 7970 653d 6376 322e 4e4f 524d 5f4d 494e  ype=cv2.NORM_MIN
-00004f40: 4d41 5829 200d 0a20 2020 2020 2020 2020  MAX) ..         
-00004f50: 2020 2020 2020 2020 2020 206e 6f72 6d61             norma
-00004f60: 6c69 7a65 645f 6461 7461 203d 2065 7870  lized_data = exp
-00004f70: 6f73 7572 652e 7265 7363 616c 655f 696e  osure.rescale_in
-00004f80: 7465 6e73 6974 7928 6465 6e6f 6973 655f  tensity(denoise_
-00004f90: 6269 6c61 7465 7261 6c2c 2069 6e5f 7261  bilateral, in_ra
-00004fa0: 6e67 653d 286e 702e 6e61 6e6d 696e 2864  nge=(np.nanmin(d
-00004fb0: 656e 6f69 7365 5f62 696c 6174 6572 616c  enoise_bilateral
-00004fc0: 292c 206e 702e 6e61 6e6d 6178 2864 656e  ), np.nanmax(den
-00004fd0: 6f69 7365 5f62 696c 6174 6572 616c 2929  oise_bilateral))
-00004fe0: 2c20 6f75 745f 7261 6e67 653d 2830 2c20  , out_range=(0, 
-00004ff0: 3235 3529 290d 0a0d 0a20 2020 2020 2020  255))....       
-00005000: 2020 2020 2020 2020 2020 2020 2023 2049               # I
-00005010: 6620 6465 6e6f 6973 655f 6269 6c61 7465  f denoise_bilate
-00005020: 7261 6c20 6973 2061 2066 6c6f 6174 2069  ral is a float i
-00005030: 6d61 6765 2c20 656e 7375 7265 2074 6865  mage, ensure the
-00005040: 206f 7574 7075 7420 6973 2069 6e20 7569   output is in ui
-00005050: 6e74 3820 666f 726d 6174 2066 6f72 2070  nt8 format for p
-00005060: 726f 7065 7220 7669 7375 616c 697a 6174  roper visualizat
-00005070: 696f 6e0d 0a20 2020 2020 2020 2020 2020  ion..           
-00005080: 2020 2020 2020 2020 2069 6620 6e6f 726d           if norm
-00005090: 616c 697a 6564 5f64 6174 612e 6474 7970  alized_data.dtyp
-000050a0: 6520 3d3d 206e 702e 666c 6f61 7436 343a  e == np.float64:
-000050b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000050c0: 2020 2020 2020 2020 2020 6e6f 726d 616c            normal
-000050d0: 697a 6564 5f64 6174 6120 3d20 286e 6f72  ized_data = (nor
-000050e0: 6d61 6c69 7a65 645f 6461 7461 202a 2032  malized_data * 2
-000050f0: 3535 292e 6173 7479 7065 286e 702e 7569  55).astype(np.ui
-00005100: 6e74 3829 0d0a 2020 2020 2020 2020 2020  nt8)..          
-00005110: 2020 2020 2020 2020 2020 6966 206c 6f77            if low
-00005120: 7061 7373 5f6b 6572 6e65 6c5f 7369 7a65  pass_kernel_size
-00005130: 2069 7320 6e6f 7420 4e6f 6e65 3a0d 0a20   is not None:.. 
-00005140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005150: 2020 2020 2020 2066 696c 7465 7265 6420         filtered 
-00005160: 3d20 6761 7573 7369 616e 286e 6f72 6d61  = gaussian(norma
-00005170: 6c69 7a65 645f 6461 7461 2c20 7369 676d  lized_data, sigm
-00005180: 613d 6c6f 7770 6173 735f 6b65 726e 656c  a=lowpass_kernel
-00005190: 5f73 697a 652c 2070 7265 7365 7276 655f  _size, preserve_
-000051a0: 7261 6e67 6520 3d54 7275 6520 2920 2023  range =True )  #
-000051b0: 2041 646a 7573 7420 7369 676d 6120 6163   Adjust sigma ac
-000051c0: 636f 7264 696e 6720 746f 2079 6f75 7220  cording to your 
-000051d0: 6465 7369 7265 6420 736d 6f6f 7468 696e  desired smoothin
-000051e0: 6720 7374 7265 6e67 7468 0d0a 2020 2020  g strength..    
-000051f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005200: 2020 2020 6669 6c74 6572 6564 5f6c 6162      filtered_lab
-00005210: 656c 3d27 4c6f 7720 5061 7373 2046 696c  el='Low Pass Fil
-00005220: 7465 7227 0d0a 2020 2020 2020 2020 2020  ter'..          
-00005230: 2020 2020 2020 2020 2020 2020 2020 636f                co
-00005240: 7272 6563 7465 645f 6461 7461 3d66 696c  rrected_data=fil
-00005250: 7465 7265 640d 0a20 2020 2020 2020 2020  tered..         
-00005260: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
-00005270: 6c6f 7770 6173 735f 6b65 726e 656c 5f73  lowpass_kernel_s
-00005280: 697a 6520 6973 204e 6f6e 6520 616e 6420  ize is None and 
-00005290: 6f70 7469 6361 6c3d 3d46 616c 7365 3a0d  optical==False:.
-000052a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000052b0: 2020 2020 2020 2020 2023 6669 6c74 6572           #filter
-000052c0: 6564 3d63 7632 2e6d 6564 6961 6e42 6c75  ed=cv2.medianBlu
-000052d0: 7228 6465 6e6f 6973 655f 6269 6c61 7465  r(denoise_bilate
-000052e0: 7261 6c2c 2035 290d 0a20 2020 2020 2020  ral, 5)..       
-000052f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005300: 2066 696c 7465 7265 643d 6e6f 726d 616c   filtered=normal
-00005310: 697a 6564 5f64 6174 610d 0a20 2020 2020  ized_data..     
-00005320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005330: 2020 2066 696c 7465 7265 645f 6c61 6265     filtered_labe
-00005340: 6c3d 2742 696c 6174 6572 616c 2046 696c  l='Bilateral Fil
-00005350: 7465 7227 0d0a 2020 2020 2020 2020 2020  ter'..          
-00005360: 2020 2020 2020 2020 2020 2020 2020 0d0a                ..
+00004e90: 2020 2020 2020 2020 6465 6e6f 6973 655f          denoise_
+00004ea0: 6269 6c61 7465 7261 6c3d 6461 7461 0d0a  bilateral=data..
+00004eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004ec0: 2020 2020 236e 6f72 6d61 6c69 7a65 645f      #normalized_
+00004ed0: 6461 7461 203d 2063 7632 2e6e 6f72 6d61  data = cv2.norma
+00004ee0: 6c69 7a65 2864 656e 6f69 7365 5f62 696c  lize(denoise_bil
+00004ef0: 6174 6572 616c 2c20 4e6f 6e65 2c20 616c  ateral, None, al
+00004f00: 7068 613d 302c 2062 6574 613d 3235 352c  pha=0, beta=255,
+00004f10: 206e 6f72 6d5f 7479 7065 3d63 7632 2e4e   norm_type=cv2.N
+00004f20: 4f52 4d5f 4d49 4e4d 4158 2920 0d0a 2020  ORM_MINMAX) ..  
+00004f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004f40: 2020 6e6f 726d 616c 697a 6564 5f64 6174    normalized_dat
+00004f50: 6120 3d20 6578 706f 7375 7265 2e72 6573  a = exposure.res
+00004f60: 6361 6c65 5f69 6e74 656e 7369 7479 2864  cale_intensity(d
+00004f70: 656e 6f69 7365 5f62 696c 6174 6572 616c  enoise_bilateral
+00004f80: 2c20 696e 5f72 616e 6765 3d28 6e70 2e6e  , in_range=(np.n
+00004f90: 616e 6d69 6e28 6465 6e6f 6973 655f 6269  anmin(denoise_bi
+00004fa0: 6c61 7465 7261 6c29 2c20 6e70 2e6e 616e  lateral), np.nan
+00004fb0: 6d61 7828 6465 6e6f 6973 655f 6269 6c61  max(denoise_bila
+00004fc0: 7465 7261 6c29 292c 206f 7574 5f72 616e  teral)), out_ran
+00004fd0: 6765 3d28 302c 2032 3535 2929 0d0a 0d0a  ge=(0, 255))....
+00004fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004ff0: 2020 2020 2320 4966 2064 656e 6f69 7365      # If denoise
+00005000: 5f62 696c 6174 6572 616c 2069 7320 6120  _bilateral is a 
+00005010: 666c 6f61 7420 696d 6167 652c 2065 6e73  float image, ens
+00005020: 7572 6520 7468 6520 6f75 7470 7574 2069  ure the output i
+00005030: 7320 696e 2075 696e 7438 2066 6f72 6d61  s in uint8 forma
+00005040: 7420 666f 7220 7072 6f70 6572 2076 6973  t for proper vis
+00005050: 7561 6c69 7a61 7469 6f6e 0d0a 2020 2020  ualization..    
+00005060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005070: 6966 206e 6f72 6d61 6c69 7a65 645f 6461  if normalized_da
+00005080: 7461 2e64 7479 7065 203d 3d20 6e70 2e66  ta.dtype == np.f
+00005090: 6c6f 6174 3634 3a0d 0a20 2020 2020 2020  loat64:..       
+000050a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000050b0: 206e 6f72 6d61 6c69 7a65 645f 6461 7461   normalized_data
+000050c0: 203d 2028 6e6f 726d 616c 697a 6564 5f64   = (normalized_d
+000050d0: 6174 6120 2a20 3235 3529 2e61 7374 7970  ata * 255).astyp
+000050e0: 6528 6e70 2e75 696e 7438 290d 0a20 2020  e(np.uint8)..   
+000050f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005100: 2069 6620 6c6f 7770 6173 735f 6b65 726e   if lowpass_kern
+00005110: 656c 5f73 697a 6520 6973 206e 6f74 204e  el_size is not N
+00005120: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
+00005130: 2020 2020 2020 2020 2020 2020 2020 6669                fi
+00005140: 6c74 6572 6564 203d 2067 6175 7373 6961  ltered = gaussia
+00005150: 6e28 6e6f 726d 616c 697a 6564 5f64 6174  n(normalized_dat
+00005160: 612c 2073 6967 6d61 3d6c 6f77 7061 7373  a, sigma=lowpass
+00005170: 5f6b 6572 6e65 6c5f 7369 7a65 2c20 7072  _kernel_size, pr
+00005180: 6573 6572 7665 5f72 616e 6765 203d 5472  eserve_range =Tr
+00005190: 7565 2029 2020 2320 4164 6a75 7374 2073  ue )  # Adjust s
+000051a0: 6967 6d61 2061 6363 6f72 6469 6e67 2074  igma according t
+000051b0: 6f20 796f 7572 2064 6573 6972 6564 2073  o your desired s
+000051c0: 6d6f 6f74 6869 6e67 2073 7472 656e 6774  moothing strengt
+000051d0: 680d 0a20 2020 2020 2020 2020 2020 2020  h..             
+000051e0: 2020 2020 2020 2020 2020 2066 696c 7465             filte
+000051f0: 7265 645f 6c61 6265 6c3d 274c 6f77 2050  red_label='Low P
+00005200: 6173 7320 4669 6c74 6572 270d 0a20 2020  ass Filter'..   
+00005210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005220: 2020 2020 2063 6f72 7265 6374 6564 5f64       corrected_d
+00005230: 6174 613d 6669 6c74 6572 6564 0d0a 2020  ata=filtered..  
+00005240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005250: 2020 656c 6966 206c 6f77 7061 7373 5f6b    elif lowpass_k
+00005260: 6572 6e65 6c5f 7369 7a65 2069 7320 4e6f  ernel_size is No
+00005270: 6e65 2061 6e64 206f 7074 6963 616c 3d3d  ne and optical==
+00005280: 4661 6c73 653a 0d0a 2020 2020 2020 2020  False:..        
+00005290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000052a0: 2366 696c 7465 7265 643d 6376 322e 6d65  #filtered=cv2.me
+000052b0: 6469 616e 426c 7572 2864 656e 6f69 7365  dianBlur(denoise
+000052c0: 5f62 696c 6174 6572 616c 2c20 3529 0d0a  _bilateral, 5)..
+000052d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000052e0: 2020 2020 2020 2020 6669 6c74 6572 6564          filtered
+000052f0: 3d6e 6f72 6d61 6c69 7a65 645f 6461 7461  =normalized_data
+00005300: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00005310: 2020 2020 2020 2020 2020 6669 6c74 6572            filter
+00005320: 6564 5f6c 6162 656c 3d27 4269 6c61 7465  ed_label='Bilate
+00005330: 7261 6c20 4669 6c74 6572 270d 0a20 2020  ral Filter'..   
+00005340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005350: 2020 2020 200d 0a20 2020 2020 2020 2020       ..         
+00005360: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
 00005370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005380: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00005390: 2020 2020 2020 2020 2020 636f 7272 6563            correc
-000053a0: 7465 645f 6461 7461 203d 206e 6f72 6d61  ted_data = norma
-000053b0: 6c69 7a65 645f 6461 7461 0d0a 2020 2020  lized_data..    
+00005380: 2063 6f72 7265 6374 6564 5f64 6174 6120   corrected_data 
+00005390: 3d20 6e6f 726d 616c 697a 6564 5f64 6174  = normalized_dat
+000053a0: 610d 0a20 2020 2020 2020 2020 2020 2020  a..             
+000053b0: 2020 2020 2020 2065 6c73 653a 0d0a 0d0a         else:....
 000053c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000053d0: 656c 7365 3a0d 0a0d 0a20 2020 2020 2020  else:....       
-000053e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000053f0: 2066 696c 7465 7265 645f 6c61 6265 6c3d   filtered_label=
-00005400: 274e 6f2d 4669 6c74 6572 2041 7070 6c69  'No-Filter Appli
-00005410: 6564 270d 0a0d 0a20 2020 2020 2020 2020  ed'....         
-00005420: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00005430: 6e6f 726d 616c 697a 6564 5f64 6174 613d  normalized_data=
-00005440: 6465 6e6f 6973 655f 6269 6c61 7465 7261  denoise_bilatera
-00005450: 6c0d 0a20 2020 2020 2020 2020 2020 2020  l..             
-00005460: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
-00005470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005480: 2063 6f72 7265 6374 6564 5f64 6174 6120   corrected_data 
-00005490: 3d20 6e6f 726d 616c 697a 6564 5f64 6174  = normalized_dat
-000054a0: 610d 0a20 2020 2020 2020 2020 2020 2020  a..             
-000054b0: 2020 2020 2020 2020 2020 200d 0a20 2020             ..   
-000054c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000054d0: 0d0a 2020 2020 2020 2020 2020 2020 656c  ..            el
-000054e0: 6966 206f 7074 6963 616c 3d3d 5472 7565  if optical==True
-000054f0: 2061 6e64 2073 6361 6c65 2069 7320 6e6f   and scale is no
-00005500: 7420 4e6f 6e65 3a0d 0a20 2020 2020 2020  t None:..       
-00005510: 2020 2020 2020 2020 200d 0a20 2020 2020           ..     
-00005520: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-00005530: 2827 7365 7420 7363 616c 6520 746f 204e  ('set scale to N
-00005540: 6f6e 6520 6265 6361 7573 6520 796f 7520  one because you 
-00005550: 6368 6f73 6520 746f 2070 726f 6365 7373  chose to process
-00005560: 206f 7074 6963 616c 2069 6d61 6765 7279   optical imagery
-00005570: 2729 0d0a 2020 2020 2020 2020 2020 2020  ')..            
-00005580: 0d0a 2020 2020 2020 2020 2020 200d 0a0d  ..           ...
-00005590: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-000055a0: 6f70 7469 6361 6c3d 3d54 7275 653a 0d0a  optical==True:..
-000055b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000055c0: 6966 2063 6c69 705f 7065 7263 656e 7469  if clip_percenti
-000055d0: 6c65 7320 6973 206e 6f74 204e 6f6e 653a  les is not None:
-000055e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000055f0: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
-00005600: 2020 2020 2020 2020 2020 2020 636c 6970              clip
-00005610: 7065 645f 6461 7461 203d 2070 6374 5f63  ped_data = pct_c
-00005620: 6c69 7028 6461 7461 290d 0a20 2020 2020  lip(data)..     
-00005630: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00005640: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00005650: 2020 2020 2020 636c 6970 7065 645f 6461        clipped_da
-00005660: 7461 3d64 6174 610d 0a20 2020 2020 2020  ta=data..       
-00005670: 2020 2020 2020 2020 2064 656e 6f69 7365           denoise
-00005680: 5f62 696c 6174 6572 616c 203d 2063 6c69  _bilateral = cli
-00005690: 7070 6564 5f64 6174 610d 0a20 2020 2020  pped_data..     
-000056a0: 2020 2020 2020 2020 2020 2069 6620 434c             if CL
-000056b0: 4148 455f 6669 6c74 6572 3a0d 0a20 2020  AHE_filter:..   
-000056c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000056d0: 2063 6f72 7265 6374 6564 5f64 6174 6120   corrected_data 
-000056e0: 3d20 6578 706f 7375 7265 2e65 7175 616c  = exposure.equal
-000056f0: 697a 655f 6164 6170 7468 6973 7428 6465  ize_adapthist(de
-00005700: 6e6f 6973 655f 6269 6c61 7465 7261 6c2c  noise_bilateral,
-00005710: 206b 6572 6e65 6c5f 7369 7a65 3d31 3238   kernel_size=128
-00005720: 2c20 636c 6970 5f6c 696d 6974 3d30 2e30  , clip_limit=0.0
-00005730: 312c 206e 6269 6e73 3d32 3536 290d 0a20  1, nbins=256).. 
-00005740: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00005750: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
-00005760: 2020 2020 2020 2020 2020 636f 7272 6563            correc
-00005770: 7465 645f 6461 7461 3d64 656e 6f69 7365  ted_data=denoise
-00005780: 5f62 696c 6174 6572 616c 0d0a 2020 2020  _bilateral..    
-00005790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000057a0: 236e 6f72 6d61 6c69 7a65 645f 6461 7461  #normalized_data
-000057b0: 203d 2063 7632 2e6e 6f72 6d61 6c69 7a65   = cv2.normalize
-000057c0: 2863 6f72 7265 6374 6564 5f64 6174 612c  (corrected_data,
-000057d0: 204e 6f6e 652c 2061 6c70 6861 3d30 2c20   None, alpha=0, 
-000057e0: 6265 7461 3d32 3535 2c20 6e6f 726d 5f74  beta=255, norm_t
-000057f0: 7970 653d 6376 322e 4e4f 524d 5f4d 494e  ype=cv2.NORM_MIN
-00005800: 4d41 5829 2e61 7374 7970 6528 6e70 2e75  MAX).astype(np.u
-00005810: 696e 7438 290d 0a20 2020 2020 2020 2020  int8)..         
-00005820: 2020 2020 2020 2020 2020 206e 6f72 6d61             norma
-00005830: 6c69 7a65 645f 6461 7461 203d 2065 7870  lized_data = exp
-00005840: 6f73 7572 652e 7265 7363 616c 655f 696e  osure.rescale_in
-00005850: 7465 6e73 6974 7928 636f 7272 6563 7465  tensity(correcte
-00005860: 645f 6461 7461 2c20 696e 5f72 616e 6765  d_data, in_range
-00005870: 3d28 6e70 2e6e 616e 6d69 6e28 636f 7272  =(np.nanmin(corr
-00005880: 6563 7465 645f 6461 7461 292c 206e 702e  ected_data), np.
-00005890: 6e61 6e6d 6178 2863 6f72 7265 6374 6564  nanmax(corrected
-000058a0: 5f64 6174 6129 292c 206f 7574 5f72 616e  _data)), out_ran
-000058b0: 6765 3d28 302c 2032 3535 2929 0d0a 0d0a  ge=(0, 255))....
-000058c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000058d0: 2020 2020 2320 4966 2064 656e 6f69 7365      # If denoise
-000058e0: 5f62 696c 6174 6572 616c 2069 7320 6120  _bilateral is a 
-000058f0: 666c 6f61 7420 696d 6167 652c 2065 6e73  float image, ens
-00005900: 7572 6520 7468 6520 6f75 7470 7574 2069  ure the output i
-00005910: 7320 696e 2075 696e 7438 2066 6f72 6d61  s in uint8 forma
-00005920: 7420 666f 7220 7072 6f70 6572 2076 6973  t for proper vis
-00005930: 7561 6c69 7a61 7469 6f6e 0d0a 2020 2020  ualization..    
-00005940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005950: 6966 206e 6f72 6d61 6c69 7a65 645f 6461  if normalized_da
-00005960: 7461 2e64 7479 7065 203d 3d20 6e70 2e66  ta.dtype == np.f
-00005970: 6c6f 6174 3634 3a0d 0a20 2020 2020 2020  loat64:..       
-00005980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005990: 206e 6f72 6d61 6c69 7a65 645f 6461 7461   normalized_data
-000059a0: 203d 2028 6e6f 726d 616c 697a 6564 5f64   = (normalized_d
-000059b0: 6174 6120 2a20 3235 3529 2e61 7374 7970  ata * 255).astyp
-000059c0: 6528 6e70 2e75 696e 7438 290d 0a20 2020  e(np.uint8)..   
-000059d0: 2020 2020 2020 2020 2020 2020 2063 6f72               cor
-000059e0: 7265 6374 6564 5f64 6174 613d 6e6f 726d  rected_data=norm
-000059f0: 616c 697a 6564 5f64 6174 610d 0a20 2020  alized_data..   
-00005a00: 2020 2020 2020 2020 2020 2020 2066 696c               fil
-00005a10: 7465 7265 643d 6e6f 726d 616c 697a 6564  tered=normalized
-00005a20: 5f64 6174 610d 0a20 2020 2020 2020 2020  _data..         
-00005a30: 2020 2020 2020 2066 696c 7465 7265 645f         filtered_
-00005a40: 6c61 6265 6c3d 2743 4c41 4845 2d46 696c  label='CLAHE-Fil
-00005a50: 7465 7227 0d0a 2020 2020 2020 2020 2020  ter'..          
-00005a60: 2020 2020 2020 0d0a 0d0a 2020 2020 2020        ....      
-00005a70: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
-00005a80: 2020 2020 0d0a 2020 2020 2020 2020 2020      ..          
-00005a90: 2020 0d0a 2020 2020 2020 2020 2020 2020    ..            
-00005aa0: 0d0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-00005ab0: 506c 6f74 2061 6e64 2064 6973 706c 6179  Plot and display
-00005ac0: 2074 6865 2069 6d61 6765 7320 616e 6420   the images and 
-00005ad0: 6869 7374 6f67 7261 6d73 0d0a 2020 2020  histograms..    
-00005ae0: 2020 2020 2020 2020 6669 672c 2061 7865          fig, axe
-00005af0: 7320 3d20 706c 742e 7375 6270 6c6f 7473  s = plt.subplots
-00005b00: 286e 726f 7773 3d32 2c20 6e63 6f6c 733d  (nrows=2, ncols=
-00005b10: 342c 2066 6967 7369 7a65 3d28 3230 2c20  4, figsize=(20, 
-00005b20: 3130 2929 0d0a 0d0a 2020 2020 2020 2020  10))....        
-00005b30: 2020 2020 2320 506c 6f74 2074 6865 206f      # Plot the o
-00005b40: 7269 6769 6e61 6c20 696d 6167 650d 0a20  riginal image.. 
-00005b50: 2020 2020 2020 2020 2020 2061 7865 735b             axes[
-00005b60: 302c 2030 5d2e 696d 7368 6f77 2864 6174  0, 0].imshow(dat
-00005b70: 612c 2063 6d61 703d 2767 7261 7927 290d  a, cmap='gray').
-00005b80: 0a20 2020 2020 2020 2020 2020 2061 7865  .            axe
-00005b90: 735b 302c 2030 5d2e 7365 745f 7469 746c  s[0, 0].set_titl
-00005ba0: 6528 274f 7269 6769 6e61 6c20 496d 6167  e('Original Imag
-00005bb0: 6527 290d 0a0d 0a20 2020 2020 2020 2020  e')....         
-00005bc0: 2020 2023 2050 6c6f 7420 7468 6520 6d65     # Plot the me
-00005bd0: 6469 616e 5f66 696c 7465 7220 696d 6167  dian_filter imag
-00005be0: 650d 0a20 2020 2020 2020 2020 2020 2061  e..            a
-00005bf0: 7865 735b 302c 2032 5d2e 696d 7368 6f77  xes[0, 2].imshow
-00005c00: 2866 696c 7465 7265 642c 2063 6d61 703d  (filtered, cmap=
-00005c10: 2767 7261 7927 290d 0a20 2020 2020 2020  'gray')..       
-00005c20: 2020 2020 2061 7865 735b 302c 2032 5d2e       axes[0, 2].
-00005c30: 7365 745f 7469 746c 6528 6669 6c74 6572  set_title(filter
-00005c40: 6564 5f6c 6162 656c 290d 0a0d 0a20 2020  ed_label)....   
-00005c50: 2020 2020 2020 2020 2023 2050 6c6f 7420           # Plot 
-00005c60: 7468 6520 6465 6e6f 6973 655f 6269 6c61  the denoise_bila
-00005c70: 7465 7261 6c20 696d 6167 650d 0a20 2020  teral image..   
-00005c80: 2020 2020 2020 2020 2061 7865 735b 302c           axes[0,
-00005c90: 2031 5d2e 696d 7368 6f77 2864 656e 6f69   1].imshow(denoi
-00005ca0: 7365 5f62 696c 6174 6572 616c 2c20 636d  se_bilateral, cm
-00005cb0: 6170 3d27 6772 6179 2729 0d0a 2020 2020  ap='gray')..    
-00005cc0: 2020 2020 2020 2020 6178 6573 5b30 2c20          axes[0, 
-00005cd0: 315d 2e73 6574 5f74 6974 6c65 2827 6465  1].set_title('de
-00005ce0: 6e6f 6973 655f 6269 6c61 7465 7261 6c27  noise_bilateral'
-00005cf0: 290d 0a0d 0a20 2020 2020 2020 2020 2020  )....           
-00005d00: 2023 2050 6c6f 7420 7468 6520 6465 6e6f   # Plot the deno
-00005d10: 6973 655f 6269 6c61 7465 7261 6c20 696d  ise_bilateral im
-00005d20: 6167 650d 0a20 2020 2020 2020 2020 2020  age..           
-00005d30: 2061 7865 735b 302c 2033 5d2e 696d 7368   axes[0, 3].imsh
-00005d40: 6f77 2863 6f72 7265 6374 6564 5f64 6174  ow(corrected_dat
-00005d50: 612c 2063 6d61 703d 2767 7261 7927 290d  a, cmap='gray').
-00005d60: 0a20 2020 2020 2020 2020 2020 2061 7865  .            axe
-00005d70: 735b 302c 2033 5d2e 7365 745f 7469 746c  s[0, 3].set_titl
-00005d80: 6528 2763 6f72 7265 6374 6564 5f64 6174  e('corrected_dat
-00005d90: 6127 290d 0a0d 0a20 2020 2020 2020 2020  a')....         
-00005da0: 2020 2023 2050 6c6f 7420 7468 6520 6869     # Plot the hi
-00005db0: 7374 6f67 7261 6d20 6f66 2074 6865 206f  stogram of the o
-00005dc0: 7269 6769 6e61 6c20 6461 7461 0d0a 2020  riginal data..  
-00005dd0: 2020 2020 2020 2020 2020 6178 6573 5b31            axes[1
-00005de0: 2c20 305d 2e68 6973 7428 6461 7461 2e66  , 0].hist(data.f
-00005df0: 6c61 7474 656e 2829 2c20 6269 6e73 3d35  latten(), bins=5
-00005e00: 302c 2063 6f6c 6f72 3d27 6227 2c20 616c  0, color='b', al
-00005e10: 7068 613d 302e 3729 0d0a 2020 2020 2020  pha=0.7)..      
-00005e20: 2020 2020 2020 6178 6573 5b31 2c20 305d        axes[1, 0]
-00005e30: 2e73 6574 5f74 6974 6c65 2827 4f72 6967  .set_title('Orig
-00005e40: 696e 616c 2048 6973 746f 6772 616d 2729  inal Histogram')
-00005e50: 0d0a 2020 2020 2020 2020 2020 2020 6178  ..            ax
-00005e60: 6573 5b31 2c20 305d 2e73 6574 5f78 6c61  es[1, 0].set_xla
-00005e70: 6265 6c28 2750 6978 656c 2056 616c 7565  bel('Pixel Value
-00005e80: 2729 0d0a 2020 2020 2020 2020 2020 2020  ')..            
-00005e90: 6178 6573 5b31 2c20 305d 2e73 6574 5f79  axes[1, 0].set_y
-00005ea0: 6c61 6265 6c28 2746 7265 7175 656e 6379  label('Frequency
-00005eb0: 2729 0d0a 0d0a 2020 2020 2020 2020 2020  ')....          
-00005ec0: 2020 2320 506c 6f74 2074 6865 2068 6973    # Plot the his
-00005ed0: 746f 6772 616d 206f 6620 7468 6520 6d65  togram of the me
-00005ee0: 6469 616e 5f66 696c 7465 7220 6461 7461  dian_filter data
-00005ef0: 0d0a 2020 2020 2020 2020 2020 2020 6178  ..            ax
-00005f00: 6573 5b31 2c20 325d 2e68 6973 7428 6e6f  es[1, 2].hist(no
-00005f10: 726d 616c 697a 6564 5f64 6174 612e 666c  rmalized_data.fl
-00005f20: 6174 7465 6e28 292c 2062 696e 733d 3530  atten(), bins=50
-00005f30: 2c20 636f 6c6f 723d 2767 272c 2061 6c70  , color='g', alp
-00005f40: 6861 3d30 2e37 290d 0a20 2020 2020 2020  ha=0.7)..       
-00005f50: 2020 2020 2061 7865 735b 312c 2032 5d2e       axes[1, 2].
-00005f60: 7365 745f 7469 746c 6528 6669 6c74 6572  set_title(filter
-00005f70: 6564 5f6c 6162 656c 290d 0a20 2020 2020  ed_label)..     
-00005f80: 2020 2020 2020 2061 7865 735b 312c 2032         axes[1, 2
-00005f90: 5d2e 7365 745f 786c 6162 656c 2827 5069  ].set_xlabel('Pi
-00005fa0: 7865 6c20 5661 6c75 6527 290d 0a20 2020  xel Value')..   
-00005fb0: 2020 2020 2020 2020 2061 7865 735b 312c           axes[1,
-00005fc0: 2032 5d2e 7365 745f 796c 6162 656c 2827   2].set_ylabel('
-00005fd0: 4672 6571 7565 6e63 7927 290d 0a0d 0a20  Frequency').... 
-00005fe0: 2020 2020 2020 2020 2020 2023 2050 6c6f             # Plo
-00005ff0: 7420 7468 6520 6869 7374 6f67 7261 6d20  t the histogram 
-00006000: 6f66 2074 6865 2064 656e 6f69 7365 5f62  of the denoise_b
-00006010: 696c 6174 6572 616c 2064 6174 610d 0a20  ilateral data.. 
-00006020: 2020 2020 2020 2020 2020 2061 7865 735b             axes[
-00006030: 312c 2031 5d2e 6869 7374 2864 656e 6f69  1, 1].hist(denoi
-00006040: 7365 5f62 696c 6174 6572 616c 2e66 6c61  se_bilateral.fla
-00006050: 7474 656e 2829 2c20 6269 6e73 3d35 302c  tten(), bins=50,
-00006060: 2063 6f6c 6f72 3d27 7227 2c20 616c 7068   color='r', alph
-00006070: 613d 302e 3729 0d0a 2020 2020 2020 2020  a=0.7)..        
-00006080: 2020 2020 6178 6573 5b31 2c20 315d 2e73      axes[1, 1].s
-00006090: 6574 5f74 6974 6c65 2827 6465 6e6f 6973  et_title('denois
-000060a0: 655f 6269 6c61 7465 7261 6c20 4869 7374  e_bilateral Hist
-000060b0: 6f67 7261 6d27 290d 0a20 2020 2020 2020  ogram')..       
-000060c0: 2020 2020 2061 7865 735b 312c 2031 5d2e       axes[1, 1].
-000060d0: 7365 745f 786c 6162 656c 2827 5069 7865  set_xlabel('Pixe
-000060e0: 6c20 5661 6c75 6527 290d 0a20 2020 2020  l Value')..     
-000060f0: 2020 2020 2020 2061 7865 735b 312c 2031         axes[1, 1
-00006100: 5d2e 7365 745f 796c 6162 656c 2827 4672  ].set_ylabel('Fr
-00006110: 6571 7565 6e63 7927 290d 0a0d 0a20 2020  equency')....   
-00006120: 2020 2020 2020 2020 2023 2050 6c6f 7420           # Plot 
-00006130: 7468 6520 6869 7374 6f67 7261 6d20 6f66  the histogram of
-00006140: 2074 6865 2064 656e 6f69 7365 5f62 696c   the denoise_bil
-00006150: 6174 6572 616c 2064 6174 610d 0a20 2020  ateral data..   
-00006160: 2020 2020 2020 2020 2061 7865 735b 312c           axes[1,
-00006170: 2033 5d2e 6869 7374 2863 6f72 7265 6374   3].hist(correct
-00006180: 6564 5f64 6174 612e 666c 6174 7465 6e28  ed_data.flatten(
-00006190: 292c 2062 696e 733d 3530 2c20 636f 6c6f  ), bins=50, colo
-000061a0: 723d 2772 272c 2061 6c70 6861 3d30 2e37  r='r', alpha=0.7
-000061b0: 290d 0a20 2020 2020 2020 2020 2020 2061  )..            a
-000061c0: 7865 735b 312c 2033 5d2e 7365 745f 7469  xes[1, 3].set_ti
-000061d0: 746c 6528 2763 6f72 7265 6374 6564 5f64  tle('corrected_d
-000061e0: 6174 6120 4869 7374 6f67 7261 6d27 290d  ata Histogram').
-000061f0: 0a20 2020 2020 2020 2020 2020 2061 7865  .            axe
-00006200: 735b 312c 2033 5d2e 7365 745f 786c 6162  s[1, 3].set_xlab
-00006210: 656c 2827 5069 7865 6c20 5661 6c75 6527  el('Pixel Value'
-00006220: 290d 0a20 2020 2020 2020 2020 2020 2061  )..            a
-00006230: 7865 735b 312c 2033 5d2e 7365 745f 796c  xes[1, 3].set_yl
-00006240: 6162 656c 2827 4672 6571 7565 6e63 7927  abel('Frequency'
-00006250: 290d 0a0d 0a20 2020 2020 2020 2020 2020  )....           
-00006260: 2023 2053 6176 6520 7468 6520 706c 6f74   # Save the plot
-00006270: 2061 7320 6120 7369 6e67 6c65 2066 6967   as a single fig
-00006280: 7572 650d 0a20 2020 2020 2020 2020 2020  ure..           
-00006290: 206f 7574 7075 745f 6669 6c65 6e61 6d65   output_filename
-000062a0: 203d 206f 732e 7061 7468 2e73 706c 6974   = os.path.split
-000062b0: 6578 7428 696d 6167 655f 6669 6c65 295b  ext(image_file)[
-000062c0: 305d 202b 2027 5f69 6d61 6765 735f 6869  0] + '_images_hi
-000062d0: 7374 6f67 7261 6d73 2e6a 7067 270d 0a20  stograms.jpg'.. 
-000062e0: 2020 2020 2020 2020 2020 206f 7574 7075             outpu
-000062f0: 745f 6669 6c65 7061 7468 203d 206f 732e  t_filepath = os.
-00006300: 7061 7468 2e6a 6f69 6e28 706c 6f74 5f64  path.join(plot_d
-00006310: 6972 6563 746f 7279 2c20 6f75 7470 7574  irectory, output
-00006320: 5f66 696c 656e 616d 6529 0d0a 2020 2020  _filename)..    
-00006330: 2020 2020 2020 2020 706c 742e 7361 7665          plt.save
-00006340: 6669 6728 6f75 7470 7574 5f66 696c 6570  fig(output_filep
-00006350: 6174 682c 2066 6f72 6d61 743d 276a 7067  ath, format='jpg
-00006360: 2729 0d0a 0d0a 2020 2020 2020 2020 2020  ')....          
-00006370: 2020 2320 4361 6c6c 2074 6967 6874 5f6c    # Call tight_l
-00006380: 6179 6f75 7428 2920 746f 2061 646a 7573  ayout() to adjus
-00006390: 7420 7468 6520 7375 6270 6c6f 7420 7370  t the subplot sp
-000063a0: 6163 696e 670d 0a20 2020 2020 2020 2020  acing..         
-000063b0: 2020 2070 6c74 2e74 6967 6874 5f6c 6179     plt.tight_lay
-000063c0: 6f75 7428 290d 0a0d 0a20 2020 2020 2020  out()....       
-000063d0: 2020 2020 2023 2043 6c6f 7365 2074 6865       # Close the
-000063e0: 2070 6c6f 740d 0a20 2020 2020 2020 2020   plot..         
-000063f0: 2020 2070 6c74 2e63 6c6f 7365 2829 0d0a     plt.close()..
-00006400: 0d0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-00006410: 4372 6561 7465 2061 6e20 6f75 7470 7574  Create an output
-00006420: 2072 6173 7465 7220 7769 7468 2074 6865   raster with the
-00006430: 2063 6f72 7265 6374 6564 2064 6174 610d   corrected data.
-00006440: 0a20 2020 2020 2020 2020 2020 206f 7574  .            out
-00006450: 7075 745f 6669 6c65 6e61 6d65 203d 206f  put_filename = o
-00006460: 732e 7061 7468 2e73 706c 6974 6578 7428  s.path.splitext(
-00006470: 696d 6167 655f 6669 6c65 295b 305d 202b  image_file)[0] +
-00006480: 2027 2e74 6966 270d 0a20 2020 2020 2020   '.tif'..       
-00006490: 2020 2020 206f 7574 7075 745f 6669 6c65       output_file
-000064a0: 7061 7468 203d 206f 732e 7061 7468 2e6a  path = os.path.j
-000064b0: 6f69 6e28 6f75 7470 7574 5f70 6174 682c  oin(output_path,
-000064c0: 206f 7574 7075 745f 6669 6c65 6e61 6d65   output_filename
-000064d0: 290d 0a20 2020 2020 2020 2020 2020 2064  )..            d
-000064e0: 7269 7665 7220 3d20 6764 616c 2e47 6574  river = gdal.Get
-000064f0: 4472 6976 6572 4279 4e61 6d65 2822 4754  DriverByName("GT
-00006500: 6966 6622 290d 0a20 2020 2020 2020 2020  iff")..         
-00006510: 2020 206f 7574 7075 745f 6461 7461 7365     output_datase
-00006520: 7420 3d20 6472 6976 6572 2e43 7265 6174  t = driver.Creat
-00006530: 6528 6f75 7470 7574 5f66 696c 6570 6174  e(output_filepat
-00006540: 682c 2064 6174 6173 6574 2e52 6173 7465  h, dataset.Raste
-00006550: 7258 5369 7a65 2c20 6461 7461 7365 742e  rXSize, dataset.
-00006560: 5261 7374 6572 5953 697a 652c 2031 2c0d  RasterYSize, 1,.
-00006570: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00006580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006590: 2020 2020 2020 2020 2020 2020 6764 616c              gdal
-000065a0: 2e47 4454 5f42 7974 6529 0d0a 2020 2020  .GDT_Byte)..    
-000065b0: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
-000065c0: 2020 2020 2020 6966 206e 6f64 6174 615f        if nodata_
-000065d0: 7661 6c75 6520 6973 206e 6f74 204e 6f6e  value is not Non
-000065e0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-000065f0: 2020 2020 636f 7272 6563 7465 645f 6461      corrected_da
-00006600: 7461 203d 206e 702e 7768 6572 6528 636f  ta = np.where(co
-00006610: 7272 6563 7465 645f 6461 7461 203d 3d20  rrected_data == 
-00006620: 6e6f 6461 7461 5f76 616c 7565 2c20 6e70  nodata_value, np
-00006630: 2e6e 616e 2c20 636f 7272 6563 7465 645f  .nan, corrected_
-00006640: 6461 7461 290d 0a20 2020 2020 2020 2020  data)..         
-00006650: 2020 200d 0a20 2020 2020 2020 2020 2020     ..           
-00006660: 206f 7574 7075 745f 6461 7461 7365 742e   output_dataset.
-00006670: 4765 7452 6173 7465 7242 616e 6428 3129  GetRasterBand(1)
-00006680: 2e57 7269 7465 4172 7261 7928 636f 7272  .WriteArray(corr
-00006690: 6563 7465 645f 6461 7461 290d 0a0d 0a20  ected_data).... 
-000066a0: 2020 2020 2020 2020 2020 2023 2053 6574             # Set
-000066b0: 2074 6865 2073 616d 6520 6765 6f74 7261   the same geotra
-000066c0: 6e73 666f 726d 2061 6e64 2070 726f 6a65  nsform and proje
-000066d0: 6374 696f 6e20 6173 2074 6865 2069 6e70  ction as the inp
-000066e0: 7574 2072 6173 7465 720d 0a20 2020 2020  ut raster..     
-000066f0: 2020 2020 2020 206f 7574 7075 745f 6461         output_da
-00006700: 7461 7365 742e 5365 7447 656f 5472 616e  taset.SetGeoTran
-00006710: 7366 6f72 6d28 6461 7461 7365 742e 4765  sform(dataset.Ge
-00006720: 7447 656f 5472 616e 7366 6f72 6d28 2929  tGeoTransform())
-00006730: 0d0a 2020 2020 2020 2020 2020 2020 6f75  ..            ou
-00006740: 7470 7574 5f64 6174 6173 6574 2e53 6574  tput_dataset.Set
-00006750: 5072 6f6a 6563 7469 6f6e 2864 6174 6173  Projection(datas
-00006760: 6574 2e47 6574 5072 6f6a 6563 7469 6f6e  et.GetProjection
-00006770: 2829 290d 0a0d 0a20 2020 2020 2020 2020  ())....         
-00006780: 2020 2023 2043 6c6f 7365 2074 6865 2064     # Close the d
-00006790: 6174 6173 6574 730d 0a20 2020 2020 2020  atasets..       
-000067a0: 2020 2020 2064 6174 6173 6574 203d 204e       dataset = N
-000067b0: 6f6e 650d 0a20 2020 2020 2020 2020 2020  one..           
-000067c0: 206f 7574 7075 745f 6461 7461 7365 7420   output_dataset 
-000067d0: 3d20 4e6f 6e65 0d0a 0d0a 2020 2020 2020  = None....      
-000067e0: 2020 6578 6365 7074 2045 7863 6570 7469    except Excepti
-000067f0: 6f6e 2061 7320 653a 0d0a 2020 2020 2020  on as e:..      
-00006800: 2020 2020 2020 7072 696e 7428 6622 4572        print(f"Er
-00006810: 726f 7220 7072 6f63 6573 7369 6e67 2072  ror processing r
-00006820: 6173 7465 723a 207b 696d 6167 655f 6669  aster: {image_fi
-00006830: 6c65 7d22 290d 0a20 2020 2020 2020 2020  le}")..         
-00006840: 2020 2070 7269 6e74 2873 7472 2865 2929     print(str(e))
-00006850: 0d0a 0d0a 2020 2020 2020 2020 2320 5570  ....        # Up
-00006860: 6461 7465 2070 726f 6772 6573 7320 6261  date progress ba
-00006870: 720d 0a20 2020 2020 2020 2070 726f 6772  r..        progr
-00006880: 6573 735f 6261 722e 7570 6461 7465 2831  ess_bar.update(1
-00006890: 290d 0a0d 0a20 2020 2023 2043 6c6f 7365  )....    # Close
-000068a0: 2070 726f 6772 6573 7320 6261 720d 0a20   progress bar.. 
-000068b0: 2020 2070 726f 6772 6573 735f 6261 722e     progress_bar.
-000068c0: 636c 6f73 6528 290d 0a0d 0a0d 0a23 2023  close()......# #
-000068d0: 2045 7861 6d70 6c65 2075 7361 6765 0d0a   Example usage..
-000068e0: 2320 696e 7075 745f 7061 7468 203d 2022  # input_path = "
-000068f0: 6372 6f70 7065 645f 6469 7222 0d0a 2320  cropped_dir"..# 
-00006900: 6f75 7470 7574 5f70 6174 6820 3d20 226f  output_path = "o
-00006910: 7574 7075 745f 6469 7222 0d0a 2320 6c69  utput_dir"..# li
-00006920: 6d69 7420 3d20 3520 2023 204d 6178 696d  mit = 5  # Maxim
-00006930: 756d 206e 756d 6265 7220 6f66 2069 6d61  um number of ima
-00006940: 6765 7320 746f 2070 726f 6365 7373 2c20  ges to process, 
-00006950: 7365 7420 746f 204e 6f6e 6520 666f 7220  set to None for 
-00006960: 616c 6c20 696d 6167 6573 0d0a 2320 7261  all images..# ra
-00006970: 7374 6572 5f63 6f72 7265 6374 696f 6e28  ster_correction(
-00006980: 696e 7075 745f 7061 7468 2c20 6f75 7470  input_path, outp
-00006990: 7574 5f70 6174 682c 206c 696d 6974 290d  ut_path, limit).
-000069a0: 0a0d 0a20 2020 2020 2020 20              ...        
+000053d0: 2020 2020 2020 2020 6669 6c74 6572 6564          filtered
+000053e0: 5f6c 6162 656c 3d27 4e6f 2d46 696c 7465  _label='No-Filte
+000053f0: 7220 4170 706c 6965 6427 0d0a 0d0a 2020  r Applied'....  
+00005400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005410: 2020 2020 2020 236e 6f72 6d61 6c69 7a65        #normalize
+00005420: 645f 6461 7461 3d64 656e 6f69 7365 5f62  d_data=denoise_b
+00005430: 696c 6174 6572 616c 0d0a 2020 2020 2020  ilateral..      
+00005440: 2020 2020 2020 2020 2020 2020 2020 0d0a                ..
+00005450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005460: 2020 2020 2020 2020 636f 7272 6563 7465          correcte
+00005470: 645f 6461 7461 203d 206e 6f72 6d61 6c69  d_data = normali
+00005480: 7a65 645f 6461 7461 0d0a 2020 2020 2020  zed_data..      
+00005490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000054a0: 2020 0d0a 2020 2020 2020 2020 2020 2020    ..            
+000054b0: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
+000054c0: 2020 2020 2065 6c69 6620 6f70 7469 6361       elif optica
+000054d0: 6c3d 3d54 7275 6520 616e 6420 7363 616c  l==True and scal
+000054e0: 6520 6973 206e 6f74 204e 6f6e 653a 0d0a  e is not None:..
+000054f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005500: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00005510: 2020 7072 696e 7428 2773 6574 2073 6361    print('set sca
+00005520: 6c65 2074 6f20 4e6f 6e65 2062 6563 6175  le to None becau
+00005530: 7365 2079 6f75 2063 686f 7365 2074 6f20  se you chose to 
+00005540: 7072 6f63 6573 7320 6f70 7469 6361 6c20  process optical 
+00005550: 696d 6167 6572 7927 290d 0a20 2020 2020  imagery')..     
+00005560: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
+00005570: 2020 2020 0d0a 0d0a 2020 2020 2020 2020      ....        
+00005580: 2020 2020 6966 206f 7074 6963 616c 3d3d      if optical==
+00005590: 5472 7565 3a0d 0a20 2020 2020 2020 2020  True:..         
+000055a0: 2020 2020 2020 2069 6620 636c 6970 5f70         if clip_p
+000055b0: 6572 6365 6e74 696c 6573 2069 7320 6e6f  ercentiles is no
+000055c0: 7420 4e6f 6e65 3a0d 0a20 2020 2020 2020  t None:..       
+000055d0: 2020 2020 2020 2020 2020 2020 200d 0a20               .. 
+000055e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000055f0: 2020 2063 6c69 7070 6564 5f64 6174 6120     clipped_data 
+00005600: 3d20 7063 745f 636c 6970 2864 6174 6129  = pct_clip(data)
+00005610: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00005620: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+00005630: 2020 2020 2020 2020 2020 2020 2063 6c69               cli
+00005640: 7070 6564 5f64 6174 613d 6461 7461 0d0a  pped_data=data..
+00005650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005660: 6465 6e6f 6973 655f 6269 6c61 7465 7261  denoise_bilatera
+00005670: 6c20 3d20 636c 6970 7065 645f 6461 7461  l = clipped_data
+00005680: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00005690: 2020 6966 2043 4c41 4845 5f66 696c 7465    if CLAHE_filte
+000056a0: 723a 0d0a 2020 2020 2020 2020 2020 2020  r:..            
+000056b0: 2020 2020 2020 2020 636f 7272 6563 7465          correcte
+000056c0: 645f 6461 7461 203d 2065 7870 6f73 7572  d_data = exposur
+000056d0: 652e 6571 7561 6c69 7a65 5f61 6461 7074  e.equalize_adapt
+000056e0: 6869 7374 2864 656e 6f69 7365 5f62 696c  hist(denoise_bil
+000056f0: 6174 6572 616c 2c20 6b65 726e 656c 5f73  ateral, kernel_s
+00005700: 697a 653d 3132 382c 2063 6c69 705f 6c69  ize=128, clip_li
+00005710: 6d69 743d 302e 3031 2c20 6e62 696e 733d  mit=0.01, nbins=
+00005720: 3235 3629 0d0a 2020 2020 2020 2020 2020  256)..          
+00005730: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
+00005740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005750: 2063 6f72 7265 6374 6564 5f64 6174 613d   corrected_data=
+00005760: 6465 6e6f 6973 655f 6269 6c61 7465 7261  denoise_bilatera
+00005770: 6c0d 0a20 2020 2020 2020 2020 2020 2020  l..             
+00005780: 2020 2020 2020 2023 6e6f 726d 616c 697a         #normaliz
+00005790: 6564 5f64 6174 6120 3d20 6376 322e 6e6f  ed_data = cv2.no
+000057a0: 726d 616c 697a 6528 636f 7272 6563 7465  rmalize(correcte
+000057b0: 645f 6461 7461 2c20 4e6f 6e65 2c20 616c  d_data, None, al
+000057c0: 7068 613d 302c 2062 6574 613d 3235 352c  pha=0, beta=255,
+000057d0: 206e 6f72 6d5f 7479 7065 3d63 7632 2e4e   norm_type=cv2.N
+000057e0: 4f52 4d5f 4d49 4e4d 4158 292e 6173 7479  ORM_MINMAX).asty
+000057f0: 7065 286e 702e 7569 6e74 3829 0d0a 2020  pe(np.uint8)..  
+00005800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005810: 2020 6e6f 726d 616c 697a 6564 5f64 6174    normalized_dat
+00005820: 6120 3d20 6578 706f 7375 7265 2e72 6573  a = exposure.res
+00005830: 6361 6c65 5f69 6e74 656e 7369 7479 2863  cale_intensity(c
+00005840: 6f72 7265 6374 6564 5f64 6174 612c 2069  orrected_data, i
+00005850: 6e5f 7261 6e67 653d 286e 702e 6e61 6e6d  n_range=(np.nanm
+00005860: 696e 2863 6f72 7265 6374 6564 5f64 6174  in(corrected_dat
+00005870: 6129 2c20 6e70 2e6e 616e 6d61 7828 636f  a), np.nanmax(co
+00005880: 7272 6563 7465 645f 6461 7461 2929 2c20  rrected_data)), 
+00005890: 6f75 745f 7261 6e67 653d 2830 2c20 3235  out_range=(0, 25
+000058a0: 3529 290d 0a0d 0a20 2020 2020 2020 2020  5))....         
+000058b0: 2020 2020 2020 2020 2020 2023 2049 6620             # If 
+000058c0: 6465 6e6f 6973 655f 6269 6c61 7465 7261  denoise_bilatera
+000058d0: 6c20 6973 2061 2066 6c6f 6174 2069 6d61  l is a float ima
+000058e0: 6765 2c20 656e 7375 7265 2074 6865 206f  ge, ensure the o
+000058f0: 7574 7075 7420 6973 2069 6e20 7569 6e74  utput is in uint
+00005900: 3820 666f 726d 6174 2066 6f72 2070 726f  8 format for pro
+00005910: 7065 7220 7669 7375 616c 697a 6174 696f  per visualizatio
+00005920: 6e0d 0a20 2020 2020 2020 2020 2020 2020  n..             
+00005930: 2020 2020 2020 2069 6620 6e6f 726d 616c         if normal
+00005940: 697a 6564 5f64 6174 612e 6474 7970 6520  ized_data.dtype 
+00005950: 3d3d 206e 702e 666c 6f61 7436 343a 0d0a  == np.float64:..
+00005960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005970: 2020 2020 2020 2020 6e6f 726d 616c 697a          normaliz
+00005980: 6564 5f64 6174 6120 3d20 286e 6f72 6d61  ed_data = (norma
+00005990: 6c69 7a65 645f 6461 7461 202a 2032 3535  lized_data * 255
+000059a0: 292e 6173 7479 7065 286e 702e 7569 6e74  ).astype(np.uint
+000059b0: 3829 0d0a 2020 2020 2020 2020 2020 2020  8)..            
+000059c0: 2020 2020 636f 7272 6563 7465 645f 6461      corrected_da
+000059d0: 7461 3d6e 6f72 6d61 6c69 7a65 645f 6461  ta=normalized_da
+000059e0: 7461 0d0a 2020 2020 2020 2020 2020 2020  ta..            
+000059f0: 2020 2020 6669 6c74 6572 6564 3d6e 6f72      filtered=nor
+00005a00: 6d61 6c69 7a65 645f 6461 7461 0d0a 2020  malized_data..  
+00005a10: 2020 2020 2020 2020 2020 2020 2020 6669                fi
+00005a20: 6c74 6572 6564 5f6c 6162 656c 3d27 434c  ltered_label='CL
+00005a30: 4148 452d 4669 6c74 6572 270d 0a20 2020  AHE-Filter'..   
+00005a40: 2020 2020 2020 2020 2020 2020 200d 0a0d               ...
+00005a50: 0a20 2020 2020 2020 2020 2020 200d 0a20  .            .. 
+00005a60: 2020 2020 2020 2020 2020 200d 0a20 2020             ..   
+00005a70: 2020 2020 2020 2020 200d 0a20 2020 2020           ..     
+00005a80: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
+00005a90: 2020 2020 2023 2050 6c6f 7420 616e 6420       # Plot and 
+00005aa0: 6469 7370 6c61 7920 7468 6520 696d 6167  display the imag
+00005ab0: 6573 2061 6e64 2068 6973 746f 6772 616d  es and histogram
+00005ac0: 730d 0a20 2020 2020 2020 2020 2020 2066  s..            f
+00005ad0: 6967 2c20 6178 6573 203d 2070 6c74 2e73  ig, axes = plt.s
+00005ae0: 7562 706c 6f74 7328 6e72 6f77 733d 322c  ubplots(nrows=2,
+00005af0: 206e 636f 6c73 3d34 2c20 6669 6773 697a   ncols=4, figsiz
+00005b00: 653d 2832 302c 2031 3029 290d 0a0d 0a20  e=(20, 10)).... 
+00005b10: 2020 2020 2020 2020 2020 2023 2050 6c6f             # Plo
+00005b20: 7420 7468 6520 6f72 6967 696e 616c 2069  t the original i
+00005b30: 6d61 6765 0d0a 2020 2020 2020 2020 2020  mage..          
+00005b40: 2020 6178 6573 5b30 2c20 305d 2e69 6d73    axes[0, 0].ims
+00005b50: 686f 7728 6461 7461 2c20 636d 6170 3d27  how(data, cmap='
+00005b60: 6772 6179 2729 0d0a 2020 2020 2020 2020  gray')..        
+00005b70: 2020 2020 6178 6573 5b30 2c20 305d 2e73      axes[0, 0].s
+00005b80: 6574 5f74 6974 6c65 2827 4f72 6967 696e  et_title('Origin
+00005b90: 616c 2049 6d61 6765 2729 0d0a 0d0a 2020  al Image')....  
+00005ba0: 2020 2020 2020 2020 2020 2320 506c 6f74            # Plot
+00005bb0: 2074 6865 206d 6564 6961 6e5f 6669 6c74   the median_filt
+00005bc0: 6572 2069 6d61 6765 0d0a 2020 2020 2020  er image..      
+00005bd0: 2020 2020 2020 6178 6573 5b30 2c20 325d        axes[0, 2]
+00005be0: 2e69 6d73 686f 7728 6669 6c74 6572 6564  .imshow(filtered
+00005bf0: 2c20 636d 6170 3d27 6772 6179 2729 0d0a  , cmap='gray')..
+00005c00: 2020 2020 2020 2020 2020 2020 6178 6573              axes
+00005c10: 5b30 2c20 325d 2e73 6574 5f74 6974 6c65  [0, 2].set_title
+00005c20: 2866 696c 7465 7265 645f 6c61 6265 6c29  (filtered_label)
+00005c30: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
+00005c40: 2320 506c 6f74 2074 6865 2064 656e 6f69  # Plot the denoi
+00005c50: 7365 5f62 696c 6174 6572 616c 2069 6d61  se_bilateral ima
+00005c60: 6765 0d0a 2020 2020 2020 2020 2020 2020  ge..            
+00005c70: 6178 6573 5b30 2c20 315d 2e69 6d73 686f  axes[0, 1].imsho
+00005c80: 7728 6465 6e6f 6973 655f 6269 6c61 7465  w(denoise_bilate
+00005c90: 7261 6c2c 2063 6d61 703d 2767 7261 7927  ral, cmap='gray'
+00005ca0: 290d 0a20 2020 2020 2020 2020 2020 2061  )..            a
+00005cb0: 7865 735b 302c 2031 5d2e 7365 745f 7469  xes[0, 1].set_ti
+00005cc0: 746c 6528 2764 656e 6f69 7365 5f62 696c  tle('denoise_bil
+00005cd0: 6174 6572 616c 2729 0d0a 0d0a 2020 2020  ateral')....    
+00005ce0: 2020 2020 2020 2020 2320 506c 6f74 2074          # Plot t
+00005cf0: 6865 2064 656e 6f69 7365 5f62 696c 6174  he denoise_bilat
+00005d00: 6572 616c 2069 6d61 6765 0d0a 2020 2020  eral image..    
+00005d10: 2020 2020 2020 2020 6178 6573 5b30 2c20          axes[0, 
+00005d20: 335d 2e69 6d73 686f 7728 636f 7272 6563  3].imshow(correc
+00005d30: 7465 645f 6461 7461 2c20 636d 6170 3d27  ted_data, cmap='
+00005d40: 6772 6179 2729 0d0a 2020 2020 2020 2020  gray')..        
+00005d50: 2020 2020 6178 6573 5b30 2c20 335d 2e73      axes[0, 3].s
+00005d60: 6574 5f74 6974 6c65 2827 636f 7272 6563  et_title('correc
+00005d70: 7465 645f 6461 7461 2729 0d0a 0d0a 2020  ted_data')....  
+00005d80: 2020 2020 2020 2020 2020 2320 506c 6f74            # Plot
+00005d90: 2074 6865 2068 6973 746f 6772 616d 206f   the histogram o
+00005da0: 6620 7468 6520 6f72 6967 696e 616c 2064  f the original d
+00005db0: 6174 610d 0a20 2020 2020 2020 2020 2020  ata..           
+00005dc0: 2061 7865 735b 312c 2030 5d2e 6869 7374   axes[1, 0].hist
+00005dd0: 2864 6174 612e 666c 6174 7465 6e28 292c  (data.flatten(),
+00005de0: 2062 696e 733d 3530 2c20 636f 6c6f 723d   bins=50, color=
+00005df0: 2762 272c 2061 6c70 6861 3d30 2e37 290d  'b', alpha=0.7).
+00005e00: 0a20 2020 2020 2020 2020 2020 2061 7865  .            axe
+00005e10: 735b 312c 2030 5d2e 7365 745f 7469 746c  s[1, 0].set_titl
+00005e20: 6528 274f 7269 6769 6e61 6c20 4869 7374  e('Original Hist
+00005e30: 6f67 7261 6d27 290d 0a20 2020 2020 2020  ogram')..       
+00005e40: 2020 2020 2061 7865 735b 312c 2030 5d2e       axes[1, 0].
+00005e50: 7365 745f 786c 6162 656c 2827 5069 7865  set_xlabel('Pixe
+00005e60: 6c20 5661 6c75 6527 290d 0a20 2020 2020  l Value')..     
+00005e70: 2020 2020 2020 2061 7865 735b 312c 2030         axes[1, 0
+00005e80: 5d2e 7365 745f 796c 6162 656c 2827 4672  ].set_ylabel('Fr
+00005e90: 6571 7565 6e63 7927 290d 0a0d 0a20 2020  equency')....   
+00005ea0: 2020 2020 2020 2020 2023 2050 6c6f 7420           # Plot 
+00005eb0: 7468 6520 6869 7374 6f67 7261 6d20 6f66  the histogram of
+00005ec0: 2074 6865 206d 6564 6961 6e5f 6669 6c74   the median_filt
+00005ed0: 6572 2064 6174 610d 0a20 2020 2020 2020  er data..       
+00005ee0: 2020 2020 2061 7865 735b 312c 2032 5d2e       axes[1, 2].
+00005ef0: 6869 7374 286e 6f72 6d61 6c69 7a65 645f  hist(normalized_
+00005f00: 6461 7461 2e66 6c61 7474 656e 2829 2c20  data.flatten(), 
+00005f10: 6269 6e73 3d35 302c 2063 6f6c 6f72 3d27  bins=50, color='
+00005f20: 6727 2c20 616c 7068 613d 302e 3729 0d0a  g', alpha=0.7)..
+00005f30: 2020 2020 2020 2020 2020 2020 6178 6573              axes
+00005f40: 5b31 2c20 325d 2e73 6574 5f74 6974 6c65  [1, 2].set_title
+00005f50: 2866 696c 7465 7265 645f 6c61 6265 6c29  (filtered_label)
+00005f60: 0d0a 2020 2020 2020 2020 2020 2020 6178  ..            ax
+00005f70: 6573 5b31 2c20 325d 2e73 6574 5f78 6c61  es[1, 2].set_xla
+00005f80: 6265 6c28 2750 6978 656c 2056 616c 7565  bel('Pixel Value
+00005f90: 2729 0d0a 2020 2020 2020 2020 2020 2020  ')..            
+00005fa0: 6178 6573 5b31 2c20 325d 2e73 6574 5f79  axes[1, 2].set_y
+00005fb0: 6c61 6265 6c28 2746 7265 7175 656e 6379  label('Frequency
+00005fc0: 2729 0d0a 0d0a 2020 2020 2020 2020 2020  ')....          
+00005fd0: 2020 2320 506c 6f74 2074 6865 2068 6973    # Plot the his
+00005fe0: 746f 6772 616d 206f 6620 7468 6520 6465  togram of the de
+00005ff0: 6e6f 6973 655f 6269 6c61 7465 7261 6c20  noise_bilateral 
+00006000: 6461 7461 0d0a 2020 2020 2020 2020 2020  data..          
+00006010: 2020 6178 6573 5b31 2c20 315d 2e68 6973    axes[1, 1].his
+00006020: 7428 6465 6e6f 6973 655f 6269 6c61 7465  t(denoise_bilate
+00006030: 7261 6c2e 666c 6174 7465 6e28 292c 2062  ral.flatten(), b
+00006040: 696e 733d 3530 2c20 636f 6c6f 723d 2772  ins=50, color='r
+00006050: 272c 2061 6c70 6861 3d30 2e37 290d 0a20  ', alpha=0.7).. 
+00006060: 2020 2020 2020 2020 2020 2061 7865 735b             axes[
+00006070: 312c 2031 5d2e 7365 745f 7469 746c 6528  1, 1].set_title(
+00006080: 2764 656e 6f69 7365 5f62 696c 6174 6572  'denoise_bilater
+00006090: 616c 2048 6973 746f 6772 616d 2729 0d0a  al Histogram')..
+000060a0: 2020 2020 2020 2020 2020 2020 6178 6573              axes
+000060b0: 5b31 2c20 315d 2e73 6574 5f78 6c61 6265  [1, 1].set_xlabe
+000060c0: 6c28 2750 6978 656c 2056 616c 7565 2729  l('Pixel Value')
+000060d0: 0d0a 2020 2020 2020 2020 2020 2020 6178  ..            ax
+000060e0: 6573 5b31 2c20 315d 2e73 6574 5f79 6c61  es[1, 1].set_yla
+000060f0: 6265 6c28 2746 7265 7175 656e 6379 2729  bel('Frequency')
+00006100: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
+00006110: 2320 506c 6f74 2074 6865 2068 6973 746f  # Plot the histo
+00006120: 6772 616d 206f 6620 7468 6520 6465 6e6f  gram of the deno
+00006130: 6973 655f 6269 6c61 7465 7261 6c20 6461  ise_bilateral da
+00006140: 7461 0d0a 2020 2020 2020 2020 2020 2020  ta..            
+00006150: 6178 6573 5b31 2c20 335d 2e68 6973 7428  axes[1, 3].hist(
+00006160: 636f 7272 6563 7465 645f 6461 7461 2e66  corrected_data.f
+00006170: 6c61 7474 656e 2829 2c20 6269 6e73 3d35  latten(), bins=5
+00006180: 302c 2063 6f6c 6f72 3d27 7227 2c20 616c  0, color='r', al
+00006190: 7068 613d 302e 3729 0d0a 2020 2020 2020  pha=0.7)..      
+000061a0: 2020 2020 2020 6178 6573 5b31 2c20 335d        axes[1, 3]
+000061b0: 2e73 6574 5f74 6974 6c65 2827 636f 7272  .set_title('corr
+000061c0: 6563 7465 645f 6461 7461 2048 6973 746f  ected_data Histo
+000061d0: 6772 616d 2729 0d0a 2020 2020 2020 2020  gram')..        
+000061e0: 2020 2020 6178 6573 5b31 2c20 335d 2e73      axes[1, 3].s
+000061f0: 6574 5f78 6c61 6265 6c28 2750 6978 656c  et_xlabel('Pixel
+00006200: 2056 616c 7565 2729 0d0a 2020 2020 2020   Value')..      
+00006210: 2020 2020 2020 6178 6573 5b31 2c20 335d        axes[1, 3]
+00006220: 2e73 6574 5f79 6c61 6265 6c28 2746 7265  .set_ylabel('Fre
+00006230: 7175 656e 6379 2729 0d0a 0d0a 2020 2020  quency')....    
+00006240: 2020 2020 2020 2020 2320 5361 7665 2074          # Save t
+00006250: 6865 2070 6c6f 7420 6173 2061 2073 696e  he plot as a sin
+00006260: 676c 6520 6669 6775 7265 0d0a 2020 2020  gle figure..    
+00006270: 2020 2020 2020 2020 6f75 7470 7574 5f66          output_f
+00006280: 696c 656e 616d 6520 3d20 6f73 2e70 6174  ilename = os.pat
+00006290: 682e 7370 6c69 7465 7874 2869 6d61 6765  h.splitext(image
+000062a0: 5f66 696c 6529 5b30 5d20 2b20 275f 696d  _file)[0] + '_im
+000062b0: 6167 6573 5f68 6973 746f 6772 616d 732e  ages_histograms.
+000062c0: 6a70 6727 0d0a 2020 2020 2020 2020 2020  jpg'..          
+000062d0: 2020 6f75 7470 7574 5f66 696c 6570 6174    output_filepat
+000062e0: 6820 3d20 6f73 2e70 6174 682e 6a6f 696e  h = os.path.join
+000062f0: 2870 6c6f 745f 6469 7265 6374 6f72 792c  (plot_directory,
+00006300: 206f 7574 7075 745f 6669 6c65 6e61 6d65   output_filename
+00006310: 290d 0a20 2020 2020 2020 2020 2020 2070  )..            p
+00006320: 6c74 2e73 6176 6566 6967 286f 7574 7075  lt.savefig(outpu
+00006330: 745f 6669 6c65 7061 7468 2c20 666f 726d  t_filepath, form
+00006340: 6174 3d27 6a70 6727 290d 0a0d 0a20 2020  at='jpg')....   
+00006350: 2020 2020 2020 2020 2023 2043 616c 6c20           # Call 
+00006360: 7469 6768 745f 6c61 796f 7574 2829 2074  tight_layout() t
+00006370: 6f20 6164 6a75 7374 2074 6865 2073 7562  o adjust the sub
+00006380: 706c 6f74 2073 7061 6369 6e67 0d0a 2020  plot spacing..  
+00006390: 2020 2020 2020 2020 2020 706c 742e 7469            plt.ti
+000063a0: 6768 745f 6c61 796f 7574 2829 0d0a 0d0a  ght_layout()....
+000063b0: 2020 2020 2020 2020 2020 2020 2320 436c              # Cl
+000063c0: 6f73 6520 7468 6520 706c 6f74 0d0a 2020  ose the plot..  
+000063d0: 2020 2020 2020 2020 2020 706c 742e 636c            plt.cl
+000063e0: 6f73 6528 290d 0a0d 0a20 2020 2020 2020  ose()....       
+000063f0: 2020 2020 2023 2043 7265 6174 6520 616e       # Create an
+00006400: 206f 7574 7075 7420 7261 7374 6572 2077   output raster w
+00006410: 6974 6820 7468 6520 636f 7272 6563 7465  ith the correcte
+00006420: 6420 6461 7461 0d0a 2020 2020 2020 2020  d data..        
+00006430: 2020 2020 6f75 7470 7574 5f66 696c 656e      output_filen
+00006440: 616d 6520 3d20 6f73 2e70 6174 682e 7370  ame = os.path.sp
+00006450: 6c69 7465 7874 2869 6d61 6765 5f66 696c  litext(image_fil
+00006460: 6529 5b30 5d20 2b20 272e 7469 6627 0d0a  e)[0] + '.tif'..
+00006470: 2020 2020 2020 2020 2020 2020 6f75 7470              outp
+00006480: 7574 5f66 696c 6570 6174 6820 3d20 6f73  ut_filepath = os
+00006490: 2e70 6174 682e 6a6f 696e 286f 7574 7075  .path.join(outpu
+000064a0: 745f 7061 7468 2c20 6f75 7470 7574 5f66  t_path, output_f
+000064b0: 696c 656e 616d 6529 0d0a 2020 2020 2020  ilename)..      
+000064c0: 2020 2020 2020 6472 6976 6572 203d 2067        driver = g
+000064d0: 6461 6c2e 4765 7444 7269 7665 7242 794e  dal.GetDriverByN
+000064e0: 616d 6528 2247 5469 6666 2229 0d0a 2020  ame("GTiff")..  
+000064f0: 2020 2020 2020 2020 2020 6f75 7470 7574            output
+00006500: 5f64 6174 6173 6574 203d 2064 7269 7665  _dataset = drive
+00006510: 722e 4372 6561 7465 286f 7574 7075 745f  r.Create(output_
+00006520: 6669 6c65 7061 7468 2c20 6461 7461 7365  filepath, datase
+00006530: 742e 5261 7374 6572 5853 697a 652c 2064  t.RasterXSize, d
+00006540: 6174 6173 6574 2e52 6173 7465 7259 5369  ataset.RasterYSi
+00006550: 7a65 2c20 312c 0d0a 2020 2020 2020 2020  ze, 1,..        
+00006560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006580: 2020 2067 6461 6c2e 4744 545f 4279 7465     gdal.GDT_Byte
+00006590: 290d 0a20 2020 2020 2020 2020 2020 200d  )..            .
+000065a0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+000065b0: 6e6f 6461 7461 5f76 616c 7565 2069 7320  nodata_value is 
+000065c0: 6e6f 7420 4e6f 6e65 3a0d 0a20 2020 2020  not None:..     
+000065d0: 2020 2020 2020 2020 2020 2063 6f72 7265             corre
+000065e0: 6374 6564 5f64 6174 6120 3d20 6e70 2e77  cted_data = np.w
+000065f0: 6865 7265 2863 6f72 7265 6374 6564 5f64  here(corrected_d
+00006600: 6174 6120 3d3d 206e 6f64 6174 615f 7661  ata == nodata_va
+00006610: 6c75 652c 206e 702e 6e61 6e2c 2063 6f72  lue, np.nan, cor
+00006620: 7265 6374 6564 5f64 6174 6129 0d0a 2020  rected_data)..  
+00006630: 2020 2020 2020 2020 2020 0d0a 2020 2020            ..    
+00006640: 2020 2020 2020 2020 6f75 7470 7574 5f64          output_d
+00006650: 6174 6173 6574 2e47 6574 5261 7374 6572  ataset.GetRaster
+00006660: 4261 6e64 2831 292e 5772 6974 6541 7272  Band(1).WriteArr
+00006670: 6179 2863 6f72 7265 6374 6564 5f64 6174  ay(corrected_dat
+00006680: 6129 0d0a 0d0a 2020 2020 2020 2020 2020  a)....          
+00006690: 2020 2320 5365 7420 7468 6520 7361 6d65    # Set the same
+000066a0: 2067 656f 7472 616e 7366 6f72 6d20 616e   geotransform an
+000066b0: 6420 7072 6f6a 6563 7469 6f6e 2061 7320  d projection as 
+000066c0: 7468 6520 696e 7075 7420 7261 7374 6572  the input raster
+000066d0: 0d0a 2020 2020 2020 2020 2020 2020 6f75  ..            ou
+000066e0: 7470 7574 5f64 6174 6173 6574 2e53 6574  tput_dataset.Set
+000066f0: 4765 6f54 7261 6e73 666f 726d 2864 6174  GeoTransform(dat
+00006700: 6173 6574 2e47 6574 4765 6f54 7261 6e73  aset.GetGeoTrans
+00006710: 666f 726d 2829 290d 0a20 2020 2020 2020  form())..       
+00006720: 2020 2020 206f 7574 7075 745f 6461 7461       output_data
+00006730: 7365 742e 5365 7450 726f 6a65 6374 696f  set.SetProjectio
+00006740: 6e28 6461 7461 7365 742e 4765 7450 726f  n(dataset.GetPro
+00006750: 6a65 6374 696f 6e28 2929 0d0a 0d0a 2020  jection())....  
+00006760: 2020 2020 2020 2020 2020 2320 436c 6f73            # Clos
+00006770: 6520 7468 6520 6461 7461 7365 7473 0d0a  e the datasets..
+00006780: 2020 2020 2020 2020 2020 2020 6461 7461              data
+00006790: 7365 7420 3d20 4e6f 6e65 0d0a 2020 2020  set = None..    
+000067a0: 2020 2020 2020 2020 6f75 7470 7574 5f64          output_d
+000067b0: 6174 6173 6574 203d 204e 6f6e 650d 0a0d  ataset = None...
+000067c0: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
+000067d0: 4578 6365 7074 696f 6e20 6173 2065 3a0d  Exception as e:.
+000067e0: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
+000067f0: 6e74 2866 2245 7272 6f72 2070 726f 6365  nt(f"Error proce
+00006800: 7373 696e 6720 7261 7374 6572 3a20 7b69  ssing raster: {i
+00006810: 6d61 6765 5f66 696c 657d 2229 0d0a 2020  mage_file}")..  
+00006820: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+00006830: 7374 7228 6529 290d 0a0d 0a20 2020 2020  str(e))....     
+00006840: 2020 2023 2055 7064 6174 6520 7072 6f67     # Update prog
+00006850: 7265 7373 2062 6172 0d0a 2020 2020 2020  ress bar..      
+00006860: 2020 7072 6f67 7265 7373 5f62 6172 2e75    progress_bar.u
+00006870: 7064 6174 6528 3129 0d0a 0d0a 2020 2020  pdate(1)....    
+00006880: 2320 436c 6f73 6520 7072 6f67 7265 7373  # Close progress
+00006890: 2062 6172 0d0a 2020 2020 7072 6f67 7265   bar..    progre
+000068a0: 7373 5f62 6172 2e63 6c6f 7365 2829 0d0a  ss_bar.close()..
+000068b0: 0d0a 0d0a 2320 2320 4578 616d 706c 6520  ....# # Example 
+000068c0: 7573 6167 650d 0a23 2069 6e70 7574 5f70  usage..# input_p
+000068d0: 6174 6820 3d20 2263 726f 7070 6564 5f64  ath = "cropped_d
+000068e0: 6972 220d 0a23 206f 7574 7075 745f 7061  ir"..# output_pa
+000068f0: 7468 203d 2022 6f75 7470 7574 5f64 6972  th = "output_dir
+00006900: 220d 0a23 206c 696d 6974 203d 2035 2020  "..# limit = 5  
+00006910: 2320 4d61 7869 6d75 6d20 6e75 6d62 6572  # Maximum number
+00006920: 206f 6620 696d 6167 6573 2074 6f20 7072   of images to pr
+00006930: 6f63 6573 732c 2073 6574 2074 6f20 4e6f  ocess, set to No
+00006940: 6e65 2066 6f72 2061 6c6c 2069 6d61 6765  ne for all image
+00006950: 730d 0a23 2072 6173 7465 725f 636f 7272  s..# raster_corr
+00006960: 6563 7469 6f6e 2869 6e70 7574 5f70 6174  ection(input_pat
+00006970: 682c 206f 7574 7075 745f 7061 7468 2c20  h, output_path, 
+00006980: 6c69 6d69 7429 0d0a 0d0a 2020 2020 2020  limit)....      
+00006990: 2020
```

## akhdefo_functions/Mosaic_Crop.py

```diff
@@ -1,9 +1,23 @@
 
-
+###Start###
+import glob
+from pathlib import Path
+import os
+from glob import glob
+from osgeo import gdal
+import glob
+import re
+from osgeo import gdal, ogr
+import os
+import numpy as np
+import os 
+import glob
+from pathlib import Path
+from tqdm import tqdm
 
 def Mosaic(Path_to_WorkingDir=r"", output_MosaicDir=r"" , img_mode=1,  file_ex=".tif"):
 
     """
     This program mosiacs raster images in geotif format as well as grab dates of the satellite image taken for further processing. 
     The current version only supports PlanetLabs ortho SurfaceReflectance products.
 
@@ -20,21 +34,15 @@
          if img_mode=1 the program mosiacs only  rasters data images
 
     Returns
     -------
     Mosaiced raster images
 
     """
-    import glob
-    from pathlib import Path
-    import os
-    from glob import glob
-    from osgeo import gdal
-    import glob
-    import re
+   
 
 
 #5851965_1062413_2022-08-12_24a4_BGRN_SR_clip.tif
 #5851965_1062413_2022-08-12_24a4_udm2_clip.tif
     
     Working_Dir=Path_to_WorkingDir
     output_MosaicDir=output_MosaicDir
@@ -130,17 +138,15 @@
          
            
         
       
         
 
 
-from osgeo import gdal, ogr
-import os
-import numpy as np
+
 def rasterClip(rasterpath, aoi, outfilename):
     """
     Clip a raster file using an Area Of Interest (AOI) defined by a shapefile.
     Uses GDAL for processing.
 
     Parameters
     ----------
@@ -212,18 +218,15 @@
         path to save cropped raster files
 
     Returns
     -------
     cropped raster files
 
     """
-    import os 
-    import glob
-    from pathlib import Path
-    from tqdm import tqdm
+   
 
     if not os.path.exists(output_CroppedDir):
         os.makedirs(output_CroppedDir)
         
     Path_to_WorkingDir=Path_to_WorkingDir
     output_CroppedDir=output_CroppedDir
```

## akhdefo_functions/Stacked_Velocity.py

```diff
@@ -1,10 +1,32 @@
 
 ######
+###Start###
 
+import geopandas as gpd
+from shapely.geometry import Point
+from functools import partial
+import geopandas as gpd
+from geocube.api.core import make_geocube
+from geocube.rasterize import rasterize_points_griddata
+import earthpy.spatial as es
+import rasterio
+import glob
+import os
+from dateutil import parser
+import numpy as np
+import matplotlib.pyplot as plt
+import rioxarray as rxr
+from rasterio.plot import plotting_extent
+import earthpy.spatial as es
+from osgeo import gdal
+import numpy as np
+import matplotlib.pyplot as plt
+import matplotlib.colors as colors
+import earthpy.plot as ep
 
 def stackprep(path_to_flowxnFolder=r"", path_toFlowynFolder=r"", dem=r"", print_list=False, start_date="YYYYMMDD", end_date="YYYYMMDD", output_stackedFolder=r"",
 VEL_scale=("month","year") , xres=3.125, yres=3.125, Velocity_shapeFile=False, Resampling=True, Raster_stack_correction=False ):
     
     '''
     This program collects velocity candiate points for time-series analysis.
 
@@ -52,31 +74,15 @@
     Returns
     -------
     ESRI Shapefile
         This file include candiate velocity points for timeseries analysis
         
     
     '''
-    import geopandas as gpd
-    from shapely.geometry import Point
-    from functools import partial
-    import geopandas as gpd
-    from geocube.api.core import make_geocube
-    from geocube.rasterize import rasterize_points_griddata
-    import earthpy.spatial as es
-    import rasterio
-    import glob
-    import os
-    from dateutil import parser
-    import numpy as np
-    import matplotlib.pyplot as plt
-    import rioxarray as rxr
-    from rasterio.plot import plotting_extent
-    import earthpy.spatial as es
-    from osgeo import gdal
+    
     
 
     if not os.path.exists(output_stackedFolder):
         os.makedirs(output_stackedFolder)
         
         
     def akdefo_calibration_points(path_to_Raster=r"", output_filePath=r"",outputFile_name="" ):
@@ -709,28 +715,27 @@
         
     with rasterio.open(sv_dir, 'w', **profile) as dst:
         dst.write(angle_map1, indexes=1)
         profile = dst.profile
         profile.update(nodata=np.nan, dtype="float32")
 
     #Names for Interpolated raster
-    import earthpy.spatial as es
+    
     with rasterio.open(dem) as src:
         elevation = src.read(1)
         # Set masked values to np.nan
         #elevation[elevation < 0] = np.nan
     # Create and plot the hillshade with earthpy
     hillshade = es.hillshade(elevation, azimuth=270, altitude=45)
 
     dem = rxr.open_rasterio(dem, masked=True)
     dem_plotting_extent = plotting_extent(dem[0], dem.rio.transform())
 
 
-    import matplotlib.colors as colors
-    import earthpy.plot as ep
+   
     # # #Plot figures
     # fig, ax=plt.subplots(nrows=2, ncols=1, figsize=(10,10))
     # ep.plot_bands( hillshade,cbar=False,extent=dem_plotting_extent,ax=ax[0], scale=True)
     # ep.plot_bands( hillshade,cbar=False,extent=dem_plotting_extent,ax=ax[1], scale=True)
     # a=ax[0].imshow(mean_y, cmap='Spectral' , norm=colors.CenteredNorm(), alpha=0.75)
     # ax[0].set_title('NS')
     # b=ax[1].imshow(mean_x, cmap='Spectral', norm=colors.CenteredNorm(), alpha=0.75)
@@ -746,17 +751,15 @@
         os.makedirs(output_stackedFolder + "/resampled")
     sv_mag_resampled= output_stackedFolder + "/resampled" + "/" + datefrom+ "_to_"+ dateto + '_VEL.tif'
     sv_dir_resampled= output_stackedFolder + "/resampled"+ "/" + datefrom+ "_to_"+ dateto + '_dir'+ '.tif'
     sv_E_W__resampled= output_stackedFolder + "/resampled" + "/" + datefrom+ "_to_"+ dateto + '_E-W'+ '.tif'
     sv_N_S__resampled= output_stackedFolder + "/resampled"+ "/" + datefrom+ "_to_"+ dateto + '_N-S'+ '.tif'
     
     def resample(input_raster="", output_raster="" , xres=3.125 , yres=3.125):
-        from osgeo import gdal
-        import numpy as np
-        import matplotlib.pyplot as plt
+        
 
         ds = gdal.Open(input_raster)
 
         # resample
         dsRes = gdal.Warp(output_raster, ds, xRes = xres, yRes = yres, 
                         resampleAlg = "cubicspline")
```

## akhdefo_functions/Unzip_CopyFiles.py

```diff
@@ -1,7 +1,50 @@
+###Start###
+
+import os 
+import shutil
+from zipfile import ZipFile
+import glob
+import os
+from os import listdir
+from os.path import isfile, join
+import os 
+import shutil
+from zipfile import ZipFile
+import glob
+import os
+from os import listdir
+from os.path import isfile, join
+import os 
+import shutil
+from zipfile import ZipFile
+import glob
+import os
+from os import listdir
+from os.path import isfile, join
+import os 
+import shutil
+from zipfile import ZipFile
+import glob
+import os
+from os import listdir
+from os.path import isfile, join
+import os 
+import shutil
+from zipfile import ZipFile
+import glob
+import os
+from os import listdir
+from os.path import isfile, join
+from osgeo import gdal
+from datetime import datetime
+import re
+from tqdm import tqdm
+import os
+import shutil
 
 def unzip(zipdir, dst_dir ):
 
     """
     This program unzips all the zip products into one folder
 
     Parameters
@@ -15,21 +58,15 @@
         path to destination folder to copy all unzipped products.
 
     Returns
     -------
     unzip folder
 
     """
-    import os 
-    import shutil
-    from zipfile import ZipFile
-    import glob
-    import os
-    from os import listdir
-    from os.path import isfile, join
+   
     if not os.path.exists( dst_dir):
         os.makedirs( dst_dir)
     dst_dir=dst_dir
     zipdir=zipdir
     zip_list = [f for f in sorted(os.listdir(zipdir)) if isfile(join(zipdir, f))]
 
     for n in range (0, len(zip_list)):
@@ -59,21 +96,15 @@
         type extension of the files of interestest such as ".tif"
 
     Returns
     -------
     rasters
 
     """
-    import os 
-    import shutil
-    from zipfile import ZipFile
-    import glob
-    import os
-    from os import listdir
-    from os.path import isfile, join
+   
 
     if not os.path.exists( Path_to_raster_tifs):
         os.makedirs( Path_to_raster_tifs)
 
     S2_path = os.path.join (path_to_unzipped_folders)
 
     for subdir, dirs, files in os.walk(S2_path):
@@ -108,21 +139,15 @@
 
     Returns
     -------
     rasters
 
     """
     
-    import os 
-    import shutil
-    from zipfile import ZipFile
-    import glob
-    import os
-    from os import listdir
-    from os.path import isfile, join
+   
 
     if not os.path.exists( Path_to_UDM2raster_tifs):
         os.makedirs( Path_to_UDM2raster_tifs)
 
     S2_path = os.path.join (path_to_unzipped_folders)
 
     for subdir, dirs, files in os.walk(S2_path):
@@ -157,41 +182,23 @@
     image_dir
     udm_mask_dir
     
     
 
     """
     
-    import os 
-    import shutil
-    from zipfile import ZipFile
-    import glob
-    import os
-    from os import listdir
-    from os.path import isfile, join
-    import os 
-    import shutil
-    from zipfile import ZipFile
-    import glob
-    import os
-    from os import listdir
-    from os.path import isfile, join
-    from osgeo import gdal
-    from datetime import datetime
-    import re
-    from tqdm import tqdm
+    
     # if not os.path.exists( unzip_dir):
     #     os.makedirs( unzip_dir)
     if not os.path.exists(image_dir):
         os.makedirs(image_dir)
     if not os.path.exists(udm_mask_dir):
         os.makedirs(udm_mask_dir)
     #check if the folder is empty if not delete all files
-    import os
-    import shutil
+   
 
     for root, dirs, files in os.walk(image_dir):
         for f in files:
             os.unlink(os.path.join(root, f))
         for d in dirs:
             shutil.rmtree(os.path.join(root, d))
```

## akhdefo_functions/Video_Streamer.py

```diff
@@ -1,7 +1,11 @@
+from flask import Flask, render_template, Response
+import cv2
+import akhdefo_functions
+from akhdefo_functions import measure_displacement_from_camera
 def run_flask_app():
     """
     Function to run the Flask app and prompt the user for input.
 
     Parameters:
     - Execute this function in your Python environment.
     - Enter the desired port number for the Flask app when prompted.
@@ -10,17 +14,15 @@
     - http://your_server_ip/video1?src_video_url=https://your_video_source_url_frame1
     - Replace 'your_server_ip' with your server's IP address or domain, and 'your_video_source_url_frame1' with the URL of the video source for Frame 1.
     - Access Frame 2 by opening a web browser and visiting the following URL:
     - http://your_server_ip/video2?src_video_url=https://your_video_source_url_frame2 , Replace 'your_server_ip' with your server's IP address or domain, and 'your_video_source_url_frame2' with the URL of the video source for Frame 2.
     
     """
     
-    from flask import Flask, render_template, Response
-    import cv2
-    import akhdefo_functions
+   
 
     try:
         from akhdefo_functions import measure_displacement_from_camera
     except ImportError as e:
         print(f"Error importing 'akhdefo_functions': {e}")
 
     app = Flask(__name__)
```

## akhdefo_functions/__init__.py

```diff
@@ -1,26 +1,27 @@
 """
 akhdefo_functions
 
 collection of python modules performs geospatial image processing to moniter land deformation
 """
 
-__version__ = "2.4.29"
-__author__ = 'Mahmud Mustafa Muhammad'
+__version__ = "2.5.0"
+__author__ = 'Mahmud Mustafa Muhammad: mahmud.muhamm1@gmail.com'
 __credits__ = 'Simon Fraser university-Department of Earth Sciences'
 
 
 from .AkhdefoPlot import*
 from .Akhdefo_Tools import*
 from .Akhdefo_TS import*
 from .Filter_PreProc import*
 from .Mosaic_Crop import*
 from .OpticalFlow import*
 from .Stacked_Velocity import*
-from.Unzip_CopyFiles import*
+from .Unzip_CopyFiles import*
 from .Akhdefo_Coreg import*
-from .Akhdefo_GOI import*
 from .Akhdefo_Utilities import*
 from .Video_Streamer import*
+from .Akhdefo_Classification import*
+from .Akhdefo_GOI import*
```

## Comparing `akhdefo_functions-2.4.29.dist-info/METADATA` & `akhdefo_functions-2.5.0.dist-info/METADATA`

 * *Files 8% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: akhdefo-functions
-Version: 2.4.29
+Version: 2.5.0
 Summary: Land Deformation Monitoring Using Optical Satellite Imagery
 Home-page: https://github.com/mahmudsfu/AkhDefo
 Author: Mahmud Mustafa Muhammad
 Author-email: Mahmud Mustafa Muhammad <mahmud.muhamm1@gmail.com>
 License: Academic Free License (AFL)
 Project-URL: GitHub-Page, https://github.com/mahmudsfu/AkhDefo
 Project-URL: Bug Tracker, https://github.com/mahmudsfu/AkhDefo/issues
```

## Comparing `akhdefo_functions-2.4.29.dist-info/RECORD` & `akhdefo_functions-2.5.0.dist-info/RECORD`

 * *Files 10% similar despite different names*

```diff
@@ -1,20 +1,21 @@
 akhdefo_functions/ASF.py,sha256=AihzExxQedmh9TpJXuQd68P1LQuQ_5db6P_PAElJ2sM,16653
-akhdefo_functions/AkhdefoPlot.py,sha256=84cBmjfNpcMGfhfVv8MBmDCdW5igAXqdJwfrG8a80Es,53386
-akhdefo_functions/Akhdefo_Coreg.py,sha256=UuuPPszg4cH-KOyraCdYAazbIoKeXiZ0yK3iUF8XtMI,9259
-akhdefo_functions/Akhdefo_GOI.py,sha256=NIdUTrE6Lv_ZcMyWt7d03-SZm-gAj5D3Wr2VHX7Ydps,114378
+akhdefo_functions/AkhdefoPlot.py,sha256=QaZsQwinlyJHdPLffeFeQ11UExaK8EeDqbcuF27vh9c,53386
+akhdefo_functions/Akhdefo_Classification.py,sha256=7S_2BggdFnmyawz2FMoQIzlHhAIuI6PHysWNT8MCCC8,10947
+akhdefo_functions/Akhdefo_Coreg.py,sha256=7LuyS9Zp43UlTp8RvEMbKcYvLfd0_oY_logVHqBgbSk,9269
+akhdefo_functions/Akhdefo_GOI.py,sha256=a2hPC3xX7LiZFa1eZsyW4SAMjm31lC0bQfb_VEgfOek,114256
 akhdefo_functions/Akhdefo_TS.py,sha256=wsJh7LWEuPupTXSmIH029rLfLdM18h33P-e6TkfQeSY,45641
-akhdefo_functions/Akhdefo_Tools.py,sha256=5mwra9yY45gRvXV9mtcr_sL8fWqstDHSg79mx-M2WSc,87861
-akhdefo_functions/Akhdefo_Utilities.py,sha256=FZ3ETATtDhBVjzFFD2qu6PJW3bT2v4hO8y0-TKQtD1E,153565
-akhdefo_functions/Filter_PreProc.py,sha256=E8LRXjJmos0nHpjR6QIaCymluQdfFqrDoXyRWSSTYn8,27051
-akhdefo_functions/Mosaic_Crop.py,sha256=E-NgHQLqyTwjHoAIZgGRO2OiPupS6xPmPQTr_l3ieuo,8056
+akhdefo_functions/Akhdefo_Tools.py,sha256=QZPthq6TRwr0xOkRZQYNfZNQEvomTipVIqurpGrx6gs,76847
+akhdefo_functions/Akhdefo_Utilities.py,sha256=hK7ijxZ2NZTXUwvoZPrKylLu1nWlMO77qFlUXN2cmNQ,153494
+akhdefo_functions/Filter_PreProc.py,sha256=7-8A4Q-2wzMoFnUiSa7pknEJ6NZwVGzXYqAHMPRN99U,27026
+akhdefo_functions/Mosaic_Crop.py,sha256=CiosSN04w_zi9IJUjNLnge0GeKCJt42HHxDztAV3Spo,8035
 akhdefo_functions/OpticalFlow.py,sha256=Vf7wHnVxwpSE51ZlvraSALSSfG6JwdchuL0GkN68DvA,45101
 akhdefo_functions/S1.py,sha256=x6D0MZdhRgcGnp_DN6eD6WutPboFczN5WS6WLzKb3E4,12943
-akhdefo_functions/Stacked_Velocity.py,sha256=YkHPI9NMhf_k6nKzzU8tUY5tv5Oa4feyatPHEOtFRmg,38790
-akhdefo_functions/Unzip_CopyFiles.py,sha256=-KlUh2hfSsPuCCEU02zuRkQb7t7y7AzCF342xNw7yWQ,11849
-akhdefo_functions/Video_Streamer.py,sha256=vnKu6SVM_rt3e_bZXrejpnR2NOW2TYVdAwyKe1FZljY,9190
-akhdefo_functions/__init__.py,sha256=KYofs0Q523fdOTNXi6z7qTyh9ZA1AdCLW1cMsx33Ph8,619
+akhdefo_functions/Stacked_Velocity.py,sha256=RdLrD8m_pSQDsQXgU6Eg0iboAuVSC4IT1pEjoyQkWv8,38672
+akhdefo_functions/Unzip_CopyFiles.py,sha256=30kzo68gGIaok10RM_Zn3F63JNnvHxEKbDp9JoZqeMU,11726
+akhdefo_functions/Video_Streamer.py,sha256=dZgEO7-VzmlexG9u1ZkU47L2n81v40WQjHO1WkqTpqo,9247
+akhdefo_functions/__init__.py,sha256=_N2bjSjZN6NesZxtgkIO5fTCrEtafTKTXFKRIfsrhq4,683
 akhdefo_functions/tqdm_joblib.py,sha256=FeR0O-APzoGIrHifyWbyP6zXAiIXBYweqeGieJ6iWuM,2128
-akhdefo_functions-2.4.29.dist-info/METADATA,sha256=CUUJP037YYLl2gFt2Ed3x-tok7MucgcEO9M4QxEJB0Y,3936
-akhdefo_functions-2.4.29.dist-info/WHEEL,sha256=pkctZYzUS4AYVn6dJ-7367OJZivF2e8RA9b_ZBjif18,92
-akhdefo_functions-2.4.29.dist-info/top_level.txt,sha256=f44EhlHyHyMPViIAioSeoagzxgVrlg6NsdfXRHB7U-U,18
-akhdefo_functions-2.4.29.dist-info/RECORD,,
+akhdefo_functions-2.5.0.dist-info/METADATA,sha256=Sy1hk2wvrgZcb0nla-w7539mv_peTT4_Yksmsdpu14A,3935
+akhdefo_functions-2.5.0.dist-info/WHEEL,sha256=pkctZYzUS4AYVn6dJ-7367OJZivF2e8RA9b_ZBjif18,92
+akhdefo_functions-2.5.0.dist-info/top_level.txt,sha256=f44EhlHyHyMPViIAioSeoagzxgVrlg6NsdfXRHB7U-U,18
+akhdefo_functions-2.5.0.dist-info/RECORD,,
```

